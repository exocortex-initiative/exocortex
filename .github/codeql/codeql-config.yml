# CodeQL Configuration for Exocortex
#
# This file configures CodeQL analysis to handle false positives and
# intentional security patterns required for SPARQL 1.1 specification compliance.

name: "Exocortex CodeQL Configuration"

# Path filters - include only source code, exclude tests and generated files
paths:
  - packages/*/src

paths-ignore:
  - "**/node_modules/**"
  - "**/dist/**"
  - "**/tests/**"
  - "**/specs/**"
  - "**/*.test.ts"
  - "**/*.test.tsx"
  - "**/*.spec.ts"
  - "packages/obsidian-plugin/main.js"      # Generated bundled output
  - "packages/obsidian-plugin/main.js.map"  # Source maps
  - "**/test-vault/**/main.js"              # Test vault generated plugin copy
  - "**/debug-main.js"                      # Debug builds
  - "**/debug-main.ts"                      # Debug builds

# Query filters to suppress intentional false positives
query-filters:
  # Suppress weak crypto alerts for SPARQL 1.1 hash functions (MD5, SHA1)
  # These are required by W3C SPARQL 1.1 specification for spec compliance
  # https://www.w3.org/TR/sparql11-query/#func-hash
  #
  # SECURITY CONTEXT: MD5 and SHA1 are used ONLY for:
  # - SPARQL query result hashing (non-security purpose)
  # - Implementing W3C SPARQL 1.1 spec-mandated functions
  # They are NOT used for password hashing, authentication, or cryptographic security.
  - exclude:
      id: js/weak-cryptographic-algorithm
      # Regex pattern to match the BuiltInFunctions file in any package
      path-regex: ".*BuiltInFunctions\\.ts$"

  # Suppress insecure randomness for SPARQL 1.1 RAND() function
  # RAND() is defined by W3C SPARQL 1.1 spec and not used for security
  # https://www.w3.org/TR/sparql11-query/#func-rand
  #
  # SECURITY CONTEXT: Math.random() is used ONLY for:
  # - SPARQL RAND() function implementation (non-security purpose)
  # - Implementing W3C SPARQL 1.1 spec-mandated random number function
  # It is NOT used for session tokens, cryptographic keys, or any security purpose.
  - exclude:
      id: js/insecure-randomness
      # Match both the implementation file and call sites
      path-regex: ".*(BuiltInFunctions|FilterExecutor)\\.ts$"

  # Suppress automatic semicolon insertion warnings for generated bundle
  # main.js is auto-generated by esbuild bundler and contains third-party code
  # (28 alerts - all from generated/bundled output, not source code)
  - exclude:
      id: js/automatic-semicolon-insertion
      path-regex: ".*/main\\.js$"
