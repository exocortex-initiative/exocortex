#!/usr/bin/env node
// @kitelev/exocortex-cli v0.1.0
// CLI tool for Exocortex knowledge management system - SPARQL queries, task management, and more
// License: MIT

"use strict";var cT=Object.create;var Fo=Object.defineProperty;var uT=Object.getOwnPropertyDescriptor;var lT=Object.getOwnPropertyNames;var hT=Object.getPrototypeOf,fT=Object.prototype.hasOwnProperty;var o=(n,e)=>Fo(n,"name",{value:e,configurable:!0});var dT=(n,e)=>()=>(n&&(e=n(n=0)),e);var y=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),pT=(n,e)=>{for(var t in e)Fo(n,t,{get:e[t],enumerable:!0})},T1=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of lT(e))!fT.call(n,i)&&i!==t&&Fo(n,i,{get:()=>e[i],enumerable:!(r=uT(e,i))||r.enumerable});return n};var Ze=(n,e,t)=>(t=n!=null?cT(hT(n)):{},T1(e||!n||!n.__esModule?Fo(t,"default",{value:n,enumerable:!0}):t,n)),Hf=n=>T1(Fo({},"__esModule",{value:!0}),n);var Yf=y(()=>{var A1;(function(n){(function(e){var t=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:c(),r=i(n);typeof t.Reflect<"u"&&(r=i(t.Reflect,r)),e(r,t),typeof t.Reflect>"u"&&(t.Reflect=n);function i(u,l){return function(h,f){Object.defineProperty(u,h,{configurable:!0,writable:!0,value:f}),l&&l(h,f)}}o(i,"makeExporter");function s(){try{return Function("return this;")()}catch{}}o(s,"functionThis");function a(){try{return(0,eval)("(function() { return this; })()")}catch{}}o(a,"indirectEvalThis");function c(){return s()||a()}o(c,"sloppyModeThis")})(function(e,t){var r=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",u={__proto__:[]}instanceof Array,l=!c&&!u,h={create:c?function(){return we(Object.create(null))}:u?function(){return we({__proto__:null})}:function(){return we({})},has:l?function(b,E){return r.call(b,E)}:function(b,E){return E in b},get:l?function(b,E){return r.call(b,E)?b[E]:void 0}:function(b,E){return b[E]}},f=Object.getPrototypeOf(Function),d=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ce(),m=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ne(),_=typeof WeakMap=="function"?WeakMap:Pe(),S=i?Symbol.for("@reflect-metadata:registry"):void 0,A=se(),I=ae(A);function D(b,E,w,x){if(V(w)){if(!Ee(b))throw new TypeError;if(!Te(E))throw new TypeError;return Ke(b,E)}else{if(!Ee(b))throw new TypeError;if(!z(E))throw new TypeError;if(!z(x)&&!V(x)&&!de(x))throw new TypeError;return de(x)&&(x=void 0),w=le(w),Ge(b,E,w,x)}}o(D,"decorate"),e("decorate",D);function L(b,E){function w(x,B){if(!z(x))throw new TypeError;if(!V(B)&&!De(B))throw new TypeError;H(b,E,x,B)}return o(w,"decorator"),w}o(L,"metadata"),e("metadata",L);function G(b,E,w,x){if(!z(w))throw new TypeError;return V(x)||(x=le(x)),H(b,E,w,x)}o(G,"defineMetadata"),e("defineMetadata",G);function W(b,E,w){if(!z(E))throw new TypeError;return V(w)||(w=le(w)),tt(b,E,w)}o(W,"hasMetadata"),e("hasMetadata",W);function Fe(b,E,w){if(!z(E))throw new TypeError;return V(w)||(w=le(w)),ke(b,E,w)}o(Fe,"hasOwnMetadata"),e("hasOwnMetadata",Fe);function et(b,E,w){if(!z(E))throw new TypeError;return V(w)||(w=le(w)),je(b,E,w)}o(et,"getMetadata"),e("getMetadata",et);function ct(b,E,w){if(!z(E))throw new TypeError;return V(w)||(w=le(w)),Re(b,E,w)}o(ct,"getOwnMetadata"),e("getOwnMetadata",ct);function U(b,E){if(!z(b))throw new TypeError;return V(E)||(E=le(E)),k(b,E)}o(U,"getMetadataKeys"),e("getMetadataKeys",U);function ue(b,E){if(!z(b))throw new TypeError;return V(E)||(E=le(E)),Me(b,E)}o(ue,"getOwnMetadataKeys"),e("getOwnMetadataKeys",ue);function Se(b,E,w){if(!z(E))throw new TypeError;if(V(w)||(w=le(w)),!z(E))throw new TypeError;V(w)||(w=le(w));var x=Q(E,w,!1);return V(x)?!1:x.OrdinaryDeleteMetadata(b,E,w)}o(Se,"deleteMetadata"),e("deleteMetadata",Se);function Ke(b,E){for(var w=b.length-1;w>=0;--w){var x=b[w],B=x(E);if(!V(B)&&!de(B)){if(!Te(B))throw new TypeError;E=B}}return E}o(Ke,"DecorateConstructor");function Ge(b,E,w,x){for(var B=b.length-1;B>=0;--B){var Xe=b[B],it=Xe(E,w,x);if(!V(it)&&!de(it)){if(!z(it))throw new TypeError;x=it}}return x}o(Ge,"DecorateProperty");function tt(b,E,w){var x=ke(b,E,w);if(x)return!0;var B=te(E);return de(B)?!1:tt(b,B,w)}o(tt,"OrdinaryHasMetadata");function ke(b,E,w){var x=Q(E,w,!1);return V(x)?!1:be(x.OrdinaryHasOwnMetadata(b,E,w))}o(ke,"OrdinaryHasOwnMetadata");function je(b,E,w){var x=ke(b,E,w);if(x)return Re(b,E,w);var B=te(E);if(!de(B))return je(b,B,w)}o(je,"OrdinaryGetMetadata");function Re(b,E,w){var x=Q(E,w,!1);if(!V(x))return x.OrdinaryGetOwnMetadata(b,E,w)}o(Re,"OrdinaryGetOwnMetadata");function H(b,E,w,x){var B=Q(w,x,!0);B.OrdinaryDefineOwnMetadata(b,E,w,x)}o(H,"OrdinaryDefineOwnMetadata");function k(b,E){var w=Me(b,E),x=te(b);if(x===null)return w;var B=k(x,E);if(B.length<=0)return w;if(w.length<=0)return B;for(var Xe=new m,it=[],_e=0,j=w;_e<j.length;_e++){var M=j[_e],$=Xe.has(M);$||(Xe.add(M),it.push(M))}for(var q=0,ge=B;q<ge.length;q++){var M=ge[q],$=Xe.has(M);$||(Xe.add(M),it.push(M))}return it}o(k,"OrdinaryMetadataKeys");function Me(b,E){var w=Q(b,E,!1);return w?w.OrdinaryOwnMetadataKeys(b,E):[]}o(Me,"OrdinaryOwnMetadataKeys");function We(b){if(b===null)return 1;switch(typeof b){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return b===null?1:6;default:return 6}}o(We,"Type");function V(b){return b===void 0}o(V,"IsUndefined");function de(b){return b===null}o(de,"IsNull");function Ce(b){return typeof b=="symbol"}o(Ce,"IsSymbol");function z(b){return typeof b=="object"?b!==null:typeof b=="function"}o(z,"IsObject");function xe(b,E){switch(We(b)){case 0:return b;case 1:return b;case 2:return b;case 3:return b;case 4:return b;case 5:return b}var w=E===3?"string":E===5?"number":"default",x=re(b,s);if(x!==void 0){var B=x.call(b,w);if(z(B))throw new TypeError;return B}return Ie(b,w==="default"?"number":w)}o(xe,"ToPrimitive");function Ie(b,E){if(E==="string"){var w=b.toString;if(pe(w)){var x=w.call(b);if(!z(x))return x}var B=b.valueOf;if(pe(B)){var x=B.call(b);if(!z(x))return x}}else{var B=b.valueOf;if(pe(B)){var x=B.call(b);if(!z(x))return x}var Xe=b.toString;if(pe(Xe)){var x=Xe.call(b);if(!z(x))return x}}throw new TypeError}o(Ie,"OrdinaryToPrimitive");function be(b){return!!b}o(be,"ToBoolean");function Oe(b){return""+b}o(Oe,"ToString");function le(b){var E=xe(b,3);return Ce(E)?E:Oe(E)}o(le,"ToPropertyKey");function Ee(b){return Array.isArray?Array.isArray(b):b instanceof Object?b instanceof Array:Object.prototype.toString.call(b)==="[object Array]"}o(Ee,"IsArray");function pe(b){return typeof b=="function"}o(pe,"IsCallable");function Te(b){return typeof b=="function"}o(Te,"IsConstructor");function De(b){switch(We(b)){case 3:return!0;case 4:return!0;default:return!1}}o(De,"IsPropertyKey");function X(b,E){return b===E||b!==b&&E!==E}o(X,"SameValueZero");function re(b,E){var w=b[E];if(w!=null){if(!pe(w))throw new TypeError;return w}}o(re,"GetMethod");function ne(b){var E=re(b,a);if(!pe(E))throw new TypeError;var w=E.call(b);if(!z(w))throw new TypeError;return w}o(ne,"GetIterator");function J(b){return b.value}o(J,"IteratorValue");function Z(b){var E=b.next();return E.done?!1:E}o(Z,"IteratorStep");function ee(b){var E=b.return;E&&E.call(b)}o(ee,"IteratorClose");function te(b){var E=Object.getPrototypeOf(b);if(typeof b!="function"||b===f||E!==f)return E;var w=b.prototype,x=w&&Object.getPrototypeOf(w);if(x==null||x===Object.prototype)return E;var B=x.constructor;return typeof B!="function"||B===b?E:B}o(te,"OrdinaryGetPrototypeOf");function ie(){var b;!V(S)&&typeof t.Reflect<"u"&&!(S in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(b=oe(t.Reflect));var E,w,x,B=new _,Xe={registerProvider:it,getProvider:j,setProvider:$};return Xe;function it(q){if(!Object.isExtensible(Xe))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case b===q:break;case V(E):E=q;break;case E===q:break;case V(w):w=q;break;case w===q:break;default:x===void 0&&(x=new m),x.add(q);break}}function _e(q,ge){if(!V(E)){if(E.isProviderFor(q,ge))return E;if(!V(w)){if(w.isProviderFor(q,ge))return E;if(!V(x))for(var Ve=ne(x);;){var $e=Z(Ve);if(!$e)return;var Lt=J($e);if(Lt.isProviderFor(q,ge))return ee(Ve),Lt}}}if(!V(b)&&b.isProviderFor(q,ge))return b}function j(q,ge){var Ve=B.get(q),$e;return V(Ve)||($e=Ve.get(ge)),V($e)&&($e=_e(q,ge),V($e)||(V(Ve)&&(Ve=new d,B.set(q,Ve)),Ve.set(ge,$e))),$e}function M(q){if(V(q))throw new TypeError;return E===q||w===q||!V(x)&&x.has(q)}function $(q,ge,Ve){if(!M(Ve))throw new Error("Metadata provider not registered.");var $e=j(q,ge);if($e!==Ve){if(!V($e))return!1;var Lt=B.get(q);V(Lt)&&(Lt=new d,B.set(q,Lt)),Lt.set(ge,Ve)}return!0}}o(ie,"CreateMetadataRegistry");function se(){var b;return!V(S)&&z(t.Reflect)&&Object.isExtensible(t.Reflect)&&(b=t.Reflect[S]),V(b)&&(b=ie()),!V(S)&&z(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,S,{enumerable:!1,configurable:!1,writable:!1,value:b}),b}o(se,"GetOrCreateMetadataRegistry");function ae(b){var E=new _,w={isProviderFor:o(function(M,$){var q=E.get(M);return V(q)?!1:q.has($)},"isProviderFor"),OrdinaryDefineOwnMetadata:it,OrdinaryHasOwnMetadata:B,OrdinaryGetOwnMetadata:Xe,OrdinaryOwnMetadataKeys:_e,OrdinaryDeleteMetadata:j};return A.registerProvider(w),w;function x(M,$,q){var ge=E.get(M),Ve=!1;if(V(ge)){if(!q)return;ge=new d,E.set(M,ge),Ve=!0}var $e=ge.get($);if(V($e)){if(!q)return;if($e=new d,ge.set($,$e),!b.setProvider(M,$,w))throw ge.delete($),Ve&&E.delete(M),new Error("Wrong provider for target.")}return $e}o(x,"GetOrCreateMetadataMap");function B(M,$,q){var ge=x($,q,!1);return V(ge)?!1:be(ge.has(M))}o(B,"OrdinaryHasOwnMetadata");function Xe(M,$,q){var ge=x($,q,!1);if(!V(ge))return ge.get(M)}o(Xe,"OrdinaryGetOwnMetadata");function it(M,$,q,ge){var Ve=x(q,ge,!0);Ve.set(M,$)}o(it,"OrdinaryDefineOwnMetadata");function _e(M,$){var q=[],ge=x(M,$,!1);if(V(ge))return q;for(var Ve=ge.keys(),$e=ne(Ve),Lt=0;;){var Sr=Z($e);if(!Sr)return q.length=Lt,q;var Dr=J(Sr);try{q[Lt]=Dr}catch(sr){try{ee($e)}finally{throw sr}}Lt++}}o(_e,"OrdinaryOwnMetadataKeys");function j(M,$,q){var ge=x($,q,!1);if(V(ge)||!ge.delete(M))return!1;if(ge.size===0){var Ve=E.get($);V(Ve)||(Ve.delete(q),Ve.size===0&&E.delete(Ve))}return!0}o(j,"OrdinaryDeleteMetadata")}o(ae,"CreateMetadataProvider");function oe(b){var E=b.defineMetadata,w=b.hasOwnMetadata,x=b.getOwnMetadata,B=b.getOwnMetadataKeys,Xe=b.deleteMetadata,it=new _,_e={isProviderFor:o(function(j,M){var $=it.get(j);return!V($)&&$.has(M)?!0:B(j,M).length?(V($)&&($=new m,it.set(j,$)),$.add(M),!0):!1},"isProviderFor"),OrdinaryDefineOwnMetadata:E,OrdinaryHasOwnMetadata:w,OrdinaryGetOwnMetadata:x,OrdinaryOwnMetadataKeys:B,OrdinaryDeleteMetadata:Xe};return _e}o(oe,"CreateFallbackProvider");function Q(b,E,w){var x=A.getProvider(b,E);if(!V(x))return x;if(w){if(A.setProvider(b,E,I))return I;throw new Error("Illegal state.")}}o(Q,"GetMetadataProvider");function ce(){var b={},E=[],w=(function(){function _e(j,M,$){this._index=0,this._keys=j,this._values=M,this._selector=$}return o(_e,"MapIterator"),_e.prototype["@@iterator"]=function(){return this},_e.prototype[a]=function(){return this},_e.prototype.next=function(){var j=this._index;if(j>=0&&j<this._keys.length){var M=this._selector(this._keys[j],this._values[j]);return j+1>=this._keys.length?(this._index=-1,this._keys=E,this._values=E):this._index++,{value:M,done:!1}}return{value:void 0,done:!0}},_e.prototype.throw=function(j){throw this._index>=0&&(this._index=-1,this._keys=E,this._values=E),j},_e.prototype.return=function(j){return this._index>=0&&(this._index=-1,this._keys=E,this._values=E),{value:j,done:!0}},_e})(),x=(function(){function _e(){this._keys=[],this._values=[],this._cacheKey=b,this._cacheIndex=-2}return o(_e,"Map"),Object.defineProperty(_e.prototype,"size",{get:o(function(){return this._keys.length},"get"),enumerable:!0,configurable:!0}),_e.prototype.has=function(j){return this._find(j,!1)>=0},_e.prototype.get=function(j){var M=this._find(j,!1);return M>=0?this._values[M]:void 0},_e.prototype.set=function(j,M){var $=this._find(j,!0);return this._values[$]=M,this},_e.prototype.delete=function(j){var M=this._find(j,!1);if(M>=0){for(var $=this._keys.length,q=M+1;q<$;q++)this._keys[q-1]=this._keys[q],this._values[q-1]=this._values[q];return this._keys.length--,this._values.length--,X(j,this._cacheKey)&&(this._cacheKey=b,this._cacheIndex=-2),!0}return!1},_e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=b,this._cacheIndex=-2},_e.prototype.keys=function(){return new w(this._keys,this._values,B)},_e.prototype.values=function(){return new w(this._keys,this._values,Xe)},_e.prototype.entries=function(){return new w(this._keys,this._values,it)},_e.prototype["@@iterator"]=function(){return this.entries()},_e.prototype[a]=function(){return this.entries()},_e.prototype._find=function(j,M){if(!X(this._cacheKey,j)){this._cacheIndex=-1;for(var $=0;$<this._keys.length;$++)if(X(this._keys[$],j)){this._cacheIndex=$;break}}return this._cacheIndex<0&&M&&(this._cacheIndex=this._keys.length,this._keys.push(j),this._values.push(void 0)),this._cacheIndex},_e})();return x;function B(_e,j){return _e}function Xe(_e,j){return j}function it(_e,j){return[_e,j]}}o(ce,"CreateMapPolyfill");function Ne(){var b=(function(){function E(){this._map=new d}return o(E,"Set"),Object.defineProperty(E.prototype,"size",{get:o(function(){return this._map.size},"get"),enumerable:!0,configurable:!0}),E.prototype.has=function(w){return this._map.has(w)},E.prototype.add=function(w){return this._map.set(w,w),this},E.prototype.delete=function(w){return this._map.delete(w)},E.prototype.clear=function(){this._map.clear()},E.prototype.keys=function(){return this._map.keys()},E.prototype.values=function(){return this._map.keys()},E.prototype.entries=function(){return this._map.entries()},E.prototype["@@iterator"]=function(){return this.keys()},E.prototype[a]=function(){return this.keys()},E})();return b}o(Ne,"CreateSetPolyfill");function Pe(){var b=16,E=h.create(),w=x();return(function(){function j(){this._key=x()}return o(j,"WeakMap"),j.prototype.has=function(M){var $=B(M,!1);return $!==void 0?h.has($,this._key):!1},j.prototype.get=function(M){var $=B(M,!1);return $!==void 0?h.get($,this._key):void 0},j.prototype.set=function(M,$){var q=B(M,!0);return q[this._key]=$,this},j.prototype.delete=function(M){var $=B(M,!1);return $!==void 0?delete $[this._key]:!1},j.prototype.clear=function(){this._key=x()},j})();function x(){var j;do j="@@WeakMap@@"+_e();while(h.has(E,j));return E[j]=!0,j}function B(j,M){if(!r.call(j,w)){if(!M)return;Object.defineProperty(j,w,{value:h.create()})}return j[w]}function Xe(j,M){for(var $=0;$<M;++$)j[$]=Math.random()*255|0;return j}function it(j){if(typeof Uint8Array=="function"){var M=new Uint8Array(j);return typeof crypto<"u"?crypto.getRandomValues(M):typeof msCrypto<"u"?msCrypto.getRandomValues(M):Xe(M,j),M}return Xe(new Array(j),j)}function _e(){var j=it(b);j[6]=j[6]&79|64,j[8]=j[8]&191|128;for(var M="",$=0;$<b;++$){var q=j[$];($===4||$===6||$===8)&&(M+="-"),q<16&&(M+="0"),M+=q.toString(16).toLowerCase()}return M}}o(Pe,"CreateWeakMapPolyfill");function we(b){return b.__=void 0,delete b.__,b}o(we,"MakeDictionary")})})(A1||(A1={}))});var Ro=y(Kf=>{var yu=class extends Error{static{o(this,"CommanderError")}constructor(e,t,r){super(r),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=t,this.exitCode=e,this.nestedError=void 0}},Qf=class extends yu{static{o(this,"InvalidArgumentError")}constructor(e){super(1,"commander.invalidArgument",e),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}};Kf.CommanderError=yu;Kf.InvalidArgumentError=Qf});var vu=y(Jf=>{var{InvalidArgumentError:mT}=Ro(),Xf=class{static{o(this,"Argument")}constructor(e,t){switch(this.description=t||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,e[0]){case"<":this.required=!0,this._name=e.slice(1,-1);break;case"[":this.required=!1,this._name=e.slice(1,-1);break;default:this.required=!0,this._name=e;break}this._name.endsWith("...")&&(this.variadic=!0,this._name=this._name.slice(0,-3))}name(){return this._name}_collectValue(e,t){return t===this.defaultValue||!Array.isArray(t)?[e]:(t.push(e),t)}default(e,t){return this.defaultValue=e,this.defaultValueDescription=t,this}argParser(e){return this.parseArg=e,this}choices(e){return this.argChoices=e.slice(),this.parseArg=(t,r)=>{if(!this.argChoices.includes(t))throw new mT(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._collectValue(t,r):t},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}};function gT(n){let e=n.name()+(n.variadic===!0?"...":"");return n.required?"<"+e+">":"["+e+"]"}o(gT,"humanReadableArgName");Jf.Argument=Xf;Jf.humanReadableArgName=gT});var td=y(ed=>{var{humanReadableArgName:yT}=vu(),Zf=class{static{o(this,"Help")}constructor(){this.helpWidth=void 0,this.minWidthToWrap=40,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}prepareContext(e){this.helpWidth=this.helpWidth??e.helpWidth??80}visibleCommands(e){let t=e.commands.filter(i=>!i._hidden),r=e._getHelpCommand();return r&&!r._hidden&&t.push(r),this.sortSubcommands&&t.sort((i,s)=>i.name().localeCompare(s.name())),t}compareOptions(e,t){let r=o(i=>i.short?i.short.replace(/^-/,""):i.long.replace(/^--/,""),"getSortKey");return r(e).localeCompare(r(t))}visibleOptions(e){let t=e.options.filter(i=>!i.hidden),r=e._getHelpOption();if(r&&!r.hidden){let i=r.short&&e._findOption(r.short),s=r.long&&e._findOption(r.long);!i&&!s?t.push(r):r.long&&!s?t.push(e.createOption(r.long,r.description)):r.short&&!i&&t.push(e.createOption(r.short,r.description))}return this.sortOptions&&t.sort(this.compareOptions),t}visibleGlobalOptions(e){if(!this.showGlobalOptions)return[];let t=[];for(let r=e.parent;r;r=r.parent){let i=r.options.filter(s=>!s.hidden);t.push(...i)}return this.sortOptions&&t.sort(this.compareOptions),t}visibleArguments(e){return e._argsDescription&&e.registeredArguments.forEach(t=>{t.description=t.description||e._argsDescription[t.name()]||""}),e.registeredArguments.find(t=>t.description)?e.registeredArguments:[]}subcommandTerm(e){let t=e.registeredArguments.map(r=>yT(r)).join(" ");return e._name+(e._aliases[0]?"|"+e._aliases[0]:"")+(e.options.length?" [options]":"")+(t?" "+t:"")}optionTerm(e){return e.flags}argumentTerm(e){return e.name()}longestSubcommandTermLength(e,t){return t.visibleCommands(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleSubcommandTerm(t.subcommandTerm(i)))),0)}longestOptionTermLength(e,t){return t.visibleOptions(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleOptionTerm(t.optionTerm(i)))),0)}longestGlobalOptionTermLength(e,t){return t.visibleGlobalOptions(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleOptionTerm(t.optionTerm(i)))),0)}longestArgumentTermLength(e,t){return t.visibleArguments(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleArgumentTerm(t.argumentTerm(i)))),0)}commandUsage(e){let t=e._name;e._aliases[0]&&(t=t+"|"+e._aliases[0]);let r="";for(let i=e.parent;i;i=i.parent)r=i.name()+" "+r;return r+t+" "+e.usage()}commandDescription(e){return e.description()}subcommandDescription(e){return e.summary()||e.description()}optionDescription(e){let t=[];if(e.argChoices&&t.push(`choices: ${e.argChoices.map(r=>JSON.stringify(r)).join(", ")}`),e.defaultValue!==void 0&&(e.required||e.optional||e.isBoolean()&&typeof e.defaultValue=="boolean")&&t.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`),e.presetArg!==void 0&&e.optional&&t.push(`preset: ${JSON.stringify(e.presetArg)}`),e.envVar!==void 0&&t.push(`env: ${e.envVar}`),t.length>0){let r=`(${t.join(", ")})`;return e.description?`${e.description} ${r}`:r}return e.description}argumentDescription(e){let t=[];if(e.argChoices&&t.push(`choices: ${e.argChoices.map(r=>JSON.stringify(r)).join(", ")}`),e.defaultValue!==void 0&&t.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`),t.length>0){let r=`(${t.join(", ")})`;return e.description?`${e.description} ${r}`:r}return e.description}formatItemList(e,t,r){return t.length===0?[]:[r.styleTitle(e),...t,""]}groupItems(e,t,r){let i=new Map;return e.forEach(s=>{let a=r(s);i.has(a)||i.set(a,[])}),t.forEach(s=>{let a=r(s);i.has(a)||i.set(a,[]),i.get(a).push(s)}),i}formatHelp(e,t){let r=t.padWidth(e,t),i=t.helpWidth??80;function s(f,d){return t.formatItem(f,r,d,t)}o(s,"callFormatItem");let a=[`${t.styleTitle("Usage:")} ${t.styleUsage(t.commandUsage(e))}`,""],c=t.commandDescription(e);c.length>0&&(a=a.concat([t.boxWrap(t.styleCommandDescription(c),i),""]));let u=t.visibleArguments(e).map(f=>s(t.styleArgumentTerm(t.argumentTerm(f)),t.styleArgumentDescription(t.argumentDescription(f))));if(a=a.concat(this.formatItemList("Arguments:",u,t)),this.groupItems(e.options,t.visibleOptions(e),f=>f.helpGroupHeading??"Options:").forEach((f,d)=>{let m=f.map(_=>s(t.styleOptionTerm(t.optionTerm(_)),t.styleOptionDescription(t.optionDescription(_))));a=a.concat(this.formatItemList(d,m,t))}),t.showGlobalOptions){let f=t.visibleGlobalOptions(e).map(d=>s(t.styleOptionTerm(t.optionTerm(d)),t.styleOptionDescription(t.optionDescription(d))));a=a.concat(this.formatItemList("Global Options:",f,t))}return this.groupItems(e.commands,t.visibleCommands(e),f=>f.helpGroup()||"Commands:").forEach((f,d)=>{let m=f.map(_=>s(t.styleSubcommandTerm(t.subcommandTerm(_)),t.styleSubcommandDescription(t.subcommandDescription(_))));a=a.concat(this.formatItemList(d,m,t))}),a.join(`
`)}displayWidth(e){return C1(e).length}styleTitle(e){return e}styleUsage(e){return e.split(" ").map(t=>t==="[options]"?this.styleOptionText(t):t==="[command]"?this.styleSubcommandText(t):t[0]==="["||t[0]==="<"?this.styleArgumentText(t):this.styleCommandText(t)).join(" ")}styleCommandDescription(e){return this.styleDescriptionText(e)}styleOptionDescription(e){return this.styleDescriptionText(e)}styleSubcommandDescription(e){return this.styleDescriptionText(e)}styleArgumentDescription(e){return this.styleDescriptionText(e)}styleDescriptionText(e){return e}styleOptionTerm(e){return this.styleOptionText(e)}styleSubcommandTerm(e){return e.split(" ").map(t=>t==="[options]"?this.styleOptionText(t):t[0]==="["||t[0]==="<"?this.styleArgumentText(t):this.styleSubcommandText(t)).join(" ")}styleArgumentTerm(e){return this.styleArgumentText(e)}styleOptionText(e){return e}styleArgumentText(e){return e}styleSubcommandText(e){return e}styleCommandText(e){return e}padWidth(e,t){return Math.max(t.longestOptionTermLength(e,t),t.longestGlobalOptionTermLength(e,t),t.longestSubcommandTermLength(e,t),t.longestArgumentTermLength(e,t))}preformatted(e){return/\n[^\S\r\n]/.test(e)}formatItem(e,t,r,i){let a=" ".repeat(2);if(!r)return a+e;let c=e.padEnd(t+e.length-i.displayWidth(e)),u=2,h=(this.helpWidth??80)-t-u-2,f;return h<this.minWidthToWrap||i.preformatted(r)?f=r:f=i.boxWrap(r,h).replace(/\n/g,`
`+" ".repeat(t+u)),a+c+" ".repeat(u)+f.replace(/\n/g,`
${a}`)}boxWrap(e,t){if(t<this.minWidthToWrap)return e;let r=e.split(/\r\n|\n/),i=/[\s]*[^\s]+/g,s=[];return r.forEach(a=>{let c=a.match(i);if(c===null){s.push("");return}let u=[c.shift()],l=this.displayWidth(u[0]);c.forEach(h=>{let f=this.displayWidth(h);if(l+f<=t){u.push(h),l+=f;return}s.push(u.join(""));let d=h.trimStart();u=[d],l=this.displayWidth(d)}),s.push(u.join(""))}),s.join(`
`)}};function C1(n){let e=/\x1b\[\d*(;\d*)*m/g;return n.replace(e,"")}o(C1,"stripColor");ed.Help=Zf;ed.stripColor=C1});var sd=y(id=>{var{InvalidArgumentError:vT}=Ro(),rd=class{static{o(this,"Option")}constructor(e,t){this.flags=e,this.description=t||"",this.required=e.includes("<"),this.optional=e.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(e),this.mandatory=!1;let r=wT(e);this.short=r.shortFlag,this.long=r.longFlag,this.negate=!1,this.long&&(this.negate=this.long.startsWith("--no-")),this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0,this.helpGroupHeading=void 0}default(e,t){return this.defaultValue=e,this.defaultValueDescription=t,this}preset(e){return this.presetArg=e,this}conflicts(e){return this.conflictsWith=this.conflictsWith.concat(e),this}implies(e){let t=e;return typeof e=="string"&&(t={[e]:!0}),this.implied=Object.assign(this.implied||{},t),this}env(e){return this.envVar=e,this}argParser(e){return this.parseArg=e,this}makeOptionMandatory(e=!0){return this.mandatory=!!e,this}hideHelp(e=!0){return this.hidden=!!e,this}_collectValue(e,t){return t===this.defaultValue||!Array.isArray(t)?[e]:(t.push(e),t)}choices(e){return this.argChoices=e.slice(),this.parseArg=(t,r)=>{if(!this.argChoices.includes(t))throw new vT(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._collectValue(t,r):t},this}name(){return this.long?this.long.replace(/^--/,""):this.short.replace(/^-/,"")}attributeName(){return this.negate?x1(this.name().replace(/^no-/,"")):x1(this.name())}helpGroup(e){return this.helpGroupHeading=e,this}is(e){return this.short===e||this.long===e}isBoolean(){return!this.required&&!this.optional&&!this.negate}},nd=class{static{o(this,"DualOptions")}constructor(e){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,e.forEach(t=>{t.negate?this.negativeOptions.set(t.attributeName(),t):this.positiveOptions.set(t.attributeName(),t)}),this.negativeOptions.forEach((t,r)=>{this.positiveOptions.has(r)&&this.dualOptions.add(r)})}valueFromOption(e,t){let r=t.attributeName();if(!this.dualOptions.has(r))return!0;let i=this.negativeOptions.get(r).presetArg,s=i!==void 0?i:!1;return t.negate===(s===e)}};function x1(n){return n.split("-").reduce((e,t)=>e+t[0].toUpperCase()+t.slice(1))}o(x1,"camelcase");function wT(n){let e,t,r=/^-[^-]$/,i=/^--[^-]/,s=n.split(/[ |,]+/).concat("guard");if(r.test(s[0])&&(e=s.shift()),i.test(s[0])&&(t=s.shift()),!e&&r.test(s[0])&&(e=s.shift()),!e&&i.test(s[0])&&(e=t,t=s.shift()),s[0].startsWith("-")){let a=s[0],c=`option creation failed due to '${a}' in option flags '${n}'`;throw/^-[^-][^-]/.test(a)?new Error(`${c}
- a short flag is a single dash and a single character
  - either use a single dash and a single character (for a short flag)
  - or use a double dash for a long option (and can have two, like '--ws, --workspace')`):r.test(a)?new Error(`${c}
- too many short flags`):i.test(a)?new Error(`${c}
- too many long flags`):new Error(`${c}
- unrecognised flag format`)}if(e===void 0&&t===void 0)throw new Error(`option creation failed due to no flags found in '${n}'.`);return{shortFlag:e,longFlag:t}}o(wT,"splitOptionFlags");id.Option=rd;id.DualOptions=nd});var O1=y(I1=>{function _T(n,e){if(Math.abs(n.length-e.length)>3)return Math.max(n.length,e.length);let t=[];for(let r=0;r<=n.length;r++)t[r]=[r];for(let r=0;r<=e.length;r++)t[0][r]=r;for(let r=1;r<=e.length;r++)for(let i=1;i<=n.length;i++){let s=1;n[i-1]===e[r-1]?s=0:s=1,t[i][r]=Math.min(t[i-1][r]+1,t[i][r-1]+1,t[i-1][r-1]+s),i>1&&r>1&&n[i-1]===e[r-2]&&n[i-2]===e[r-1]&&(t[i][r]=Math.min(t[i][r],t[i-2][r-2]+1))}return t[n.length][e.length]}o(_T,"editDistance");function ST(n,e){if(!e||e.length===0)return"";e=Array.from(new Set(e));let t=n.startsWith("--");t&&(n=n.slice(2),e=e.map(a=>a.slice(2)));let r=[],i=3,s=.4;return e.forEach(a=>{if(a.length<=1)return;let c=_T(n,a),u=Math.max(n.length,a.length);(u-c)/u>s&&(c<i?(i=c,r=[a]):c===i&&r.push(a))}),r.sort((a,c)=>a.localeCompare(c)),t&&(r=r.map(a=>`--${a}`)),r.length>1?`
(Did you mean one of ${r.join(", ")}?)`:r.length===1?`
(Did you mean ${r[0]}?)`:""}o(ST,"suggestSimilar");I1.suggestSimilar=ST});var R1=y(ld=>{var bT=require("node:events").EventEmitter,ad=require("node:child_process"),ci=require("node:path"),wu=require("node:fs"),Be=require("node:process"),{Argument:ET,humanReadableArgName:TT}=vu(),{CommanderError:od}=Ro(),{Help:AT,stripColor:CT}=td(),{Option:D1,DualOptions:xT}=sd(),{suggestSimilar:P1}=O1(),cd=class n extends bT{static{o(this,"Command")}constructor(e){super(),this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!1,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=e||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._savedState=null,this._outputConfiguration={writeOut:o(t=>Be.stdout.write(t),"writeOut"),writeErr:o(t=>Be.stderr.write(t),"writeErr"),outputError:o((t,r)=>r(t),"outputError"),getOutHelpWidth:o(()=>Be.stdout.isTTY?Be.stdout.columns:void 0,"getOutHelpWidth"),getErrHelpWidth:o(()=>Be.stderr.isTTY?Be.stderr.columns:void 0,"getErrHelpWidth"),getOutHasColors:o(()=>ud()??(Be.stdout.isTTY&&Be.stdout.hasColors?.()),"getOutHasColors"),getErrHasColors:o(()=>ud()??(Be.stderr.isTTY&&Be.stderr.hasColors?.()),"getErrHasColors"),stripColor:o(t=>CT(t),"stripColor")},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={},this._helpGroupHeading=void 0,this._defaultCommandGroup=void 0,this._defaultOptionGroup=void 0}copyInheritedSettings(e){return this._outputConfiguration=e._outputConfiguration,this._helpOption=e._helpOption,this._helpCommand=e._helpCommand,this._helpConfiguration=e._helpConfiguration,this._exitCallback=e._exitCallback,this._storeOptionsAsProperties=e._storeOptionsAsProperties,this._combineFlagAndOptionalValue=e._combineFlagAndOptionalValue,this._allowExcessArguments=e._allowExcessArguments,this._enablePositionalOptions=e._enablePositionalOptions,this._showHelpAfterError=e._showHelpAfterError,this._showSuggestionAfterError=e._showSuggestionAfterError,this}_getCommandAndAncestors(){let e=[];for(let t=this;t;t=t.parent)e.push(t);return e}command(e,t,r){let i=t,s=r;typeof i=="object"&&i!==null&&(s=i,i=null),s=s||{};let[,a,c]=e.match(/([^ ]+) *(.*)/),u=this.createCommand(a);return i&&(u.description(i),u._executableHandler=!0),s.isDefault&&(this._defaultCommandName=u._name),u._hidden=!!(s.noHelp||s.hidden),u._executableFile=s.executableFile||null,c&&u.arguments(c),this._registerCommand(u),u.parent=this,u.copyInheritedSettings(this),i?this:u}createCommand(e){return new n(e)}createHelp(){return Object.assign(new AT,this.configureHelp())}configureHelp(e){return e===void 0?this._helpConfiguration:(this._helpConfiguration=e,this)}configureOutput(e){return e===void 0?this._outputConfiguration:(this._outputConfiguration={...this._outputConfiguration,...e},this)}showHelpAfterError(e=!0){return typeof e!="string"&&(e=!!e),this._showHelpAfterError=e,this}showSuggestionAfterError(e=!0){return this._showSuggestionAfterError=!!e,this}addCommand(e,t){if(!e._name)throw new Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);return t=t||{},t.isDefault&&(this._defaultCommandName=e._name),(t.noHelp||t.hidden)&&(e._hidden=!0),this._registerCommand(e),e.parent=this,e._checkForBrokenPassThrough(),this}createArgument(e,t){return new ET(e,t)}argument(e,t,r,i){let s=this.createArgument(e,t);return typeof r=="function"?s.default(i).argParser(r):s.default(r),this.addArgument(s),this}arguments(e){return e.trim().split(/ +/).forEach(t=>{this.argument(t)}),this}addArgument(e){let t=this.registeredArguments.slice(-1)[0];if(t?.variadic)throw new Error(`only the last argument can be variadic '${t.name()}'`);if(e.required&&e.defaultValue!==void 0&&e.parseArg===void 0)throw new Error(`a default value for a required argument is never used: '${e.name()}'`);return this.registeredArguments.push(e),this}helpCommand(e,t){if(typeof e=="boolean")return this._addImplicitHelpCommand=e,e&&this._defaultCommandGroup&&this._initCommandGroup(this._getHelpCommand()),this;let r=e??"help [command]",[,i,s]=r.match(/([^ ]+) *(.*)/),a=t??"display help for command",c=this.createCommand(i);return c.helpOption(!1),s&&c.arguments(s),a&&c.description(a),this._addImplicitHelpCommand=!0,this._helpCommand=c,(e||t)&&this._initCommandGroup(c),this}addHelpCommand(e,t){return typeof e!="object"?(this.helpCommand(e,t),this):(this._addImplicitHelpCommand=!0,this._helpCommand=e,this._initCommandGroup(e),this)}_getHelpCommand(){return this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))?(this._helpCommand===void 0&&this.helpCommand(void 0,void 0),this._helpCommand):null}hook(e,t){let r=["preSubcommand","preAction","postAction"];if(!r.includes(e))throw new Error(`Unexpected value for event passed to hook : '${e}'.
Expecting one of '${r.join("', '")}'`);return this._lifeCycleHooks[e]?this._lifeCycleHooks[e].push(t):this._lifeCycleHooks[e]=[t],this}exitOverride(e){return e?this._exitCallback=e:this._exitCallback=t=>{if(t.code!=="commander.executeSubCommandAsync")throw t},this}_exit(e,t,r){this._exitCallback&&this._exitCallback(new od(e,t,r)),Be.exit(e)}action(e){let t=o(r=>{let i=this.registeredArguments.length,s=r.slice(0,i);return this._storeOptionsAsProperties?s[i]=this:s[i]=this.opts(),s.push(this),e.apply(this,s)},"listener");return this._actionHandler=t,this}createOption(e,t){return new D1(e,t)}_callParseArg(e,t,r,i){try{return e.parseArg(t,r)}catch(s){if(s.code==="commander.invalidArgument"){let a=`${i} ${s.message}`;this.error(a,{exitCode:s.exitCode,code:s.code})}throw s}}_registerOption(e){let t=e.short&&this._findOption(e.short)||e.long&&this._findOption(e.long);if(t){let r=e.long&&this._findOption(e.long)?e.long:e.short;throw new Error(`Cannot add option '${e.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${r}'
-  already used by option '${t.flags}'`)}this._initOptionGroup(e),this.options.push(e)}_registerCommand(e){let t=o(i=>[i.name()].concat(i.aliases()),"knownBy"),r=t(e).find(i=>this._findCommand(i));if(r){let i=t(this._findCommand(r)).join("|"),s=t(e).join("|");throw new Error(`cannot add command '${s}' as already have command '${i}'`)}this._initCommandGroup(e),this.commands.push(e)}addOption(e){this._registerOption(e);let t=e.name(),r=e.attributeName();if(e.negate){let s=e.long.replace(/^--no-/,"--");this._findOption(s)||this.setOptionValueWithSource(r,e.defaultValue===void 0?!0:e.defaultValue,"default")}else e.defaultValue!==void 0&&this.setOptionValueWithSource(r,e.defaultValue,"default");let i=o((s,a,c)=>{s==null&&e.presetArg!==void 0&&(s=e.presetArg);let u=this.getOptionValue(r);s!==null&&e.parseArg?s=this._callParseArg(e,s,u,a):s!==null&&e.variadic&&(s=e._collectValue(s,u)),s==null&&(e.negate?s=!1:e.isBoolean()||e.optional?s=!0:s=""),this.setOptionValueWithSource(r,s,c)},"handleOptionValue");return this.on("option:"+t,s=>{let a=`error: option '${e.flags}' argument '${s}' is invalid.`;i(s,a,"cli")}),e.envVar&&this.on("optionEnv:"+t,s=>{let a=`error: option '${e.flags}' value '${s}' from env '${e.envVar}' is invalid.`;i(s,a,"env")}),this}_optionEx(e,t,r,i,s){if(typeof t=="object"&&t instanceof D1)throw new Error("To add an Option object use addOption() instead of option() or requiredOption()");let a=this.createOption(t,r);if(a.makeOptionMandatory(!!e.mandatory),typeof i=="function")a.default(s).argParser(i);else if(i instanceof RegExp){let c=i;i=o((u,l)=>{let h=c.exec(u);return h?h[0]:l},"fn"),a.default(s).argParser(i)}else a.default(i);return this.addOption(a)}option(e,t,r,i){return this._optionEx({},e,t,r,i)}requiredOption(e,t,r,i){return this._optionEx({mandatory:!0},e,t,r,i)}combineFlagAndOptionalValue(e=!0){return this._combineFlagAndOptionalValue=!!e,this}allowUnknownOption(e=!0){return this._allowUnknownOption=!!e,this}allowExcessArguments(e=!0){return this._allowExcessArguments=!!e,this}enablePositionalOptions(e=!0){return this._enablePositionalOptions=!!e,this}passThroughOptions(e=!0){return this._passThroughOptions=!!e,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw new Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(e=!0){if(this.options.length)throw new Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw new Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!e,this}getOptionValue(e){return this._storeOptionsAsProperties?this[e]:this._optionValues[e]}setOptionValue(e,t){return this.setOptionValueWithSource(e,t,void 0)}setOptionValueWithSource(e,t,r){return this._storeOptionsAsProperties?this[e]=t:this._optionValues[e]=t,this._optionValueSources[e]=r,this}getOptionValueSource(e){return this._optionValueSources[e]}getOptionValueSourceWithGlobals(e){let t;return this._getCommandAndAncestors().forEach(r=>{r.getOptionValueSource(e)!==void 0&&(t=r.getOptionValueSource(e))}),t}_prepareUserArgs(e,t){if(e!==void 0&&!Array.isArray(e))throw new Error("first parameter to parse must be array or undefined");if(t=t||{},e===void 0&&t.from===void 0){Be.versions?.electron&&(t.from="electron");let i=Be.execArgv??[];(i.includes("-e")||i.includes("--eval")||i.includes("-p")||i.includes("--print"))&&(t.from="eval")}e===void 0&&(e=Be.argv),this.rawArgs=e.slice();let r;switch(t.from){case void 0:case"node":this._scriptPath=e[1],r=e.slice(2);break;case"electron":Be.defaultApp?(this._scriptPath=e[1],r=e.slice(2)):r=e.slice(1);break;case"user":r=e.slice(0);break;case"eval":r=e.slice(1);break;default:throw new Error(`unexpected parse option { from: '${t.from}' }`)}return!this._name&&this._scriptPath&&this.nameFromFilename(this._scriptPath),this._name=this._name||"program",r}parse(e,t){this._prepareForParse();let r=this._prepareUserArgs(e,t);return this._parseCommand([],r),this}async parseAsync(e,t){this._prepareForParse();let r=this._prepareUserArgs(e,t);return await this._parseCommand([],r),this}_prepareForParse(){this._savedState===null?this.saveStateBeforeParse():this.restoreStateBeforeParse()}saveStateBeforeParse(){this._savedState={_name:this._name,_optionValues:{...this._optionValues},_optionValueSources:{...this._optionValueSources}}}restoreStateBeforeParse(){if(this._storeOptionsAsProperties)throw new Error(`Can not call parse again when storeOptionsAsProperties is true.
- either make a new Command for each call to parse, or stop storing options as properties`);this._name=this._savedState._name,this._scriptPath=null,this.rawArgs=[],this._optionValues={...this._savedState._optionValues},this._optionValueSources={...this._savedState._optionValueSources},this.args=[],this.processedArgs=[]}_checkForMissingExecutable(e,t,r){if(wu.existsSync(e))return;let i=t?`searched for local subcommand relative to directory '${t}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",s=`'${e}' does not exist
 - if '${r}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${i}`;throw new Error(s)}_executeSubCommand(e,t){t=t.slice();let r=!1,i=[".js",".ts",".tsx",".mjs",".cjs"];function s(h,f){let d=ci.resolve(h,f);if(wu.existsSync(d))return d;if(i.includes(ci.extname(f)))return;let m=i.find(_=>wu.existsSync(`${d}${_}`));if(m)return`${d}${m}`}o(s,"findFile"),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let a=e._executableFile||`${this._name}-${e._name}`,c=this._executableDir||"";if(this._scriptPath){let h;try{h=wu.realpathSync(this._scriptPath)}catch{h=this._scriptPath}c=ci.resolve(ci.dirname(h),c)}if(c){let h=s(c,a);if(!h&&!e._executableFile&&this._scriptPath){let f=ci.basename(this._scriptPath,ci.extname(this._scriptPath));f!==this._name&&(h=s(c,`${f}-${e._name}`))}a=h||a}r=i.includes(ci.extname(a));let u;Be.platform!=="win32"?r?(t.unshift(a),t=F1(Be.execArgv).concat(t),u=ad.spawn(Be.argv[0],t,{stdio:"inherit"})):u=ad.spawn(a,t,{stdio:"inherit"}):(this._checkForMissingExecutable(a,c,e._name),t.unshift(a),t=F1(Be.execArgv).concat(t),u=ad.spawn(Be.execPath,t,{stdio:"inherit"})),u.killed||["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach(f=>{Be.on(f,()=>{u.killed===!1&&u.exitCode===null&&u.kill(f)})});let l=this._exitCallback;u.on("close",h=>{h=h??1,l?l(new od(h,"commander.executeSubCommandAsync","(close)")):Be.exit(h)}),u.on("error",h=>{if(h.code==="ENOENT")this._checkForMissingExecutable(a,c,e._name);else if(h.code==="EACCES")throw new Error(`'${a}' not executable`);if(!l)Be.exit(1);else{let f=new od(1,"commander.executeSubCommandAsync","(error)");f.nestedError=h,l(f)}}),this.runningCommand=u}_dispatchSubcommand(e,t,r){let i=this._findCommand(e);i||this.help({error:!0}),i._prepareForParse();let s;return s=this._chainOrCallSubCommandHook(s,i,"preSubcommand"),s=this._chainOrCall(s,()=>{if(i._executableHandler)this._executeSubCommand(i,t.concat(r));else return i._parseCommand(t,r)}),s}_dispatchHelpCommand(e){e||this.help();let t=this._findCommand(e);return t&&!t._executableHandler&&t.help(),this._dispatchSubcommand(e,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){this.registeredArguments.forEach((e,t)=>{e.required&&this.args[t]==null&&this.missingArgument(e.name())}),!(this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)&&this.args.length>this.registeredArguments.length&&this._excessArguments(this.args)}_processArguments(){let e=o((r,i,s)=>{let a=i;if(i!==null&&r.parseArg){let c=`error: command-argument value '${i}' is invalid for argument '${r.name()}'.`;a=this._callParseArg(r,i,s,c)}return a},"myParseArg");this._checkNumberOfArguments();let t=[];this.registeredArguments.forEach((r,i)=>{let s=r.defaultValue;r.variadic?i<this.args.length?(s=this.args.slice(i),r.parseArg&&(s=s.reduce((a,c)=>e(r,c,a),r.defaultValue))):s===void 0&&(s=[]):i<this.args.length&&(s=this.args[i],r.parseArg&&(s=e(r,s,r.defaultValue))),t[i]=s}),this.processedArgs=t}_chainOrCall(e,t){return e?.then&&typeof e.then=="function"?e.then(()=>t()):t()}_chainOrCallHooks(e,t){let r=e,i=[];return this._getCommandAndAncestors().reverse().filter(s=>s._lifeCycleHooks[t]!==void 0).forEach(s=>{s._lifeCycleHooks[t].forEach(a=>{i.push({hookedCommand:s,callback:a})})}),t==="postAction"&&i.reverse(),i.forEach(s=>{r=this._chainOrCall(r,()=>s.callback(s.hookedCommand,this))}),r}_chainOrCallSubCommandHook(e,t,r){let i=e;return this._lifeCycleHooks[r]!==void 0&&this._lifeCycleHooks[r].forEach(s=>{i=this._chainOrCall(i,()=>s(this,t))}),i}_parseCommand(e,t){let r=this.parseOptions(t);if(this._parseOptionsEnv(),this._parseOptionsImplied(),e=e.concat(r.operands),t=r.unknown,this.args=e.concat(t),e&&this._findCommand(e[0]))return this._dispatchSubcommand(e[0],e.slice(1),t);if(this._getHelpCommand()&&e[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(e[1]);if(this._defaultCommandName)return this._outputHelpIfRequested(t),this._dispatchSubcommand(this._defaultCommandName,e,t);this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName&&this.help({error:!0}),this._outputHelpIfRequested(r.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let i=o(()=>{r.unknown.length>0&&this.unknownOption(r.unknown[0])},"checkForUnknownOptions"),s=`command:${this.name()}`;if(this._actionHandler){i(),this._processArguments();let a;return a=this._chainOrCallHooks(a,"preAction"),a=this._chainOrCall(a,()=>this._actionHandler(this.processedArgs)),this.parent&&(a=this._chainOrCall(a,()=>{this.parent.emit(s,e,t)})),a=this._chainOrCallHooks(a,"postAction"),a}if(this.parent?.listenerCount(s))i(),this._processArguments(),this.parent.emit(s,e,t);else if(e.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",e,t);this.listenerCount("command:*")?this.emit("command:*",e,t):this.commands.length?this.unknownCommand():(i(),this._processArguments())}else this.commands.length?(i(),this.help({error:!0})):(i(),this._processArguments())}_findCommand(e){if(e)return this.commands.find(t=>t._name===e||t._aliases.includes(e))}_findOption(e){return this.options.find(t=>t.is(e))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach(e=>{e.options.forEach(t=>{t.mandatory&&e.getOptionValue(t.attributeName())===void 0&&e.missingMandatoryOptionValue(t)})})}_checkForConflictingLocalOptions(){let e=this.options.filter(r=>{let i=r.attributeName();return this.getOptionValue(i)===void 0?!1:this.getOptionValueSource(i)!=="default"});e.filter(r=>r.conflictsWith.length>0).forEach(r=>{let i=e.find(s=>r.conflictsWith.includes(s.attributeName()));i&&this._conflictingOption(r,i)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach(e=>{e._checkForConflictingLocalOptions()})}parseOptions(e){let t=[],r=[],i=t;function s(h){return h.length>1&&h[0]==="-"}o(s,"maybeOption");let a=o(h=>/^-(\d+|\d*\.\d+)(e[+-]?\d+)?$/.test(h)?!this._getCommandAndAncestors().some(f=>f.options.map(d=>d.short).some(d=>/^-\d$/.test(d))):!1,"negativeNumberArg"),c=null,u=null,l=0;for(;l<e.length||u;){let h=u??e[l++];if(u=null,h==="--"){i===r&&i.push(h),i.push(...e.slice(l));break}if(c&&(!s(h)||a(h))){this.emit(`option:${c.name()}`,h);continue}if(c=null,s(h)){let f=this._findOption(h);if(f){if(f.required){let d=e[l++];d===void 0&&this.optionMissingArgument(f),this.emit(`option:${f.name()}`,d)}else if(f.optional){let d=null;l<e.length&&(!s(e[l])||a(e[l]))&&(d=e[l++]),this.emit(`option:${f.name()}`,d)}else this.emit(`option:${f.name()}`);c=f.variadic?f:null;continue}}if(h.length>2&&h[0]==="-"&&h[1]!=="-"){let f=this._findOption(`-${h[1]}`);if(f){f.required||f.optional&&this._combineFlagAndOptionalValue?this.emit(`option:${f.name()}`,h.slice(2)):(this.emit(`option:${f.name()}`),u=`-${h.slice(2)}`);continue}}if(/^--[^=]+=/.test(h)){let f=h.indexOf("="),d=this._findOption(h.slice(0,f));if(d&&(d.required||d.optional)){this.emit(`option:${d.name()}`,h.slice(f+1));continue}}if(i===t&&s(h)&&!(this.commands.length===0&&a(h))&&(i=r),(this._enablePositionalOptions||this._passThroughOptions)&&t.length===0&&r.length===0){if(this._findCommand(h)){t.push(h),r.push(...e.slice(l));break}else if(this._getHelpCommand()&&h===this._getHelpCommand().name()){t.push(h,...e.slice(l));break}else if(this._defaultCommandName){r.push(h,...e.slice(l));break}}if(this._passThroughOptions){i.push(h,...e.slice(l));break}i.push(h)}return{operands:t,unknown:r}}opts(){if(this._storeOptionsAsProperties){let e={},t=this.options.length;for(let r=0;r<t;r++){let i=this.options[r].attributeName();e[i]=i===this._versionOptionName?this._version:this[i]}return e}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((e,t)=>Object.assign(e,t.opts()),{})}error(e,t){this._outputConfiguration.outputError(`${e}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError=="string"?this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`):this._showHelpAfterError&&(this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0}));let r=t||{},i=r.exitCode||1,s=r.code||"commander.error";this._exit(i,s,e)}_parseOptionsEnv(){this.options.forEach(e=>{if(e.envVar&&e.envVar in Be.env){let t=e.attributeName();(this.getOptionValue(t)===void 0||["default","config","env"].includes(this.getOptionValueSource(t)))&&(e.required||e.optional?this.emit(`optionEnv:${e.name()}`,Be.env[e.envVar]):this.emit(`optionEnv:${e.name()}`))}})}_parseOptionsImplied(){let e=new xT(this.options),t=o(r=>this.getOptionValue(r)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(r)),"hasCustomOptionValue");this.options.filter(r=>r.implied!==void 0&&t(r.attributeName())&&e.valueFromOption(this.getOptionValue(r.attributeName()),r)).forEach(r=>{Object.keys(r.implied).filter(i=>!t(i)).forEach(i=>{this.setOptionValueWithSource(i,r.implied[i],"implied")})})}missingArgument(e){let t=`error: missing required argument '${e}'`;this.error(t,{code:"commander.missingArgument"})}optionMissingArgument(e){let t=`error: option '${e.flags}' argument missing`;this.error(t,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(e){let t=`error: required option '${e.flags}' not specified`;this.error(t,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(e,t){let r=o(a=>{let c=a.attributeName(),u=this.getOptionValue(c),l=this.options.find(f=>f.negate&&c===f.attributeName()),h=this.options.find(f=>!f.negate&&c===f.attributeName());return l&&(l.presetArg===void 0&&u===!1||l.presetArg!==void 0&&u===l.presetArg)?l:h||a},"findBestOptionFromValue"),i=o(a=>{let c=r(a),u=c.attributeName();return this.getOptionValueSource(u)==="env"?`environment variable '${c.envVar}'`:`option '${c.flags}'`},"getErrorMessage"),s=`error: ${i(e)} cannot be used with ${i(t)}`;this.error(s,{code:"commander.conflictingOption"})}unknownOption(e){if(this._allowUnknownOption)return;let t="";if(e.startsWith("--")&&this._showSuggestionAfterError){let i=[],s=this;do{let a=s.createHelp().visibleOptions(s).filter(c=>c.long).map(c=>c.long);i=i.concat(a),s=s.parent}while(s&&!s._enablePositionalOptions);t=P1(e,i)}let r=`error: unknown option '${e}'${t}`;this.error(r,{code:"commander.unknownOption"})}_excessArguments(e){if(this._allowExcessArguments)return;let t=this.registeredArguments.length,r=t===1?"":"s",s=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${t} argument${r} but got ${e.length}.`;this.error(s,{code:"commander.excessArguments"})}unknownCommand(){let e=this.args[0],t="";if(this._showSuggestionAfterError){let i=[];this.createHelp().visibleCommands(this).forEach(s=>{i.push(s.name()),s.alias()&&i.push(s.alias())}),t=P1(e,i)}let r=`error: unknown command '${e}'${t}`;this.error(r,{code:"commander.unknownCommand"})}version(e,t,r){if(e===void 0)return this._version;this._version=e,t=t||"-V, --version",r=r||"output the version number";let i=this.createOption(t,r);return this._versionOptionName=i.attributeName(),this._registerOption(i),this.on("option:"+i.name(),()=>{this._outputConfiguration.writeOut(`${e}
`),this._exit(0,"commander.version",e)}),this}description(e,t){return e===void 0&&t===void 0?this._description:(this._description=e,t&&(this._argsDescription=t),this)}summary(e){return e===void 0?this._summary:(this._summary=e,this)}alias(e){if(e===void 0)return this._aliases[0];let t=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler&&(t=this.commands[this.commands.length-1]),e===t._name)throw new Error("Command alias can't be the same as its name");let r=this.parent?._findCommand(e);if(r){let i=[r.name()].concat(r.aliases()).join("|");throw new Error(`cannot add alias '${e}' to command '${this.name()}' as already have command '${i}'`)}return t._aliases.push(e),this}aliases(e){return e===void 0?this._aliases:(e.forEach(t=>this.alias(t)),this)}usage(e){if(e===void 0){if(this._usage)return this._usage;let t=this.registeredArguments.map(r=>TT(r));return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?t:[]).join(" ")}return this._usage=e,this}name(e){return e===void 0?this._name:(this._name=e,this)}helpGroup(e){return e===void 0?this._helpGroupHeading??"":(this._helpGroupHeading=e,this)}commandsGroup(e){return e===void 0?this._defaultCommandGroup??"":(this._defaultCommandGroup=e,this)}optionsGroup(e){return e===void 0?this._defaultOptionGroup??"":(this._defaultOptionGroup=e,this)}_initOptionGroup(e){this._defaultOptionGroup&&!e.helpGroupHeading&&e.helpGroup(this._defaultOptionGroup)}_initCommandGroup(e){this._defaultCommandGroup&&!e.helpGroup()&&e.helpGroup(this._defaultCommandGroup)}nameFromFilename(e){return this._name=ci.basename(e,ci.extname(e)),this}executableDir(e){return e===void 0?this._executableDir:(this._executableDir=e,this)}helpInformation(e){let t=this.createHelp(),r=this._getOutputContext(e);t.prepareContext({error:r.error,helpWidth:r.helpWidth,outputHasColors:r.hasColors});let i=t.formatHelp(this,t);return r.hasColors?i:this._outputConfiguration.stripColor(i)}_getOutputContext(e){e=e||{};let t=!!e.error,r,i,s;return t?(r=o(c=>this._outputConfiguration.writeErr(c),"baseWrite"),i=this._outputConfiguration.getErrHasColors(),s=this._outputConfiguration.getErrHelpWidth()):(r=o(c=>this._outputConfiguration.writeOut(c),"baseWrite"),i=this._outputConfiguration.getOutHasColors(),s=this._outputConfiguration.getOutHelpWidth()),{error:t,write:o(c=>(i||(c=this._outputConfiguration.stripColor(c)),r(c)),"write"),hasColors:i,helpWidth:s}}outputHelp(e){let t;typeof e=="function"&&(t=e,e=void 0);let r=this._getOutputContext(e),i={error:r.error,write:r.write,command:this};this._getCommandAndAncestors().reverse().forEach(a=>a.emit("beforeAllHelp",i)),this.emit("beforeHelp",i);let s=this.helpInformation({error:r.error});if(t&&(s=t(s),typeof s!="string"&&!Buffer.isBuffer(s)))throw new Error("outputHelp callback must return a string or a Buffer");r.write(s),this._getHelpOption()?.long&&this.emit(this._getHelpOption().long),this.emit("afterHelp",i),this._getCommandAndAncestors().forEach(a=>a.emit("afterAllHelp",i))}helpOption(e,t){return typeof e=="boolean"?(e?(this._helpOption===null&&(this._helpOption=void 0),this._defaultOptionGroup&&this._initOptionGroup(this._getHelpOption())):this._helpOption=null,this):(this._helpOption=this.createOption(e??"-h, --help",t??"display help for command"),(e||t)&&this._initOptionGroup(this._helpOption),this)}_getHelpOption(){return this._helpOption===void 0&&this.helpOption(void 0,void 0),this._helpOption}addHelpOption(e){return this._helpOption=e,this._initOptionGroup(e),this}help(e){this.outputHelp(e);let t=Number(Be.exitCode??0);t===0&&e&&typeof e!="function"&&e.error&&(t=1),this._exit(t,"commander.help","(outputHelp)")}addHelpText(e,t){let r=["beforeAll","before","after","afterAll"];if(!r.includes(e))throw new Error(`Unexpected value for position to addHelpText.
Expecting one of '${r.join("', '")}'`);let i=`${e}Help`;return this.on(i,s=>{let a;typeof t=="function"?a=t({error:s.error,command:s.command}):a=t,a&&s.write(`${a}
`)}),this}_outputHelpIfRequested(e){let t=this._getHelpOption();t&&e.find(i=>t.is(i))&&(this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)"))}};function F1(n){return n.map(e=>{if(!e.startsWith("--inspect"))return e;let t,r="127.0.0.1",i="9229",s;return(s=e.match(/^(--inspect(-brk)?)$/))!==null?t=s[1]:(s=e.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null?(t=s[1],/^\d+$/.test(s[3])?i=s[3]:r=s[3]):(s=e.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null&&(t=s[1],r=s[3],i=s[4]),t&&i!=="0"?`${t}=${r}:${parseInt(i)+1}`:e})}o(F1,"incrementNodeInspectorPort");function ud(){if(Be.env.NO_COLOR||Be.env.FORCE_COLOR==="0"||Be.env.FORCE_COLOR==="false")return!1;if(Be.env.FORCE_COLOR||Be.env.CLICOLOR_FORCE!==void 0)return!0}o(ud,"useColor");ld.Command=cd;ld.useColor=ud});var j1=y($r=>{var{Argument:N1}=vu(),{Command:hd}=R1(),{CommanderError:IT,InvalidArgumentError:L1}=Ro(),{Help:OT}=td(),{Option:k1}=sd();$r.program=new hd;$r.createCommand=n=>new hd(n);$r.createOption=(n,e)=>new k1(n,e);$r.createArgument=(n,e)=>new N1(n,e);$r.Command=hd;$r.Option=k1;$r.Argument=N1;$r.Help=OT;$r.CommanderError=IT;$r.InvalidArgumentError=L1;$r.InvalidOptionArgumentError=L1});var fd=y(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.AssetClass=void 0;var V1;(function(n){n.AREA="ems__Area",n.TASK="ems__Task",n.PROJECT="ems__Project",n.MEETING="ems__Meeting",n.INITIATIVE="ems__Initiative",n.TASK_PROTOTYPE="ems__TaskPrototype",n.MEETING_PROTOTYPE="ems__MeetingPrototype",n.EVENT_PROTOTYPE="exo__EventPrototype",n.PROJECT_PROTOTYPE="ems__ProjectPrototype",n.EVENT="exo__Event",n.DAILY_NOTE="pn__DailyNote",n.CONCEPT="ims__Concept",n.SESSION_START_EVENT="ems__SessionStartEvent",n.SESSION_END_EVENT="ems__SessionEndEvent",n.PROTOTYPE="exo__Prototype",n.CLASS="exo__Class"})(V1||(_u.AssetClass=V1={}))});var dd=y(Su=>{"use strict";Object.defineProperty(Su,"__esModule",{value:!0});Su.EffortStatus=void 0;var $1;(function(n){n.DRAFT="ems__EffortStatusDraft",n.BACKLOG="ems__EffortStatusBacklog",n.ANALYSIS="ems__EffortStatusAnalysis",n.TODO="ems__EffortStatusToDo",n.DOING="ems__EffortStatusDoing",n.DONE="ems__EffortStatusDone",n.TRASHED="ems__EffortStatusTrashed"})($1||(Su.EffortStatus=$1={}))});var U1=y(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.hasPosition=DT;bu.isFixed=PT;function DT(n){return typeof n.x=="number"&&typeof n.y=="number"}o(DT,"hasPosition");function PT(n){return n.fx!==null&&n.fx!==void 0&&n.fy!==null&&n.fy!==void 0}o(PT,"isFixed")});var B1=y(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.createEmptyGraphData=FT;Eu.mergeGraphData=RT;function FT(){return{nodes:[],edges:[],lastUpdated:Date.now(),version:0}}o(FT,"createEmptyGraphData");function RT(n,e){let t=new Map,r=new Set,i=[];for(let s of n.nodes)t.set(s.id,s);for(let s of e.nodes)t.set(s.id,s);for(let s of n.edges){let a=`${s.source}->${s.target}:${s.type}`;r.has(a)||(r.add(a),i.push(s))}for(let s of e.edges){let a=`${s.source}->${s.target}:${s.type}`;r.has(a)||(r.add(a),i.push(s))}return{nodes:Array.from(t.values()),edges:i,lastUpdated:Date.now(),version:Math.max(n.version??0,e.version??0)+1}}o(RT,"mergeGraphData")});var pd=y(Tu=>{"use strict";Object.defineProperty(Tu,"__esModule",{value:!0});Tu.createEdgeId=NT;Tu.edgesEqual=LT;function NT(n,e,t,r){let i=r?`|${r}`:"";return`${n}->${e}:${t}${i}`}o(NT,"createEdgeId");function LT(n,e){return n.source===e.source&&n.target===e.target&&n.type===e.type&&n.predicate===e.predicate}o(LT,"edgesEqual")});var md=y(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.BUILT_IN_EDGE_STYLES=pt.BUILT_IN_NODE_STYLES=pt.DEFAULT_EDGE_STYLE=pt.DEFAULT_NODE_STYLE=pt.RDF_TYPE_PREDICATES=void 0;pt.mergeNodeStyles=kT;pt.mergeEdgeStyles=jT;pt.extractLocalName=MT;pt.isClassType=VT;pt.isTypePredicate=$T;pt.isSubClassPredicate=UT;pt.RDF_TYPE_PREDICATES={RDF_TYPE:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",RDFS_CLASS:"http://www.w3.org/2000/01/rdf-schema#Class",OWL_CLASS:"http://www.w3.org/2002/07/owl#Class",RDFS_SUBCLASS_OF:"http://www.w3.org/2000/01/rdf-schema#subClassOf",OWL_EQUIVALENT_CLASS:"http://www.w3.org/2002/07/owl#equivalentClass",RDFS_LABEL:"http://www.w3.org/2000/01/rdf-schema#label",RDFS_COMMENT:"http://www.w3.org/2000/01/rdf-schema#comment"};pt.DEFAULT_NODE_STYLE={color:"#6366f1",borderColor:"#4f46e5",borderWidth:2,size:30,shape:"circle",icon:"",opacity:1,shadow:!1,animation:"none"};pt.DEFAULT_EDGE_STYLE={color:"#9ca3af",width:1,lineStyle:"solid",arrow:"standard",curvature:0,opacity:.6,showLabel:!1,labelPosition:.5};pt.BUILT_IN_NODE_STYLES={"http://www.w3.org/2000/01/rdf-schema#Class":{color:"#f59e0b",shape:"diamond",size:40},"http://www.w3.org/2002/07/owl#Class":{color:"#f59e0b",shape:"diamond",size:40},ems__Task:{color:"#22c55e",shape:"circle"},ems__Project:{color:"#3b82f6",shape:"square"},ems__Area:{color:"#8b5cf6",shape:"hexagon",size:40},ems__Meeting:{color:"#ec4899",shape:"circle"},exo__Class:{color:"#f59e0b",shape:"diamond"},ims__Person:{color:"#06b6d4",shape:"circle"}};pt.BUILT_IN_EDGE_STYLES={"http://www.w3.org/1999/02/22-rdf-syntax-ns#type":{color:"#f59e0b",lineStyle:"dashed",arrow:"standard"},"http://www.w3.org/2000/01/rdf-schema#subClassOf":{color:"#8b5cf6",width:2,arrow:"triangle"},"https://exocortex.my/ontology/ems#Effort_parent":{color:"#6366f1",width:2,arrow:"standard"},"https://exocortex.my/ontology/exo#Asset_prototype":{color:"#f59e0b",lineStyle:"dashed",arrow:"circle"},"https://exocortex.my/ontology/exo#references":{color:"#22c55e",opacity:.4,arrow:"standard"}};function kT(n,e){return{...n,...Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}}o(kT,"mergeNodeStyles");function jT(n,e){return{...n,...Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}}o(jT,"mergeEdgeStyles");function MT(n){let e=n.lastIndexOf("#"),t=n.lastIndexOf("/"),r=Math.max(e,t);return r>=0?n.substring(r+1):n}o(MT,"extractLocalName");function VT(n){return n===pt.RDF_TYPE_PREDICATES.RDFS_CLASS||n===pt.RDF_TYPE_PREDICATES.OWL_CLASS}o(VT,"isClassType");function $T(n){return n===pt.RDF_TYPE_PREDICATES.RDF_TYPE}o($T,"isTypePredicate");function UT(n){return n===pt.RDF_TYPE_PREDICATES.RDFS_SUBCLASS_OF}o(UT,"isSubClassPredicate")});var G1=y(q1=>{"use strict";Object.defineProperty(q1,"__esModule",{value:!0})});var Ye=y(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.IRI=void 0;var gd=class n{static{o(this,"IRI")}constructor(e){let t=e.trim();if(t.length===0)throw new Error("IRI cannot be empty");if(!n.isValidIRI(t))throw new Error("Invalid IRI format");this._value=t}get value(){return this._value}equals(e){return this._value===e._value}toString(){return this._value}static isValidIRI(e){if(!e||e.trim().length===0||/\s/.test(e)||!/^[a-z][a-z0-9+.-]*:/i.test(e))return!1;let r=["http","https","ftp","ftps","file","mailto","tel","data","ws","wss","urn","obsidian"],i=e.match(/^([a-z][a-z0-9+.-]*?):/i);if(i){let s=i[1].toLowerCase();if(!r.includes(s))return!1}try{return new URL(e),!0}catch{return/^urn:[a-z0-9][a-z0-9-]{0,31}:[^\s]+$/i.test(e)}}};Au.IRI=gd});var lt=y(ms=>{"use strict";Object.defineProperty(ms,"__esModule",{value:!0});ms.Literal=void 0;ms.parseLanguageTag=W1;ms.createDirectionalLiteral=qT;ms.createLiteralFromLanguageTag=GT;var BT="http://www.w3.org/2001/XMLSchema#string",No=class{static{o(this,"Literal")}constructor(e,t,r,i){if(e.length===0)throw new Error("Literal value cannot be empty");if(t&&r)throw new Error("Literal cannot have both datatype and language tag");if(i&&!r)throw new Error("Literal cannot have direction without language tag");if(i&&i!=="ltr"&&i!=="rtl")throw new Error('Direction must be "ltr" or "rtl"');this._value=e,this._datatype=t,this._language=r?r.toLowerCase():void 0,this._direction=i}get value(){return this._value}get datatype(){return this._datatype}get language(){return this._language}get direction(){return this._direction}hasDirection(){return this._direction!==void 0}equals(e){if(this._value!==e._value||this._language!==e._language||this._direction!==e._direction)return!1;let t=this.normalizedDatatype(),r=e.normalizedDatatype();return t===r}normalizedDatatype(){return!this._datatype||this._datatype.value===BT?null:this._datatype.value}toString(){let e=`"${this._value}"`;return this._datatype?e+=`^^<${this._datatype.value}>`:this._language&&(e+=`@${this._language}`,this._direction&&(e+=`--${this._direction}`)),e}};ms.Literal=No;function W1(n){let t=n.lastIndexOf("--");if(t===-1)return{language:n.toLowerCase()};let r=n.substring(t+2),i=n.substring(0,t);return r==="ltr"||r==="rtl"?{language:i.toLowerCase(),direction:r}:{language:n.toLowerCase()}}o(W1,"parseLanguageTag");function qT(n,e,t){return new No(n,void 0,e,t)}o(qT,"createDirectionalLiteral");function GT(n,e){let{language:t,direction:r}=W1(e);return new No(n,void 0,t,r)}o(GT,"createLiteralFromLanguageTag")});var Mt=y(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});xu.BlankNode=void 0;var Cu=class n{static{o(this,"BlankNode")}constructor(e){let t=e.trim();if(t.length===0)throw new Error("BlankNode id cannot be empty");this._id=t}get id(){return this._id}equals(e){return this._id===e._id}toString(){return`_:${this._id}`}static generateId(){return`b${++n.counter}`}static create(){return new n(n.generateId())}};xu.BlankNode=Cu;Cu.counter=0});var Xr=y(Iu=>{"use strict";Object.defineProperty(Iu,"__esModule",{value:!0});Iu.Namespace=void 0;var z1=Ye(),ur=class{static{o(this,"Namespace")}constructor(e,t){if(e.trim().length===0)throw new Error("Namespace prefix cannot be empty");this._prefix=e,this._iri=new z1.IRI(t)}get prefix(){return this._prefix}get iri(){return this._iri}term(e){return new z1.IRI(`${this._iri.value}${e}`)}expand(e){let t=e.split(":");if(t.length!==2)return null;let[r,i]=t;return r!==this._prefix?null:this.term(i)}};Iu.Namespace=ur;ur.RDF=new ur("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#");ur.RDFS=new ur("rdfs","http://www.w3.org/2000/01/rdf-schema#");ur.OWL=new ur("owl","http://www.w3.org/2002/07/owl#");ur.XSD=new ur("xsd","http://www.w3.org/2001/XMLSchema#");ur.EXO=new ur("exo","https://exocortex.my/ontology/exo#");ur.EMS=new ur("ems","https://exocortex.my/ontology/ems#")});var Oi=y(Ou=>{"use strict";Object.defineProperty(Ou,"__esModule",{value:!0});Ou.Triple=void 0;var yd=Ye(),vd=lt(),wd=Mt(),_d=class{static{o(this,"Triple")}constructor(e,t,r){this._subject=e,this._predicate=t,this._object=r}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}equals(e){return!(!this.equalsNode(this._subject,e._subject)||!this._predicate.equals(e._predicate)||!this.equalsNode(this._object,e._object))}equalsNode(e,t){return e instanceof yd.IRI&&t instanceof yd.IRI||e instanceof wd.BlankNode&&t instanceof wd.BlankNode||e instanceof vd.Literal&&t instanceof vd.Literal||this.isQuotedTriple(e)&&this.isQuotedTriple(t)?e.equals(t):!1}isQuotedTriple(e){return typeof e=="object"&&e!==null&&"termType"in e&&e.termType==="QuotedTriple"}toString(){let e=this.nodeToString(this._subject),t=`<${this._predicate.value}>`,r=this.nodeToString(this._object);return`${e} ${t} ${r} .`}nodeToString(e){return e instanceof yd.IRI?`<${e.value}>`:e instanceof wd.BlankNode||e instanceof vd.Literal||this.isQuotedTriple(e)?e.toString():""}};Ou.Triple=_d});var Lo=y(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0});Du.QuotedTriple=void 0;var Sd=Ye(),bd=lt(),Ed=Mt(),Td=class n{static{o(this,"QuotedTriple")}constructor(e,t,r){this._subject=e,this._predicate=t,this._object=r}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}equals(e){return!(!this.equalsNode(this._subject,e._subject)||!this._predicate.equals(e._predicate)||!this.equalsNode(this._object,e._object))}equalsNode(e,t){return e instanceof Sd.IRI&&t instanceof Sd.IRI||e instanceof Ed.BlankNode&&t instanceof Ed.BlankNode||e instanceof bd.Literal&&t instanceof bd.Literal||e instanceof n&&t instanceof n?e.equals(t):!1}get termType(){return"QuotedTriple"}toString(){let e=this.nodeToString(this._subject),t=`<${this._predicate.value}>`,r=this.nodeToString(this._object);return`<< ${e} ${t} ${r} >>`}nodeToString(e){return e instanceof Sd.IRI?`<${e.value}>`:e instanceof Ed.BlankNode||e instanceof bd.Literal||e instanceof n?e.toString():""}};Du.QuotedTriple=Td});var H1=y(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.QuotedTriple=_t.Triple=_t.Namespace=_t.BlankNode=_t.createLiteralFromLanguageTag=_t.createDirectionalLiteral=_t.parseLanguageTag=_t.Literal=_t.IRI=void 0;var WT=Ye();Object.defineProperty(_t,"IRI",{enumerable:!0,get:o(function(){return WT.IRI},"get")});var Pu=lt();Object.defineProperty(_t,"Literal",{enumerable:!0,get:o(function(){return Pu.Literal},"get")});Object.defineProperty(_t,"parseLanguageTag",{enumerable:!0,get:o(function(){return Pu.parseLanguageTag},"get")});Object.defineProperty(_t,"createDirectionalLiteral",{enumerable:!0,get:o(function(){return Pu.createDirectionalLiteral},"get")});Object.defineProperty(_t,"createLiteralFromLanguageTag",{enumerable:!0,get:o(function(){return Pu.createLiteralFromLanguageTag},"get")});var zT=Mt();Object.defineProperty(_t,"BlankNode",{enumerable:!0,get:o(function(){return zT.BlankNode},"get")});var HT=Xr();Object.defineProperty(_t,"Namespace",{enumerable:!0,get:o(function(){return HT.Namespace},"get")});var YT=Oi();Object.defineProperty(_t,"Triple",{enumerable:!0,get:o(function(){return YT.Triple},"get")});var QT=Lo();Object.defineProperty(_t,"QuotedTriple",{enumerable:!0,get:o(function(){return QT.QuotedTriple},"get")})});var gs=y(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});Ru.WikiLinkHelpers=void 0;var Fu=class{static{o(this,"WikiLinkHelpers")}static normalize(e){return e?e.replace(this.WIKI_LINK_PATTERN,"").trim():""}static normalizeArray(e){return e?(Array.isArray(e)?e:[e]).map(r=>this.normalize(r)).filter(r=>r.length>0):[]}static equals(e,t){return this.normalize(e)===this.normalize(t)}static includes(e,t){let r=this.normalizeArray(e),i=this.normalize(t);return r.includes(i)}};Ru.WikiLinkHelpers=Fu;Fu.WIKI_LINK_PATTERN=/\[\[|\]\]/g});var Qt=y(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});la.EffortStatus=la.AssetClass=void 0;var KT=fd();Object.defineProperty(la,"AssetClass",{enumerable:!0,get:o(function(){return KT.AssetClass},"get")});var XT=dd();Object.defineProperty(la,"EffortStatus",{enumerable:!0,get:o(function(){return XT.EffortStatus},"get")})});var Di=y(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.hasClass=vs;Kt.isAreaOrProject=JT;Kt.isEffort=ZT;Kt.hasStatus=eA;Kt.isAssetArchived=tA;Kt.hasEmptyProperties=rA;Kt.needsFolderRepair=nA;Kt.getTodayDateString=Ad;Kt.isPlannedForToday=iA;Kt.hasPlannedStartTimestamp=sA;Kt.extractDailyNoteDate=aA;Kt.isCurrentDateGteDay=oA;Kt.inheritsFromPrototype=K1;Kt.isPrototypeClass=uA;var Q1=gs(),ys=Qt();function vs(n,e){return n?(Array.isArray(n)?n:[n]).some(r=>Q1.WikiLinkHelpers.normalize(r)===e):!1}o(vs,"hasClass");function JT(n){return vs(n,ys.AssetClass.AREA)||vs(n,ys.AssetClass.PROJECT)}o(JT,"isAreaOrProject");function ZT(n){return vs(n,ys.AssetClass.TASK)||vs(n,ys.AssetClass.PROJECT)||vs(n,ys.AssetClass.MEETING)}o(ZT,"isEffort");function eA(n,e){if(!n)return!1;let t=Array.isArray(n)?n[0]:n;return t?Q1.WikiLinkHelpers.normalize(t)===e:!1}o(eA,"hasStatus");function tA(n){if(n===!0||n===1)return!0;if(typeof n=="string"){let e=n.toLowerCase();return e==="true"||e==="yes"}return!1}o(tA,"isAssetArchived");function rA(n){return!n||Object.keys(n).length===0?!1:Object.values(n).some(e=>!!(e==null||typeof e=="string"&&e.trim()===""||Array.isArray(e)&&e.length===0||typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0))}o(rA,"hasEmptyProperties");function nA(n,e){if(!e)return!1;let t=n.replace(/\/$/,""),r=e.replace(/\/$/,"");return t!==r}o(nA,"needsFolderRepair");function Ad(){let n=new Date,e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}o(Ad,"getTodayDateString");function iA(n){let e=n.ems__Effort_plannedStartTimestamp;if(!e)return!1;let t=Ad();return typeof e=="string"?e.split("T")[0]===t:Array.isArray(e)&&e.length>0?String(e[0]).split("T")[0]===t:!1}o(iA,"isPlannedForToday");function sA(n){let e=n.ems__Effort_plannedStartTimestamp;return e?typeof e=="string"?e.trim().length>0:Array.isArray(e)&&e.length>0?String(e[0]).trim().length>0:!1:!1}o(sA,"hasPlannedStartTimestamp");function aA(n){let e=n.pn__DailyNote_day;if(!e)return null;if(typeof e=="string"){let t=e.match(/\[\[([^\[\]]+)\]\]/);return t?t[1]:e}if(Array.isArray(e)&&e.length>0){let t=String(e[0]),r=t.match(/\[\[([^\[\]]+)\]\]/);return r?r[1]:t}return null}o(aA,"extractDailyNoteDate");function oA(n){return Ad()>=n}o(oA,"isCurrentDateGteDay");function Y1(n){return n?n.replace(/^["']|["']$/g,"").replace(/\[\[|\]\]/g,"").trim():""}o(Y1,"normalizeWithQuotes");var cA=10;function K1(n,e=cA){let t=n.exo__Class_superClass;if(!t)return!1;let r=new Set,i=[],s=Array.isArray(t)?t:[t];for(let a of s){let c=Y1(a);c&&i.push({className:c,depth:0})}for(;i.length>0;){let a=i.shift();if(!a)continue;let{className:c,depth:u}=a;if(u>e)continue;if(c===ys.AssetClass.PROTOTYPE)return!0;if(r.has(c))continue;r.add(c);let l=`${c}__exo__Class_superClass`,h=n[l];if(h){let f=Array.isArray(h)?h:[h];for(let d of f){let m=Y1(d);m&&!r.has(m)&&i.push({className:m,depth:u+1})}}}return!1}o(K1,"inheritsFromPrototype");function uA(n,e){return vs(n,ys.AssetClass.CLASS)?K1(e):!1}o(uA,"isPrototypeClass")});var J1=y(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.canCreateTask=lA;ko.canCreateRelatedTask=hA;ko.canConvertTaskToProject=fA;var Nu=Di(),X1=Qt();function lA(n){return(0,Nu.isAreaOrProject)(n.instanceClass)}o(lA,"canCreateTask");function hA(n){return!(!(0,Nu.hasClass)(n.instanceClass,X1.AssetClass.TASK)||(0,Nu.isAssetArchived)(n.isArchived))}o(hA,"canCreateRelatedTask");function fA(n){return(0,Nu.hasClass)(n.instanceClass,X1.AssetClass.TASK)}o(fA,"canConvertTaskToProject")});var Z1=y(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.canCreateProject=dA;ha.canMoveToAnalysis=pA;ha.canMoveToToDo=mA;ha.canConvertProjectToTask=gA;var Pi=Di(),Fi=Qt();function dA(n){return(0,Pi.hasClass)(n.instanceClass,Fi.AssetClass.AREA)||(0,Pi.hasClass)(n.instanceClass,Fi.AssetClass.INITIATIVE)||(0,Pi.hasClass)(n.instanceClass,Fi.AssetClass.PROJECT)}o(dA,"canCreateProject");function pA(n){return(0,Pi.hasClass)(n.instanceClass,Fi.AssetClass.PROJECT)?(0,Pi.hasStatus)(n.currentStatus,Fi.EffortStatus.BACKLOG):!1}o(pA,"canMoveToAnalysis");function mA(n){return(0,Pi.hasClass)(n.instanceClass,Fi.AssetClass.PROJECT)?(0,Pi.hasStatus)(n.currentStatus,Fi.EffortStatus.ANALYSIS):!1}o(mA,"canMoveToToDo");function gA(n){return(0,Pi.hasClass)(n.instanceClass,Fi.AssetClass.PROJECT)}o(gA,"canConvertProjectToTask")});var r2=y(Lu=>{"use strict";Object.defineProperty(Lu,"__esModule",{value:!0});Lu.canCreateChildArea=yA;Lu.canSetActiveFocus=vA;var e2=Di(),t2=Qt();function yA(n){return(0,e2.hasClass)(n.instanceClass,t2.AssetClass.AREA)}o(yA,"canCreateChildArea");function vA(n){return(0,e2.hasClass)(n.instanceClass,t2.AssetClass.AREA)}o(vA,"canSetActiveFocus")});var i2=y(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.canPlanOnToday=wA;Tr.canPlanForEvening=_A;Tr.canShiftDayBackward=SA;Tr.canShiftDayForward=bA;Tr.canSetDraftStatus=EA;Tr.canMoveToBacklog=TA;Tr.canStartEffort=AA;Tr.canMarkDone=CA;Tr.canTrashEffort=xA;Tr.canVoteOnEffort=IA;Tr.canRollbackStatus=OA;Tr.canArchiveTask=DA;var n2=gs(),rt=Di(),Pr=Qt();function wA(n){return!(!(0,rt.isEffort)(n.instanceClass)||(0,rt.isPlannedForToday)(n.metadata))}o(wA,"canPlanOnToday");function _A(n){return!(0,rt.hasClass)(n.instanceClass,Pr.AssetClass.TASK)&&!(0,rt.hasClass)(n.instanceClass,Pr.AssetClass.MEETING)?!1:(0,rt.hasStatus)(n.currentStatus,Pr.EffortStatus.BACKLOG)}o(_A,"canPlanForEvening");function SA(n){return(0,rt.isEffort)(n.instanceClass)?(0,rt.hasPlannedStartTimestamp)(n.metadata):!1}o(SA,"canShiftDayBackward");function bA(n){return(0,rt.isEffort)(n.instanceClass)?(0,rt.hasPlannedStartTimestamp)(n.metadata):!1}o(bA,"canShiftDayForward");function EA(n){return(0,rt.isEffort)(n.instanceClass)?!n.currentStatus:!1}o(EA,"canSetDraftStatus");function TA(n){return(0,rt.isEffort)(n.instanceClass)?(0,rt.hasStatus)(n.currentStatus,Pr.EffortStatus.DRAFT):!1}o(TA,"canMoveToBacklog");function AA(n){return(0,rt.isEffort)(n.instanceClass)?(0,rt.hasClass)(n.instanceClass,Pr.AssetClass.TASK)||(0,rt.hasClass)(n.instanceClass,Pr.AssetClass.MEETING)?(0,rt.hasStatus)(n.currentStatus,Pr.EffortStatus.BACKLOG):(0,rt.hasClass)(n.instanceClass,Pr.AssetClass.PROJECT)?(0,rt.hasStatus)(n.currentStatus,Pr.EffortStatus.TODO):!1:!1}o(AA,"canStartEffort");function CA(n){return(0,rt.isEffort)(n.instanceClass)?(0,rt.hasStatus)(n.currentStatus,Pr.EffortStatus.DOING):!1}o(CA,"canMarkDone");function xA(n){return(0,rt.isEffort)(n.instanceClass)?n.currentStatus?!(Array.isArray(n.currentStatus)?n.currentStatus:[n.currentStatus]).some(r=>{let i=n2.WikiLinkHelpers.normalize(r);return i===Pr.EffortStatus.TRASHED||i===Pr.EffortStatus.DONE}):!0:!1}o(xA,"canTrashEffort");function IA(n){return!(!(0,rt.isEffort)(n.instanceClass)||(0,rt.isAssetArchived)(n.isArchived))}o(IA,"canVoteOnEffort");function OA(n){if(!(0,rt.isEffort)(n.instanceClass)||(0,rt.isAssetArchived)(n.isArchived)||!n.currentStatus)return!1;let e=Array.isArray(n.currentStatus)?n.currentStatus[0]:n.currentStatus;return!(!e||n2.WikiLinkHelpers.normalize(e)===Pr.EffortStatus.TRASHED)}o(OA,"canRollbackStatus");function DA(n){return!(0,rt.isAssetArchived)(n.isArchived)}o(DA,"canArchiveTask")});var s2=y(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.canCreateEvent=PA;Jr.canCreateInstance=FA;Jr.canCleanProperties=RA;Jr.canRepairFolder=NA;Jr.canRenameToUid=LA;Jr.canCopyLabelToAliases=kA;Jr.canCreateNarrowerConcept=jA;Jr.canCreateSubclass=MA;Jr.canCreateTaskForDailyNote=VA;var Ar=Di(),Ri=Qt();function PA(n){return(0,Ar.isAreaOrProject)(n.instanceClass)}o(PA,"canCreateEvent");function FA(n){return(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.TASK_PROTOTYPE)||(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.MEETING_PROTOTYPE)||(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.EVENT_PROTOTYPE)||(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.PROJECT_PROTOTYPE)?!0:(0,Ar.isPrototypeClass)(n.instanceClass,n.metadata)}o(FA,"canCreateInstance");function RA(n){return(0,Ar.hasEmptyProperties)(n.metadata)}o(RA,"canCleanProperties");function NA(n){return(0,Ar.needsFolderRepair)(n.currentFolder,n.expectedFolder)}o(NA,"canRepairFolder");function LA(n,e){let t=n.metadata.exo__Asset_uid;return!t||(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.CONCEPT)?!1:e!==t}o(LA,"canRenameToUid");function kA(n){let e=n.metadata.exo__Asset_label;if(!e||typeof e!="string"||e.trim()==="")return!1;let t=e.trim(),r=n.metadata.aliases;return!r||!Array.isArray(r)||r.length===0?!0:!r.some(i=>typeof i!="string"?!1:i.trim()===t)}o(kA,"canCopyLabelToAliases");function jA(n){return(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.CONCEPT)}o(jA,"canCreateNarrowerConcept");function MA(n){return(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.CLASS)}o(MA,"canCreateSubclass");function VA(n){if(!(0,Ar.hasClass)(n.instanceClass,Ri.AssetClass.DAILY_NOTE)||n.isArchived)return!1;let e=(0,Ar.extractDailyNoteDate)(n.metadata);return e?(0,Ar.isCurrentDateGteDay)(e):!1}o(VA,"canCreateTaskForDailyNote")});var o2=y(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.canCreateTaskForDailyNote=N.canCreateSubclass=N.canCreateNarrowerConcept=N.canCopyLabelToAliases=N.canRenameToUid=N.canRepairFolder=N.canCleanProperties=N.canCreateInstance=N.canCreateEvent=N.canArchiveTask=N.canRollbackStatus=N.canVoteOnEffort=N.canTrashEffort=N.canMarkDone=N.canStartEffort=N.canMoveToBacklog=N.canSetDraftStatus=N.canShiftDayForward=N.canShiftDayBackward=N.canPlanForEvening=N.canPlanOnToday=N.canSetActiveFocus=N.canCreateChildArea=N.canConvertProjectToTask=N.canMoveToToDo=N.canMoveToAnalysis=N.canCreateProject=N.canConvertTaskToProject=N.canCreateRelatedTask=N.canCreateTask=N.isPrototypeClass=N.inheritsFromPrototype=N.isCurrentDateGteDay=N.extractDailyNoteDate=N.hasPlannedStartTimestamp=N.isPlannedForToday=N.getTodayDateString=N.needsFolderRepair=N.hasEmptyProperties=N.isAssetArchived=N.hasStatus=N.isEffort=N.isAreaOrProject=N.hasClass=void 0;var Cr=Di();Object.defineProperty(N,"hasClass",{enumerable:!0,get:o(function(){return Cr.hasClass},"get")});Object.defineProperty(N,"isAreaOrProject",{enumerable:!0,get:o(function(){return Cr.isAreaOrProject},"get")});Object.defineProperty(N,"isEffort",{enumerable:!0,get:o(function(){return Cr.isEffort},"get")});Object.defineProperty(N,"hasStatus",{enumerable:!0,get:o(function(){return Cr.hasStatus},"get")});Object.defineProperty(N,"isAssetArchived",{enumerable:!0,get:o(function(){return Cr.isAssetArchived},"get")});Object.defineProperty(N,"hasEmptyProperties",{enumerable:!0,get:o(function(){return Cr.hasEmptyProperties},"get")});Object.defineProperty(N,"needsFolderRepair",{enumerable:!0,get:o(function(){return Cr.needsFolderRepair},"get")});Object.defineProperty(N,"getTodayDateString",{enumerable:!0,get:o(function(){return Cr.getTodayDateString},"get")});Object.defineProperty(N,"isPlannedForToday",{enumerable:!0,get:o(function(){return Cr.isPlannedForToday},"get")});Object.defineProperty(N,"hasPlannedStartTimestamp",{enumerable:!0,get:o(function(){return Cr.hasPlannedStartTimestamp},"get")});Object.defineProperty(N,"extractDailyNoteDate",{enumerable:!0,get:o(function(){return Cr.extractDailyNoteDate},"get")});Object.defineProperty(N,"isCurrentDateGteDay",{enumerable:!0,get:o(function(){return Cr.isCurrentDateGteDay},"get")});Object.defineProperty(N,"inheritsFromPrototype",{enumerable:!0,get:o(function(){return Cr.inheritsFromPrototype},"get")});Object.defineProperty(N,"isPrototypeClass",{enumerable:!0,get:o(function(){return Cr.isPrototypeClass},"get")});var Cd=J1();Object.defineProperty(N,"canCreateTask",{enumerable:!0,get:o(function(){return Cd.canCreateTask},"get")});Object.defineProperty(N,"canCreateRelatedTask",{enumerable:!0,get:o(function(){return Cd.canCreateRelatedTask},"get")});Object.defineProperty(N,"canConvertTaskToProject",{enumerable:!0,get:o(function(){return Cd.canConvertTaskToProject},"get")});var ku=Z1();Object.defineProperty(N,"canCreateProject",{enumerable:!0,get:o(function(){return ku.canCreateProject},"get")});Object.defineProperty(N,"canMoveToAnalysis",{enumerable:!0,get:o(function(){return ku.canMoveToAnalysis},"get")});Object.defineProperty(N,"canMoveToToDo",{enumerable:!0,get:o(function(){return ku.canMoveToToDo},"get")});Object.defineProperty(N,"canConvertProjectToTask",{enumerable:!0,get:o(function(){return ku.canConvertProjectToTask},"get")});var a2=r2();Object.defineProperty(N,"canCreateChildArea",{enumerable:!0,get:o(function(){return a2.canCreateChildArea},"get")});Object.defineProperty(N,"canSetActiveFocus",{enumerable:!0,get:o(function(){return a2.canSetActiveFocus},"get")});var Ur=i2();Object.defineProperty(N,"canPlanOnToday",{enumerable:!0,get:o(function(){return Ur.canPlanOnToday},"get")});Object.defineProperty(N,"canPlanForEvening",{enumerable:!0,get:o(function(){return Ur.canPlanForEvening},"get")});Object.defineProperty(N,"canShiftDayBackward",{enumerable:!0,get:o(function(){return Ur.canShiftDayBackward},"get")});Object.defineProperty(N,"canShiftDayForward",{enumerable:!0,get:o(function(){return Ur.canShiftDayForward},"get")});Object.defineProperty(N,"canSetDraftStatus",{enumerable:!0,get:o(function(){return Ur.canSetDraftStatus},"get")});Object.defineProperty(N,"canMoveToBacklog",{enumerable:!0,get:o(function(){return Ur.canMoveToBacklog},"get")});Object.defineProperty(N,"canStartEffort",{enumerable:!0,get:o(function(){return Ur.canStartEffort},"get")});Object.defineProperty(N,"canMarkDone",{enumerable:!0,get:o(function(){return Ur.canMarkDone},"get")});Object.defineProperty(N,"canTrashEffort",{enumerable:!0,get:o(function(){return Ur.canTrashEffort},"get")});Object.defineProperty(N,"canVoteOnEffort",{enumerable:!0,get:o(function(){return Ur.canVoteOnEffort},"get")});Object.defineProperty(N,"canRollbackStatus",{enumerable:!0,get:o(function(){return Ur.canRollbackStatus},"get")});Object.defineProperty(N,"canArchiveTask",{enumerable:!0,get:o(function(){return Ur.canArchiveTask},"get")});var ui=s2();Object.defineProperty(N,"canCreateEvent",{enumerable:!0,get:o(function(){return ui.canCreateEvent},"get")});Object.defineProperty(N,"canCreateInstance",{enumerable:!0,get:o(function(){return ui.canCreateInstance},"get")});Object.defineProperty(N,"canCleanProperties",{enumerable:!0,get:o(function(){return ui.canCleanProperties},"get")});Object.defineProperty(N,"canRepairFolder",{enumerable:!0,get:o(function(){return ui.canRepairFolder},"get")});Object.defineProperty(N,"canRenameToUid",{enumerable:!0,get:o(function(){return ui.canRenameToUid},"get")});Object.defineProperty(N,"canCopyLabelToAliases",{enumerable:!0,get:o(function(){return ui.canCopyLabelToAliases},"get")});Object.defineProperty(N,"canCreateNarrowerConcept",{enumerable:!0,get:o(function(){return ui.canCreateNarrowerConcept},"get")});Object.defineProperty(N,"canCreateSubclass",{enumerable:!0,get:o(function(){return ui.canCreateSubclass},"get")});Object.defineProperty(N,"canCreateTaskForDailyNote",{enumerable:!0,get:o(function(){return ui.canCreateTaskForDailyNote},"get")})});var c2=y(ws=>{"use strict";var $A=ws&&ws.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),UA=ws&&ws.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&$A(e,n,t)};Object.defineProperty(ws,"__esModule",{value:!0});UA(o2(),ws)});var Id=y(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.PropertyFieldType=void 0;jo.rangeToFieldType=GA;var Vt;(function(n){n.Text="text",n.Number="number",n.Date="date",n.DateTime="datetime",n.Boolean="boolean",n.Reference="reference",n.Enum="enum",n.StatusSelect="status-select",n.SizeSelect="size-select",n.Wikilink="wikilink",n.Timestamp="timestamp",n.Unknown="unknown"})(Vt||(jo.PropertyFieldType=Vt={}));var u2="http://www.w3.org/2001/XMLSchema#",BA="https://exocortex.my/ontology/exo#",qA="https://exocortex.my/ontology/ems#";function GA(n){if(!n)return Vt.Unknown;let e=n.trim();if(!e)return Vt.Unknown;if(e.startsWith(u2)){let t=e.substring(u2.length);return xd(t)}if(e.startsWith("xsd:")){let t=e.substring(4);return xd(t)}if(e.includes("XMLSchema#")){let t=e.indexOf("XMLSchema#"),r=e.substring(t+10);return xd(r)}return e.startsWith(qA)||e.startsWith("ems:")?WA(e):e.startsWith(BA)||e.startsWith("exo:")||zA(e)?Vt.Reference:Vt.Text}o(GA,"rangeToFieldType");function xd(n){switch(n.toLowerCase()){case"string":case"normalizedstring":case"token":case"language":case"nmtoken":case"name":case"ncname":case"anyuri":return Vt.Text;case"integer":case"int":case"long":case"short":case"byte":case"nonnegativeinteger":case"positiveinteger":case"nonpositiveinteger":case"negativeinteger":case"unsignedlong":case"unsignedint":case"unsignedshort":case"unsignedbyte":case"decimal":case"float":case"double":return Vt.Number;case"date":return Vt.Date;case"datetime":case"datetimestamp":return Vt.DateTime;case"boolean":return Vt.Boolean;case"time":return Vt.Timestamp;default:return Vt.Text}}o(xd,"xsdTypeToFieldType");function WA(n){let e=n.toLowerCase();return e.includes("effortstatus")?Vt.StatusSelect:e.includes("tasksize")?Vt.SizeSelect:Vt.Reference}o(WA,"emsTypeToFieldType");function zA(n){let e=n.toLowerCase();return e.includes("exocortex.my/ontology")?!0:["asset","task","project","area","effort","class","property","concept"].some(r=>e.includes(r))}o(zA,"isClassReference")});var h2=y(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.propertyNameToUri=HA;Mo.uriToPropertyName=l2;Mo.extractPropertyLabel=YA;function HA(n){return n.replace(/^([a-z]+)__/,"$1:")}o(HA,"propertyNameToUri");function l2(n){if(n.startsWith("http://")||n.startsWith("https://")){let e=n.match(/\/([a-z]+)#([A-Za-z0-9_]+)$/);if(e)return`${e[1]}__${e[2]}`;let t=n.lastIndexOf("#"),r=n.lastIndexOf("/"),i=Math.max(t,r);return i>=0?n.substring(i+1):n}return n.replace(/^([a-z]+):/,"$1__")}o(l2,"uriToPropertyName");function YA(n){let r=(n.includes(":")?l2(n):n).replace(/^[a-z]+__/,"").split("_");return(r.length>1?r.slice(1).join(" "):r[0]).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,s=>s.toUpperCase())}o(YA,"extractPropertyLabel")});var ju={};pT(ju,{__assign:()=>Dd,__asyncDelegator:()=>oC,__asyncGenerator:()=>aC,__asyncValues:()=>cC,__await:()=>Vo,__awaiter:()=>eC,__classPrivateFieldGet:()=>fC,__classPrivateFieldSet:()=>dC,__createBinding:()=>rC,__decorate:()=>XA,__exportStar:()=>nC,__extends:()=>QA,__generator:()=>tC,__importDefault:()=>hC,__importStar:()=>lC,__makeTemplateObject:()=>uC,__metadata:()=>ZA,__param:()=>JA,__read:()=>f2,__rest:()=>KA,__spread:()=>iC,__spreadArrays:()=>sC,__values:()=>Pd});function QA(n,e){Od(n,e);function t(){this.constructor=n}o(t,"__"),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function KA(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function XA(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function JA(n,e){return function(t,r){e(t,r,n)}}function ZA(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function eC(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return o(i,"adopt"),new(t||(t=Promise))(function(s,a){function c(h){try{l(r.next(h))}catch(f){a(f)}}o(c,"fulfilled");function u(h){try{l(r.throw(h))}catch(f){a(f)}}o(u,"rejected");function l(h){h.done?s(h.value):i(h.value).then(c,u)}o(l,"step"),l((r=r.apply(n,e||[])).next())})}function tC(n,e){var t={label:0,sent:o(function(){if(s[0]&1)throw s[1];return s[1]},"sent"),trys:[],ops:[]},r,i,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(h){return u([l,h])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(h){l=[6,h],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function rC(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}function nC(n,e){for(var t in n)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function Pd(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:o(function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}},"next")};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f2(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(c){a={error:c}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s}function iC(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(f2(arguments[e]));return n}function sC(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,i++)r[i]=s[a];return r}function Vo(n){return this instanceof Vo?(this.v=n,this):new Vo(n)}function aC(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(d){r[d]&&(i[d]=function(m){return new Promise(function(_,S){s.push([d,m,_,S])>1||c(d,m)})})}function c(d,m){try{u(r[d](m))}catch(_){f(s[0][3],_)}}function u(d){d.value instanceof Vo?Promise.resolve(d.value.v).then(l,h):f(s[0][2],d)}function l(d){c("next",d)}function h(d){c("throw",d)}function f(d,m){d(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function oC(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(a){return(t=!t)?{value:Vo(n[i](a)),done:i==="return"}:s?s(a):a}:s}}function cC(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Pd=="function"?Pd(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(a){return new Promise(function(c,u){a=n[s](a),i(c,u,a.done,a.value)})}}function i(s,a,c,u){Promise.resolve(u).then(function(l){s({value:l,done:c})},a)}}function uC(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function lC(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function hC(n){return n&&n.__esModule?n:{default:n}}function fC(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function dC(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t}var Od,Dd,Mu=dT(()=>{Od=o(function(n,e){return Od=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Od(n,e)},"extendStatics");o(QA,"__extends");Dd=o(function(){return Dd=Object.assign||o(function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},"__assign"),Dd.apply(this,arguments)},"__assign");o(KA,"__rest");o(XA,"__decorate");o(JA,"__param");o(ZA,"__metadata");o(eC,"__awaiter");o(tC,"__generator");o(rC,"__createBinding");o(nC,"__exportStar");o(Pd,"__values");o(f2,"__read");o(iC,"__spread");o(sC,"__spreadArrays");o(Vo,"__await");o(aC,"__asyncGenerator");o(oC,"__asyncDelegator");o(cC,"__asyncValues");o(uC,"__makeTemplateObject");o(lC,"__importStar");o(hC,"__importDefault");o(fC,"__classPrivateFieldGet");o(dC,"__classPrivateFieldSet")});var Nd=y(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});var Fd;(function(n){n[n.Transient=0]="Transient",n[n.Singleton=1]="Singleton",n[n.ResolutionScoped=2]="ResolutionScoped",n[n.ContainerScoped=3]="ContainerScoped"})(Fd||(Fd={}));Rd.default=Fd});var d2=y(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});var pC=Nd();Object.defineProperty(Ld,"Lifecycle",{enumerable:!0,get:o(function(){return pC.default},"get")})});var _s=y(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.defineInjectionTokenMetadata=Zr.getParamInfo=Zr.INJECTION_TOKEN_METADATA_KEY=void 0;Zr.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function mC(n){let e=Reflect.getMetadata("design:paramtypes",n)||[],t=Reflect.getOwnMetadata(Zr.INJECTION_TOKEN_METADATA_KEY,n)||{};return Object.keys(t).forEach(r=>{e[+r]=t[r]}),e}o(mC,"getParamInfo");Zr.getParamInfo=mC;function gC(n,e){return function(t,r,i){let s=Reflect.getOwnMetadata(Zr.INJECTION_TOKEN_METADATA_KEY,t)||{};s[i]=e?{token:n,transform:e.transformToken,transformArgs:e.args||[]}:n,Reflect.defineMetadata(Zr.INJECTION_TOKEN_METADATA_KEY,s,t)}}o(gC,"defineInjectionTokenMetadata");Zr.defineInjectionTokenMetadata=gC});var kd=y(Vu=>{"use strict";Object.defineProperty(Vu,"__esModule",{value:!0});Vu.isClassProvider=void 0;function yC(n){return!!n.useClass}o(yC,"isClassProvider");Vu.isClassProvider=yC});var jd=y($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});$u.isFactoryProvider=void 0;function vC(n){return!!n.useFactory}o(vC,"isFactoryProvider");$u.isFactoryProvider=vC});var Bu=y(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.delay=fa.DelayedConstructor=void 0;var Uu=class{static{o(this,"DelayedConstructor")}constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},r=!1,i,s=o(()=>(r||(i=e(this.wrap()),r=!0),i),"delayedObject");return new Proxy(t,this.createHandler(s))}createHandler(e){let t={},r=o(i=>{t[i]=(...s)=>{s[0]=e();let a=Reflect[i];return a(...s)}},"install");return this.reflectMethods.forEach(r),t}};fa.DelayedConstructor=Uu;function wC(n){if(typeof n>"u")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new Uu(n)}o(wC,"delay");fa.delay=wC});var qu=y(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.isConstructorToken=Mn.isTransformDescriptor=Mn.isTokenDescriptor=Mn.isNormalToken=void 0;var _C=Bu();function SC(n){return typeof n=="string"||typeof n=="symbol"}o(SC,"isNormalToken");Mn.isNormalToken=SC;function bC(n){return typeof n=="object"&&"token"in n&&"multiple"in n}o(bC,"isTokenDescriptor");Mn.isTokenDescriptor=bC;function EC(n){return typeof n=="object"&&"token"in n&&"transform"in n}o(EC,"isTransformDescriptor");Mn.isTransformDescriptor=EC;function TC(n){return typeof n=="function"||n instanceof _C.DelayedConstructor}o(TC,"isConstructorToken");Mn.isConstructorToken=TC});var Md=y(Gu=>{"use strict";Object.defineProperty(Gu,"__esModule",{value:!0});Gu.isTokenProvider=void 0;function AC(n){return!!n.useToken}o(AC,"isTokenProvider");Gu.isTokenProvider=AC});var Vd=y(Wu=>{"use strict";Object.defineProperty(Wu,"__esModule",{value:!0});Wu.isValueProvider=void 0;function CC(n){return n.useValue!=null}o(CC,"isValueProvider");Wu.isValueProvider=CC});var $d=y(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});var xC=kd();Object.defineProperty(Ss,"isClassProvider",{enumerable:!0,get:o(function(){return xC.isClassProvider},"get")});var IC=jd();Object.defineProperty(Ss,"isFactoryProvider",{enumerable:!0,get:o(function(){return IC.isFactoryProvider},"get")});var OC=qu();Object.defineProperty(Ss,"isNormalToken",{enumerable:!0,get:o(function(){return OC.isNormalToken},"get")});var DC=Md();Object.defineProperty(Ss,"isTokenProvider",{enumerable:!0,get:o(function(){return DC.isTokenProvider},"get")});var PC=Vd();Object.defineProperty(Ss,"isValueProvider",{enumerable:!0,get:o(function(){return PC.isValueProvider},"get")})});var p2=y(zu=>{"use strict";Object.defineProperty(zu,"__esModule",{value:!0});zu.isProvider=void 0;var FC=kd(),RC=Vd(),NC=Md(),LC=jd();function kC(n){return FC.isClassProvider(n)||RC.isValueProvider(n)||NC.isTokenProvider(n)||LC.isFactoryProvider(n)}o(kC,"isProvider");zu.isProvider=kC});var qd=y(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});var Ud=class{static{o(this,"RegistryBase")}constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};Bd.default=Ud});var m2=y(Wd=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});var jC=qd(),Gd=class extends jC.default{static{o(this,"Registry")}};Wd.default=Gd});var g2=y(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});var zd=class{static{o(this,"ResolutionContext")}constructor(){this.scopedResolutions=new Map}};Hd.default=zd});var Yd=y(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});Hu.formatErrorCtor=void 0;function MC(n,e){return n===null?`at position #${e}`:`"${n.split(",")[e].trim()}" at position #${e}`}o(MC,"formatDependency");function VC(n,e,t="    "){return[n,...e.message.split(`
`).map(r=>t+r)].join(`
`)}o(VC,"composeErrorMessage");function $C(n,e,t){let[,r=null]=n.toString().match(/constructor\(([\w, ]+)\)/)||[],i=MC(r,e);return VC(`Cannot inject the dependency ${i} of "${n.name}" constructor. Reason:`,t)}o($C,"formatErrorCtor");Hu.formatErrorCtor=$C});var y2=y(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.isDisposable=void 0;function UC(n){return!(typeof n.dispose!="function"||n.dispose.length>0)}o(UC,"isDisposable");Yu.isDisposable=UC});var w2=y(bs=>{"use strict";Object.defineProperty(bs,"__esModule",{value:!0});bs.PostResolutionInterceptors=bs.PreResolutionInterceptors=void 0;var v2=qd(),Qu=class extends v2.default{static{o(this,"PreResolutionInterceptors")}};bs.PreResolutionInterceptors=Qu;var Ku=class extends v2.default{static{o(this,"PostResolutionInterceptors")}};bs.PostResolutionInterceptors=Ku;var Qd=class{static{o(this,"Interceptors")}constructor(){this.preResolution=new Qu,this.postResolution=new Ku}};bs.default=Qd});var Ni=y(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.instance=li.typeInfo=void 0;var BC=(Mu(),Hf(ju)),lr=$d(),qC=p2(),Xu=qu(),GC=m2(),xr=Nd(),Ju=g2(),WC=Yd(),zC=Bu(),HC=y2(),YC=w2();li.typeInfo=new Map;var Kd=class n{static{o(this,"InternalDependencyContainer")}constructor(e){this.parent=e,this._registry=new GC.default,this.interceptors=new YC.default,this.disposed=!1,this.disposables=new Set}register(e,t,r={lifecycle:xr.default.Transient}){this.ensureNotDisposed();let i;if(qC.isProvider(t)?i=t:i={useClass:t},lr.isTokenProvider(i)){let s=[e],a=i;for(;a!=null;){let c=a.useToken;if(s.includes(c))throw new Error(`Token registration cycle detected! ${[...s,c].join(" -> ")}`);s.push(c);let u=this._registry.get(c);u&&lr.isTokenProvider(u.provider)?a=u.provider:a=null}}if((r.lifecycle===xr.default.Singleton||r.lifecycle==xr.default.ContainerScoped||r.lifecycle==xr.default.ResolutionScoped)&&(lr.isValueProvider(i)||lr.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${xr.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,t){return this.ensureNotDisposed(),lr.isNormalToken(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),lr.isNormalToken(e)){if(lr.isNormalToken(t))return this.register(e,{useToken:t},{lifecycle:xr.default.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:xr.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return t&&!lr.isNormalToken(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:xr.default.Singleton})}resolve(e,t=new Ju.default,r=!1){this.ensureNotDisposed();let i=this.getRegistration(e);if(!i&&lr.isNormalToken(e)){if(r)return;throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"Single"),i){let s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(Xu.isConstructorToken(e)){let s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,t);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,t,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,t,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===xr.default.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let r=e.options.lifecycle===xr.default.Singleton,i=e.options.lifecycle===xr.default.ContainerScoped,s=r||i,a;return lr.isValueProvider(e.provider)?a=e.provider.useValue:lr.isTokenProvider(e.provider)?a=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):lr.isClassProvider(e.provider)?a=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):lr.isFactoryProvider(e.provider)?a=e.provider.useFactory(this):a=this.construct(e.provider,t),e.options.lifecycle===xr.default.ResolutionScoped&&t.scopedResolutions.set(e,a),a}resolveAll(e,t=new Ju.default,r=!1){this.ensureNotDisposed();let i=this.getAllRegistrations(e);if(!i&&lr.isNormalToken(e)){if(r)return[];throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"All"),i){let a=i.map(c=>this.resolveRegistration(c,t));return this.executePostResolutionInterceptor(e,a,"All"),a}let s=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,s,"All"),s}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(r=>!lr.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new n(this);for(let[t,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===xr.default.ContainerScoped)&&e._registry.setAll(t,r.map(i=>i.options.lifecycle===xr.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,t,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:r})}afterResolution(e,t,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:r})}dispose(){return BC.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let r=t.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof zC.DelayedConstructor)return e.createProxy(i=>this.resolve(i,t));let r=(()=>{let i=li.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(t,e));return new e(...s)})();return HC.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,t){return(r,i)=>{try{return Xu.isTokenDescriptor(r)?Xu.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token,new Ju.default,r.isOptional),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e,r.isOptional),...r.transformArgs):r.multiple?this.resolveAll(r.token,new Ju.default,r.isOptional):this.resolve(r.token,e,r.isOptional):Xu.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(WC.formatErrorCtor(t,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};li.instance=new Kd;li.default=li.instance});var _2=y(Jd=>{"use strict";Object.defineProperty(Jd,"__esModule",{value:!0});var QC=_s(),hi=Ni(),Xd=qu(),KC=Yd();function XC(){return function(n){let e=QC.getParamInfo(n);return class extends n{constructor(...t){super(...t.concat(e.slice(t.length).map((r,i)=>{try{return Xd.isTokenDescriptor(r)?Xd.isTransformDescriptor(r)?r.multiple?hi.instance.resolve(r.transform).transform(hi.instance.resolveAll(r.token),...r.transformArgs):hi.instance.resolve(r.transform).transform(hi.instance.resolve(r.token),...r.transformArgs):r.multiple?hi.instance.resolveAll(r.token):hi.instance.resolve(r.token):Xd.isTransformDescriptor(r)?hi.instance.resolve(r.transform).transform(hi.instance.resolve(r.token),...r.transformArgs):hi.instance.resolve(r)}catch(s){let a=i+t.length;throw new Error(KC.formatErrorCtor(n,a,s))}})))}}}}o(XC,"autoInjectable");Jd.default=XC});var S2=y(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});var JC=_s();function ZC(n,e){let t={token:n,multiple:!1,isOptional:e&&e.isOptional};return JC.defineInjectionTokenMetadata(t)}o(ZC,"inject");Zd.default=ZC});var Zu=y(ep=>{"use strict";Object.defineProperty(ep,"__esModule",{value:!0});var ex=_s(),tx=Ni(),b2=Ni();function rx(n){return function(e){tx.typeInfo.set(e,ex.getParamInfo(e)),n&&n.token&&(Array.isArray(n.token)?n.token.forEach(t=>{b2.instance.register(t,e)}):b2.instance.register(n.token,e))}}o(rx,"injectable");ep.default=rx});var E2=y(tp=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});var nx=(Mu(),Hf(ju)),ix=Ni();function sx(n=[]){return function(e){return n.forEach(t=>{var{token:r,options:i}=t,s=nx.__rest(t,["token","options"]);return ix.instance.register(r,s,i)}),e}}o(sx,"registry");tp.default=sx});var T2=y(rp=>{"use strict";Object.defineProperty(rp,"__esModule",{value:!0});var ax=Zu(),ox=Ni();function cx(){return function(n){ax.default()(n),ox.instance.registerSingleton(n)}}o(cx,"singleton");rp.default=cx});var A2=y(np=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});var ux=_s();function lx(n,e){let t={token:n,multiple:!0,isOptional:e&&e.isOptional};return ux.defineInjectionTokenMetadata(t)}o(lx,"injectAll");np.default=lx});var C2=y(ip=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});var hx=_s();function fx(n,e,...t){let r={token:n,multiple:!0,transform:e,transformArgs:t};return hx.defineInjectionTokenMetadata(r)}o(fx,"injectAllWithTransform");ip.default=fx});var x2=y(sp=>{"use strict";Object.defineProperty(sp,"__esModule",{value:!0});var dx=_s();function px(n,e,...t){return dx.defineInjectionTokenMetadata(n,{transformToken:e,args:t})}o(px,"injectWithTransform");sp.default=px});var I2=y(ap=>{"use strict";Object.defineProperty(ap,"__esModule",{value:!0});var mx=Zu(),gx=Ni();function yx(n,e){return function(t){mx.default()(t),gx.instance.register(e||t,t,{lifecycle:n})}}o(yx,"scoped");ap.default=yx});var O2=y(en=>{"use strict";Object.defineProperty(en,"__esModule",{value:!0});var vx=_2();Object.defineProperty(en,"autoInjectable",{enumerable:!0,get:o(function(){return vx.default},"get")});var wx=S2();Object.defineProperty(en,"inject",{enumerable:!0,get:o(function(){return wx.default},"get")});var _x=Zu();Object.defineProperty(en,"injectable",{enumerable:!0,get:o(function(){return _x.default},"get")});var Sx=E2();Object.defineProperty(en,"registry",{enumerable:!0,get:o(function(){return Sx.default},"get")});var bx=T2();Object.defineProperty(en,"singleton",{enumerable:!0,get:o(function(){return bx.default},"get")});var Ex=A2();Object.defineProperty(en,"injectAll",{enumerable:!0,get:o(function(){return Ex.default},"get")});var Tx=C2();Object.defineProperty(en,"injectAllWithTransform",{enumerable:!0,get:o(function(){return Tx.default},"get")});var Ax=x2();Object.defineProperty(en,"injectWithTransform",{enumerable:!0,get:o(function(){return Ax.default},"get")});var Cx=I2();Object.defineProperty(en,"scoped",{enumerable:!0,get:o(function(){return Cx.default},"get")})});var D2=y(op=>{"use strict";Object.defineProperty(op,"__esModule",{value:!0});function xx(n){let e;return t=>(e==null&&(e=n(t)),e)}o(xx,"instanceCachingFactory");op.default=xx});var P2=y(cp=>{"use strict";Object.defineProperty(cp,"__esModule",{value:!0});function Ix(n){let e=new WeakMap;return t=>{let r=e.get(t);return r==null&&(r=n(t),e.set(t,r)),r}}o(Ix,"instancePerContainerCachingFactory");cp.default=Ix});var F2=y(up=>{"use strict";Object.defineProperty(up,"__esModule",{value:!0});function Ox(n,e,t,r=!0){let i,s;return a=>{let c=n(a);return(!r||s!==c)&&((s=c)?i=a.resolve(e):i=a.resolve(t)),i}}o(Ox,"predicateAwareClassFactory");up.default=Ox});var R2=y($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});var Dx=D2();Object.defineProperty($o,"instanceCachingFactory",{enumerable:!0,get:o(function(){return Dx.default},"get")});var Px=P2();Object.defineProperty($o,"instancePerContainerCachingFactory",{enumerable:!0,get:o(function(){return Px.default},"get")});var Fx=F2();Object.defineProperty($o,"predicateAwareClassFactory",{enumerable:!0,get:o(function(){return Fx.default},"get")})});var qe=y(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});var lp=(Mu(),Hf(ju));if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var Rx=d2();Object.defineProperty(Li,"Lifecycle",{enumerable:!0,get:o(function(){return Rx.Lifecycle},"get")});lp.__exportStar(O2(),Li);lp.__exportStar(R2(),Li);lp.__exportStar($d(),Li);var Nx=Bu();Object.defineProperty(Li,"delay",{enumerable:!0,get:o(function(){return Nx.delay},"get")});var Lx=Ni();Object.defineProperty(Li,"container",{enumerable:!0,get:o(function(){return Lx.instance},"get")})});var N2=y(hp=>{"use strict";Object.defineProperty(hp,"__esModule",{value:!0});hp.default="ffffffff-ffff-ffff-ffff-ffffffffffff"});var L2=y(fp=>{"use strict";Object.defineProperty(fp,"__esModule",{value:!0});fp.default="00000000-0000-0000-0000-000000000000"});var k2=y(dp=>{"use strict";Object.defineProperty(dp,"__esModule",{value:!0});dp.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});var Uo=y(pp=>{"use strict";Object.defineProperty(pp,"__esModule",{value:!0});var kx=k2();function jx(n){return typeof n=="string"&&kx.default.test(n)}o(jx,"validate");pp.default=jx});var Bo=y(mp=>{"use strict";Object.defineProperty(mp,"__esModule",{value:!0});var Mx=Uo();function Vx(n){if(!(0,Mx.default)(n))throw TypeError("Invalid UUID");let e;return Uint8Array.of((e=parseInt(n.slice(0,8),16))>>>24,e>>>16&255,e>>>8&255,e&255,(e=parseInt(n.slice(9,13),16))>>>8,e&255,(e=parseInt(n.slice(14,18),16))>>>8,e&255,(e=parseInt(n.slice(19,23),16))>>>8,e&255,(e=parseInt(n.slice(24,36),16))/1099511627776&255,e/4294967296&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255)}o(Vx,"parse");mp.default=Vx});var fi=y(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.unsafeStringify=void 0;var $x=Uo(),$t=[];for(let n=0;n<256;++n)$t.push((n+256).toString(16).slice(1));function j2(n,e=0){return($t[n[e+0]]+$t[n[e+1]]+$t[n[e+2]]+$t[n[e+3]]+"-"+$t[n[e+4]]+$t[n[e+5]]+"-"+$t[n[e+6]]+$t[n[e+7]]+"-"+$t[n[e+8]]+$t[n[e+9]]+"-"+$t[n[e+10]]+$t[n[e+11]]+$t[n[e+12]]+$t[n[e+13]]+$t[n[e+14]]+$t[n[e+15]]).toLowerCase()}o(j2,"unsafeStringify");qo.unsafeStringify=j2;function Ux(n,e=0){let t=j2(n,e);if(!(0,$x.default)(t))throw TypeError("Stringified UUID is invalid");return t}o(Ux,"stringify");qo.default=Ux});var rl=y(gp=>{"use strict";Object.defineProperty(gp,"__esModule",{value:!0});var Bx=require("crypto"),tl=new Uint8Array(256),el=tl.length;function qx(){return el>tl.length-16&&((0,Bx.randomFillSync)(tl),el=0),tl.slice(el,el+=16)}o(qx,"rng");gp.default=qx});var yp=y(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.updateV1State=void 0;var M2=rl(),Gx=fi(),Go={};function Wx(n,e,t){let r,i=n?._v6??!1;if(n){let s=Object.keys(n);s.length===1&&s[0]==="_v6"&&(n=void 0)}if(n)r=V2(n.random??n.rng?.()??(0,M2.default)(),n.msecs,n.nsecs,n.clockseq,n.node,e,t);else{let s=Date.now(),a=(0,M2.default)();$2(Go,s,a),r=V2(a,Go.msecs,Go.nsecs,i?void 0:Go.clockseq,i?void 0:Go.node,e,t)}return e??(0,Gx.unsafeStringify)(r)}o(Wx,"v1");function $2(n,e,t){return n.msecs??=-1/0,n.nsecs??=0,e===n.msecs?(n.nsecs++,n.nsecs>=1e4&&(n.node=void 0,n.nsecs=0)):e>n.msecs?n.nsecs=0:e<n.msecs&&(n.node=void 0),n.node||(n.node=t.slice(10,16),n.node[0]|=1,n.clockseq=(t[8]<<8|t[9])&16383),n.msecs=e,n}o($2,"updateV1State");Wo.updateV1State=$2;function V2(n,e,t,r,i,s,a=0){if(n.length<16)throw new Error("Random bytes length must be >= 16");if(!s)s=new Uint8Array(16),a=0;else if(a<0||a+16>s.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);e??=Date.now(),t??=0,r??=(n[8]<<8|n[9])&16383,i??=n.slice(10,16),e+=122192928e5;let c=((e&268435455)*1e4+t)%4294967296;s[a++]=c>>>24&255,s[a++]=c>>>16&255,s[a++]=c>>>8&255,s[a++]=c&255;let u=e/4294967296*1e4&268435455;s[a++]=u>>>8&255,s[a++]=u&255,s[a++]=u>>>24&15|16,s[a++]=u>>>16&255,s[a++]=r>>>8|128,s[a++]=r&255;for(let l=0;l<6;++l)s[a++]=i[l];return s}o(V2,"v1Bytes");Wo.default=Wx});var wp=y(vp=>{"use strict";Object.defineProperty(vp,"__esModule",{value:!0});var zx=Bo(),Hx=fi();function Yx(n){let e=typeof n=="string"?(0,zx.default)(n):n,t=Qx(e);return typeof n=="string"?(0,Hx.unsafeStringify)(t):t}o(Yx,"v1ToV6");vp.default=Yx;function Qx(n){return Uint8Array.of((n[6]&15)<<4|n[7]>>4&15,(n[7]&15)<<4|(n[4]&240)>>4,(n[4]&15)<<4|(n[5]&240)>>4,(n[5]&15)<<4|(n[0]&240)>>4,(n[0]&15)<<4|(n[1]&240)>>4,(n[1]&15)<<4|(n[2]&240)>>4,96|n[2]&15,n[3],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}o(Qx,"_v1ToV6")});var U2=y(_p=>{"use strict";Object.defineProperty(_p,"__esModule",{value:!0});var Kx=require("crypto");function Xx(n){return Array.isArray(n)?n=Buffer.from(n):typeof n=="string"&&(n=Buffer.from(n,"utf8")),(0,Kx.createHash)("md5").update(n).digest()}o(Xx,"md5");_p.default=Xx});var zo=y(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.URL=di.DNS=di.stringToBytes=void 0;var B2=Bo(),Jx=fi();function q2(n){n=unescape(encodeURIComponent(n));let e=new Uint8Array(n.length);for(let t=0;t<n.length;++t)e[t]=n.charCodeAt(t);return e}o(q2,"stringToBytes");di.stringToBytes=q2;di.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8";di.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Zx(n,e,t,r,i,s){let a=typeof t=="string"?q2(t):t,c=typeof r=="string"?(0,B2.default)(r):r;if(typeof r=="string"&&(r=(0,B2.default)(r)),r?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+a.length);if(u.set(c),u.set(a,c.length),u=e(u),u[6]=u[6]&15|n,u[8]=u[8]&63|128,i){s=s||0;for(let l=0;l<16;++l)i[s+l]=u[l];return i}return(0,Jx.unsafeStringify)(u)}o(Zx,"v35");di.default=Zx});var W2=y(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});Es.URL=Es.DNS=void 0;var eI=U2(),Sp=zo(),G2=zo();Object.defineProperty(Es,"DNS",{enumerable:!0,get:o(function(){return G2.DNS},"get")});Object.defineProperty(Es,"URL",{enumerable:!0,get:o(function(){return G2.URL},"get")});function bp(n,e,t,r){return(0,Sp.default)(48,eI.default,n,e,t,r)}o(bp,"v3");bp.DNS=Sp.DNS;bp.URL=Sp.URL;Es.default=bp});var z2=y(Ep=>{"use strict";Object.defineProperty(Ep,"__esModule",{value:!0});var tI=require("crypto");Ep.default={randomUUID:tI.randomUUID}});var Y2=y(Tp=>{"use strict";Object.defineProperty(Tp,"__esModule",{value:!0});var H2=z2(),rI=rl(),nI=fi();function iI(n,e,t){if(H2.default.randomUUID&&!e&&!n)return H2.default.randomUUID();n=n||{};let r=n.random??n.rng?.()??(0,rI.default)();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[t+i]=r[i];return e}return(0,nI.unsafeStringify)(r)}o(iI,"v4");Tp.default=iI});var Q2=y(Ap=>{"use strict";Object.defineProperty(Ap,"__esModule",{value:!0});var sI=require("crypto");function aI(n){return Array.isArray(n)?n=Buffer.from(n):typeof n=="string"&&(n=Buffer.from(n,"utf8")),(0,sI.createHash)("sha1").update(n).digest()}o(aI,"sha1");Ap.default=aI});var X2=y(Ts=>{"use strict";Object.defineProperty(Ts,"__esModule",{value:!0});Ts.URL=Ts.DNS=void 0;var oI=Q2(),Cp=zo(),K2=zo();Object.defineProperty(Ts,"DNS",{enumerable:!0,get:o(function(){return K2.DNS},"get")});Object.defineProperty(Ts,"URL",{enumerable:!0,get:o(function(){return K2.URL},"get")});function xp(n,e,t,r){return(0,Cp.default)(80,oI.default,n,e,t,r)}o(xp,"v5");xp.DNS=Cp.DNS;xp.URL=Cp.URL;Ts.default=xp});var J2=y(Ip=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});var cI=fi(),uI=yp(),lI=wp();function hI(n,e,t){n??={},t??=0;let r=(0,uI.default)({...n,_v6:!0},new Uint8Array(16));if(r=(0,lI.default)(r),e){for(let i=0;i<16;i++)e[t+i]=r[i];return e}return(0,cI.unsafeStringify)(r)}o(hI,"v6");Ip.default=hI});var Z2=y(Op=>{"use strict";Object.defineProperty(Op,"__esModule",{value:!0});var fI=Bo(),dI=fi();function pI(n){let e=typeof n=="string"?(0,fI.default)(n):n,t=mI(e);return typeof n=="string"?(0,dI.unsafeStringify)(t):t}o(pI,"v6ToV1");Op.default=pI;function mI(n){return Uint8Array.of((n[3]&15)<<4|n[4]>>4&15,(n[4]&15)<<4|(n[5]&240)>>4,(n[5]&15)<<4|n[6]&15,n[7],(n[1]&15)<<4|(n[2]&240)>>4,(n[2]&15)<<4|(n[3]&240)>>4,16|(n[0]&240)>>4,(n[0]&15)<<4|(n[1]&240)>>4,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}o(mI,"_v6ToV1")});var nv=y(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.updateV7State=void 0;var ev=rl(),gI=fi(),Dp={};function yI(n,e,t){let r;if(n)r=tv(n.random??n.rng?.()??(0,ev.default)(),n.msecs,n.seq,e,t);else{let i=Date.now(),s=(0,ev.default)();rv(Dp,i,s),r=tv(s,Dp.msecs,Dp.seq,e,t)}return e??(0,gI.unsafeStringify)(r)}o(yI,"v7");function rv(n,e,t){return n.msecs??=-1/0,n.seq??=0,e>n.msecs?(n.seq=t[6]<<23|t[7]<<16|t[8]<<8|t[9],n.msecs=e):(n.seq=n.seq+1|0,n.seq===0&&n.msecs++),n}o(rv,"updateV7State");Ho.updateV7State=rv;function tv(n,e,t,r,i=0){if(n.length<16)throw new Error("Random bytes length must be >= 16");if(!r)r=new Uint8Array(16),i=0;else if(i<0||i+16>r.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);return e??=Date.now(),t??=n[6]*127<<24|n[7]<<16|n[8]<<8|n[9],r[i++]=e/1099511627776&255,r[i++]=e/4294967296&255,r[i++]=e/16777216&255,r[i++]=e/65536&255,r[i++]=e/256&255,r[i++]=e&255,r[i++]=112|t>>>28&15,r[i++]=t>>>20&255,r[i++]=128|t>>>14&63,r[i++]=t>>>6&255,r[i++]=t<<2&255|n[10]&3,r[i++]=n[11],r[i++]=n[12],r[i++]=n[13],r[i++]=n[14],r[i++]=n[15],r}o(tv,"v7Bytes");Ho.default=yI});var iv=y(Pp=>{"use strict";Object.defineProperty(Pp,"__esModule",{value:!0});var vI=Uo();function wI(n){if(!(0,vI.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}o(wI,"version");Pp.default=wI});var Fr=y(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});ze.version=ze.validate=ze.v7=ze.v6ToV1=ze.v6=ze.v5=ze.v4=ze.v3=ze.v1ToV6=ze.v1=ze.stringify=ze.parse=ze.NIL=ze.MAX=void 0;var _I=N2();Object.defineProperty(ze,"MAX",{enumerable:!0,get:o(function(){return _I.default},"get")});var SI=L2();Object.defineProperty(ze,"NIL",{enumerable:!0,get:o(function(){return SI.default},"get")});var bI=Bo();Object.defineProperty(ze,"parse",{enumerable:!0,get:o(function(){return bI.default},"get")});var EI=fi();Object.defineProperty(ze,"stringify",{enumerable:!0,get:o(function(){return EI.default},"get")});var TI=yp();Object.defineProperty(ze,"v1",{enumerable:!0,get:o(function(){return TI.default},"get")});var AI=wp();Object.defineProperty(ze,"v1ToV6",{enumerable:!0,get:o(function(){return AI.default},"get")});var CI=W2();Object.defineProperty(ze,"v3",{enumerable:!0,get:o(function(){return CI.default},"get")});var xI=Y2();Object.defineProperty(ze,"v4",{enumerable:!0,get:o(function(){return xI.default},"get")});var II=X2();Object.defineProperty(ze,"v5",{enumerable:!0,get:o(function(){return II.default},"get")});var OI=J2();Object.defineProperty(ze,"v6",{enumerable:!0,get:o(function(){return OI.default},"get")});var DI=Z2();Object.defineProperty(ze,"v6ToV1",{enumerable:!0,get:o(function(){return DI.default},"get")});var PI=nv();Object.defineProperty(ze,"v7",{enumerable:!0,get:o(function(){return PI.default},"get")});var FI=Uo();Object.defineProperty(ze,"validate",{enumerable:!0,get:o(function(){return FI.default},"get")});var RI=iv();Object.defineProperty(ze,"version",{enumerable:!0,get:o(function(){return RI.default},"get")})});var Br=y(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0});nl.MetadataHelpers=void 0;var Fp=class{static{o(this,"MetadataHelpers")}static findAllReferencingProperties(e,t){let r=[];for(let[i,s]of Object.entries(e))this.containsReference(s,t)&&r.push(i);return r}static findReferencingProperty(e,t){for(let[r,i]of Object.entries(e))if(this.containsReference(i,t))return r}static containsReference(e,t){if(!e)return!1;let r=t.replace(/\.md$/,"");if(typeof e=="string"){let i=/\[\[([^\[\]]+)\]\]/g,s;for(;(s=i.exec(e))!==null;){let c=s[1].split("|")[0].trim();if(c===r||c.endsWith(`/${r}`))return!0}return!1}return Array.isArray(e)?e.some(i=>this.containsReference(i,t)):!1}static isAssetArchived(e){let t=e?.exo__Asset_isArchived;if(t!=null){if(t===!0||t===1)return!0;if(typeof t=="string"){let i=t.toLowerCase().trim();if(i==="true"||i==="yes"||i==="1")return!0}if(typeof t=="boolean")return t}let r=e?.archived;if(r==null)return!1;if(typeof r=="boolean")return r;if(typeof r=="number")return r!==0;if(typeof r=="string"){let i=r.toLowerCase().trim();return i==="true"||i==="yes"||i==="1"}return!1}static getPropertyValue(e,t){return t==="Name"||t==="title"?e.title:t==="created"?e.created:t==="modified"?e.modified:t==="path"?e.path:e.metadata?.[t]}static ensureQuoted(e){return!e||e==='""'?'""':e.startsWith('"')&&e.endsWith('"')?e:`"${e}"`}static buildFileContent(e,t){let r=Object.entries(e).map(([s,a])=>{if(Array.isArray(a)){let c=a.map(u=>`  - ${u}`).join(`
`);return`${s}:
${c}`}return`${s}: ${a}`}).join(`
`),i=t?`
${t}
`:`
`;return`---
${r}
---
${i}`}};nl.MetadataHelpers=Fp});var hr=y(il=>{"use strict";Object.defineProperty(il,"__esModule",{value:!0});il.DateFormatter=void 0;var Rp=class n{static{o(this,"DateFormatter")}static toISOTimestamp(e){return e.toISOString().replace(/\.\d{3}Z$/,"Z")}static toLocalTimestamp(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),c=String(e.getSeconds()).padStart(2,"0");return`${t}-${r}-${i}T${s}:${a}:${c}`}static toDateWikilink(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`"[[${t}-${r}-${i}]]"`}static getTodayWikilink(){return n.toDateWikilink(new Date)}static toDateString(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${i}`}static parseWikilink(e){let r=e.replace(/^["']|["']$/g,"").match(/\[\[(\d{4}-\d{2}-\d{2})\]\]/);return r?r[1]:null}static addDays(e,t){let r=new Date(e);return r.setDate(r.getDate()+t),r}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}static getTodayStartTimestamp(){let e=new Date;return e.setHours(0,0,0,0),n.toLocalTimestamp(e)}static toTimestampAtStartOfDay(e){let t=e.split("-").map(Number);if(t.length!==3||t.some(isNaN))throw new Error(`Invalid date format: ${e}. Expected YYYY-MM-DD`);let[r,i,s]=t,a=new Date(r,i-1,s,0,0,0,0);if(isNaN(a.getTime()))throw new Error(`Invalid date values: ${e}`);return n.toLocalTimestamp(a)}static normalizeTimestamp(e){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return e;let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`Invalid timestamp format: ${e}`);return n.toISOTimestamp(t)}static isISOTimestamp(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e)}};il.DateFormatter=Rp});var Yo=y(sl=>{"use strict";Object.defineProperty(sl,"__esModule",{value:!0});sl.MetadataExtractor=void 0;var NI=Br(),Np=class{static{o(this,"MetadataExtractor")}constructor(e){this.vault=e}extractMetadata(e){return e?this.vault.getFrontmatter(e)||{}:{}}extractInstanceClass(e){return e.exo__Instance_class||null}extractStatus(e){return e.ems__Effort_status||null}extractIsArchived(e){return NI.MetadataHelpers.isAssetArchived(e)}static extractIsDefinedBy(e){let t=e.exo__Asset_isDefinedBy||'""';return Array.isArray(t)&&(t=t[0]||'""'),t}extractExpectedFolder(e){let t=e.exo__Asset_isDefinedBy;if(!t)return null;let r=Array.isArray(t)?t[0]:t;if(!r||typeof r!="string")return null;let i=r.replace(/["'[\]]/g,"").trim();if(!i)return null;let s=i.split("/");return s.pop(),s.join("/")}extractCommandVisibilityContext(e){let t=this.extractMetadata(e),r=this.extractInstanceClass(t),i=this.extractStatus(t),s=this.extractIsArchived(t),a=e.parent?.path||"",c=this.extractExpectedFolder(t);return{instanceClass:r,currentStatus:i,metadata:t,isArchived:s,currentFolder:a,expectedFolder:c}}extractCache(e){return e?this.vault.getFrontmatter(e):null}};sl.MetadataExtractor=Np});var al=y(As=>{"use strict";var LI=As&&As.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(As,"__esModule",{value:!0});As.TaskFrontmatterGenerator=void 0;var kI=qe(),sv=Fr(),Lp=hr(),jI=gs(),av=Yo(),ov=Br(),gt=Qt(),MI=Di(),VI={[gt.AssetClass.AREA]:"ems__Effort_area",[gt.AssetClass.PROJECT]:"ems__Effort_parent",[gt.AssetClass.TASK_PROTOTYPE]:"exo__Asset_prototype",[gt.AssetClass.MEETING_PROTOTYPE]:"exo__Asset_prototype",[gt.AssetClass.EVENT_PROTOTYPE]:"exo__Asset_prototype",[gt.AssetClass.PROJECT_PROTOTYPE]:"exo__Asset_prototype"},$I={[gt.AssetClass.AREA]:gt.AssetClass.TASK,[gt.AssetClass.PROJECT]:gt.AssetClass.TASK,[gt.AssetClass.TASK_PROTOTYPE]:gt.AssetClass.TASK,[gt.AssetClass.MEETING_PROTOTYPE]:gt.AssetClass.MEETING,[gt.AssetClass.EVENT_PROTOTYPE]:gt.AssetClass.EVENT,[gt.AssetClass.PROJECT_PROTOTYPE]:gt.AssetClass.PROJECT},kp=class{static{o(this,"TaskFrontmatterGenerator")}generateTaskFrontmatter(e,t,r,i,s,a,c){let u=new Date,l=Lp.DateFormatter.toLocalTimestamp(u),h=av.MetadataExtractor.extractIsDefinedBy(e),f=jI.WikiLinkHelpers.normalize(r),d=VI[f],m=$I[f]||gt.AssetClass.TASK,_={};_.exo__Asset_isDefinedBy=ov.MetadataHelpers.ensureQuoted(h),_.exo__Asset_uid=s||(0,sv.v4)(),_.exo__Asset_createdAt=l,_.exo__Instance_class=[`"[[${m}]]"`],_.ems__Effort_status='"[[ems__EffortStatusDraft]]"',d?_[d]=`"[[${t}]]"`:(0,MI.isPrototypeClass)(r,e)&&(_.exo__Asset_prototype=`"[[${t}]]"`);let S=i;if(m===gt.AssetClass.MEETING&&(!i||i.trim()==="")){let A=e.exo__Asset_label||t,I=Lp.DateFormatter.toDateString(u);S=`${A} ${I}`}if(S&&S.trim()!==""){let A=S.trim();_.exo__Asset_label=A,_.aliases=[A]}return a&&(_.ems__Task_size=a),c&&(_.ems__Effort_plannedStartTimestamp=c),_}generateRelatedTaskFrontmatter(e,t,r,i,s){let a=new Date,c=Lp.DateFormatter.toLocalTimestamp(a),u=av.MetadataExtractor.extractIsDefinedBy(e),l={};if(l.exo__Asset_isDefinedBy=ov.MetadataHelpers.ensureQuoted(u),l.exo__Asset_uid=i||(0,sv.v4)(),l.exo__Asset_createdAt=c,l.exo__Instance_class=[`"[[${gt.AssetClass.TASK}]]"`],l.ems__Effort_status='"[[ems__EffortStatusDraft]]"',l.exo__Asset_relates=[`"[[${t}]]"`],r&&r.trim()!==""){let h=r.trim();l.exo__Asset_label=h,l.aliases=[h]}return s&&(l.ems__Task_size=s),l}};As.TaskFrontmatterGenerator=kp;As.TaskFrontmatterGenerator=kp=LI([(0,kI.injectable)()],kp)});var ol=y(Cs=>{"use strict";var UI=Cs&&Cs.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(Cs,"__esModule",{value:!0});Cs.AlgorithmExtractor=void 0;var BI=qe(),jp=class{static{o(this,"AlgorithmExtractor")}extractH2Section(e,t){let r=e.split(`
`),i=`## ${t}`,s=!1,a=[];for(let u of r){if(u.trim()===i){s=!0;continue}if(s){if(u.startsWith("## ")||u.startsWith("# "))break;a.push(u)}}return a.length===0?null:a.join(`
`).trim()||null}};Cs.AlgorithmExtractor=jp;Cs.AlgorithmExtractor=jp=UI([(0,BI.injectable)()],jp)});var uv=y(cv=>{"use strict";Object.defineProperty(cv,"__esModule",{value:!0})});var ot=y(cl=>{"use strict";Object.defineProperty(cl,"__esModule",{value:!0});cl.DI_TOKENS=void 0;cl.DI_TOKENS={IFileSystemAdapter:Symbol.for("IFileSystemAdapter"),IVaultAdapter:Symbol.for("IVaultAdapter"),IVaultContext:Symbol.for("IVaultContext"),IMultiVaultManager:Symbol.for("IMultiVaultManager"),ILogger:Symbol.for("ILogger"),IEventBus:Symbol.for("IEventBus"),IConfiguration:Symbol.for("IConfiguration"),INotificationService:Symbol.for("INotificationService"),TaskCreationService:Symbol.for("TaskCreationService"),ProjectCreationService:Symbol.for("ProjectCreationService"),AreaCreationService:Symbol.for("AreaCreationService"),ClassCreationService:Symbol.for("ClassCreationService"),ConceptCreationService:Symbol.for("ConceptCreationService"),FleetingNoteCreationService:Symbol.for("FleetingNoteCreationService"),SupervisionCreationService:Symbol.for("SupervisionCreationService"),GenericAssetCreationService:Symbol.for("GenericAssetCreationService"),TaskFrontmatterGenerator:Symbol.for("TaskFrontmatterGenerator"),DynamicFrontmatterGenerator:Symbol.for("DynamicFrontmatterGenerator"),AlgorithmExtractor:Symbol.for("AlgorithmExtractor"),TaskStatusService:Symbol.for("TaskStatusService"),EffortStatusWorkflow:Symbol.for("EffortStatusWorkflow"),StatusTimestampService:Symbol.for("StatusTimestampService"),PropertyCleanupService:Symbol.for("PropertyCleanupService"),FolderRepairService:Symbol.for("FolderRepairService"),LabelToAliasService:Symbol.for("LabelToAliasService"),RenameToUidService:Symbol.for("RenameToUidService"),PlanningService:Symbol.for("PlanningService"),EffortVotingService:Symbol.for("EffortVotingService"),SessionEventService:Symbol.for("SessionEventService"),AssetConversionService:Symbol.for("AssetConversionService"),NoteToRDFConverter:Symbol.for("NoteToRDFConverter"),AreaHierarchyBuilder:Symbol.for("AreaHierarchyBuilder"),URIConstructionService:Symbol.for("URIConstructionService"),WebhookService:Symbol.for("WebhookService"),EmbeddingService:Symbol.for("EmbeddingService"),VectorStore:Symbol.for("VectorStore"),SemanticSearchService:Symbol.for("SemanticSearchService")}});var Vp=y(Ut=>{"use strict";var qI=Ut&&Ut.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),GI=Ut&&Ut.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),WI=Ut&&Ut.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},zI=Ut&&Ut.__importStar||(function(){var n=o(function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)},"ownKeys");return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&qI(t,e,r[i]);return GI(t,e),t}})(),HI=Ut&&Ut.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},YI=Ut&&Ut.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Ut,"__esModule",{value:!0});Ut.TaskCreationService=void 0;var lv=qe(),hv=Fr(),QI=gs(),fv=Br(),KI=Qt(),XI=al(),JI=ol(),UM=zI(uv()),ZI=ot(),Mp=class{static{o(this,"TaskCreationService")}constructor(e,t,r){this.vault=e,this.frontmatterGenerator=t,this.algorithmExtractor=r}async createTask(e,t,r,i,s,a){let c=(0,hv.v4)(),u=`${c}.md`,l=this.frontmatterGenerator.generateTaskFrontmatter(t,e.basename,r,i,c,s,a),h="";if(QI.WikiLinkHelpers.normalize(r)===KI.AssetClass.TASK_PROTOTYPE){let A=await this.vault.read(e),I=this.algorithmExtractor.extractH2Section(A,"Algorithm");I&&(h=`## Algorithm

${I}`)}let d=fv.MetadataHelpers.buildFileContent(l,h),m=e.parent?.path||"",_=m?`${m}/${u}`:u;return await this.vault.create(_,d)}async createRelatedTask(e,t,r,i){let s=(0,hv.v4)(),a=`${s}.md`,c=this.frontmatterGenerator.generateRelatedTaskFrontmatter(t,e.basename,r,s,i),u=fv.MetadataHelpers.buildFileContent(c),l=e.parent?.path||"",h=l?`${l}/${a}`:a,f=await this.vault.create(h,u);return await this.addRelationToSourceFile(e,s),f}generateTaskFrontmatter(e,t,r,i,s,a,c){return this.frontmatterGenerator.generateTaskFrontmatter(e,t,r,i,s,a,c)}generateRelatedTaskFrontmatter(e,t,r,i,s){return this.frontmatterGenerator.generateRelatedTaskFrontmatter(e,t,r,i,s)}extractH2Section(e,t){return this.algorithmExtractor.extractH2Section(e,t)}async addRelationToSourceFile(e,t){let r=await this.vault.read(e),i=this.addRelationToFrontmatter(r,t);await this.vault.modify(e,i)}addRelationToFrontmatter(e,t){let r=/^---\r?\n([\s\S]*?)\r?\n---/,i=e.match(r),s=e.includes(`\r
`)?`\r
`:`
`;if(!i)return`---${s}exo__Asset_relates:${s}  - "[[${t}]]"${s}---${s}${e}`;let c=i[1];if(c.includes("exo__Asset_relates:")){let u=c.match(/exo__Asset_relates:\r?\n((?: {2}- .*\r?\n)*)/);if(u){let l=u[1],h=`  - "[[${t}]]"${s}`;c=c.replace(/exo__Asset_relates:\r?\n((?: {2}- .*\r?\n)*)/,`exo__Asset_relates:${s}${l}${h}`)}}else c+=`${s}exo__Asset_relates:${s}  - "[[${t}]]"`;return e.replace(r,`---${s}${c}${s}---`)}};Ut.TaskCreationService=Mp;Ut.TaskCreationService=Mp=WI([(0,lv.injectable)(),YI(0,(0,lv.inject)(ZI.DI_TOKENS.IVaultAdapter)),HI("design:paramtypes",[Object,XI.TaskFrontmatterGenerator,JI.AlgorithmExtractor])],Mp)});var Up=y(tn=>{"use strict";var eO=tn&&tn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},tO=tn&&tn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},rO=tn&&tn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(tn,"__esModule",{value:!0});tn.ProjectCreationService=void 0;var dv=qe(),pv=Fr(),nO=gs(),ul=Qt(),iO=hr(),sO=Yo(),mv=Br(),aO=ot(),oO={[ul.AssetClass.AREA]:"ems__Effort_area",[ul.AssetClass.INITIATIVE]:"ems__Effort_parent",[ul.AssetClass.PROJECT]:"ems__Effort_parent"},$p=class{static{o(this,"ProjectCreationService")}constructor(e){this.vault=e}async createProject(e,t,r,i){let s=(0,pv.v4)(),a=`${s}.md`,c=this.generateProjectFrontmatter(t,e.basename,r,i,s),u=mv.MetadataHelpers.buildFileContent(c),l=e.parent?.path||"",h=l?`${l}/${a}`:a;return await this.vault.create(h,u)}generateProjectFrontmatter(e,t,r,i,s){let a=new Date,c=iO.DateFormatter.toLocalTimestamp(a),u=sO.MetadataExtractor.extractIsDefinedBy(e),l=nO.WikiLinkHelpers.normalize(r),h=oO[l]||"ems__Effort_area",f={};if(f.exo__Asset_isDefinedBy=mv.MetadataHelpers.ensureQuoted(u),f.exo__Asset_uid=s||(0,pv.v4)(),f.exo__Asset_createdAt=c,f.exo__Instance_class=[`"[[${ul.AssetClass.PROJECT}]]"`],f.ems__Effort_status='"[[ems__EffortStatusDraft]]"',f[h]=`"[[${t}]]"`,i&&i.trim()!==""){let d=i.trim();f.exo__Asset_label=d,f.aliases=[d]}return f}};tn.ProjectCreationService=$p;tn.ProjectCreationService=$p=eO([(0,dv.injectable)(),rO(0,(0,dv.inject)(aO.DI_TOKENS.IVaultAdapter)),tO("design:paramtypes",[Object])],$p)});var da=y(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.FrontmatterService=void 0;var ll=class n{static{o(this,"FrontmatterService")}parse(e){let t=e.match(n.FRONTMATTER_REGEX);return t?{exists:!0,content:t[1],originalContent:e}:{exists:!1,content:"",originalContent:e}}updateProperty(e,t,r){let i=this.parse(e);if(!i.exists)return this.createFrontmatter(e,{[t]:r});let s=i.content;if(this.hasProperty(s,t)){let a=new RegExp(`${this.escapeRegex(t)}:.*$`,"m");s=s.replace(a,`${t}: ${r}`)}else{let a=s.length>0?`
`:"";s+=`${a}${t}: ${r}`}return e.replace(n.FRONTMATTER_REGEX,`---
${s}
---`)}addProperty(e,t,r){return this.updateProperty(e,t,r)}removeProperty(e,t){let r=this.parse(e);if(!r.exists||!this.hasProperty(r.content,t))return e;let i=new RegExp(`
?${this.escapeRegex(t)}:.*(?:
 {2}- .*)*`,"gm"),s=r.content.replace(i,"");return e.replace(n.FRONTMATTER_REGEX,`---
${s}
---`)}hasProperty(e,t){return e.includes(`${t}:`)}createFrontmatter(e,t){let i=`---
${Object.entries(t).map(([a,c])=>`${a}: ${c}`).join(`
`)}
---`,s=e.startsWith(`
`)?"":`
`;return`${i}${s}${e}`}getPropertyValue(e,t){let r=new RegExp(`${this.escapeRegex(t)}:\\s*(.*)$`,"m"),i=e.match(r);return i?i[1].trim():null}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};hl.FrontmatterService=ll;ll.FRONTMATTER_REGEX=/^---\n([\s\S]*?)\n---/});var fl=y(xs=>{"use strict";var cO=xs&&xs.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(xs,"__esModule",{value:!0});xs.EffortStatusWorkflow=void 0;var uO=qe(),Rr=Qt(),Bp=class{static{o(this,"EffortStatusWorkflow")}getPreviousStatus(e,t){let r=this.normalizeStatus(e);if(r===Rr.EffortStatus.DRAFT)return null;if(r===Rr.EffortStatus.BACKLOG)return this.wrapStatus(Rr.EffortStatus.DRAFT);if(r===Rr.EffortStatus.ANALYSIS)return this.wrapStatus(Rr.EffortStatus.BACKLOG);if(r===Rr.EffortStatus.TODO)return this.wrapStatus(Rr.EffortStatus.ANALYSIS);if(r===Rr.EffortStatus.DOING)return this.hasInstanceClass(t,Rr.AssetClass.PROJECT)?this.wrapStatus(Rr.EffortStatus.TODO):this.wrapStatus(Rr.EffortStatus.BACKLOG);if(r===Rr.EffortStatus.DONE)return this.wrapStatus(Rr.EffortStatus.DOING)}normalizeStatus(e){return e.replace(/["'[\]]/g,"").trim()}wrapStatus(e){return`"[[${e}]]"`}hasInstanceClass(e,t){return e?(Array.isArray(e)?e:[e]).some(i=>i.replace(/["'[\]]/g,"").trim()===t):!1}};xs.EffortStatusWorkflow=Bp;xs.EffortStatusWorkflow=Bp=cO([(0,uO.injectable)()],Bp)});var dl=y(rn=>{"use strict";var lO=rn&&rn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},hO=rn&&rn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},fO=rn&&rn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(rn,"__esModule",{value:!0});rn.StatusTimestampService=void 0;var gv=qe(),dO=da(),Qo=hr(),pO=ot(),qp=class{static{o(this,"StatusTimestampService")}constructor(e){this.vault=e,this.frontmatterService=new dO.FrontmatterService}async addStartTimestamp(e){let t=await this.vault.read(e),r=Qo.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_startTimestamp",r);await this.vault.modify(e,i)}async addEndTimestamp(e,t){let r=await this.vault.read(e),i=t||new Date,s=Qo.DateFormatter.toLocalTimestamp(i),a=this.frontmatterService.updateProperty(r,"ems__Effort_endTimestamp",s);await this.vault.modify(e,a)}async addResolutionTimestamp(e){let t=await this.vault.read(e),r=Qo.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_resolutionTimestamp",r);await this.vault.modify(e,i)}async addEndAndResolutionTimestamps(e,t){let r=await this.vault.read(e),i=t||new Date,s=Qo.DateFormatter.toLocalTimestamp(i),a=this.frontmatterService.updateProperty(r,"ems__Effort_endTimestamp",s);a=this.frontmatterService.updateProperty(a,"ems__Effort_resolutionTimestamp",s),await this.vault.modify(e,a)}async removeStartTimestamp(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_startTimestamp");await this.vault.modify(e,r)}async removeEndTimestamp(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_endTimestamp");await this.vault.modify(e,r)}async removeResolutionTimestamp(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_resolutionTimestamp");await this.vault.modify(e,r)}async removeEndAndResolutionTimestamps(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_endTimestamp");r=this.frontmatterService.removeProperty(r,"ems__Effort_resolutionTimestamp"),await this.vault.modify(e,r)}async shiftPlannedEndTimestamp(e,t){let r=await this.vault.read(e),i=this.frontmatterService.parse(r);if(!i.exists)return;let s=this.frontmatterService.getPropertyValue(i.content,"ems__Effort_plannedEndTimestamp");if(!s)return;let a=new Date(s.replace(/["']/g,""));if(isNaN(a.getTime()))return;let c=new Date(a.getTime()+t),u=Qo.DateFormatter.toLocalTimestamp(c),l=this.frontmatterService.updateProperty(r,"ems__Effort_plannedEndTimestamp",u);await this.vault.modify(e,l)}};rn.StatusTimestampService=qp;rn.StatusTimestampService=qp=lO([(0,gv.injectable)(),fO(0,(0,gv.inject)(pO.DI_TOKENS.IVaultAdapter)),hO("design:paramtypes",[Object])],qp)});var Wp=y(nn=>{"use strict";var mO=nn&&nn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},gO=nn&&nn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},yO=nn&&nn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(nn,"__esModule",{value:!0});nn.TaskStatusService=void 0;var yv=qe(),vO=da(),Is=hr(),wO=fl(),_O=dl(),SO=ot(),Gp=class{static{o(this,"TaskStatusService")}constructor(e,t,r){this.vault=e,this.workflow=t,this.timestampService=r,this.frontmatterService=new vO.FrontmatterService}async setDraftStatus(e){await this.updateStatus(e,"ems__EffortStatusDraft")}async moveToBacklog(e){await this.updateStatus(e,"ems__EffortStatusBacklog")}async moveToAnalysis(e){await this.updateStatus(e,"ems__EffortStatusAnalysis")}async moveToToDo(e){await this.updateStatus(e,"ems__EffortStatusToDo")}async startEffort(e){let t=await this.vault.read(e),r=Is.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_status",'"[[ems__EffortStatusDoing]]"');i=this.frontmatterService.updateProperty(i,"ems__Effort_startTimestamp",r),await this.vault.modify(e,i)}async markTaskAsDone(e){let t=await this.vault.read(e),r=Is.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_status",'"[[ems__EffortStatusDone]]"');i=this.frontmatterService.updateProperty(i,"ems__Effort_endTimestamp",r),i=this.frontmatterService.updateProperty(i,"ems__Effort_resolutionTimestamp",r),await this.vault.modify(e,i)}async syncEffortEndTimestamp(e,t){await this.timestampService.addEndAndResolutionTimestamps(e,t)}async shiftPlannedEndTimestamp(e,t){await this.timestampService.shiftPlannedEndTimestamp(e,t)}async trashEffort(e,t){let r=await this.vault.read(e),i=Is.DateFormatter.toLocalTimestamp(new Date),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusTrashed]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),t&&(s=this.appendTrashReason(s,t)),await this.vault.modify(e,s)}appendTrashReason(e,t){let r=`

## Trash Reason

${t}`;return e.trimEnd()+r}async archiveTask(e){let t=await this.vault.read(e),r=this.frontmatterService.updateProperty(t,"archived","true");r=this.frontmatterService.removeProperty(r,"aliases"),await this.vault.modify(e,r)}async planOnToday(e){let t=await this.vault.read(e),r=Is.DateFormatter.getTodayStartTimestamp(),i=this.frontmatterService.updateProperty(t,"ems__Effort_plannedStartTimestamp",r);await this.vault.modify(e,i)}async planForEvening(e){let t=await this.vault.read(e),r=new Date;r.setHours(19,0,0,0);let i=Is.DateFormatter.toLocalTimestamp(r),s=this.frontmatterService.updateProperty(t,"ems__Effort_plannedStartTimestamp",i);await this.vault.modify(e,s)}async shiftDayBackward(e){await this.shiftDay(e,-1)}async shiftDayForward(e){await this.shiftDay(e,1)}async rollbackStatus(e){let t=await this.vault.read(e),r=this.extractCurrentStatus(t),i=this.extractInstanceClass(t);if(!r)throw new Error("No current status to rollback from");let s=this.workflow.getPreviousStatus(r,i);if(s===void 0)throw new Error("Cannot rollback from current status");let a=t;s===null?a=this.frontmatterService.removeProperty(a,"ems__Effort_status"):a=this.frontmatterService.updateProperty(a,"ems__Effort_status",s);let c=this.workflow.normalizeStatus(r);c==="ems__EffortStatusDone"?(a=this.frontmatterService.removeProperty(a,"ems__Effort_endTimestamp"),a=this.frontmatterService.removeProperty(a,"ems__Effort_resolutionTimestamp")):c==="ems__EffortStatusDoing"&&(a=this.frontmatterService.removeProperty(a,"ems__Effort_startTimestamp")),await this.vault.modify(e,a)}async updateStatus(e,t){let r=await this.vault.read(e),i=this.frontmatterService.updateProperty(r,"ems__Effort_status",`"[[${t}]]"`);await this.vault.modify(e,i)}async shiftDay(e,t){let r=await this.vault.read(e),i=this.extractPlannedStartTimestamp(r);if(!i)throw new Error("ems__Effort_plannedStartTimestamp property not found");let s=this.parseDateFromTimestamp(i);if(!s)throw new Error("Invalid date format in ems__Effort_plannedStartTimestamp");let a=Is.DateFormatter.addDays(s,t);a.setHours(0,0,0,0);let c=Is.DateFormatter.toLocalTimestamp(a),u=this.frontmatterService.updateProperty(r,"ems__Effort_plannedStartTimestamp",c);await this.vault.modify(e,u)}parseDateFromTimestamp(e){let t=new Date(e);return isNaN(t.getTime())?null:t}extractPlannedStartTimestamp(e){let t=this.frontmatterService.parse(e);return t.exists?this.frontmatterService.getPropertyValue(t.content,"ems__Effort_plannedStartTimestamp"):null}extractCurrentStatus(e){let t=this.frontmatterService.parse(e);return t.exists?this.frontmatterService.getPropertyValue(t.content,"ems__Effort_status"):null}extractInstanceClass(e){let t=this.frontmatterService.parse(e);if(!t.exists)return null;let r=t.content.match(/exo__Instance_class:\s*\n((?:\s*-\s*.*\n?)+)/);return r?r[1].split(`
`).filter(s=>s.trim()).map(s=>s.replace(/^\s*-\s*/,"").trim()):this.frontmatterService.getPropertyValue(t.content,"exo__Instance_class")}};nn.TaskStatusService=Gp;nn.TaskStatusService=Gp=mO([(0,yv.injectable)(),yO(0,(0,yv.inject)(SO.DI_TOKENS.IVaultAdapter)),gO("design:paramtypes",[Object,wO.EffortStatusWorkflow,_O.StatusTimestampService])],Gp)});var Hp=y(sn=>{"use strict";var bO=sn&&sn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},EO=sn&&sn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},TO=sn&&sn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(sn,"__esModule",{value:!0});sn.AreaCreationService=void 0;var vv=qe(),wv=Fr(),AO=Qt(),CO=hr(),xO=Yo(),_v=Br(),IO=ot(),zp=class{static{o(this,"AreaCreationService")}constructor(e){this.vault=e}async createChildArea(e,t,r){let i=(0,wv.v4)(),s=`${i}.md`,a=this.generateChildAreaFrontmatter(t,e.basename,r,i),c=_v.MetadataHelpers.buildFileContent(a),u=e.parent?.path||"",l=u?`${u}/${s}`:s;return await this.vault.create(l,c)}generateChildAreaFrontmatter(e,t,r,i){let s=new Date,a=CO.DateFormatter.toLocalTimestamp(s),c=xO.MetadataExtractor.extractIsDefinedBy(e),u={};if(u.exo__Asset_isDefinedBy=_v.MetadataHelpers.ensureQuoted(c),u.exo__Asset_uid=i||(0,wv.v4)(),u.exo__Asset_createdAt=a,u.exo__Instance_class=[`"[[${AO.AssetClass.AREA}]]"`],u.ems__Area_parent=`"[[${t}]]"`,r&&r.trim()!==""){let l=r.trim();u.exo__Asset_label=l,u.aliases=[l]}return u}};sn.AreaCreationService=zp;sn.AreaCreationService=zp=bO([(0,vv.injectable)(),TO(0,(0,vv.inject)(IO.DI_TOKENS.IVaultAdapter)),EO("design:paramtypes",[Object])],zp)});var Qp=y(an=>{"use strict";var OO=an&&an.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},DO=an&&an.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},PO=an&&an.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(an,"__esModule",{value:!0});an.AreaHierarchyBuilder=void 0;var Sv=qe(),bv=Qt(),FO=ot(),Yp=class{static{o(this,"AreaHierarchyBuilder")}constructor(e){this.vault=e}buildHierarchy(e,t){let r=this.vault.getAbstractFileByPath(e);if(!this.isFile(r))return null;let i=this.vault.getFrontmatter(r)||{};if(this.extractInstanceClass(i)!==bv.AssetClass.AREA)return null;let a=this.collectAllAreasFromVault(),c=new Set;return this.buildTree(e,a,c,0)}isFile(e){return e&&typeof e=="object"&&"basename"in e&&"path"in e}extractInstanceClass(e){let t=e.exo__Instance_class||"";return Array.isArray(t)?this.cleanWikiLink(t[0]||""):this.cleanWikiLink(t)}cleanWikiLink(e){return typeof e!="string"?"":e.replace(/^\[\[|\]\]$/g,"").trim()}collectAllAreasFromVault(){let e=new Map,t=new Map,r=this.vault.getAllFiles();for(let i of r){let s=this.vault.getFrontmatter(i)||{};if(this.extractInstanceClass(s)===bv.AssetClass.AREA){let c=this.extractParentPath(s);e.set(i.path,{path:i.path,title:i.basename,label:s.exo__Asset_label||void 0,isArchived:this.isArchived(s),depth:0,parentPath:c||void 0}),t.set(i.basename,i.path)}}for(let[,i]of e.entries())i.parentPath&&t.has(i.parentPath)&&(i.parentPath=t.get(i.parentPath));return e}extractParentPath(e){let t=e.ems__Area_parent;if(!t)return null;if(Array.isArray(t)){let r=t[0]||"";return this.cleanWikiLink(r)}return this.cleanWikiLink(t)}isArchived(e){let t=e.exo__Asset_archived;if(t===!0||t==="true")return!0;if(Array.isArray(t)&&t.length>0){let r=t[0];return r===!0||r==="true"}return!1}buildTree(e,t,r,i){if(r.has(e))return null;r.add(e);let s=t.get(e);if(!s)return null;let a=[];for(let[c,u]of t.entries())if(u.parentPath===e){let l=this.buildTree(c,t,r,i+1);l&&a.push(l)}return a.sort((c,u)=>{let l=c.label||c.title,h=u.label||u.title;return l.localeCompare(h)}),{path:s.path,title:s.title,label:s.label,isArchived:s.isArchived,depth:i,parentPath:s.parentPath,children:a}}};an.AreaHierarchyBuilder=Yp;an.AreaHierarchyBuilder=Yp=OO([(0,Sv.injectable)(),PO(0,(0,Sv.inject)(FO.DI_TOKENS.IVaultAdapter)),DO("design:paramtypes",[Object])],Yp)});var Xp=y(on=>{"use strict";var RO=on&&on.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},NO=on&&on.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},LO=on&&on.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(on,"__esModule",{value:!0});on.ClassCreationService=void 0;var Ev=qe(),kO=Fr(),jO=hr(),MO=Br(),VO=ot(),Kp=class{static{o(this,"ClassCreationService")}constructor(e){this.vault=e}async createSubclass(e,t,r){let i=(0,kO.v4)(),s=this.generateFileName(t),a=s.endsWith(".md")?s:`${s}.md`,c=this.generateClassFrontmatter(e.basename,t,i,r),u=MO.MetadataHelpers.buildFileContent(c),l="classes",h=`${l}/${a}`;return this.vault.getAbstractFileByPath(l)||await this.vault.createFolder(l),await this.vault.create(h,u)}generateFileName(e){let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"-");for(;t.startsWith("-");)t=t.slice(1);for(;t.endsWith("-");)t=t.slice(0,-1);return t}generateClassFrontmatter(e,t,r,i){let s=new Date,a=jO.DateFormatter.toLocalTimestamp(s),c={};c.exo__Asset_uid=r,c.exo__Asset_label=t,c.exo__Asset_createdAt=a,c.exo__Instance_class=['"[[exo__Class]]"'],c.exo__Class_superClass=`"[[${e}]]"`;let u=i.exo__Asset_isDefinedBy||'"[[Ontology/EXO]]"';return c.exo__Asset_isDefinedBy=u,c.aliases=[t],c}};on.ClassCreationService=Kp;on.ClassCreationService=Kp=RO([(0,Ev.injectable)(),LO(0,(0,Ev.inject)(VO.DI_TOKENS.IVaultAdapter)),NO("design:paramtypes",[Object])],Kp)});var Zp=y(cn=>{"use strict";var $O=cn&&cn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},UO=cn&&cn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},BO=cn&&cn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(cn,"__esModule",{value:!0});cn.ConceptCreationService=void 0;var Tv=qe(),qO=Fr(),GO=hr(),WO=Br(),zO=Qt(),HO=ot(),Jp=class{static{o(this,"ConceptCreationService")}constructor(e){this.vault=e}async createNarrowerConcept(e,t,r,i){let s=(0,qO.v4)(),a=t.endsWith(".md")?t:`${t}.md`,c=this.generateConceptFrontmatter(e.basename,r,i,s),u=WO.MetadataHelpers.buildFileContent(c),l="concepts",h=`${l}/${a}`;return this.vault.getAbstractFileByPath(l)||await this.vault.createFolder(l),await this.vault.create(h,u)}generateConceptFrontmatter(e,t,r,i){let s=new Date,a=GO.DateFormatter.toLocalTimestamp(s),c={};return c.exo__Asset_isDefinedBy='"[[!concepts]]"',c.exo__Asset_uid=i,c.exo__Asset_createdAt=a,c.exo__Instance_class=[`"[[${zO.AssetClass.CONCEPT}]]"`],c.ims__Concept_broader=`"[[${e}]]"`,c.ims__Concept_definition=t,r.length>0&&(c.aliases=r),c}};cn.ConceptCreationService=Jp;cn.ConceptCreationService=Jp=$O([(0,Tv.injectable)(),BO(0,(0,Tv.inject)(HO.DI_TOKENS.IVaultAdapter)),UO("design:paramtypes",[Object])],Jp)});var tm=y(un=>{"use strict";var YO=un&&un.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},QO=un&&un.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},KO=un&&un.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(un,"__esModule",{value:!0});un.EffortVotingService=void 0;var Av=qe(),XO=ot(),em=class{static{o(this,"EffortVotingService")}constructor(e){this.vault=e}async incrementEffortVotes(e){let t=await this.vault.read(e),i=this.extractVoteCount(t)+1,s=this.updateFrontmatterWithVotes(t,i);return await this.vault.modify(e,s),i}extractVoteCount(e){let t=/^---\r?\n([\s\S]*?)\r?\n---/,r=e.match(t);if(!r)return 0;let s=r[1].match(/ems__Effort_votes:\s*(\d+)/);return s&&s[1]?parseInt(s[1],10):0}updateFrontmatterWithVotes(e,t){let r=/^---\r?\n([\s\S]*?)\r?\n---/,i=e.match(r),s=e.includes(`\r
`)?`\r
`:`
`;if(!i)return`---${s}ems__Effort_votes: ${t}${s}---${s}${e}`;let c=i[1];return c.includes("ems__Effort_votes:")?c=c.replace(/ems__Effort_votes:.*$/m,`ems__Effort_votes: ${t}`):c+=`${s}ems__Effort_votes: ${t}`,e.replace(r,`---${s}${c}${s}---`)}};un.EffortVotingService=em;un.EffortVotingService=em=YO([(0,Av.injectable)(),KO(0,(0,Av.inject)(XO.DI_TOKENS.IVaultAdapter)),QO("design:paramtypes",[Object])],em)});var nm=y(ln=>{"use strict";var JO=ln&&ln.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},ZO=ln&&ln.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},eD=ln&&ln.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(ln,"__esModule",{value:!0});ln.FolderRepairService=void 0;var Cv=qe(),tD=ot(),rm=class{static{o(this,"FolderRepairService")}constructor(e){this.vault=e}async getExpectedFolder(e,t){let r=t?.exo__Asset_isDefinedBy;if(!r)return null;let i=this.extractReference(r);if(!i)return null;let s=this.vault.getFirstLinkpathDest(i,e.path);return s?this.getFileFolder(s):null}async repairFolder(e,t){let r=`${t}/${e.name}`;if(this.vault.getAbstractFileByPath(r))throw new Error(`Cannot move file: ${r} already exists`);await this.ensureFolderExists(t),await this.vault.rename(e,r)}getFileFolder(e){return e.parent?.path||""}extractReference(e){if(typeof e!="string")return null;let t=e.trim().replace(/^["']|["']$/g,"");return t=t.replace(/^\[\[|\]\]$/g,""),t||null}async ensureFolderExists(e){if(!e)return;let t=this.vault.getAbstractFileByPath(e);if(!(t&&"children"in t))try{await this.vault.createFolder(e)}catch(r){if(r instanceof Error&&r.message.includes("Folder already exists"))return;throw r}}};ln.FolderRepairService=rm;ln.FolderRepairService=rm=JO([(0,Cv.injectable)(),eD(0,(0,Cv.inject)(tD.DI_TOKENS.IVaultAdapter)),ZO("design:paramtypes",[Object])],rm)});var sm=y(hn=>{"use strict";var rD=hn&&hn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},nD=hn&&hn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},iD=hn&&hn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(hn,"__esModule",{value:!0});hn.LabelToAliasService=void 0;var xv=qe(),sD=ot(),im=class{static{o(this,"LabelToAliasService")}constructor(e){this.vault=e}async copyLabelToAliases(e){let t=await this.vault.read(e),r=this.extractLabel(t);if(!r)throw new Error("No exo__Asset_label found in file");let i=this.addLabelToAliases(t,r);await this.vault.modify(e,i)}extractLabel(e){let t=/^---\r?\n([\s\S]*?)\r?\n---/,r=e.match(t);if(!r)return null;let s=r[1].match(/exo__Asset_label:\s*["']?([^"'\r\n]+)["']?/);return s&&s[1]?s[1].trim():null}addLabelToAliases(e,t){let r=/^---\r?\n([\s\S]*?)\r?\n---/,i=e.match(r),s=e.includes(`\r
`)?`\r
`:`
`;if(!i)return`---${s}aliases:${s}  - "${t}"${s}---${s}${e}`;let c=i[1];return c.includes("aliases:")?c.match(/(aliases:\r?\n(?: {2}- .*\r?\n)*)/)&&(c=c.replace(/(aliases:\r?\n(?: {2}- .*\r?\n)*)/,`$1  - "${t}"${s}`)):c+=`${s}aliases:${s}  - "${t}"`,e.replace(r,`---${s}${c}${s}---`)}};hn.LabelToAliasService=im;hn.LabelToAliasService=im=rD([(0,xv.injectable)(),iD(0,(0,xv.inject)(sD.DI_TOKENS.IVaultAdapter)),nD("design:paramtypes",[Object])],im)});var Os=y(pl=>{"use strict";Object.defineProperty(pl,"__esModule",{value:!0});pl.LoggingService=void 0;var Ko=class{static{o(this,"LoggingService")}static setVerbose(e){this.isVerbose=e}static setDevelopmentMode(e){this.isDevelopment=e}static checkIsDevelopment(){return this.isDevelopment!==void 0?this.isDevelopment:typeof process<"u"?(this.isDevelopment=!1,this.isDevelopment):(this.isDevelopment=!1,this.isDevelopment)}static debug(e,t){this.isVerbose&&console.debug(`[Exocortex] ${e}`,t??"")}static info(e,t){console.log(`[Exocortex] ${e}`,t??"")}static warn(e,t){console.warn(`[Exocortex] ${e}`,t??"")}static error(e,t,r){let i=this.checkIsDevelopment(),s=r?` [${r}]`:"";if(i){let a=t?.stack?`
  Stack trace:
${t.stack}`:"";console.error(`[Exocortex ERROR]${s} ${e}${a}`,t??"")}else{let a=t?.message?`
  Details: ${t.message}`:"";console.error(`[Exocortex ERROR]${s} ${e}${a}`)}}};pl.LoggingService=Ko;Ko.isVerbose=!1;Ko.isDevelopment=void 0});var cm=y(fn=>{"use strict";var aD=fn&&fn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},oD=fn&&fn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},Iv=fn&&fn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(fn,"__esModule",{value:!0});fn.PropertyCleanupService=void 0;var am=qe(),Ov=ot(),om=class{static{o(this,"PropertyCleanupService")}constructor(e,t){this.vault=e,this.logger=t,this.logger.debug("PropertyCleanupService initialized")}async cleanEmptyProperties(e){this.logger.debug("Cleaning empty properties",{path:e.path});let t=await this.vault.read(e),r=this.removeEmptyPropertiesFromContent(t);await this.vault.modify(e,r),this.logger.info("Empty properties cleaned",{path:e.path})}removeEmptyPropertiesFromContent(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r)return e;let s=r[1].split(`
`),a=[],c=0;for(;c<s.length;){let l=s[c],h=l.trim();if(h===""){a.push(l),c++;continue}let f=h.match(/^([^:]+):\s*(.*)$/);if(f){let d=f[2];if(d===""&&c+1<s.length&&s[c+1].match(/^\s+- /)){let _=[],S=c+1;for(;S<s.length&&s[S].match(/^\s+- /);)_.push(s[S]),S++;if(_.every(I=>{let D=I.replace(/^\s+- /,"").trim();return this.isEmptyValue(D)})){c=S;continue}else{a.push(l);for(let I=c+1;I<S;I++)a.push(s[I]);c=S;continue}}if(this.isEmptyValue(d)){c++;continue}a.push(l),c++}else h.match(/^\s*- /)||a.push(l),c++}let u=a.join(`
`);return e.replace(t,`---
${u}
---`)}isEmptyValue(e){let t=e.trim();return t===""||t==="null"||t==="undefined"||t==="[]"||t==="{}"||t==='""'||t==="''"}};fn.PropertyCleanupService=om;fn.PropertyCleanupService=om=aD([(0,am.injectable)(),Iv(0,(0,am.inject)(Ov.DI_TOKENS.IVaultAdapter)),Iv(1,(0,am.inject)(Ov.DI_TOKENS.ILogger)),oD("design:paramtypes",[Object,Object])],om)});var lm=y(dn=>{"use strict";var cD=dn&&dn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},uD=dn&&dn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},lD=dn&&dn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(dn,"__esModule",{value:!0});dn.RenameToUidService=void 0;var Dv=qe(),hD=ot(),um=class{static{o(this,"RenameToUidService")}constructor(e){this.vault=e}async renameToUid(e,t){let r=t.exo__Asset_uid;if(!r)throw new Error("Asset has no exo__Asset_uid property");let i=e.basename,s=r;if(i===s)throw new Error("File is already named according to UID");let a=t.exo__Asset_label;if(!a||a.trim()===""){let h=this.isAssetArchived(t);await this.updateLabel(e,i,h)}let u=e.parent?.path||"",l=u?`${u}/${s}.md`:`${s}.md`;await this.vault.updateLinks(e.path,l,i),await this.vault.rename(e,l)}async updateLabel(e,t,r){await this.vault.process(e,i=>{let s=/^---\n([\s\S]*?)\n---/,a=i.match(s);if(!a)return i;let c=a[1],u=r?`${c}
exo__Asset_label: ${t}`:`${c}
exo__Asset_label: ${t}
aliases:
  - ${t}`;return i.replace(s,`---
${u}
---`)})}isAssetArchived(e){if(e?.exo__Asset_isArchived===!0)return!0;let t=e?.archived;if(t==null)return!1;if(typeof t=="boolean")return t;if(typeof t=="number")return t!==0;if(typeof t=="string"){let r=t.toLowerCase().trim();return r==="true"||r==="yes"||r==="1"}return!1}};dn.RenameToUidService=um;dn.RenameToUidService=um=cD([(0,Dv.injectable)(),lD(0,(0,Dv.inject)(hD.DI_TOKENS.IVaultAdapter)),uD("design:paramtypes",[Object])],um)});var fm=y(pn=>{"use strict";var fD=pn&&pn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},dD=pn&&pn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},pD=pn&&pn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(pn,"__esModule",{value:!0});pn.SupervisionCreationService=void 0;var Pv=qe(),mD=Fr(),gD=hr(),yD=ot(),hm=class{static{o(this,"SupervisionCreationService")}constructor(e){this.vault=e}async createSupervision(e){let t=(0,mD.v4)(),r=`${t}.md`,i=this.generateFrontmatter(t),s=this.generateBody(e),a=this.buildFileContent(i,s),c=`01 Inbox/${r}`;return await this.vault.create(c,a)}generateFrontmatter(e){let t=new Date,r=gD.DateFormatter.toLocalTimestamp(t);return{exo__Asset_isDefinedBy:'"[[!kitelev]]"',exo__Asset_uid:e,exo__Asset_createdAt:r,exo__Instance_class:['"[[ztlk__FleetingNote]]"'],ztlk__FleetingNote_type:'"[[CBT-Diary Record]]"'}}generateBody(e){return[{label:"\u0421\u0438\u0442\u0443\u0430\u0446\u0438\u044F/\u0442\u0440\u0438\u0433\u0433\u0435\u0440",value:e.situation},{label:"\u042D\u043C\u043E\u0446\u0438\u0438",value:e.emotions},{label:"\u041C\u044B\u0441\u043B\u0438",value:e.thoughts},{label:"\u041F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u0435",value:e.behavior},{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0441\u0440\u043E\u0447\u043D\u044B\u0435 \u043F\u043E\u0441\u043B\u0435\u0434\u0441\u0442\u0432\u0438\u044F \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u044F",value:e.shortTermConsequences},{label:"\u0414\u043E\u043B\u0433\u043E\u0441\u0440\u043E\u0447\u043D\u044B\u0435 \u043F\u043E\u0441\u043B\u0435\u0434\u0441\u0442\u0432\u0438\u044F \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u044F",value:e.longTermConsequences}].map(r=>`- ${r.label}: ${r.value}`).join(`
`)}buildFileContent(e,t){return`---
${Object.entries(e).map(([i,s])=>{if(Array.isArray(s)){let a=s.map(c=>`  - ${c}`).join(`
`);return`${i}:
${a}`}return`${i}: ${s}`}).join(`
`)}
---

${t}
`}};pn.SupervisionCreationService=hm;pn.SupervisionCreationService=hm=fD([(0,Pv.injectable)(),pD(0,(0,Pv.inject)(yD.DI_TOKENS.IVaultAdapter)),dD("design:paramtypes",[Object])],hm)});var pm=y(mn=>{"use strict";var vD=mn&&mn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},wD=mn&&mn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},_D=mn&&mn.__param||function(n,e){return function(t,r){e(t,r,n)}},dm;Object.defineProperty(mn,"__esModule",{value:!0});mn.FleetingNoteCreationService=void 0;var Fv=qe(),SD=Fr(),bD=hr(),ED=Br(),TD=ot(),ml=dm=class{static{o(this,"FleetingNoteCreationService")}constructor(e){this.vault=e}async createFleetingNote(e){let t=(0,SD.v4)(),r=`${t}.md`,i=this.generateFrontmatter(t,e),s=ED.MetadataHelpers.buildFileContent(i),a=`${dm.INBOX_FOLDER}/${r}`;return await this.vault.create(a,s)}generateFrontmatter(e,t){let r=new Date,i=bD.DateFormatter.toLocalTimestamp(r),s=t.trim();return{exo__Asset_isDefinedBy:'"[[!kitelev]]"',exo__Asset_uid:e,exo__Asset_createdAt:i,exo__Instance_class:['"[[ztlk__FleetingNote]]"'],exo__Asset_label:s,aliases:[s]}}};mn.FleetingNoteCreationService=ml;ml.INBOX_FOLDER="01 Inbox";mn.FleetingNoteCreationService=ml=dm=vD([(0,Fv.injectable)(),_D(0,(0,Fv.inject)(TD.DI_TOKENS.IVaultAdapter)),wD("design:paramtypes",[Object])],ml)});var gm=y(Ds=>{"use strict";var AD=Ds&&Ds.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(Ds,"__esModule",{value:!0});Ds.DynamicFrontmatterGenerator=void 0;var CD=qe(),xD=Fr(),Xo=hr(),mm=class{static{o(this,"DynamicFrontmatterGenerator")}generate(e,t,r,i){let s={},a=new Date;i?.isDefinedBy&&(s.exo__Asset_isDefinedBy=this.ensureQuoted(i.isDefinedBy)),s.exo__Asset_uid=i?.uid||(0,xD.v4)(),s.exo__Asset_createdAt=i?.createdAt||Xo.DateFormatter.toLocalTimestamp(a),s.exo__Instance_class=[this.formatWikilink(e)];let c=new Map;for(let l of r)c.set(l.name,l.type);for(let[l,h]of Object.entries(t)){if(h==null||l==="exo__Asset_uid"||l==="exo__Asset_createdAt"||l==="exo__Instance_class"||l==="exo__Asset_isDefinedBy")continue;let f=c.get(l);s[l]=this.formatValue(h,f)}let u=t.exo__Asset_label;if(u&&typeof u=="string"&&u.trim()!==""){let l=u.trim();s.exo__Asset_label=l,s.aliases=[l]}return s}formatValue(e,t){if(e==null)return null;if(!t)return this.formatInferredValue(e);switch(t){case"text":return this.formatText(e);case"wikilink":return this.formatWikilink(e);case"status-select":case"size-select":return this.formatWikilink(e);case"number":return this.formatNumber(e);case"boolean":return this.formatBoolean(e);case"timestamp":return this.formatTimestamp(e);default:return this.formatText(e)}}formatText(e){return typeof e=="string"?e:String(e)}formatWikilink(e){let t=String(e);return t.startsWith('"[[')&&t.endsWith(']]"')?t:t.startsWith("[[")&&t.endsWith("]]")?`"${t}"`:`"[[${t}]]"`}formatNumber(e){if(typeof e=="number")return e;let t=Number(e);return isNaN(t)?0:t}formatBoolean(e){if(typeof e=="boolean")return e;if(typeof e=="string"){let t=e.toLowerCase().trim();return t==="true"||t==="yes"||t==="1"}return typeof e=="number"?e!==0:!!e}formatTimestamp(e){if(e instanceof Date)return Xo.DateFormatter.toLocalTimestamp(e);if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(e))return e;if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return e.replace("Z","");let t=new Date(e);return isNaN(t.getTime())?e:Xo.DateFormatter.toLocalTimestamp(t)}if(typeof e=="number"){let t=new Date(e);if(!isNaN(t.getTime()))return Xo.DateFormatter.toLocalTimestamp(t)}return String(e)}formatInferredValue(e){return typeof e=="boolean"||typeof e=="number"?e:e instanceof Date?Xo.DateFormatter.toLocalTimestamp(e):typeof e=="string"?e.startsWith("[[")||e.startsWith('"[[')?this.formatWikilink(e):e:String(e)}ensureQuoted(e){return!e||e==='""'?'""':e.startsWith('"')&&e.endsWith('"')?e:`"${e}"`}generateYAML(e,t,r,i){let s=this.generate(e,t,r,i);return this.toYAML(s)}toYAML(e){return`---
${Object.entries(e).map(([r,i])=>{if(Array.isArray(i)){let s=i.map(a=>`  - ${a}`).join(`
`);return`${r}:
${s}`}return`${r}: ${i}`}).join(`
`)}
---`}};Ds.DynamicFrontmatterGenerator=mm;Ds.DynamicFrontmatterGenerator=mm=AD([(0,CD.injectable)()],mm)});var vm=y(gn=>{"use strict";var ID=gn&&gn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},OD=gn&&gn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},DD=gn&&gn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(gn,"__esModule",{value:!0});gn.PlanningService=void 0;var Rv=qe(),PD=da(),FD=hr(),RD=ot(),ym=class{static{o(this,"PlanningService")}constructor(e){this.vault=e,this.frontmatterService=new PD.FrontmatterService}async planOnToday(e){let t=this.vault.getAbstractFileByPath(e);if(!t||!this.isFile(t))throw new Error(`File not found: ${e}`);let r=await this.vault.read(t),i=FD.DateFormatter.getTodayStartTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_plannedStartTimestamp",i);await this.vault.modify(t,s)}isFile(e){return"basename"in e}};gn.PlanningService=ym;gn.PlanningService=ym=ID([(0,Rv.injectable)(),DD(0,(0,Rv.inject)(RD.DI_TOKENS.IVaultAdapter)),OD("design:paramtypes",[Object])],ym)});var _m=y(yn=>{"use strict";var ND=yn&&yn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},LD=yn&&yn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},kD=yn&&yn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(yn,"__esModule",{value:!0});yn.AssetConversionService=void 0;var Nv=qe(),Lv=Qt(),jD=da(),gl=Os(),MD=ot(),wm=class{static{o(this,"AssetConversionService")}constructor(e){this.vault=e,this.frontmatterService=new jD.FrontmatterService}async convertTaskToProject(e){try{let t=await this.vault.read(e),r=this.removeInstanceClassProperty(t);return r=this.frontmatterService.updateProperty(r,"exo__Instance_class",`["[[${Lv.AssetClass.PROJECT}]]"]`),await this.vault.modify(e,r),gl.LoggingService.info(`Converted Task to Project: ${e.basename} (${e.path})`),e}catch(t){let r=`Failed to convert Task to Project: ${e.path}`;throw gl.LoggingService.error(r,t instanceof Error?t:void 0),new Error(r)}}async convertProjectToTask(e){try{let t=await this.vault.read(e),r=this.removeInstanceClassProperty(t);return r=this.frontmatterService.updateProperty(r,"exo__Instance_class",`["[[${Lv.AssetClass.TASK}]]"]`),await this.vault.modify(e,r),gl.LoggingService.info(`Converted Project to Task: ${e.basename} (${e.path})`),e}catch(t){let r=`Failed to convert Project to Task: ${e.path}`;throw gl.LoggingService.error(r,t instanceof Error?t:void 0),new Error(r)}}removeInstanceClassProperty(e){let t=this.frontmatterService.parse(e);if(!t.exists)return e;let r=/^exo__Instance_class:.*$(\n  -.*$)*/gm,i=t.content.replace(r,"").replace(/\n\n+/g,`
`).trim();return e.replace(/^---\n[\s\S]*?\n---/,`---
${i}
---`)}};yn.AssetConversionService=wm;yn.AssetConversionService=wm=ND([(0,Nv.injectable)(),kD(0,(0,Nv.inject)(MD.DI_TOKENS.IVaultAdapter)),LD("design:paramtypes",[Object])],wm)});var bm=y(vn=>{"use strict";var VD=vn&&vn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},$D=vn&&vn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},UD=vn&&vn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(vn,"__esModule",{value:!0});vn.SessionEventService=void 0;var kv=qe(),BD=Fr(),jv=Qt(),qD=hr(),GD=Br(),WD=ot(),Sm=class{static{o(this,"SessionEventService")}constructor(e){this.vault=e,this.folderPathCache=null,this.defaultOntologyAsset=null}setDefaultOntologyAsset(e){this.defaultOntologyAsset=e,this.folderPathCache=null}async createSessionStartEvent(e){return this.createSessionEvent(e,jv.AssetClass.SESSION_START_EVENT)}async createSessionEndEvent(e){return this.createSessionEvent(e,jv.AssetClass.SESSION_END_EVENT)}async getOntologyAssetFolder(){if(this.folderPathCache!==null)return this.folderPathCache;if(!this.defaultOntologyAsset){let r=this.vault.getDefaultNewFileParent();return this.folderPathCache=r?.path||"",this.folderPathCache}let e=this.vault.getAllFiles();for(let r of e)if(r.basename===this.defaultOntologyAsset){let i=r.parent?.path||"";return this.folderPathCache=i,this.folderPathCache}let t=this.vault.getDefaultNewFileParent();return this.folderPathCache=t?.path||"",this.folderPathCache}async createSessionEvent(e,t){let r=(0,BD.v4)(),i=qD.DateFormatter.toLocalTimestamp(new Date),s=this.defaultOntologyAsset?`"[[${this.defaultOntologyAsset}]]"`:'"[[!kitelev]]"',a={exo__Asset_uid:r,exo__Asset_createdAt:i,exo__Asset_isDefinedBy:s,exo__Instance_class:[`"[[${t}]]"`],ems__SessionEvent_timestamp:i,ems__Session_area:`"[[${e}]]"`},c=GD.MetadataHelpers.buildFileContent(a),u=await this.getOntologyAssetFolder();u&&!await this.vault.exists(u)&&await this.vault.createFolder(u);let l=u?`${u}/${r}.md`:`${r}.md`;return await this.vault.create(l,c)}};vn.SessionEventService=Sm;vn.SessionEventService=Sm=VD([(0,kv.injectable)(),UD(0,(0,kv.inject)(WD.DI_TOKENS.IVaultAdapter)),$D("design:paramtypes",[Object])],Sm)});var Tm=y(wn=>{"use strict";var zD=wn&&wn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},HD=wn&&wn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},YD=wn&&wn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(wn,"__esModule",{value:!0});wn.URIConstructionService=void 0;var Mv=qe(),QD=ot(),Em=class{static{o(this,"URIConstructionService")}constructor(e){this.fileSystem=e,this.defaultOntologyURL="https://exocortex.my/default/",this.strictValidation=!0}configure(e){e?.defaultOntologyURL&&(this.defaultOntologyURL=e.defaultOntologyURL),e?.strictValidation!==void 0&&(this.strictValidation=e.strictValidation)}async constructAssetURI(e){let t=this.extractUID(e);if(!t){if(this.strictValidation)throw new Error(`Asset missing exo__Asset_uid: ${e.path}`);return console.warn(`Asset ${e.path} missing UID, using filename fallback`),this.constructFallbackURI(e)}let r=await this.resolveOntologyURL(e);if(!this.validateOntologyURL(r))throw new Error(`Invalid ontology URL: ${r}`);return`${r.endsWith("/")?r:`${r}/`}${t}`}validateOntologyURL(e){if(!e)return!1;try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}async resolveOntologyURL(e){let t=e.frontmatter?.exo__Asset_isDefinedBy;if(!t)return this.defaultOntologyURL;let r=this.extractWikiLink(t),i=r,s=await this.fileSystem.fileExists(r);return!s&&!r.endsWith(".md")&&(i=`${r}.md`,s=await this.fileSystem.fileExists(i)),s?(await this.fileSystem.getFileMetadata(i))?.exo__Ontology_url||this.defaultOntologyURL:(console.warn(`Ontology file not found: ${r}, using default`),this.defaultOntologyURL)}extractUID(e){return e.frontmatter?.exo__Asset_uid||null}extractWikiLink(e){return e.replace(/^\[\[|\]\]$/g,"")}constructFallbackURI(e){let t=e.path.split("/").pop()?.replace(".md","")||"unknown";return`${this.defaultOntologyURL}${t}`}};wn.URIConstructionService=Em;wn.URIConstructionService=Em=zD([(0,Mv.injectable)(),YD(0,(0,Mv.inject)(QD.DI_TOKENS.IFileSystemAdapter)),HD("design:paramtypes",[Object])],Em)});var Vv=y(Ps=>{"use strict";var KD=Ps&&Ps.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(Ps,"__esModule",{value:!0});Ps.WebhookService=void 0;var XD=qe(),pa=Os(),Am=class{static{o(this,"WebhookService")}constructor(){this.webhooks=new Map,this.rateLimitStates=new Map,this.defaultRateLimitConfig={maxRequests:100,windowMs:6e4},this.dispatchHistory=[],this.maxHistorySize=100}registerWebhook(e){if(!e.id)throw new Error("Webhook ID is required");if(!e.url)throw new Error("Webhook URL is required");try{new URL(e.url)}catch{throw new Error(`Invalid webhook URL: ${e.url}`)}this.webhooks.set(e.id,{...e,timeout:e.timeout??3e4,retryCount:e.retryCount??3}),pa.LoggingService.debug(`Registered webhook: ${e.name} (${e.id})`)}unregisterWebhook(e){let t=this.webhooks.delete(e);return this.rateLimitStates.delete(e),t&&pa.LoggingService.debug(`Unregistered webhook: ${e}`),t}getWebhooks(){return Array.from(this.webhooks.values())}getWebhook(e){return this.webhooks.get(e)}updateWebhook(e,t){let r=this.webhooks.get(e);if(!r)return!1;if(t.url)try{new URL(t.url)}catch{throw new Error(`Invalid webhook URL: ${t.url}`)}return this.webhooks.set(e,{...r,...t,id:e}),pa.LoggingService.debug(`Updated webhook: ${e}`),!0}getWebhooksForEvent(e){return Array.from(this.webhooks.values()).filter(t=>t.enabled&&(t.events.length===0||t.events.includes(e)))}isRateLimited(e){let t=this.rateLimitStates.get(e);if(!t)return!1;let r=Date.now(),{maxRequests:i,windowMs:s}=this.defaultRateLimitConfig;return r-t.windowStart>=s?(this.rateLimitStates.set(e,{requests:0,windowStart:r}),!1):t.requests>=i}recordRequest(e){let t=Date.now(),r=this.rateLimitStates.get(e),{windowMs:i}=this.defaultRateLimitConfig;!r||t-r.windowStart>=i?this.rateLimitStates.set(e,{requests:1,windowStart:t}):r.requests++}setRateLimitConfig(e){this.defaultRateLimitConfig=e}async dispatchEvent(e){let t=this.getWebhooksForEvent(e.event),r=[];for(let i of t){let s=await this.dispatchToWebhook(i,e);r.push(s),this.addToHistory(s)}return r}async dispatchToWebhook(e,t){let r=e.retryCount??3,i,s=0;for(;s<=r;){if(this.isRateLimited(e.id))return{webhookId:e.id,success:!1,error:"Rate limit exceeded",timestamp:new Date().toISOString(),retryCount:s};try{this.recordRequest(e.id);let a={"Content-Type":"application/json","User-Agent":"Exocortex-Webhook/1.0","X-Webhook-Event":t.event,"X-Webhook-Timestamp":t.timestamp,...e.headers},c=JSON.stringify(t);if(e.secret){let h=await this.createHmacSignature(c,e.secret);a["X-Webhook-Signature"]=h}let u=new AbortController,l=setTimeout(()=>u.abort(),e.timeout??3e4);try{let h=await fetch(e.url,{method:"POST",headers:a,body:c,signal:u.signal});if(clearTimeout(l),h.ok)return pa.LoggingService.debug(`Webhook ${e.name} dispatched successfully: ${h.status}`),{webhookId:e.id,success:!0,statusCode:h.status,timestamp:new Date().toISOString(),retryCount:s};i=`HTTP ${h.status}: ${h.statusText}`,pa.LoggingService.warn(`Webhook ${e.name} failed: ${i}`)}finally{clearTimeout(l)}}catch(a){i=a instanceof Error?a.message:"Unknown error",a instanceof Error&&a.name==="AbortError"&&(i="Request timeout"),pa.LoggingService.warn(`Webhook ${e.name} error (attempt ${s+1}/${r+1}): ${i}`)}s++,s<=r&&await this.delay(Math.pow(2,s)*100)}return{webhookId:e.id,success:!1,error:i,timestamp:new Date().toISOString(),retryCount:s-1}}async createHmacSignature(e,t){let r=new TextEncoder,i=r.encode(t),s=r.encode(e),a=await crypto.subtle.importKey("raw",i,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),c=await crypto.subtle.sign("HMAC",a,s);return"sha256="+Array.from(new Uint8Array(c)).map(l=>l.toString(16).padStart(2,"0")).join("")}delay(e){return new Promise(t=>setTimeout(t,e))}addToHistory(e){this.dispatchHistory.push(e),this.dispatchHistory.length>this.maxHistorySize&&this.dispatchHistory.shift()}getDispatchHistory(e=50){return this.dispatchHistory.slice(-e)}clearDispatchHistory(){this.dispatchHistory=[]}async testWebhook(e){let t=this.webhooks.get(e);if(!t)return{webhookId:e,success:!1,error:"Webhook not found",timestamp:new Date().toISOString(),retryCount:0};let r={event:"note.updated",timestamp:new Date().toISOString(),filePath:"/test/webhook-test.md",label:"Webhook Test",data:{test:!0,message:"This is a test webhook event from Exocortex"}},i=t.enabled;t.enabled=!0;let s=await this.dispatchToWebhook(t,r);return t.enabled=i,s}cleanup(){this.webhooks.clear(),this.rateLimitStates.clear(),this.dispatchHistory=[]}};Ps.WebhookService=Am;Ps.WebhookService=Am=KD([(0,XD.injectable)()],Am)});var xm=y(_n=>{"use strict";var JD=_n&&_n.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},ZD=_n&&_n.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},eP=_n&&_n.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(_n,"__esModule",{value:!0});_n.GenericAssetCreationService=void 0;var $v=qe(),tP=Fr(),Jo=hr(),rP=Br(),nP=ot(),Vn=Id(),Cm=class{static{o(this,"GenericAssetCreationService")}constructor(e){this.vault=e}async createAsset(e,t){let r=(0,tP.v4)(),i=`${r}.md`,s=this.generateFrontmatter(e,t||[],r),a=rP.MetadataHelpers.buildFileContent(s),c=e.folderPath||this.getDefaultFolderPath(e);this.vault.getAbstractFileByPath(c)||await this.vault.createFolder(c);let l=c?`${c}/${i}`:i;return await this.vault.create(l,a)}generateFrontmatter(e,t,r){let i=new Date,s={},a=new Map;for(let c of t)a.set(c.name,c.fieldType);if(s.exo__Asset_uid=r,s.exo__Asset_createdAt=Jo.DateFormatter.toLocalTimestamp(i),s.exo__Instance_class=[this.formatWikilink(e.className)],e.label&&e.label.trim()!==""){let c=e.label.trim();s.exo__Asset_label=c,s.aliases=[c]}if(e.parentFile&&e.parentMetadata&&this.inheritParentContext(s,e),e.propertyValues)for(let[c,u]of Object.entries(e.propertyValues)){if(c==="exo__Asset_uid"||c==="exo__Asset_createdAt"||c==="exo__Instance_class"||c==="exo__Asset_label"||c==="aliases"||u==null)continue;let l=a.get(c);s[c]=this.formatValue(u,l)}return s}inheritParentContext(e,t){let r=t.parentMetadata||{},i=t.parentFile?.basename;if((t.className==="ems__Task"||t.className.startsWith("ems__Task"))&&(e.ems__Effort_parent=i?this.formatWikilink(i):null),t.className==="ems__Project"||t.className.startsWith("ems__Project")){let s=r.exo__Instance_class;this.isAreaClass(s)&&(e.ems__Project_area=i?this.formatWikilink(i):null)}r.exo__Asset_isDefinedBy&&(e.exo__Asset_isDefinedBy=r.exo__Asset_isDefinedBy)}isAreaClass(e){return e?(Array.isArray(e)?e:[e]).some(r=>String(r).includes("Area")||String(r).includes("ems__Area")):!1}getDefaultFolderPath(e){if(e.parentFile?.parent?.path)return e.parentFile.parent.path;let t={ems__Task:"tasks",ems__Project:"projects",ems__Area:"areas",ems__Meeting:"meetings",exo__Event:"events",ims__Concept:"concepts"};if(t[e.className])return t[e.className];for(let[r,i]of Object.entries(t))if(e.className.startsWith(r))return i;return"assets"}formatValue(e,t){if(e==null)return null;if(!t)return this.formatInferredValue(e);switch(t){case Vn.PropertyFieldType.Text:return String(e);case Vn.PropertyFieldType.Wikilink:case Vn.PropertyFieldType.Reference:case Vn.PropertyFieldType.StatusSelect:case Vn.PropertyFieldType.SizeSelect:return this.formatWikilink(String(e));case Vn.PropertyFieldType.Number:return typeof e=="number"?e:Number(e)||0;case Vn.PropertyFieldType.Boolean:return this.formatBoolean(e);case Vn.PropertyFieldType.Date:case Vn.PropertyFieldType.DateTime:case Vn.PropertyFieldType.Timestamp:return this.formatTimestamp(e);default:return String(e)}}formatInferredValue(e){return typeof e=="boolean"||typeof e=="number"?e:e instanceof Date?Jo.DateFormatter.toLocalTimestamp(e):typeof e=="string"?e.startsWith("[[")||e.startsWith('"[[')?this.formatWikilink(e):e:String(e)}formatWikilink(e){return e.startsWith('"[[')&&e.endsWith(']]"')?e:e.startsWith("[[")&&e.endsWith("]]")?`"${e}"`:`"[[${e}]]"`}formatBoolean(e){if(typeof e=="boolean")return e;if(typeof e=="string"){let t=e.toLowerCase().trim();return t==="true"||t==="yes"||t==="1"}return typeof e=="number"?e!==0:!!e}formatTimestamp(e){if(e instanceof Date)return Jo.DateFormatter.toLocalTimestamp(e);if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(e))return e;if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return e.replace("Z","");let t=new Date(e);return isNaN(t.getTime())?e:Jo.DateFormatter.toLocalTimestamp(t)}if(typeof e=="number"){let t=new Date(e);if(!isNaN(t.getTime()))return Jo.DateFormatter.toLocalTimestamp(t)}return String(e)}};_n.GenericAssetCreationService=Cm;_n.GenericAssetCreationService=Cm=JD([(0,$v.injectable)(),eP(0,(0,$v.inject)(nP.DI_TOKENS.IVaultAdapter)),ZD("design:paramtypes",[Object])],Cm)});var Om=y(qr=>{"use strict";var iP=qr&&qr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},sP=qr&&qr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(qr,"__esModule",{value:!0});qr.EmbeddingService=qr.DEFAULT_EMBEDDING_CONFIG=void 0;var aP=qe(),Uv=Os();qr.DEFAULT_EMBEDDING_CONFIG={provider:"openai",model:"text-embedding-3-small",timeout:3e4,maxTextLength:8e3};var Im=class{static{o(this,"EmbeddingService")}constructor(e={}){this.requestCount=0,this.tokenCount=0,this.config={...qr.DEFAULT_EMBEDDING_CONFIG,...e}}setConfig(e){this.config={...this.config,...e},Uv.LoggingService.debug(`EmbeddingService config updated: provider=${this.config.provider}, model=${this.config.model}`)}getConfig(){let{apiKey:e,...t}=this.config;return t}isConfigured(){return this.config.provider==="openai"?!!this.config.apiKey:!0}async generateEmbedding(e){if(!this.isConfigured())throw new Error("EmbeddingService is not properly configured");let t=this.truncateText(e);if(this.config.provider==="openai")return this.generateOpenAIEmbedding(t);throw new Error(`Unsupported embedding provider: ${this.config.provider}`)}async generateBatchEmbeddings(e){if(!this.isConfigured())throw new Error("EmbeddingService is not properly configured");if(e.length===0)return[];let t=[];if(this.config.provider==="openai"){let r=e.map(i=>this.truncateText(i.text));try{let i=await this.generateOpenAIBatchEmbeddings(r);for(let s=0;s<e.length;s++)t.push({id:e[s].id,result:i[s]??null})}catch(i){let s=i instanceof Error?i.message:"Unknown error";for(let a of e)t.push({id:a.id,result:null,error:s})}}else throw new Error(`Unsupported embedding provider: ${this.config.provider}`);return t}async generateOpenAIEmbedding(e){let t=await this.generateOpenAIBatchEmbeddings([e]);if(t.length===0||!t[0])throw new Error("Failed to generate embedding");return t[0]}async generateOpenAIBatchEmbeddings(e){let r=`${this.config.baseUrl||"https://api.openai.com/v1"}/embeddings`,i=new AbortController,s=setTimeout(()=>i.abort(),this.config.timeout??3e4);try{let a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`},body:JSON.stringify({model:this.config.model||"text-embedding-3-small",input:e}),signal:i.signal});if(clearTimeout(s),!a.ok){let u=await a.text();throw new Error(`OpenAI API error: ${a.status} - ${u}`)}let c=await a.json();return this.requestCount++,this.tokenCount+=c.usage?.total_tokens||0,c.data.map(u=>({embedding:u.embedding,tokenCount:Math.round((c.usage?.total_tokens||0)/e.length),model:c.model}))}catch(a){throw clearTimeout(s),a instanceof Error&&a.name==="AbortError"?new Error("OpenAI API request timeout"):a}}truncateText(e){let t=this.config.maxTextLength??8e3;return e.length<=t?e:(Uv.LoggingService.debug(`Truncating text from ${e.length} to ${t} characters`),e.slice(0,t))}prepareTextForEmbedding(e,t){let r=[];if(t){let s=t.exo__Asset_label;typeof s=="string"&&s&&r.push(`Title: ${s}`);let a=t.exo__Instance_class;if(a){let c=Array.isArray(a)?a[0]:a;typeof c=="string"&&r.push(`Type: ${this.cleanWikiLink(c)}`)}}let i=this.cleanMarkdownContent(e);return i&&r.push(i),r.join(`

`)}cleanMarkdownContent(e){let t=e.replace(/^---[\s\S]*?---\n*/m,"").replace(/```[\s\S]*?```/g,r=>r.replace(/```\w*\n?|\n?```/g,"")).replace(/`([^`]+)`/g,"$1").replace(/\[\[([^\]|]+)(?:\|([^\]]+))?\]\]/g,(r,i,s)=>s||i).replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/!\[[^\]]*\]\([^)]+\)/g,"").replace(/^---+$/gm,"");return t=this.removeHtmlTags(t),t.replace(/\n{3,}/g,`

`).trim()}removeHtmlTags(e){let t=/<[^>]*>/g,r=e,i;do i=r,r=r.replace(t,"");while(r!==i);return r}cleanWikiLink(e){return e.replace(/^\[\[/,"").replace(/\]\]$/,"").replace(/^"/,"").replace(/"$/,"")}getStats(){return{requestCount:this.requestCount,tokenCount:this.tokenCount}}resetStats(){this.requestCount=0,this.tokenCount=0}};qr.EmbeddingService=Im;qr.EmbeddingService=Im=iP([(0,aP.injectable)(),sP("design:paramtypes",[Object])],Im)});var Fm=y(Gr=>{"use strict";var oP=Gr&&Gr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},cP=Gr&&Gr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Gr,"__esModule",{value:!0});Gr.VectorStore=Gr.DEFAULT_VECTOR_STORE_CONFIG=void 0;var uP=qe(),Dm=Os();Gr.DEFAULT_VECTOR_STORE_CONFIG={maxEntries:0,similarityThreshold:.7};var Pm=class{static{o(this,"VectorStore")}constructor(e={}){this.entries=new Map,this.createdAt=new Date,this.updatedAt=new Date,this.config={...Gr.DEFAULT_VECTOR_STORE_CONFIG,...e}}setConfig(e){this.config={...this.config,...e}}upsert(e){if(!e.vector||e.vector.length===0)throw new Error("Vector cannot be empty");let t=this.entries.values().next().value;if(t&&t.vector.length!==e.vector.length)throw new Error(`Vector dimension mismatch: expected ${t.vector.length}, got ${e.vector.length}`);if(this.config.maxEntries&&this.config.maxEntries>0&&!this.entries.has(e.id)&&this.entries.size>=this.config.maxEntries){let r=null,i=1/0;for(let[s,a]of this.entries)a.timestamp<i&&(i=a.timestamp,r=s);r&&(this.entries.delete(r),Dm.LoggingService.debug(`VectorStore: Evicted oldest entry ${r}`))}this.entries.set(e.id,e),this.updatedAt=new Date}remove(e){let t=this.entries.delete(e);return t&&(this.updatedAt=new Date),t}get(e){return this.entries.get(e)}has(e){return this.entries.has(e)}needsUpdate(e,t){let r=this.entries.get(e);return r?r.contentHash!==t:!0}getAllIds(){return Array.from(this.entries.keys())}size(){return this.entries.size}clear(){this.entries.clear(),this.updatedAt=new Date}search(e,t=10){if(this.entries.size===0)return[];let r=this.entries.values().next().value;if(r&&r.vector.length!==e.length)throw new Error(`Query vector dimension mismatch: expected ${r.vector.length}, got ${e.length}`);let i=[],s=this.config.similarityThreshold??.7;for(let a of this.entries.values()){let c=this.cosineSimilarity(e,a.vector);c>=s&&i.push({entry:a,score:c})}return i.sort((a,c)=>c.score-a.score),i.slice(0,t)}findSimilar(e,t=10){let r=this.entries.get(e);return r?this.search(r.vector,t+1).filter(s=>s.entry.id!==e).slice(0,t):[]}cosineSimilarity(e,t){if(e.length!==t.length)throw new Error("Vectors must have the same dimension");let r=0,i=0,s=0;for(let a=0;a<e.length;a++)r+=e[a]*t[a],i+=e[a]*e[a],s+=t[a]*t[a];return i=Math.sqrt(i),s=Math.sqrt(s),i===0||s===0?0:r/(i*s)}serialize(){return{version:1,entries:Array.from(this.entries.values()).map(e=>({id:e.id,vector:e.vector,metadata:e.metadata,timestamp:e.timestamp,contentHash:e.contentHash})),createdAt:this.createdAt.toISOString(),updatedAt:this.updatedAt.toISOString()}}deserialize(e){if(e.version!==1)throw new Error(`Unsupported VectorStore version: ${e.version}`);this.entries.clear();for(let t of e.entries)this.entries.set(t.id,{id:t.id,vector:t.vector,metadata:t.metadata,timestamp:t.timestamp,contentHash:t.contentHash});this.createdAt=new Date(e.createdAt),this.updatedAt=new Date(e.updatedAt),Dm.LoggingService.debug(`VectorStore: Loaded ${this.entries.size} entries from persistence`)}getStats(){let t=this.entries.values().next().value?.vector.length??null,i=(t?this.entries.size*t*8:0)/(1024*1024);return{entryCount:this.entries.size,dimension:t,createdAt:this.createdAt.toISOString(),updatedAt:this.updatedAt.toISOString(),estimatedMemoryMB:Math.round(i*100)/100}}pruneInvalidEntries(e){let t=[];for(let r of this.entries.keys())e.has(r)||t.push(r);for(let r of t)this.entries.delete(r);return t.length>0&&(this.updatedAt=new Date,Dm.LoggingService.debug(`VectorStore: Pruned ${t.length} invalid entries`)),t.length}};Gr.VectorStore=Pm;Gr.VectorStore=Pm=oP([(0,uP.injectable)(),cP("design:paramtypes",[Object])],Pm)});var qv=y(Wr=>{"use strict";var lP=Wr&&Wr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},hP=Wr&&Wr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)};Object.defineProperty(Wr,"__esModule",{value:!0});Wr.SemanticSearchService=Wr.DEFAULT_SEMANTIC_SEARCH_CONFIG=void 0;var fP=qe(),Zo=Os(),Bv=Om(),dP=Fm();Wr.DEFAULT_SEMANTIC_SEARCH_CONFIG={embedding:Bv.DEFAULT_EMBEDDING_CONFIG,maxResults:10,minSimilarity:.7,autoEmbed:!0,batchSize:20};var Rm=class{static{o(this,"SemanticSearchService")}constructor(e={}){this.indexingStatus={isIndexing:!1,totalFiles:0,indexedFiles:0,failedFiles:0,progress:0},this.abortController=null,this.config={...Wr.DEFAULT_SEMANTIC_SEARCH_CONFIG,...e},this.embeddingService=new Bv.EmbeddingService(this.config.embedding),this.vectorStore=new dP.VectorStore({similarityThreshold:this.config.minSimilarity})}setConfig(e){this.config={...this.config,...e},e.embedding&&this.embeddingService.setConfig(e.embedding),e.minSimilarity!==void 0&&this.vectorStore.setConfig({similarityThreshold:e.minSimilarity})}getConfig(){return{...this.config,embedding:this.embeddingService.getConfig()}}isConfigured(){return this.embeddingService.isConfigured()}getIndexingStatus(){return{...this.indexingStatus}}async search(e,t){if(!this.isConfigured())throw new Error("SemanticSearchService is not properly configured");if(!e.trim())return[];let r=await this.embeddingService.generateEmbedding(e),i=t??this.config.maxResults;return this.vectorStore.search(r.embedding,i).map(a=>this.toSearchResult(a))}async findSimilar(e,t){let r=t??this.config.maxResults;return this.vectorStore.findSimilar(e,r).map(s=>this.toSearchResult(s))}toSearchResult(e){let t=e.entry.metadata??{};return{path:e.entry.id,score:e.score,label:t.exo__Asset_label,instanceClass:this.extractInstanceClass(t),metadata:t}}extractInstanceClass(e){let t=e.exo__Instance_class;if(t){if(Array.isArray(t)){let r=t[0];return typeof r=="string"?this.cleanWikiLink(r):void 0}return typeof t=="string"?this.cleanWikiLink(t):void 0}}cleanWikiLink(e){return e.replace(/^\[\[/,"").replace(/\]\]$/,"").replace(/^"/,"").replace(/"$/,"")}async indexFile(e,t,r){if(!this.isConfigured())return!1;try{let i=await this.hashContent(t);if(!this.vectorStore.needsUpdate(e,i))return!0;let s=this.embeddingService.prepareTextForEmbedding(t,r),a=await this.embeddingService.generateEmbedding(s);return this.vectorStore.upsert({id:e,vector:a.embedding,metadata:r,timestamp:Date.now(),contentHash:i}),Zo.LoggingService.debug(`Indexed file: ${e}`),!0}catch(i){return Zo.LoggingService.warn(`Failed to index file ${e}: ${i instanceof Error?i.message:"Unknown error"}`),!1}}removeFromIndex(e){return this.vectorStore.remove(e)}async indexBatch(e){if(!this.isConfigured())return{indexed:0,failed:e.length};let t=[],r=new Map;for(let c of e){let u=await this.hashContent(c.content);if(!this.vectorStore.needsUpdate(c.path,u))continue;let l=this.embeddingService.prepareTextForEmbedding(c.content,c.metadata);t.push({id:c.path,text:l}),r.set(c.path,{content:c.content,metadata:c.metadata,contentHash:u})}if(t.length===0)return{indexed:0,failed:0};let i=await this.embeddingService.generateBatchEmbeddings(t),s=0,a=0;for(let c of i){let u=r.get(c.id);u&&(c.result?(this.vectorStore.upsert({id:c.id,vector:c.result.embedding,metadata:u.metadata,timestamp:Date.now(),contentHash:u.contentHash}),s++):(a++,Zo.LoggingService.warn(`Failed to embed ${c.id}: ${c.error||"Unknown error"}`)))}return{indexed:s,failed:a}}async indexAll(e,t,r){if(!this.isConfigured())throw new Error("SemanticSearchService is not properly configured");if(this.indexingStatus.isIndexing)throw new Error("Indexing is already in progress");this.abortController=new AbortController,this.indexingStatus={isIndexing:!0,totalFiles:e.length,indexedFiles:0,failedFiles:0,progress:0};let i=0,s=0,a=!1;try{for(let c=0;c<e.length;c+=this.config.batchSize){if(this.abortController.signal.aborted){a=!0;break}let u=e.slice(c,c+this.config.batchSize),l=[];for(let f of u){if(this.abortController.signal.aborted){a=!0;break}let d=await t(f);d?l.push({path:f,content:d.content,metadata:d.metadata}):s++}if(a)break;let h=await this.indexBatch(l);i+=h.indexed,s+=h.failed,this.indexingStatus.indexedFiles=c+u.length,this.indexingStatus.failedFiles=s,this.indexingStatus.progress=Math.round(this.indexingStatus.indexedFiles/e.length*100),r&&r({...this.indexingStatus})}}finally{this.indexingStatus.isIndexing=!1,this.abortController=null}return{indexed:i,failed:s,aborted:a}}abortIndexing(){this.abortController&&(this.abortController.abort(),Zo.LoggingService.debug("Indexing aborted by user"))}isIndexed(e){return this.vectorStore.has(e)}getIndexedPaths(){return this.vectorStore.getAllIds()}getIndexedCount(){return this.vectorStore.size()}clearIndex(){this.vectorStore.clear(),Zo.LoggingService.debug("Semantic search index cleared")}pruneDeletedFiles(e){return this.vectorStore.pruneInvalidEntries(e)}serializeIndex(){return this.vectorStore.serialize()}deserializeIndex(e){this.vectorStore.deserialize(e)}getStats(){return{indexStats:this.vectorStore.getStats(),embeddingStats:this.embeddingService.getStats()}}async hashContent(e){let r=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")}};Wr.SemanticSearchService=Rm;Wr.SemanticSearchService=Rm=lP([(0,fP.injectable)(),hP("design:paramtypes",[Object])],Rm)});var Gv=y(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});yl.GraphQueryService=void 0;var ec=Ye(),pP=lt(),ki=Xr(),mP=pd(),$n={INSTANCE_CLASS:ki.Namespace.EXO.term("Instance_class"),ASSET_LABEL:ki.Namespace.EXO.term("Asset_label"),ASSET_PROTOTYPE:ki.Namespace.EXO.term("Asset_prototype"),ASSET_IS_ARCHIVED:ki.Namespace.EXO.term("Asset_isArchived"),EFFORT_PARENT:ki.Namespace.EMS.term("Effort_parent"),REFERENCES:ki.Namespace.EXO.term("references"),REFERENCED_BY:ki.Namespace.EXO.term("referencedBy"),RDF_TYPE:ki.Namespace.RDF.term("type")},Nm=class{static{o(this,"GraphQueryService")}constructor(e,t={}){this.subscribers=new Set,this.nodeCache=new Map,this.lastCacheUpdate=0,this.tripleStore=e,this.config={defaultLimit:t.defaultLimit??100,maxLimit:t.maxLimit??1e4,defaultDepth:t.defaultDepth??2,maxDepth:t.maxDepth??10,includeArchivedByDefault:t.includeArchivedByDefault??!1,cacheTTL:t.cacheTTL??3e4}}async loadGraphData(e={}){let t=Date.now(),r=await this.loadNodes(e),i=await this.loadEdges(r,e),s=this.computeStats(r,i),a=Date.now()-t;return a>100&&r.length>0&&console.debug(`GraphQueryService: loaded ${r.length} nodes in ${a}ms (${(a/r.length).toFixed(2)}ms/node)`),{nodes:r,edges:i,stats:s,lastUpdated:Date.now(),version:1}}async loadNodesIncremental(e={}){let t=Math.min(e.limit??this.config.defaultLimit,this.config.maxLimit),r=e.offset??0,i=await this.loadNodes({...e,limit:t+1,offset:r}),s=i.length>t,a=s?i.slice(0,t):i,c=await this.loadEdges(a,e);return{nodes:a,edges:c,hasMore:s,totalCount:void 0,cursor:s?String(r+t):void 0}}async loadConnectedNodes(e,t={}){let r=Math.min(t.depth??this.config.defaultDepth,this.config.maxDepth),i=Math.min(t.limit??this.config.maxLimit,this.config.maxLimit),s=new Set,a=[{id:e,currentDepth:0}],c=[];for(;a.length>0&&c.length<i;){let{id:l,currentDepth:h}=a.shift();if(s.has(l))continue;s.add(l);let f=await this.getNodeById(l,t);if(f&&(c.push(f),h<r)){let d=await this.getConnectedNodeIds(l);for(let m of d)s.has(m)||a.push({id:m,currentDepth:h+1})}}let u=await this.loadEdges(c,t);return{nodes:c,edges:u,hasMore:a.length>0,totalCount:s.size+a.length}}async getNodeById(e,t={}){let r=this.getCachedNode(e);if(r)return{...r};let i=this.idToIRI(e),s=await this.tripleStore.match(i,void 0,void 0);if(s.length===0)return null;let a=this.triplesToNode(e,s,t);return a&&this.cacheNode(a),a}subscribe(e){return this.subscribers.add(e),{unsubscribe:o(()=>{this.subscribers.delete(e)},"unsubscribe")}}notifyChange(e){for(let t of this.subscribers)try{t(e)}catch(r){console.error("GraphQueryService: error in subscriber callback",r)}this.invalidateCache()}async getStats(){let e=await this.loadNodes({includeArchived:!0}),t=await this.loadEdges(e,{});return this.computeStats(e,t)}clearCache(){this.nodeCache.clear(),this.lastCacheUpdate=0}async loadNodes(e){let t=e.includeArchived??this.config.includeArchivedByDefault,r=e.limit??this.config.maxLimit,i=e.offset??0,s=await this.tripleStore.match(void 0,$n.INSTANCE_CLASS,void 0),a=s;if(e.classes&&e.classes.length>0){let m=new Set(e.classes);a=s.filter(_=>{let S=this.getObjectValue(_.object);return S&&m.has(S)})}let c=new Set;for(let m of a)c.add(this.subjectToId(m.subject));let h=Array.from(c).slice(i,i+r).map(m=>this.getNodeById(m,e));return(await Promise.all(h)).filter(m=>!(!m||!t&&m.isArchived))}async loadEdges(e,t){let r=new Set(e.map(a=>a.id)),i=[],s=new Set;for(let a of e){let c=this.idToIRI(a.id),u=await this.tripleStore.match(c,void 0,void 0);for(let l of u){let h=this.tripleToEdge(a.id,l,r);h&&!s.has(h.id)&&(!t.edgeTypes||t.edgeTypes.includes(h.type))&&(s.add(h.id),i.push(h))}}return i}async getConnectedNodeIds(e){let t=this.idToIRI(e),r=[],i=await this.tripleStore.match(t,void 0,void 0);for(let a of i){let c=this.objectToId(a.object);c&&r.push(c)}let s=await this.tripleStore.match(void 0,void 0,t);for(let a of s)r.push(this.subjectToId(a.subject));return[...new Set(r)]}triplesToNode(e,t,r){let i={},s,a,c,u,l=!1;for(let d of t){let m=d.predicate.value,_=this.getObjectValue(d.object);if(m===$n.INSTANCE_CLASS.value)s=_;else if(m===$n.ASSET_LABEL.value)a=_;else if(m===$n.ASSET_PROTOTYPE.value)c=this.objectToId(d.object)??_;else if(m===$n.EFFORT_PARENT.value)u=this.objectToId(d.object)??_;else if(m===$n.ASSET_IS_ARCHIVED.value)l=_==="true"||_==="1";else{let S=this.predicateToPropertyName(m);S&&(i[S]=_)}}if(l&&!(r.includeArchived??this.config.includeArchivedByDefault))return null;let h=this.idToPath(e),f=a??this.pathToTitle(h);return{id:e,path:h,title:f,label:f,assetClass:s,isArchived:l,uri:e.startsWith("http")?e:void 0,prototype:c,parent:u,properties:Object.keys(i).length>0?i:void 0}}tripleToEdge(e,t,r){let i=t.predicate.value,s=this.objectToId(t.object);if(!s||!r.has(s)||s===e)return null;let a=this.predicateToEdgeType(i);if(!a)return null;let c=(0,mP.createEdgeId)(e,s,a,i),u=this.predicateToLabel(i);return{id:c,source:e,target:s,type:a,predicate:i,label:u}}predicateToEdgeType(e){return e===$n.EFFORT_PARENT.value?"hierarchy":e===$n.ASSET_PROTOTYPE.value?"prototype":e===$n.REFERENCES.value?"forward-link":e===$n.REFERENCED_BY.value?"backlink":e.includes("Asset_")||e.includes("Instance_")?null:"semantic"}predicateToLabel(e){let t=e.lastIndexOf("#"),r=e.lastIndexOf("/"),i=Math.max(t,r);return i>=0?e.substring(i+1):e}predicateToPropertyName(e){return this.predicateToLabel(e).replace(/_/g,"__").replace(/#/g,"_")}computeStats(e,t){let r={},i={backlink:0,"forward-link":0,hierarchy:0,prototype:0,semantic:0,reference:0};for(let c of e){let u=c.assetClass??"unknown";r[u]=(r[u]??0)+1}for(let c of t)i[c.type]=(i[c.type]??0)+1;let s=new Map,a=new Map;for(let c of t)a.set(c.source,(a.get(c.source)??0)+1),s.set(c.target,(s.get(c.target)??0)+1);for(let c of e)c.inDegree=s.get(c.id)??0,c.outDegree=a.get(c.id)??0,c.weight=c.inDegree+c.outDegree;return{nodeCount:e.length,edgeCount:t.length,nodesByClass:r,edgesByType:i,computedAt:Date.now()}}idToIRI(e){return e.startsWith("http://")||e.startsWith("https://")?new ec.IRI(e):new ec.IRI(`obsidian://vault/${encodeURIComponent(e)}`)}subjectToId(e){if(e instanceof ec.IRI){let t=e.value;return t.startsWith("obsidian://vault/")?decodeURIComponent(t.replace("obsidian://vault/","")):t}return e.toString()}objectToId(e){if(e instanceof ec.IRI){let t=e.value;return t.startsWith("obsidian://vault/")?decodeURIComponent(t.replace("obsidian://vault/","")):t}return null}getObjectValue(e){if(e instanceof pP.Literal||e instanceof ec.IRI)return e.value}idToPath(e){if(e.startsWith("obsidian://vault/"))return decodeURIComponent(e.replace("obsidian://vault/",""));if(e.startsWith("http://")||e.startsWith("https://")){let t=e.match(/\/([^/]+\.md)$/);if(t)return t[1]}return e}pathToTitle(e){return(e.split("/").pop()??e).replace(/\.md$/,"")}getCachedNode(e){return Date.now()-this.lastCacheUpdate>this.config.cacheTTL?(this.clearCache(),null):this.nodeCache.get(e)??null}cacheNode(e){this.nodeCache.set(e.id,e),this.lastCacheUpdate===0&&(this.lastCacheUpdate=Date.now())}invalidateCache(){this.clearCache()}};yl.GraphQueryService=Nm});var zv=y(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});vl.TypeRegistry=void 0;var Un=Ye(),Wv=Mt(),gP=lt(),Qe=md(),Lm=class{static{o(this,"TypeRegistry")}constructor(e=null,t={}){this.nodeTypes=new Map,this.edgeTypes=new Map,this.typeHierarchy=new Map,this.subscribers=new Set,this.discoveryComplete=!1,this.tripleStore=e,this.config={autoDiscoverTypes:t.autoDiscoverTypes??!0,includeBuiltInStyles:t.includeBuiltInStyles??!0,styleResolution:t.styleResolution??{mergeStyles:!0,inheritParentStyles:!0,defaultNodeStyle:Qe.DEFAULT_NODE_STYLE,defaultEdgeStyle:Qe.DEFAULT_EDGE_STYLE},maxInheritanceDepth:t.maxInheritanceDepth??10},this.config.includeBuiltInStyles&&this.registerBuiltInTypes()}registerNodeType(e){let r=this.nodeTypes.get(e.uri)?"type-updated":"type-added";this.nodeTypes.set(e.uri,e),e.parentTypes&&e.parentTypes.length>0&&this.typeHierarchy.set(e.uri,e.parentTypes),this.emit({type:r,typeUri:e.uri,definition:e})}registerEdgeType(e){let r=this.edgeTypes.get(e.uri)?"type-updated":"type-added";this.edgeTypes.set(e.uri,e),this.emit({type:r,typeUri:e.uri,definition:e})}unregisterType(e){let t=this.nodeTypes.delete(e),r=this.edgeTypes.delete(e);this.typeHierarchy.delete(e),(t||r)&&this.emit({type:"type-removed",typeUri:e})}getNodeType(e){return this.nodeTypes.get(e)}getEdgeType(e){return this.edgeTypes.get(e)}getAllNodeTypes(){return Array.from(this.nodeTypes.values())}getAllEdgeTypes(){return Array.from(this.edgeTypes.values())}getParentTypes(e,t=this.config.maxInheritanceDepth){let r=[],i=new Set,s=[{uri:e,currentDepth:0}];for(;s.length>0;){let{uri:a,currentDepth:c}=s.shift();if(i.has(a)||(i.add(a),c>=t))continue;let u=this.typeHierarchy.get(a)??[];for(let l of u)i.has(l)||(r.push(l),s.push({uri:l,currentDepth:c+1}))}return r}getChildTypes(e){let t=[];for(let[r,i]of this.typeHierarchy)i.includes(e)&&t.push(r);return t}isSubtypeOf(e,t){return e===t?!0:this.getParentTypes(e).includes(t)}resolveNodeType(e){let t=[],r="unknown",i="custom";if(e.assetClass){let c=this.normalizeTypeUri(e.assetClass);t.push(c),r=c,i="exo:Instance_class"}let s=e.properties?.[Qe.RDF_TYPE_PREDICATES.RDF_TYPE];s&&!t.includes(s)&&(t.push(s),r==="unknown"&&(r=s,i="rdf:type"));for(let c of[...t]){let u=this.getParentTypes(c);for(let l of u)t.includes(l)||t.push(l)}let a=this.resolveNodeStyle(t);return{primaryType:r,types:t,resolvedStyle:a,source:i}}resolveEdgeType(e){let t=e.predicate??e.type,r=e.predicate?"rdf:type":"custom",i=this.resolveEdgeStyle(t);return{primaryType:t,resolvedStyle:i,source:r}}resolveNodeStyle(e){let{mergeStyles:t,defaultNodeStyle:r}=this.config.styleResolution,i={...r},s=[];for(let a of e){let c=this.nodeTypes.get(a);c&&s.push(c)}if(s.sort((a,c)=>a.priority-c.priority),t)for(let a of s)i=(0,Qe.mergeNodeStyles)(i,a.style);else if(s.length>0){let a=s[s.length-1];i=(0,Qe.mergeNodeStyles)(i,a.style)}return i}resolveEdgeStyle(e){let{defaultEdgeStyle:t}=this.config.styleResolution,r={...t},i=this.edgeTypes.get(e);return i&&(r=(0,Qe.mergeEdgeStyles)(r,i.style)),r}filterNodes(e,t){return e.filter(r=>{let i=this.resolveNodeType(r);return!(t.includeNodeTypes&&t.includeNodeTypes.length>0&&!t.includeNodeTypes.some(a=>i.types.includes(a)||t.includeInferred&&this.isSubtypeOf(i.primaryType,a))||t.excludeNodeTypes&&t.excludeNodeTypes.length>0&&t.excludeNodeTypes.some(a=>i.types.includes(a)||t.includeInferred&&this.isSubtypeOf(i.primaryType,a))||!t.includeDeprecated&&this.nodeTypes.get(i.primaryType)?.deprecated)})}filterEdges(e,t){return e.filter(r=>{let i=r.predicate??r.type;return!(t.includeEdgeTypes&&t.includeEdgeTypes.length>0&&!t.includeEdgeTypes.includes(i)||t.excludeEdgeTypes&&t.excludeEdgeTypes.length>0&&t.excludeEdgeTypes.includes(i))})}groupNodesByType(e,t,r={}){let{groupByNodeType:i=!0,groupByParentType:s=!1,groupLevel:a=0,maxGroups:c=20,customGroupFn:u}=r,l=new Map;for(let d of e){let m=this.resolveNodeType(d),_;if(u?_=u(m.types):s&&m.types.length>a?_=m.types[a]??m.primaryType:i?_=m.primaryType:_="all",!l.has(_)){let A=this.nodeTypes.get(_)?.label??(0,Qe.extractLocalName)(_);l.set(_,{nodeIds:new Set,label:A})}l.get(_).nodeIds.add(d.id)}let h=Array.from(l.entries()).map(([d,m])=>({id:d,label:m.label,nodeIds:Array.from(m.nodeIds)}));if(h.length>c){h.sort((_,S)=>S.nodeIds.length-_.nodeIds.length);let d=h.slice(0,c-1),m=h.slice(c-1).flatMap(_=>_.nodeIds);d.push({id:"other",label:"Other",nodeIds:m}),h=d}let f=new Map;for(let d of h)for(let m of d.nodeIds)f.set(m,d.id);return h.map((d,m)=>{let _=new Set(d.nodeIds),S=[],A=[];for(let L of t){let G=_.has(L.source),W=_.has(L.target);G&&W?L.id&&S.push(L.id):(G||W)&&L.id&&A.push(L.id)}let D=`hsl(${m*137.5%360}, 70%, 50%)`;return{id:d.id,label:d.label,nodeIds:d.nodeIds,internalEdgeIds:S,externalEdgeIds:A,color:D,stats:{nodeCount:d.nodeIds.length,internalEdgeCount:S.length,externalEdgeCount:A.length}}})}validateTypes(e,t){let r=[],i=[];for(let s of e){let a=this.resolveNodeType(s);if(a.primaryType!=="unknown"){let c=this.nodeTypes.get(a.primaryType);!c&&a.source!=="inferred"&&i.push({code:"UNREGISTERED_NODE_TYPE",message:`Node type "${a.primaryType}" is not registered`,elementId:s.id,suggestion:"Register the type with registerNodeType()"}),c?.deprecated&&i.push({code:"DEPRECATED_NODE_TYPE",message:`Node uses deprecated type "${a.primaryType}"`,elementId:s.id,suggestion:"Migrate to a non-deprecated type"})}else i.push({code:"MISSING_NODE_TYPE",message:"Node has no type information",elementId:s.id,suggestion:"Add exo:Instance_class or rdf:type to the node"})}for(let s of t){let a=s.predicate??s.type,c=this.edgeTypes.get(a);if(c?.domain&&c.domain.length>0){let u=e.find(l=>l.id===s.source);if(u){let l=this.resolveNodeType(u);c.domain.some(f=>l.types.includes(f))||r.push({code:"DOMAIN_VIOLATION",message:"Edge source does not match expected domain",elementId:s.id,expected:c.domain,actual:l.types})}}if(c?.range&&c.range.length>0){let u=e.find(l=>l.id===s.target);if(u){let l=this.resolveNodeType(u);c.range.some(f=>l.types.includes(f))||r.push({code:"RANGE_VIOLATION",message:"Edge target does not match expected range",elementId:s.id,expected:c.range,actual:l.types})}}}return{valid:r.length===0,errors:r,warnings:i}}async discoverTypes(){if(!this.tripleStore||this.discoveryComplete)return;let e=await this.tripleStore.match(void 0,new Un.IRI(Qe.RDF_TYPE_PREDICATES.RDF_TYPE),void 0);for(let r of e){let i=this.getObjectValue(r.object);if(i&&(0,Qe.isClassType)(i)){let s=this.getSubjectValue(r.subject);s&&await this.discoverNodeType(s)}}let t=await this.tripleStore.match(void 0,new Un.IRI(Qe.RDF_TYPE_PREDICATES.RDFS_SUBCLASS_OF),void 0);for(let r of t){let i=this.getSubjectValue(r.subject),s=this.getObjectValue(r.object);if(i&&s){let a=this.typeHierarchy.get(i)??[];if(!a.includes(s)){a.push(s),this.typeHierarchy.set(i,a);let c=this.nodeTypes.get(i);c&&(c.parentTypes=a)}}}this.discoveryComplete=!0,this.emit({type:"hierarchy-updated",rootTypes:this.getRootTypes()})}subscribe(e){return this.subscribers.add(e),()=>this.subscribers.delete(e)}clear(){this.nodeTypes.clear(),this.edgeTypes.clear(),this.typeHierarchy.clear(),this.discoveryComplete=!1,this.config.includeBuiltInStyles&&this.registerBuiltInTypes()}registerBuiltInTypes(){for(let[e,t]of Object.entries(Qe.BUILT_IN_NODE_STYLES))this.nodeTypes.set(e,{uri:e,label:(0,Qe.extractLocalName)(e),source:"custom",style:(0,Qe.mergeNodeStyles)(Qe.DEFAULT_NODE_STYLE,t),priority:1});for(let[e,t]of Object.entries(Qe.BUILT_IN_EDGE_STYLES))this.edgeTypes.set(e,{uri:e,label:(0,Qe.extractLocalName)(e),source:"custom",style:(0,Qe.mergeEdgeStyles)(Qe.DEFAULT_EDGE_STYLE,t),priority:1})}async discoverNodeType(e){if(this.nodeTypes.has(e)||!this.tripleStore)return;let t=await this.tripleStore.match(new Un.IRI(e),new Un.IRI(Qe.RDF_TYPE_PREDICATES.RDFS_LABEL),void 0),r=await this.tripleStore.match(new Un.IRI(e),new Un.IRI(Qe.RDF_TYPE_PREDICATES.RDFS_COMMENT),void 0),i=t.length>0?this.getObjectValue(t[0].object)??(0,Qe.extractLocalName)(e):(0,Qe.extractLocalName)(e),s=r.length>0?this.getObjectValue(r[0].object):void 0,a="rdfs:Class",c=await this.tripleStore.match(new Un.IRI(e),new Un.IRI(Qe.RDF_TYPE_PREDICATES.RDF_TYPE),void 0);for(let h of c)if(this.getObjectValue(h.object)===Qe.RDF_TYPE_PREDICATES.OWL_CLASS){a="owl:Class";break}let u=Qe.BUILT_IN_NODE_STYLES[e]??Qe.BUILT_IN_NODE_STYLES[(0,Qe.extractLocalName)(e)],l={uri:e,label:i,description:s,source:a,style:(0,Qe.mergeNodeStyles)(Qe.DEFAULT_NODE_STYLE,u??{}),priority:1};this.registerNodeType(l)}normalizeTypeUri(e){let t=e.match(/^\[\[(.+?)\]\]$/);return t?t[1]:e}getSubjectValue(e){if(e instanceof Un.IRI)return e.value;if(e instanceof Wv.BlankNode)return`_:${e.id}`;if(typeof e=="object"&&e!==null&&"termType"in e)return e.toString()}getObjectValue(e){if(e instanceof gP.Literal||e instanceof Un.IRI)return e.value;if(e instanceof Wv.BlankNode)return`_:${e.id}`}getRootTypes(){let e=new Set;for(let r of this.typeHierarchy.values())for(let i of r)e.add(i);let t=[];for(let r of this.nodeTypes.keys())(!this.typeHierarchy.has(r)||this.typeHierarchy.get(r).length===0)&&e.has(r)&&t.push(r);return t}emit(e){for(let t of this.subscribers)try{t(e)}catch(r){console.error("TypeRegistry: error in subscriber callback",r)}}};vl.TypeRegistry=Lm});var Hv=y(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.EffortSortingHelpers=void 0;var km=class n{static{o(this,"EffortSortingHelpers")}static getTimeFromTimestamp(e){if(!e)return"00:00:00";let t=new Date(e);if(isNaN(t.getTime()))return"00:00:00";let r=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${r}:${i}:${s}`}static sortByStartTime(e,t){let r=n.getTimeFromTimestamp(e.startTimestamp),i=n.getTimeFromTimestamp(t.startTimestamp),s=r==="00:00:00",a=i==="00:00:00";return s&&!a?1:!s&&a?-1:r.localeCompare(i)}static sortByPriority(e,t){if(e.isTrashed!==t.isTrashed)return e.isTrashed?1:-1;if(e.isDone!==t.isDone)return e.isDone?1:-1;let r=typeof e.metadata.ems__Effort_votes=="number"?e.metadata.ems__Effort_votes:0,i=typeof t.metadata.ems__Effort_votes=="number"?t.metadata.ems__Effort_votes:0;return r!==i?i-r:e.startTime&&t.startTime?e.startTime.localeCompare(t.startTime):e.startTime?-1:t.startTime?1:0}};wl.EffortSortingHelpers=km});var Yv=y(_l=>{"use strict";Object.defineProperty(_l,"__esModule",{value:!0});_l.FilenameValidator=void 0;var Fs=class{static{o(this,"FilenameValidator")}static validate(e,t={}){let{maxLength:r=this.DEFAULT_MAX_LENGTH,replacementChar:i=this.DEFAULT_REPLACEMENT,allowEmpty:s=!1}=t,a=[];if(!e||e.trim().length===0)return s||a.push("Filename cannot be empty"),{valid:a.length===0,sanitized:"",errors:a};e.endsWith(" ")&&a.push("Filename should not end with a space");let c=e.trim();this.INVALID_CHARS_PATTERN.test(c)&&a.push('Filename contains invalid characters: / \\ : * ? " < > |');let u=this.getBaseName(c);this.RESERVED_NAMES.has(u.toUpperCase())&&a.push(`"${u}" is a reserved filename on Windows`),c.length>r&&a.push(`Filename exceeds maximum length of ${r} characters`),c.startsWith(".")&&a.push("Filename should not start with a dot"),c.endsWith(".")&&a.push("Filename should not end with a dot");let l=this.sanitize(e,{maxLength:r,replacementChar:i});return{valid:a.length===0,sanitized:l,errors:a}}static sanitize(e,t={}){let{maxLength:r=this.DEFAULT_MAX_LENGTH,replacementChar:i=this.DEFAULT_REPLACEMENT}=t;if(!e||e.trim().length===0)return"";let s=e.trim();for(s=s.replace(this.INVALID_CHARS_PATTERN,i);s.startsWith(".")&&s.length>1;)s=s.substring(1);for(;s.length>0&&(s.endsWith(".")||s.endsWith(" "));)s=s.slice(0,-1);for(s.includes(i)&&(s=s.split(i).filter(l=>l!=="").join(i));s.startsWith(i);)s=s.slice(i.length);for(;s.endsWith(i);)s=s.slice(0,-i.length);let a=this.getBaseName(s);if(this.RESERVED_NAMES.has(a.toUpperCase())){let c=this.getExtension(s);s=a+i+c}if(s.length>r)for(s=s.slice(0,r);s.endsWith(i);)s=s.slice(0,-i.length);return s}static hasInvalidChars(e){return this.INVALID_CHARS_PATTERN.test(e)}static getInvalidChars(e){let t=e.match(this.INVALID_CHARS_PATTERN);return t?[...new Set(t)]:[]}static getBaseName(e){let t=e.lastIndexOf(".");return t===-1||t===0?e:e.substring(0,t)}static getExtension(e){let t=e.lastIndexOf(".");return t===-1||t===0?"":e.substring(t)}};_l.FilenameValidator=Fs;Fs.INVALID_CHARS_PATTERN=/[/\\:*?"<>|\x00-\x1F]/g;Fs.RESERVED_NAMES=new Set(["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"]);Fs.DEFAULT_MAX_LENGTH=200;Fs.DEFAULT_REPLACEMENT="_"});var Mm=y(Sl=>{"use strict";Object.defineProperty(Sl,"__esModule",{value:!0});Sl.NTriplesSerializer=void 0;var jm=class{static{o(this,"NTriplesSerializer")}serialize(e,t={}){let r=t.newline??`
`;return e.length===0?"":e.map(i=>i.toString()).join(r)+r}serializeChunk(e,t){return e.length===0?"":e.map(r=>r.toString()).join(t)+t}};Sl.NTriplesSerializer=jm});var Qv=y(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});bl.TurtleSerializer=void 0;var ma=Xr(),yP=Mm(),vP={rdf:ma.Namespace.RDF.iri.value,rdfs:ma.Namespace.RDFS.iri.value,owl:ma.Namespace.OWL.iri.value,xsd:ma.Namespace.XSD.iri.value,exo:ma.Namespace.EXO.iri.value,ems:ma.Namespace.EMS.iri.value},Vm=class{static{o(this,"TurtleSerializer")}constructor(){this.nTriplesSerializer=new yP.NTriplesSerializer}serialize(e,t={}){let r=t.newline??`
`,i=this.composePrefixes(t),s=this.serializePrefixes(i,r),a=this.nTriplesSerializer.serialize(e,{newline:r}).trimEnd();return s?a?`${s}${r}${r}${a}${r}`:`${s}${r}`:a?`${a}${r}`:""}serializePrefixes(e,t){let r=Object.entries(e);return r.length===0?"":r.map(([i,s])=>`@prefix ${i}: <${s}> .`).join(t)}composePrefixes(e){return e.includeDefaultPrefixes??!0?{...vP,...e.prefixes??{}}:{...e.prefixes??{}}}serializeTriplesOnly(e,t){return this.nTriplesSerializer.serializeChunk(e,t).trimEnd()}};bl.TurtleSerializer=Vm});var Jv=y(El=>{"use strict";Object.defineProperty(El,"__esModule",{value:!0});El.JSONLDSerializer=void 0;var Kv=Ye(),Xv=Mt(),wP=lt(),ga=Xr(),_P={rdf:ga.Namespace.RDF.iri.value,rdfs:ga.Namespace.RDFS.iri.value,owl:ga.Namespace.OWL.iri.value,xsd:ga.Namespace.XSD.iri.value,exo:ga.Namespace.EXO.iri.value,ems:ga.Namespace.EMS.iri.value},$m=class{static{o(this,"JSONLDSerializer")}toDocument(e,t={}){let r={..._P,...t.context??{}},i=new Map;for(let s of e){let a=this.subjectToId(s.subject),c=this.compactIri(s.predicate.value,r),u=this.objectToJSONLD(s.object,r),l=i.get(a)??{"@id":a},h=l[c];h===void 0?l[c]=u:Array.isArray(h)?h.push(u):l[c]=[h,u],i.set(a,l)}return{"@context":r,"@graph":Array.from(i.values())}}serialize(e,t={}){let r=this.toDocument(e,t),i=t.pretty?t.indent??2:void 0;return JSON.stringify(r,null,i)}subjectToId(e){return e instanceof Kv.IRI?e.value:e instanceof Xv.BlankNode?`_:${e.id}`:String(e)}compactIri(e,t){for(let[r,i]of Object.entries(t))if(e.startsWith(i)){let s=e.slice(i.length);if(s.length>0)return`${r}:${s}`}return e}objectToJSONLD(e,t){if(e instanceof Kv.IRI)return{"@id":e.value};if(e instanceof Xv.BlankNode)return{"@id":`_:${e.id}`};if(e instanceof wP.Literal){let r={"@value":e.value};return e.datatype?r["@type"]=this.compactIri(e.datatype.value,t):e.language&&(r["@language"]=e.language,e.hasDirection()&&e.direction&&(r["@direction"]=e.direction)),r}return e}};El.JSONLDSerializer=$m});var qm=y(Tl=>{"use strict";Object.defineProperty(Tl,"__esModule",{value:!0});Tl.NTriplesParser=void 0;var SP=Oi(),Zv=Ye(),Um=lt(),bP=Mt(),ya=Xr(),EP={rdf:ya.Namespace.RDF.iri.value,rdfs:ya.Namespace.RDFS.iri.value,owl:ya.Namespace.OWL.iri.value,xsd:ya.Namespace.XSD.iri.value,exo:ya.Namespace.EXO.iri.value,ems:ya.Namespace.EMS.iri.value},Bm=class{static{o(this,"NTriplesParser")}parse(e,t={}){let r={prefixes:{...EP,...t.prefixes??{}},strict:t.strict??!1},i=[];return e.split(/\r?\n/).forEach((a,c)=>{let u=a.trim();!u||u.startsWith("#")||i.push(this.parseLine(u,c+1,r))}),i}parseLine(e,t,r){if(!e.endsWith("."))throw new Error(`Invalid RDF statement at line ${t}: missing '.' terminator`);let s=e.slice(0,-1).trim(),a=this.parseSubject(s,t,r);s=a.rest.trim();let c=this.parsePredicate(s,t,r);s=c.rest.trim();let u=this.parseObject(s,t,r);if(s=u.rest.trim(),s.length>0)throw new Error(`Unexpected tokens after object at line ${t}`);return new SP.Triple(a.node,c.node,u.node)}parseSubject(e,t,r){return e.startsWith("<")?this.consumeIRI(e,t,r):e.startsWith("_:")?this.consumeBlankNode(e,t):this.consumePrefixedName(e,t,r)}parsePredicate(e,t,r){return e.startsWith("<")?this.consumeIRI(e,t,r):this.consumePrefixedName(e,t,r)}parseObject(e,t,r){return e.startsWith("<")?this.consumeIRI(e,t,r):e.startsWith("_:")?this.consumeBlankNode(e,t):e.startsWith('"')?this.consumeLiteral(e,t,r):this.consumePrefixedName(e,t,r)}consumePrefixedName(e,t,r){let i=e.match(/^([a-zA-Z_][\w-]*):([^\s]+)(?:\s+(.*))?$/);if(!i)throw new Error(`Invalid token at line ${t}: ${e}`);let[,s,a,c]=i,u=r.prefixes[s];if(!u)throw new Error(`Unknown prefix "${s}" at line ${t}`);return{node:new Zv.IRI(`${u}${a}`),rest:(c??"").trimStart()}}consumeIRI(e,t,r){let i=this.findClosingBracket(e,"<",">");if(i===-1)throw new Error(`Invalid IRI at line ${t}`);let s=e.slice(1,i),a=new Zv.IRI(s),c=e.slice(i+1).trimStart();return{node:a,rest:c}}consumeBlankNode(e,t){let r=e.match(/^_:(\w+)(?:\s+(.*))?$/);if(!r)throw new Error(`Invalid blank node identifier at line ${t}`);let[,i,s]=r;return{node:new bP.BlankNode(i),rest:(s??"").trimStart()}}consumeLiteral(e,t,r){let{value:i,rest:s}=this.consumeQuotedString(e,t),a=s.trimStart();if(a.startsWith("^^")){a=a.slice(2).trimStart();let c=a.startsWith("<")?this.consumeIRI(a,t,r):this.consumePrefixedName(a,t,r);return{node:new Um.Literal(i,c.node),rest:c.rest}}if(a.startsWith("@")){let c=a.match(/^@([a-zA-Z-]+)(?:\s+(.*))?$/);if(!c)throw new Error(`Invalid language tag at line ${t}`);let[,u,l]=c;return{node:new Um.Literal(i,void 0,u),rest:(l??"").trimStart()}}return{node:new Um.Literal(i),rest:a}}consumeQuotedString(e,t){if(!e.startsWith('"'))throw new Error(`Expected quoted string at line ${t}`);let r="";for(let i=1;i<e.length;i++){let s=e[i];if(s==="\\"){if(i+1>=e.length)throw new Error(`Invalid escape sequence at line ${t}`);let a=e[i+1];switch(a){case"t":r+="	",i+=1;break;case"b":r+="\b",i+=1;break;case"n":r+=`
`,i+=1;break;case"r":r+="\r",i+=1;break;case"f":r+="\f",i+=1;break;case'"':r+='"',i+=1;break;case"\\":r+="\\",i+=1;break;case"u":{let c=e.slice(i+2,i+6);if(c.length!==4||!/^[0-9a-fA-F]{4}$/.test(c))throw new Error(`Invalid \\u escape at line ${t}`);r+=String.fromCharCode(parseInt(c,16)),i+=5;break}case"U":{let c=e.slice(i+2,i+10);if(c.length!==8||!/^[0-9a-fA-F]{8}$/.test(c))throw new Error(`Invalid \\U escape at line ${t}`);r+=String.fromCodePoint(parseInt(c,16)),i+=9;break}default:throw new Error(`Unknown escape sequence \\${a} at line ${t}`)}continue}if(s==='"'){let a=e.slice(i+1);return{value:r,rest:a}}r+=s}throw new Error(`Unterminated string literal at line ${t}`)}findClosingBracket(e,t,r){let i=0;for(let s=0;s<e.length;s++){let a=e[s];if(a===t){i++;continue}if(a===r&&(i--,i===0))return s}return-1}};Tl.NTriplesParser=Bm});var ew=y(Al=>{"use strict";Object.defineProperty(Al,"__esModule",{value:!0});Al.TurtleParser=void 0;var va=Xr(),TP=qm(),AP={rdf:va.Namespace.RDF.iri.value,rdfs:va.Namespace.RDFS.iri.value,owl:va.Namespace.OWL.iri.value,xsd:va.Namespace.XSD.iri.value,exo:va.Namespace.EXO.iri.value,ems:va.Namespace.EMS.iri.value},CP=/^@prefix\s+([a-zA-Z_][\w-]*):\s*<([^>]+)>\s*\.$/,Gm=class{static{o(this,"TurtleParser")}constructor(){this.nTriplesParser=new TP.NTriplesParser}parse(e,t={}){let r={...AP,...t.prefixes??{}},i=this.collectStatements(e),s=[];return i.forEach(({statement:a,lineNumber:c})=>{if(this.isPrefixStatement(a)){let l=a.match(CP);if(!l)throw new Error(`Invalid prefix declaration at line ${c}`);let[,h,f]=l;r[h]=f;return}if(a.includes(";")||a.includes(","))throw new Error(`Complex Turtle statements with ';' or ',' are not supported (line ${c})`);let u=this.normalizeShortcuts(a);s.push(this.nTriplesParser.parseLine(u,c,{prefixes:r,strict:!1}))}),s}collectStatements(e){let t=e.split(/\r?\n/),r=[],i="",s=0;if(t.forEach((a,c)=>{let u=a.trim();!u||u.startsWith("#")||(i||(s=c+1),i=i?`${i} ${u}`:u,u.endsWith(".")&&(r.push({statement:i,lineNumber:s}),i=""))}),i)throw new Error(`Unterminated Turtle statement near line ${s}`);return r}isPrefixStatement(e){return e.startsWith("@prefix")}normalizeShortcuts(e){return e.includes(" a ")?e.replace(/\sa\s/g," rdf:type "):e}};Al.TurtleParser=Gm});var tw=y(Cl=>{"use strict";Object.defineProperty(Cl,"__esModule",{value:!0});Cl.RDFSerializer=void 0;var wa=Oi(),Rs=Ye(),Ns=lt(),Wm=Mt(),Bn=Xr(),xP=Qv(),IP=Mm(),OP=Jv(),DP=ew(),PP=qm(),FP=1024,RP=`
`,NP={rdf:Bn.Namespace.RDF.iri.value,rdfs:Bn.Namespace.RDFS.iri.value,owl:Bn.Namespace.OWL.iri.value,xsd:Bn.Namespace.XSD.iri.value,exo:Bn.Namespace.EXO.iri.value,ems:Bn.Namespace.EMS.iri.value},zm=class{static{o(this,"RDFSerializer")}constructor(e){this.store=e,this.turtleSerializer=new xP.TurtleSerializer,this.nTriplesSerializer=new IP.NTriplesSerializer,this.jsonldSerializer=new OP.JSONLDSerializer,this.turtleParser=new DP.TurtleParser,this.nTriplesParser=new PP.NTriplesParser}async serialize(e,t={}){let r=await this.store.match();return this.serializeTriples(r,e,t)}serializeTriples(e,t,r={}){switch(t){case"turtle":return this.turtleSerializer.serialize(e,{prefixes:r.prefixes,includeDefaultPrefixes:r.includeDefaultPrefixes,newline:r.newline});case"n-triples":return this.nTriplesSerializer.serialize(e,{newline:r.newline});case"json-ld":return this.jsonldSerializer.serialize(e,{context:r.prefixes,pretty:r.pretty,indent:r.indent});default:throw new Error(`Unsupported serialization format: ${t}`)}}stream(e,t={}){let r=t.newline??RP,i=t.batchSize??FP,s=t.includeDefaultPrefixes,a=t.prefixes,c=this,u=!1,l=[],h=[],f=0,d=o(async()=>{if(!u){if(h=await c.store.match(),e==="json-ld"){let _=c.jsonldSerializer.toDocument(h,{context:a,pretty:!1});l.push(...c.buildJsonLdChunks(_))}else if(e==="turtle"){let _=c.turtleSerializer.serializePrefixes(c.composePrefixes(a,s),r);_&&l.push(`${_}${r}${r}`)}u=!0}},"ensureInitialized");return{async next(){if(await d(),l.length>0)return{value:l.shift(),done:!1};if(e==="json-ld")return{value:void 0,done:!0};if(f>=h.length)return{value:void 0,done:!0};let _=h.slice(f,f+i);f+=_.length;let S="";if(e==="turtle"){let A=c.turtleSerializer.serializeTriplesOnly(_,r);A&&(S=`${A}${r}`)}else e==="n-triples"&&(S=c.nTriplesSerializer.serializeChunk(_,r));return S?{value:S,done:!1}:this.next()},async return(){return l=[],h=[],f=0,{value:void 0,done:!0}},[Symbol.asyncIterator](){return this}}}async load(e,t,r={}){let i=this.parse(e,t,r);return r.mode!=="append"&&await this.store.clear(),await this.store.addAll(i),i.length}parse(e,t,r={}){switch(t){case"turtle":return this.turtleParser.parse(e,this.buildTurtleParseOptions(r));case"n-triples":return this.nTriplesParser.parse(e,this.buildNTriplesParseOptions(r));case"json-ld":return this.parseJsonLd(e,r);default:throw new Error(`Unsupported serialization format: ${t}`)}}buildTurtleParseOptions(e){return{prefixes:this.composePrefixes(e.prefixes,!0),strict:e.strict}}buildNTriplesParseOptions(e){return{prefixes:this.composePrefixes(e.prefixes,!0),strict:e.strict}}composePrefixes(e,t){return t??!0?{...NP,...e??{}}:{...e??{}}}parseJsonLd(e,t){let r;try{r=JSON.parse(e)}catch(l){throw new Error(`Invalid JSON-LD document: ${l.message}`)}let i=this.composePrefixes(t.prefixes,!0),s=this.extractContext(r),a={...i,...s},c=this.extractGraph(r),u=[];return c.forEach((l,h)=>{if(!l||typeof l!="object"||Array.isArray(l))throw new Error(`Invalid JSON-LD node at index ${h}`);let f=this.parseSubjectFromNode(l,a,h),d=Object.entries(l);for(let[m,_]of d){if(m==="@id"||m==="@context")continue;if(m==="@type"){this.collectTypeTriples(f,_,u,a);continue}let S=this.expandTerm(m,a),A=new Rs.IRI(S);this.collectTriplesForValue(f,A,_,u,a)}}),u}extractContext(e){if(!e||typeof e!="object"||Array.isArray(e))return{};let t=e["@context"];if(!t||typeof t!="object"||Array.isArray(t))return{};let r={};return Object.entries(t).forEach(([i,s])=>{typeof s=="string"&&(r[i]=s)}),r}extractGraph(e){if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];let t=e["@graph"];return Array.isArray(t)?t:[e]}parseSubjectFromNode(e,t,r){let i=e["@id"];if(typeof i=="string"){if(i.startsWith("_:"))return new Wm.BlankNode(i.slice(2));if(this.isAbsoluteIri(i))return new Rs.IRI(i);let s=this.expandTerm(i,t);return new Rs.IRI(s)}return new Wm.BlankNode(`jsonld_${r}`)}collectTypeTriples(e,t,r,i){let s=Bn.Namespace.RDF.term("type");(Array.isArray(t)?t:[t]).forEach(c=>{if(typeof c!="string")throw new Error("Invalid @type value in JSON-LD node");let u=this.expandTerm(c,i);r.push(new wa.Triple(e,s,new Rs.IRI(u)))})}collectTriplesForValue(e,t,r,i,s){if(r!=null){if(Array.isArray(r)){r.forEach(a=>this.collectTriplesForValue(e,t,a,i,s));return}if(typeof r=="object"){let a=r;if(typeof a["@id"]=="string"){let c=this.parseIdNode(a["@id"],s);i.push(new wa.Triple(e,t,c));return}if(a["@value"]!==void 0){let c=this.parseLiteralObject(a,s);i.push(new wa.Triple(e,t,c));return}}if(typeof r=="string"){i.push(new wa.Triple(e,t,new Ns.Literal(r)));return}if(typeof r=="number"){let a=Number.isInteger(r)?Bn.Namespace.XSD.term("integer"):Bn.Namespace.XSD.term("decimal");i.push(new wa.Triple(e,t,new Ns.Literal(r.toString(),a)));return}if(typeof r=="boolean"){let a=Bn.Namespace.XSD.term("boolean");i.push(new wa.Triple(e,t,new Ns.Literal(r.toString(),a)));return}throw new Error("Unsupported JSON-LD value encountered")}}parseIdNode(e,t){if(e.startsWith("_:"))return new Wm.BlankNode(e.slice(2));if(this.isAbsoluteIri(e))return new Rs.IRI(e);let r=this.expandTerm(e,t);return new Rs.IRI(r)}parseLiteralObject(e,t){let r=e["@value"];if(typeof r!="string")throw new Error("JSON-LD literal values must be strings");if(typeof e["@language"]=="string"){let i=e["@direction"];return i==="ltr"||i==="rtl"?new Ns.Literal(r,void 0,e["@language"],i):new Ns.Literal(r,void 0,e["@language"])}if(typeof e["@type"]=="string"){let i=this.expandTerm(e["@type"],t);return new Ns.Literal(r,new Rs.IRI(i))}return new Ns.Literal(r)}expandTerm(e,t){if(this.isAbsoluteIri(e))return e;let r=e.indexOf(":");if(r>0){let s=e.slice(0,r),a=e.slice(r+1),c=t[s];if(!c)throw new Error(`Unknown prefix "${s}" in JSON-LD document`);return`${c}${a}`}let i=t["@vocab"];if(i)return`${i}${e}`;throw new Error(`Unable to expand JSON-LD term "${e}"`)}isAbsoluteIri(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)}buildJsonLdChunks(e){let t=[],r=JSON.stringify(e["@context"]);return t.push(`{"@context":${r},"@graph":[`),e["@graph"].forEach((i,s)=>{let a=JSON.stringify(i);s>0?t.push(`,${a}`):t.push(a)}),t.push(`]}
`),t}};Cl.RDFSerializer=zm});var Km=y(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.TransactionError=ji.TripleNotFoundError=ji.TripleAlreadyExistsError=void 0;var Hm=class extends Error{static{o(this,"TripleAlreadyExistsError")}constructor(e){super(`Triple already exists: ${e.toString()}`),this.name="TripleAlreadyExistsError"}};ji.TripleAlreadyExistsError=Hm;var Ym=class extends Error{static{o(this,"TripleNotFoundError")}constructor(e){super(`Triple not found: ${e.toString()}`),this.name="TripleNotFoundError"}};ji.TripleNotFoundError=Ym;var Qm=class extends Error{static{o(this,"TransactionError")}constructor(e){super(e),this.name="TransactionError"}};ji.TransactionError=Qm});var Il=y(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.LRUCache=void 0;var Xm=class{static{o(this,"LRUCache")}constructor(e){this.maxSize=e,this.cache=new Map}get(e){let t=this.cache.get(e);return t!==void 0&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){let r=this.cache.keys().next().value;r!==void 0&&this.cache.delete(r)}this.cache.set(e,t)}clear(){this.cache.clear()}size(){return this.cache.size}};xl.LRUCache=Xm});var rw=y(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.InMemoryTripleStore=void 0;var Mi=Km(),Ol=Ye(),LP=Mt(),kP=lt(),jP=Xr(),MP=Il(),VP=jP.Namespace.XSD.term("string").value,$P=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi,_a="__default__",Jm=class n{static{o(this,"InMemoryTripleStore")}constructor(){this.triples=new Map,this.spo=new Map,this.sop=new Map,this.pso=new Map,this.pos=new Map,this.osp=new Map,this.ops=new Map,this.queryCache=new MP.LRUCache(1e3),this.uuidIndex=new Map,this.namedGraphs=new Map}async add(e){let t=this.getTripleKey(e);if(this.triples.has(t))return;this.triples.set(t,e);let r=this.getNodeKey(e.subject),i=this.getNodeKey(e.predicate),s=this.getNodeKey(e.object);this.addToIndex(this.spo,r,i,s),this.addToIndex(this.sop,r,s,i),this.addToIndex(this.pso,i,r,s),this.addToIndex(this.pos,i,s,r),this.addToIndex(this.osp,s,r,i),this.addToIndex(this.ops,s,i,r),this.addToUUIDIndex(e.subject),this.queryCache.clear()}async remove(e){let t=this.getTripleKey(e);if(!this.triples.has(t))return!1;this.triples.delete(t);let r=this.getNodeKey(e.subject),i=this.getNodeKey(e.predicate),s=this.getNodeKey(e.object);return this.removeFromIndex(this.spo,r,i,s),this.removeFromIndex(this.sop,r,s,i),this.removeFromIndex(this.pso,i,r,s),this.removeFromIndex(this.pos,i,s,r),this.removeFromIndex(this.osp,s,r,i),this.removeFromIndex(this.ops,s,i,r),this.queryCache.clear(),!0}async has(e){let t=this.getTripleKey(e);return this.triples.has(t)}async match(e,t,r){let i=this.getMatchCacheKey(e,t,r),s=this.queryCache.get(i);if(s!==void 0)return s;let a;return!e&&!t&&!r?a=Array.from(this.triples.values()):e&&t&&r?a=this.matchSPO(e,t,r):e&&t?a=this.matchSP(e,t):e&&r?a=this.matchSO(e,r):t&&r?a=this.matchPO(t,r):e?a=this.matchS(e):t?a=this.matchP(t):r?a=this.matchO(r):a=[],this.queryCache.set(i,a),a}async addAll(e){for(let t of e)await this.add(t)}async removeAll(e){let t=0;for(let r of e)await this.remove(r)&&t++;return t}async clear(){this.triples.clear(),this.spo.clear(),this.sop.clear(),this.pso.clear(),this.pos.clear(),this.osp.clear(),this.ops.clear(),this.uuidIndex.clear(),this.queryCache.clear()}async count(){return this.triples.size}async subjects(){let e=new Set;for(let t of this.triples.values())e.add(t.subject);return Array.from(e)}async predicates(){let e=new Set;for(let t of this.triples.values())e.add(t.predicate);return Array.from(e)}async objects(){let e=new Set;for(let t of this.triples.values())e.add(t.object);return Array.from(e)}async beginTransaction(){return new Zm(this)}async findSubjectsByUUID(e){return this.findSubjectsByUUIDSync(e)}findSubjectsByUUIDSync(e){let t=e.toLowerCase(),r=this.uuidIndex.get(t);if(!r||r.size===0)return[];let i=[];for(let s of r)this.spo.has(`i:${s}`)&&i.push(new Ol.IRI(s));return i}addToUUIDIndex(e){if(!(e instanceof Ol.IRI))return;let t=e.value,r=t.match($P);if(r)for(let i of r){let s=i.toLowerCase();this.uuidIndex.has(s)||this.uuidIndex.set(s,new Set),this.uuidIndex.get(s).add(t)}}matchSPO(e,t,r){let i=this.getNodeKey(e),s=this.getNodeKey(t),a=this.getNodeKey(r),c=this.spo.get(i);if(!c)return[];let u=c.get(s);if(!u)return[];if(u.has(a)){let l=this.buildTripleKey(i,s,a),h=this.triples.get(l);return h?[h]:[]}return[]}matchSP(e,t){let r=this.getNodeKey(e),i=this.getNodeKey(t),s=this.spo.get(r);if(!s)return[];let a=s.get(i);return a?this.getTriplesByKeys(Array.from(a).map(c=>this.buildTripleKey(r,i,c))):[]}matchSO(e,t){let r=this.getNodeKey(e),i=this.getNodeKey(t),s=this.sop.get(r);if(!s)return[];let a=s.get(i);return a?this.getTriplesByKeys(Array.from(a).map(c=>this.buildTripleKey(r,c,i))):[]}matchPO(e,t){let r=this.getNodeKey(e),i=this.getNodeKey(t),s=this.pos.get(r);if(!s)return[];let a=s.get(i);return a?this.getTriplesByKeys(Array.from(a).map(c=>this.buildTripleKey(c,r,i))):[]}matchS(e){let t=this.getNodeKey(e),r=this.spo.get(t);if(!r)return[];let i=[];for(let[s,a]of r.entries())for(let c of a)i.push(this.buildTripleKey(t,s,c));return this.getTriplesByKeys(i)}matchP(e){let t=this.getNodeKey(e),r=this.pso.get(t);if(!r)return[];let i=[];for(let[s,a]of r.entries())for(let c of a)i.push(this.buildTripleKey(s,t,c));return this.getTriplesByKeys(i)}matchO(e){let t=this.getNodeKey(e),r=this.osp.get(t);if(!r)return[];let i=[];for(let[s,a]of r.entries())for(let c of a)i.push(this.buildTripleKey(s,c,t));return this.getTriplesByKeys(i)}getTriplesByKeys(e){let t=[];for(let r of e){let i=this.triples.get(r);i&&t.push(i)}return t}addToIndex(e,t,r,i){e.has(t)||e.set(t,new Map);let s=e.get(t);s.has(r)||s.set(r,new Set),s.get(r).add(i)}removeFromIndex(e,t,r,i){let s=e.get(t);if(!s)return;let a=s.get(r);a&&(a.delete(i),a.size===0&&s.delete(r),s.size===0&&e.delete(t))}getTripleKey(e){let t=this.getNodeKey(e.subject),r=this.getNodeKey(e.predicate),i=this.getNodeKey(e.object);return this.buildTripleKey(t,r,i)}buildTripleKey(e,t,r){return`${e}|${t}|${r}`}getNodeKey(e){if(e instanceof Ol.IRI)return`i:${e.value}`;if(e instanceof LP.BlankNode)return`b:${e.id}`;if(e instanceof kP.Literal){let t=`l:${e.value}`;return e.datatype&&e.datatype.value!==VP?t+=`^^${e.datatype.value}`:e.language&&(t+=`@${e.language}`),t}return""}getMatchCacheKey(e,t,r){let i=e?this.getNodeKey(e):"?",s=t?this.getNodeKey(t):"?",a=r?this.getNodeKey(r):"?";return`${i}|${s}|${a}`}getGraphKey(e){return e?e.value:_a}getOrCreateGraphStore(e){let t=this.getGraphKey(e);return t===_a?this:(this.namedGraphs.has(t)||this.namedGraphs.set(t,new n),this.namedGraphs.get(t))}async addToGraph(e,t){await this.getOrCreateGraphStore(t).add(e)}async removeFromGraph(e,t){let r=this.getGraphKey(t);if(r===_a)return this.remove(e);let i=this.namedGraphs.get(r);return i?i.remove(e):!1}async matchInGraph(e,t,r,i){let s=this.getGraphKey(i);if(s===_a)return this.match(e,t,r);let a=this.namedGraphs.get(s);return a?a.match(e,t,r):[]}async getNamedGraphs(){return Array.from(this.namedGraphs.keys()).map(e=>new Ol.IRI(e))}async hasGraph(e){let t=this.namedGraphs.get(e.value);return t?await t.count()>0:!1}async clearGraph(e){let t=this.getGraphKey(e);if(t===_a){await this.clear();return}let r=this.namedGraphs.get(t);r&&(await r.clear(),this.namedGraphs.delete(t))}async countInGraph(e){let t=this.getGraphKey(e);if(t===_a)return this.count();let r=this.namedGraphs.get(t);return r?r.count():0}};Dl.InMemoryTripleStore=Jm;var Zm=class{static{o(this,"InMemoryTransaction")}constructor(e){this.store=e,this.operations=[],this.committed=!1,this.rolledBack=!1}async add(e){if(this.committed)throw new Mi.TransactionError("Transaction already committed");if(this.rolledBack)throw new Mi.TransactionError("Transaction already rolled back");this.operations.push({type:"add",triple:e})}async remove(e){if(this.committed)throw new Mi.TransactionError("Transaction already committed");if(this.rolledBack)throw new Mi.TransactionError("Transaction already rolled back");return this.operations.push({type:"remove",triple:e}),!0}async commit(){if(this.committed)throw new Mi.TransactionError("Transaction already committed");if(this.rolledBack)throw new Mi.TransactionError("Transaction already rolled back");for(let e of this.operations)e.type==="add"?await this.store.add(e.triple):await this.store.remove(e.triple);this.committed=!0,this.operations=[]}async rollback(){if(this.committed)throw new Mi.TransactionError("Transaction already committed");if(this.rolledBack)throw new Mi.TransactionError("Transaction already rolled back");this.operations=[],this.rolledBack=!0}}});var tg=y(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.RDFVocabularyMapper=void 0;var Nr=Oi(),nw=Ye(),me=Xr(),eg=class{static{o(this,"RDFVocabularyMapper")}constructor(){this.propertyMappings=new Map([["exo__Instance_class",me.Namespace.RDF.term("type")],["exo__Asset_isDefinedBy",me.Namespace.RDFS.term("isDefinedBy")],["exo__Class_superClass",me.Namespace.RDFS.term("subClassOf")],["exo__Property_range",me.Namespace.RDFS.term("range")],["exo__Property_domain",me.Namespace.RDFS.term("domain")],["exo__Property_superProperty",me.Namespace.RDFS.term("subPropertyOf")]])}generateClassHierarchyTriples(){let e=[];return e.push(new Nr.Triple(me.Namespace.EXO.term("Asset"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.RDFS.term("Resource"))),e.push(new Nr.Triple(me.Namespace.EXO.term("Class"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.RDFS.term("Class"))),e.push(new Nr.Triple(me.Namespace.EXO.term("Property"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.RDF.term("Property"))),e.push(new Nr.Triple(me.Namespace.EMS.term("Task"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.EXO.term("Asset"))),e.push(new Nr.Triple(me.Namespace.EMS.term("Project"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.EXO.term("Asset"))),e.push(new Nr.Triple(me.Namespace.EMS.term("Area"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.EXO.term("Asset"))),e}generatePropertyHierarchyTriples(){let e=[];return e.push(new Nr.Triple(me.Namespace.EXO.term("Instance_class"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDF.term("type"))),e.push(new Nr.Triple(me.Namespace.EXO.term("Asset_isDefinedBy"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("isDefinedBy"))),e.push(new Nr.Triple(me.Namespace.EXO.term("Class_superClass"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("subClassOf"))),e.push(new Nr.Triple(me.Namespace.EXO.term("Property_range"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("range"))),e.push(new Nr.Triple(me.Namespace.EXO.term("Property_domain"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("domain"))),e.push(new Nr.Triple(me.Namespace.EXO.term("Property_superProperty"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("subPropertyOf"))),e}generateMappedTriple(e,t,r){let i=this.propertyMappings.get(t);if(!i)return null;let s;if(r instanceof nw.IRI)s=r;else{let a=r.match(/^(ems|exo)__(.+)$/);if(a){let[,c,u]=a;s=(c==="ems"?me.Namespace.EMS:me.Namespace.EXO).term(u)}else s=new nw.IRI(r)}return new Nr.Triple(e,i,s)}hasMappingFor(e){return this.propertyMappings.has(e)}};Pl.RDFVocabularyMapper=eg});var ng=y(Sn=>{"use strict";var UP=Sn&&Sn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},BP=Sn&&Sn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},qP=Sn&&Sn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.NoteToRDFConverter=void 0;var iw=qe(),Fl=Oi(),sw=Ye(),qn=lt(),pi=Xr(),GP=ot(),WP=tg(),rg=class{static{o(this,"NoteToRDFConverter")}constructor(e){this.vault=e,this.OBSIDIAN_VAULT_SCHEME="obsidian://vault/",this.vocabularyMapper=new WP.RDFVocabularyMapper}async convertNote(e){let t=this.vault.getFrontmatter(e);if(!t)return[];let r=[],i=this.notePathToIRI(e.path),s=pi.Namespace.EXO.term("Asset_fileName");r.push(new Fl.Triple(i,s,new qn.Literal(e.basename)));for(let[a,c]of Object.entries(t)){if(!this.isExocortexProperty(a))continue;let u=this.propertyKeyToIRI(a),l=Array.isArray(c)?c:[c];for(let h of l)if(a==="exo__Instance_class"){let f=this.valueToClassURI(h);r.push(new Fl.Triple(i,u,f))}else{let f=await this.valueToRDFObject(h,e);if(r.push(new Fl.Triple(i,u,f)),this.vocabularyMapper.hasMappingFor(a)&&f instanceof sw.IRI){let d=this.vocabularyMapper.generateMappedTriple(i,a,f);d&&r.push(d)}}if(a==="exo__Instance_class")for(let h of l){let f=this.expandClassValue(h);if(f){let d=pi.Namespace.RDF.term("type");r.push(new Fl.Triple(i,d,f))}}}return r}async convertVault(){let e=this.vault.getAllFiles(),t=[];for(let r of e)try{let i=await this.convertNote(r);t.push(...i)}catch(i){console.warn(`\u26A0\uFE0F Skipping file with invalid IRI: ${r.path}`),console.warn(`   Reason: ${i instanceof Error?i.message:String(i)}`);continue}return t}notePathToIRI(e){let t=encodeURI(e);return new sw.IRI(`${this.OBSIDIAN_VAULT_SCHEME}${t}`)}isExocortexProperty(e){return e.startsWith("exo__")||e.startsWith("ems__")}propertyKeyToIRI(e){if(e.startsWith("exo__")){let t=e.substring(5);return pi.Namespace.EXO.term(t)}if(e.startsWith("ems__")){let t=e.substring(5);return pi.Namespace.EMS.term(t)}throw new Error(`Invalid property key: ${e}`)}async valueToRDFObject(e,t){if(typeof e=="string"){let r=this.removeQuotes(e),i=this.extractWikilink(r);if(i){let s=this.vault.getFirstLinkpathDest(i,t.path);if(s)return this.notePathToIRI(s.path);if(this.isClassReference(i)){let a=this.expandClassValue(i);if(a)return a}return new qn.Literal(r)}if(this.isClassReference(r)){let s=this.expandClassValue(r);if(s)return s}return this.isISO8601DateTime(r)?new qn.Literal(r,pi.Namespace.XSD.term("dateTime")):new qn.Literal(r)}return typeof e=="boolean"?new qn.Literal(e.toString()):typeof e=="number"?new qn.Literal(e.toString(),pi.Namespace.XSD.term("decimal")):e instanceof Date?new qn.Literal(e.toISOString(),pi.Namespace.XSD.term("dateTime")):new qn.Literal(String(e))}isISO8601DateTime(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{1,3})?(Z|[+-]\d{2}:\d{2})?$/.test(e)}removeQuotes(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.substring(1,t.length-1):e}extractWikilink(e){let t=e.match(/^\[\[([^\]]+)\]\]$/);return t?t[1]:null}valueToClassURI(e){if(typeof e!="string")return new qn.Literal(String(e));let t=this.removeQuotes(e),i=this.extractWikilink(t)||t,s=this.expandClassValue(i);return s||new qn.Literal(t)}isClassReference(e){return(e.startsWith("ems__")||e.startsWith("exo__"))&&!/\s/.test(e)}expandClassValue(e){let t=this.removeQuotes(e);if(t.startsWith("ems__")){let r=t.substring(5);return pi.Namespace.EMS.term(r)}if(t.startsWith("exo__")){let r=t.substring(5);return pi.Namespace.EXO.term(r)}return null}};Sn.NoteToRDFConverter=rg;Sn.NoteToRDFConverter=rg=UP([(0,iw.injectable)(),qP(0,(0,iw.inject)(GP.DI_TOKENS.IVaultAdapter)),BP("design:paramtypes",[Object])],rg)});var ig=y((H$,aw)=>{var Sa=class{static{o(this,"Wildcard")}constructor(){return zP||this}equals(e){return e&&this.termType===e.termType}};Object.defineProperty(Sa.prototype,"value",{enumerable:!0,value:"*"});Object.defineProperty(Sa.prototype,"termType",{enumerable:!0,value:"Wildcard"});var zP=new Sa;aw.exports.Wildcard=Sa});var cw=y((Q$,ow)=>{var HP=(function(){var n=o(function(C,T,O,R){for(O=O||{},R=C.length;R--;O[C[R]]=T);return O},"o"),e=[6,12,13,15,16,24,32,36,41,45,100,110,113,115,116,123,126,131,197,224,229,308,329,330,331,332,333],t=[2,247],r=[100,110,113,115,116,123,126,131,329,330,331,332,333],i=[2,409],s=[1,18],a=[1,27],c=[13,16,45,197,224,229,308],u=[28,29,53],l=[28,53],h=[1,42],f=[1,45],d=[1,41],m=[1,44],_=[123,126],S=[1,67],A=[39,45,87],I=[13,16,45,197,224,308],D=[1,87],L=[2,281],G=[1,86],W=[13,16,45,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],Fe=[6,28,29,53,63,70,73,81,83,85],et=[6,13,16,28,29,53,63,70,73,81,83,85,87,308],ct=[6,13,16,28,29,45,53,63,70,73,81,82,83,85,87,89,197,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314],U=[6,13,16,28,29,31,39,45,47,48,53,63,70,73,81,82,83,85,87,89,109,112,121,123,126,128,159,160,161,163,164,174,193,197,224,229,231,232,242,246,250,263,265,272,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,337,338,340,341,342,343,344,345,346],ue=[13,16,308],Se=[112,132,327,334],Ke=[13,16,112,132,308],Ge=[1,111],tt=[1,117],ke=[112,132,327,328,334],je=[13,16,112,132,308,328],Re=[28,29,45,53,87],H=[1,138],k=[1,151],Me=[1,128],We=[1,127],V=[1,129],de=[1,140],Ce=[1,141],z=[1,142],xe=[1,143],Ie=[1,144],be=[1,145],Oe=[1,147],le=[1,148],Ee=[2,457],pe=[1,158],Te=[1,159],De=[1,160],X=[1,152],re=[1,153],ne=[1,156],J=[1,171],Z=[1,172],ee=[1,173],te=[1,174],ie=[1,175],se=[1,176],ae=[1,167],oe=[1,168],Q=[1,169],ce=[1,170],Ne=[1,157],Pe=[1,166],we=[1,161],b=[1,162],E=[1,163],w=[1,164],x=[1,165],B=[6,13,16,29,31,45,82,85,87,89,112,159,160,161,163,164,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335],Xe=[1,195],it=[6,31,73,81,83,85],_e=[2,285],j=[1,199],M=[1,201],$=[6,31,70,73,81,83,85],q=[2,283],ge=[1,207],Ve=[1,218],$e=[1,223],Lt=[1,219],Sr=[1,225],Dr=[1,226],sr=[1,224],ky=[6,63,70,73,81,83,85],jy=[1,236],My=[2,334],Vy=[1,243],$y=[1,241],kt=[6,193],Qc=[2,349],Uy=[2,339],Ci=[28,128],By=[47,48,193,272],Kc=[47,48,193,242,272],Zs=[47,48,193,242,246,272],ea=[47,48,193,242,246,250,263,265,272,290,297,298,299,300,301,302,341,342,343,344,345,346],Ot=[39,47,48,193,242,246,250,263,265,272,290,297,298,299,300,301,302,338,341,342,343,344,345,346],qy=[1,271],Gy=[1,270],vt=[6,13,16,29,31,39,45,47,48,70,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,231,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,338,341,342,343,344,345,346,347,348,349,350,351],Wy=[1,281],zy=[1,280],ar=[13,16,29,31,39,45,47,48,82,85,87,89,112,159,160,161,163,164,174,193,197,224,229,231,232,242,246,250,263,265,272,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,338,341,342,343,344,345,346],bo=[45,89],Xc=[13,16,29,31,39,45,47,48,82,85,87,89,112,159,160,161,163,164,174,193,197,224,229,231,232,242,246,250,263,265,272,290,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,338,341,342,343,344,345,346],Jc=[13,16,31,82,174,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312],Zc=[31,89],eu=[48,87],ss=[6,13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,337,338],Fn=[6,13,16,39,45,48,82,87,89,231,263,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,337,338,340],Hy=[1,313],ta=[6,85],Cf=[6,31,81,83,85],Yy=[2,361],ei=[2,353],as=[1,343],Eo=[31,112,335],ti=[13,16,29,31,45,48,82,85,87,89,112,159,160,161,163,164,193,197,224,229,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],xf=[13,16,29,31,45,48,82,85,87,89,112,159,160,161,163,164,193,197,224,229,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335],Qy=[6,109,193],os=[31,112],wt=[13,16,45,82,87,224,263,265,268,269,270,271,273,274,276,277,279,280,283,285,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312,346,347,348,349,350,351],If=[1,390],Of=[1,391],xi=[13,16,87,197,308,314],Ky=[13,16,39,45,82,87,224,263,265,268,269,270,271,273,274,276,277,279,280,283,285,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312,346,347,348,349,350,351],tu=[1,417],ru=[1,418],Xy=[13,16,48,197,229,308],Ii=[6,31,85],Jy=[6,13,16,31,45,73,81,83,85,268,269,270,271,273,274,276,277,279,280,283,285,308,346,347,348,349,350,351],Df=[6,13,16,29,31,45,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,231,268,269,270,271,273,274,276,277,279,280,283,285,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,346,347,348,349,350,351],cs=[29,31,85,112,159,160,161,163,164],nu=[1,443],iu=[1,444],Zy=[1,449],us=[31,112,193,232,318,335],su=[13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],e1=[13,16,31,45,48,82,87,89,112,193,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],Pf=[13,16,29,31,45,48,82,85,87,89,112,159,160,161,163,164,193,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],To=[13,16,31,48,82,174,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312],Ao=[31,45],t1=[1,507],r1=[1,508],n1=[6,13,16,29,31,39,45,47,48,63,70,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,231,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,336,338,341,342,343,344,345,346,347,348,349,350,351],au=[29,31,85,112,159,160,161,163,164,335],ls=[6,13,16,31,45,70,73,81,83,85,87,268,269,270,271,273,274,276,277,279,280,283,285,308,346,347,348,349,350,351],i1=[13,16,31,45,48,82,87,89,112,193,197,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],s1=[2,352],Ff=[13,16,197,308,314],a1=[1,565],ra=[6,13,16,31,45,76,78,81,83,85,87,268,269,270,271,273,274,276,277,279,280,283,285,308,346,347,348,349,350,351],o1=[13,16,29,31,45,82,85,87,89,112,159,160,161,163,164,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],ri=[13,16,29,31,45,82,85,87,89,112,159,160,161,163,164,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335],c1=[13,16,87,308],ni=[2,364],na=[29,31,85,112,159,160,161,163,164,193,232,318,335],ou=[31,112,193,232,272,318,335],ii=[2,359],u1=[13,16,48,82,174,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312],cu=[29,31,85,112,159,160,161,163,164,193,232,272,318,335],l1=[13,16,31,45,82,87,89,112,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],h1=[2,347],Rf={trace:o(function(){},"trace"),yy:{},symbols_:{error:2,QueryOrUpdate:3,Prologue:4,QueryOrUpdate_group0:5,EOF:6,Query:7,Qry:8,Query_option0:9,Prologue_repetition0:10,BaseDecl:11,BASE:12,IRIREF:13,PrefixDecl:14,PREFIX:15,PNAME_NS:16,SelectClauseWildcard:17,Qry_repetition0:18,WhereClause:19,SolutionModifierNoGroup:20,SelectClauseVars:21,Qry_repetition1:22,SolutionModifier:23,CONSTRUCT:24,ConstructTemplate:25,Qry_repetition2:26,Qry_repetition3:27,WHERE:28,"{":29,Qry_option0:30,"}":31,DESCRIBE:32,Qry_group0:33,Qry_repetition4:34,Qry_option1:35,ASK:36,Qry_repetition5:37,SelectClauseBase:38,"*":39,SelectClauseVars_repetition_plus0:40,SELECT:41,SelectClauseBase_option0:42,SelectClauseItem:43,Var:44,"(":45,Expression:46,AS:47,")":48,SubSelect:49,SubSelect_option0:50,SubSelect_option1:51,DatasetClause:52,FROM:53,DatasetClause_option0:54,iri:55,WhereClause_option0:56,GroupGraphPattern:57,SolutionModifier_option0:58,SolutionModifierNoGroup_option0:59,SolutionModifierNoGroup_option1:60,SolutionModifierNoGroup_option2:61,GroupClause:62,GROUP:63,BY:64,GroupClause_repetition_plus0:65,GroupCondition:66,BuiltInCall:67,FunctionCall:68,HavingClause:69,HAVING:70,HavingClause_repetition_plus0:71,OrderClause:72,ORDER:73,OrderClause_repetition_plus0:74,OrderCondition:75,ASC:76,BrackettedExpression:77,DESC:78,Constraint:79,LimitOffsetClauses:80,LIMIT:81,INTEGER:82,OFFSET:83,ValuesClause:84,VALUES:85,InlineData:86,VAR:87,InlineData_repetition0:88,NIL:89,InlineData_repetition1:90,InlineData_repetition_plus2:91,InlineData_repetition3:92,DataBlock:93,DataBlockValueList:94,DataBlockValueList_repetition_plus0:95,Update:96,Update_repetition0:97,Update1:98,Update_option0:99,LOAD:100,Update1_option0:101,Update1_option1:102,Update1_group0:103,Update1_option2:104,GraphRefAll:105,Update1_group1:106,Update1_option3:107,GraphOrDefault:108,TO:109,CREATE:110,Update1_option4:111,GRAPH:112,INSERTDATA:113,QuadPattern:114,DELETEDATA:115,DELETEWHERE:116,Update1_option5:117,InsertDeleteClause:118,Update1_repetition0:119,IntoGraphClause:120,INTO:121,GraphRef:122,DELETE:123,InsertDeleteClause_option0:124,InsertClause:125,INSERT:126,UsingClause:127,USING:128,UsingClause_option0:129,WithClause:130,WITH:131,DEFAULT:132,GraphOrDefault_option0:133,GraphRefAll_group0:134,Quads:135,Quads_option0:136,Quads_repetition0:137,QuadsNotTriples:138,VarOrIri:139,QuadsNotTriples_option0:140,QuadsNotTriples_option1:141,QuadsNotTriples_option2:142,TriplesTemplate:143,TriplesTemplate_repetition0:144,TriplesSameSubject:145,TriplesTemplate_option0:146,GroupGraphPatternSub:147,GroupGraphPatternSub_option0:148,GroupGraphPatternSub_repetition0:149,GroupGraphPatternSubTail:150,GraphPatternNotTriples:151,GroupGraphPatternSubTail_option0:152,GroupGraphPatternSubTail_option1:153,TriplesBlock:154,TriplesBlock_repetition0:155,TriplesSameSubjectPath:156,TriplesBlock_option0:157,GroupOrUnionGraphPattern:158,OPTIONAL:159,MINUS:160,SERVICE:161,GraphPatternNotTriples_option0:162,FILTER:163,BIND:164,InlineDataOneVar:165,InlineDataFull:166,InlineDataOneVar_repetition0:167,InlineDataFull_repetition0:168,InlineDataFull_repetition_plus1:169,InlineDataFull_repetition2:170,DataBlockValue:171,Literal:172,QuotedTriple:173,UNDEF:174,GroupOrUnionGraphPattern_repetition0:175,ArgList:176,ArgList_option0:177,ArgList_repetition0:178,ExpressionList:179,ExpressionList_repetition0:180,ConstructTemplate_option0:181,ConstructTriples:182,ConstructTriples_repetition0:183,ConstructTriples_option0:184,VarOrTermOrQuotedTP:185,PropertyListNotEmpty:186,TriplesNode:187,PropertyList:188,PropertyList_option0:189,VerbObjectList:190,PropertyListNotEmpty_repetition0:191,SemiOptionalVerbObjectList:192,";":193,SemiOptionalVerbObjectList_option0:194,Verb:195,ObjectList:196,a:197,ObjectList_repetition0:198,Object:199,GraphNode:200,Object_option0:201,PropertyListPathNotEmpty:202,TriplesNodePath:203,TriplesSameSubjectPath_option0:204,O:205,PropertyListPathNotEmpty_repetition0:206,PropertyListPathNotEmptyTail:207,O_group0:208,ObjectListPath:209,ObjectListPath_repetition0:210,ObjectPath:211,GraphNodePath:212,ObjectPath_option0:213,Path:214,Path_repetition0:215,PathSequence:216,PathSequence_repetition0:217,PathEltOrInverse:218,PathElt:219,PathPrimary:220,PathElt_option0:221,PathEltOrInverse_option0:222,IriOrA:223,"!":224,PathNegatedPropertySet:225,PathOneInPropertySet:226,PathNegatedPropertySet_repetition0:227,PathNegatedPropertySet_option0:228,"^":229,TriplesNode_repetition_plus0:230,"[":231,"]":232,TriplesNodePath_repetition_plus0:233,VarOrTermOrQuotedTPExpr:234,VarOrTerm:235,GraphTerm:236,BlankNode:237,ConditionalOrExpression:238,ConditionalAndExpression:239,ConditionalOrExpression_repetition0:240,ConditionalOrExpressionTail:241,"||":242,RelationalExpression:243,ConditionalAndExpression_repetition0:244,ConditionalAndExpressionTail:245,"&&":246,NumericExpression:247,RelationalExpression_group0:248,RelationalExpression_option0:249,IN:250,MultiplicativeExpression:251,NumericExpression_repetition0:252,AdditiveExpressionTail:253,AdditiveExpressionTail_group0:254,NumericLiteralPositive:255,AdditiveExpressionTail_repetition0:256,NumericLiteralNegative:257,AdditiveExpressionTail_repetition1:258,UnaryExpression:259,MultiplicativeExpression_repetition0:260,MultiplicativeExpressionTail:261,MultiplicativeExpressionTail_group0:262,"+":263,PrimaryExpression:264,"-":265,ExprQuotedTP:266,Aggregate:267,FUNC_ARITY0:268,FUNC_ARITY1:269,FUNC_ARITY1_SPARQL_STAR:270,FUNC_ARITY2:271,",":272,FUNC_ARITY3:273,FUNC_ARITY3_SPARQL_STAR:274,BuiltInCall_group0:275,BOUND:276,BNODE:277,BuiltInCall_option0:278,EXISTS:279,COUNT:280,Aggregate_option0:281,Aggregate_group0:282,FUNC_AGGREGATE:283,Aggregate_option1:284,GROUP_CONCAT:285,Aggregate_option2:286,Aggregate_option3:287,GroupConcatSeparator:288,SEPARATOR:289,"=":290,String:291,LANGTAG:292,"^^":293,DECIMAL:294,DOUBLE:295,BOOLEAN:296,INTEGER_POSITIVE:297,DECIMAL_POSITIVE:298,DOUBLE_POSITIVE:299,INTEGER_NEGATIVE:300,DECIMAL_NEGATIVE:301,DOUBLE_NEGATIVE:302,STRING_LITERAL1:303,STRING_LITERAL2:304,STRING_LITERAL_LONG1:305,STRING_LITERAL_LONG2:306,PrefixedName:307,PNAME_LN:308,BLANK_NODE_LABEL:309,ANON:310,QuotedTP:311,"<<":312,qtSubjectOrObject:313,">>":314,DataValueTerm:315,AnnotationPattern:316,"{|":317,"|}":318,AnnotationPatternPath:319,ExprVarOrTerm:320,QueryOrUpdate_group0_option0:321,Prologue_repetition0_group0:322,Qry_group0_repetition_plus0:323,SelectClauseBase_option0_group0:324,DISTINCT:325,REDUCED:326,NAMED:327,SILENT:328,CLEAR:329,DROP:330,ADD:331,MOVE:332,COPY:333,ALL:334,".":335,UNION:336,"|":337,"/":338,PathElt_option0_group0:339,"?":340,"!=":341,"<":342,">":343,"<=":344,">=":345,NOT:346,CONCAT:347,COALESCE:348,SUBSTR:349,REGEX:350,REPLACE:351,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",12:"BASE",13:"IRIREF",15:"PREFIX",16:"PNAME_NS",24:"CONSTRUCT",28:"WHERE",29:"{",31:"}",32:"DESCRIBE",36:"ASK",39:"*",41:"SELECT",45:"(",47:"AS",48:")",53:"FROM",63:"GROUP",64:"BY",70:"HAVING",73:"ORDER",76:"ASC",78:"DESC",81:"LIMIT",82:"INTEGER",83:"OFFSET",85:"VALUES",87:"VAR",89:"NIL",100:"LOAD",109:"TO",110:"CREATE",112:"GRAPH",113:"INSERTDATA",115:"DELETEDATA",116:"DELETEWHERE",121:"INTO",123:"DELETE",126:"INSERT",128:"USING",131:"WITH",132:"DEFAULT",159:"OPTIONAL",160:"MINUS",161:"SERVICE",163:"FILTER",164:"BIND",174:"UNDEF",193:";",197:"a",224:"!",229:"^",231:"[",232:"]",242:"||",246:"&&",250:"IN",263:"+",265:"-",268:"FUNC_ARITY0",269:"FUNC_ARITY1",270:"FUNC_ARITY1_SPARQL_STAR",271:"FUNC_ARITY2",272:",",273:"FUNC_ARITY3",274:"FUNC_ARITY3_SPARQL_STAR",276:"BOUND",277:"BNODE",279:"EXISTS",280:"COUNT",283:"FUNC_AGGREGATE",285:"GROUP_CONCAT",289:"SEPARATOR",290:"=",292:"LANGTAG",293:"^^",294:"DECIMAL",295:"DOUBLE",296:"BOOLEAN",297:"INTEGER_POSITIVE",298:"DECIMAL_POSITIVE",299:"DOUBLE_POSITIVE",300:"INTEGER_NEGATIVE",301:"DECIMAL_NEGATIVE",302:"DOUBLE_NEGATIVE",303:"STRING_LITERAL1",304:"STRING_LITERAL2",305:"STRING_LITERAL_LONG1",306:"STRING_LITERAL_LONG2",308:"PNAME_LN",309:"BLANK_NODE_LABEL",310:"ANON",312:"<<",314:">>",317:"{|",318:"|}",325:"DISTINCT",326:"REDUCED",327:"NAMED",328:"SILENT",329:"CLEAR",330:"DROP",331:"ADD",332:"MOVE",333:"COPY",334:"ALL",335:".",336:"UNION",337:"|",338:"/",340:"?",341:"!=",342:"<",343:">",344:"<=",345:">=",346:"NOT",347:"CONCAT",348:"COALESCE",349:"SUBSTR",350:"REGEX",351:"REPLACE"},productions_:[0,[3,3],[7,2],[4,1],[11,2],[14,3],[8,4],[8,4],[8,5],[8,7],[8,5],[8,4],[17,2],[21,2],[38,2],[43,1],[43,5],[49,4],[49,4],[52,3],[19,2],[23,2],[20,3],[62,3],[66,1],[66,1],[66,3],[66,5],[66,1],[69,2],[72,3],[75,2],[75,2],[75,1],[75,1],[80,2],[80,2],[80,4],[80,4],[84,2],[86,4],[86,4],[86,6],[86,2],[94,3],[96,3],[98,4],[98,3],[98,5],[98,4],[98,2],[98,2],[98,2],[98,5],[120,2],[118,3],[118,1],[125,2],[127,3],[130,2],[108,1],[108,2],[122,2],[105,1],[105,1],[114,3],[135,2],[138,7],[143,3],[57,3],[57,3],[147,2],[150,3],[154,3],[151,1],[151,2],[151,2],[151,3],[151,4],[151,2],[151,6],[151,1],[93,1],[93,1],[165,4],[166,4],[166,6],[171,1],[171,1],[171,1],[171,1],[158,2],[79,1],[79,1],[79,1],[68,2],[176,1],[176,5],[179,1],[179,4],[25,3],[182,3],[145,2],[145,2],[188,1],[186,2],[192,2],[190,2],[195,1],[195,1],[196,2],[199,2],[156,2],[156,2],[202,2],[207,1],[207,2],[205,2],[209,2],[211,2],[214,2],[216,2],[219,2],[218,2],[220,1],[220,2],[220,3],[225,1],[225,1],[225,4],[226,1],[226,2],[187,3],[187,3],[203,3],[203,3],[200,1],[200,1],[212,1],[212,1],[234,1],[235,1],[235,1],[139,1],[139,1],[44,1],[236,1],[236,1],[236,1],[236,1],[46,1],[238,2],[241,2],[239,2],[245,2],[243,1],[243,3],[243,4],[247,2],[253,2],[253,2],[253,2],[251,2],[261,2],[259,2],[259,2],[259,2],[259,1],[264,1],[264,1],[264,1],[264,1],[264,1],[264,1],[264,1],[77,3],[67,1],[67,2],[67,4],[67,4],[67,6],[67,8],[67,8],[67,2],[67,4],[67,2],[67,4],[67,3],[267,5],[267,5],[267,6],[288,4],[172,1],[172,2],[172,3],[172,1],[172,1],[172,1],[172,1],[172,1],[172,1],[255,1],[255,1],[255,1],[257,1],[257,1],[257,1],[291,1],[291,1],[291,1],[291,1],[55,1],[55,1],[307,1],[307,1],[237,1],[237,1],[311,5],[173,5],[313,1],[313,1],[313,1],[313,1],[313,1],[315,1],[315,1],[315,1],[185,1],[185,1],[185,1],[316,3],[319,3],[266,5],[320,1],[320,1],[320,1],[223,1],[223,1],[321,0],[321,1],[5,1],[5,1],[5,1],[9,0],[9,1],[322,1],[322,1],[10,0],[10,2],[18,0],[18,2],[22,0],[22,2],[26,0],[26,2],[27,0],[27,2],[30,0],[30,1],[323,1],[323,2],[33,1],[33,1],[34,0],[34,2],[35,0],[35,1],[37,0],[37,2],[40,1],[40,2],[324,1],[324,1],[42,0],[42,1],[50,0],[50,1],[51,0],[51,1],[54,0],[54,1],[56,0],[56,1],[58,0],[58,1],[59,0],[59,1],[60,0],[60,1],[61,0],[61,1],[65,1],[65,2],[71,1],[71,2],[74,1],[74,2],[88,0],[88,2],[90,0],[90,2],[91,1],[91,2],[92,0],[92,2],[95,1],[95,2],[97,0],[97,4],[99,0],[99,2],[101,0],[101,1],[102,0],[102,1],[103,1],[103,1],[104,0],[104,1],[106,1],[106,1],[106,1],[107,0],[107,1],[111,0],[111,1],[117,0],[117,1],[119,0],[119,2],[124,0],[124,1],[129,0],[129,1],[133,0],[133,1],[134,1],[134,1],[134,1],[136,0],[136,1],[137,0],[137,2],[140,0],[140,1],[141,0],[141,1],[142,0],[142,1],[144,0],[144,3],[146,0],[146,1],[148,0],[148,1],[149,0],[149,2],[152,0],[152,1],[153,0],[153,1],[155,0],[155,3],[157,0],[157,1],[162,0],[162,1],[167,0],[167,2],[168,0],[168,2],[169,1],[169,2],[170,0],[170,2],[175,0],[175,3],[177,0],[177,1],[178,0],[178,3],[180,0],[180,3],[181,0],[181,1],[183,0],[183,3],[184,0],[184,1],[189,0],[189,1],[191,0],[191,2],[194,0],[194,1],[198,0],[198,3],[201,0],[201,1],[204,0],[204,1],[206,0],[206,2],[208,1],[208,1],[210,0],[210,3],[213,0],[213,1],[215,0],[215,3],[217,0],[217,3],[339,1],[339,1],[339,1],[221,0],[221,1],[222,0],[222,1],[227,0],[227,3],[228,0],[228,1],[230,1],[230,2],[233,1],[233,2],[240,0],[240,2],[244,0],[244,2],[248,1],[248,1],[248,1],[248,1],[248,1],[248,1],[249,0],[249,1],[252,0],[252,2],[254,1],[254,1],[256,0],[256,2],[258,0],[258,2],[260,0],[260,2],[262,1],[262,1],[275,1],[275,1],[275,1],[275,1],[275,1],[278,0],[278,1],[281,0],[281,1],[282,1],[282,1],[284,0],[284,1],[286,0],[286,1],[287,0],[287,1]],performAction:o(function(T,O,R,Y,ve,p,cr){var g=p.length-1;switch(ve){case 1:if(p[g-1]=p[g-1]||{},Ae.base&&(p[g-1].base=Ae.base),Ae.base="",p[g-1].prefixes=Ae.prefixes,Ae.prefixes=null,Ae.pathOnly){if(p[g-1].type==="path"||"termType"in p[g-1])return p[g-1];throw new Error("Received full SPARQL query in path only mode")}else if(p[g-1].type==="path"||"termType"in p[g-1])throw new Error("Received only path in full SPARQL mode");if(p[g-1].type==="update"){let Je={};for(let ut of p[g-1].updates)if(ut.updateType==="insert"){let Ue={};for(let He of ut.insert)if(He.type==="bgp"||He.type==="graph")for(let br of He.triples)br.subject.termType==="BlankNode"&&(Ue[br.subject.value]=!0),br.predicate.termType==="BlankNode"&&(Ue[br.predicate.value]=!0),br.object.termType==="BlankNode"&&(Ue[br.object.value]=!0);for(let He of Object.keys(Ue)){if(Je[He])throw new Error("Detected reuse blank node across different INSERT DATA clauses");Je[He]=!0}}}return p[g-1];case 2:this.$={...p[g-1],...p[g],type:"query"};break;case 4:Ae.base=Co(p[g]);break;case 5:Ae.prefixes||(Ae.prefixes={}),p[g-1]=p[g-1].substr(0,p[g-1].length-1),p[g]=Co(p[g]),Ae.prefixes[p[g-1]]=p[g];break;case 6:this.$={...p[g-3],...ds(p[g-2]),...p[g-1],...p[g]};break;case 7:if(!Ae.skipValidation&&(Uf(p[g-3].variables.map(ut=>$f(ut.expression))).some(ut=>ut.aggregation==="count"&&!(ut.expression instanceof uu))||p[g].group)){for(let ut of p[g-3].variables)if(ut.termType==="Variable"){if(!p[g].group||!p[g].group.map(Ue=>oa(Ue)).includes(oa(ut)))throw Error("Projection of ungrouped variable (?"+oa(ut)+")")}else if($f(ut.expression).length===0){let Ue=sT(ut.expression);for(let He of Ue)if(!p[g].group||!p[g].group.map||!p[g].group.map(br=>oa(br)).includes(oa(He)))throw Error("Use of ungrouped variable in projection of operation (?"+oa(He)+")")}}let kn=p[g-1].where.filter(Je=>Je.type==="query");if(kn.length>0){let Je=p[g-3].variables.filter(Ue=>Ue.variable&&Ue.variable.value).map(Ue=>Ue.variable.value),ut=Uf(kn.map(Ue=>Ue.variables)).map(Ue=>Ue.value||Ue.variable.value);for(let Ue of Je)if(ut.indexOf(Ue)>=0)throw Error("Target id of 'AS' (?"+Ue+") already used in subquery")}this.$=mt(p[g-3],ds(p[g-2]),p[g-1],p[g]);break;case 8:this.$=mt({queryType:"CONSTRUCT",template:p[g-3]},ds(p[g-2]),p[g-1],p[g]);break;case 9:this.$=mt({queryType:"CONSTRUCT",template:p[g-2]=p[g-2]?p[g-2].triples:[]},ds(p[g-5]),{where:[{type:"bgp",triples:fs([],p[g-2])}]},p[g]);break;case 10:this.$=mt({queryType:"DESCRIBE",variables:p[g-3]==="*"?[new uu]:p[g-3]},ds(p[g-2]),p[g-1],p[g]);break;case 11:this.$=mt({queryType:"ASK"},ds(p[g-2]),p[g-1],p[g]);break;case 12:this.$=mt(p[g-1],{variables:[new uu]});break;case 13:let Po=p[g].map(Je=>Je.value||Je.variable.value),ca=aT(Po);if(ca.length>0)throw Error("Two or more of the resulting columns have the same name (?"+ca[0]+")");this.$=mt(p[g-1],{variables:p[g]});break;case 14:this.$=mt({queryType:"SELECT"},p[g]&&(p[g-1]=or(p[g]),p[g]={},p[g][p[g-1]]=!0,p[g]));break;case 16:case 27:this.$=ia(p[g-3],{variable:p[g-1]});break;case 17:case 18:this.$=mt(p[g-3],p[g-2],p[g-1],p[g],{type:"query"});break;case 19:case 58:this.$={iri:p[g],named:!!p[g-1]};break;case 20:this.$={where:p[g].patterns};break;case 21:this.$=mt(p[g-1],p[g]);break;case 22:this.$=mt(p[g-2],p[g-1],p[g]);break;case 23:this.$={group:p[g]};break;case 24:case 25:case 28:case 31:case 33:case 34:this.$=ia(p[g]);break;case 26:this.$=ia(p[g-1]);break;case 29:this.$={having:p[g]};break;case 30:this.$={order:p[g]};break;case 32:this.$=ia(p[g],{descending:!0});break;case 35:this.$={limit:aa(p[g])};break;case 36:this.$={offset:aa(p[g])};break;case 37:this.$={limit:aa(p[g-2]),offset:aa(p[g])};break;case 38:this.$={limit:aa(p[g]),offset:aa(p[g-2])};break;case 39:case 43:this.$={type:"values",values:p[g]};break;case 40:case 84:this.$=p[g-1].map(Je=>({[p[g-3]]:Je}));break;case 41:case 85:this.$=p[g-1].map(()=>({}));break;case 42:case 86:var Ln=p[g-4].length;p[g-4]=p[g-4].map(Nf),this.$=p[g-1].map(function(Je){if(Je.length!==Ln)throw Error("Inconsistent VALUES length");for(var ut={},Ue=0;Ue<Ln;Ue++)ut["?"+p[g-4][Ue].value]=Je[Ue];return ut});break;case 44:case 65:case 100:case 126:case 175:this.$=p[g-1];break;case 45:this.$={type:"update",updates:si(p[g-2],p[g-1])};break;case 46:this.$=mt({type:"load",silent:!!p[g-2],source:p[g-1]},p[g]&&{destination:p[g]});break;case 47:this.$={type:or(p[g-2]),silent:!!p[g-1],graph:p[g]};break;case 48:this.$={type:or(p[g-4]),silent:!!p[g-3],source:p[g-2],destination:p[g]};break;case 49:this.$={type:"create",silent:!!p[g-2],graph:{type:"graph",name:p[g]}};break;case 50:this.$={updateType:"insert",insert:b1(p[g])};break;case 51:this.$={updateType:"delete",delete:Gf(b1(p[g]))};break;case 52:this.$={updateType:"deletewhere",delete:Gf(p[g])};break;case 53:this.$={updateType:"insertdelete",...p[g-4],...p[g-3],...ds(p[g-2],"using"),where:p[g].patterns};break;case 54:case 57:case 62:case 167:case 191:case 236:this.$=p[g];break;case 55:this.$={delete:Gf(p[g-1]),insert:p[g]||[]};break;case 56:this.$={delete:[],insert:p[g]};break;case 59:this.$={graph:p[g]};break;case 60:this.$={type:"graph",default:!0};break;case 61:case 63:this.$={type:"graph",name:p[g]};break;case 64:this.$={[or(p[g])]:!0};break;case 66:this.$=p[g-1]?Rn(p[g],[p[g-1]]):Rn(p[g]);break;case 67:var Oo=mt(p[g-3]||{triples:[]},{type:"graph",name:p[g-5]});this.$=p[g]?[Oo,p[g]]:[Oo];break;case 68:case 73:this.$={type:"bgp",triples:Rn(p[g-2],[p[g-1]])};break;case 69:this.$={type:"group",patterns:[p[g-1]]};break;case 70:for(let Je of p[g-1].filter(ut=>ut.type==="bind")){let ut=p[g-1].indexOf(Je),Ue=new Set;for(let He of p[g-1].slice(0,ut))(He.type==="group"||He.type==="bgp")&&_1(He).forEach(br=>Ue.add(br));if(Ue.has(Je.variable.value))throw Error("Variable used to bind is already bound (?"+Je.variable.value+")")}this.$={type:"group",patterns:p[g-1]};break;case 71:this.$=p[g-1]?Rn([p[g-1]],p[g]):Rn(p[g]);break;case 72:this.$=p[g]?[p[g-2],p[g]]:p[g-2];break;case 75:this.$=mt(p[g],{type:"optional"});break;case 76:this.$=mt(p[g],{type:"minus"});break;case 77:this.$=mt(p[g],{type:"graph",name:p[g-1]});break;case 78:this.$=mt(p[g],{type:"service",name:p[g-1],silent:!!p[g-2]});break;case 79:this.$={type:"filter",expression:p[g]};break;case 80:this.$={type:"bind",variable:p[g-1],expression:p[g-3]};break;case 89:this.$=Io(p[g]);break;case 90:this.$=void 0;break;case 91:this.$=p[g-1].length?{type:"union",patterns:Rn(p[g-1].map(kf),[kf(p[g])])}:p[g];break;case 95:this.$={...p[g],function:p[g-1]};break;case 96:this.$={type:"functionCall",args:[]};break;case 97:this.$={type:"functionCall",args:si(p[g-2],p[g-1]),distinct:!!p[g-3]};break;case 98:case 115:case 128:case 247:case 249:case 251:case 253:case 255:case 263:case 267:case 297:case 299:case 303:case 307:case 328:case 341:case 349:case 355:case 361:case 367:case 369:case 373:case 375:case 379:case 381:case 385:case 391:case 395:case 401:case 405:case 409:case 411:case 420:case 428:case 430:case 440:case 444:case 446:case 448:this.$=[];break;case 99:this.$=si(p[g-2],p[g-1]);break;case 101:this.$=Rn(p[g-2],[p[g-1]]);break;case 102:case 112:this.$=qf(p[g].map(Je=>mt(ai(p[g-1]),Je)));break;case 103:this.$=qf(fs(p[g].map(Je=>mt(ai(p[g-1].entity),Je)),p[g-1].triples));break;case 105:this.$=Rn([p[g-1]],p[g]);break;case 106:this.$=Rn(p[g]);break;case 107:this.$=Vf(p[g-1],p[g]);break;case 109:case 237:this.$=Ae.factory.namedNode(QE);break;case 110:case 118:this.$=si(p[g-1],p[g]);break;case 111:this.$=p[g]?{annotation:p[g],object:p[g-1]}:p[g-1];break;case 113:this.$=p[g]?qf(fs(p[g].map(Je=>mt(ai(p[g-1].entity),Je)),p[g-1].triples)):p[g-1].triples;break;case 114:this.$=Vf(...p[g-1],p[g]);break;case 116:this.$=Vf(...p[g]);break;case 117:case 159:case 163:this.$=[p[g-1],p[g]];break;case 119:this.$=p[g]?{object:p[g-1],annotation:p[g]}:p[g-1];break;case 120:this.$=p[g-1].length?sa("|",si(p[g-1],p[g])):p[g];break;case 121:this.$=p[g-1].length?sa("/",si(p[g-1],p[g])):p[g];break;case 122:this.$=p[g]?sa(p[g],[p[g-1]]):p[g-1];break;case 123:this.$=p[g-1]?sa(p[g-1],[p[g]]):p[g];break;case 125:case 131:this.$=sa(p[g-1],[p[g]]);break;case 129:this.$=sa("|",si(p[g-2],p[g-1]));break;case 132:case 134:this.$=nT(p[g-1]);break;case 133:case 135:this.$=iT(p[g-1]);break;case 140:this.$={entity:p[g],triples:[]};break;case 145:this.$=Nf(p[g]);break;case 149:this.$=Ae.factory.namedNode(f1);break;case 151:case 153:case 158:case 162:this.$=Lf(p[g-1],p[g]);break;case 152:this.$=["||",p[g]];break;case 154:this.$=["&&",p[g]];break;case 156:this.$=jt(p[g-1],[p[g-2],p[g]]);break;case 157:this.$=jt(p[g-2]?"notin":"in",[p[g-3],p[g]]);break;case 160:this.$=["+",Lf(p[g-1],p[g])];break;case 161:var fu=Nn(p[g-1].value.replace("-",""),p[g-1].datatype);this.$=["-",Lf(fu,p[g])];break;case 164:this.$=jt("UPLUS",[p[g]]);break;case 165:this.$=jt(p[g-1],[p[g]]);break;case 166:this.$=jt("UMINUS",[p[g]]);break;case 177:this.$=jt(or(p[g-1]));break;case 178:this.$=jt(or(p[g-3]),[p[g-1]]);break;case 179:this.$=Io(jt(or(p[g-3]),[p[g-1]]));break;case 180:this.$=jt(or(p[g-5]),[p[g-3],p[g-1]]);break;case 181:this.$=jt(or(p[g-7]),[p[g-5],p[g-3],p[g-1]]);break;case 182:this.$=Io(jt(or(p[g-7]),[p[g-5],p[g-3],p[g-1]]));break;case 183:this.$=jt(or(p[g-1]),p[g]);break;case 184:this.$=jt("bound",[Nf(p[g-1])]);break;case 185:this.$=jt(p[g-1],[]);break;case 186:this.$=jt(p[g-3],[p[g-1]]);break;case 187:this.$=jt(p[g-2]?"notexists":"exists",[kf(p[g])]);break;case 188:case 189:this.$=ia(p[g-1],{type:"aggregate",aggregation:or(p[g-4]),distinct:!!p[g-2]});break;case 190:this.$=ia(p[g-2],{type:"aggregate",aggregation:or(p[g-5]),distinct:!!p[g-3],separator:typeof p[g-1]=="string"?p[g-1]:" "});break;case 192:this.$=Nn(p[g]);break;case 193:this.$=ZE(p[g-1],or(p[g].substr(1)));break;case 194:this.$=Nn(p[g-2],p[g]);break;case 195:case 204:this.$=Nn(p[g],d1);break;case 196:case 205:this.$=Nn(p[g],p1);break;case 197:case 206:this.$=Nn(or(p[g]),m1);break;case 200:this.$=Nn(p[g].toLowerCase(),JE);break;case 201:this.$=Nn(p[g].substr(1),d1);break;case 202:this.$=Nn(p[g].substr(1),p1);break;case 203:this.$=Nn(p[g].substr(1).toLowerCase(),m1);break;case 207:case 208:this.$=w1(p[g],1);break;case 209:case 210:this.$=w1(p[g],3);break;case 211:this.$=Ae.factory.namedNode(Co(p[g]));break;case 213:var du=p[g].indexOf(":"),Do=p[g].substr(0,du),pu=Ae.prefixes[Do];if(!pu)throw new Error("Unknown prefix: "+Do);var dt=Co(pu+p[g].substr(du+1));this.$=Ae.factory.namedNode(dt);break;case 214:if(p[g]=p[g].substr(0,p[g].length-1),!(p[g]in Ae.prefixes))throw new Error("Unknown prefix: "+p[g]);var dt=Co(Ae.prefixes[p[g]]);this.$=Ae.factory.namedNode(dt);break;case 215:this.$=xo(p[g].replace(/^(_:)/,""));break;case 216:this.$=xo();break;case 217:case 218:case 232:this.$=Io(jf(p[g-3],p[g-2],p[g-1]));break;case 230:case 231:this.$=Io(p[g-1]);break;case 248:case 250:case 252:case 254:case 256:case 260:case 264:case 268:case 270:case 292:case 294:case 296:case 298:case 300:case 302:case 304:case 306:case 329:case 342:case 356:case 368:case 370:case 372:case 374:case 392:case 402:case 425:case 427:case 429:case 431:case 441:case 445:case 447:case 449:p[g-1].push(p[g]);break;case 259:case 269:case 291:case 293:case 295:case 301:case 305:case 371:case 424:case 426:this.$=[p[g]];break;case 308:p[g-3].push(p[g-2]);break;case 350:case 362:case 376:case 380:case 382:case 386:case 396:case 406:case 410:case 412:case 421:p[g-2].push(p[g-1]);break}},"anonymous"),table:[n(e,t,{3:1,4:2,10:3}),{1:[3]},n(r,[2,307],{5:4,7:5,321:6,214:7,8:8,96:9,215:10,17:11,21:12,97:16,38:17,6:[2,238],13:i,16:i,45:i,197:i,224:i,229:i,308:i,24:[1,13],32:[1,14],36:[1,15],41:s}),n([6,13,16,24,32,36,41,45,100,110,113,115,116,123,126,131,197,224,229,308,329,330,331,332,333],[2,3],{322:19,11:20,14:21,12:[1,22],15:[1,23]}),{6:[1,24]},{6:[2,240]},{6:[2,241]},{6:[2,242]},{6:[2,243],9:25,84:26,85:a},{6:[2,239]},n(c,[2,411],{216:28,217:29}),n(u,[2,249],{18:30}),n(u,[2,251],{22:31}),n(l,[2,255],{25:32,27:33,29:[1,34]}),{13:h,16:f,33:35,39:[1,37],44:39,55:40,87:d,139:38,307:43,308:m,323:36},n(u,[2,267],{37:46}),n(_,[2,326],{98:47,103:49,106:50,117:55,130:61,100:[1,48],110:[1,51],113:[1,52],115:[1,53],116:[1,54],131:[1,62],329:[1,56],330:[1,57],331:[1,58],332:[1,59],333:[1,60]}),{39:[1,63],40:64,43:65,44:66,45:S,87:d},n(A,[2,273],{42:68,324:69,325:[1,70],326:[1,71]}),n(e,[2,248]),n(e,[2,245]),n(e,[2,246]),{13:[1,72]},{16:[1,73]},{1:[2,1]},{6:[2,2]},{6:[2,244]},{45:[1,77],85:[1,78],86:74,87:[1,75],89:[1,76]},n([6,13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],[2,120],{337:[1,79]}),n(I,[2,418],{218:80,222:81,229:[1,82]}),{19:83,28:D,29:L,52:84,53:G,56:85},{19:88,28:D,29:L,52:89,53:G,56:85},n(u,[2,253],{26:90}),{28:[1,91],52:92,53:G},n(W,[2,385],{181:93,182:94,183:95,31:[2,383]}),n(Fe,[2,263],{34:96}),n(Fe,[2,261],{44:39,55:40,307:43,139:97,13:h,16:f,87:d,308:m}),n(Fe,[2,262]),n(et,[2,259]),n(ct,[2,143]),n(ct,[2,144]),n([6,13,16,28,29,31,39,45,47,48,53,63,70,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,197,224,229,231,232,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,338,341,342,343,344,345,346,347,348,349,350,351],[2,145]),n(U,[2,211]),n(U,[2,212]),n(U,[2,213]),n(U,[2,214]),{19:98,28:D,29:L,52:99,53:G,56:85},{6:[2,309],99:100,193:[1,101]},n(ue,[2,311],{101:102,328:[1,103]}),n(Se,[2,317],{104:104,328:[1,105]}),n(Ke,[2,322],{107:106,328:[1,107]}),{111:108,112:[2,324],328:[1,109]},{29:Ge,114:110},{29:Ge,114:112},{29:Ge,114:113},{118:114,123:[1,115],125:116,126:tt},n(ke,[2,315]),n(ke,[2,316]),n(je,[2,319]),n(je,[2,320]),n(je,[2,321]),n(_,[2,327]),{13:h,16:f,55:118,307:43,308:m},n(u,[2,12]),n(u,[2,13],{44:66,43:119,45:S,87:d}),n(Re,[2,269]),n(Re,[2,15]),{13:h,16:f,44:136,45:H,46:120,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(A,[2,14]),n(A,[2,274]),n(A,[2,271]),n(A,[2,272]),n(e,[2,4]),{13:[1,177]},n(B,[2,39]),{29:[1,178]},{29:[1,179]},{87:[1,181],91:180},{45:[1,187],87:[1,185],89:[1,186],93:182,165:183,166:184},n(c,[2,410]),n([6,13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,337],[2,121],{338:[1,188]}),{13:h,16:f,45:[1,193],55:194,197:Xe,219:189,220:190,223:191,224:[1,192],307:43,308:m},n(I,[2,419]),n(it,_e,{20:196,59:197,69:198,70:j}),n(u,[2,250]),{29:M,57:200},n(ue,[2,279],{54:202,327:[1,203]}),{29:[2,282]},n($,q,{23:204,58:205,62:206,63:ge}),n(u,[2,252]),{19:208,28:D,29:L,52:209,53:G,56:85},{29:[1,210]},n(l,[2,256]),{31:[1,211]},{31:[2,384]},{13:h,16:f,44:215,45:Ve,55:220,82:k,87:d,89:$e,145:212,172:221,185:213,187:214,231:Lt,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},n(ky,[2,265],{56:85,35:227,52:228,19:229,28:D,29:L,53:G}),n(et,[2,260]),n($,q,{58:205,62:206,23:230,63:ge}),n(u,[2,268]),{6:[2,45]},n(e,t,{10:3,4:231}),{13:h,16:f,55:232,307:43,308:m},n(ue,[2,312]),{105:233,112:jy,122:234,132:[1,237],134:235,327:[1,238],334:[1,239]},n(Se,[2,318]),n(ue,My,{108:240,133:242,112:Vy,132:$y}),n(Ke,[2,323]),{112:[1,244]},{112:[2,325]},n(kt,[2,50]),n(W,Qc,{135:245,136:246,143:247,144:248,31:Uy,112:Uy}),n(kt,[2,51]),n(kt,[2,52]),n(Ci,[2,328],{119:249}),{29:Ge,114:250},n(Ci,[2,56]),{29:Ge,114:251},n(_,[2,59]),n(Re,[2,270]),{47:[1,252]},n(By,[2,150]),n(Kc,[2,428],{240:253}),n(Zs,[2,430],{244:254}),n(Zs,[2,155],{248:255,249:256,250:[2,438],290:[1,257],341:[1,258],342:[1,259],343:[1,260],344:[1,261],345:[1,262],346:[1,263]}),n(ea,[2,440],{252:264}),n(Ot,[2,448],{260:265}),{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,255:154,257:155,264:266,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,255:154,257:155,264:267,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,255:154,257:155,264:268,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(Ot,[2,167]),n(Ot,[2,168]),n(Ot,[2,169]),n(Ot,[2,170],{176:269,45:qy,89:Gy}),n(Ot,[2,171]),n(Ot,[2,172]),n(Ot,[2,173]),n(Ot,[2,174]),{13:h,16:f,44:136,45:H,46:272,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(vt,[2,176]),{89:[1,273]},{45:[1,274]},{45:[1,275]},{45:[1,276]},{45:[1,277]},{45:[1,278]},{45:Wy,89:zy,179:279},{45:[1,282]},{45:[1,284],89:[1,283]},{279:[1,285]},n(ar,[2,192],{292:[1,286],293:[1,287]}),n(ar,[2,195]),n(ar,[2,196]),n(ar,[2,197]),n(ar,[2,198]),n(ar,[2,199]),n(ar,[2,200]),{13:h,16:f,44:39,55:40,82:k,87:d,139:289,172:291,255:154,257:155,266:290,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,320:288},{45:[1,292]},{45:[1,293]},{45:[1,294]},n(bo,[2,452]),n(bo,[2,453]),n(bo,[2,454]),n(bo,[2,455]),n(bo,[2,456]),{279:[2,458]},n(Xc,[2,207]),n(Xc,[2,208]),n(Xc,[2,209]),n(Xc,[2,210]),n(ar,[2,201]),n(ar,[2,202]),n(ar,[2,203]),n(ar,[2,204]),n(ar,[2,205]),n(ar,[2,206]),n(e,[2,5]),n(Jc,[2,297],{88:295}),n(Zc,[2,299],{90:296}),{48:[1,297],87:[1,298]},n(eu,[2,301]),n(B,[2,43]),n(B,[2,82]),n(B,[2,83]),{29:[1,299]},{29:[1,300]},{87:[1,302],169:301},n(c,[2,412]),n(ss,[2,123]),n(ss,[2,416],{221:303,339:304,39:[1,306],263:[1,307],340:[1,305]}),n(Fn,[2,124]),{13:h,16:f,45:[1,311],55:194,89:[1,310],197:Xe,223:312,225:308,226:309,229:Hy,307:43,308:m},n(c,i,{215:10,214:314}),n(Fn,[2,236]),n(Fn,[2,237]),n(ta,[2,6]),n(Cf,[2,287],{60:315,72:316,73:[1,317]}),n(it,[2,286]),{13:h,16:f,45:H,55:323,67:321,68:322,71:318,77:320,79:319,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,307:43,308:m,346:Pe,347:we,348:b,349:E,350:w,351:x},n([6,31,63,70,73,81,83,85],[2,20]),n(W,Yy,{38:17,49:324,147:325,17:326,21:327,148:328,154:329,155:330,29:ei,31:ei,85:ei,112:ei,159:ei,160:ei,161:ei,163:ei,164:ei,41:s}),{13:h,16:f,55:331,307:43,308:m},n(ue,[2,280]),n(ta,[2,7]),n(it,_e,{59:197,69:198,20:332,70:j}),n($,[2,284]),{64:[1,333]},n($,q,{58:205,62:206,23:334,63:ge}),n(u,[2,254]),n(W,Qc,{144:248,30:335,143:336,31:[2,257]}),n(u,[2,100]),{31:[2,387],184:337,335:[1,338]},{13:h,16:f,44:39,55:40,87:d,139:342,186:339,190:340,195:341,197:as,307:43,308:m},n(Eo,[2,389],{44:39,55:40,307:43,190:340,195:341,139:342,188:344,189:345,186:346,13:h,16:f,87:d,197:as,308:m}),n(ti,[2,227]),n(ti,[2,228]),n(ti,[2,229]),{13:h,16:f,44:215,45:Ve,55:220,82:k,87:d,89:$e,172:221,185:351,187:350,200:348,230:347,231:Lt,234:349,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},{13:h,16:f,44:39,55:40,87:d,139:342,186:352,190:340,195:341,197:as,307:43,308:m},n(ti,[2,146]),n(ti,[2,147]),n(ti,[2,148]),n(ti,[2,149]),{13:h,16:f,44:354,55:355,82:k,87:d,172:357,237:356,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:358,312:sr,313:353},n(xf,[2,215]),n(xf,[2,216]),n($,q,{58:205,62:206,23:359,63:ge}),n(Fe,[2,264]),n(ky,[2,266]),n(ta,[2,11]),n(r,[2,308],{6:[2,310]}),n(kt,[2,313],{102:360,120:361,121:[1,362]}),n(kt,[2,47]),n(kt,[2,63]),n(kt,[2,64]),{13:h,16:f,55:363,307:43,308:m},n(kt,[2,336]),n(kt,[2,337]),n(kt,[2,338]),{109:[1,364]},n(Qy,[2,60]),{13:h,16:f,55:365,307:43,308:m},n(ue,[2,335]),{13:h,16:f,55:366,307:43,308:m},{31:[1,367]},n(os,[2,341],{137:368}),n(os,[2,340]),{13:h,16:f,44:215,45:Ve,55:220,82:k,87:d,89:$e,145:369,172:221,185:213,187:214,231:Lt,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},{28:[1,370],127:371,128:[1,372]},n(Ci,[2,330],{124:373,125:374,126:tt}),n(Ci,[2,57]),{44:375,87:d},n(By,[2,151],{241:376,242:[1,377]}),n(Kc,[2,153],{245:378,246:[1,379]}),{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,247:380,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{250:[1,381]},n(wt,[2,432]),n(wt,[2,433]),n(wt,[2,434]),n(wt,[2,435]),n(wt,[2,436]),n(wt,[2,437]),{250:[2,439]},n([47,48,193,242,246,250,272,290,341,342,343,344,345,346],[2,158],{253:382,254:383,255:384,257:385,263:[1,386],265:[1,387],297:J,298:Z,299:ee,300:te,301:ie,302:se}),n(ea,[2,162],{261:388,262:389,39:If,338:Of}),n(Ot,[2,164]),n(Ot,[2,165]),n(Ot,[2,166]),n(vt,[2,95]),n(vt,[2,96]),n(wt,[2,377],{177:392,325:[1,393]}),{48:[1,394]},n(vt,[2,177]),{13:h,16:f,44:136,45:H,46:395,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,46:396,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,46:397,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,46:398,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,46:399,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(vt,[2,183]),n(vt,[2,98]),n(wt,[2,381],{180:400}),{87:[1,401]},n(vt,[2,185]),{13:h,16:f,44:136,45:H,46:402,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{29:M,57:403},n(ar,[2,193]),{13:h,16:f,55:404,307:43,308:m},{13:h,16:f,44:39,55:40,87:d,139:342,195:405,197:as,307:43,308:m},n(xi,[2,233]),n(xi,[2,234]),n(xi,[2,235]),n(Ky,[2,459],{281:406,325:[1,407]}),n(wt,[2,463],{284:408,325:[1,409]}),n(wt,[2,465],{286:410,325:[1,411]}),{13:h,16:f,31:[1,412],55:414,82:k,171:413,172:415,173:416,174:tu,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:ru},{31:[1,419],89:[1,420]},{29:[1,421]},n(eu,[2,302]),n(Jc,[2,367],{167:422}),n(Zc,[2,369],{168:423}),{48:[1,424],87:[1,425]},n(eu,[2,371]),n(ss,[2,122]),n(ss,[2,417]),n(ss,[2,413]),n(ss,[2,414]),n(ss,[2,415]),n(Fn,[2,125]),n(Fn,[2,127]),n(Fn,[2,128]),n(Xy,[2,420],{227:426}),n(Fn,[2,130]),{13:h,16:f,55:194,197:Xe,223:427,307:43,308:m},{48:[1,428]},n(Ii,[2,289],{61:429,80:430,81:[1,431],83:[1,432]}),n(Cf,[2,288]),{64:[1,433]},n(it,[2,29],{307:43,267:139,275:146,278:149,77:320,67:321,68:322,55:323,79:434,13:h,16:f,45:H,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,276:Oe,277:le,279:Ee,280:pe,283:Te,285:De,308:m,346:Pe,347:we,348:b,349:E,350:w,351:x}),n(Jy,[2,293]),n(Df,[2,92]),n(Df,[2,93]),n(Df,[2,94]),{45:qy,89:Gy,176:269},{31:[1,435]},{31:[1,436]},{19:437,28:D,29:L,56:85},{19:438,28:D,29:L,56:85},n(cs,[2,355],{149:439}),n(cs,[2,354]),{13:h,16:f,44:215,45:nu,55:220,82:k,87:d,89:$e,156:440,172:221,185:441,203:442,231:iu,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},n(Fe,[2,19]),n(Ii,[2,21]),{13:h,16:f,44:450,45:Zy,55:323,65:445,66:446,67:447,68:448,87:d,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,307:43,308:m,346:Pe,347:we,348:b,349:E,350:w,351:x},n(ta,[2,8]),{31:[1,451]},{31:[2,258]},{31:[2,101]},n(W,[2,386],{31:[2,388]}),n(Eo,[2,102]),n(us,[2,391],{191:452}),n(W,[2,395],{196:453,198:454}),n(W,[2,108]),n(W,[2,109]),n(Eo,[2,103]),n(Eo,[2,104]),n(Eo,[2,390]),{13:h,16:f,44:215,45:Ve,48:[1,455],55:220,82:k,87:d,89:$e,172:221,185:351,187:350,200:456,231:Lt,234:349,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},n(su,[2,424]),n(e1,[2,136]),n(e1,[2,137]),n(Pf,[2,140]),{232:[1,457]},{13:h,16:f,44:39,55:40,87:d,139:342,195:458,197:as,307:43,308:m},n(xi,[2,219]),n(xi,[2,220]),n(xi,[2,221]),n(xi,[2,222]),n(xi,[2,223]),n(ta,[2,10]),n(kt,[2,46]),n(kt,[2,314]),{112:jy,122:459},n(kt,[2,62]),n(ue,My,{133:242,108:460,112:Vy,132:$y}),n(Qy,[2,61]),n(kt,[2,49]),n([6,28,126,128,193],[2,65]),{31:[2,66],112:[1,462],138:461},n(os,[2,351],{146:463,335:[1,464]}),{29:M,57:465},n(Ci,[2,329]),n(ue,[2,332],{129:466,327:[1,467]}),n(Ci,[2,55]),n(Ci,[2,331]),{48:[1,468]},n(Kc,[2,429]),{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,239:469,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(Zs,[2,431]),{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,243:470,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(Zs,[2,156]),{45:Wy,89:zy,179:471},n(ea,[2,441]),{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,251:472,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(Ot,[2,444],{256:473}),n(Ot,[2,446],{258:474}),n(wt,[2,442]),n(wt,[2,443]),n(Ot,[2,449]),{13:h,16:f,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,255:154,257:155,259:475,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(wt,[2,450]),n(wt,[2,451]),n(wt,[2,379],{178:476}),n(wt,[2,378]),n([6,13,16,29,31,39,45,47,48,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,231,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,338,341,342,343,344,345,346,347,348,349,350,351],[2,175]),{48:[1,477]},{48:[1,478]},{272:[1,479]},{272:[1,480]},{272:[1,481]},{13:h,16:f,44:136,45:H,46:482,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{48:[1,483]},{48:[1,484]},n(vt,[2,187]),n(ar,[2,194]),{13:h,16:f,44:39,55:40,82:k,87:d,139:289,172:291,255:154,257:155,266:290,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,320:485},{13:h,16:f,39:[1,487],44:136,45:H,46:488,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,282:486,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(Ky,[2,460]),{13:h,16:f,44:136,45:H,46:489,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(wt,[2,464]),{13:h,16:f,44:136,45:H,46:490,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(wt,[2,466]),n(B,[2,40]),n(Jc,[2,298]),n(To,[2,87]),n(To,[2,88]),n(To,[2,89]),n(To,[2,90]),{13:h,16:f,55:492,82:k,172:493,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,311:494,312:sr,315:491},n(B,[2,41]),n(Zc,[2,300]),n(Ao,[2,303],{92:495}),{13:h,16:f,31:[1,496],55:414,82:k,171:497,172:415,173:416,174:tu,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:ru},{31:[1,498],89:[1,499]},{29:[1,500]},n(eu,[2,372]),{13:h,16:f,48:[2,422],55:194,197:Xe,223:312,226:502,228:501,229:Hy,307:43,308:m},n(Fn,[2,131]),n(Fn,[2,126]),n(Ii,[2,22]),n(Ii,[2,290]),{82:[1,503]},{82:[1,504]},{13:h,16:f,44:510,45:H,55:323,67:321,68:322,74:505,75:506,76:t1,77:320,78:r1,79:509,87:d,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,307:43,308:m,346:Pe,347:we,348:b,349:E,350:w,351:x},n(Jy,[2,294]),n(n1,[2,69]),n(n1,[2,70]),n(it,_e,{59:197,69:198,20:511,70:j}),n($,q,{58:205,62:206,23:512,63:ge}),{29:[2,375],31:[2,71],84:522,85:a,112:[1,518],150:513,151:514,158:515,159:[1,516],160:[1,517],161:[1,519],163:[1,520],164:[1,521],175:523},n(cs,[2,363],{157:524,335:[1,525]}),n(c,i,{215:10,202:526,205:527,208:528,214:529,44:530,87:d}),n(au,[2,399],{215:10,205:527,208:528,214:529,44:530,204:531,202:532,13:i,16:i,45:i,197:i,224:i,229:i,308:i,87:d}),{13:h,16:f,44:215,45:nu,55:220,82:k,87:d,89:$e,172:221,185:351,203:536,212:534,231:iu,233:533,234:535,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},n(c,i,{215:10,205:527,208:528,214:529,44:530,202:537,87:d}),n($,[2,23],{307:43,267:139,275:146,278:149,55:323,67:447,68:448,44:450,66:538,13:h,16:f,45:Zy,87:d,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,276:Oe,277:le,279:Ee,280:pe,283:Te,285:De,308:m,346:Pe,347:we,348:b,349:E,350:w,351:x}),n(ls,[2,291]),n(ls,[2,24]),n(ls,[2,25]),{13:h,16:f,44:136,45:H,46:539,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(ls,[2,28]),n($,q,{58:205,62:206,23:540,63:ge}),n([31,112,232,318,335],[2,105],{192:541,193:[1,542]}),n(us,[2,107]),{13:h,16:f,44:215,45:Ve,55:220,82:k,87:d,89:$e,172:221,185:351,187:350,199:543,200:544,231:Lt,234:349,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},n(i1,[2,132]),n(su,[2,425]),n(i1,[2,133]),{13:h,16:f,44:354,55:355,82:k,87:d,172:357,237:356,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:358,312:sr,313:545},n(kt,[2,54]),n(kt,[2,48]),n(os,[2,342]),{13:h,16:f,44:39,55:40,87:d,139:546,307:43,308:m},n(os,[2,68]),n(W,[2,350],{31:s1,112:s1}),n(kt,[2,53]),{13:h,16:f,55:547,307:43,308:m},n(ue,[2,333]),n(Re,[2,16]),n(Kc,[2,152]),n(Zs,[2,154]),n(Zs,[2,157]),n(ea,[2,159]),n(ea,[2,160],{262:389,261:548,39:If,338:Of}),n(ea,[2,161],{262:389,261:549,39:If,338:Of}),n(Ot,[2,163]),{13:h,16:f,44:136,45:H,46:550,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(vt,[2,178]),n(vt,[2,179]),{13:h,16:f,44:136,45:H,46:551,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,46:552,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,46:553,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{48:[1,554],272:[1,555]},n(vt,[2,184]),n(vt,[2,186]),{314:[1,556]},{48:[1,557]},{48:[2,461]},{48:[2,462]},{48:[1,558]},{48:[2,467],193:[1,561],287:559,288:560},{13:h,16:f,55:194,197:Xe,223:562,307:43,308:m},n(Ff,[2,224]),n(Ff,[2,225]),n(Ff,[2,226]),{31:[1,563],45:a1,94:564},n(B,[2,84]),n(Jc,[2,368]),n(B,[2,85]),n(Zc,[2,370]),n(Ao,[2,373],{170:566}),{48:[1,567]},{48:[2,423],337:[1,568]},n(Ii,[2,35],{83:[1,569]}),n(Ii,[2,36],{81:[1,570]}),n(Cf,[2,30],{307:43,267:139,275:146,278:149,77:320,67:321,68:322,55:323,79:509,44:510,75:571,13:h,16:f,45:H,76:t1,78:r1,87:d,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,276:Oe,277:le,279:Ee,280:pe,283:Te,285:De,308:m,346:Pe,347:we,348:b,349:E,350:w,351:x}),n(ra,[2,295]),{45:H,77:572},{45:H,77:573},n(ra,[2,33]),n(ra,[2,34]),{31:[2,275],50:574,84:575,85:a},{31:[2,277],51:576,84:577,85:a},n(cs,[2,356]),n(o1,[2,357],{152:578,335:[1,579]}),n(ri,[2,74]),{29:M,57:580},{29:M,57:581},{13:h,16:f,44:39,55:40,87:d,139:582,307:43,308:m},n(c1,[2,365],{162:583,328:[1,584]}),{13:h,16:f,45:H,55:323,67:321,68:322,77:320,79:585,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,307:43,308:m,346:Pe,347:we,348:b,349:E,350:w,351:x},{45:[1,586]},n(ri,[2,81]),{29:M,57:587},n(cs,[2,73]),n(W,[2,362],{29:ni,31:ni,85:ni,112:ni,159:ni,160:ni,161:ni,163:ni,164:ni}),n(au,[2,112]),n(na,[2,401],{206:588}),n(W,[2,405],{209:589,210:590}),n(W,[2,403]),n(W,[2,404]),n(au,[2,113]),n(au,[2,400]),{13:h,16:f,44:215,45:nu,48:[1,591],55:220,82:k,87:d,89:$e,172:221,185:351,203:536,212:592,231:iu,234:535,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},n(su,[2,426]),n(Pf,[2,138]),n(Pf,[2,139]),{232:[1,593]},n(ls,[2,292]),{47:[1,595],48:[1,594]},n(ta,[2,9]),n(us,[2,392]),n(us,[2,393],{44:39,55:40,307:43,195:341,139:342,194:596,190:597,13:h,16:f,87:d,197:as,308:m}),n(us,[2,110],{272:[1,598]}),n(ou,[2,397],{201:599,316:600,317:[1,601]}),{314:[1,602]},{29:[1,603]},n(Ci,[2,58]),n(Ot,[2,445]),n(Ot,[2,447]),{48:[1,604],272:[1,605]},{48:[1,606]},{272:[1,607]},{272:[1,608]},n(vt,[2,99]),n(wt,[2,382]),n([13,16,39,47,48,87,193,197,242,246,250,263,265,272,290,297,298,299,300,301,302,308,314,338,341,342,343,344,345,346],[2,232]),n(vt,[2,188]),n(vt,[2,189]),{48:[1,609]},{48:[2,468]},{289:[1,610]},{13:h,16:f,55:492,82:k,172:493,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,311:494,312:sr,315:611},n(B,[2,42]),n(Ao,[2,304]),{13:h,16:f,55:414,82:k,95:612,171:613,172:415,173:416,174:tu,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:ru},{31:[1,614],45:a1,94:615},n(Fn,[2,129]),n(Xy,[2,421]),{82:[1,616]},{82:[1,617]},n(ra,[2,296]),n(ra,[2,31]),n(ra,[2,32]),{31:[2,17]},{31:[2,276]},{31:[2,18]},{31:[2,278]},n(W,Yy,{155:330,153:618,154:619,29:ii,31:ii,85:ii,112:ii,159:ii,160:ii,161:ii,163:ii,164:ii}),n(o1,[2,358]),n(ri,[2,75]),n(ri,[2,76]),{29:M,57:620},{13:h,16:f,44:39,55:40,87:d,139:621,307:43,308:m},n(c1,[2,366]),n(ri,[2,79]),{13:h,16:f,44:136,45:H,46:622,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(ri,[2,91],{336:[1,623]}),n([29,31,85,112,159,160,161,163,164,232,318,335],[2,114],{207:624,193:[1,625]}),n(na,[2,117]),{13:h,16:f,44:215,45:nu,55:220,82:k,87:d,89:$e,172:221,185:351,203:536,211:626,212:627,231:iu,234:535,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:Sr,310:Dr,311:217,312:sr},n(ti,[2,134]),n(su,[2,427]),n(ti,[2,135]),n(ls,[2,26]),{44:628,87:d},n(us,[2,106]),n(us,[2,394]),n(W,[2,396]),n(ou,[2,111]),n(ou,[2,398]),{13:h,16:f,44:39,55:40,87:d,139:342,186:629,190:340,195:341,197:as,307:43,308:m},n(xf,[2,217]),n(W,Qc,{144:248,140:630,143:631,31:[2,343]}),n(vt,[2,97]),n(wt,[2,380]),n(vt,[2,180]),{13:h,16:f,44:136,45:H,46:632,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},{13:h,16:f,44:136,45:H,46:633,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:We,264:130,265:V,266:137,267:139,268:de,269:Ce,270:z,271:xe,273:Ie,274:be,275:146,276:Oe,277:le,278:149,279:Ee,280:pe,283:Te,285:De,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:b,349:E,350:w,351:x},n(vt,[2,190]),{290:[1,634]},{314:[1,635]},{13:h,16:f,48:[1,636],55:414,82:k,171:637,172:415,173:416,174:tu,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:ru},n(u1,[2,305]),n(B,[2,86]),n(Ao,[2,374]),n(Ii,[2,37]),n(Ii,[2,38]),n(cs,[2,72]),n(cs,[2,360]),n(ri,[2,77]),{29:M,57:638},{47:[1,639]},{29:[2,376]},n(na,[2,402]),n(na,[2,115],{215:10,208:528,214:529,44:530,205:640,13:i,16:i,45:i,197:i,224:i,229:i,308:i,87:d}),n(na,[2,118],{272:[1,641]}),n(cu,[2,407],{213:642,319:643,317:[1,644]}),{48:[1,645]},{318:[1,646]},{31:[1,647]},{31:[2,344]},{48:[1,648]},{48:[1,649]},{291:650,303:ae,304:oe,305:Q,306:ce},n(To,[2,218]),n(Ao,[2,44]),n(u1,[2,306]),n(ri,[2,78]),{44:651,87:d},n(na,[2,116]),n(W,[2,406]),n(cu,[2,119]),n(cu,[2,408]),n(c,i,{215:10,205:527,208:528,214:529,44:530,202:652,87:d}),n(ls,[2,27]),n(ou,[2,230]),n(l1,[2,345],{141:653,335:[1,654]}),n(vt,[2,181]),n(vt,[2,182]),{48:[2,191]},{48:[1,655]},{318:[1,656]},n(W,Qc,{144:248,142:657,143:658,31:h1,112:h1}),n(l1,[2,346]),n(ri,[2,80]),n(cu,[2,231]),n(os,[2,67]),n(os,[2,348])],defaultActions:{5:[2,240],6:[2,241],7:[2,242],9:[2,239],24:[2,1],25:[2,2],26:[2,244],87:[2,282],94:[2,384],100:[2,45],109:[2,325],166:[2,458],263:[2,439],336:[2,258],337:[2,101],487:[2,461],488:[2,462],560:[2,468],574:[2,17],575:[2,276],576:[2,18],577:[2,278],623:[2,376],631:[2,344],650:[2,191]},parseError:o(function(T,O){if(O.recoverable)this.trace(T);else{var R=new Error(T);throw R.hash=O,R}},"parseError"),parse:o(function(T){var O=this,R=[0],Y=[],ve=[null],p=[],cr=this.table,g="",Ln=0,Oo=0,fu=0,du=2,Do=1,pu=p.slice.call(arguments,1),dt=Object.create(this.lexer),kn={yy:{}};for(var Po in this.yy)Object.prototype.hasOwnProperty.call(this.yy,Po)&&(kn.yy[Po]=this.yy[Po]);dt.setInput(T,kn.yy),kn.yy.lexer=dt,kn.yy.parser=this,typeof dt.yylloc>"u"&&(dt.yylloc={});var ca=dt.yylloc;p.push(ca);var Je=dt.options&&dt.options.ranges;typeof kn.yy.parseError=="function"?this.parseError=kn.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function ut(jn){R.length=R.length-2*jn,ve.length=ve.length-jn,p.length=p.length-jn}o(ut,"popStack");for(var Ue=o(function(){var jn;return jn=dt.lex()||Do,typeof jn!="number"&&(jn=O.symbols_[jn]||jn),jn},"lex"),He,br,ps,Vr,a8,Wf,ua={},mu,oi,E1,gu;;){if(ps=R[R.length-1],this.defaultActions[ps]?Vr=this.defaultActions[ps]:((He===null||typeof He>"u")&&(He=Ue()),Vr=cr[ps]&&cr[ps][He]),typeof Vr>"u"||!Vr.length||!Vr[0]){var zf="";gu=[];for(mu in cr[ps])this.terminals_[mu]&&mu>du&&gu.push("'"+this.terminals_[mu]+"'");dt.showPosition?zf="Parse error on line "+(Ln+1)+`:
`+dt.showPosition()+`
Expecting `+gu.join(", ")+", got '"+(this.terminals_[He]||He)+"'":zf="Parse error on line "+(Ln+1)+": Unexpected "+(He==Do?"end of input":"'"+(this.terminals_[He]||He)+"'"),this.parseError(zf,{text:dt.match,token:this.terminals_[He]||He,line:dt.yylineno,loc:ca,expected:gu})}if(Vr[0]instanceof Array&&Vr.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ps+", token: "+He);switch(Vr[0]){case 1:R.push(He),ve.push(dt.yytext),p.push(dt.yylloc),R.push(Vr[1]),He=null,br?(He=br,br=null):(Oo=dt.yyleng,g=dt.yytext,Ln=dt.yylineno,ca=dt.yylloc,fu>0&&fu--);break;case 2:if(oi=this.productions_[Vr[1]][1],ua.$=ve[ve.length-oi],ua._$={first_line:p[p.length-(oi||1)].first_line,last_line:p[p.length-1].last_line,first_column:p[p.length-(oi||1)].first_column,last_column:p[p.length-1].last_column},Je&&(ua._$.range=[p[p.length-(oi||1)].range[0],p[p.length-1].range[1]]),Wf=this.performAction.apply(ua,[g,Oo,Ln,kn.yy,Vr[1],ve,p].concat(pu)),typeof Wf<"u")return Wf;oi&&(R=R.slice(0,-1*oi*2),ve=ve.slice(0,-1*oi),p=p.slice(0,-1*oi)),R.push(this.productions_[Vr[1]][0]),ve.push(ua.$),p.push(ua._$),E1=cr[R[R.length-2]][R[R.length-1]],R.push(E1);break;case 3:return!0}}return!0},"parse")},uu=ig().Wildcard,lu="http://www.w3.org/1999/02/22-rdf-syntax-ns#",QE=lu+"type",KE=lu+"first",XE=lu+"rest",f1=lu+"nil",hu="http://www.w3.org/2001/XMLSchema#",d1=hu+"integer",p1=hu+"decimal",m1=hu+"double",JE=hu+"boolean",hs="",g1="",y1="";function or(C){return C.toLowerCase()}o(or,"lowercase");function si(C,T){return C.push(T),C}o(si,"appendTo");function fs(C,T){return C.push.apply(C,T),C}o(fs,"appendAllTo");function mt(C){C||(C={});for(var T=1,O=arguments.length,R;T<O&&(R=arguments[T]||{});T++)for(var Y in R)C[Y]=R[Y];return C}o(mt,"extend");function Rn(){for(var C=[],T=0,O=arguments.length;T<O;T++)C=C.concat.apply(C,arguments[T]);return C}o(Rn,"unionAll");function Co(C){if(C[0]==="<"&&(C=C.substring(1,C.length-1)),/^[a-z][a-z0-9.+-]*:/i.test(C))return C;if(!Ae.base)throw new Error("Cannot resolve relative IRI "+C+" because no base IRI was set.");switch(hs!==Ae.base&&(hs=Ae.base,g1=hs.replace(/[^\/:]*$/,""),y1=hs.match(/^(?:[a-z]+:\/*)?[^\/]*/)[0]),C[0]){case void 0:return hs;case"#":return hs+C;case"?":return hs.replace(/(?:\?.*)?$/,C);case"/":return y1+C;default:return g1+C}}o(Co,"resolveIRI");function Nf(C){if(C){var T=C[0];if(T==="?"||T==="$")return Ae.factory.variable(C.substr(1))}return C}o(Nf,"toVar");function jt(C,T){return{type:"operation",operator:C,args:T||[]}}o(jt,"operation");function ia(C,T){var O={expression:C==="*"?new uu:C};if(T)for(var R in T)O[R]=T[R];return O}o(ia,"expression");function sa(C,T){return{type:"path",pathType:C,items:T}}o(sa,"path");function Lf(C,T){for(var O=0,R=T.length,Y;O<R&&(Y=T[O]);O++)C=jt(Y[0],[C,Y[1]]);return C}o(Lf,"createOperationTree");function ds(C,T){var O=[],R=[],Y=C.length,ve,p={};if(!Y)return null;for(var cr=0;cr<Y&&(ve=C[cr]);cr++)(ve.named?R:O).push(ve.iri);return p[T||"from"]={default:O,named:R},p}o(ds,"groupDatasets");function aa(C){return parseInt(C,10)}o(aa,"toInt");function kf(C){return C.type==="group"&&C.patterns.length===1?C.patterns[0]:C}o(kf,"degroupSingle");function Nn(C,T){return T&&T.termType!=="NamedNode"&&(T=Ae.factory.namedNode(T)),Ae.factory.literal(C,T)}o(Nn,"createTypedLiteral");function ZE(C,T){return Ae.factory.literal(C,T)}o(ZE,"createLangLiteral");function jf(C,T,O){if(!("termType"in T))throw new Error("Nested triples cannot contain paths");return Ae.factory.quad(C,T,O)}o(jf,"nestedTriple");function ai(C,T,O,R){var Y={};return C!=null&&(Y.subject=C),T!=null&&(Y.predicate=T),O!=null&&(Y.object=O),R!=null&&(Y.annotations=R),Y}o(ai,"triple");function xo(C){return typeof C=="string"?C.startsWith("e_")?Ae.factory.blankNode(C):Ae.factory.blankNode("e_"+C):Ae.factory.blankNode("g_"+v1++)}o(xo,"blank");var v1=0;Ae._resetBlanks=function(){v1=0};var eT=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\(.)/g,tT={"\\":"\\","'":"'",'"':'"',t:"	",b:"\b",n:`
`,r:"\r",f:"\f"},rT=/[\uD800-\uDBFF]([^\uDC00-\uDFFF]|$)/,Mf=String.fromCharCode;function w1(C,T){C=C.substring(T,C.length-T);try{C=C.replace(eT,function(O,R,Y,ve){var p;if(R){if(p=parseInt(R,16),isNaN(p))throw new Error;return Mf(p)}else if(Y){if(p=parseInt(Y,16),isNaN(p))throw new Error;return p<65535?Mf(p):Mf(55296+((p-=65536)>>10),56320+(p&1023))}else{var cr=tT[ve];if(!cr)throw new Error;return cr}})}catch{return""}if(rT.exec(C))throw new Error("Invalid unicode codepoint of surrogate pair without corresponding codepoint in "+C);return C}o(w1,"unescapeString");function nT(C){var T=xo(),O=T,R=[],Y,ve=[];C.forEach(function(Ln){R.push(Ln.entity),fs(ve,Ln.triples)});for(var p=0,cr=0,g=R.length,Y=Array(g*2);p<g;)Y[cr++]=ai(O,Ae.factory.namedNode(KE),R[p]),Y[cr++]=ai(O,Ae.factory.namedNode(XE),O=++p<g?xo():Ae.factory.namedNode(f1));return{entity:T,triples:fs(Y,ve)}}o(nT,"createList");function iT(C){var T=xo();return{entity:T,triples:C.map(function(O){return mt(ai(T),O)})}}o(iT,"createAnonymousObject");function Vf(C,T,O){var R=[],Y=[];return T.forEach(function(ve){let p=null;ve.annotation&&(p=ve.annotation,ve=ve.object),R.push(ai(null,C,ve.entity,p)),fs(Y,ve.triples)}),Rn(R,O||[],Y)}o(Vf,"objectListToTriples");function i8(C){for(var T=[],O,R=0,Y;Y=C[R];R++)switch(Y.type){case"bgp":Y.triples.length&&(O?fs(O.triples,Y.triples):si(T,O=Y));break;default:(!Y.patterns||Y.patterns.length>0)&&(si(T,Y),O=null)}return T}o(i8,"mergeAdjacentBGPs");function oa(C){return C.variable?C.variable.value:C.value||C.expression.value}o(oa,"getExpressionId");function $f(C){if(!C)return[];if(C.type==="aggregate")return[C];if(C.type==="operation"){let T=[];for(let O of C.args)T.push(...$f(O));return T}return[]}o($f,"getAggregatesOfExpression");function sT(C){let T=new Set,O=o(function(R){R&&(R.termType==="Variable"?T.add(R):R.type==="operation"&&R.args.forEach(O))},"visitExpression");return O(C),T}o(sT,"getVariablesFromExpression");function Uf(C,T=1,O=[]){for(let R of C)T>0&&R instanceof Array?Uf(R,T-1,O):O.push(R);return O}o(Uf,"flatten");function Bf(C){return C.termType==="Variable"}o(Bf,"isVariable");function _1(C){if(C.triples){let T=[];for(let O of C.triples)Bf(O.subject)&&T.push(O.subject.value),Bf(O.predicate)&&T.push(O.predicate.value),Bf(O.object)&&T.push(O.object.value);return T}else if(C.patterns){let T=[];for(let O of C.patterns)T.push(..._1(O));return T}return[]}o(_1,"getBoundVarsFromGroupGraphPattern");function aT(C){let T=C.slice().sort(),O=[];for(let R=0;R<T.length-1;R++)T[R+1]==T[R]&&O.push(T[R]);return O}o(aT,"getDuplicatesInArray");function Io(C){if(!Ae.sparqlStar)throw new Error("SPARQL-star support is not enabled");return C}o(Io,"ensureSparqlStar");function S1(C,T,O){for(let R of T){let Y=ai("subject"in R?R.subject:C,R.predicate,R.object);O.push(Y),R.annotations&&S1(jf(C,R.predicate,R.object),R.annotations,O)}}o(S1,"_applyAnnotations");function qf(C){if(Ae.sparqlStar){let T=[];return C.forEach(O=>{let R=ai(O.subject,O.predicate,O.object);T.push(R),O.annotations&&S1(jf(O.subject,O.predicate,O.object),O.annotations,T)}),T}return C}o(qf,"applyAnnotations");function s8(C){if(!Ae.sparqlStarNestedQuads)throw new Error("Lenient SPARQL-star support with nested quads is not enabled");return C}o(s8,"ensureSparqlStarNestedQuads");function b1(C){for(let T of C){if(T.type==="graph"&&T.name.termType==="Variable")throw new Error("Detected illegal variable in GRAPH");if(T.type==="bgp"||T.type==="graph"){for(let O of T.triples)if(O.subject.termType==="Variable"||O.predicate.termType==="Variable"||O.object.termType==="Variable")throw new Error("Detected illegal variable in BGP")}}return C}o(b1,"ensureNoVariables");function Gf(C){for(let T of C)if(T.type==="bgp"){for(let O of T.triples)if(O.subject.termType==="BlankNode"||O.predicate.termType==="BlankNode"||O.object.termType==="BlankNode")throw new Error("Detected illegal blank node in BGP")}return C}o(Gf,"ensureNoBnodes");var oT=(function(){var C={EOF:1,parseError:o(function(O,R){if(this.yy.parser)this.yy.parser.parseError(O,R);else throw new Error(O)},"parseError"),setInput:o(function(T,O){return this.yy=O||this.yy||{},this._input=T,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},"setInput"),input:o(function(){var T=this._input[0];this.yytext+=T,this.yyleng++,this.offset++,this.match+=T,this.matched+=T;var O=T.match(/(?:\r\n?|\n).*/g);return O?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),T},"input"),unput:o(function(T){var O=T.length,R=T.split(/(?:\r\n?|\n)/g);this._input=T+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-O),this.offset-=O;var Y=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),R.length-1&&(this.yylineno-=R.length-1);var ve=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:R?(R.length===Y.length?this.yylloc.first_column:0)+Y[Y.length-R.length].length-R[0].length:this.yylloc.first_column-O},this.options.ranges&&(this.yylloc.range=[ve[0],ve[0]+this.yyleng-O]),this.yyleng=this.yytext.length,this},"unput"),more:o(function(){return this._more=!0,this},"more"),reject:o(function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},"reject"),less:o(function(T){this.unput(this.match.slice(T))},"less"),pastInput:o(function(){var T=this.matched.substr(0,this.matched.length-this.match.length);return(T.length>20?"...":"")+T.substr(-20).replace(/\n/g,"")},"pastInput"),upcomingInput:o(function(){var T=this.match;return T.length<20&&(T+=this._input.substr(0,20-T.length)),(T.substr(0,20)+(T.length>20?"...":"")).replace(/\n/g,"")},"upcomingInput"),showPosition:o(function(){var T=this.pastInput(),O=new Array(T.length+1).join("-");return T+this.upcomingInput()+`
`+O+"^"},"showPosition"),test_match:o(function(T,O){var R,Y,ve;if(this.options.backtrack_lexer&&(ve={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(ve.yylloc.range=this.yylloc.range.slice(0))),Y=T[0].match(/(?:\r\n?|\n).*/g),Y&&(this.yylineno+=Y.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:Y?Y[Y.length-1].length-Y[Y.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+T[0].length},this.yytext+=T[0],this.match+=T[0],this.matches=T,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(T[0].length),this.matched+=T[0],R=this.performAction.call(this,this.yy,this,O,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),R)return R;if(this._backtrack){for(var p in ve)this[p]=ve[p];return!1}return!1},"test_match"),next:o(function(){if(this.done)return this.EOF;this._input||(this.done=!0);var T,O,R,Y;this._more||(this.yytext="",this.match="");for(var ve=this._currentRules(),p=0;p<ve.length;p++)if(R=this._input.match(this.rules[ve[p]]),R&&(!O||R[0].length>O[0].length)){if(O=R,Y=p,this.options.backtrack_lexer){if(T=this.test_match(R,ve[p]),T!==!1)return T;if(this._backtrack){O=!1;continue}else return!1}else if(!this.options.flex)break}return O?(T=this.test_match(O,ve[Y]),T!==!1?T:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},"next"),lex:o(function(){var O=this.next();return O||this.lex()},"lex"),begin:o(function(O){this.conditionStack.push(O)},"begin"),popState:o(function(){var O=this.conditionStack.length-1;return O>0?this.conditionStack.pop():this.conditionStack[0]},"popState"),_currentRules:o(function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},"_currentRules"),topState:o(function(O){return O=this.conditionStack.length-1-Math.abs(O||0),O>=0?this.conditionStack[O]:"INITIAL"},"topState"),pushState:o(function(O){this.begin(O)},"pushState"),stateStackSize:o(function(){return this.conditionStack.length},"stateStackSize"),options:{flex:!0,"case-insensitive":!0},performAction:o(function(O,R,Y,ve){var p=ve;switch(Y){case 0:break;case 1:return 12;case 2:return 15;case 3:return 41;case 4:return 325;case 5:return 326;case 6:return 45;case 7:return 47;case 8:return 48;case 9:return 39;case 10:return 24;case 11:return 28;case 12:return 29;case 13:return 31;case 14:return 32;case 15:return 36;case 16:return 53;case 17:return 327;case 18:return 63;case 19:return 64;case 20:return 70;case 21:return 73;case 22:return 76;case 23:return 78;case 24:return 81;case 25:return 83;case 26:return 85;case 27:return 193;case 28:return 100;case 29:return 328;case 30:return 121;case 31:return 329;case 32:return 330;case 33:return 110;case 34:return 331;case 35:return 109;case 36:return 332;case 37:return 333;case 38:return 113;case 39:return 115;case 40:return 116;case 41:return 131;case 42:return 123;case 43:return 126;case 44:return 128;case 45:return 132;case 46:return 112;case 47:return 334;case 48:return 335;case 49:return 159;case 50:return 161;case 51:return 164;case 52:return 174;case 53:return 160;case 54:return 336;case 55:return 163;case 56:return 312;case 57:return 314;case 58:return 317;case 59:return 318;case 60:return 272;case 61:return 197;case 62:return 337;case 63:return 338;case 64:return 229;case 65:return 340;case 66:return 263;case 67:return 224;case 68:return 231;case 69:return 232;case 70:return 242;case 71:return 246;case 72:return 290;case 73:return 341;case 74:return 342;case 75:return 343;case 76:return 344;case 77:return 345;case 78:return 250;case 79:return 346;case 80:return 265;case 81:return 276;case 82:return 277;case 83:return 268;case 84:return 269;case 85:return 270;case 86:return 271;case 87:return 347;case 88:return 348;case 89:return 273;case 90:return 274;case 91:return 350;case 92:return 349;case 93:return 351;case 94:return 279;case 95:return 280;case 96:return 283;case 97:return 285;case 98:return 289;case 99:return 293;case 100:return 296;case 101:return 13;case 102:return 16;case 103:return 308;case 104:return 309;case 105:return 87;case 106:return 292;case 107:return 82;case 108:return 294;case 109:return 295;case 110:return 297;case 111:return 298;case 112:return 299;case 113:return 300;case 114:return 301;case 115:return 302;case 116:return"EXPONENT";case 117:return 303;case 118:return 304;case 119:return 305;case 120:return 306;case 121:return 89;case 122:return 310;case 123:return 6;case 124:return"INVALID";case 125:console.log(R.yytext);break}},"anonymous"),rules:[/^(?:\s+|(#[^\n\r]*))/i,/^(?:BASE)/i,/^(?:PREFIX)/i,/^(?:SELECT)/i,/^(?:DISTINCT)/i,/^(?:REDUCED)/i,/^(?:\()/i,/^(?:AS)/i,/^(?:\))/i,/^(?:\*)/i,/^(?:CONSTRUCT)/i,/^(?:WHERE)/i,/^(?:\{)/i,/^(?:\})/i,/^(?:DESCRIBE)/i,/^(?:ASK)/i,/^(?:FROM)/i,/^(?:NAMED)/i,/^(?:GROUP)/i,/^(?:BY)/i,/^(?:HAVING)/i,/^(?:ORDER)/i,/^(?:ASC)/i,/^(?:DESC)/i,/^(?:LIMIT)/i,/^(?:OFFSET)/i,/^(?:VALUES)/i,/^(?:;)/i,/^(?:LOAD)/i,/^(?:SILENT)/i,/^(?:INTO)/i,/^(?:CLEAR)/i,/^(?:DROP)/i,/^(?:CREATE)/i,/^(?:ADD)/i,/^(?:TO)/i,/^(?:MOVE)/i,/^(?:COPY)/i,/^(?:INSERT((\s+|(#[^\n\r]*)\n\r?)+)DATA)/i,/^(?:DELETE((\s+|(#[^\n\r]*)\n\r?)+)DATA)/i,/^(?:DELETE((\s+|(#[^\n\r]*)\n\r?)+)WHERE)/i,/^(?:WITH)/i,/^(?:DELETE)/i,/^(?:INSERT)/i,/^(?:USING)/i,/^(?:DEFAULT)/i,/^(?:GRAPH)/i,/^(?:ALL)/i,/^(?:\.)/i,/^(?:OPTIONAL)/i,/^(?:SERVICE)/i,/^(?:BIND)/i,/^(?:UNDEF)/i,/^(?:MINUS)/i,/^(?:UNION)/i,/^(?:FILTER)/i,/^(?:<<)/i,/^(?:>>)/i,/^(?:\{\|)/i,/^(?:\|\})/i,/^(?:,)/i,/^(?:a)/i,/^(?:\|)/i,/^(?:\/)/i,/^(?:\^)/i,/^(?:\?)/i,/^(?:\+)/i,/^(?:!)/i,/^(?:\[)/i,/^(?:\])/i,/^(?:\|\|)/i,/^(?:&&)/i,/^(?:=)/i,/^(?:!=)/i,/^(?:<)/i,/^(?:>)/i,/^(?:<=)/i,/^(?:>=)/i,/^(?:IN)/i,/^(?:NOT)/i,/^(?:-)/i,/^(?:BOUND)/i,/^(?:BNODE)/i,/^(?:(RAND|NOW|UUID|STRUUID))/i,/^(?:(LANG|DATATYPE|IRI|URI|ABS|CEIL|FLOOR|ROUND|STRLEN|STR|UCASE|LCASE|ENCODE_FOR_URI|YEAR|MONTH|DAY|HOURS|MINUTES|SECONDS|TIMEZONE|TZ|MD5|SHA1|SHA256|SHA384|SHA512|isIRI|isURI|isBLANK|isLITERAL|isNUMERIC))/i,/^(?:(SUBJECT|PREDICATE|OBJECT|isTRIPLE))/i,/^(?:(LANGMATCHES|CONTAINS|STRSTARTS|STRENDS|STRBEFORE|STRAFTER|STRLANG|STRDT|sameTerm))/i,/^(?:CONCAT)/i,/^(?:COALESCE)/i,/^(?:IF)/i,/^(?:TRIPLE)/i,/^(?:REGEX)/i,/^(?:SUBSTR)/i,/^(?:REPLACE)/i,/^(?:EXISTS)/i,/^(?:COUNT)/i,/^(?:SUM|MIN|MAX|AVG|SAMPLE)/i,/^(?:GROUP_CONCAT)/i,/^(?:SEPARATOR)/i,/^(?:\^\^)/i,/^(?:true|false)/i,/^(?:(<(?:[^<>\"\{\}\|\^`\\\u0000-\u0020])*>))/i,/^(?:((([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.)*(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040]))?)?:))/i,/^(?:(((([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.)*(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040]))?)?:)((?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|:|[0-9]|((%([0-9A-Fa-f])([0-9A-Fa-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.|:|((%([0-9A-Fa-f])([0-9A-Fa-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))*(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|:|((%([0-9A-Fa-f])([0-9A-Fa-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%)))))?)))/i,/^(?:(_:(?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|[0-9])(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.)*(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040]))?))/i,/^(?:([\?\$]((?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|[0-9])(?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])*)))/i,/^(?:(@[a-zA-Z]+(?:-[a-zA-Z0-9]+)*))/i,/^(?:([0-9]+))/i,/^(?:([0-9]*\.[0-9]+))/i,/^(?:([0-9]+\.[0-9]*([eE][+-]?[0-9]+)|\.([0-9])+([eE][+-]?[0-9]+)|([0-9])+([eE][+-]?[0-9]+)))/i,/^(?:(\+([0-9]+)))/i,/^(?:(\+([0-9]*\.[0-9]+)))/i,/^(?:(\+([0-9]+\.[0-9]*([eE][+-]?[0-9]+)|\.([0-9])+([eE][+-]?[0-9]+)|([0-9])+([eE][+-]?[0-9]+))))/i,/^(?:(-([0-9]+)))/i,/^(?:(-([0-9]*\.[0-9]+)))/i,/^(?:(-([0-9]+\.[0-9]*([eE][+-]?[0-9]+)|\.([0-9])+([eE][+-]?[0-9]+)|([0-9])+([eE][+-]?[0-9]+))))/i,/^(?:([eE][+-]?[0-9]+))/i,/^(?:('(?:(?:[^\u0027\u005C\u000A\u000D])|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])))*'))/i,/^(?:("(?:(?:[^\u0022\u005C\u000A\u000D])|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])))*"))/i,/^(?:('''(?:(?:'|'')?(?:[^'\\]|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f]))))*'''))/i,/^(?:("""(?:(?:"|"")?(?:[^\"\\]|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f]))))*"""))/i,/^(?:(\((\u0020|\u0009|\u000D|\u000A)*\)))/i,/^(?:(\[(\u0020|\u0009|\u000D|\u000A)*\]))/i,/^(?:$)/i,/^(?:.)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125],inclusive:!0}}};return C})();Rf.lexer=oT;function Ae(){this.yy={}}return o(Ae,"Parser"),Ae.prototype=Rf,Rf.Parser=Ae,new Ae})();ow.exports=HP});var fw=y((X$,hw)=>{var YP="http://www.w3.org/2001/XMLSchema#integer",QP="http://www.w3.org/2001/XMLSchema#string";function st(n){this._options=n=n||{};var e=n.prefixes||{};this._prefixByIri={};var t=[];for(var r in e){var i=e[r];tc(i)&&(this._prefixByIri[i]=r,t.push(i))}var s=t.join("|").replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&");this._prefixRegex=new RegExp("^("+s+")([a-zA-Z][\\-_a-zA-Z0-9]*)$"),this._usedPrefixes={},this._sparqlStar=n.sparqlStar,this._indent=tc(n.indent)?n.indent:"  ",this._newline=tc(n.newline)?n.newline:`
`,this._explicitDatatype=!!n.explicitDatatype}o(st,"Generator");st.prototype.toQuery=function(n){var e="";return n.queryType&&(e+=n.queryType.toUpperCase()+" "),n.reduced&&(e+="REDUCED "),n.distinct&&(e+="DISTINCT "),n.variables?e+=Lr(n.variables,void 0,function(t){return/^[?$]/.test(t)?t:Vi(t)?this.toEntity(t):"("+this.toExpression(t.expression)+" AS "+Rl(t.variable)+")"},this)+" ":n.template&&(e+=this.group(n.template,!0)+this._newline),n.from&&(e+=this.graphs("FROM ",n.from.default)+this.graphs("FROM NAMED ",n.from.named)),n.where&&(e+="WHERE "+this.group(n.where,!0)+this._newline),n.updates&&(e+=Lr(n.updates,";"+this._newline,this.toUpdate,this)),n.group&&(e+="GROUP BY "+Lr(n.group,void 0,function(t){var r=Vi(t.expression)?this.toEntity(t.expression):"("+this.toExpression(t.expression)+")";return t.variable?"("+r+" AS "+Rl(t.variable)+")":r},this)+this._newline),n.having&&(e+="HAVING ("+Lr(n.having,void 0,this.toExpression,this)+")"+this._newline),n.order&&(e+="ORDER BY "+Lr(n.order,void 0,function(t){var r="("+this.toExpression(t.expression)+")";return t.descending?"DESC "+r:r},this)+this._newline),n.offset&&(e+="OFFSET "+n.offset+this._newline),n.limit&&(e+="LIMIT "+n.limit+this._newline),n.values&&(e+=this.values(n)),e=this.baseAndPrefixes(n)+e,e.trim()};st.prototype.baseAndPrefixes=function(n){var e=n.base?"BASE <"+n.base+">"+this._newline:"",t="";for(var r in n.prefixes)(this._options.allPrefixes||this._usedPrefixes[r])&&(t+="PREFIX "+r+": <"+n.prefixes[r]+">"+this._newline);return e+t};st.prototype.toPattern=function(n){var e=n.type||n instanceof Array&&"array"||(n.subject&&n.predicate&&n.object?"triple":"");if(!(e in this))throw new Error("Unknown entry type: "+e);return this[e](n)};st.prototype.triple=function(n){return this.toEntity(n.subject)+" "+this.toEntity(n.predicate)+" "+this.toEntity(n.object)+"."};st.prototype.array=function(n){return Lr(n,this._newline,this.toPattern,this)};st.prototype.bgp=function(n){return this.encodeTriples(n.triples)};st.prototype.encodeTriples=function(n){if(!n.length)return"";for(var e=[],t=void 0,r=void 0,i=0;i<n.length;i++){var s=n[i];Ls(s.subject,t)?Ls(s.predicate,r)?e.push(","):(r=s.predicate,e.push(";"+this._newline,this._indent,this.toEntity(r))):(t&&e.push("."+this._newline),t=s.subject,r=s.predicate,e.push(this.toEntity(t)," ",this.toEntity(r))),e.push(" ",this.toEntity(s.object))}return e.push("."),e.join("")};st.prototype.graph=function(n){return"GRAPH "+this.toEntity(n.name)+" "+this.group(n)};st.prototype.graphs=function(n,e){return!e||e.length===0?"":Lr(e,"",function(t){return n+this.toEntity(t)+this._newline},this)};st.prototype.group=function(n,e){return n=e!==!0?this.array(n.patterns||n.triples):this.toPattern(n.type!=="group"?n:n.patterns),n.indexOf(this._newline)===-1?"{ "+n+" }":"{"+this._newline+this.indent(n)+this._newline+"}"};st.prototype.query=function(n){return this.toQuery(n)};st.prototype.filter=function(n){return"FILTER("+this.toExpression(n.expression)+")"};st.prototype.bind=function(n){return"BIND("+this.toExpression(n.expression)+" AS "+Rl(n.variable)+")"};st.prototype.optional=function(n){return"OPTIONAL "+this.group(n)};st.prototype.union=function(n){return Lr(n.patterns,this._newline+"UNION"+this._newline,function(e){return this.group(e,!0)},this)};st.prototype.minus=function(n){return"MINUS "+this.group(n)};st.prototype.values=function(n){var e=Object.keys(n.values.reduce(function(i,s){for(var a in s)i[a]=!0;return i},{})),t,r;return e.length===1?t=r="":(t="(",r=")"),"VALUES "+t+e.join(" ")+r+" {"+this._newline+Lr(n.values,this._newline,function(i){return"  "+t+Lr(e,void 0,function(s){return i[s]?this.toEntity(i[s]):"UNDEF"},this)+r},this)+this._newline+"}"};st.prototype.service=function(n){return"SERVICE "+(n.silent?"SILENT ":"")+this.toEntity(n.name)+" "+this.group(n)};st.prototype.toExpression=function(n){if(Vi(n))return this.toEntity(n);switch(n.type.toLowerCase()){case"aggregate":return n.aggregation.toUpperCase()+"("+(n.distinct?"DISTINCT ":"")+this.toExpression(n.expression)+(typeof n.separator=="string"?'; SEPARATOR = "'+n.separator.replace(uw,lw)+'"':"")+")";case"functioncall":return this.toEntity(n.function)+"("+Lr(n.args,", ",this.toExpression,this)+")";case"operation":var e=n.operator.toUpperCase(),t=n.args||[];switch(n.operator.toLowerCase()){case"<":case">":case">=":case"<=":case"&&":case"||":case"=":case"!=":case"+":case"-":case"*":case"/":return(Vi(t[0])?this.toEntity(t[0]):"("+this.toExpression(t[0])+")")+" "+e+" "+(Vi(t[1])?this.toEntity(t[1]):"("+this.toExpression(t[1])+")");case"!":return"!("+this.toExpression(t[0])+")";case"uplus":return"+("+this.toExpression(t[0])+")";case"uminus":return"-("+this.toExpression(t[0])+")";case"notin":e="NOT IN";case"in":return this.toExpression(t[0])+" "+e+"("+(tc(t[1])?t[1]:Lr(t[1],", ",this.toExpression,this))+")";case"notexists":e="NOT EXISTS";case"exists":return e+" "+this.group(t[0],!0);default:return e+"("+Lr(t,", ",this.toExpression,this)+")"}default:throw new Error("Unknown expression type: "+n.type)}};st.prototype.toEntity=function(n){if(Vi(n))switch(n.termType){case"Wildcard":return"*";case"Variable":return Rl(n);case"BlankNode":return"_:"+n.value;case"Literal":var e=n.value||"",t=n.language||"",r=n.datatype;if(n='"'+e.replace(uw,lw)+'"',t)n+="@"+t;else if(r){if(!this._explicitDatatype)switch(r.value){case QP:return n;case YP:if(/^\d+$/.test(e))return e+" "}n+="^^"+this.encodeIRI(r.value)}return n;case"Quad":if(!this._sparqlStar)throw new Error("SPARQL* support is not enabled");return n.graph&&n.graph.termType!=="DefaultGraph"?"<< GRAPH "+this.toEntity(n.graph)+" { "+this.toEntity(n.subject)+" "+this.toEntity(n.predicate)+" "+this.toEntity(n.object)+" }  >>":"<< "+this.toEntity(n.subject)+" "+this.toEntity(n.predicate)+" "+this.toEntity(n.object)+" >>";default:return this.encodeIRI(n.value)}else{var i=n.items.map(this.toEntity,this),s=n.pathType;switch(s){case"^":case"!":return s+i[0];case"*":case"+":case"?":return"("+i[0]+s+")";default:return"("+i.join(s)+")"}}};var uw=/["\\\t\n\r\b\f]/g,lw=o(function(n){return KP[n]},"escapeReplacer"),KP={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};st.prototype.encodeIRI=function(n){var e=this._prefixRegex.exec(n);if(e){var t=this._prefixByIri[e[1]];return this._usedPrefixes[t]=!0,t+":"+e[2]}return"<"+n+">"};st.prototype.toUpdate=function(n){switch(n.type||n.updateType){case"load":return"LOAD"+(n.source?" "+this.toEntity(n.source):"")+(n.destination?" INTO GRAPH "+this.toEntity(n.destination):"");case"insert":return"INSERT DATA "+this.group(n.insert,!0);case"delete":return"DELETE DATA "+this.group(n.delete,!0);case"deletewhere":return"DELETE WHERE "+this.group(n.delete,!0);case"insertdelete":return(n.graph?"WITH "+this.toEntity(n.graph)+this._newline:"")+(n.delete.length?"DELETE "+this.group(n.delete,!0)+this._newline:"")+(n.insert.length?"INSERT "+this.group(n.insert,!0)+this._newline:"")+(n.using?this.graphs("USING ",n.using.default):"")+(n.using?this.graphs("USING NAMED ",n.using.named):"")+"WHERE "+this.group(n.where,!0);case"add":case"copy":case"move":return n.type.toUpperCase()+" "+(n.silent?"SILENT ":"")+(n.source.default?"DEFAULT":this.toEntity(n.source.name))+" TO "+this.toEntity(n.destination.name);case"create":case"clear":case"drop":return n.type.toUpperCase()+(n.silent?" SILENT ":" ")+(n.graph.default?"DEFAULT":n.graph.named?"NAMED":n.graph.all?"ALL":"GRAPH "+this.toEntity(n.graph.name));default:throw new Error("Unknown update query type: "+n.type)}};st.prototype.indent=function(n){return n.replace(/^/gm,this._indent)};function Rl(n){return"?"+n.value}o(Rl,"variableToString");function tc(n){return typeof n=="string"}o(tc,"isString");function Vi(n){return typeof n.termType=="string"}o(Vi,"isTerm");function Ls(n,e){if(!n||!Vi(n)||!e||!Vi(e)||n.termType!==e.termType)return!1;switch(n.termType){case"Literal":return n.value===e.value&&n.language===e.language&&Ls(n.datatype,e.datatype);case"Quad":return Ls(n.subject,e.subject)&&Ls(n.predicate,e.predicate)&&Ls(n.object,e.object)&&Ls(n.graph,e.graph);default:return n.value===e.value}}o(Ls,"equalTerms");function Lr(n,e,t,r){return n.map(t,r).join(tc(e)?e:" ")}o(Lr,"mapJoin");function XP(n={}){return{stringify:o(function(e){var t=Object.create(n);return t.prefixes=e.prefixes,new st(t).toQuery(e)},"stringify"),createGenerator:o(function(){return new st(n)},"createGenerator")}}o(XP,"_Generator");hw.exports={Generator:XP}});var ag=y(Nl=>{"use strict";Object.defineProperty(Nl,"__esModule",{value:!0});Nl.BlankNode=void 0;var sg=class{static{o(this,"BlankNode")}constructor(e){this.termType="BlankNode",this.value=e}equals(e){return!!e&&e.termType==="BlankNode"&&e.value===this.value}};Nl.BlankNode=sg});var og=y(Ll=>{"use strict";Object.defineProperty(Ll,"__esModule",{value:!0});Ll.DefaultGraph=void 0;var rc=class{static{o(this,"DefaultGraph")}constructor(){this.termType="DefaultGraph",this.value=""}equals(e){return!!e&&e.termType==="DefaultGraph"}};Ll.DefaultGraph=rc;rc.INSTANCE=new rc});var jl=y(kl=>{"use strict";Object.defineProperty(kl,"__esModule",{value:!0});kl.NamedNode=void 0;var cg=class{static{o(this,"NamedNode")}constructor(e){this.termType="NamedNode",this.value=e}equals(e){return!!e&&e.termType==="NamedNode"&&e.value===this.value}};kl.NamedNode=cg});var ug=y(Ml=>{"use strict";Object.defineProperty(Ml,"__esModule",{value:!0});Ml.Literal=void 0;var dw=jl(),nc=class n{static{o(this,"Literal")}constructor(e,t){this.termType="Literal",this.value=e,typeof t=="string"?(this.language=t,this.datatype=n.RDF_LANGUAGE_STRING):t?(this.language="",this.datatype=t):(this.language="",this.datatype=n.XSD_STRING)}equals(e){return!!e&&e.termType==="Literal"&&e.value===this.value&&e.language===this.language&&this.datatype.equals(e.datatype)}};Ml.Literal=nc;nc.RDF_LANGUAGE_STRING=new dw.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString");nc.XSD_STRING=new dw.NamedNode("http://www.w3.org/2001/XMLSchema#string")});var hg=y(Vl=>{"use strict";Object.defineProperty(Vl,"__esModule",{value:!0});Vl.Quad=void 0;var lg=class{static{o(this,"Quad")}constructor(e,t,r,i){this.termType="Quad",this.value="",this.subject=e,this.predicate=t,this.object=r,this.graph=i}equals(e){return!!e&&(e.termType==="Quad"||!e.termType)&&this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)}};Vl.Quad=lg});var dg=y($l=>{"use strict";Object.defineProperty($l,"__esModule",{value:!0});$l.Variable=void 0;var fg=class{static{o(this,"Variable")}constructor(e){this.termType="Variable",this.value=e}equals(e){return!!e&&e.termType==="Variable"&&e.value===this.value}};$l.Variable=fg});var mw=y(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});Ul.DataFactory=void 0;var JP=ag(),ZP=og(),pw=ug(),e4=jl(),t4=hg(),r4=dg(),n4=0,pg=class{static{o(this,"DataFactory")}constructor(e){this.blankNodeCounter=0,e=e||{},this.blankNodePrefix=e.blankNodePrefix||`df_${n4++}_`}namedNode(e){return new e4.NamedNode(e)}blankNode(e){return new JP.BlankNode(e||`${this.blankNodePrefix}${this.blankNodeCounter++}`)}literal(e,t){return new pw.Literal(e,t)}variable(e){return new r4.Variable(e)}defaultGraph(){return ZP.DefaultGraph.INSTANCE}quad(e,t,r,i){return new t4.Quad(e,t,r,i||this.defaultGraph())}fromTerm(e){switch(e.termType){case"NamedNode":return this.namedNode(e.value);case"BlankNode":return this.blankNode(e.value);case"Literal":return e.language?this.literal(e.value,e.language):e.datatype.equals(pw.Literal.XSD_STRING)?this.literal(e.value):this.literal(e.value,this.fromTerm(e.datatype));case"Variable":return this.variable(e.value);case"DefaultGraph":return this.defaultGraph();case"Quad":return this.quad(this.fromTerm(e.subject),this.fromTerm(e.predicate),this.fromTerm(e.object),this.fromTerm(e.graph))}}fromQuad(e){return this.fromTerm(e)}resetBlankNodeCounter(){this.blankNodeCounter=0}};Ul.DataFactory=pg});var gw=y(kr=>{"use strict";var i4=kr&&kr.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),ks=kr&&kr.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&i4(e,n,t)};Object.defineProperty(kr,"__esModule",{value:!0});ks(ag(),kr);ks(mw(),kr);ks(og(),kr);ks(ug(),kr);ks(jl(),kr);ks(hg(),kr);ks(dg(),kr)});var vw=y((mU,yw)=>{var{Parser:mi}=cw(),{Generator:s4}=fw(),{Wildcard:a4}=ig(),{DataFactory:o4}=gw();function c4({prefixes:n,baseIRI:e,factory:t,pathOnly:r,sparqlStar:i,skipValidation:s,skipUngroupedVariableCheck:a}={}){let c={};for(let l in n??{})c[l]=n[l];let u=new mi;return u.parse=function(){return mi.base=e||"",mi.prefixes=Object.create(c),mi.factory=t||new o4,mi.sparqlStar=!!i,mi.pathOnly=!!r,mi.skipValidation=!!s||!!a,mi.prototype.parse.apply(u,arguments)},u._resetBlanks=mi._resetBlanks,u}o(c4,"_Parser");yw.exports={Parser:c4,Generator:s4,Wildcard:a4}});var gg=y(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.CaseWhenTransformerError=ba.CaseWhenTransformer=void 0;var mg=class{static{o(this,"CaseWhenTransformer")}transform(e){let t=e,r,i=0,s=100;do if(r=t,t=this.transformSinglePass(t),i++,i>s)throw new gi("Too many nested CASE expressions (max 100 iterations)");while(t!==r);return t}transformSinglePass(e){let t=this.findCasePositions(e);if(t.length===0)return e;let r=e;for(let i=t.length-1;i>=0;i--){let s=t[i],a=this.extractCaseExpression(r,s);if(a){let c=this.convertCaseToIf(a.content);r=r.substring(0,s)+c+r.substring(s+a.length)}}return r}findCasePositions(e){let t=[],r=e.toUpperCase(),i=0;for(;i<e.length;){if(e[i]==="'"||e[i]==='"'){let s=e[i];for(i++;i<e.length&&e[i]!==s;)e[i]==="\\"&&i++,i++;i++;continue}if(r.substring(i,i+4)==="CASE"&&this.isWordBoundary(e,i,4)){t.push(i),i+=4;continue}i++}return t}extractCaseExpression(e,t){let r=1,i=t+4,s=e.toUpperCase();for(;i<e.length&&r>0;){if(e[i]==="'"||e[i]==='"'){let a=e[i];for(i++;i<e.length&&e[i]!==a;)e[i]==="\\"&&i++,i++;i++;continue}if(s.substring(i,i+4)==="CASE"&&this.isWordBoundary(e,i,4)){r++,i+=4;continue}if(s.substring(i,i+3)==="END"&&this.isWordBoundary(e,i,3)){if(r--,r===0){let a=e.substring(t,i+3);return{content:a,length:a.length}}i+=3;continue}i++}if(r>0)throw new gi(`Unclosed CASE expression at position ${t}`);return null}isWordBoundary(e,t,r){let i=t>0?e[t-1]:"",s=t===0||!/[a-zA-Z0-9_?$]/.test(i),a=t+r<e.length?e[t+r]:"",c=t+r>=e.length||!/[a-zA-Z0-9_]/.test(a);return s&&c}convertCaseToIf(e){let t=this.extractWhenClauses(e),r=this.extractElseClause(e);if(t.length===0)throw new gi("CASE expression must have at least one WHEN clause");let i=r!==null?r:'""';for(let s=t.length-1;s>=0;s--){let{condition:a,result:c}=t[s];i=`IF(${a}, ${c}, ${i})`}return i}extractWhenClauses(e){let t=[],r=e.replace(/^\s*CASE\s+/i,"").replace(/\s*END\s*$/i,""),i=this.findKeywordPositions(r,"WHEN"),s=this.findKeywordPositions(r,"ELSE"),a=s.length>0?s[0]:r.length;for(let c=0;c<i.length;c++){let u=i[c]+4,l=c+1<i.length?i[c+1]:a,h=r.substring(u,l).trim(),f=this.parseWhenClause(h);f&&t.push(f)}return t}findKeywordPositions(e,t){let r=[],i=e.toUpperCase(),s=0,a=0;for(;s<e.length;){let c=e[s];if(c==="'"||c==='"'){let u=c;for(s++;s<e.length&&e[s]!==u;)e[s]==="\\"&&s++,s++;s++;continue}if(c==="("){a++,s++;continue}if(c===")"){a--,s++;continue}if(a===0&&i.substring(s,s+t.length)===t&&this.isWordBoundary(e,s,t.length)){r.push(s),s+=t.length;continue}s++}return r}parseWhenClause(e){let t=this.findKeywordPositions(e,"THEN");if(t.length===0)throw new gi(`WHEN clause missing THEN keyword: ${e.substring(0,50)}...`);let r=t[0],i=e.substring(0,r).trim(),s=e.substring(r+4).trim();if(!i)throw new gi("WHEN clause has empty condition");if(!s)throw new gi("WHEN clause has empty result");return{condition:i,result:s}}extractElseClause(e){let t=e.replace(/^\s*CASE\s+/i,"").replace(/\s*END\s*$/i,""),r=this.findKeywordPositions(t,"ELSE");if(r.length>0){let i=r[0];return t.substring(i+4).trim()}return null}};ba.CaseWhenTransformer=mg;var gi=class extends Error{static{o(this,"CaseWhenTransformerError")}constructor(e){super(`CASE WHEN transformation error: ${e}`),this.name="CaseWhenTransformerError"}};ba.CaseWhenTransformerError=gi});var yg=y(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});Ea.LateralTransformerError=Ea.LateralTransformer=void 0;var Bl=class n{static{o(this,"LateralTransformer")}transform(e){let t=e,r,i=0,s=100;do if(r=t,t=this.transformSinglePass(t),i++,i>s)throw new $i("Too many nested LATERAL joins (max 100 iterations)");while(t!==r);return t}hasLateral(e){return this.findLateralPositions(e).length>0}static isLateralJoin(e){if(e.type==="group"&&e.patterns){for(let t of e.patterns)if(t.type==="query"&&t.queryType==="SELECT"&&t.variables&&Array.isArray(t.variables)){for(let r of t.variables)if(r.termType==="Variable"&&r.value===n.LATERAL_MARKER)return!0}}if(e.type==="query"&&e.queryType==="SELECT"&&e.variables&&Array.isArray(e.variables)){for(let t of e.variables)if(t.termType==="Variable"&&t.value===n.LATERAL_MARKER)return!0}return!1}transformSinglePass(e){let t=this.findLateralPositions(e);if(t.length===0)return e;let r=e;for(let i=t.length-1;i>=0;i--){let s=t[i],a=this.extractLateralExpression(r,s);if(a){let c=this.transformLateral(a.content);r=r.substring(0,s)+c+r.substring(s+a.length)}}return r}findLateralPositions(e){let t=[],r=e.toUpperCase(),i=0;for(;i<e.length;){if(e[i]==="'"||e[i]==='"'){let s=e[i];for(i++;i<e.length&&e[i]!==s;)e[i]==="\\"&&i++,i++;i++;continue}if(e[i]==="#"){for(;i<e.length&&e[i]!==`
`;)i++;continue}if(r.substring(i,i+7)==="LATERAL"&&this.isWordBoundary(e,i,7)){t.push(i),i+=7;continue}i++}return t}extractLateralExpression(e,t){let r=t+7;for(;r<e.length&&/\s/.test(e[r]);)r++;if(e[r]!=="{")throw new $i(`Expected '{' after LATERAL keyword at position ${t}`);let i=1;for(r++;r<e.length&&i>0;){if(e[r]==="'"||e[r]==='"'){let s=e[r];for(r++;r<e.length&&e[r]!==s;)e[r]==="\\"&&r++,r++;r++;continue}if(e[r]==="#"){for(;r<e.length&&e[r]!==`
`;)r++;continue}if(e[r]==="{"){i++,r++;continue}if(e[r]==="}"){if(i--,i===0){let s=e.substring(t,r+1);return{content:s,length:s.length}}r++;continue}r++}if(i>0)throw new $i(`Unclosed LATERAL block at position ${t}`);return null}transformLateral(e){let t=e.indexOf("{");if(t===-1)throw new $i("LATERAL expression missing opening brace");let r=e.substring(t+1,e.length-1).trim();if(!r.toUpperCase().trim().startsWith("SELECT"))throw new $i("LATERAL block must contain a SELECT subquery");let a=r.toUpperCase().indexOf("SELECT")+6;for(;a<r.length&&/\s/.test(r[a]);)a++;let c=r.substring(a).toUpperCase();return c.startsWith("DISTINCT")?a+=8:c.startsWith("REDUCED")&&(a+=7),`{ ${r.substring(0,a)+` ?${n.LATERAL_MARKER}`+r.substring(a)} }`}isWordBoundary(e,t,r){let i=t>0?e[t-1]:"",s=t===0||!/[a-zA-Z0-9_]/.test(i),a=t+r<e.length?e[t+r]:"",c=t+r>=e.length||!/[a-zA-Z0-9_]/.test(a);return s&&c}};Ea.LateralTransformer=Bl;Bl.LATERAL_MARKER="__LATERAL_JOIN__";var $i=class extends Error{static{o(this,"LateralTransformerError")}constructor(e){super(`LATERAL transformation error: ${e}`),this.name="LateralTransformerError"}};Ea.LateralTransformerError=$i});var ww=y(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.PrefixStarTransformerError=Ui.PrefixStarTransformer=Ui.WellKnownPrefixResolver=void 0;var ql=class{static{o(this,"WellKnownPrefixResolver")}constructor(){this.wellKnownPrefixes=new Map;let e=new Map;e.set("schema","http://schema.org/"),this.wellKnownPrefixes.set("http://schema.org/",e);let t=new Map;t.set("foaf","http://xmlns.com/foaf/0.1/"),this.wellKnownPrefixes.set("http://xmlns.com/foaf/0.1/",t);let r=new Map;r.set("dc","http://purl.org/dc/elements/1.1/"),r.set("dcterms","http://purl.org/dc/terms/"),this.wellKnownPrefixes.set("http://purl.org/dc/elements/1.1/",r),this.wellKnownPrefixes.set("http://purl.org/dc/terms/",r);let i=new Map;i.set("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),i.set("rdfs","http://www.w3.org/2000/01/rdf-schema#"),this.wellKnownPrefixes.set("http://www.w3.org/1999/02/22-rdf-syntax-ns#",i),this.wellKnownPrefixes.set("http://www.w3.org/2000/01/rdf-schema#",i);let s=new Map;s.set("owl","http://www.w3.org/2002/07/owl#"),this.wellKnownPrefixes.set("http://www.w3.org/2002/07/owl#",s);let a=new Map;a.set("xsd","http://www.w3.org/2001/XMLSchema#"),this.wellKnownPrefixes.set("http://www.w3.org/2001/XMLSchema#",a);let c=new Map;c.set("skos","http://www.w3.org/2004/02/skos/core#"),this.wellKnownPrefixes.set("http://www.w3.org/2004/02/skos/core#",c);let u=new Map;u.set("prov","http://www.w3.org/ns/prov#"),this.wellKnownPrefixes.set("http://www.w3.org/ns/prov#",u);let l=new Map;l.set("geo","http://www.w3.org/2003/01/geo/wgs84_pos#"),this.wellKnownPrefixes.set("http://www.w3.org/2003/01/geo/wgs84_pos#",l);let h=new Map;h.set("dcat","http://www.w3.org/ns/dcat#"),this.wellKnownPrefixes.set("http://www.w3.org/ns/dcat#",h)}async resolve(e){let t=e.endsWith("#")||e.endsWith("/")?e:e+(e.includes("#")?"":"/"),r=this.wellKnownPrefixes.get(t);if(r)return r;let i=t.slice(0,-1),s=this.wellKnownPrefixes.get(i);return s||new Map}addVocabulary(e,t){this.wellKnownPrefixes.set(e,t)}};Ui.WellKnownPrefixResolver=ql;var vg=class{static{o(this,"PrefixStarTransformer")}constructor(e){this.resolver=e??new ql}async transform(e){let t=this.findPrefixStarDeclarations(e);if(t.length===0)return e;let r=[],i=[];for(let a of t)try{let c=await this.resolver.resolve(a.uri);for(let[u,l]of c)r.push(`PREFIX ${u}: <${l}>`);if(c.size===0){let u=this.extractPrefixFromUri(a.uri);u&&r.push(`PREFIX ${u}: <${a.uri}>`)}}catch(c){let u=c instanceof Error?c.message:String(c);i.push(`Failed to resolve vocabulary ${a.uri}: ${u}`)}if(r.length===0&&i.length>0)throw new Ta(i.join("; "));let s=e;for(let a=t.length-1;a>=0;a--){let c=t[a];s=s.substring(0,c.startPos)+s.substring(c.endPos)}return r.length>0&&(s=r.join(`
`)+`
`+s.trimStart()),s}findPrefixStarDeclarations(e){let t=[],r=e.toUpperCase(),i=0;for(;i<e.length;){if(e[i]==="'"||e[i]==='"'){let s=e[i];for(i++;i<e.length&&e[i]!==s;)e[i]==="\\"&&i++,i++;i++;continue}if(r.substring(i,i+6)==="PREFIX"){let s=i;for(i+=6;i<e.length&&/\s/.test(e[i]);)i++;if(e[i]==="*"){for(i++;i<e.length&&/\s/.test(e[i]);)i++;if(e[i]==="<"){i++;let a=i;for(;i<e.length&&e[i]!==">";)i++;if(e[i]===">"){let c=e.substring(a,i);i++;let u=this.findDeclarationEnd(e,i);t.push({uri:c,startPos:s,endPos:u}),i=u;continue}else throw new Ta(`Unclosed IRI in PREFIX* declaration at position ${a}`)}else throw new Ta(`Expected IRI after PREFIX* at position ${i}`)}else continue}i++}return t}findDeclarationEnd(e,t){let r=t;for(;r<e.length;){let i=e[r];if(i===`
`)return r+1;let s=e.substring(r).toUpperCase();if(s.startsWith("PREFIX")||s.startsWith("BASE")||s.startsWith("SELECT")||s.startsWith("CONSTRUCT")||s.startsWith("DESCRIBE")||s.startsWith("ASK"))return r;if(/\s/.test(i)){r++;continue}break}return r}extractPrefixFromUri(e){let t=e.replace(/^https?:\/\//,"");t=t.replace(/\/$/,"").replace(/#$/,"");let r=t.split(/[/.#]+/).filter(Boolean);if(r.length===0)return null;let i=r[r.length-1];return/^(ontology|vocab|schema|ns|core)$/i.test(i)&&r.length>1?r[r.length-2].toLowerCase():i.toLowerCase().replace(/[^a-z0-9]/g,"")}};Ui.PrefixStarTransformer=vg;var Ta=class extends Error{static{o(this,"PrefixStarTransformerError")}constructor(e){super(`PREFIX* transformation error: ${e}`),this.name="PrefixStarTransformerError"}};Ui.PrefixStarTransformerError=Ta});var wg=y(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.DescribeOptionsTransformer=Ca.DescribeOptionsTransformerError=void 0;var Gl=class extends Error{static{o(this,"DescribeOptionsTransformerError")}constructor(e){super(e),this.name="DescribeOptionsTransformerError"}};Ca.DescribeOptionsTransformerError=Gl;var Aa=class n{static{o(this,"DescribeOptionsTransformer")}transform(e){if(!n.DESCRIBE_QUERY_PATTERN.test(e))return{query:e};let t=e,r={},i=!1,s=n.DEPTH_PATTERN.exec(e);if(s){let a=parseInt(s[1],10);if(a<0)throw new Gl(`DESCRIBE DEPTH must be a non-negative integer, got: ${a}`);r.depth=a,i=!0,n.DEPTH_PATTERN.lastIndex=0,t=t.replace(n.DEPTH_PATTERN,"")}return n.DEPTH_PATTERN.lastIndex=0,n.SYMMETRIC_PATTERN.test(e)&&(r.symmetric=!0,i=!0,n.SYMMETRIC_PATTERN.lastIndex=0,t=t.replace(n.SYMMETRIC_PATTERN,"")),n.SYMMETRIC_PATTERN.lastIndex=0,t=t.replace(/\s{2,}/g," ").trim(),{query:t,options:i?r:void 0}}hasDescribeOptions(e){let t=n.DEPTH_PATTERN.test(e);n.DEPTH_PATTERN.lastIndex=0;let r=n.SYMMETRIC_PATTERN.test(e);return n.SYMMETRIC_PATTERN.lastIndex=0,t||r}};Ca.DescribeOptionsTransformer=Aa;Aa.DEPTH_PATTERN=/\bDEPTH\s+(\d+)/gi;Aa.SYMMETRIC_PATTERN=/\bSYMMETRIC\b/gi;Aa.DESCRIBE_QUERY_PATTERN=/\bDESCRIBE\b/i});var _w=y(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.DirectionalLangTagTransformerError=xa.DirectionalLangTagTransformer=void 0;var Wl=class n{static{o(this,"DirectionalLangTagTransformer")}constructor(){this.directionMappings=new Map}transform(e){return this.directionMappings.clear(),e.replace(n.DIRECTIONAL_TAG_REGEX,(t,r,i,s,a)=>{let c=s.toLowerCase();return this.directionMappings.set(c,a),`${r}${i}${r}@${s}`})}getDirection(e){return this.directionMappings.get(e.toLowerCase())}getAllMappings(){return new Map(this.directionMappings)}hasDirectionalTags(e){return n.DIRECTIONAL_TAG_REGEX.lastIndex=0,n.DIRECTIONAL_TAG_REGEX.test(e)}clearMappings(){this.directionMappings.clear()}};xa.DirectionalLangTagTransformer=Wl;Wl.DIRECTIONAL_TAG_REGEX=/(["'])((?:[^\\]|\\.)*?)\1@([a-zA-Z]+(?:-[a-zA-Z0-9]+)*)--(ltr|rtl)/g;var _g=class extends Error{static{o(this,"DirectionalLangTagTransformerError")}constructor(e){super(`Directional language tag transformation error: ${e}`),this.name="DirectionalLangTagTransformerError"}};xa.DirectionalLangTagTransformerError=_g});var Sw=y(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.TripleTermTransformerError=Oa.TripleTermTransformer=void 0;var Sg=class{static{o(this,"TripleTermTransformer")}transform(e){let t=e,r,i=0,s=100;do if(r=t,t=this.transformSinglePass(t),i++,i>s)throw new Ia("Too many nested triple terms (max 100 iterations)");while(t!==r);return t}hasTripleTermSyntax(e){return this.findTripleTermPositions(e).length>0}transformSinglePass(e){let t=this.findTripleTermPositions(e);if(t.length===0)return e;let r=e;for(let i=t.length-1;i>=0;i--){let s=t[i],a=this.extractTripleTerm(r,s);if(a){let c=this.convertToStandardSyntax(a.content);r=r.substring(0,s)+c+r.substring(s+a.length)}}return r}findTripleTermPositions(e){let t=[],r=0;for(;r<e.length;){if(e[r]==="'"){r=this.skipStringLiteral(e,r,"'");continue}if(e[r]==='"'){r=this.skipStringLiteral(e,r,'"');continue}if(e.substring(r,r+2)==="<<"&&this.isParenthesizedTripleTerm(e,r)){t.push(r),r+=2;continue}r++}return t}skipStringLiteral(e,t,r){let i=r.repeat(3);if(e.substring(t,t+3)===i){for(t+=3;t<e.length;){if(e.substring(t,t+3)===i)return t+3;e[t]==="\\"&&t++,t++}return t}for(t++;t<e.length&&e[t]!==r;)e[t]==="\\"&&t++,t++;return t+1}isParenthesizedTripleTerm(e,t){let r=t+2;for(;r<e.length&&/\s/.test(e[r]);)r++;return e[r]==="("}extractTripleTerm(e,t){let r=t+2;for(;r<e.length&&/\s/.test(e[r]);)r++;if(e[r]!=="(")return null;r++;let i=1;for(;r<e.length&&i>0;){if(e[r]==="'"||e[r]==='"'){r=this.skipStringLiteral(e,r,e[r]);continue}if(e.substring(r,r+2)==="<<"&&this.isParenthesizedTripleTerm(e,r)){for(r+=2;r<e.length&&/\s/.test(e[r]);)r++;e[r]==="("&&(i++,r++);continue}if(e.substring(r,r+2)==="<<"){r+=2;let s=1;for(;r<e.length&&s>0;){if(e[r]==="'"||e[r]==='"'){r=this.skipStringLiteral(e,r,e[r]);continue}if(e.substring(r,r+2)==="<<"){s++,r+=2;continue}if(e.substring(r,r+2)===">>"){s--,r+=2;continue}r++}continue}if(e[r]==="("){i++,r++;continue}if(e[r]===")"){let s=r+1;for(;s<e.length&&/\s/.test(e[s]);)s++;if(e.substring(s,s+2)===">>"){if(i--,i===0){let a=e.substring(t,s+2);return{content:a,length:a.length}}r=s+2;continue}r++;continue}r++}if(i>0)throw new Ia(`Unclosed triple term at position ${t}: missing )>>`);return null}convertToStandardSyntax(e){let t=e.match(/^<<\s*\(\s*([\s\S]*?)\s*\)\s*>>$/);if(!t)throw new Ia(`Invalid triple term syntax: ${e.substring(0,50)}...`);return`<< ${t[1]} >>`}};Oa.TripleTermTransformer=Sg;var Ia=class extends Error{static{o(this,"TripleTermTransformerError")}constructor(e){super(`Triple term transformation error: ${e}`),this.name="TripleTermTransformerError"}};Oa.TripleTermTransformerError=Ia});var Tw=y(zr=>{"use strict";var u4=zr&&zr.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),l4=zr&&zr.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),h4=zr&&zr.__importStar||(function(){var n=o(function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)},"ownKeys");return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&u4(t,e,r[i]);return l4(t,e),t}})();Object.defineProperty(zr,"__esModule",{value:!0});zr.SPARQLParser=zr.SPARQLParseError=void 0;var bw=h4(vw()),bg=gg(),Eg=yg(),Ew=ww(),Tg=wg(),f4=_w(),Ag=Sw(),Tt=class extends Error{static{o(this,"SPARQLParseError")}constructor(e,t,r,i){super(e,i?{cause:i}:void 0),this.name="SPARQLParseError",this.line=t,this.column=r}};zr.SPARQLParseError=Tt;var Cg=class{static{o(this,"SPARQLParser")}constructor(e){this.lastDirectionMappings=new Map,this.parser=new bw.Parser({sparqlStar:!0}),this.generator=new bw.Generator({sparqlStar:!0}),this.caseWhenTransformer=new bg.CaseWhenTransformer,this.lateralTransformer=new Eg.LateralTransformer,this.prefixStarTransformer=new Ew.PrefixStarTransformer(e?.vocabularyResolver),this.describeOptionsTransformer=new Tg.DescribeOptionsTransformer,this.directionalLangTagTransformer=new f4.DirectionalLangTagTransformer,this.tripleTermTransformer=new Ag.TripleTermTransformer}parse(e){try{let t=this.describeOptionsTransformer.transform(e);this.lastDescribeOptions=t.options;let r=t.query;r=this.directionalLangTagTransformer.transform(r),this.lastDirectionMappings=this.directionalLangTagTransformer.getAllMappings(),r=this.lateralTransformer.transform(r),r=this.caseWhenTransformer.transform(r),r=this.tripleTermTransformer.transform(r);let i=this.parser.parse(r);return this.validateQuery(i),this.lastDescribeOptions&&this.isDescribeQuery(i)&&(i.describeOptions=this.lastDescribeOptions),i}catch(t){if(t instanceof Tg.DescribeOptionsTransformerError)throw new Tt(t.message);if(t instanceof Eg.LateralTransformerError)throw new Tt(t.message);if(t instanceof bg.CaseWhenTransformerError)throw new Tt(t.message);if(t instanceof Ag.TripleTermTransformerError)throw new Tt(t.message);if(t instanceof Error){let r=t.message.match(/line (\d+), column (\d+)/),i=r?parseInt(r[1],10):void 0,s=r?parseInt(r[2],10):void 0;throw new Tt(`SPARQL syntax error: ${t.message}`,i,s,t)}throw t}}parseWithOptions(e){return{query:this.parse(e),describeOptions:this.lastDescribeOptions}}getLastDescribeOptions(){return this.lastDescribeOptions}async parseAsync(e){try{let t=this.describeOptionsTransformer.transform(e);this.lastDescribeOptions=t.options;let r=t.query;r=this.directionalLangTagTransformer.transform(r),this.lastDirectionMappings=this.directionalLangTagTransformer.getAllMappings(),r=await this.prefixStarTransformer.transform(r),r=this.lateralTransformer.transform(r),r=this.caseWhenTransformer.transform(r),r=this.tripleTermTransformer.transform(r);let i=this.parser.parse(r);return this.validateQuery(i),this.lastDescribeOptions&&this.isDescribeQuery(i)&&(i.describeOptions=this.lastDescribeOptions),i}catch(t){if(t instanceof Tg.DescribeOptionsTransformerError)throw new Tt(t.message);if(t instanceof Ew.PrefixStarTransformerError)throw new Tt(t.message);if(t instanceof Eg.LateralTransformerError)throw new Tt(t.message);if(t instanceof bg.CaseWhenTransformerError)throw new Tt(t.message);if(t instanceof Ag.TripleTermTransformerError)throw new Tt(t.message);if(t instanceof Error){let r=t.message.match(/line (\d+), column (\d+)/),i=r?parseInt(r[1],10):void 0,s=r?parseInt(r[2],10):void 0;throw new Tt(`SPARQL syntax error: ${t.message}`,i,s,t)}throw t}}async parseAsyncWithOptions(e){return{query:await this.parseAsync(e),describeOptions:this.lastDescribeOptions}}hasPrefixStar(e){return/PREFIX\s*\*/i.test(e)}hasLateral(e){return this.lateralTransformer.hasLateral(e)}hasDescribeOptions(e){return this.describeOptionsTransformer.hasDescribeOptions(e)}hasDirectionalLangTags(e){return this.directionalLangTagTransformer.hasDirectionalTags(e)}hasTripleTermSyntax(e){return this.tripleTermTransformer.hasTripleTermSyntax(e)}getLastDirectionMappings(){return new Map(this.lastDirectionMappings)}getDirectionForLanguage(e){return this.lastDirectionMappings.get(e.toLowerCase())}toString(e){try{return this.generator.stringify(e)}catch(t){throw t instanceof Error?new Tt(`Failed to serialize SPARQL query: ${t.message}`,void 0,void 0,t):t}}getQueryType(e){if("queryType"in e&&e.type==="query")return e.queryType;throw new Tt("Query does not have a valid queryType property")}isSelectQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="SELECT"}isConstructQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="CONSTRUCT"}isAskQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="ASK"}isDescribeQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="DESCRIBE"}isUpdateQuery(e){return e.type==="update"}isInsertDataOperation(e){return"updateType"in e&&e.updateType==="insert"}isDeleteDataOperation(e){return"updateType"in e&&e.updateType==="delete"}validateQuery(e){if(!e||typeof e!="object")throw new Tt("Invalid query: not an object");if(e.type!=="query"&&e.type!=="update")throw new Tt(`Invalid type: expected "query" or "update", got "${e.type}"`);if(e.type==="query"){let t=["SELECT","CONSTRUCT","ASK","DESCRIBE"];if(!t.includes(e.queryType))throw new Tt(`Invalid query type: expected one of ${t.join(", ")}, got "${e.queryType}"`)}}};zr.SPARQLParser=Cg});var Cw=y(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.AlgebraTranslator=Da.AlgebraTranslatorError=void 0;var Aw=yg(),he=class extends Error{static{o(this,"AlgebraTranslatorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="AlgebraTranslatorError"}};Da.AlgebraTranslatorError=he;var xg=class{static{o(this,"AlgebraTranslator")}constructor(){this.directionMappings=new Map,this.aggregateCounter=0}setDirectionMappings(e){this.directionMappings=e}translate(e){if(e.type!=="query")throw new he("Only query operations are supported (not updates)");if(e.queryType==="SELECT")return this.translateSelect(e);if(e.queryType==="CONSTRUCT")return this.translateConstruct(e);if(e.queryType==="ASK")return this.translateAsk(e);if(e.queryType==="DESCRIBE")return this.translateDescribe(e);throw new he(`Query type ${e.queryType} not yet supported`)}translateSelect(e){let t;if(!e.where||e.where.length===0)throw new he("SELECT query must have WHERE clause");t=this.translateWhere(e.where),this.aggregateCounter=0;let r=new Map,i=this.extractAggregatesWithMapping(e.variables,r),s=this.extractGroupVariables(e.group);if((i.length>0||s.length>0)&&(t={type:"group",variables:s,aggregates:i,input:t}),e.variables&&e.variables.length>0){for(let c of e.variables){let u=c;if(u.expression&&u.variable){if(u.expression.type==="aggregate")continue;let l=this.transformExpressionWithAggregateVars(u.expression,r);t={type:"extend",variable:u.variable.value,expression:l,input:t}}}let a=e.variables.filter(c=>c.termType==="Variable"||c.variable).map(c=>c.termType==="Variable"?c.value:c.variable.value);a.length>0&&(t={type:"project",variables:a,input:t})}return e.distinct&&(t={type:"distinct",input:t}),e.reduced&&(t={type:"reduced",input:t}),e.order&&e.order.length>0&&(t={type:"orderby",comparators:e.order.map(a=>this.translateOrderComparator(a)),input:t}),(e.limit!==void 0||e.offset!==void 0)&&(t={type:"slice",limit:e.limit,offset:e.offset,input:t}),t}translateConstruct(e){let t=this.translateConstructTemplate(e.template??[]);if(!e.where||e.where.length===0)throw new he("CONSTRUCT query must have WHERE clause");let r=this.translateWhere(e.where);return{type:"construct",template:t,where:r}}translateConstructTemplate(e){return!e||!Array.isArray(e)?[]:e.map(t=>this.translateTriple(t))}translateAsk(e){return{type:"ask",where:e.where&&e.where.length>0?this.translateWhere(e.where):{type:"bgp",triples:[]}}}extractAggregatesWithMapping(e,t){if(!e)return[];let r=[];for(let i of e)!i.expression||!i.variable||(i.expression.type==="aggregate"?(r.push({variable:i.variable.value,expression:this.translateAggregateExpression(i.expression)}),t.set(i.expression,i.variable.value)):this.collectNestedAggregates(i.expression,r,t));return r}collectNestedAggregates(e,t,r){if(e){if(e.type==="aggregate"){let i=`__agg${this.aggregateCounter++}`;t.push({variable:i,expression:this.translateAggregateExpression(e)}),r.set(e,i)}else if(e.type==="operation"&&e.args)for(let i of e.args)this.collectNestedAggregates(i,t,r)}}transformExpressionWithAggregateVars(e,t){if(t.has(e))return{type:"variable",name:t.get(e)};if(e.type==="operation"&&e.args){let r=e.args.map(c=>this.transformExpressionWithAggregateVars(c,t)),i=["=","!=","<",">","<=",">="],s=["&&","||","!"],a=["+","-","*","/"];return i.includes(e.operator)?{type:"comparison",operator:e.operator,left:r[0],right:r[1]}:s.includes(e.operator)?{type:"logical",operator:e.operator,operands:r}:a.includes(e.operator)?{type:"arithmetic",operator:e.operator,left:r[0],right:r[1]}:{type:"function",function:e.operator,args:r}}return this.translateExpression(e)}extractGroupVariables(e){return e?e.filter(t=>t.expression&&t.expression.termType==="Variable").map(t=>t.expression.value):[]}translateAggregateExpression(e){let t=e.aggregation;if(typeof t=="string"){let r=t.toLowerCase();return["count","sum","avg","min","max","group_concat","sample"].includes(r)?{type:"aggregate",aggregation:r,expression:e.expression?this.translateExpression(e.expression):void 0,distinct:e.distinct||!1,separator:e.separator}:{type:"aggregate",aggregation:{type:"custom",iri:t},expression:e.expression?this.translateExpression(e.expression):void 0,distinct:e.distinct||!1,separator:e.separator}}if(t&&typeof t=="object"){let r;if(t.termType==="NamedNode"&&t.value)r=t.value;else if("value"in t)r=String(t.value);else throw new he(`Invalid custom aggregate: expected IRI but got ${JSON.stringify(t)}`);return{type:"aggregate",aggregation:{type:"custom",iri:r},expression:e.expression?this.translateExpression(e.expression):void 0,distinct:e.distinct||!1,separator:e.separator}}throw new he(`Unknown aggregate format: ${JSON.stringify(t)}`)}isLateralPattern(e){if(e.type==="query"&&this.isLateralSubquery(e))return!0;if(e.type==="group"&&e.patterns?.length===1){let t=e.patterns[0];if(t.type==="query"&&this.isLateralSubquery(t))return!0}return!1}extractLateralSubquery(e){if(e.type==="query")return e;if(e.type==="group"&&e.patterns?.length===1)return e.patterns[0];throw new he("Invalid lateral pattern structure")}translateWhere(e){if(e.length===0)throw new he("Empty WHERE clause");let t=e.filter(a=>a.type==="filter"),r=e.filter(a=>a.type==="bind"),i=e.filter(a=>a.type!=="filter"&&a.type!=="bind"),s;if(i.length===0)s={type:"bgp",triples:[]};else if(i.length===1)s=this.translatePattern(i[0]);else{s=this.translatePattern(i[0]);for(let a=1;a<i.length;a++){let c=i[a];if(this.isLateralPattern(c)){let u=this.extractLateralSubquery(c),l=this.removeLateralMarker(u),h=this.translateSelect(l);s={type:"lateraljoin",left:s,right:h}}else{let u=this.translatePattern(c);s={type:"join",left:s,right:u}}}}for(let a of r)s=this.translateBind(a,s);for(let a of t)s={type:"filter",expression:this.translateExpression(a.expression),input:s};return s}translatePattern(e){if(!e||!e.type)throw new he("Invalid pattern: missing type");switch(e.type){case"bgp":return this.translateBGP(e);case"filter":return this.translateFilter(e);case"optional":return this.translateOptional(e);case"union":return this.translateUnion(e);case"minus":return this.translateMinus(e);case"values":return this.translateValues(e);case"group":return this.translateWhere(e.patterns);case"query":return this.translateSubquery(e);case"service":return this.translateService(e);case"graph":return this.translateGraph(e);default:throw new he(`Unsupported pattern type: ${e.type}`)}}translateBGP(e){if(!e.triples||!Array.isArray(e.triples))throw new he("BGP pattern must have triples array");return{type:"bgp",triples:e.triples.map(t=>this.translateTriple(t))}}translateTriple(e){if(!e.subject||!e.predicate||!e.object)throw new he("Triple must have subject, predicate, and object");return{subject:this.translateTripleElement(e.subject),predicate:this.translatePredicate(e.predicate),object:this.translateTripleElement(e.object)}}translatePredicate(e){return e.type==="path"?this.translatePropertyPath(e):this.translateTripleElement(e)}translatePropertyPath(e){if(!e.pathType)throw new he("Property path must have pathType");if(!e.items||!Array.isArray(e.items))throw new he("Property path must have items array");let t=e.items.map(r=>this.translatePathItem(r));switch(e.pathType){case"/":return{type:"path",pathType:"/",items:t};case"|":return{type:"path",pathType:"|",items:t};case"^":if(t.length!==1)throw new he("Inverse path must have exactly one item");return{type:"path",pathType:"^",items:[t[0]]};case"+":if(t.length!==1)throw new he("OneOrMore path must have exactly one item");return{type:"path",pathType:"+",items:[t[0]]};case"*":if(t.length!==1)throw new he("ZeroOrMore path must have exactly one item");return{type:"path",pathType:"*",items:[t[0]]};case"?":if(t.length!==1)throw new he("ZeroOrOne path must have exactly one item");return{type:"path",pathType:"?",items:[t[0]]};default:throw new he(`Unsupported property path type: ${e.pathType}`)}}translatePathItem(e){if(e.type==="path")return this.translatePropertyPath(e);if(e.termType==="NamedNode")return{type:"iri",value:e.value};throw new he(`Unsupported path item type: ${e.type||e.termType}`)}translateTripleElement(e){if(!e||!e.termType)throw new he("Triple element must have termType");switch(e.termType){case"Variable":return{type:"variable",value:e.value};case"NamedNode":return{type:"iri",value:e.value};case"Literal":{let t={type:"literal",value:e.value,datatype:e.datatype?.value,language:e.language};if(e.language){let r=this.directionMappings.get(e.language.toLowerCase());r&&(t.direction=r)}return t}case"BlankNode":return{type:"blank",value:e.value};case"Quad":return this.translateQuotedTriple(e);default:throw new he(`Unsupported term type: ${e.termType}`)}}translateQuotedTriple(e){if(!e.subject||!e.predicate||!e.object)throw new he("Quoted triple must have subject, predicate, and object");let t=this.translateTripleElement(e.subject),r=this.translateQuotedTriplePredicate(e.predicate),i=this.translateTripleElement(e.object);return{type:"quoted",subject:t,predicate:r,object:i}}translateQuotedTriplePredicate(e){if(!e||!e.termType)throw new he("Quoted triple predicate must have termType");switch(e.termType){case"Variable":return{type:"variable",value:e.value};case"NamedNode":return{type:"iri",value:e.value};default:throw new he(`Quoted triple predicate must be IRI or Variable, got: ${e.termType}`)}}translateFilter(e){if(!e.expression)throw new he("Filter pattern must have expression");let t=e.patterns?this.translateWhere(e.patterns):{type:"bgp",triples:[]};return{type:"filter",expression:this.translateExpression(e.expression),input:t}}translateExpression(e){if(!e)throw new he("Expression cannot be null or undefined");if(e.type==="operation")return this.translateOperationExpression(e);if(e.type==="functioncall"||e.type==="functionCall")return{type:"functionCall",function:e.function,args:e.args.map(t=>this.translateExpression(t))};if(e.termType)return this.translateTermExpression(e);throw new he(`Unsupported expression structure: ${JSON.stringify(e)}`)}translateOperationExpression(e){let t=["=","!=","<",">","<=",">="],r=["&&","||","!"],i=["+","-","*","/"];return t.includes(e.operator)?{type:"comparison",operator:e.operator,left:this.translateExpression(e.args[0]),right:this.translateExpression(e.args[1])}:r.includes(e.operator)?{type:"logical",operator:e.operator,operands:e.args.map(s=>this.translateExpression(s))}:i.includes(e.operator)?{type:"arithmetic",operator:e.operator,left:this.translateExpression(e.args[0]),right:this.translateExpression(e.args[1])}:e.operator==="exists"||e.operator==="notexists"?this.translateExistsExpression(e):e.operator==="in"||e.operator==="notin"?this.translateInExpression(e):{type:"function",function:e.operator,args:e.args.map(s=>this.translateExpression(s))}}translateExistsExpression(e){if(!e.args||e.args.length!==1)throw new he("EXISTS/NOT EXISTS must have exactly one pattern argument");let t=e.args[0],r;return t.type==="group"&&t.patterns?r=this.translateWhere(t.patterns):t.type==="bgp"?r=this.translateBGP(t):r=this.translatePattern(t),{type:"exists",negated:e.operator==="notexists",pattern:r}}translateInExpression(e){if(!e.args||e.args.length!==2)throw new he("IN/NOT IN must have exactly 2 arguments (expression and list)");let t=e.args[0],r=e.args[1];if(!Array.isArray(r))throw new he("IN/NOT IN second argument must be an array of values");return{type:"in",expression:this.translateExpression(t),list:r.map(i=>this.translateExpression(i)),negated:e.operator==="notin"}}translateTermExpression(e){if(e.termType==="Variable")return{type:"variable",name:e.value};if(e.termType==="Literal"){let t=e.value;return e.datatype&&(e.datatype.value.includes("#integer")||e.datatype.value.includes("#decimal")?t=parseFloat(e.value):e.datatype.value.includes("#boolean")&&(t=e.value==="true")),{type:"literal",value:t,datatype:e.datatype?.value}}return{type:"literal",value:String(e.value||e)}}translateOptional(e){if(!e.patterns||e.patterns.length===0)throw new he("OPTIONAL pattern must have patterns");return{type:"leftjoin",left:{type:"bgp",triples:[]},right:this.translateWhere(e.patterns),expression:e.expression?this.translateExpression(e.expression):void 0}}translateUnion(e){if(!e.patterns||e.patterns.length<2)throw new he("UNION pattern must have at least 2 patterns");let t=o(i=>i.type==="graph"?this.translateGraph(i):i.type==="service"?this.translateService(i):i.patterns&&Array.isArray(i.patterns)?this.translateWhere(i.patterns):this.translateWhere([i]),"translateBranch"),r={type:"union",left:t(e.patterns[0]),right:t(e.patterns[1])};for(let i=2;i<e.patterns.length;i++)r={type:"union",left:r,right:t(e.patterns[i])};return r}translateMinus(e){if(!e.patterns||e.patterns.length===0)throw new he("MINUS pattern must have patterns");return{type:"minus",left:{type:"bgp",triples:[]},right:this.translateWhere(e.patterns)}}translateValues(e){if(!e.values||!Array.isArray(e.values))throw new he("VALUES pattern must have values array");let t=new Set;for(let i of e.values)for(let s of Object.keys(i)){let a=s.startsWith("?")?s.slice(1):s;t.add(a)}let r=e.values.map(i=>this.translateValuesBinding(i));return{type:"values",variables:Array.from(t),bindings:r}}translateValuesBinding(e){let t={};for(let[r,i]of Object.entries(e)){let s=r.startsWith("?")?r.slice(1):r,a=i;if(a)if(a.termType==="NamedNode")t[s]={type:"iri",value:a.value};else if(a.termType==="Literal"){let c={type:"literal",value:a.value,datatype:a.datatype?.value,language:a.language||void 0};if(a.language){let u=this.directionMappings.get(a.language.toLowerCase());u&&(c.direction=u)}t[s]=c}else throw new he(`Unsupported VALUES term type: ${a.termType}`)}return t}translateBind(e,t){if(!e.variable||!e.expression)throw new he("BIND pattern must have variable and expression");return{type:"extend",variable:e.variable.value,expression:this.translateExpression(e.expression),input:t}}translateOrderComparator(e){return{expression:this.translateExpression(e.expression),descending:e.descending||!1}}isLateralSubquery(e){return e.queryType!=="SELECT"||!e.variables?!1:e.variables.some(t=>t.termType==="Variable"&&t.value===Aw.LateralTransformer.LATERAL_MARKER)}removeLateralMarker(e){return e.variables?{...e,variables:e.variables.filter(t=>!(t.termType==="Variable"&&t.value===Aw.LateralTransformer.LATERAL_MARKER))}:e}translateSubquery(e){if(e.queryType!=="SELECT")throw new he(`Only SELECT subqueries are supported, got: ${e.queryType}`);let t=this.removeLateralMarker(e);return{type:"subquery",query:this.translateSelect(t)}}translateService(e){if(!e.name||e.name.termType!=="NamedNode")throw new he("SERVICE pattern must have a NamedNode endpoint");if(!e.patterns||!Array.isArray(e.patterns))throw new he("SERVICE pattern must have patterns array");let t=this.translateWhere(e.patterns);return{type:"service",endpoint:e.name.value,pattern:t,silent:e.silent||!1}}translateGraph(e){if(!e.name)throw new he("GRAPH pattern must have a name (IRI or variable)");if(!e.patterns||!Array.isArray(e.patterns))throw new he("GRAPH pattern must have patterns array");let t;if(e.name.termType==="NamedNode")t={type:"iri",value:e.name.value};else if(e.name.termType==="Variable")t={type:"variable",value:e.name.value};else throw new he(`GRAPH pattern name must be NamedNode or Variable, got: ${e.name.termType}`);let r=this.translateWhere(e.patterns);return{type:"graph",name:t,pattern:r}}translateDescribe(e){let t=[];if(e.variables&&Array.isArray(e.variables))for(let s of e.variables){let a=s;a.termType==="Wildcard"||a.value==="*"||(a.termType==="Variable"?t.push({type:"variable",value:a.value}):a.termType==="NamedNode"&&t.push({type:"iri",value:a.value}))}let r;e.where&&e.where.length>0&&(r=this.translateWhere(e.where));let i=e.describeOptions;return{type:"describe",resources:t,where:r,depth:i?.depth,symmetric:i?.symmetric}}};Da.AlgebraTranslator=xg});var Og=y(zl=>{"use strict";Object.defineProperty(zl,"__esModule",{value:!0});zl.FilterContainsOptimizer=void 0;var d4=Ye(),p4=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i,Ig=class{static{o(this,"FilterContainsOptimizer")}constructor(){this.tripleStore=null,this.lastOptimizationHints=[]}setTripleStore(e){this.tripleStore=e}getLastOptimizationHints(){return this.lastOptimizationHints}clearHints(){this.lastOptimizationHints=[]}async optimize(e){return this.clearHints(),this.optimizeRecursive(e)}optimizeSync(e,t){return this.clearHints(),this.optimizeSyncRecursive(e,t)}async optimizeRecursive(e){return e.type==="filter"?this.optimizeFilter(e):e.type==="join"?{type:"join",left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="leftjoin"?{...e,left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="union"?{type:"union",left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="minus"?{...e,left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="project"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="orderby"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="slice"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="distinct"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="reduced"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="group"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="extend"?{...e,input:await this.optimizeRecursive(e.input)}:e}optimizeSyncRecursive(e,t){return e.type==="filter"?this.optimizeFilterSync(e,t):e.type==="join"?{type:"join",left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="leftjoin"?{...e,left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="union"?{type:"union",left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="minus"?{...e,left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="project"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="orderby"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="slice"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="distinct"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="reduced"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="group"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="extend"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e}async optimizeFilter(e){let t=this.detectContainsUUIDPattern(e.expression);if(!t)return{type:"filter",expression:e.expression,input:await this.optimizeRecursive(e.input)};let r=[];return this.tripleStore&&(r=await this.findSubjectsContainingUUID(t.uuid)),this.rewriteFilter(e,t,r)}optimizeFilterSync(e,t){let r=this.detectContainsUUIDPattern(e.expression);if(!r)return{type:"filter",expression:e.expression,input:this.optimizeSyncRecursive(e.input,t)};let i=t?t.filter(s=>s.includes(r.uuid)):[];return this.rewriteFilter(e,r,i)}rewriteFilter(e,t,r){if(this.lastOptimizationHints.push({type:"uuid-index-lookup",originalPattern:`FILTER(CONTAINS(STR(?${t.variable}), "${t.uuid}"))`,suggestedRewrite:r.length===1?`VALUES ?${t.variable} { <${r[0]}> }`:r.length>1?`VALUES ?${t.variable} { ${r.map(i=>`<${i}>`).join(" ")} }`:"No matching URIs found for UUID",estimatedSpeedup:r.length>0?"O(n) \u2192 O(1)":"N/A",matchedUri:r.length===1?r[0]:void 0}),r.length===0)return{type:"filter",expression:e.expression,input:this.optimizeSyncRecursive(e.input)};if(r.length===1){let i=this.injectSubjectConstraint(e.input,t.variable,r[0]);if(i!==e.input)return i}return this.createValuesJoin(e,t,r)}detectContainsUUIDPattern(e){if(e.type==="function"||e.type==="functionCall"){let t=e;if((typeof t.function=="string"?t.function.toLowerCase():t.function?.value?.toLowerCase()??"")==="contains"&&t.args.length===2)return this.analyzeContainsArgs(t.args[0],t.args[1],e)}if(e.type==="logical"&&e.operator==="&&")for(let t of e.operands){let r=this.detectContainsUUIDPattern(t);if(r)return r}return null}analyzeContainsArgs(e,t,r){let i=null;if(e.type==="function"||e.type==="functionCall"){let s=e;if((typeof s.function=="string"?s.function.toLowerCase():s.function?.value?.toLowerCase()??"")==="str"&&s.args.length===1){let c=s.args[0];c.type==="variable"&&(i=c.name)}}if(!i&&e.type==="variable"&&(i=e.name),!i)return null;if(t.type==="literal"){let c=String(t.value).match(p4);if(c)return{variable:i,uuid:c[0].toLowerCase(),originalExpression:r}}return null}async findSubjectsContainingUUID(e){if(!this.tripleStore)return[];if(this.tripleStore.findSubjectsByUUID)return(await this.tripleStore.findSubjectsByUUID(e)).map(s=>s.value);let t=await this.tripleStore.subjects(),r=[];for(let i of t)i instanceof d4.IRI&&i.value.toLowerCase().includes(e.toLowerCase())&&r.push(i.value);return r}injectSubjectConstraint(e,t,r){if(e.type==="bgp"){let i=e.triples.map(a=>a.subject.type==="variable"&&a.subject.value===t?{...a,subject:{type:"iri",value:r}}:a);if(i.some((a,c)=>a.subject!==e.triples[c].subject))return{type:"bgp",triples:i}}if(e.type==="join"){let i=this.injectSubjectConstraint(e.left,t,r),s=this.injectSubjectConstraint(e.right,t,r);if(i!==e.left||s!==e.right)return{type:"join",left:i,right:s}}if(e.type==="filter"){let i=this.injectSubjectConstraint(e.input,t,r);if(i!==e.input)return{...e,input:i}}return e}createValuesJoin(e,t,r){return{type:"join",left:{type:"values",variables:[t.variable],bindings:r.map(a=>({[t.variable]:{type:"iri",value:a}}))},right:this.optimizeSyncRecursive(e.input)}}analyzeQuery(e){let t=[];return this.analyzeRecursive(e,t),t}analyzeRecursive(e,t){if(e.type==="filter"){let r=this.detectContainsUUIDPattern(e.expression);r&&t.push({type:"uuid-index-lookup",originalPattern:`FILTER(CONTAINS(STR(?${r.variable}), "${r.uuid}"))`,suggestedRewrite:`Use --optimize flag or rewrite as VALUES ?${r.variable} { <uri-containing-uuid> }`,estimatedSpeedup:"O(n) \u2192 O(1) with UUID index lookup"}),this.analyzeRecursive(e.input,t);return}e.type==="join"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="leftjoin"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="union"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="minus"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="project"?this.analyzeRecursive(e.input,t):e.type==="orderby"?this.analyzeRecursive(e.input,t):e.type==="slice"?this.analyzeRecursive(e.input,t):e.type==="distinct"?this.analyzeRecursive(e.input,t):e.type==="reduced"?this.analyzeRecursive(e.input,t):e.type==="group"?this.analyzeRecursive(e.input,t):e.type==="extend"&&this.analyzeRecursive(e.input,t)}};zl.FilterContainsOptimizer=Ig});var xw=y(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});Hl.AlgebraOptimizer=void 0;var m4=Og(),Dg=class{static{o(this,"AlgebraOptimizer")}constructor(){this.stats=new Map,this.tripleStore=null,this.filterContainsOptimizer=new m4.FilterContainsOptimizer}setTripleStore(e){this.tripleStore=e,this.filterContainsOptimizer.setTripleStore(e)}getOptimizationHints(){return this.filterContainsOptimizer.getLastOptimizationHints()}analyzeQuery(e){return this.filterContainsOptimizer.analyzeQuery(e)}optimize(e){let t=e;return t=this.eliminateEmptyBGPInFilterJoin(t),t=this.filterPushDown(t),t=this.joinReordering(t),t}async optimizeAsync(e){let t=e;return t=this.eliminateEmptyBGPInFilterJoin(t),this.tripleStore&&(t=await this.filterContainsOptimizer.optimize(t)),t=this.filterPushDown(t),t=this.joinReordering(t),t}optimizeWithSubjects(e,t){let r=e;return r=this.eliminateEmptyBGPInFilterJoin(r),r=this.filterContainsOptimizer.optimizeSync(r,t),r=this.filterPushDown(r),r=this.joinReordering(r),r}eliminateEmptyBGPInFilterJoin(e){if(e.type==="join"){if(e.left.type==="filter"){let t=e.left;if(t.input.type==="bgp"&&t.input.triples.length===0)return{type:"filter",expression:t.expression,input:this.eliminateEmptyBGPInFilterJoin(e.right)}}if(e.right.type==="filter"){let t=e.right;if(t.input.type==="bgp"&&t.input.triples.length===0)return{type:"filter",expression:t.expression,input:this.eliminateEmptyBGPInFilterJoin(e.left)}}return{type:"join",left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}}return e.type==="filter"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="leftjoin"?{...e,left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}:e.type==="union"?{...e,left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}:e.type==="minus"?{...e,left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}:e.type==="project"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="orderby"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="slice"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="distinct"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e}filterPushDown(e){return e.type==="filter"?this.pushDownFilter(e):e.type==="join"?{type:"join",left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="leftjoin"?{...e,left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="union"?{type:"union",left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="minus"?{...e,left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="project"?{...e,input:this.filterPushDown(e.input)}:e.type==="orderby"?{...e,input:this.filterPushDown(e.input)}:e.type==="slice"?{...e,input:this.filterPushDown(e.input)}:e.type==="distinct"?{...e,input:this.filterPushDown(e.input)}:e}pushDownFilter(e){let t=e.input;if(t.type==="join"){let r=this.getFilterVariables(e.expression),i=this.getOperationVariables(t.left),s=this.getOperationVariables(t.right),a=r.every(u=>i.has(u)),c=r.every(u=>s.has(u));return a&&!c?{type:"join",left:{type:"filter",expression:e.expression,input:this.filterPushDown(t.left)},right:this.filterPushDown(t.right)}:c&&!a?{type:"join",left:this.filterPushDown(t.left),right:{type:"filter",expression:e.expression,input:this.filterPushDown(t.right)}}:{type:"filter",expression:e.expression,input:{type:"join",left:this.filterPushDown(t.left),right:this.filterPushDown(t.right)}}}return t.type==="union"?{type:"union",left:{type:"filter",expression:e.expression,input:this.filterPushDown(t.left)},right:{type:"filter",expression:e.expression,input:this.filterPushDown(t.right)}}:{type:"filter",expression:e.expression,input:this.filterPushDown(t)}}getFilterVariables(e){let t=[];if(e.type==="variable")t.push(e.name);else if(e.type==="comparison")t.push(...this.getFilterVariables(e.left)),t.push(...this.getFilterVariables(e.right));else if(e.type==="logical")for(let r of e.operands)t.push(...this.getFilterVariables(r));else if(e.type==="function")for(let r of e.args)t.push(...this.getFilterVariables(r));return Array.from(new Set(t))}getOperationVariables(e){let t=new Set;if(e.type==="bgp")for(let r of e.triples)r.subject.type==="variable"&&t.add(r.subject.value),r.predicate.type==="variable"&&t.add(r.predicate.value),r.object.type==="variable"&&t.add(r.object.value);else if(e.type==="join"){let r=this.getOperationVariables(e.left),i=this.getOperationVariables(e.right);return new Set([...r,...i])}else{if(e.type==="filter")return this.getOperationVariables(e.input);if(e.type==="leftjoin"){let r=this.getOperationVariables(e.left),i=this.getOperationVariables(e.right);return new Set([...r,...i])}else if(e.type==="union"){let r=this.getOperationVariables(e.left),i=this.getOperationVariables(e.right);return new Set([...r,...i])}else{if(e.type==="minus")return this.getOperationVariables(e.left);if(e.type==="project")return new Set(e.variables)}}return t}joinReordering(e){return e.type==="join"?this.reorderJoin(e):e.type==="filter"?{...e,input:this.joinReordering(e.input)}:e.type==="leftjoin"?{...e,left:this.joinReordering(e.left),right:this.joinReordering(e.right)}:e.type==="union"?{...e,left:this.joinReordering(e.left),right:this.joinReordering(e.right)}:e.type==="minus"?{...e,left:this.joinReordering(e.left),right:this.joinReordering(e.right)}:e.type==="project"?{...e,input:this.joinReordering(e.input)}:e.type==="orderby"?{...e,input:this.joinReordering(e.input)}:e.type==="slice"?{...e,input:this.joinReordering(e.input)}:e.type==="distinct"?{...e,input:this.joinReordering(e.input)}:e}reorderJoin(e){let t=this.estimateCost(e.left);return this.estimateCost(e.right)<t?{type:"join",left:this.joinReordering(e.right),right:this.joinReordering(e.left)}:{type:"join",left:this.joinReordering(e.left),right:this.joinReordering(e.right)}}estimateCost(e){if(e.type==="bgp"){let t=e.triples.length*100;for(let r of e.triples)r.subject.type==="variable"&&(t+=10),r.predicate.type==="variable"&&(t+=20),r.object.type==="variable"&&(t+=10);return t}return e.type==="filter"?this.estimateCost(e.input)*.3:e.type==="join"?this.estimateCost(e.left)*this.estimateCost(e.right):e.type==="leftjoin"?this.estimateCost(e.left)+this.estimateCost(e.right)*.5:e.type==="union"?this.estimateCost(e.left)+this.estimateCost(e.right):e.type==="minus"?this.estimateCost(e.left)+this.estimateCost(e.right)*.3:100}setStatistics(e,t){this.stats.set(e,t)}getStatistics(e){return this.stats.get(e)}};Hl.AlgebraOptimizer=Dg});var Iw=y(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});Yl.AlgebraSerializer=void 0;var Pg=class{static{o(this,"AlgebraSerializer")}toString(e,t=0){let r="  ".repeat(t);switch(e.type){case"bgp":return`${r}BGP [
${e.triples.map(l=>`${r}  ${this.tripleToString(l)}`).join(`
`)}
${r}]`;case"filter":return`${r}Filter(
${r}  ${this.expressionToString(e.expression)}
${this.toString(e.input,t+1)}
${r})`;case"join":return`${r}Join(
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"leftjoin":let i=e.expression?` ${this.expressionToString(e.expression)}`:"";return`${r}LeftJoin(${i}
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"union":return`${r}Union(
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"minus":return`${r}Minus(
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"project":return`${r}Project [${e.variables.map(l=>`?${l}`).join(", ")}](
${this.toString(e.input,t+1)}
${r})`;case"orderby":let s=e.comparators.map(l=>`${this.expressionToString(l.expression)} ${l.descending?"DESC":"ASC"}`).join(", ");return`${r}OrderBy [${s}](
${this.toString(e.input,t+1)}
${r})`;case"slice":let a=[];return e.offset!==void 0&&a.push(`OFFSET ${e.offset}`),e.limit!==void 0&&a.push(`LIMIT ${e.limit}`),`${r}Slice [${a.join(", ")}](
${this.toString(e.input,t+1)}
${r})`;case"distinct":return`${r}Distinct(
${this.toString(e.input,t+1)}
${r})`;case"group":let c=e.variables.length>0?`[${e.variables.map(l=>`?${l}`).join(", ")}]`:"[]",u=e.aggregates.length>0?e.aggregates.map(l=>`?${l.variable} = ${l.expression.aggregation}(${l.expression.distinct?"DISTINCT ":""}${l.expression.expression?this.expressionToString(l.expression.expression):"*"})`).join(", "):"";return`${r}Group ${c}${u?` [${u}]`:""}(
${this.toString(e.input,t+1)}
${r})`;case"extend":return`${r}Extend (?${e.variable} = ${this.expressionToString(e.expression)})(
${this.toString(e.input,t+1)}
${r})`;case"subquery":return`${r}Subquery(
${this.toString(e.query,t+1)}
${r})`;default:return`${r}Unknown(${e.type})`}}tripleToString(e){return`${this.elementToString(e.subject)} ${this.predicateToString(e.predicate)} ${this.elementToString(e.object)}`}predicateToString(e){return this.isPropertyPath(e)?this.propertyPathToString(e):this.elementToString(e)}isPropertyPath(e){return e.type==="path"}propertyPathToString(e){let t=e.items.map(r=>r.type==="path"?`(${this.propertyPathToString(r)})`:`<${r.value}>`);switch(e.pathType){case"/":return t.join("/");case"|":return t.join("|");case"^":return`^${t[0]}`;case"+":return`${t[0]}+`;case"*":return`${t[0]}*`;case"?":return`${t[0]}?`}}elementToString(e){switch(e.type){case"variable":return`?${e.value}`;case"iri":return`<${e.value}>`;case"literal":let t=`"${e.value}"`;return e.language&&(t+=`@${e.language}`),e.datatype&&(t+=`^^<${e.datatype}>`),t;case"blank":return`_:${e.value}`;default:return String(e)}}expressionToString(e){switch(e.type){case"variable":return`?${e.name}`;case"literal":return typeof e.value=="string"?`"${e.value}"`:String(e.value);case"comparison":return`(${this.expressionToString(e.left)} ${e.operator} ${this.expressionToString(e.right)})`;case"logical":return e.operator==="!"?`!(${this.expressionToString(e.operands[0])})`:`(${e.operands.map(t=>this.expressionToString(t)).join(` ${e.operator} `)})`;case"arithmetic":return`(${this.expressionToString(e.left)} ${e.operator} ${this.expressionToString(e.right)})`;case"function":return`${e.function}(${e.args.map(t=>this.expressionToString(t)).join(", ")})`;case"exists":return`${e.negated?"NOT EXISTS":"EXISTS"} { ${this.toString(e.pattern,0)} }`;default:return"unknown"}}toJSON(e){return JSON.stringify(e,null,2)}};Yl.AlgebraSerializer=Pg});var yi=y(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0});Ql.SolutionMapping=void 0;var Ow=lt(),Dw=Ye(),Pw=Mt(),Fg=class n{static{o(this,"SolutionMapping")}constructor(e){this.bindings=e?new Map(e):new Map}get(e){return this.bindings.get(e)}set(e,t){this.bindings.set(e,t)}has(e){return this.bindings.has(e)}variables(){return Array.from(this.bindings.keys())}getBindings(){return new Map(this.bindings)}isCompatibleWith(e){for(let[t,r]of this.bindings.entries()){let i=e.get(t);if(i!==void 0&&!this.areEqual(r,i))return!1}return!0}merge(e){if(!this.isCompatibleWith(e))return null;let t=new n(this.bindings);for(let[r,i]of e.getBindings().entries())t.set(r,i);return t}clone(){return new n(this.bindings)}areEqual(e,t){return e instanceof Ow.Literal&&t instanceof Ow.Literal?e.equals(t):e instanceof Dw.IRI&&t instanceof Dw.IRI?e.value===t.value:e instanceof Pw.BlankNode&&t instanceof Pw.BlankNode?e.id===t.id:!1}toJSON(){let e={};for(let[t,r]of this.bindings.entries())e[t]=r.toString();return e}size(){return this.bindings.size}};Ql.SolutionMapping=Fg});var Rw=y(Pa=>{"use strict";Object.defineProperty(Pa,"__esModule",{value:!0});Pa.PropertyPathExecutor=Pa.PropertyPathExecutorError=void 0;var g4=yi(),Kl=Ye(),Fw=Mt(),ic=class extends Error{static{o(this,"PropertyPathExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="PropertyPathExecutorError"}};Pa.PropertyPathExecutorError=ic;var Rg=class{static{o(this,"PropertyPathExecutor")}constructor(e){this.tripleStore=e,this.MAX_DEPTH=100}async*execute(e,t,r){let i=await this.resolveElement(e),s=this.isVariable(r)?null:await this.resolveElement(r);for(let a of i){let c=await this.evaluatePath(a,t,s);for(let u of c){let l=new g4.SolutionMapping;this.isVariable(e)&&l.set(e.value,a),this.isVariable(r)&&l.set(r.value,u),yield l}}}async*executeWithBindings(e,t){if(!this.isPropertyPath(e.predicate))throw new ic("Predicate is not a property path");let r=this.instantiateElement(e.subject,t),i=this.instantiateElement(e.object,t);for await(let s of this.execute(r,e.predicate,i)){let a=t.merge(s);a!==null&&(yield a)}}async evaluatePath(e,t,r){switch(t.pathType){case"/":return this.evaluateSequencePath(e,t.items,r);case"|":return this.evaluateAlternativePath(e,t.items,r);case"^":return this.evaluateInversePath(e,t.items[0],r);case"+":return this.evaluateOneOrMorePath(e,t.items[0],r);case"*":return this.evaluateZeroOrMorePath(e,t.items[0],r);case"?":return this.evaluateZeroOrOnePath(e,t.items[0],r)}}async evaluateSequencePath(e,t,r){let i=new Set([e]);for(let s=0;s<t.length;s++){let a=t[s],c=s===t.length-1,u=new Set;for(let l of i){let h=await this.evaluatePathItem(l,a,c?r:null);for(let f of h)u.add(f)}if(i=u,i.size===0)break}return i}async evaluateAlternativePath(e,t,r){let i=new Set;for(let s of t){let a=await this.evaluatePathItem(e,s,r);for(let c of a)i.add(c)}return i}async evaluateInversePath(e,t,r){if(t.type==="iri"){let i=new Kl.IRI(t.value),s=await this.tripleStore.match(void 0,i,e),a=new Set;for(let c of s)(r===null||this.nodeInSet(c.subject,r))&&a.add(c.subject);return a}else return this.evaluatePath(e,this.invertPath(t),r)}async evaluateOneOrMorePath(e,t,r){let i=new Set,s=new Set,a=[{node:e,depth:0}];for(;a.length>0;){let{node:c,depth:u}=a.shift();if(u>=this.MAX_DEPTH)continue;let l=await this.evaluatePathItem(c,t,null);for(let h of l){let f=this.nodeToKey(h);(r===null||this.nodeInSet(h,r))&&s.add(h),i.has(f)||(i.add(f),a.push({node:h,depth:u+1}))}}return s}async evaluateZeroOrMorePath(e,t,r){let i=await this.evaluateOneOrMorePath(e,t,r);return(r===null||this.nodeInSet(e,r))&&i.add(e),i}async evaluateZeroOrOnePath(e,t,r){let i=new Set;(r===null||this.nodeInSet(e,r))&&i.add(e);let s=await this.evaluatePathItem(e,t,r);for(let a of s)i.add(a);return i}async evaluatePathItem(e,t,r){if(t.type==="iri"){let i=new Kl.IRI(t.value),s=await this.tripleStore.match(e,i,void 0),a=new Set;for(let c of s)(r===null||this.nodeInSet(c.object,r))&&a.add(c.object);return a}else return this.evaluatePath(e,t,r)}invertPath(e){switch(e.pathType){case"^":return e.items[0];case"/":return{type:"path",pathType:"/",items:[...e.items].reverse().map(r=>r.type==="iri"?{type:"path",pathType:"^",items:[r]}:this.invertPath(r))};case"|":return{type:"path",pathType:"|",items:e.items.map(r=>r.type==="iri"?{type:"path",pathType:"^",items:[r]}:this.invertPath(r))};case"+":case"*":case"?":let t=e.items[0].type==="iri"?{type:"path",pathType:"^",items:[e.items[0]]}:this.invertPath(e.items[0]);return{type:"path",pathType:e.pathType,items:[t]}}}async resolveElement(e){if(this.isVariable(e)){let r=new Set,i=await this.tripleStore.match(void 0,void 0,void 0);for(let s of i)r.add(s.subject),r.add(s.object);return r}let t=new Set;switch(e.type){case"iri":t.add(new Kl.IRI(e.value));break;case"blank":t.add(new Fw.BlankNode(e.value));break;default:throw new ic(`Unsupported element type in subject/object position: ${e.type}`)}return t}instantiateElement(e,t){if(this.isVariable(e)){let r=t.get(e.value);if(r){if(r instanceof Kl.IRI)return{type:"iri",value:r.value};if(r instanceof Fw.BlankNode)return{type:"blank",value:r.id}}}return e}isVariable(e){return e.type==="variable"}isPropertyPath(e){return e.type==="path"}nodeToKey(e){return e.toString()}nodeInSet(e,t){let r=this.nodeToKey(e);for(let i of t)if(this.nodeToKey(i)===r)return!0;return!1}};Pa.PropertyPathExecutor=Rg});var kg=y(Fa=>{"use strict";Object.defineProperty(Fa,"__esModule",{value:!0});Fa.BGPExecutor=Fa.BGPExecutorError=void 0;var Xl=yi(),Bi=Ye(),Ng=lt(),Jl=Mt(),Zl=Lo(),y4=Rw(),Xt=class extends Error{static{o(this,"BGPExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="BGPExecutorError"}};Fa.BGPExecutorError=Xt;var Lg=class{static{o(this,"BGPExecutor")}constructor(e){this.tripleStore=e,this.propertyPathExecutor=new y4.PropertyPathExecutor(e)}async*execute(e){if(e.triples.length===0){yield new Xl.SolutionMapping;return}let t=this.matchTriplePattern(e.triples[0]);for(let r=1;r<e.triples.length;r++)t=this.joinWithPattern(t,e.triples[r]);for await(let r of t)yield r}async executeAll(e){let t=[];for await(let r of this.execute(e))t.push(r);return t}async*executeInGraph(e,t){if(e.triples.length===0){yield new Xl.SolutionMapping;return}let r=this.matchTriplePatternInGraph(e.triples[0],t);for(let i=1;i<e.triples.length;i++)r=this.joinWithPatternInGraph(r,e.triples[i],t);for await(let i of r)yield i}async*matchTriplePatternInGraph(e,t){if(this.isPropertyPath(e.predicate))throw new Xt("Property paths within named graphs are not yet supported");let r=e.predicate,i=this.isVariable(e.subject)?void 0:this.toRDFTermAsSubject(e.subject),s=this.isVariable(r)?void 0:this.toRDFTermAsPredicate(r),a=this.isVariable(e.object)?void 0:this.toRDFTerm(e.object);if(!this.tripleStore.matchInGraph)throw new Xt("Triple store does not support named graph operations");let c=await this.tripleStore.matchInGraph(i,s,a,t);for(let u of c){let l=new Xl.SolutionMapping;this.isVariable(e.subject)&&l.set(e.subject.value,u.subject),this.isVariable(r)&&l.set(r.value,u.predicate),this.isVariable(e.object)&&l.set(e.object.value,u.object),yield l}}async*joinWithPatternInGraph(e,t,r){let i=[];for await(let s of e)i.push(s);for(let s of i){let a=this.instantiatePattern(t,s);for await(let c of this.matchTriplePatternInGraph(a,r)){let u=s.merge(c);u!==null&&(yield u)}}}async*matchTriplePattern(e){if(this.isPropertyPath(e.predicate)){yield*this.propertyPathExecutor.execute(e.subject,e.predicate,e.object);return}let t=e.predicate,r=this.isVariable(e.subject)||this.isQuotedTriple(e.subject)&&this.hasVariablesInQuotedTriple(e.subject)?void 0:this.toRDFTermAsSubject(e.subject),i=this.isVariable(t)?void 0:this.toRDFTermAsPredicate(t),s=this.isVariable(e.object)||this.isQuotedTriple(e.object)&&this.hasVariablesInQuotedTriple(e.object)?void 0:this.toRDFTerm(e.object),a=await this.tripleStore.match(r,i,s);for(let c of a){let u=new Xl.SolutionMapping;if(this.isVariable(e.subject))u.set(e.subject.value,c.subject);else if(this.isQuotedTriple(e.subject)){let l=this.matchQuotedTriplePattern(e.subject,c.subject);if(l===null)continue;for(let[h,f]of l.entries())u.set(h,f)}if(this.isVariable(t)&&u.set(t.value,c.predicate),this.isVariable(e.object))u.set(e.object.value,c.object);else if(this.isQuotedTriple(e.object)){let l=this.matchQuotedTriplePattern(e.object,c.object);if(l===null)continue;for(let[h,f]of l.entries())u.set(h,f)}yield u}}hasVariablesInQuotedTriple(e){return!!(this.isVariable(e.subject)||e.predicate.type==="variable"||this.isVariable(e.object)||this.isQuotedTriple(e.subject)&&this.hasVariablesInQuotedTriple(e.subject)||this.isQuotedTriple(e.object)&&this.hasVariablesInQuotedTriple(e.object))}matchQuotedTriplePattern(e,t){if(!(t instanceof Zl.QuotedTriple))return null;let r=new Map;if(this.isVariable(e.subject))r.set(e.subject.value,t.subject);else if(this.isQuotedTriple(e.subject)){let i=this.matchQuotedTriplePattern(e.subject,t.subject);if(i===null)return null;for(let[s,a]of i)r.set(s,a)}else if(!this.elementsMatch(e.subject,t.subject))return null;if(e.predicate.type==="variable")r.set(e.predicate.value,t.predicate);else if(e.predicate.value!==t.predicate.value)return null;if(this.isVariable(e.object))r.set(e.object.value,t.object);else if(this.isQuotedTriple(e.object)){let i=this.matchQuotedTriplePattern(e.object,t.object);if(i===null)return null;for(let[s,a]of i)r.set(s,a)}else if(!this.elementsMatch(e.object,t.object))return null;return r}elementsMatch(e,t){switch(e.type){case"iri":return t instanceof Bi.IRI&&e.value===t.value;case"literal":return!(!(t instanceof Ng.Literal)||e.value!==t.value||e.datatype!==t.datatype?.value||e.language!==t.language||e.direction!==t.direction);case"blank":return t instanceof Jl.BlankNode&&e.value===t.id;case"quoted":return t instanceof Zl.QuotedTriple?this.toRDFQuotedTriple(e).equals(t):!1;default:return!1}}isPropertyPath(e){return e.type==="path"}async*joinWithPattern(e,t){let r=[];for await(let i of e)r.push(i);for(let i of r){let s=this.instantiatePattern(t,i);for await(let a of this.matchTriplePattern(s)){let c=i.merge(a);c!==null&&(yield c)}}}instantiatePattern(e,t){let r=this.isPropertyPath(e.predicate)?e.predicate:this.instantiateElement(e.predicate,t);return{subject:this.instantiateElement(e.subject,t),predicate:r,object:this.instantiateElement(e.object,t)}}instantiateElement(e,t){if(this.isVariable(e)){let r=t.get(e.value);if(r)return this.toAlgebraElement(r)}return this.isQuotedTriple(e)?this.instantiateQuotedTriple(e,t):e}instantiateQuotedTriple(e,t){let r=this.instantiateElement(e.subject,t),i=e.predicate.type==="variable"?this.instantiatePredicateVariable(e.predicate,t):e.predicate,s=this.instantiateElement(e.object,t);return{type:"quoted",subject:r,predicate:i,object:s}}instantiatePredicateVariable(e,t){let r=t.get(e.value);return r&&r instanceof Bi.IRI?{type:"iri",value:r.value}:e}isVariable(e){return e.type==="variable"}isQuotedTriple(e){return e.type==="quoted"}toRDFTermAsSubject(e){switch(e.type){case"iri":return new Bi.IRI(e.value);case"blank":return new Jl.BlankNode(e.value);case"literal":throw new Xt("Literals cannot appear in subject position");case"variable":throw new Xt(`Cannot convert variable to RDF term: ${e.value}`);case"quoted":return this.toRDFQuotedTriple(e);default:throw new Xt(`Unknown element type: ${e.type}`)}}toRDFQuotedTriple(e){let t=this.toRDFTermAsSubject(e.subject),r=e.predicate.type==="iri"?new Bi.IRI(e.predicate.value):(()=>{throw new Xt("Quoted triple predicate must be IRI")})(),i=this.toRDFTerm(e.object);return new Zl.QuotedTriple(t,r,i)}toRDFTermAsPredicate(e){switch(e.type){case"iri":return new Bi.IRI(e.value);case"literal":throw new Xt("Literals cannot appear in predicate position");case"blank":throw new Xt("Blank nodes cannot appear in predicate position");case"variable":throw new Xt(`Cannot convert variable to RDF term: ${e.value}`);default:throw new Xt(`Unknown element type: ${e.type}`)}}toRDFTerm(e){switch(e.type){case"iri":return new Bi.IRI(e.value);case"literal":return new Ng.Literal(e.value,e.datatype?new Bi.IRI(e.datatype):void 0,e.language,e.direction);case"blank":return new Jl.BlankNode(e.value);case"variable":throw new Xt(`Cannot convert variable to RDF term: ${e.value}`);case"quoted":return this.toRDFQuotedTriple(e);default:throw new Xt(`Unknown element type: ${e.type}`)}}toAlgebraElement(e){if(e instanceof Bi.IRI)return{type:"iri",value:e.value};if(e instanceof Ng.Literal)return{type:"literal",value:e.value,datatype:e.datatype?.value,language:e.language,direction:e.direction};if(e instanceof Jl.BlankNode)return{type:"blank",value:e.id};if(e instanceof Zl.QuotedTriple)return this.toAlgebraQuotedTriple(e);throw new Xt(`Unknown RDF term type: ${e.constructor?.name||"unknown"}`)}toAlgebraQuotedTriple(e){return{type:"quoted",subject:this.toAlgebraElement(e.subject),predicate:{type:"iri",value:e.predicate.value},object:this.toAlgebraElement(e.object)}}};Fa.BGPExecutor=Lg});var Mg=y(eh=>{"use strict";Object.defineProperty(eh,"__esModule",{value:!0});eh.BuiltInFunctions=void 0;var fe=Ye(),P=lt(),fr=Mt(),Ra=Lo(),jg=Fr(),sc=class{static{o(this,"BuiltInFunctions")}static str(e){if(e===void 0)throw new Error("STR: argument is undefined");return e instanceof fe.IRI||e instanceof P.Literal?e.value:e instanceof fr.BlankNode?e.id:String(e)}static lang(e){if(e===void 0)throw new Error("LANG: argument is undefined");return e instanceof P.Literal&&e.language?e.language:""}static langdir(e){if(e===void 0)throw new Error("LANGDIR: argument is undefined");return!(e instanceof P.Literal)||!e.language?"":e.direction?`${e.language}--${e.direction}`:e.language}static langMatches(e,t){let[r,i]=this.parseDirectionalLangTag(e),[s,a]=this.parseDirectionalLangTag(t),c=r.toLowerCase(),u=s.toLowerCase();return u==="*"?c!=="":c===""?u==="":a&&i!==a?!1:c===u?!0:c.startsWith(u+"-")}static parseDirectionalLangTag(e){let t=e.indexOf("--");if(t===-1)return[e,void 0];let r=e.substring(0,t),i=e.substring(t+2).toLowerCase();return[r,i]}static datatype(e){if(e===void 0)throw new Error("DATATYPE: argument is undefined");if(e instanceof P.Literal)return e.datatype?e.datatype:e.language?new fe.IRI("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"):new fe.IRI("http://www.w3.org/2001/XMLSchema#string");throw new Error("DATATYPE: argument must be a literal")}static bound(e){return e!==void 0}static isIRI(e){return e===void 0?!1:e instanceof fe.IRI}static isBlank(e){return e===void 0?!1:e instanceof fr.BlankNode}static isLiteral(e){return e===void 0?!1:e instanceof P.Literal}static isTriple(e){return e===void 0?!1:e instanceof Ra.QuotedTriple}static hasLangdir(e){return e===void 0||!(e instanceof P.Literal)?!1:!!e.language&&!!e.direction}static isNumeric(e){if(e===void 0||!(e instanceof P.Literal))return!1;let t=e.datatype?.value;return t?["http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#byte","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#unsignedByte","http://www.w3.org/2001/XMLSchema#positiveInteger"].includes(t):!1}static regex(e,t,r){try{return new RegExp(t,r).test(e)}catch(i){throw new Error(`REGEX: invalid pattern '${t}': ${i.message}`)}}static compare(e,t,r){if(this.isDayTimeDurationValue(e)&&this.isDayTimeDurationValue(t))return this.compareDurations(e instanceof P.Literal?e:String(e),t instanceof P.Literal?t:String(t),r);let i=this.toComparableValue(e),s=this.toComparableValue(t);switch(r){case"=":return i===s;case"!=":return i!==s;case"<":return i<s;case">":return i>s;case"<=":return i<=s;case">=":return i>=s;default:throw new Error(`Unknown comparison operator: ${r}`)}}static isDayTimeDurationValue(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#dayTimeDuration":!1}static toComparableValue(e){if(typeof e=="string"||typeof e=="number")return e;if(e instanceof P.Literal){let t=e.datatype?.value;if(t?.includes("#integer")||t?.includes("#decimal")||t?.includes("#double")){let r=parseFloat(e.value);if(!isNaN(r))return r}if(t==="http://www.w3.org/2001/XMLSchema#dayTimeDuration")try{return this.parseDayTimeDuration(e.value)}catch{return e.value}return e.value}return e instanceof fe.IRI?e.value:e instanceof fr.BlankNode?e.id:String(e)}static contains(e,t){return e.includes(t)}static strStarts(e,t){return e.startsWith(t)}static strEnds(e,t){return e.endsWith(t)}static strlen(e){return e.length}static ucase(e){return e.toUpperCase()}static lcase(e){return e.toLowerCase()}static substr(e,t,r){let i=t-1;if(i<0){if(r!==void 0){let s=r+i;return s<=0?"":e.substring(0,s)}return e}return r!==void 0?e.substring(i,i+r):e.substring(i)}static strBefore(e,t){if(t==="")return"";let r=e.indexOf(t);return r===-1?"":e.substring(0,r)}static strAfter(e,t){if(t==="")return e;let r=e.indexOf(t);return r===-1?"":e.substring(r+t.length)}static concat(...e){return e.join("")}static replace(e,t,r,i){try{let s=new RegExp(t,i||"g");return e.replace(s,r)}catch(s){throw new Error(`REPLACE: invalid pattern '${t}': ${s.message}`)}}static parseDate(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`PARSEDATE: invalid date string '${e}'`);return t.getTime()}static dateBefore(e,t){let r=this.parseDate(e),i=this.parseDate(t);return r<i}static dateAfter(e,t){let r=this.parseDate(e),i=this.parseDate(t);return r>i}static dateInRange(e,t,r){let i=this.parseDate(e),s=this.parseDate(t),a=this.parseDate(r);return i>=s&&i<=a}static dateDiffMinutes(e,t){let r=this.parseDate(e),i=this.parseDate(t),s=Math.abs(i-r);return Math.round(s/(1e3*60))}static dateDiffHours(e,t){let r=this.parseDate(e),i=this.parseDate(t),s=Math.abs(i-r);return Math.round(s/(1e3*60*60)*100)/100}static logicalAnd(e){return e.every(t=>t===!0)}static logicalOr(e){return e.some(t=>t===!0)}static logicalNot(e){return!e}static year(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`YEAR: invalid date string '${e}'`);return t.getFullYear()}static month(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`MONTH: invalid date string '${e}'`);return t.getMonth()+1}static day(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`DAY: invalid date string '${e}'`);return t.getDate()}static hours(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`HOURS: invalid date string '${e}'`);return t.getHours()}static minutes(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`MINUTES: invalid date string '${e}'`);return t.getMinutes()}static seconds(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`SECONDS: invalid date string '${e}'`);return t.getSeconds()+t.getMilliseconds()/1e3}static timezone(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`TIMEZONE: invalid date string '${e}'`);let r;if(e.endsWith("Z"))r="PT0S";else{let i=e.match(/([+-]\d{2}):?(\d{2})$/);if(i){let s=parseInt(i[1],10),a=parseInt(i[2],10),c=s>=0?"":"-",u=Math.abs(s);a===0?r=`${c}PT${u}H`:r=`${c}PT${u}H${a}M`}else{let s=-t.getTimezoneOffset(),a=Math.floor(Math.abs(s)/60),c=Math.abs(s)%60,u=s>=0?"":"-";c===0?r=`${u}PT${a}H`:r=`${u}PT${a}H${c}M`}}return new P.Literal(r,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static tz(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`TZ: invalid date string '${e}'`);if(e.endsWith("Z"))return"Z";let r=e.match(/([+-]\d{2}:\d{2})$/);if(r)return r[1];let i=e.match(/([+-])(\d{2})(\d{2})$/);return i?`${i[1]}${i[2]}:${i[3]}`:""}static now(){return new Date().toISOString()}static msToMinutes(e){return Math.round(e/(1e3*60))}static msToHours(e){return Math.round(e/(1e3*60*60)*100)/100}static msToSeconds(e){return Math.round(e/1e3)}static abs(e){return Math.abs(e)}static round(e){return Math.round(e)}static ceil(e){return Math.ceil(e)}static floor(e){return Math.floor(e)}static rand(){return Math.random()}static coalesce(e){for(let t of e)if(t!=null)return t}static if(e,t,r){return e?t:r}static xsdDateTime(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`xsd:dateTime: invalid date string '${e}'`);return new P.Literal(t.toISOString(),new fe.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static xsdInteger(e){let t=parseInt(e,10);if(isNaN(t))throw new Error(`xsd:integer: cannot convert '${e}' to integer`);return new P.Literal(String(t),new fe.IRI("http://www.w3.org/2001/XMLSchema#integer"))}static xsdDecimal(e){let t=parseFloat(e);if(isNaN(t))throw new Error(`xsd:decimal: cannot convert '${e}' to decimal`);return new P.Literal(String(t),new fe.IRI("http://www.w3.org/2001/XMLSchema#decimal"))}static encodeForUri(e){return encodeURIComponent(e)}static md5(e){return require("crypto").createHash("md5").update(e).digest("hex")}static sha1(e){return require("crypto").createHash("sha1").update(e).digest("hex")}static sha256(e){return require("crypto").createHash("sha256").update(e).digest("hex")}static sha384(e){return require("crypto").createHash("sha384").update(e).digest("hex")}static sha512(e){return require("crypto").createHash("sha512").update(e).digest("hex")}static sameTerm(e,t){if(e===void 0&&t===void 0)return!0;if(e===void 0||t===void 0||e.constructor!==t.constructor)return!1;if(e instanceof fe.IRI&&t instanceof fe.IRI)return e.value===t.value;if(e instanceof fr.BlankNode&&t instanceof fr.BlankNode)return e.id===t.id;if(e instanceof P.Literal&&t instanceof P.Literal){if(e.value!==t.value||e.language!==t.language)return!1;let r=e.datatype?.value,i=t.datatype?.value;return r===i}return!1}static iri(e){if(e===void 0)throw new Error("IRI: argument is undefined");if(e instanceof fe.IRI)return e;if(e instanceof P.Literal)return new fe.IRI(e.value);throw e instanceof fr.BlankNode?new Error("IRI: cannot convert blank node to IRI"):new Error("IRI: unsupported term type")}static uri(e){return this.iri(e)}static bnode(e){if(e===void 0){let t=`b${(0,jg.v4)().replace(/-/g,"").substring(0,12)}`;return new fr.BlankNode(t)}if(e instanceof P.Literal)return new fr.BlankNode(e.value);if(e instanceof fr.BlankNode)return e;throw new Error("BNODE: argument must be a string literal or omitted")}static strdt(e,t){if(e===void 0)throw new Error("STRDT: lexical form is undefined");if(t===void 0)throw new Error("STRDT: datatype IRI is undefined");let r;if(e instanceof P.Literal){if(e.language)throw new Error("STRDT: lexical form must not have a language tag");r=e.value}else if(typeof e=="string")r=e;else throw new Error("STRDT: lexical form must be a string literal");let i;if(t instanceof fe.IRI)i=t;else if(t instanceof P.Literal)i=new fe.IRI(t.value);else throw new Error("STRDT: datatype must be an IRI");return new P.Literal(r,i)}static strlang(e,t){if(e===void 0)throw new Error("STRLANG: lexical form is undefined");if(t===void 0)throw new Error("STRLANG: language tag is undefined");let r;if(e instanceof P.Literal){if(e.language)throw new Error("STRLANG: lexical form must not already have a language tag");r=e.value}else if(typeof e=="string")r=e;else throw new Error("STRLANG: lexical form must be a string literal");let i;if(t instanceof P.Literal)i=t.value;else if(typeof t=="string")i=t;else throw new Error("STRLANG: language tag must be a string literal");if(i==="")throw new Error("STRLANG: language tag cannot be empty");return new P.Literal(r,void 0,i)}static strlangdir(e,t,r){if(e===void 0)throw new Error("STRLANGDIR: lexical form is undefined");if(t===void 0)throw new Error("STRLANGDIR: language tag is undefined");if(r===void 0)throw new Error("STRLANGDIR: direction is undefined");let i;if(e instanceof P.Literal){if(e.language)throw new Error("STRLANGDIR: lexical form must not already have a language tag");i=e.value}else if(typeof e=="string")i=e;else throw new Error("STRLANGDIR: lexical form must be a string literal");let s;if(t instanceof P.Literal)s=t.value;else if(typeof t=="string")s=t;else throw new Error("STRLANGDIR: language tag must be a string literal");if(s==="")throw new Error("STRLANGDIR: language tag cannot be empty");let a;if(r instanceof P.Literal)a=r.value.toLowerCase();else throw new Error("STRLANGDIR: direction must be a string literal");if(a!=="ltr"&&a!=="rtl")throw new Error(`STRLANGDIR: invalid direction '${a}'. Must be 'ltr' or 'rtl'`);return new P.Literal(i,void 0,s,a)}static uuid(){let e=(0,jg.v4)();return new fe.IRI(`urn:uuid:${e}`)}static struuid(){let e=(0,jg.v4)();return new P.Literal(e)}static parseDayTimeDuration(e){if(!e)throw new Error("parseDayTimeDuration: duration string is empty");let t=!1,r=e.trim();if(r.startsWith("-")&&(t=!0,r=r.substring(1)),!r.startsWith("P"))throw new Error(`parseDayTimeDuration: invalid format, must start with 'P': '${e}'`);r=r.substring(1);let i=0,s=r.indexOf("T"),a="",c="";if(s===-1?a=r:(a=r.substring(0,s),c=r.substring(s+1)),a){let u=a.match(/^(\d+(?:\.\d+)?)D$/);if(u){let l=parseFloat(u[1]);i+=l*24*60*60*1e3}else if(a!=="")throw new Error(`parseDayTimeDuration: invalid day component: '${a}' in '${e}'`)}if(c){let u=c,l=u.match(/^(\d+(?:\.\d+)?)H/);if(l){let d=parseFloat(l[1]);i+=d*60*60*1e3,u=u.substring(l[0].length)}let h=u.match(/^(\d+(?:\.\d+)?)M/);if(h){let d=parseFloat(h[1]);i+=d*60*1e3,u=u.substring(h[0].length)}let f=u.match(/^(\d+(?:\.\d+)?)S$/);if(f){let d=parseFloat(f[1]);i+=d*1e3,u=u.substring(f[0].length)}if(u!=="")throw new Error(`parseDayTimeDuration: invalid time component: '${u}' in '${e}'`)}return t?-i:i}static formatDayTimeDuration(e){let t=e<0,r=Math.abs(e),i=Math.floor(r/(1440*60*1e3));r=r%(1440*60*1e3);let s=Math.floor(r/(3600*1e3));r=r%(3600*1e3);let a=Math.floor(r/(60*1e3));r=r%(60*1e3);let c=r/1e3,u=t?"-P":"P";return i>0&&(u+=`${i}D`),(s>0||a>0||c>0||i===0)&&(u+="T",s>0&&(u+=`${s}H`),a>0&&(u+=`${a}M`),(c>0||s===0&&a===0)&&(Number.isInteger(c)?u+=`${c}S`:u+=`${parseFloat(c.toFixed(3))}S`)),u}static xsdDayTimeDuration(e){return this.parseDayTimeDuration(e),new P.Literal(e,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static compareDurations(e,t,r){let i=e instanceof P.Literal?e.value:e,s=t instanceof P.Literal?t.value:t,a=this.parseDayTimeDuration(i),c=this.parseDayTimeDuration(s);switch(r){case"=":return a===c;case"!=":return a!==c;case"<":return a<c;case">":return a>c;case"<=":return a<=c;case">=":return a>=c;default:throw new Error(`compareDurations: unknown operator: ${r}`)}}static isDayTimeDuration(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#dayTimeDuration":!1}static isDate(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#date":!1}static dateDiff(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r),a=this.parseXSDDate(i);if(s===null)throw new Error(`dateDiff: invalid first date: '${r}'`);if(a===null)throw new Error(`dateDiff: invalid second date: '${i}'`);let c=s.getTime()-a.getTime(),u=Math.round(c/(1440*60*1e3)),l=this.formatDateDuration(u);return new P.Literal(l,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static parseXSDDate(e){let t=/^(-?\d{4})-(\d{2})-(\d{2})(Z|[+-]\d{2}:\d{2})?$/,r=e.match(t);if(!r){let l=new Date(e);return isNaN(l.getTime())?null:new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()))}let i=parseInt(r[1],10),s=parseInt(r[2],10)-1,a=parseInt(r[3],10),c=r[4],u=new Date(Date.UTC(i,s,a));if(c&&c!=="Z"){let l=c.match(/([+-])(\d{2}):(\d{2})/);if(l){let h=l[1]==="+"?1:-1,f=parseInt(l[2],10),d=parseInt(l[3],10),m=h*(f*60+d)*60*1e3;u=new Date(u.getTime()-m)}}return u}static formatDateDuration(e){if(e===0)return"P0D";let t=e<0,r=Math.abs(e);return t?`-P${r}D`:`P${r}D`}static dateTimeDiff(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r),a=new Date(i);if(isNaN(s.getTime()))throw new Error(`dateTimeDiff: invalid first dateTime: '${r}'`);if(isNaN(a.getTime()))throw new Error(`dateTimeDiff: invalid second dateTime: '${i}'`);let c=s.getTime()-a.getTime(),u=this.formatDayTimeDuration(c);return new P.Literal(u,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static dateTimeAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeAdd: invalid dateTime: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()+a,u=new Date(c);return new P.Literal(u.toISOString(),new fe.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateTimeSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeSubtract: invalid dateTime: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()-a,u=new Date(c);return new P.Literal(u.toISOString(),new fe.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateAdd: invalid date: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()+a,u=new Date(c),l=u.getUTCFullYear(),h=String(u.getUTCMonth()+1).padStart(2,"0"),f=String(u.getUTCDate()).padStart(2,"0"),d=`${l}-${h}-${f}`;return new P.Literal(d,new fe.IRI("http://www.w3.org/2001/XMLSchema#date"))}static dateSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateSubtract: invalid date: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()-a,u=new Date(c),l=u.getUTCFullYear(),h=String(u.getUTCMonth()+1).padStart(2,"0"),f=String(u.getUTCDate()).padStart(2,"0"),d=`${l}-${h}-${f}`;return new P.Literal(d,new fe.IRI("http://www.w3.org/2001/XMLSchema#date"))}static parseYearMonthDuration(e){let t=/^(-)?P(?:(\d+)Y)?(?:(\d+)M)?$/,r=e.match(t);if(!r)throw new Error(`parseYearMonthDuration: invalid format: '${e}'`);let i=r[1]==="-",s=parseInt(r[2]||"0",10),a=parseInt(r[3]||"0",10);if(!r[2]&&!r[3])throw new Error(`parseYearMonthDuration: invalid format (no duration components): '${e}'`);let c=s*12+a;return i?-c:c}static isYearMonthDuration(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#yearMonthDuration":!1}static dateTimeAddYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeAddYearMonth: invalid dateTime: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();return s.setUTCMonth(s.getUTCMonth()+a),s.getUTCDate()!==c&&s.setUTCDate(0),new P.Literal(s.toISOString(),new fe.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateTimeSubtractYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeSubtractYearMonth: invalid dateTime: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();return s.setUTCMonth(s.getUTCMonth()-a),s.getUTCDate()!==c&&s.setUTCDate(0),new P.Literal(s.toISOString(),new fe.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateAddYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateAddYearMonth: invalid date: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();s.setUTCMonth(s.getUTCMonth()+a),s.getUTCDate()!==c&&s.setUTCDate(0);let u=s.getUTCFullYear(),l=String(s.getUTCMonth()+1).padStart(2,"0"),h=String(s.getUTCDate()).padStart(2,"0"),f=`${u}-${l}-${h}`;return new P.Literal(f,new fe.IRI("http://www.w3.org/2001/XMLSchema#date"))}static dateSubtractYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateSubtractYearMonth: invalid date: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();s.setUTCMonth(s.getUTCMonth()-a),s.getUTCDate()!==c&&s.setUTCDate(0);let u=s.getUTCFullYear(),l=String(s.getUTCMonth()+1).padStart(2,"0"),h=String(s.getUTCDate()).padStart(2,"0"),f=`${u}-${l}-${h}`;return new P.Literal(f,new fe.IRI("http://www.w3.org/2001/XMLSchema#date"))}static durationAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseDayTimeDuration(r),a=this.parseDayTimeDuration(i),c=this.formatDayTimeDuration(s+a);return new P.Literal(c,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static durationSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseDayTimeDuration(r),a=this.parseDayTimeDuration(i),c=this.formatDayTimeDuration(s-a);return new P.Literal(c,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static durationMultiply(e,t){let r=e instanceof P.Literal?e.value:e,i=this.parseDayTimeDuration(r),s=this.formatDayTimeDuration(i*t);return new P.Literal(s,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static durationDivide(e,t){if(t===0)throw new Error("durationDivide: division by zero");let r=e instanceof P.Literal?e.value:e,i=this.parseDayTimeDuration(r),s=this.formatDayTimeDuration(i/t);return new P.Literal(s,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static formatYearMonthDuration(e){let t=e<0,r=Math.abs(e),i=Math.floor(r/12),s=r%12,a=t?"-P":"P";return i>0&&(a+=`${i}Y`),(s>0||i===0)&&(a+=`${s}M`),a}static yearMonthDurationAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseYearMonthDuration(r),a=this.parseYearMonthDuration(i),c=this.formatYearMonthDuration(s+a);return new P.Literal(c,new fe.IRI("http://www.w3.org/2001/XMLSchema#yearMonthDuration"))}static yearMonthDurationSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseYearMonthDuration(r),a=this.parseYearMonthDuration(i),c=this.formatYearMonthDuration(s-a);return new P.Literal(c,new fe.IRI("http://www.w3.org/2001/XMLSchema#yearMonthDuration"))}static parseYearMonthDurationComponents(e){let t=/^(-)?P(?:(\d+)Y)?(?:(\d+)M)?$/,r=e.match(t);if(!r)throw new Error(`parseYearMonthDurationComponents: invalid format: '${e}'`);let i=r[1]==="-",s=parseInt(r[2]||"0",10),a=parseInt(r[3]||"0",10);if(!r[2]&&!r[3])throw new Error(`parseYearMonthDurationComponents: invalid format (no duration components): '${e}'`);return{years:s,months:a,negative:i}}static durationYears(e){let t=e instanceof P.Literal?e.value:e,r=this.parseYearMonthDurationComponents(t);return r.negative?-r.years:r.years}static durationMonths(e){let t=e instanceof P.Literal?e.value:e,r=this.parseYearMonthDurationComponents(t);return r.negative?-r.months:r.months}static durationToDays(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/(1440*60*1e3)}static durationToHours(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/(3600*1e3)}static durationToMinutes(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/(60*1e3)}static durationToSeconds(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/1e3}static parseDurationComponents(e){if(!e)throw new Error("parseDurationComponents: duration string is empty");let t=!1,r=e.trim();if(r.startsWith("-")&&(t=!0,r=r.substring(1)),!r.startsWith("P"))throw new Error(`parseDurationComponents: invalid format, must start with 'P': '${e}'`);r=r.substring(1);let i=0,s=0,a=0,c=0,u=r.indexOf("T"),l="",h="";if(u===-1?l=r:(l=r.substring(0,u),h=r.substring(u+1)),l){let f=l.match(/^(\d+(?:\.\d+)?)D$/);if(f)i=parseFloat(f[1]);else if(l!=="")throw new Error(`parseDurationComponents: invalid day component: '${l}' in '${e}'`)}if(h){let f=h,d=f.match(/^(\d+(?:\.\d+)?)H/);d&&(s=parseFloat(d[1]),f=f.substring(d[0].length));let m=f.match(/^(\d+(?:\.\d+)?)M/);m&&(a=parseFloat(m[1]),f=f.substring(m[0].length));let _=f.match(/^(\d+(?:\.\d+)?)S$/);if(_&&(c=parseFloat(_[1]),f=f.substring(_[0].length)),f!=="")throw new Error(`parseDurationComponents: invalid time component: '${f}' in '${e}'`)}return{negative:t,days:i,hours:s,minutes:a,seconds:c}}static durationDays(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t),i=Math.floor(r.days);return r.negative?-i:i}static durationHours(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t),i=Math.floor(r.hours);return r.negative?-i:i}static durationMinutes(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t),i=Math.floor(r.minutes);return r.negative?-i:i}static durationSeconds(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t);return r.negative?-r.seconds:r.seconds}static adjust(e,t){let r=e instanceof P.Literal?e.value:e,i=new Date(r);if(isNaN(i.getTime()))throw new Error(`ADJUST: invalid dateTime: '${r}'`);if(t==null){let Fe=i.getUTCFullYear(),et=String(i.getUTCMonth()+1).padStart(2,"0"),ct=String(i.getUTCDate()).padStart(2,"0"),U=String(i.getUTCHours()).padStart(2,"0"),ue=String(i.getUTCMinutes()).padStart(2,"0"),Se=String(i.getUTCSeconds()).padStart(2,"0"),Ke=i.getUTCMilliseconds(),Ge=`${Fe}-${et}-${ct}T${U}:${ue}:${Se}`;return Ke>0&&(Ge+=`.${String(Ke).padStart(3,"0")}`),new P.Literal(Ge,new fe.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}let s=t instanceof P.Literal?t.value:t,a=this.parseDayTimeDuration(s),c=840*60*1e3;if(Math.abs(a)>c)throw new Error(`ADJUST: timezone offset out of range: '${s}'`);let u=i.getTime(),l=new Date(u+a),h=l.getUTCFullYear(),f=String(l.getUTCMonth()+1).padStart(2,"0"),d=String(l.getUTCDate()).padStart(2,"0"),m=String(l.getUTCHours()).padStart(2,"0"),_=String(l.getUTCMinutes()).padStart(2,"0"),S=String(l.getUTCSeconds()).padStart(2,"0"),A=l.getUTCMilliseconds(),I=a>=0?"+":"-",D=Math.floor(Math.abs(a)/(3600*1e3)),L=Math.floor(Math.abs(a)%(3600*1e3)/(60*1e3)),G=`${I}${String(D).padStart(2,"0")}:${String(L).padStart(2,"0")}`,W=`${h}-${f}-${d}T${m}:${_}:${S}`;return A>0&&(W+=`.${String(A).padStart(3,"0")}`),W+=G,new P.Literal(W,new fe.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static normalize(e,t){if(e===void 0)throw new Error("NORMALIZE: string argument is undefined");let r;if(e instanceof P.Literal)r=e.value;else if(e instanceof fe.IRI)r=e.value;else if(e instanceof fr.BlankNode)r=e.id;else if(typeof e=="string")r=e;else throw new Error("NORMALIZE: first argument must be a string or literal");let i="NFC";if(t!==void 0)if(t instanceof P.Literal)i=t.value.toUpperCase();else if(typeof t=="string")i=t.toUpperCase();else if(t instanceof fe.IRI)i=t.value.toUpperCase();else throw new Error("NORMALIZE: second argument must be a string literal");if(!this.VALID_NORMALIZATION_FORMS.includes(i))throw new Error(`NORMALIZE: invalid normalization form '${i}'. Valid forms are: NFC, NFD, NFKC, NFKD`);let s=r.normalize(i);return new P.Literal(s,new fe.IRI("http://www.w3.org/2001/XMLSchema#string"))}static fold(e){if(e===void 0)throw new Error("FOLD: string argument is undefined");let t;if(e instanceof P.Literal)t=e.value;else if(e instanceof fe.IRI)t=e.value;else if(e instanceof fr.BlankNode)t=e.id;else if(typeof e=="string")t=e;else throw new Error("FOLD: argument must be a string or literal");let r=this.unicodeCaseFold(t);return new P.Literal(r,new fe.IRI("http://www.w3.org/2001/XMLSchema#string"))}static unicodeCaseFold(e){let t="";for(let r of e){let i=this.CASE_FOLDING_MAP.get(r);i!==void 0?t+=i:t+=r.toLowerCase()}return t}static isTime(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#time":!1}static timeDiff(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDTime(r),a=this.parseXSDTime(i);if(s===null)throw new Error(`timeDiff: invalid first time: '${r}'`);if(a===null)throw new Error(`timeDiff: invalid second time: '${i}'`);let c=s-a,u=this.formatDayTimeDuration(c);return new P.Literal(u,new fe.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static parseXSDTime(e){let t=/^(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(Z|[+-]\d{2}:\d{2})?$/,r=e.match(t);if(!r)return null;let i=parseInt(r[1],10),s=parseInt(r[2],10),a=parseInt(r[3],10),c=r[4],u=r[5];if(i<0||i>24||s<0||s>59||a<0||a>59||i===24&&(s!==0||a!==0))return null;let l=0;if(c){let f=c.padEnd(3,"0").slice(0,3);l=parseInt(f,10)}let h=i*60*60*1e3+s*60*1e3+a*1e3+l;if(i===24&&(h=1440*60*1e3),u&&u!=="Z"){let f=u.match(/([+-])(\d{2}):(\d{2})/);if(f){let d=f[1]==="+"?1:-1,m=parseInt(f[2],10),_=parseInt(f[3],10),S=d*(m*60+_)*60*1e3;h-=S}}return h}static triple(e,t,r){if(e===void 0)throw new Error("TRIPLE: subject is undefined");if(t===void 0)throw new Error("TRIPLE: predicate is undefined");if(r===void 0)throw new Error("TRIPLE: object is undefined");if(e instanceof P.Literal)throw new Error("TRIPLE: subject must be IRI, BlankNode, or QuotedTriple, got Literal");if(!(t instanceof fe.IRI)){let c=t instanceof P.Literal?"Literal":t instanceof fr.BlankNode?"BlankNode":t instanceof Ra.QuotedTriple?"QuotedTriple":typeof t;throw new Error(`TRIPLE: predicate must be IRI, got ${c}`)}let i=e,s=t,a=r;return new Ra.QuotedTriple(i,s,a)}static subject(e){if(e===void 0)throw new Error("SUBJECT: argument is undefined");if(!(e instanceof Ra.QuotedTriple)){let t=e instanceof fe.IRI?"IRI":e instanceof P.Literal?"Literal":e instanceof fr.BlankNode?"BlankNode":typeof e;throw new Error(`SUBJECT: argument must be QuotedTriple, got ${t}`)}return e.subject}static predicate(e){if(e===void 0)throw new Error("PREDICATE: argument is undefined");if(!(e instanceof Ra.QuotedTriple)){let t=e instanceof fe.IRI?"IRI":e instanceof P.Literal?"Literal":e instanceof fr.BlankNode?"BlankNode":typeof e;throw new Error(`PREDICATE: argument must be QuotedTriple, got ${t}`)}return e.predicate}static object(e){if(e===void 0)throw new Error("OBJECT: argument is undefined");if(!(e instanceof Ra.QuotedTriple)){let t=e instanceof fe.IRI?"IRI":e instanceof P.Literal?"Literal":e instanceof fr.BlankNode?"BlankNode":typeof e;throw new Error(`OBJECT: argument must be QuotedTriple, got ${t}`)}return e.object}};eh.BuiltInFunctions=sc;sc.VALID_NORMALIZATION_FORMS=["NFC","NFD","NFKC","NFKD"];sc.CASE_FOLDING_MAP=new Map([["\xDF","ss"],["\u1E9E","ss"],["\u03A3","\u03C3"],["\u03C2","\u03C3"],["\u0130","i\u0307"],["I","i"],["\u0587","\u0565\u0582"],["\uFB00","ff"],["\uFB01","fi"],["\uFB02","fl"],["\uFB03","ffi"],["\uFB04","ffl"],["\uFB05","st"],["\uFB06","st"],["\u0390","\u03B9\u0308\u0301"],["\u03B0","\u03C5\u0308\u0301"],["\u017F","s"],["\u1E9B","\u1E61"],["\u212A","k"],["\u212B","\xE5"]])});var th=y(Na=>{"use strict";Object.defineProperty(Na,"__esModule",{value:!0});Na.FilterExecutor=Na.FilterExecutorError=void 0;var F=Mg(),js=lt(),Bt=class extends Error{static{o(this,"FilterExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="FilterExecutorError"}};Na.FilterExecutorError=Bt;var Vg=class{static{o(this,"FilterExecutor")}constructor(){this.existsEvaluator=null,this.tripleStore=null,this.uuidCache=new Map}setExistsEvaluator(e){this.existsEvaluator=e}setTripleStore(e){this.tripleStore=e,this.uuidCache.clear()}async*execute(e,t){let r=this.expressionContainsExists(e.expression);for await(let i of t)try{let s;r?s=await this.evaluateExpressionAsync(e.expression,i):s=this.evaluateExpression(e.expression,i),s===!0&&(yield i)}catch{continue}}expressionContainsExists(e){if(e.type==="exists")return!0;if(e.type==="logical")return e.operands.some(t=>this.expressionContainsExists(t));if(e.type==="comparison")return this.expressionContainsExists(e.left)||this.expressionContainsExists(e.right);if(e.type==="in"){let t=e;return this.expressionContainsExists(t.expression)||t.list.some(r=>this.expressionContainsExists(r))}return!1}async executeAll(e,t){let r=[];async function*i(){for(let s of t)yield s}o(i,"generator");for await(let s of this.execute(e,i()))r.push(s);return r}evaluateExpression(e,t){let r=e;if(r.termType)switch(r.termType){case"Variable":return t.get(r.value);case"Literal":return r.value;case"NamedNode":return r.value;default:throw new Bt(`Unsupported termType: ${r.termType}`)}switch(e.type){case"comparison":return this.evaluateComparison(e,t);case"logical":return this.evaluateLogical(e,t);case"arithmetic":return this.evaluateArithmetic(e,t);case"function":case"functionCall":return this.evaluateFunction(e,t);case"variable":return t.get(e.name);case"literal":return e.value;case"in":return this.evaluateIn(e,t);case"exists":throw new Bt("EXISTS expressions require async evaluation. Use evaluateExpressionAsync instead.");default:throw new Bt(`Unsupported expression type: ${e.type}, expr.termType=${r.termType}`)}}async evaluateExpressionAsync(e,t){return e.type==="exists"?this.evaluateExists(e,t):e.type==="logical"?this.evaluateLogicalAsync(e,t):this.evaluateExpression(e,t)}async evaluateExists(e,t){if(!this.existsEvaluator)throw new Bt("EXISTS evaluator not set. Call setExistsEvaluator before evaluating EXISTS expressions.");let r=await this.existsEvaluator(e.pattern,t);return e.negated?!r:r}async evaluateLogicalAsync(e,t){if(e.operator==="!"){let i=await this.evaluateExpressionAsync(e.operands[0],t);return F.BuiltInFunctions.logicalNot(i)}let r=[];for(let i of e.operands){let s=await this.evaluateExpressionAsync(i,t);r.push(s)}if(e.operator==="&&")return F.BuiltInFunctions.logicalAnd(r);if(e.operator==="||")return F.BuiltInFunctions.logicalOr(r);throw new Bt(`Unknown logical operator: ${e.operator}`)}evaluateComparison(e,t){let r=this.evaluateExpression(e.left,t),i=this.evaluateExpression(e.right,t);return F.BuiltInFunctions.compare(r,i,e.operator)}evaluateLogical(e,t){if(e.operator==="!"){let i=this.evaluateExpression(e.operands[0],t);return F.BuiltInFunctions.logicalNot(i)}let r=e.operands.map(i=>this.evaluateExpression(i,t));if(e.operator==="&&")return F.BuiltInFunctions.logicalAnd(r);if(e.operator==="||")return F.BuiltInFunctions.logicalOr(r);throw new Bt(`Unknown logical operator: ${e.operator}`)}evaluateIn(e,t){let r=this.evaluateExpression(e.expression,t),i=e.list.some(s=>{let a=this.evaluateExpression(s,t);return F.BuiltInFunctions.compare(r,a,"=")});return e.negated?!i:i}evaluateArithmetic(e,t){let r=this.evaluateExpression(e.left,t),i=this.evaluateExpression(e.right,t);if(e.operator==="-"&&this.isDateValue(r)&&this.isDateValue(i))return F.BuiltInFunctions.dateDiff(r,i);if(e.operator==="-"&&this.isTimeValue(r)&&this.isTimeValue(i))return F.BuiltInFunctions.timeDiff(r,i);if(e.operator==="-"&&this.isDateTimeValue(r)&&this.isDateTimeValue(i))return F.BuiltInFunctions.dateTimeDiff(r,i);if(e.operator==="+"&&this.isDateValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateAdd(r,i);if(e.operator==="-"&&this.isDateValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateSubtract(r,i);if(e.operator==="+"&&this.isDateValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateAddYearMonth(r,i);if(e.operator==="-"&&this.isDateValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateSubtractYearMonth(r,i);if(e.operator==="+"&&this.isDateTimeValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateTimeAdd(r,i);if(e.operator==="-"&&this.isDateTimeValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateTimeSubtract(r,i);if(e.operator==="+"&&this.isDateTimeValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateTimeAddYearMonth(r,i);if(e.operator==="-"&&this.isDateTimeValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateTimeSubtractYearMonth(r,i);if(e.operator==="+"&&this.isDayTimeDurationValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.durationAdd(r,i);if(e.operator==="-"&&this.isDayTimeDurationValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.durationSubtract(r,i);if(e.operator==="*"&&this.isDayTimeDurationValue(r)&&!this.isDayTimeDurationValue(i)){let c=this.toNumericValue(i);return F.BuiltInFunctions.durationMultiply(r,c)}if(e.operator==="*"&&!this.isDayTimeDurationValue(r)&&this.isDayTimeDurationValue(i)){let c=this.toNumericValue(r);return F.BuiltInFunctions.durationMultiply(i,c)}if(e.operator==="/"&&this.isDayTimeDurationValue(r)&&!this.isDayTimeDurationValue(i)){let c=this.toNumericValue(i);if(c===0)throw new Bt("Division by zero");return F.BuiltInFunctions.durationDivide(r,c)}if(e.operator==="+"&&this.isYearMonthDurationValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.yearMonthDurationAdd(r,i);if(e.operator==="-"&&this.isYearMonthDurationValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.yearMonthDurationSubtract(r,i);let s=this.toNumericValue(r),a=this.toNumericValue(i);switch(e.operator){case"+":return s+a;case"-":return s-a;case"*":return s*a;case"/":if(a===0)throw new Bt("Division by zero");return s/a;default:throw new Bt(`Unknown arithmetic operator: ${e.operator}`)}}isDayTimeDurationValue(e){return e instanceof js.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#dayTimeDuration":!1}isYearMonthDurationValue(e){return e instanceof js.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#yearMonthDuration":!1}toNumericValue(e){if(typeof e=="number")return e;if(e instanceof js.Literal){let t=e.datatype?.value||"";if(t.includes("#integer")||t.includes("#decimal")||t.includes("#double")||t.includes("#float")){let i=parseFloat(e.value);if(!isNaN(i))return i}let r=parseFloat(e.value);if(!isNaN(r))return r}if(typeof e=="string"){let t=parseFloat(e);if(!isNaN(t))return t}if(e&&typeof e=="object"&&"value"in e){let t=parseFloat(String(e.value));if(!isNaN(t))return t}throw new Bt(`Cannot convert to number: ${e}`)}isDateTimeValue(e){if(e instanceof js.Literal){let t=e.datatype?.value||"";return t.includes("#dateTime")||t.includes("#date")?!0:/^\d{4}-\d{2}-\d{2}(T|\s)/.test(e.value)}return typeof e=="string"?/^\d{4}-\d{2}-\d{2}(T|\s)/.test(e):!1}isDateValue(e){return e instanceof js.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#date":!1}isTimeValue(e){return e instanceof js.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#time":!1}evaluateFunction(e,t){let r;if(typeof e.function=="string")r=e.function.toLowerCase();else if(e.function&&typeof e.function=="object"&&"value"in e.function){let i=e.function.value;r=((i.includes("#")?i.split("#").pop():i.split("/").pop())||i).toLowerCase()}else throw new Bt(`Unknown function format: ${e.function}`);switch(r){case"str":let i=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.str(i);case"lang":let s=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.lang(s);case"datatype":let a=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.datatype(a).value;case"bound":if(e.args[0].type==="variable"){let w=t.get(e.args[0].name);return F.BuiltInFunctions.bound(w)}return!0;case"isiri":case"isuri":let c=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isIRI(c);case"isblank":let u=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isBlank(u);case"isliteral":let l=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isLiteral(l);case"regex":let h=this.getStringValue(this.evaluateExpression(e.args[0],t)),f=this.getStringValue(this.evaluateExpression(e.args[1],t)),d=e.args[2]?this.getStringValue(this.evaluateExpression(e.args[2],t)):void 0;return F.BuiltInFunctions.regex(h,f,d);case"langmatches":let m=this.getStringValue(this.evaluateExpression(e.args[0],t)),_=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.langMatches(m,_);case"contains":let S=this.getStringValue(this.evaluateExpression(e.args[0],t)),A=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.contains(S,A);case"strstarts":let I=this.getStringValue(this.evaluateExpression(e.args[0],t)),D=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strStarts(I,D);case"strends":let L=this.getStringValue(this.evaluateExpression(e.args[0],t)),G=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strEnds(L,G);case"strlen":let W=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.strlen(W);case"ucase":let Fe=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.ucase(Fe);case"lcase":let et=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.lcase(et);case"substr":let ct=this.getStringValue(this.evaluateExpression(e.args[0],t)),U=Number(this.evaluateExpression(e.args[1],t));if(e.args[2]){let w=Number(this.evaluateExpression(e.args[2],t));return F.BuiltInFunctions.substr(ct,U,w)}return F.BuiltInFunctions.substr(ct,U);case"strbefore":let ue=this.getStringValue(this.evaluateExpression(e.args[0],t)),Se=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strBefore(ue,Se);case"strafter":let Ke=this.getStringValue(this.evaluateExpression(e.args[0],t)),Ge=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strAfter(Ke,Ge);case"concat":let tt=e.args.map(w=>this.getStringValue(this.evaluateExpression(w,t)));return F.BuiltInFunctions.concat(...tt);case"replace":let ke=this.getStringValue(this.evaluateExpression(e.args[0],t)),je=this.getStringValue(this.evaluateExpression(e.args[1],t)),Re=this.getStringValue(this.evaluateExpression(e.args[2],t)),H=e.args[3]?this.getStringValue(this.evaluateExpression(e.args[3],t)):void 0;return F.BuiltInFunctions.replace(ke,je,Re,H);case"parsedate":let k=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.parseDate(k);case"datebefore":let Me=this.getStringValue(this.evaluateExpression(e.args[0],t)),We=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateBefore(Me,We);case"dateafter":let V=this.getStringValue(this.evaluateExpression(e.args[0],t)),de=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateAfter(V,de);case"dateinrange":let Ce=this.getStringValue(this.evaluateExpression(e.args[0],t)),z=this.getStringValue(this.evaluateExpression(e.args[1],t)),xe=this.getStringValue(this.evaluateExpression(e.args[2],t));return F.BuiltInFunctions.dateInRange(Ce,z,xe);case"datediffminutes":let Ie=this.getStringValue(this.evaluateExpression(e.args[0],t)),be=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateDiffMinutes(Ie,be);case"datediffhours":let Oe=this.getStringValue(this.evaluateExpression(e.args[0],t)),le=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateDiffHours(Oe,le);case"year":case"years":{let w=this.evaluateExpression(e.args[0],t);return this.isYearMonthDurationValue(w)?F.BuiltInFunctions.durationYears(w):F.BuiltInFunctions.year(this.getStringValue(w))}case"month":case"months":{let w=this.evaluateExpression(e.args[0],t);return this.isYearMonthDurationValue(w)?F.BuiltInFunctions.durationMonths(w):F.BuiltInFunctions.month(this.getStringValue(w))}case"day":case"days":{let w=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(w)?F.BuiltInFunctions.durationDays(w):F.BuiltInFunctions.day(this.getStringValue(w))}case"hours":{let w=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(w)?F.BuiltInFunctions.durationHours(w):F.BuiltInFunctions.hours(this.getStringValue(w))}case"minutes":{let w=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(w)?F.BuiltInFunctions.durationMinutes(w):F.BuiltInFunctions.minutes(this.getStringValue(w))}case"seconds":{let w=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(w)?F.BuiltInFunctions.durationSeconds(w):F.BuiltInFunctions.seconds(this.getStringValue(w))}case"timezone":let Ee=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.timezone(Ee);case"tz":let pe=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.tz(pe);case"adjust":{let w=this.evaluateExpression(e.args[0],t),x=e.args.length>1?this.evaluateExpression(e.args[1],t):void 0;return F.BuiltInFunctions.adjust(w,x)}case"now":return F.BuiltInFunctions.now();case"datetime":case"xsd:datetime":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdDateTime(this.getStringValue(w))}case"integer":case"xsd:integer":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdInteger(this.getStringValue(w))}case"decimal":case"xsd:decimal":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdDecimal(this.getStringValue(w))}case"daytimeduration":case"xsd:daytimeduration":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdDayTimeDuration(this.getStringValue(w))}case"durationtodays":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToDays(w)}case"durationtohours":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToHours(w)}case"durationtominutes":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToMinutes(w)}case"durationtoseconds":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToSeconds(w)}case"durationdays":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationDays(w)}case"durationhours":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationHours(w)}case"durationminutes":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationMinutes(w)}case"durationseconds":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationSeconds(w)}case"durationyears":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationYears(w)}case"durationmonths":{let w=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationMonths(w)}case"datetimediff":{let w=this.evaluateExpression(e.args[0],t),x=this.evaluateExpression(e.args[1],t);return F.BuiltInFunctions.dateTimeDiff(w,x)}case"datetimeadd":{let w=this.evaluateExpression(e.args[0],t),x=this.evaluateExpression(e.args[1],t);return F.BuiltInFunctions.dateTimeAdd(w,x)}case"datetimesubtract":{let w=this.evaluateExpression(e.args[0],t),x=this.evaluateExpression(e.args[1],t);return F.BuiltInFunctions.dateTimeSubtract(w,x)}case"mstominutes":let Te=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.msToMinutes(Te);case"mstohours":let De=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.msToHours(De);case"mstoseconds":let X=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.msToSeconds(X);case"abs":let re=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.abs(re);case"round":let ne=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.round(ne);case"ceil":let J=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.ceil(J);case"floor":let Z=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.floor(Z);case"rand":return F.BuiltInFunctions.rand();case"coalesce":for(let w of e.args)try{let x=this.evaluateExpression(w,t);if(x!=null)return x}catch{continue}return;case"if":if(!e.args||e.args.length!==3)throw new Bt("IF requires exactly 3 arguments");let ee=this.evaluateExpression(e.args[0],t);return this.toBoolean(ee)?this.evaluateExpression(e.args[1],t):this.evaluateExpression(e.args[2],t);case"encode_for_uri":let ie=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.encodeForUri(ie);case"isnumeric":let se=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isNumeric(se);case"haslangdir":let ae=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.hasLangdir(ae);case"istriple":let oe=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isTriple(oe);case"sameterm":let Q=this.getTermFromExpression(e.args[0],t),ce=this.getTermFromExpression(e.args[1],t);return F.BuiltInFunctions.sameTerm(Q,ce);case"md5":let Ne=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.md5(Ne);case"sha1":let Pe=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha1(Pe);case"sha256":let we=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha256(we);case"sha384":let b=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha384(b);case"sha512":let E=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha512(E);case"byuuid":return this.evaluateByUUID(e,t);case"subject":{let w=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.subject(w)}case"predicate":{let w=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.predicate(w)}case"object":{let w=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.object(w)}case"triple":{let w=this.getTermFromExpression(e.args[0],t),x=this.getTermFromExpression(e.args[1],t),B=this.getTermFromExpression(e.args[2],t);return F.BuiltInFunctions.triple(w,x,B)}default:throw new Bt(`Unknown function: ${r}`)}}getTermFromExpression(e,t){if(e.type==="variable")return t.get(e.name)}getStringValue(e){return e==null?"":typeof e=="object"&&"value"in e?String(e.value):String(e)}toBoolean(e){if(typeof e=="boolean")return e;if(typeof e=="number")return!isNaN(e)&&e!==0;if(typeof e=="string")return e.length>0;if(e instanceof js.Literal){let t=e.datatype?.value||"";if(t.includes("#boolean"))return e.value==="true"||e.value==="1";if(t.includes("#integer")||t.includes("#decimal")||t.includes("#double")||t.includes("#float")){let r=parseFloat(e.value);return!isNaN(r)&&r!==0}return e.value.length>0}return!!e}evaluateByUUID(e,t){if(!e.args||e.args.length!==1)throw new Bt("exo:byUUID requires exactly 1 argument (UUID string)");let r=this.evaluateExpression(e.args[0],t),i=this.getStringValue(r);if(!i)return;let s=i.toLowerCase();if(this.uuidCache.has(s))return this.uuidCache.get(s)??void 0;if(!this.tripleStore){this.uuidCache.set(s,null);return}if(this.tripleStore.findSubjectsByUUIDSync){let a=this.tripleStore.findSubjectsByUUIDSync(s);if(a.length===0){this.uuidCache.set(s,null);return}let c=a[0];return this.uuidCache.set(s,c),c}this.uuidCache.set(s,null)}cacheUUIDResult(e,t){let r=e.toLowerCase();this.uuidCache.set(r,t)}getCachedUUID(e){let t=e.toLowerCase();if(this.uuidCache.has(t))return this.uuidCache.get(t)}};Na.FilterExecutor=Vg});var Ug=y(rh=>{"use strict";Object.defineProperty(rh,"__esModule",{value:!0});rh.OptionalExecutor=void 0;var $g=class{static{o(this,"OptionalExecutor")}async*execute(e,t){let r=[];for await(let s of e)r.push(s);let i=[];for await(let s of t)i.push(s);for(let s of r){let a=!1;for(let c of i){let u=s.merge(c);u!==null&&(yield u,a=!0)}a||(yield s)}}async executeAll(e,t){let r=[];async function*i(){for(let a of e)yield a}o(i,"generateLeft");async function*s(){for(let a of t)yield a}o(s,"generateRight");for await(let a of this.execute(i(),s()))r.push(a);return r}};rh.OptionalExecutor=$g});var qg=y(nh=>{"use strict";Object.defineProperty(nh,"__esModule",{value:!0});nh.UnionExecutor=void 0;var Bg=class{static{o(this,"UnionExecutor")}async*execute(e,t){let r=new Set;for await(let i of e){let s=this.getSolutionKey(i);r.has(s)||(r.add(s),yield i)}for await(let i of t){let s=this.getSolutionKey(i);r.has(s)||(r.add(s),yield i)}}async executeAll(e,t){let r=[];async function*i(){for(let a of e)yield a}o(i,"generateLeft");async function*s(){for(let a of t)yield a}o(s,"generateRight");for await(let a of this.execute(i(),s()))r.push(a);return r}getSolutionKey(e){let t=e.toJSON();return Object.keys(t).sort().map(i=>`${i}=${t[i]}`).join("|")}};nh.UnionExecutor=Bg});var Hg=y(ih=>{"use strict";Object.defineProperty(ih,"__esModule",{value:!0});ih.ConstructExecutor=void 0;var v4=Oi(),Ms=Ye(),Gg=lt(),Wg=Mt(),w4=Lo(),zg=class{static{o(this,"ConstructExecutor")}async execute(e,t){let r=[],i=new Set;for(let s of t)for(let a of e)try{let c=this.instantiateTriple(a,s),u=`${c.subject.toString()}|${c.predicate.toString()}|${c.object.toString()}`;i.has(u)||(i.add(u),r.push(c))}catch{continue}return r}instantiateTriple(e,t){if(this.isPropertyPath(e.predicate))throw new Error("Property paths are not supported in CONSTRUCT templates");let r=this.instantiateElement(e.subject,t),i=this.instantiateElement(e.predicate,t),s=this.instantiateElement(e.object,t);return new v4.Triple(r,i,s)}isPropertyPath(e){return e.type==="path"}instantiateElement(e,t){if(e.type==="variable"){let r=t.get(e.value);if(!r)throw new Error(`Unbound variable: ${e.value}`);return r}if(e.type==="iri")return new Ms.IRI(e.value);if(e.type==="literal")return new Gg.Literal(e.value,e.datatype?new Ms.IRI(e.datatype):void 0,e.language);if(e.type==="blank")return new Wg.BlankNode(e.value);if(e.type==="quoted")return this.instantiateQuotedTriple(e,t);throw new Error(`Unknown element type: ${e.type}`)}instantiateQuotedTriple(e,t){let r=this.instantiateQuotedSubject(e.subject,t),i=this.instantiateQuotedPredicate(e.predicate,t),s=this.instantiateQuotedObject(e.object,t);return new w4.QuotedTriple(r,i,s)}instantiateQuotedSubject(e,t){if(e.type==="variable"){let r=t.get(e.value);if(!r)throw new Error(`Unbound variable in quoted triple subject: ${e.value}`);if(r instanceof Gg.Literal)throw new Error("Literals cannot appear in quoted triple subject position");return r}if(e.type==="iri")return new Ms.IRI(e.value);if(e.type==="blank")return new Wg.BlankNode(e.value);if(e.type==="quoted")return this.instantiateQuotedTriple(e,t);throw new Error(`Invalid element type for quoted triple subject: ${e.type}`)}instantiateQuotedPredicate(e,t){if(e.type==="variable"){let r=t.get(e.value);if(!r)throw new Error(`Unbound variable in quoted triple predicate: ${e.value}`);if(!(r instanceof Ms.IRI))throw new Error("Quoted triple predicate must be an IRI");return r}return new Ms.IRI(e.value)}instantiateQuotedObject(e,t){if(e.type==="variable"){let i=t.get(e.value);if(!i)throw new Error(`Unbound variable in quoted triple object: ${e.value}`);return i}if(e.type==="iri")return new Ms.IRI(e.value);if(e.type==="blank")return new Wg.BlankNode(e.value);if(e.type==="literal")return new Gg.Literal(e.value,e.datatype?new Ms.IRI(e.datatype):void 0,e.language);if(e.type==="quoted")return this.instantiateQuotedTriple(e,t);let r=e;throw new Error(`Invalid element type for quoted triple object: ${r.type}`)}};ih.ConstructExecutor=zg});var Lw=y(sh=>{"use strict";Object.defineProperty(sh,"__esModule",{value:!0});sh.DescribeExecutor=void 0;var Nw=Ye(),Yg=class{static{o(this,"DescribeExecutor")}constructor(e){this.tripleStore=e}async execute(e,t){let r=[],i=new Set,s=new Set,a=t?.depth;for(let c of e)await this.describeResourceWithDepth(c,a,1,t?.symmetric??!0,r,i,s);return r}async describeResourceWithDepth(e,t,r,i,s,a,c){let u=e.toString();if(c.has(u)||(c.add(u),t!==void 0&&r>t))return;let l=[],h=await this.tripleStore.match(e,void 0,void 0);if(l.push(...h),i){let d=await this.tripleStore.match(void 0,void 0,e);l.push(...d)}let f=[];for(let d of l){let m=`${d.subject.toString()}|${d.predicate.toString()}|${d.object.toString()}`;a.has(m)||(a.add(m),s.push(d),(t===void 0||r<t)&&(this.isIRI(d.subject)&&d.subject.toString()!==u&&f.push(d.subject),this.isIRI(d.object)&&d.object.toString()!==u&&f.push(d.object)))}for(let d of f)await this.describeResourceWithDepth(d,t,r+1,i,s,a,c)}isIRI(e){return e?e instanceof Nw.IRI||e.termType==="NamedNode"||typeof e.value=="string"&&e.value.startsWith("http"):!1}async describeByIRI(e,t){let r=new Nw.IRI(e);return this.execute([r],t)}};sh.DescribeExecutor=Yg});var kw=y(ah=>{"use strict";Object.defineProperty(ah,"__esModule",{value:!0});ah.MinusExecutor=void 0;var Qg=class{static{o(this,"MinusExecutor")}async*execute(e,t){let r=[];for await(let s of e)r.push(s);let i=[];for await(let s of t)i.push(s);for(let s of r){let a=!1;for(let c of i)if(this.areCompatible(s,c)){a=!0;break}a||(yield s)}}async executeAll(e,t){let r=[];async function*i(){for(let a of e)yield a}o(i,"generateLeft");async function*s(){for(let a of t)yield a}o(s,"generateRight");for await(let a of this.execute(i(),s()))r.push(a);return r}areCompatible(e,t){let r=e.variables(),i=new Set(t.variables()),s=r.filter(a=>i.has(a));if(s.length===0)return!1;for(let a of s){let c=e.get(a),u=t.get(a);if(c===void 0||u===void 0||c.toString()!==u.toString())return!1}return!0}};ah.MinusExecutor=Qg});var Mw=y(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.ValuesExecutor=La.ValuesExecutorError=void 0;var _4=yi(),jw=Ye(),S4=lt(),oh=class extends Error{static{o(this,"ValuesExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="ValuesExecutorError"}};La.ValuesExecutorError=oh;var Kg=class{static{o(this,"ValuesExecutor")}async*execute(e){if(e.bindings.length!==0)for(let t of e.bindings)yield this.createSolutionMapping(t)}async executeAll(e){let t=[];for await(let r of this.execute(e))t.push(r);return t}createSolutionMapping(e){let t=new _4.SolutionMapping;for(let[r,i]of Object.entries(e)){let s=this.toRDFTerm(i);t.set(r,s)}return t}toRDFTerm(e){if(e.type==="iri")return new jw.IRI(e.value);if(e.type==="literal")return new S4.Literal(e.value,e.datatype?new jw.IRI(e.datatype):void 0,e.language,e.direction);throw new oh(`Unknown term type: ${e.type}`)}};La.ValuesExecutor=Kg});var Xg=y(ja=>{"use strict";Object.defineProperty(ja,"__esModule",{value:!0});ja.CustomAggregateRegistry=ja.CustomAggregateError=void 0;var ka=class extends Error{static{o(this,"CustomAggregateError")}constructor(e,t){super(e),this.iri=t,this.name="CustomAggregateError"}};ja.CustomAggregateError=ka;var ch=class n{static{o(this,"CustomAggregateRegistry")}constructor(){this.aggregates=new Map}static getInstance(){return n.instance||(n.instance=new n),n.instance}static resetInstance(){n.instance&&n.instance.clear(),n.instance=null}register(e,t){if(!e||typeof e!="string")throw new ka("Aggregate IRI must be a non-empty string");if(!t||typeof t.init!="function"||typeof t.step!="function"||typeof t.finalize!="function")throw new ka("Aggregate must implement init(), step(), and finalize() methods",e);if(this.aggregates.has(e))throw new ka(`Aggregate with IRI "${e}" is already registered`,e);this.aggregates.set(e,t)}unregister(e){return this.aggregates.delete(e)}get(e){return this.aggregates.get(e)}has(e){return this.aggregates.has(e)}getRegisteredIris(){return Array.from(this.aggregates.keys())}clear(){this.aggregates.clear()}get size(){return this.aggregates.size}};ja.CustomAggregateRegistry=ch;ch.instance=null});var Jg=y(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.BUILT_IN_AGGREGATES=Le.modeAggregate=Le.stddevAggregate=Le.varianceAggregate=Le.medianAggregate=Le.EXO_AGGREGATE_NS=void 0;Le.getNumericValue=uh;Le.createDecimalLiteral=bn;Le.createDoubleLiteral=T4;Le.createPercentileAggregate=Vs;var $s=lt(),Ma=Ye(),b4=new Ma.IRI("http://www.w3.org/2001/XMLSchema#decimal"),E4=new Ma.IRI("http://www.w3.org/2001/XMLSchema#double");Le.EXO_AGGREGATE_NS="https://exocortex.my/ontology/agg#";function uh(n){return n==null?NaN:typeof n=="number"?n:typeof n=="string"?parseFloat(n):n instanceof $s.Literal?parseFloat(n.value):n instanceof Ma.IRI?NaN:typeof n=="boolean"?n?1:0:NaN}o(uh,"getNumericValue");function bn(n){return new $s.Literal(String(n),b4)}o(bn,"createDecimalLiteral");function T4(n){return new $s.Literal(String(n),E4)}o(T4,"createDoubleLiteral");Le.medianAggregate={init(){return{values:[]}},step(n,e){let t=n,r=uh(e);isNaN(r)||t.values.push(r)},finalize(n){let e=n,{values:t}=e;if(t.length===0)return bn(0);let r=[...t].sort((a,c)=>a-c),i=Math.floor(r.length/2),s=r.length%2!==0?r[i]:(r[i-1]+r[i])/2;return bn(s)}};Le.varianceAggregate={init(){return{values:[]}},step(n,e){let t=n,r=uh(e);isNaN(r)||t.values.push(r)},finalize(n){let e=n,{values:t}=e;if(t.length===0)return bn(0);let r=t.reduce((s,a)=>s+a,0)/t.length,i=t.reduce((s,a)=>s+Math.pow(a-r,2),0)/t.length;return bn(i)}};Le.stddevAggregate={init(){return{values:[]}},step(n,e){Le.varianceAggregate.step(n,e)},finalize(n){let e=n,{values:t}=e;if(t.length===0)return bn(0);let r=t.reduce((s,a)=>s+a,0)/t.length,i=t.reduce((s,a)=>s+Math.pow(a-r,2),0)/t.length;return bn(Math.sqrt(i))}};Le.modeAggregate={init(){return{counts:new Map,values:new Map}},step(n,e){if(e==null)return;let t=n,r=String(e instanceof $s.Literal||e instanceof Ma.IRI?e.value:e),i=t.counts.get(r)||0;t.counts.set(r,i+1),t.values.set(r,e)},finalize(n){let e=n;if(e.counts.size===0)return new $s.Literal(" ",new Ma.IRI("http://www.w3.org/2001/XMLSchema#string"));let t="",r=0;for(let[a,c]of e.counts)c>r&&(r=c,t=a);let i=e.values.get(t);if(i instanceof $s.Literal)return i;let s=parseFloat(t);return isNaN(s)?new $s.Literal(t,new Ma.IRI("http://www.w3.org/2001/XMLSchema#string")):bn(s)}};function Vs(n){let e=Math.max(0,Math.min(100,n))/100;return{init(){return{values:[],percentile:e}},step(t,r){let i=t,s=uh(r);isNaN(s)||i.values.push(s)},finalize(t){let r=t,{values:i}=r;if(i.length===0)return bn(0);let s=[...i].sort((f,d)=>f-d),a=r.percentile*(s.length-1),c=Math.floor(a),u=Math.ceil(a);if(c===u)return bn(s[c]);let l=a-c,h=s[c]*(1-l)+s[u]*l;return bn(h)}}}o(Vs,"createPercentileAggregate");Le.BUILT_IN_AGGREGATES={[`${Le.EXO_AGGREGATE_NS}median`]:Le.medianAggregate,[`${Le.EXO_AGGREGATE_NS}variance`]:Le.varianceAggregate,[`${Le.EXO_AGGREGATE_NS}stddev`]:Le.stddevAggregate,[`${Le.EXO_AGGREGATE_NS}mode`]:Le.modeAggregate,[`${Le.EXO_AGGREGATE_NS}percentile25`]:Vs(25),[`${Le.EXO_AGGREGATE_NS}percentile50`]:Vs(50),[`${Le.EXO_AGGREGATE_NS}percentile75`]:Vs(75),[`${Le.EXO_AGGREGATE_NS}percentile90`]:Vs(90),[`${Le.EXO_AGGREGATE_NS}percentile95`]:Vs(95),[`${Le.EXO_AGGREGATE_NS}percentile99`]:Vs(99)}});var Uw=y(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.AggregateExecutor=Va.AggregateExecutorError=void 0;var At=lt(),e0=Ye(),A4=th(),C4=Xg(),x4=Jg(),Vw=new e0.IRI("http://www.w3.org/2001/XMLSchema#integer"),Us=new e0.IRI("http://www.w3.org/2001/XMLSchema#decimal"),Gn=new e0.IRI("http://www.w3.org/2001/XMLSchema#string");function $w(n){return typeof n=="object"&&n.type==="custom"}o($w,"isCustomAggregation");var ac=class extends Error{static{o(this,"AggregateExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="AggregateExecutorError"}};Va.AggregateExecutorError=ac;var Zg=class{static{o(this,"AggregateExecutor")}constructor(){this.filterExecutor=new A4.FilterExecutor}execute(e,t){let r=this.groupSolutions(t,e.variables),i=[];for(let[s,a]of r.entries()){let c=new Map;for(let h of e.variables)if(a.length>0){let f=a[0].get(h);f&&c.set(h,f)}for(let h of e.aggregates){let f=this.computeAggregate(h.expression,a);c.set(h.variable,f)}let{SolutionMapping:u}=yi(),l=new u;for(let[h,f]of c.entries())l.set(h,f);i.push(l)}if(i.length===0&&e.aggregates.length>0){let s=this.createEmptyAggregateResult(e);s&&i.push(s)}return i}groupSolutions(e,t){let r=new Map;if(t.length===0)return r.set("",e),r;for(let i of e){let s=this.computeGroupKey(i,t),a=r.get(s);a?a.push(i):r.set(s,[i])}return r}computeGroupKey(e,t){return t.map(r=>{let i=e.get(r);return i?this.termToString(i):""}).join("|")}termToString(e){if(e&&typeof e=="object"){if("value"in e)return String(e.value);if("id"in e)return String(e.id)}return String(e)}computeAggregate(e,t){if($w(e.aggregation))return this.computeCustomAggregate(e,t);let r=this.extractValues(e,t),i=e.aggregation;switch(i){case"count":{let s=this.computeCount(r,e.distinct);return new At.Literal(String(s),Vw)}case"sum":{let s=this.computeSum(r);return new At.Literal(String(s),Us)}case"avg":{let s=this.computeAvg(r);return new At.Literal(String(s),Us)}case"min":{let s=this.computeMin(r);return s===void 0?new At.Literal("",Gn):typeof s=="number"?new At.Literal(String(s),Us):new At.Literal(String(s),Gn)}case"max":{let s=this.computeMax(r);return s===void 0?new At.Literal("",Gn):typeof s=="number"?new At.Literal(String(s),Us):new At.Literal(String(s),Gn)}case"group_concat":{let s=this.computeGroupConcat(r,e.separator||" ",e.distinct);return new At.Literal(s||" ",Gn)}case"sample":{let s=this.computeSample(r,e.distinct);return s===void 0?new At.Literal(" ",Gn):typeof s=="number"?new At.Literal(String(s),Us):new At.Literal(String(s),Gn)}default:{let s=i;throw new ac(`Unknown aggregation function: ${s}`)}}}computeCustomAggregate(e,t){let i=e.aggregation.iri,a=C4.CustomAggregateRegistry.getInstance().get(i);if(a||(a=x4.BUILT_IN_AGGREGATES[i]),!a)throw new ac(`Unknown custom aggregate function: ${i}. Register it with CustomAggregateRegistry.getInstance().register() or use a built-in aggregate.`);let c=a.init();for(let u of t){let l=null;if(e.expression){let h=this.evaluateExpression(e.expression,u);h!==void 0&&(l=h)}else l=1;a.step(c,l)}return a.finalize(c)}extractValues(e,t){if(!e.expression)return t.map(()=>1);let r=[];for(let i of t){let s=this.evaluateExpression(e.expression,i);s!=null&&r.push(s)}return r}evaluateExpression(e,t){if(e.type==="variable"){let r=t.get(e.name);return r==null?void 0:typeof r=="number"||typeof r=="string"||typeof r=="boolean"?r:typeof r=="object"&&"value"in r?r.value:r}if(e.type==="literal")return e.value;try{return this.filterExecutor.evaluateExpression(e,t)}catch{return}}computeCount(e,t){return t?new Set(e.map(r=>String(r))).size:e.length}computeSum(e){return e.map(r=>parseFloat(String(r))).filter(r=>!isNaN(r)).reduce((r,i)=>r+i,0)}computeAvg(e){let t=e.map(r=>parseFloat(String(r))).filter(r=>!isNaN(r));return t.length===0?0:t.reduce((r,i)=>r+i,0)/t.length}computeMin(e){if(e.length===0)return;let t=e.map(i=>parseFloat(String(i))).filter(i=>!isNaN(i));if(t.length>0)return Math.min(...t);let r=e.map(i=>String(i));return r.reduce((i,s)=>s<i?s:i,r[0])}computeMax(e){if(e.length===0)return;let t=e.map(i=>parseFloat(String(i))).filter(i=>!isNaN(i));if(t.length>0)return Math.max(...t);let r=e.map(i=>String(i));return r.reduce((i,s)=>s>i?s:i,r[0])}computeGroupConcat(e,t,r){let i=e.map(s=>String(s));return r&&(i=[...new Set(i)]),i.join(t)}computeSample(e,t){if(e.length===0)return;if(t){let s=[...new Set(e.map(u=>String(u)))];if(s.length===0)return;let a=s[0],c=parseFloat(a);return isNaN(c)?a:c}let r=e[0];if(typeof r=="number")return r;let i=parseFloat(String(r));return isNaN(i)?String(r):i}createEmptyAggregateResult(e){let{SolutionMapping:t}=yi(),r=new t;for(let i of e.aggregates){let s=i.expression.aggregation;if($w(s)){r.set(i.variable,new At.Literal("0",Us));continue}switch(s){case"count":r.set(i.variable,new At.Literal("0",Vw));break;case"sum":case"avg":r.set(i.variable,new At.Literal("0",Us));break;case"group_concat":r.set(i.variable,new At.Literal(" ",Gn));break;case"min":case"max":case"sample":r.set(i.variable,new At.Literal("",Gn));break;default:r.set(i.variable,new At.Literal("",Gn))}}return r}};Va.AggregateExecutor=Zg});var qw=y($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});$a.ServiceExecutor=$a.ServiceExecutorError=void 0;var I4=yi(),Bw=Ye(),O4=lt(),D4=Mt(),Bs=class extends Error{static{o(this,"ServiceExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="ServiceExecutorError"}};$a.ServiceExecutorError=Bs;var t0=class{static{o(this,"ServiceExecutor")}constructor(e={}){this.timeout=e.timeout??3e4,this.httpClient=e.httpClient??((t,r)=>fetch(t,r)),this.maxRetries=e.maxRetries??2,this.retryDelay=e.retryDelay??1e3}async*execute(e,t){try{let r=t(e.pattern),i=await this.executeRemoteQuery(e.endpoint,r);for(let s of i)yield s}catch(r){if(e.silent)return;throw r}}async executeRemoteQuery(e,t){let r;for(let i=0;i<=this.maxRetries;i++)try{let s=new AbortController,a=setTimeout(()=>s.abort(),this.timeout);try{let c=await this.httpClient(e,{method:"POST",headers:{"Content-Type":"application/sparql-query",Accept:"application/sparql-results+json"},body:t,signal:s.signal});if(!c.ok)throw new Bs(`Remote SPARQL endpoint returned ${c.status}: ${c.statusText}`);let u=await c.json();return this.parseJsonResults(u)}finally{clearTimeout(a)}}catch(s){if(r=s instanceof Error?s:new Error(String(s)),this.isRetryableError(r)&&i<this.maxRetries){await this.delay(this.retryDelay);continue}throw new Bs(`Failed to query remote SPARQL endpoint ${e}: ${r.message}`,r)}throw new Bs(`Failed to query remote SPARQL endpoint ${e} after ${this.maxRetries+1} attempts`,r)}parseJsonResults(e){return!e.results||!Array.isArray(e.results.bindings)?[]:e.results.bindings.map(t=>this.parseBinding(t))}parseBinding(e){let t=new I4.SolutionMapping;for(let[r,i]of Object.entries(e)){let s=this.parseRDFTerm(i);t.set(r,s)}return t}parseRDFTerm(e){switch(e.type){case"uri":return new Bw.IRI(e.value);case"literal":{let t=e.datatype?new Bw.IRI(e.datatype):void 0;return new O4.Literal(e.value,t,e["xml:lang"])}case"bnode":return new D4.BlankNode(e.value);default:throw new Bs(`Unknown RDF term type: ${e.type}`)}}isRetryableError(e){let t=e.message.toLowerCase();return!!(e.name==="AbortError"||t.includes("network")||t.includes("econnreset")||t.includes("econnrefused")||t.includes("etimedout")||t.includes("returned 5"))}delay(e){return new Promise(t=>setTimeout(t,e))}};$a.ServiceExecutor=t0});var Ww=y(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.GraphExecutor=Ua.GraphExecutorError=void 0;var Gw=Ye(),lh=class extends Error{static{o(this,"GraphExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="GraphExecutorError"}};Ua.GraphExecutorError=lh;var r0=class{static{o(this,"GraphExecutor")}constructor(e){this.tripleStore=e}async*execute(e,t,r){let i=e.name;if(i.type==="iri")yield*this.executeWithGraph(e.pattern,i,t);else if(i.type==="variable")yield*this.executeWithGraphVariable(e,i,t,r);else throw new lh(`Invalid graph name type: ${i.type}`)}async*executeWithGraph(e,t,r){let i=new Gw.IRI(t.value);this.tripleStore.hasGraph&&!await this.tripleStore.hasGraph(i)||(yield*r(e,i))}async*executeWithGraphVariable(e,t,r,i){if(i){let a=i.get(t.value);if(a&&a instanceof Gw.IRI){yield*this.executeWithGraph(e.pattern,{type:"iri",value:a.value},r);return}}if(!this.tripleStore.getNamedGraphs)return;let s=await this.tripleStore.getNamedGraphs();for(let a of s)for await(let c of r(e.pattern,a)){let u=c.clone();u.set(t.value,a),yield u}}};Ua.GraphExecutor=r0});var zw=y(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.SPARQLGenerator=qa.SPARQLGeneratorError=void 0;var Ba=class extends Error{static{o(this,"SPARQLGeneratorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="SPARQLGeneratorError"}};qa.SPARQLGeneratorError=Ba;var n0=class{static{o(this,"SPARQLGenerator")}collectVariables(e){let t=new Set;return this.collectVariablesFromOperation(e,t),t}generateSelect(e){let t=this.collectVariables(e),r=t.size>0?Array.from(t).map(s=>`?${s}`).join(" "):"*",i=this.generateWhereClause(e);return`SELECT ${r} WHERE {
${i}
}`}generateWhereClause(e,t=2){let r=" ".repeat(t);switch(e.type){case"bgp":return this.generateBGP(e,t);case"filter":return`${this.generateWhereClause(e.input,t)}
${r}FILTER(${this.generateExpression(e.expression)})`;case"join":return`${this.generateWhereClause(e.left,t)}
${this.generateWhereClause(e.right,t)}`;case"leftjoin":{let i=this.generateWhereClause(e.left,t),s=this.generateWhereClause(e.right,t+2);return`${i}
${r}OPTIONAL {
${s}
${r}}`}case"union":{let i=this.generateWhereClause(e.left,t+2),s=this.generateWhereClause(e.right,t+2);return`${r}{
${i}
${r}}
${r}UNION
${r}{
${s}
${r}}`}case"values":return this.generateValues(e,t);case"extend":{let i=this.generateWhereClause(e.input,t),s=this.generateExpression(e.expression);return`${i}
${r}BIND(${s} AS ?${e.variable})`}case"project":case"distinct":case"reduced":return this.generateWhereClause(e.input,t);case"orderby":case"slice":case"group":return this.generateWhereClause(e.input,t);case"subquery":{let s=this.generateSelect(e.query).split(`
`).map(a=>r+a).join(`
`);return`${r}{
${s}
${r}}`}default:throw new Ba(`Unsupported operation type for SPARQL generation: ${e.type}`)}}generateBGP(e,t){let r=" ".repeat(t);return e.triples.map(i=>`${r}${this.generateTriple(i)} .`).join(`
`)}generateTriple(e){let t=this.generateElement(e.subject),r=this.generatePredicate(e.predicate),i=this.generateElement(e.object);return`${t} ${r} ${i}`}generatePredicate(e){return"pathType"in e?this.generatePropertyPath(e):this.generateElement(e)}generatePropertyPath(e){let t=e.items.map(r=>"pathType"in r?`(${this.generatePropertyPath(r)})`:`<${r.value}>`);switch(e.pathType){case"/":return t.join("/");case"|":return t.join("|");case"^":return`^${t[0]}`;case"+":return`${t[0]}+`;case"*":return`${t[0]}*`;case"?":return`${t[0]}?`}}generateElement(e){switch(e.type){case"variable":return`?${e.value}`;case"iri":return`<${e.value}>`;case"literal":{let r=`"${e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}"`;return e.language?r+=`@${e.language}`:e.datatype&&(r+=`^^<${e.datatype}>`),r}case"blank":return`_:${e.value}`;default:throw new Ba(`Unknown element type: ${e.type}`)}}generateValues(e,t){let r=" ".repeat(t);if(e.variables.length===0||e.bindings.length===0)return"";if(e.variables.length===1){let a=e.variables[0],c=e.bindings.map(u=>{let l=u[a];return l?this.generateValuesTerm(l):"UNDEF"}).join(" ");return`${r}VALUES ?${a} { ${c} }`}let i=e.variables.map(a=>`?${a}`).join(" "),s=e.bindings.map(a=>`(${e.variables.map(u=>{let l=a[u];return l?this.generateValuesTerm(l):"UNDEF"}).join(" ")})`);return`${r}VALUES (${i}) {
${s.map(a=>`${r}  ${a}`).join(`
`)}
${r}}`}generateValuesTerm(e){if(e.type==="iri")return`<${e.value}>`;let r=`"${e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`;return e.language?r+=`@${e.language}`:e.datatype&&(r+=`^^<${e.datatype}>`),r}generateExpression(e){switch(e.type){case"variable":return`?${e.name}`;case"literal":return typeof e.value=="string"?`"${e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:typeof e.value=="boolean"?e.value?"true":"false":String(e.value);case"comparison":return`(${this.generateExpression(e.left)} ${e.operator} ${this.generateExpression(e.right)})`;case"logical":return e.operator==="!"?`!(${this.generateExpression(e.operands[0])})`:`(${e.operands.map(t=>this.generateExpression(t)).join(` ${e.operator} `)})`;case"arithmetic":return`(${this.generateExpression(e.left)} ${e.operator} ${this.generateExpression(e.right)})`;case"function":return`${e.function.toUpperCase()}(${e.args.map(t=>this.generateExpression(t)).join(", ")})`;case"functionCall":return`${(typeof e.function=="string"?e.function:e.function.value).toUpperCase()}(${e.args.map(r=>this.generateExpression(r)).join(", ")})`;case"exists":return`${e.negated?"NOT EXISTS":"EXISTS"} { ${this.generateWhereClause(e.pattern,0)} }`;case"in":{let t=this.generateExpression(e.expression),r=e.list.map(i=>this.generateExpression(i)).join(", ");return e.negated?`${t} NOT IN (${r})`:`${t} IN (${r})`}default:throw new Ba(`Unknown expression type: ${e.type}`)}}collectVariablesFromOperation(e,t){switch(e.type){case"bgp":for(let r of e.triples)this.collectVariablesFromTriple(r,t);break;case"filter":this.collectVariablesFromOperation(e.input,t),this.collectVariablesFromExpression(e.expression,t);break;case"join":case"leftjoin":case"union":case"minus":this.collectVariablesFromOperation(e.left,t),this.collectVariablesFromOperation(e.right,t);break;case"values":for(let r of e.variables)t.add(r);break;case"project":for(let r of e.variables)t.add(r);this.collectVariablesFromOperation(e.input,t);break;case"extend":t.add(e.variable),this.collectVariablesFromOperation(e.input,t);break;case"orderby":case"slice":case"distinct":case"reduced":this.collectVariablesFromOperation(e.input,t);break;case"group":for(let r of e.variables)t.add(r);for(let r of e.aggregates)t.add(r.variable);this.collectVariablesFromOperation(e.input,t);break;case"subquery":this.collectVariablesFromOperation(e.query,t);break}}collectVariablesFromTriple(e,t){e.subject.type==="variable"&&t.add(e.subject.value),"type"in e.predicate&&e.predicate.type==="variable"&&t.add(e.predicate.value),e.object.type==="variable"&&t.add(e.object.value)}collectVariablesFromExpression(e,t){switch(e.type){case"variable":t.add(e.name);break;case"comparison":case"arithmetic":this.collectVariablesFromExpression(e.left,t),this.collectVariablesFromExpression(e.right,t);break;case"logical":for(let r of e.operands)this.collectVariablesFromExpression(r,t);break;case"function":case"functionCall":for(let r of e.args)this.collectVariablesFromExpression(r,t);break;case"exists":this.collectVariablesFromOperation(e.pattern,t);break;case"in":this.collectVariablesFromExpression(e.expression,t);for(let r of e.list)this.collectVariablesFromExpression(r,t);break}}};qa.SPARQLGenerator=n0});var Hw=y(Hr=>{"use strict";var P4=Hr&&Hr.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),F4=Hr&&Hr.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),R4=Hr&&Hr.__importStar||(function(){var n=o(function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)},"ownKeys");return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&P4(t,e,r[i]);return F4(t,e),t}})();Object.defineProperty(Hr,"__esModule",{value:!0});Hr.QueryExecutor=Hr.QueryExecutorError=void 0;var N4=kg(),L4=th(),k4=Ug(),j4=qg(),M4=kw(),V4=Mw(),$4=Uw(),U4=Hg(),B4=qw(),q4=Ww(),G4=zw(),W4=Ye(),Ga=class extends Error{static{o(this,"QueryExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="QueryExecutorError"}};Hr.QueryExecutorError=Ga;var i0=class{static{o(this,"QueryExecutor")}constructor(e,t={}){this.tripleStore=e,this.bgpExecutor=new N4.BGPExecutor(e),this.filterExecutor=new L4.FilterExecutor,this.optionalExecutor=new k4.OptionalExecutor,this.unionExecutor=new j4.UnionExecutor,this.minusExecutor=new M4.MinusExecutor,this.valuesExecutor=new V4.ValuesExecutor,this.aggregateExecutor=new $4.AggregateExecutor,this.constructExecutor=new U4.ConstructExecutor,this.serviceExecutor=new B4.ServiceExecutor(t.serviceConfig),this.graphExecutor=new q4.GraphExecutor(e),this.sparqlGenerator=new G4.SPARQLGenerator,this.filterExecutor.setExistsEvaluator(async(r,i)=>this.evaluateExistsPattern(r,i)),this.filterExecutor.setTripleStore(e)}async evaluateExistsPattern(e,t){for await(let r of this.execute(e))if(t.merge(r)!==null)return!0;return!1}async executeAll(e){let t=[];for await(let r of this.execute(e))t.push(r);return t}async*execute(e){switch(e.type){case"bgp":yield*this.executeBGP(e);break;case"filter":yield*this.executeFilter(e);break;case"join":yield*this.executeJoin(e);break;case"leftjoin":yield*this.executeLeftJoin(e);break;case"union":yield*this.executeUnion(e);break;case"minus":yield*this.executeMinus(e);break;case"values":yield*this.executeValues(e);break;case"project":yield*this.executeProject(e);break;case"orderby":yield*this.executeOrderBy(e);break;case"slice":yield*this.executeSlice(e);break;case"distinct":yield*this.executeDistinct(e);break;case"reduced":yield*this.executeReduced(e);break;case"group":yield*this.executeGroup(e);break;case"extend":yield*this.executeExtend(e);break;case"subquery":yield*this.executeSubquery(e);break;case"lateraljoin":yield*this.executeLateralJoin(e);break;case"service":yield*this.executeService(e);break;case"graph":yield*this.executeGraph(e);break;default:throw new Ga(`Unknown operation type: ${e.type}`)}}async*executeBGP(e){yield*this.bgpExecutor.execute(e)}async*executeFilter(e){let t=this.execute(e.input);yield*this.filterExecutor.execute(e,t)}async*executeJoin(e){let t=[];for await(let r of this.execute(e.left))t.push(r);for(let r of t)for await(let i of this.execute(e.right)){let s=r.merge(i);s!==null&&(yield s)}}async*executeLeftJoin(e){let t=[];for await(let a of this.execute(e.left))t.push(a);let r=[];for await(let a of this.execute(e.right))r.push(a);async function*i(){for(let a of t)yield a}o(i,"leftGen");async function*s(){for(let a of r)yield a}o(s,"rightGen"),yield*this.optionalExecutor.execute(i(),s())}async*executeUnion(e){let t=[];for await(let a of this.execute(e.left))t.push(a);let r=[];for await(let a of this.execute(e.right))r.push(a);async function*i(){for(let a of t)yield a}o(i,"leftGen");async function*s(){for(let a of r)yield a}o(s,"rightGen"),yield*this.unionExecutor.execute(i(),s())}async*executeMinus(e){let t=[];for await(let a of this.execute(e.left))t.push(a);let r=[];for await(let a of this.execute(e.right))r.push(a);async function*i(){for(let a of t)yield a}o(i,"leftGen");async function*s(){for(let a of r)yield a}o(s,"rightGen"),yield*this.minusExecutor.execute(i(),s())}async*executeValues(e){yield*this.valuesExecutor.execute(e)}async*executeProject(e){for await(let t of this.execute(e.input))yield t}async*executeOrderBy(e){let t=[];for await(let r of this.execute(e.input))t.push(r);t.sort((r,i)=>{for(let s of e.comparators){let a=this.getExpressionValue(s.expression,r),c=this.getExpressionValue(s.expression,i),u=0;if(a===void 0&&c===void 0?u=0:a===void 0?u=1:c===void 0?u=-1:typeof a=="number"&&typeof c=="number"?u=a-c:u=String(a).localeCompare(String(c)),s.descending&&(u=-u),u!==0)return u}return 0});for(let r of t)yield r}async*executeSlice(e){let t=0,r=e.offset??0,i=e.limit;for await(let s of this.execute(e.input)){if(t>=r){if(i!==void 0&&t-r>=i)break;yield s}t++}}async*executeDistinct(e){let t=new Set;for await(let r of this.execute(e.input)){let i=this.getSolutionKey(r);t.has(i)||(t.add(i),yield r)}}async*executeReduced(e){let t=new Set;for await(let r of this.execute(e.input)){let i=this.getSolutionKey(r);t.has(i)||(t.add(i),yield r)}}async*executeGroup(e){let t=[];for await(let i of this.execute(e.input))t.push(i);let r=this.aggregateExecutor.execute(e,t);for(let i of r)yield i}async*executeExtend(e){for await(let t of this.execute(e.input)){let r=t.clone(),i=this.evaluateExtendExpression(e.expression,t);i!==void 0&&r.set(e.variable,i),yield r}}async*executeSubquery(e){yield*this.execute(e.query)}async*executeLateralJoin(e){let t=[];for await(let r of this.execute(e.left))t.push(r);for(let r of t){let i=this.substituteVariables(e.right,r);for await(let s of this.execute(i)){let a=r.merge(s);a!==null&&(yield a)}}}substituteVariables(e,t){let r=JSON.parse(JSON.stringify(e));return this.substituteInOperation(r,t)}substituteInOperation(e,t){return!e||typeof e!="object"?e:e.type==="bgp"&&e.triples?(e.triples=e.triples.map(r=>this.substituteInTriple(r,t)),e):(e.input&&(e.input=this.substituteInOperation(e.input,t)),e.left&&(e.left=this.substituteInOperation(e.left,t)),e.right&&(e.right=this.substituteInOperation(e.right,t)),e.pattern&&(e.pattern=this.substituteInOperation(e.pattern,t)),e.query&&(e.query=this.substituteInOperation(e.query,t)),e.where&&(e.where=this.substituteInOperation(e.where,t)),e)}substituteInTriple(e,t){return{subject:this.substituteInTripleElement(e.subject,t),predicate:e.predicate,object:this.substituteInTripleElement(e.object,t)}}substituteInTripleElement(e,t){if(e&&e.type==="variable"){let r=t.get(e.value);if(r){if(r instanceof W4.IRI||r.termType==="NamedNode")return{type:"iri",value:r.value};if(r.termType==="Literal"||typeof r.value=="string"){let i=r;return{type:"literal",value:i.value,datatype:i.datatype?.value||i._datatype?.value,language:i.language||i._language}}}}return e}async*executeService(e){yield*this.serviceExecutor.execute(e,t=>this.sparqlGenerator.generateSelect(t))}async*executeGraph(e){let t=async function*(r,i){let s=this.currentGraphContext;this.currentGraphContext=i;try{r.type==="bgp"&&i&&this.tripleStore.matchInGraph?yield*this.executeBGPInGraph(r,i):yield*this.execute(r)}finally{this.currentGraphContext=s}}.bind(this);yield*this.graphExecutor.execute(e,t)}async*executeBGPInGraph(e,t){if(e.triples.length===0){let{SolutionMapping:r}=await Promise.resolve().then(()=>R4(yi()));yield new r;return}yield*this.bgpExecutor.executeInGraph(e,t)}evaluateExtendExpression(e,t){if(e.type!=="aggregate")try{return this.filterExecutor.evaluateExpression(e,t)}catch{return}}getExpressionValue(e,t){if(e.type==="variable"){let r=t.get(e.name);return r?r.value??r.id??String(r):void 0}return e.value}getSolutionKey(e){let t=e.toJSON();return Object.keys(t).sort().map(i=>`${i}=${t[i]}`).join("|")}isConstructQuery(e){return e.type==="construct"}async executeConstruct(e){if(e.type!=="construct")throw new Ga("executeConstruct requires a CONSTRUCT operation");let t=await this.executeAll(e.where);return this.constructExecutor.execute(e.template,t)}isAskQuery(e){return e.type==="ask"}async executeAsk(e){if(e.type!=="ask")throw new Ga("executeAsk requires an ASK operation");for await(let t of this.execute(e.where))return!0;return!1}};Hr.QueryExecutor=i0});var Qw=y(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.UpdateExecutor=za.UpdateExecutorError=void 0;var z4=Oi(),Wa=Ye(),s0=lt(),Yw=Mt(),Jt=class extends Error{static{o(this,"UpdateExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="UpdateExecutorError"}};za.UpdateExecutorError=Jt;var a0=class{static{o(this,"UpdateExecutor")}constructor(e){this.tripleStore=e}async execute(e){if(e.type!=="update")throw new Jt("Expected UPDATE request");let t=[];for(let r of e.updates){let i=await this.executeOperation(r);t.push(i)}return t}async executeOperation(e){if("updateType"in e)switch(e.updateType){case"insert":return this.executeInsertData(e);case"delete":return this.executeDeleteData(e);case"insertdelete":throw new Jt("INSERT/DELETE with WHERE clause not yet implemented");case"deletewhere":throw new Jt("DELETE WHERE not yet implemented");default:throw new Jt(`Unknown update type: ${e.updateType}`)}if("type"in e)switch(e.type){case"clear":case"drop":case"load":case"create":case"copy":case"move":case"add":throw new Jt(`${e.type.toUpperCase()} operation not yet implemented`);default:throw new Jt(`Unknown operation type: ${e.type}`)}throw new Jt("Unknown update operation structure")}async executeInsertData(e){if(e.updateType!=="insert")throw new Jt("Expected INSERT DATA operation");let t=e,r=0;for(let i of t.insert)if(i.type==="bgp"){let s=this.resolveGraphName(t.graph);r+=await this.insertTriples(i.triples,s)}else if(i.type==="graph"){let s=i,a=this.parseGraphName(s.name);r+=await this.insertTriples(s.triples,a)}return{type:"insert",inserted:r,success:!0}}async executeDeleteData(e){if(e.updateType!=="delete")throw new Jt("Expected DELETE DATA operation");let t=e,r=0;for(let i of t.delete)if(i.type==="bgp"){let s=this.resolveGraphName(t.graph);r+=await this.deleteTriples(i.triples,s)}else if(i.type==="graph"){let s=i,a=this.parseGraphName(s.name);r+=await this.deleteTriples(s.triples,a)}return{type:"delete",deleted:r,success:!0}}async insertTriples(e,t){let r=0;for(let i of e){let s=this.convertTriple(i);t&&this.tripleStore.addToGraph?await this.tripleStore.addToGraph(s,t):await this.tripleStore.add(s),r++}return r}async deleteTriples(e,t){let r=0;for(let i of e){let s=this.convertTriple(i),a;t&&this.tripleStore.removeFromGraph?a=await this.tripleStore.removeFromGraph(s,t):a=await this.tripleStore.remove(s),a&&r++}return r}convertTriple(e){return new z4.Triple(this.convertSubject(e.subject),this.convertPredicate(e.predicate),this.convertObject(e.object))}convertSubject(e){if(e.termType==="NamedNode")return new Wa.IRI(e.value);if(e.termType==="BlankNode")return new Yw.BlankNode(e.value);throw new Jt(`Invalid subject term type: ${e.termType}. Variables are not allowed in INSERT DATA.`)}convertPredicate(e){if("termType"in e&&e.termType==="NamedNode")return new Wa.IRI(e.value);throw new Jt("Invalid predicate term type. Only IRIs are allowed in INSERT DATA.")}convertObject(e){if(e.termType==="NamedNode")return new Wa.IRI(e.value);if(e.termType==="BlankNode")return new Yw.BlankNode(e.value);if(e.termType==="Literal"){let t=e;return t.language?new s0.Literal(t.value,void 0,t.language):t.datatype?new s0.Literal(t.value,new Wa.IRI(t.datatype.value)):new s0.Literal(t.value)}throw new Jt(`Invalid object term type: ${e.termType}. Variables are not allowed in INSERT DATA.`)}resolveGraphName(e){if(e&&!e.default&&e.name)return new Wa.IRI(e.name.value)}parseGraphName(e){if(e.termType==="Variable")throw new Jt("Variables are not allowed as graph names in INSERT DATA / DELETE DATA.");return new Wa.IRI(e.value)}};za.UpdateExecutor=a0});var Xw=y(hh=>{"use strict";Object.defineProperty(hh,"__esModule",{value:!0});hh.AggregateFunctions=void 0;var o0=lt(),Kw=Ye(),c0=class{static{o(this,"AggregateFunctions")}static count(e,t){if(!t)return e.length;let r=0;for(let i of e)i.has(t)&&r++;return r}static countDistinct(e,t){let r=new Set;for(let i of e){let s=i.get(t);s&&r.add(s.toString())}return r.size}static sum(e,t){let r=0;for(let i of e){let s=i.get(t);if(s instanceof o0.Literal){let a=this.toNumber(s);isNaN(a)||(r+=a)}}return r}static avg(e,t){let r=this.sum(e,t),i=this.count(e,t);return i>0?r/i:0}static min(e,t){let r=null;for(let i of e){let s=i.get(t);if(!s)continue;let a=this.toComparable(s);(r===null||a<r)&&(r=a)}return r}static max(e,t){let r=null;for(let i of e){let s=i.get(t);if(!s)continue;let a=this.toComparable(s);(r===null||a>r)&&(r=a)}return r}static groupConcat(e,t,r=" "){let i=[];for(let s of e){let a=s.get(t);a&&(a instanceof o0.Literal||a instanceof Kw.IRI?i.push(a.value):i.push(a.toString()))}return i.join(r)}static sample(e,t){for(let r of e){let i=r.get(t);if(i)return this.toComparable(i)}return null}static sampleDistinct(e,t){return this.sample(e,t)}static toNumber(e){let t=e.datatype?.value;return t?.includes("#integer")||t?.includes("#decimal")||t?.includes("#double"),parseFloat(e.value)}static toComparable(e){if(e instanceof o0.Literal){let t=this.toNumber(e);return isNaN(t)?e.value:t}return e instanceof Kw.IRI?e.value:String(e)}};hh.AggregateFunctions=c0});var Jw=y(fh=>{"use strict";Object.defineProperty(fh,"__esModule",{value:!0});fh.QueryPlanCache=void 0;var H4=Il(),u0=class{static{o(this,"QueryPlanCache")}constructor(e=100){this.hits=0,this.misses=0,this.cache=new H4.LRUCache(e)}get(e){let t=this.normalizeQuery(e),r=this.cache.get(t);return r!==void 0?this.hits++:this.misses++,r}set(e,t){let r=this.normalizeQuery(e);this.cache.set(r,t)}has(e){let t=this.normalizeQuery(e);return this.cache.get(t)!==void 0}clear(){this.cache.clear()}getStats(){let e=this.hits+this.misses;return{hits:this.hits,misses:this.misses,hitRate:e>0?this.hits/e:0,size:this.cache.size()}}resetStats(){this.hits=0,this.misses=0}normalizeQuery(e){return e.replace(/\s+/g," ").trim()}};fh.QueryPlanCache=u0});var Zw=y(oc=>{"use strict";Object.defineProperty(oc,"__esModule",{value:!0});oc.SPARQLResultCache=void 0;oc.createSPARQLResultCache=K4;var Y4=Il(),Q4={maxSize:500,ttlMs:300*1e3,enableFileInvalidation:!0,maxResultSizeBytes:10*1024*1024},dh=class{static{o(this,"SPARQLResultCache")}constructor(e={}){this.fileToQueries=new Map,this.stats={hits:0,misses:0,evictions:0,ttlInvalidations:0,fileInvalidations:0,totalTimeSavedMs:0},this.avgQueryTimeMs=100,this.options={...Q4,...e},this.cache=new Y4.LRUCache(this.options.maxSize)}normalizeQuery(e){return e.replace(/\s+/g," ").trim()}hashResult(e){return this.isTripleArray(e)?`T:${e.length}`:`S:${e.length}`}isTripleArray(e){return e.length>0&&"subject"in e[0]}estimateResultSize(e){return this.isTripleArray(e)?e.length*300:e.length*200}get(e){let t=this.normalizeQuery(e),r=this.cache.get(t);if(r===void 0){this.stats.misses++;return}if(Date.now()-r.timestamp>this.options.ttlMs){this.cache.set(t,void 0),this.stats.ttlInvalidations++,this.stats.misses++;return}return this.stats.hits++,this.stats.totalTimeSavedMs+=this.avgQueryTimeMs,r.result}set(e,t,r,i){if(this.estimateResultSize(t)>this.options.maxResultSizeBytes)return;i!==void 0&&(this.avgQueryTimeMs=(this.avgQueryTimeMs+i)/2);let a=this.normalizeQuery(e),c=r??new Set,u={result:t,timestamp:Date.now(),affectedFiles:c,resultHash:this.hashResult(t)};if(this.cache.size()>=this.options.maxSize&&this.stats.evictions++,this.cache.set(a,u),this.options.enableFileInvalidation)for(let h of c){let f=this.fileToQueries.get(h);f||(f=new Set,this.fileToQueries.set(h,f)),f.add(a)}}has(e){let t=this.normalizeQuery(e),r=this.cache.get(t);return r===void 0?!1:Date.now()-r.timestamp<=this.options.ttlMs}invalidateByFile(e){if(!this.options.enableFileInvalidation)return 0;let t=this.fileToQueries.get(e);if(!t)return 0;let r=0;for(let i of t)this.cache.set(i,void 0),r++,this.stats.fileInvalidations++;return this.fileToQueries.delete(e),r}clear(){this.cache.clear(),this.fileToQueries.clear()}getStats(){let e=this.stats.hits+this.stats.misses,t=e>0?this.stats.hits/e:0;return{hits:this.stats.hits,misses:this.stats.misses,hitRate:t,size:this.cache.size(),maxSize:this.options.maxSize,evictions:this.stats.evictions,ttlInvalidations:this.stats.ttlInvalidations,fileInvalidations:this.stats.fileInvalidations,avgTimeSavedMs:this.stats.hits>0?this.stats.totalTimeSavedMs/this.stats.hits:0}}resetStats(){this.stats={hits:0,misses:0,evictions:0,ttlInvalidations:0,fileInvalidations:0,totalTimeSavedMs:0}}size(){return this.cache.size()}pruneExpired(){return 0}};oc.SPARQLResultCache=dh;function K4(n){return new dh(n)}o(K4,"createSPARQLResultCache")});var e_=y(cc=>{"use strict";Object.defineProperty(cc,"__esModule",{value:!0});cc.IncrementalIndexer=void 0;cc.createIncrementalIndexer=J4;var X4={throttleMs:500,maxBatchSize:100,useContentHashing:!1},ph=class{static{o(this,"IncrementalIndexer")}constructor(e={}){this.fileMetadata=new Map,this.pendingChanges=[],this.throttleTimer=null,this.invalidateCallbacks=[],this.lastIndexTime=0,this.stats={totalChanges:0,invalidations:0,noOpChanges:0,indexDurations:[]},this.options={...X4,...e}}recordChange(e){this.pendingChanges.push(e),this.stats.totalChanges++,this.throttleTimer===null&&(this.throttleTimer=setTimeout(()=>{this.processPendingChanges(),this.throttleTimer=null},this.options.throttleMs))}processPendingChanges(){if(this.pendingChanges.length===0)return;let e=performance.now(),t=new Map;for(let a of this.pendingChanges)t.set(a.path,a);let r=Array.from(t.values()),i=[];for(let a of r)switch(a.type){case"deleted":this.fileMetadata.delete(a.path),i.push(a);break;case"renamed":a.oldPath&&this.fileMetadata.delete(a.oldPath),i.push(a);break;case"created":case"modified":i.push(a);break}if(i.length>0){this.stats.invalidations+=i.length;for(let a of this.invalidateCallbacks)try{a(i)}catch(c){console.error("IncrementalIndexer: Error in invalidation callback:",c)}}let s=performance.now()-e;this.stats.indexDurations.push(s),this.stats.indexDurations.length>100&&this.stats.indexDurations.shift(),this.lastIndexTime=Date.now(),this.pendingChanges=[]}flush(){this.throttleTimer!==null&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.processPendingChanges()}updateMetadata(e,t,r,i){this.fileMetadata.set(e,{mtime:t,size:r,contentHash:i})}hasChanged(e,t,r){let i=this.fileMetadata.get(e);return i===void 0||i.mtime!==t||r!==void 0&&i.size!==r}getChangedFiles(e){let t=[];for(let[r,i]of this.fileMetadata.entries())i.mtime>e&&t.push(r);return t}onInvalidate(e){return this.invalidateCallbacks.push(e),()=>{let t=this.invalidateCallbacks.indexOf(e);t!==-1&&this.invalidateCallbacks.splice(t,1)}}getStats(){let e=this.stats.indexDurations,t=e.length>0?e.reduce((i,s)=>i+s,0)/e.length:0,r=e.length>0?e[e.length-1]:0;return{trackedFiles:this.fileMetadata.size,totalChanges:this.stats.totalChanges,invalidations:this.stats.invalidations,noOpChanges:this.stats.noOpChanges,lastIndexDurationMs:r,avgIndexDurationMs:t,lastIndexTime:this.lastIndexTime}}resetStats(){this.stats={totalChanges:0,invalidations:0,noOpChanges:0,indexDurations:[]}}clear(){this.fileMetadata.clear(),this.pendingChanges=[],this.throttleTimer!==null&&(clearTimeout(this.throttleTimer),this.throttleTimer=null)}size(){return this.fileMetadata.size}isTracked(e){return this.fileMetadata.has(e)}getMetadata(e){return this.fileMetadata.get(e)}dispose(){this.throttleTimer!==null&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.invalidateCallbacks=[],this.pendingChanges=[],this.fileMetadata.clear()}};cc.IncrementalIndexer=ph;function J4(n){return new ph(n)}o(J4,"createIncrementalIndexer")});var t_=y(vh=>{"use strict";Object.defineProperty(vh,"__esModule",{value:!0});vh.ResultSerializer=void 0;var mh=lt(),gh=Ye(),yh=Mt(),l0=class{static{o(this,"ResultSerializer")}serialize(e,t,r={}){switch(t){case"json":return this.serializeJSON(e,r);case"xml":return this.serializeXML(e,r);case"csv":return this.serializeCSV(e,r);case"turtle":return this.serializeTurtle(e,r);default:throw new Error(`Unsupported result format: ${t}`)}}serializeJSON(e,t={}){let r=this.toJSONResultSet(e,t),i=t.pretty?t.indent??2:void 0;return JSON.stringify(r,null,i)}toJSONResultSet(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=e.map(a=>{let c={};for(let u of i){let l=a.get(u);l!==void 0&&(c[u]=this.termToJSONBinding(l))}return c});return{head:{vars:i},results:{bindings:s}}}termToJSONBinding(e){return e instanceof gh.IRI?{type:"uri",value:e.value}:e instanceof yh.BlankNode?{type:"bnode",value:e.id}:e instanceof mh.Literal?this.literalToJSONBinding(e):{type:"literal",value:String(e)}}literalToJSONBinding(e){let t={type:"literal",value:e.value};return e.datatype?t.datatype=e.datatype.value:e.language&&(t["xml:lang"]=e.language,e.hasDirection()&&e.direction&&(t.direction=e.direction)),t}serializeXML(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=['<?xml version="1.0"?>','<sparql xmlns="http://www.w3.org/2005/sparql-results#">',"  <head>"];for(let a of i)s.push(`    <variable name="${this.escapeXML(a)}"/>`);s.push("  </head>"),s.push("  <results>");for(let a of e){s.push("    <result>");for(let c of i){let u=a.get(c);u!==void 0&&(s.push(`      <binding name="${this.escapeXML(c)}">`),s.push("        "+this.termToXML(u)),s.push("      </binding>"))}s.push("    </result>")}return s.push("  </results>"),s.push("</sparql>"),s.join(`
`)}termToXML(e){return e instanceof gh.IRI?`<uri>${this.escapeXML(e.value)}</uri>`:e instanceof yh.BlankNode?`<bnode>${this.escapeXML(e.id)}</bnode>`:e instanceof mh.Literal?this.literalToXML(e):`<literal>${this.escapeXML(String(e))}</literal>`}literalToXML(e){let t=this.escapeXML(e.value);if(e.datatype)return`<literal datatype="${this.escapeXML(e.datatype.value)}">${t}</literal>`;if(e.language){let r=`xml:lang="${this.escapeXML(e.language)}"`;return e.hasDirection()&&e.direction&&(r+=` direction="${e.direction}"`),`<literal ${r}>${t}</literal>`}return`<literal>${t}</literal>`}serializeCSV(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=[];s.push(i.map(a=>this.escapeCSV(a)).join(","));for(let a of e){let c=i.map(u=>{let l=a.get(u);return l===void 0?"":this.escapeCSV(this.termToCSV(l))});s.push(c.join(","))}return s.join(`
`)}termToCSV(e){return e instanceof gh.IRI?e.value:e instanceof yh.BlankNode?`_:${e.id}`:e instanceof mh.Literal?this.literalToCSV(e):String(e)}literalToCSV(e){if(e.datatype)return`${e.value}^^<${e.datatype.value}>`;if(e.language){let t=e.language;return e.hasDirection()&&e.direction&&(t+=`--${e.direction}`),`${e.value}@${t}`}return e.value}serializeTurtle(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=[];s.push(`# SPARQL Results - ${e.length} solution(s)`),s.push(`# Variables: ${i.join(", ")}`),s.push("");for(let a=0;a<e.length;a++){let c=e[a];s.push(`# Solution ${a+1}`);for(let u of i){let l=c.get(u);l!==void 0&&s.push(`?${u} = ${this.termToTurtle(l)}`)}s.push("")}return s.join(`
`).trimEnd()}termToTurtle(e){return e instanceof gh.IRI?`<${e.value}>`:e instanceof yh.BlankNode?`_:${e.id}`:e instanceof mh.Literal?e.toString():`"${String(e)}"`}escapeXML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}escapeCSV(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}};vh.ResultSerializer=l0});var r_=y(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.FileAlreadyExistsError=Ha.FileNotFoundError=void 0;var h0=class extends Error{static{o(this,"FileNotFoundError")}constructor(e){super(`File not found: ${e}`),this.name="FileNotFoundError"}};Ha.FileNotFoundError=h0;var f0=class extends Error{static{o(this,"FileAlreadyExistsError")}constructor(e){super(`File already exists: ${e}`),this.name="FileAlreadyExistsError"}};Ha.FileAlreadyExistsError=f0});var n_=y(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.container=void 0;qi.registerCoreServices=TF;qi.createChildContainer=AF;qi.getContainer=CF;qi.resetContainer=xF;Yf();var uc=qe();Object.defineProperty(qi,"container",{enumerable:!0,get:o(function(){return uc.container},"get")});var at=ot(),Z4=Vp(),eF=al(),tF=gm(),rF=ol(),nF=cm(),iF=Up(),sF=Hp(),aF=Wp(),oF=fl(),cF=dl(),uF=nm(),lF=sm(),hF=lm(),fF=tm(),dF=vm(),pF=bm(),mF=_m(),gF=Xp(),yF=Zp(),vF=pm(),wF=fm(),_F=ng(),SF=Qp(),bF=Tm(),EF=xm();function TF(n){let e=n||uc.container;e.registerSingleton(at.DI_TOKENS.TaskFrontmatterGenerator,eF.TaskFrontmatterGenerator),e.registerSingleton(at.DI_TOKENS.DynamicFrontmatterGenerator,tF.DynamicFrontmatterGenerator),e.registerSingleton(at.DI_TOKENS.AlgorithmExtractor,rF.AlgorithmExtractor),e.registerSingleton(at.DI_TOKENS.EffortStatusWorkflow,oF.EffortStatusWorkflow),e.registerSingleton(at.DI_TOKENS.StatusTimestampService,cF.StatusTimestampService),e.registerSingleton(at.DI_TOKENS.TaskStatusService,aF.TaskStatusService),e.registerSingleton(at.DI_TOKENS.TaskCreationService,Z4.TaskCreationService),e.registerSingleton(at.DI_TOKENS.ProjectCreationService,iF.ProjectCreationService),e.registerSingleton(at.DI_TOKENS.AreaCreationService,sF.AreaCreationService),e.registerSingleton(at.DI_TOKENS.ClassCreationService,gF.ClassCreationService),e.registerSingleton(at.DI_TOKENS.ConceptCreationService,yF.ConceptCreationService),e.registerSingleton(at.DI_TOKENS.FleetingNoteCreationService,vF.FleetingNoteCreationService),e.registerSingleton(at.DI_TOKENS.SupervisionCreationService,wF.SupervisionCreationService),e.registerSingleton(at.DI_TOKENS.GenericAssetCreationService,EF.GenericAssetCreationService),e.registerSingleton(at.DI_TOKENS.PropertyCleanupService,nF.PropertyCleanupService),e.registerSingleton(at.DI_TOKENS.FolderRepairService,uF.FolderRepairService),e.registerSingleton(at.DI_TOKENS.LabelToAliasService,lF.LabelToAliasService),e.registerSingleton(at.DI_TOKENS.RenameToUidService,hF.RenameToUidService),e.registerSingleton(at.DI_TOKENS.PlanningService,dF.PlanningService),e.registerSingleton(at.DI_TOKENS.EffortVotingService,fF.EffortVotingService),e.registerSingleton(at.DI_TOKENS.SessionEventService,pF.SessionEventService),e.registerSingleton(at.DI_TOKENS.AssetConversionService,mF.AssetConversionService),e.registerSingleton(at.DI_TOKENS.NoteToRDFConverter,_F.NoteToRDFConverter),e.registerSingleton(at.DI_TOKENS.AreaHierarchyBuilder,SF.AreaHierarchyBuilder),e.registerSingleton(at.DI_TOKENS.URIConstructionService,bF.URIConstructionService)}o(TF,"registerCoreServices");function AF(){return uc.container.createChildContainer()}o(AF,"createChildContainer");function CF(){return uc.container}o(CF,"getContainer");function xF(){uc.container.reset()}o(xF,"resetContainer")});var d0=y(Ya=>{"use strict";Object.defineProperty(Ya,"__esModule",{value:!0});Ya.DEFAULT_COLORS=Ya.NODE_FLAGS=void 0;Ya.NODE_FLAGS={PINNED:1,VISIBLE:2,SELECTED:4,HOVERED:8,ARCHIVED:16,SEARCH_MATCH:32,HIGHLIGHTED:64};Ya.DEFAULT_COLORS={NODE:1251006975,NODE_SELECTED:4290840575,NODE_HOVERED:1723558655,EDGE:2576980479,EDGE_SELECTED:4288151807,EDGE_HIERARCHY:2619846911}});var m0=y(wh=>{"use strict";Object.defineProperty(wh,"__esModule",{value:!0});wh.StringTable=void 0;var p0=class n{static{o(this,"StringTable")}constructor(e){if(this.stringToIndex=new Map,this.strings=[],this.memoryBytes=0,e)for(let t of e)this.intern(t)}intern(e){let t=this.stringToIndex.get(e);if(t!==void 0)return t;let r=this.strings.length;return this.strings.push(e),this.stringToIndex.set(e,r),this.memoryBytes+=e.length*2+50,r}getIndex(e){return this.stringToIndex.get(e)??-1}getString(e){if(e<0||e>=this.strings.length)throw new RangeError(`StringTable index out of bounds: ${e}`);return this.strings[e]}has(e){return this.stringToIndex.has(e)}hasIndex(e){return e>=0&&e<this.strings.length}get size(){return this.strings.length}getMemoryBytes(){return this.memoryBytes}*entries(){for(let e=0;e<this.strings.length;e++)yield[e,this.strings[e]]}*values(){for(let e of this.strings)yield e}toArray(){return[...this.strings]}clear(){this.stringToIndex.clear(),this.strings=[],this.memoryBytes=0}static fromJSON(e){return new n(e)}toJSON(){return this.strings}internAll(e){return e.map(t=>this.intern(t))}getStrings(e){return e.map(t=>this.getString(t))}search(e){let t=typeof e=="string"?new RegExp(e):e,r=[];for(let i=0;i<this.strings.length;i++)t.test(this.strings[i])&&r.push([i,this.strings[i]]);return r}getStats(){let e=this.strings.reduce((t,r)=>t+r.length,0);return{count:this.strings.length,memoryBytes:this.memoryBytes,avgStringLength:this.strings.length>0?e/this.strings.length:0}}};wh.StringTable=p0});var i_=y(Sh=>{"use strict";Object.defineProperty(Sh,"__esModule",{value:!0});Sh.CompactGraphStore=void 0;var _h=m0(),Ir=d0(),IF={initialNodeCapacity:1e4,initialEdgeCapacity:5e4,growthFactor:2,maxCapacity:1e6};function g0(n,e){if(n===void 0)return e;if(typeof n=="number")return n;if(n.startsWith("#")){let t=n.slice(1);if(t.length===6)return parseInt(t,16)<<8|255;if(t.length===8)return parseInt(t,16)}return e}o(g0,"parseColor");var y0=class{static{o(this,"CompactGraphStore")}constructor(e){this.nodeCount=0,this.edgeCount=0,this.nodeIdToIndex=new Map,this.indexToNodeId=[],this.edgeIdToIndex=new Map,this.config={...IF,...e},this.nodeCapacity=this.config.initialNodeCapacity,this.edgeCapacity=this.config.initialEdgeCapacity,this.nodes=this.allocateNodeArrays(this.nodeCapacity),this.edges=this.allocateEdgeArrays(this.edgeCapacity),this.uriTable=new _h.StringTable,this.labelTable=new _h.StringTable,this.typeTable=new _h.StringTable,this.predicateTable=new _h.StringTable}allocateNodeArrays(e){return{positions:new Float32Array(e*2),radii:new Float32Array(e),colors:new Uint32Array(e),types:new Uint16Array(e),flags:new Uint8Array(e)}}allocateEdgeArrays(e){return{sourceIndices:new Uint32Array(e),targetIndices:new Uint32Array(e),predicateIndices:new Uint16Array(e),widths:new Float32Array(e),colors:new Uint32Array(e)}}resizeNodeArrays(e){if(e<=this.nodeCapacity)return;if(e>this.config.maxCapacity)throw new Error(`Cannot resize beyond max capacity (${this.config.maxCapacity})`);let t=this.allocateNodeArrays(e);t.positions.set(this.nodes.positions.subarray(0,this.nodeCount*2)),t.radii.set(this.nodes.radii.subarray(0,this.nodeCount)),t.colors.set(this.nodes.colors.subarray(0,this.nodeCount)),t.types.set(this.nodes.types.subarray(0,this.nodeCount)),t.flags.set(this.nodes.flags.subarray(0,this.nodeCount)),this.nodes=t,this.nodeCapacity=e}resizeEdgeArrays(e){if(e<=this.edgeCapacity)return;if(e>this.config.maxCapacity)throw new Error(`Cannot resize beyond max capacity (${this.config.maxCapacity})`);let t=this.allocateEdgeArrays(e);t.sourceIndices.set(this.edges.sourceIndices.subarray(0,this.edgeCount)),t.targetIndices.set(this.edges.targetIndices.subarray(0,this.edgeCount)),t.predicateIndices.set(this.edges.predicateIndices.subarray(0,this.edgeCount)),t.widths.set(this.edges.widths.subarray(0,this.edgeCount)),t.colors.set(this.edges.colors.subarray(0,this.edgeCount)),this.edges=t,this.edgeCapacity=e}ensureNodeCapacity(e){let t=this.nodeCount+e;if(t>this.nodeCapacity){let r=Math.max(t,Math.floor(this.nodeCapacity*this.config.growthFactor));this.resizeNodeArrays(r)}}ensureEdgeCapacity(e){let t=this.edgeCount+e;if(t>this.edgeCapacity){let r=Math.max(t,Math.floor(this.edgeCapacity*this.config.growthFactor));this.resizeEdgeArrays(r)}}addNode(e){let t=this.nodeIdToIndex.get(e.id);if(t!==void 0)return this.updateNodeAt(t,e),t;this.ensureNodeCapacity(1);let r=this.nodeCount++,i=r*2;this.nodes.positions[i]=e.x??Math.random()*1e3-500,this.nodes.positions[i+1]=e.y??Math.random()*1e3-500,this.nodes.radii[r]=e.radius??8,this.nodes.colors[r]=g0(e.color,Ir.DEFAULT_COLORS.NODE),e.assetClass?this.nodes.types[r]=this.typeTable.intern(e.assetClass):this.nodes.types[r]=0;let s=Ir.NODE_FLAGS.VISIBLE;return e.isPinned&&(s|=Ir.NODE_FLAGS.PINNED),e.isArchived&&(s|=Ir.NODE_FLAGS.ARCHIVED),this.nodes.flags[r]=s,this.nodeIdToIndex.set(e.id,r),this.indexToNodeId[r]=e.id,this.uriTable.intern(e.id),e.label&&this.labelTable.intern(e.label),r}updateNodeAt(e,t){let r=e*2;t.x!==void 0&&(this.nodes.positions[r]=t.x),t.y!==void 0&&(this.nodes.positions[r+1]=t.y),t.radius!==void 0&&(this.nodes.radii[e]=t.radius),t.color!==void 0&&(this.nodes.colors[e]=g0(t.color,Ir.DEFAULT_COLORS.NODE)),t.assetClass!==void 0&&(this.nodes.types[e]=this.typeTable.intern(t.assetClass));let i=this.nodes.flags[e];t.isPinned!==void 0&&(i=t.isPinned?i|Ir.NODE_FLAGS.PINNED:i&~Ir.NODE_FLAGS.PINNED),t.isArchived!==void 0&&(i=t.isArchived?i|Ir.NODE_FLAGS.ARCHIVED:i&~Ir.NODE_FLAGS.ARCHIVED),this.nodes.flags[e]=i}addEdge(e){let t=this.nodeIdToIndex.get(e.sourceId),r=this.nodeIdToIndex.get(e.targetId);if(t===void 0||r===void 0)return-1;let i=`${e.sourceId}->${e.targetId}:${e.predicate??"link"}`,s=this.edgeIdToIndex.get(i);if(s!==void 0)return s;this.ensureEdgeCapacity(1);let a=this.edgeCount++;return this.edges.sourceIndices[a]=t,this.edges.targetIndices[a]=r,this.edges.widths[a]=e.width??1,this.edges.colors[a]=g0(e.color,Ir.DEFAULT_COLORS.EDGE),e.predicate?this.edges.predicateIndices[a]=this.predicateTable.intern(e.predicate):this.edges.predicateIndices[a]=0,this.edgeIdToIndex.set(i,a),a}addNodes(e){return this.ensureNodeCapacity(e.length),e.map(t=>this.addNode(t))}addEdges(e){return this.ensureEdgeCapacity(e.length),e.map(t=>this.addEdge(t))}loadChunk(e){let r=this.addNodes(e.nodes).filter(a=>a>=0).length,s=this.addEdges(e.edges).filter(a=>a>=0).length;return{nodesAdded:r,edgesAdded:s}}getNodePosition(e){let t=this.nodeIdToIndex.get(e);if(t===void 0)return null;let r=t*2;return{x:this.nodes.positions[r],y:this.nodes.positions[r+1]}}getNodePositionByIndex(e){let t=e*2;return{x:this.nodes.positions[t],y:this.nodes.positions[t+1]}}setNodePosition(e,t,r){let i=this.nodeIdToIndex.get(e);if(i===void 0)return!1;let s=i*2;return this.nodes.positions[s]=t,this.nodes.positions[s+1]=r,!0}setNodePositionByIndex(e,t,r){let i=e*2;this.nodes.positions[i]=t,this.nodes.positions[i+1]=r}updateNodePositions(e){let t=0;for(let[r,i]of e)this.setNodePosition(r,i.x,i.y)&&t++;return t}applyNodeUpdates(e){let t=performance.now(),r=0;for(let i of e){let s=i.index;if(!(s<0||s>=this.nodeCount)){if(i.x!==void 0||i.y!==void 0){let a=s*2;i.x!==void 0&&(this.nodes.positions[a]=i.x),i.y!==void 0&&(this.nodes.positions[a+1]=i.y)}i.radius!==void 0&&(this.nodes.radii[s]=i.radius),i.color!==void 0&&(this.nodes.colors[s]=i.color),i.setFlags!==void 0&&(this.nodes.flags[s]|=i.setFlags),i.clearFlags!==void 0&&(this.nodes.flags[s]&=~i.clearFlags),r++}}return{nodesUpdated:r,edgesUpdated:0,timeMs:performance.now()-t}}getNodeFlags(e){let t=this.nodeIdToIndex.get(e);return t===void 0?0:this.nodes.flags[t]}setNodeFlag(e,t){let r=this.nodeIdToIndex.get(e);return r===void 0?!1:(this.nodes.flags[r]|=t,!0)}clearNodeFlag(e,t){let r=this.nodeIdToIndex.get(e);return r===void 0?!1:(this.nodes.flags[r]&=~t,!0)}hasNodeFlag(e,t){return(this.getNodeFlags(e)&t)!==0}selectNode(e){return this.setNodeFlag(e,Ir.NODE_FLAGS.SELECTED)}deselectNode(e){return this.clearNodeFlag(e,Ir.NODE_FLAGS.SELECTED)}clearSelection(){for(let e=0;e<this.nodeCount;e++)this.nodes.flags[e]&=~Ir.NODE_FLAGS.SELECTED}getSelectedNodeIds(){let e=[];for(let t=0;t<this.nodeCount;t++)this.nodes.flags[t]&Ir.NODE_FLAGS.SELECTED&&e.push(this.indexToNodeId[t]);return e}getNodeId(e){return this.indexToNodeId[e]}getNodeIndex(e){return this.nodeIdToIndex.get(e)}hasNode(e){return this.nodeIdToIndex.has(e)}getNodeCount(){return this.nodeCount}getEdgeCount(){return this.edgeCount}getNodeEdges(e){let t=this.nodeIdToIndex.get(e);if(t===void 0)return[];let r=[];for(let i=0;i<this.edgeCount;i++)this.edges.sourceIndices[i]===t?r.push({edgeIndex:i,isSource:!0}):this.edges.targetIndices[i]===t&&r.push({edgeIndex:i,isSource:!1});return r}getNeighbors(e){let t=this.nodeIdToIndex.get(e);if(t===void 0)return[];let r=new Set;for(let i=0;i<this.edgeCount;i++)if(this.edges.sourceIndices[i]===t){let s=this.edges.targetIndices[i];r.add(this.indexToNodeId[s])}else if(this.edges.targetIndices[i]===t){let s=this.edges.sourceIndices[i];r.add(this.indexToNodeId[s])}return Array.from(r)}getRawArrays(){return{nodes:this.nodes,edges:this.edges,nodeCount:this.nodeCount,edgeCount:this.edgeCount}}getPositionsArray(){return this.nodes.positions.subarray(0,this.nodeCount*2)}getMemoryStats(){let e=this.nodeCapacity*2*4+this.nodeCapacity*4+this.nodeCapacity*4+this.nodeCapacity*2+this.nodeCapacity,t=this.edgeCapacity*4+this.edgeCapacity*4+this.edgeCapacity*2+this.edgeCapacity*4+this.edgeCapacity*4,r=this.uriTable.getMemoryBytes()+this.labelTable.getMemoryBytes()+this.typeTable.getMemoryBytes()+this.predicateTable.getMemoryBytes();return{nodeCount:this.nodeCount,edgeCount:this.edgeCount,nodeCapacity:this.nodeCapacity,edgeCapacity:this.edgeCapacity,nodeMemoryBytes:e,edgeMemoryBytes:t,stringTableBytes:r,totalBytes:e+t+r,internedStringCount:this.uriTable.size+this.labelTable.size+this.typeTable.size+this.predicateTable.size}}clear(){this.nodeCount=0,this.edgeCount=0,this.nodeIdToIndex.clear(),this.indexToNodeId=[],this.edgeIdToIndex.clear(),this.uriTable.clear(),this.labelTable.clear(),this.typeTable.clear(),this.predicateTable.clear(),this.nodeCapacity=this.config.initialNodeCapacity,this.edgeCapacity=this.config.initialEdgeCapacity,this.nodes=this.allocateNodeArrays(this.nodeCapacity),this.edges=this.allocateEdgeArrays(this.edgeCapacity)}getTypeTable(){return this.typeTable}getLabelTable(){return this.labelTable}getUriTable(){return this.uriTable}getPredicateTable(){return this.predicateTable}};Sh.CompactGraphStore=y0});var s_=y(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});Ka.MemoryPool=void 0;Ka.getGlobalPool=DF;Ka.resetGlobalPool=PF;var OF={maxPooledArrays:16,sizeBuckets:[64,256,1024,4096,16384,65536,262144],autoCleanup:!0,maxPoolMemory:50*1024*1024},bh=class{static{o(this,"MemoryPool")}constructor(e){this.float32Pool=new Map,this.uint32Pool=new Map,this.uint16Pool=new Map,this.uint8Pool=new Map,this.stats={poolHits:0,poolMisses:0,pooledArrays:0,pooledMemory:0,returned:0,rejected:0},this.config={...OF,...e};for(let t of this.config.sizeBuckets)this.float32Pool.set(t,[]),this.uint32Pool.set(t,[]),this.uint16Pool.set(t,[]),this.uint8Pool.set(t,[])}getBucketSize(e){for(let t of this.config.sizeBuckets)if(t>=e)return t;return e}getFloat32(e){let t=this.getBucketSize(e),r=this.float32Pool.get(t);if(r&&r.length>0){this.stats.poolHits++,this.stats.pooledArrays--,this.stats.pooledMemory-=t*4;let i=r.pop();return i.fill(0),i}return this.stats.poolMisses++,new Float32Array(t)}getUint32(e){let t=this.getBucketSize(e),r=this.uint32Pool.get(t);if(r&&r.length>0){this.stats.poolHits++,this.stats.pooledArrays--,this.stats.pooledMemory-=t*4;let i=r.pop();return i.fill(0),i}return this.stats.poolMisses++,new Uint32Array(t)}getUint16(e){let t=this.getBucketSize(e),r=this.uint16Pool.get(t);if(r&&r.length>0){this.stats.poolHits++,this.stats.pooledArrays--,this.stats.pooledMemory-=t*2;let i=r.pop();return i.fill(0),i}return this.stats.poolMisses++,new Uint16Array(t)}getUint8(e){let t=this.getBucketSize(e),r=this.uint8Pool.get(t);if(r&&r.length>0){this.stats.poolHits++,this.stats.pooledArrays--,this.stats.pooledMemory-=t;let i=r.pop();return i.fill(0),i}return this.stats.poolMisses++,new Uint8Array(t)}releaseFloat32(e){this.releaseToPool(this.float32Pool,e,4)}releaseUint32(e){this.releaseToPool(this.uint32Pool,e,4)}releaseUint16(e){this.releaseToPool(this.uint16Pool,e,2)}releaseUint8(e){this.releaseToPool(this.uint8Pool,e,1)}releaseToPool(e,t,r){let i=t.length,s=e.get(i);if(s&&s.length<this.config.maxPooledArrays){if(this.config.autoCleanup&&this.stats.pooledMemory+i*r>this.config.maxPoolMemory){this.stats.rejected++;return}s.push(t),this.stats.returned++,this.stats.pooledArrays++,this.stats.pooledMemory+=i*r}else this.stats.rejected++}getStats(){return{...this.stats}}getHitRatio(){let e=this.stats.poolHits+this.stats.poolMisses;return e>0?this.stats.poolHits/e:0}clear(){for(let e of this.float32Pool.values())e.length=0;for(let e of this.uint32Pool.values())e.length=0;for(let e of this.uint16Pool.values())e.length=0;for(let e of this.uint8Pool.values())e.length=0;this.stats.pooledArrays=0,this.stats.pooledMemory=0}cleanup(e){if(this.stats.pooledMemory<=e)return;let t=[...this.config.sizeBuckets].sort((r,i)=>i-r);for(let r of t){if(this.stats.pooledMemory<=e)break;for(let[i,s]of[[this.float32Pool,4],[this.uint32Pool,4],[this.uint16Pool,2],[this.uint8Pool,1]]){let a=i.get(r);if(a)for(;a.length>0&&this.stats.pooledMemory>e;)a.pop(),this.stats.pooledArrays--,this.stats.pooledMemory-=r*s}}}resetStats(){this.stats.poolHits=0,this.stats.poolMisses=0,this.stats.returned=0,this.stats.rejected=0}};Ka.MemoryPool=bh;var Qa=null;function DF(){return Qa||(Qa=new bh),Qa}o(DF,"getGlobalPool");function PF(){Qa&&Qa.clear(),Qa=null}o(PF,"resetGlobalPool")});var a_=y(lc=>{"use strict";Object.defineProperty(lc,"__esModule",{value:!0});lc.StreamingLoader=void 0;lc.createStreamingSource=RF;var FF={chunkSize:1e3,chunkDelay:0,autoResolveEdges:!0,maxConcurrency:1},v0=class{static{o(this,"StreamingLoader")}constructor(e,t){this.state="idle",this.pendingEdges=[],this.nodesLoaded=0,this.edgesLoaded=0,this.chunksProcessed=0,this.progressCallbacks=[],this.abortController=null,this.store=e,this.config={...FF,...t}}getState(){return this.state}getProgress(){let e=this.totalChunks!==void 0&&this.totalChunks>0?this.chunksProcessed/this.totalChunks:0;return{currentChunk:this.chunksProcessed,totalChunks:this.totalChunks,nodesLoaded:this.nodesLoaded,edgesLoaded:this.edgesLoaded,progress:e,isComplete:this.state==="completed"}}onProgress(e){return this.progressCallbacks.push(e),()=>{let t=this.progressCallbacks.indexOf(e);t>=0&&this.progressCallbacks.splice(t,1)}}notifyProgress(){let e=this.getProgress();for(let t of this.progressCallbacks)t(e)}loadChunk(e){if(this.state==="error")throw new Error("Loader is in error state");this.state="loading",e.totalChunks!==void 0&&(this.totalChunks=e.totalChunks);for(let t of e.nodes)this.store.addNode(t),this.nodesLoaded++;for(let t of e.edges)this.store.addEdge(t)>=0?this.edgesLoaded++:this.pendingEdges.push(t);this.chunksProcessed++,e.isLast&&this.finishLoading(),this.notifyProgress()}finishLoading(){if(this.config.autoResolveEdges&&this.pendingEdges.length>0){for(let e of this.pendingEdges)this.store.addEdge(e)>=0&&this.edgesLoaded++;this.pendingEdges=[]}this.state="completed",this.notifyProgress()}async loadFromIterator(e){this.reset(),this.state="loading",this.abortController=new AbortController;try{for await(let r of e){if(this.abortController.signal.aborted){this.state="paused";return}this.loadChunk(r),this.config.chunkDelay>0&&await this.delay(this.config.chunkDelay)}this.state!=="completed"&&this.finishLoading()}catch(t){throw this.state="error",t}finally{this.abortController=null}}async loadFromArrays(e,t){let r=this.createChunks(e,t);await this.loadFromIterator(this.arrayToAsyncIterator(r))}createChunks(e,t){let r=[],{chunkSize:i}=this.config,s=Math.ceil(e.length/i),a=Array(s).fill(null).map(()=>[]);for(let c of t){let u=e.findIndex(l=>l.id===c.sourceId);if(u>=0){let l=Math.floor(u/i);a[l].push(c)}}for(let c=0;c<s;c++){let u=c*i,l=Math.min(u+i,e.length);r.push({chunkIndex:c,totalChunks:s,nodes:e.slice(u,l),edges:a[c],isLast:c===s-1})}return r}async*arrayToAsyncIterator(e){for(let t of e)yield t}delay(e){return new Promise(t=>setTimeout(t,e))}cancel(){this.abortController&&this.abortController.abort(),this.state="paused"}reset(){this.state="idle",this.pendingEdges=[],this.nodesLoaded=0,this.edgesLoaded=0,this.chunksProcessed=0,this.totalChunks=void 0,this.abortController=null}getPendingEdgeCount(){return this.pendingEdges.length}getStats(){return{state:this.state,nodesLoaded:this.nodesLoaded,edgesLoaded:this.edgesLoaded,chunksProcessed:this.chunksProcessed,totalChunks:this.totalChunks,pendingEdges:this.pendingEdges.length,storeStats:this.store.getMemoryStats()}}};lc.StreamingLoader=v0;async function*RF(n,e,t=1e3){let r=0,i=0,s;for(;;){let a=await e(n,r,t);if(a.totalCount!==void 0&&s===void 0&&(s=Math.ceil(a.totalCount/t)),yield{chunkIndex:i,totalChunks:s,nodes:a.nodes,edges:a.edges,isLast:!a.hasMore},!a.hasMore)break;r+=t,i++}}o(RF,"createStreamingSource")});var u_=y(St=>{"use strict";Object.defineProperty(St,"__esModule",{value:!0});St.createStreamingSource=St.StreamingLoader=St.resetGlobalPool=St.getGlobalPool=St.MemoryPool=St.CompactGraphStore=St.StringTable=St.DEFAULT_COLORS=St.NODE_FLAGS=void 0;var o_=d0();Object.defineProperty(St,"NODE_FLAGS",{enumerable:!0,get:o(function(){return o_.NODE_FLAGS},"get")});Object.defineProperty(St,"DEFAULT_COLORS",{enumerable:!0,get:o(function(){return o_.DEFAULT_COLORS},"get")});var NF=m0();Object.defineProperty(St,"StringTable",{enumerable:!0,get:o(function(){return NF.StringTable},"get")});var LF=i_();Object.defineProperty(St,"CompactGraphStore",{enumerable:!0,get:o(function(){return LF.CompactGraphStore},"get")});var w0=s_();Object.defineProperty(St,"MemoryPool",{enumerable:!0,get:o(function(){return w0.MemoryPool},"get")});Object.defineProperty(St,"getGlobalPool",{enumerable:!0,get:o(function(){return w0.getGlobalPool},"get")});Object.defineProperty(St,"resetGlobalPool",{enumerable:!0,get:o(function(){return w0.resetGlobalPool},"get")});var c_=a_();Object.defineProperty(St,"StreamingLoader",{enumerable:!0,get:o(function(){return c_.StreamingLoader},"get")});Object.defineProperty(St,"createStreamingSource",{enumerable:!0,get:o(function(){return c_.createStreamingSource},"get")})});var Wn=y(Eh=>{"use strict";Object.defineProperty(Eh,"__esModule",{value:!0});Eh.ErrorCode=void 0;var l_;(function(n){n[n.INVALID_INPUT=1e3]="INVALID_INPUT",n[n.INVALID_FORMAT=1001]="INVALID_FORMAT",n[n.MISSING_REQUIRED_FIELD=1002]="MISSING_REQUIRED_FIELD",n[n.INVALID_SCHEMA=1003]="INVALID_SCHEMA",n[n.NETWORK_ERROR=2e3]="NETWORK_ERROR",n[n.REQUEST_TIMEOUT=2001]="REQUEST_TIMEOUT",n[n.CONNECTION_FAILED=2002]="CONNECTION_FAILED",n[n.FILE_READ_ERROR=2003]="FILE_READ_ERROR",n[n.FILE_WRITE_ERROR=2004]="FILE_WRITE_ERROR",n[n.INVALID_STATE=3e3]="INVALID_STATE",n[n.INVALID_TRANSITION=3001]="INVALID_TRANSITION",n[n.OPERATION_FAILED=3002]="OPERATION_FAILED",n[n.CONCURRENT_MODIFICATION=3003]="CONCURRENT_MODIFICATION",n[n.PERMISSION_DENIED=4e3]="PERMISSION_DENIED",n[n.UNAUTHORIZED=4001]="UNAUTHORIZED",n[n.FORBIDDEN=4003]="FORBIDDEN",n[n.NOT_FOUND=5e3]="NOT_FOUND",n[n.RESOURCE_EXHAUSTED=5001]="RESOURCE_EXHAUSTED",n[n.ALREADY_EXISTS=5002]="ALREADY_EXISTS",n[n.UNKNOWN_ERROR=9e3]="UNKNOWN_ERROR",n[n.INTERNAL_ERROR=9001]="INTERNAL_ERROR"})(l_||(Eh.ErrorCode=l_={}))});var zn=y(Th=>{"use strict";Object.defineProperty(Th,"__esModule",{value:!0});Th.ApplicationError=void 0;var _0=class extends Error{static{o(this,"ApplicationError")}constructor(e,t){super(e),this.name=this.constructor.name,this.context=t,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}format(){let e=`\u274C ${this.name}: ${this.message}`;if(this.guidance&&(e+=`

\u{1F4A1} ${this.guidance}`),this.context&&Object.keys(this.context).length>0){e+=`

\u{1F4CB} Context:`;for(let[t,r]of Object.entries(this.context))e+=`
  ${t}: ${JSON.stringify(r)}`}return e}toJSON(){return{name:this.name,message:this.message,code:this.code,retriable:this.retriable,timestamp:this.timestamp.toISOString(),context:this.context,stack:this.stack}}};Th.ApplicationError=_0});var h_=y(Ah=>{"use strict";Object.defineProperty(Ah,"__esModule",{value:!0});Ah.ValidationError=void 0;var kF=zn(),jF=Wn(),S0=class extends kF.ApplicationError{static{o(this,"ValidationError")}constructor(e,t){super(e,t),this.code=jF.ErrorCode.INVALID_INPUT,this.retriable=!1,this.guidance=`Check the input data for correctness.
Common issues:
  \u2022 Missing required fields
  \u2022 Invalid data format or type
  \u2022 Values outside allowed range
  \u2022 Schema validation failed`}};Ah.ValidationError=S0});var f_=y(Ch=>{"use strict";Object.defineProperty(Ch,"__esModule",{value:!0});Ch.NetworkError=void 0;var MF=zn(),VF=Wn(),b0=class extends MF.ApplicationError{static{o(this,"NetworkError")}constructor(e,t){super(e,t),this.code=VF.ErrorCode.NETWORK_ERROR,this.retriable=!0,this.guidance=`This is typically a transient network issue.
To resolve:
  \u2022 Check your internet connection
  \u2022 Retry the operation
  \u2022 Verify external services are available
  \u2022 Check firewall/proxy settings`}};Ch.NetworkError=b0});var d_=y(xh=>{"use strict";Object.defineProperty(xh,"__esModule",{value:!0});xh.StateTransitionError=void 0;var $F=zn(),UF=Wn(),E0=class extends $F.ApplicationError{static{o(this,"StateTransitionError")}constructor(e,t){super(e,t),this.code=UF.ErrorCode.INVALID_TRANSITION,this.retriable=!1,this.guidance=`The requested state transition is not allowed.
To fix:
  \u2022 Check the current state of the resource
  \u2022 Verify the transition is valid for this workflow
  \u2022 Review state machine documentation
  \u2022 Ensure no concurrent modifications occurred`}};xh.StateTransitionError=E0});var p_=y(Ih=>{"use strict";Object.defineProperty(Ih,"__esModule",{value:!0});Ih.PermissionError=void 0;var BF=zn(),qF=Wn(),T0=class extends BF.ApplicationError{static{o(this,"PermissionError")}constructor(e,t){super(e,t),this.code=qF.ErrorCode.PERMISSION_DENIED,this.retriable=!1,this.guidance=`You don't have permission to perform this operation.
To resolve:
  \u2022 Check file/directory permissions
  \u2022 Verify you're authenticated
  \u2022 Ensure you have sufficient privileges
  \u2022 Contact administrator if access is needed`}};Ih.PermissionError=T0});var m_=y(Oh=>{"use strict";Object.defineProperty(Oh,"__esModule",{value:!0});Oh.NotFoundError=void 0;var GF=zn(),WF=Wn(),A0=class extends GF.ApplicationError{static{o(this,"NotFoundError")}constructor(e,t){super(e,t),this.code=WF.ErrorCode.NOT_FOUND,this.retriable=!1,this.guidance=`The requested resource could not be found.
To resolve:
  \u2022 Verify the resource path/ID is correct
  \u2022 Check the resource exists
  \u2022 Ensure proper file extension (.md for notes)
  \u2022 Verify resource hasn't been deleted`}};Oh.NotFoundError=A0});var g_=y(Dh=>{"use strict";Object.defineProperty(Dh,"__esModule",{value:!0});Dh.ResourceExhaustedError=void 0;var zF=zn(),HF=Wn(),C0=class extends zF.ApplicationError{static{o(this,"ResourceExhaustedError")}constructor(e,t){super(e,t),this.code=HF.ErrorCode.RESOURCE_EXHAUSTED,this.retriable=!0,this.guidance=`A resource limit has been exceeded.
To resolve:
  \u2022 Free up system resources (memory, disk space)
  \u2022 Reduce the size of your request
  \u2022 Wait and retry (for rate limits)
  \u2022 Close unused files/connections
  \u2022 Paginate large queries`}};Dh.ResourceExhaustedError=C0});var y_=y(Ph=>{"use strict";Object.defineProperty(Ph,"__esModule",{value:!0});Ph.ServiceError=void 0;var YF=zn(),QF=Wn(),x0=class extends YF.ApplicationError{static{o(this,"ServiceError")}constructor(e,t){super(e,t),this.code=QF.ErrorCode.INTERNAL_ERROR,this.retriable=!1,this.guidance=`This is an internal service error.
To resolve:
  \u2022 Check service initialization parameters
  \u2022 Verify all required dependencies are available
  \u2022 Review service logs for detailed error information
  \u2022 Contact support if the issue persists`}};Ph.ServiceError=x0});var v_=y(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.ServiceError=bt.ResourceExhaustedError=bt.NotFoundError=bt.PermissionError=bt.StateTransitionError=bt.NetworkError=bt.ValidationError=bt.ApplicationError=bt.ErrorCode=void 0;var KF=Wn();Object.defineProperty(bt,"ErrorCode",{enumerable:!0,get:o(function(){return KF.ErrorCode},"get")});var XF=zn();Object.defineProperty(bt,"ApplicationError",{enumerable:!0,get:o(function(){return XF.ApplicationError},"get")});var JF=h_();Object.defineProperty(bt,"ValidationError",{enumerable:!0,get:o(function(){return JF.ValidationError},"get")});var ZF=f_();Object.defineProperty(bt,"NetworkError",{enumerable:!0,get:o(function(){return ZF.NetworkError},"get")});var eR=d_();Object.defineProperty(bt,"StateTransitionError",{enumerable:!0,get:o(function(){return eR.StateTransitionError},"get")});var tR=p_();Object.defineProperty(bt,"PermissionError",{enumerable:!0,get:o(function(){return tR.PermissionError},"get")});var rR=m_();Object.defineProperty(bt,"NotFoundError",{enumerable:!0,get:o(function(){return rR.NotFoundError},"get")});var nR=g_();Object.defineProperty(bt,"ResourceExhaustedError",{enumerable:!0,get:o(function(){return nR.ResourceExhaustedError},"get")});var iR=y_();Object.defineProperty(bt,"ServiceError",{enumerable:!0,get:o(function(){return iR.ServiceError},"get")})});var w_=y(Fh=>{"use strict";Object.defineProperty(Fh,"__esModule",{value:!0});Fh.ApplicationErrorHandler=void 0;var I0=zn(),sR=Wn(),O0=class{static{o(this,"ApplicationErrorHandler")}constructor(e={},t,r){this.logger=t,this.notifier=r,this.telemetryHooks=new Set,this.retryConfig={maxRetries:e.maxRetries??3,initialDelayMs:e.initialDelayMs??1e3,backoffMultiplier:e.backoffMultiplier??2,maxDelayMs:e.maxDelayMs??1e4}}handle(e,t){let r=this.ensureApplicationError(e,t);return this.notifier&&this.notifier.error(r.message),this.callTelemetryHooks("onError",r,t),this.formatError(r)}async executeWithRetry(e,t){let r,i=0;for(;i<=this.retryConfig.maxRetries;)try{return await e()}catch(s){if(r=this.ensureApplicationError(s,t),!r.retriable||i>=this.retryConfig.maxRetries)throw this.callTelemetryHooks("onError",r,t),i>=this.retryConfig.maxRetries&&r.retriable&&this.callTelemetryHooks("onRetryExhausted",r,i+1),r;let a=this.calculateDelay(i);this.callTelemetryHooks("onRetry",r,i+1,a),this.logger?.debug(`Retrying after ${a}ms (attempt ${i+1}/${this.retryConfig.maxRetries})`),await this.sleep(a),i++}throw r}registerTelemetryHook(e){this.telemetryHooks.add(e)}unregisterTelemetryHook(e){this.telemetryHooks.delete(e)}ensureApplicationError(e,t){if(e instanceof I0.ApplicationError){if(t){let i=e,s={...e.context,...t};return new class extends I0.ApplicationError{constructor(){super(...arguments),this.code=i.code,this.retriable=i.retriable,this.guidance=i.guidance}}(e.message,s)}return e}return new class extends I0.ApplicationError{static{o(this,"UnknownError")}constructor(s,a){super(s,{originalError:a.name,...t}),this.code=sR.ErrorCode.UNKNOWN_ERROR,this.retriable=!1,this.guidance="An unexpected error occurred"}}(e.message,e)}formatError(e){let t=[];return t.push(`\u274C ${e.name}: ${e.message}`),e.guidance&&t.push(`\u{1F4A1} ${e.guidance}`),e.context&&Object.keys(e.context).length>0&&t.push(`Context: ${JSON.stringify(e.context,null,2)}`),t.join(`
`)}calculateDelay(e){let t=this.retryConfig.initialDelayMs*Math.pow(this.retryConfig.backoffMultiplier,e);return Math.min(t,this.retryConfig.maxDelayMs)}sleep(e){return new Promise(t=>setTimeout(t,e))}callTelemetryHooks(e,...t){for(let r of this.telemetryHooks)try{let i=r[e];i&&i.apply(r,t)}catch(i){console.error("Error in telemetry hook:",i)}}};Fh.ApplicationErrorHandler=O0});var __=y(Rh=>{"use strict";Object.defineProperty(Rh,"__esModule",{value:!0});Rh.ApplicationErrorHandler=void 0;var aR=w_();Object.defineProperty(Rh,"ApplicationErrorHandler",{enumerable:!0,get:o(function(){return aR.ApplicationErrorHandler},"get")})});var Gi=y(v=>{"use strict";var oR=v&&v.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),En=v&&v.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&oR(e,n,t)};Object.defineProperty(v,"__esModule",{value:!0});v.NoteToRDFConverter=v.RDFVocabularyMapper=v.InMemoryTripleStore=v.RDFSerializer=v.FilenameValidator=v.EffortSortingHelpers=v.MetadataExtractor=v.MetadataHelpers=v.WikiLinkHelpers=v.DateFormatter=v.FrontmatterService=v.TypeRegistry=v.GraphQueryService=v.DEFAULT_SEMANTIC_SEARCH_CONFIG=v.SemanticSearchService=v.DEFAULT_VECTOR_STORE_CONFIG=v.VectorStore=v.DEFAULT_EMBEDDING_CONFIG=v.EmbeddingService=v.GenericAssetCreationService=v.WebhookService=v.URIConstructionService=v.SessionEventService=v.AssetConversionService=v.PlanningService=v.AlgorithmExtractor=v.DynamicFrontmatterGenerator=v.TaskFrontmatterGenerator=v.FleetingNoteCreationService=v.SupervisionCreationService=v.StatusTimestampService=v.RenameToUidService=v.PropertyCleanupService=v.LoggingService=v.LabelToAliasService=v.FolderRepairService=v.EffortVotingService=v.EffortStatusWorkflow=v.ConceptCreationService=v.ClassCreationService=v.AreaHierarchyBuilder=v.AreaCreationService=v.TaskStatusService=v.ProjectCreationService=v.TaskCreationService=v.extractPropertyLabel=v.uriToPropertyName=v.propertyNameToUri=v.rangeToFieldType=v.PropertyFieldType=void 0;v.resetContainer=v.getContainer=v.createChildContainer=v.registerCoreServices=v.DI_TOKENS=v.TransactionError=v.TripleNotFoundError=v.TripleAlreadyExistsError=v.FileAlreadyExistsError=v.FileNotFoundError=v.FilterContainsOptimizer=v.CaseWhenTransformerError=v.CaseWhenTransformer=v.ResultSerializer=v.createIncrementalIndexer=v.IncrementalIndexer=v.createSPARQLResultCache=v.SPARQLResultCache=v.QueryPlanCache=v.createDoubleLiteral=v.createDecimalLiteral=v.getNumericValue=v.createPercentileAggregate=v.modeAggregate=v.stddevAggregate=v.varianceAggregate=v.medianAggregate=v.EXO_AGGREGATE_NS=v.BUILT_IN_AGGREGATES=v.CustomAggregateError=v.CustomAggregateRegistry=v.AggregateFunctions=v.BuiltInFunctions=v.SolutionMapping=v.UpdateExecutorError=v.UpdateExecutor=v.QueryExecutor=v.DescribeExecutor=v.ConstructExecutor=v.UnionExecutor=v.OptionalExecutor=v.FilterExecutor=v.BGPExecutor=v.AlgebraSerializer=v.AlgebraOptimizer=v.AlgebraTranslator=v.DescribeOptionsTransformerError=v.DescribeOptionsTransformer=v.SPARQLParseError=v.SPARQLParser=void 0;v.createStreamingSource=v.StreamingLoader=v.resetGlobalPool=v.getGlobalPool=v.MemoryPool=v.CompactGraphStore=v.StringTable=v.DEFAULT_COLORS=v.NODE_FLAGS=v.container=void 0;En(fd(),v);En(dd(),v);En(U1(),v);En(B1(),v);En(pd(),v);En(md(),v);En(G1(),v);En(H1(),v);En(c2(),v);var S_=Id();Object.defineProperty(v,"PropertyFieldType",{enumerable:!0,get:o(function(){return S_.PropertyFieldType},"get")});Object.defineProperty(v,"rangeToFieldType",{enumerable:!0,get:o(function(){return S_.rangeToFieldType},"get")});var D0=h2();Object.defineProperty(v,"propertyNameToUri",{enumerable:!0,get:o(function(){return D0.propertyNameToUri},"get")});Object.defineProperty(v,"uriToPropertyName",{enumerable:!0,get:o(function(){return D0.uriToPropertyName},"get")});Object.defineProperty(v,"extractPropertyLabel",{enumerable:!0,get:o(function(){return D0.extractPropertyLabel},"get")});var cR=Vp();Object.defineProperty(v,"TaskCreationService",{enumerable:!0,get:o(function(){return cR.TaskCreationService},"get")});var uR=Up();Object.defineProperty(v,"ProjectCreationService",{enumerable:!0,get:o(function(){return uR.ProjectCreationService},"get")});var lR=Wp();Object.defineProperty(v,"TaskStatusService",{enumerable:!0,get:o(function(){return lR.TaskStatusService},"get")});var hR=Hp();Object.defineProperty(v,"AreaCreationService",{enumerable:!0,get:o(function(){return hR.AreaCreationService},"get")});var fR=Qp();Object.defineProperty(v,"AreaHierarchyBuilder",{enumerable:!0,get:o(function(){return fR.AreaHierarchyBuilder},"get")});var dR=Xp();Object.defineProperty(v,"ClassCreationService",{enumerable:!0,get:o(function(){return dR.ClassCreationService},"get")});var pR=Zp();Object.defineProperty(v,"ConceptCreationService",{enumerable:!0,get:o(function(){return pR.ConceptCreationService},"get")});var mR=fl();Object.defineProperty(v,"EffortStatusWorkflow",{enumerable:!0,get:o(function(){return mR.EffortStatusWorkflow},"get")});var gR=tm();Object.defineProperty(v,"EffortVotingService",{enumerable:!0,get:o(function(){return gR.EffortVotingService},"get")});var yR=nm();Object.defineProperty(v,"FolderRepairService",{enumerable:!0,get:o(function(){return yR.FolderRepairService},"get")});var vR=sm();Object.defineProperty(v,"LabelToAliasService",{enumerable:!0,get:o(function(){return vR.LabelToAliasService},"get")});var wR=Os();Object.defineProperty(v,"LoggingService",{enumerable:!0,get:o(function(){return wR.LoggingService},"get")});var _R=cm();Object.defineProperty(v,"PropertyCleanupService",{enumerable:!0,get:o(function(){return _R.PropertyCleanupService},"get")});var SR=lm();Object.defineProperty(v,"RenameToUidService",{enumerable:!0,get:o(function(){return SR.RenameToUidService},"get")});var bR=dl();Object.defineProperty(v,"StatusTimestampService",{enumerable:!0,get:o(function(){return bR.StatusTimestampService},"get")});var ER=fm();Object.defineProperty(v,"SupervisionCreationService",{enumerable:!0,get:o(function(){return ER.SupervisionCreationService},"get")});var TR=pm();Object.defineProperty(v,"FleetingNoteCreationService",{enumerable:!0,get:o(function(){return TR.FleetingNoteCreationService},"get")});var AR=al();Object.defineProperty(v,"TaskFrontmatterGenerator",{enumerable:!0,get:o(function(){return AR.TaskFrontmatterGenerator},"get")});var CR=gm();Object.defineProperty(v,"DynamicFrontmatterGenerator",{enumerable:!0,get:o(function(){return CR.DynamicFrontmatterGenerator},"get")});var xR=ol();Object.defineProperty(v,"AlgorithmExtractor",{enumerable:!0,get:o(function(){return xR.AlgorithmExtractor},"get")});var IR=vm();Object.defineProperty(v,"PlanningService",{enumerable:!0,get:o(function(){return IR.PlanningService},"get")});var OR=_m();Object.defineProperty(v,"AssetConversionService",{enumerable:!0,get:o(function(){return OR.AssetConversionService},"get")});var DR=bm();Object.defineProperty(v,"SessionEventService",{enumerable:!0,get:o(function(){return DR.SessionEventService},"get")});var PR=Tm();Object.defineProperty(v,"URIConstructionService",{enumerable:!0,get:o(function(){return PR.URIConstructionService},"get")});var FR=Vv();Object.defineProperty(v,"WebhookService",{enumerable:!0,get:o(function(){return FR.WebhookService},"get")});var RR=xm();Object.defineProperty(v,"GenericAssetCreationService",{enumerable:!0,get:o(function(){return RR.GenericAssetCreationService},"get")});var b_=Om();Object.defineProperty(v,"EmbeddingService",{enumerable:!0,get:o(function(){return b_.EmbeddingService},"get")});Object.defineProperty(v,"DEFAULT_EMBEDDING_CONFIG",{enumerable:!0,get:o(function(){return b_.DEFAULT_EMBEDDING_CONFIG},"get")});var E_=Fm();Object.defineProperty(v,"VectorStore",{enumerable:!0,get:o(function(){return E_.VectorStore},"get")});Object.defineProperty(v,"DEFAULT_VECTOR_STORE_CONFIG",{enumerable:!0,get:o(function(){return E_.DEFAULT_VECTOR_STORE_CONFIG},"get")});var T_=qv();Object.defineProperty(v,"SemanticSearchService",{enumerable:!0,get:o(function(){return T_.SemanticSearchService},"get")});Object.defineProperty(v,"DEFAULT_SEMANTIC_SEARCH_CONFIG",{enumerable:!0,get:o(function(){return T_.DEFAULT_SEMANTIC_SEARCH_CONFIG},"get")});var NR=Gv();Object.defineProperty(v,"GraphQueryService",{enumerable:!0,get:o(function(){return NR.GraphQueryService},"get")});var LR=zv();Object.defineProperty(v,"TypeRegistry",{enumerable:!0,get:o(function(){return LR.TypeRegistry},"get")});var kR=da();Object.defineProperty(v,"FrontmatterService",{enumerable:!0,get:o(function(){return kR.FrontmatterService},"get")});var jR=hr();Object.defineProperty(v,"DateFormatter",{enumerable:!0,get:o(function(){return jR.DateFormatter},"get")});var MR=gs();Object.defineProperty(v,"WikiLinkHelpers",{enumerable:!0,get:o(function(){return MR.WikiLinkHelpers},"get")});var VR=Br();Object.defineProperty(v,"MetadataHelpers",{enumerable:!0,get:o(function(){return VR.MetadataHelpers},"get")});var $R=Yo();Object.defineProperty(v,"MetadataExtractor",{enumerable:!0,get:o(function(){return $R.MetadataExtractor},"get")});var UR=Hv();Object.defineProperty(v,"EffortSortingHelpers",{enumerable:!0,get:o(function(){return UR.EffortSortingHelpers},"get")});var BR=Yv();Object.defineProperty(v,"FilenameValidator",{enumerable:!0,get:o(function(){return BR.FilenameValidator},"get")});var qR=tw();Object.defineProperty(v,"RDFSerializer",{enumerable:!0,get:o(function(){return qR.RDFSerializer},"get")});var GR=rw();Object.defineProperty(v,"InMemoryTripleStore",{enumerable:!0,get:o(function(){return GR.InMemoryTripleStore},"get")});var WR=tg();Object.defineProperty(v,"RDFVocabularyMapper",{enumerable:!0,get:o(function(){return WR.RDFVocabularyMapper},"get")});var zR=ng();Object.defineProperty(v,"NoteToRDFConverter",{enumerable:!0,get:o(function(){return zR.NoteToRDFConverter},"get")});var A_=Tw();Object.defineProperty(v,"SPARQLParser",{enumerable:!0,get:o(function(){return A_.SPARQLParser},"get")});Object.defineProperty(v,"SPARQLParseError",{enumerable:!0,get:o(function(){return A_.SPARQLParseError},"get")});var C_=wg();Object.defineProperty(v,"DescribeOptionsTransformer",{enumerable:!0,get:o(function(){return C_.DescribeOptionsTransformer},"get")});Object.defineProperty(v,"DescribeOptionsTransformerError",{enumerable:!0,get:o(function(){return C_.DescribeOptionsTransformerError},"get")});var HR=Cw();Object.defineProperty(v,"AlgebraTranslator",{enumerable:!0,get:o(function(){return HR.AlgebraTranslator},"get")});var YR=xw();Object.defineProperty(v,"AlgebraOptimizer",{enumerable:!0,get:o(function(){return YR.AlgebraOptimizer},"get")});var QR=Iw();Object.defineProperty(v,"AlgebraSerializer",{enumerable:!0,get:o(function(){return QR.AlgebraSerializer},"get")});var KR=kg();Object.defineProperty(v,"BGPExecutor",{enumerable:!0,get:o(function(){return KR.BGPExecutor},"get")});var XR=th();Object.defineProperty(v,"FilterExecutor",{enumerable:!0,get:o(function(){return XR.FilterExecutor},"get")});var JR=Ug();Object.defineProperty(v,"OptionalExecutor",{enumerable:!0,get:o(function(){return JR.OptionalExecutor},"get")});var ZR=qg();Object.defineProperty(v,"UnionExecutor",{enumerable:!0,get:o(function(){return ZR.UnionExecutor},"get")});var e5=Hg();Object.defineProperty(v,"ConstructExecutor",{enumerable:!0,get:o(function(){return e5.ConstructExecutor},"get")});var t5=Lw();Object.defineProperty(v,"DescribeExecutor",{enumerable:!0,get:o(function(){return t5.DescribeExecutor},"get")});var r5=Hw();Object.defineProperty(v,"QueryExecutor",{enumerable:!0,get:o(function(){return r5.QueryExecutor},"get")});var x_=Qw();Object.defineProperty(v,"UpdateExecutor",{enumerable:!0,get:o(function(){return x_.UpdateExecutor},"get")});Object.defineProperty(v,"UpdateExecutorError",{enumerable:!0,get:o(function(){return x_.UpdateExecutorError},"get")});var n5=yi();Object.defineProperty(v,"SolutionMapping",{enumerable:!0,get:o(function(){return n5.SolutionMapping},"get")});var i5=Mg();Object.defineProperty(v,"BuiltInFunctions",{enumerable:!0,get:o(function(){return i5.BuiltInFunctions},"get")});var s5=Xw();Object.defineProperty(v,"AggregateFunctions",{enumerable:!0,get:o(function(){return s5.AggregateFunctions},"get")});var I_=Xg();Object.defineProperty(v,"CustomAggregateRegistry",{enumerable:!0,get:o(function(){return I_.CustomAggregateRegistry},"get")});Object.defineProperty(v,"CustomAggregateError",{enumerable:!0,get:o(function(){return I_.CustomAggregateError},"get")});var Hn=Jg();Object.defineProperty(v,"BUILT_IN_AGGREGATES",{enumerable:!0,get:o(function(){return Hn.BUILT_IN_AGGREGATES},"get")});Object.defineProperty(v,"EXO_AGGREGATE_NS",{enumerable:!0,get:o(function(){return Hn.EXO_AGGREGATE_NS},"get")});Object.defineProperty(v,"medianAggregate",{enumerable:!0,get:o(function(){return Hn.medianAggregate},"get")});Object.defineProperty(v,"varianceAggregate",{enumerable:!0,get:o(function(){return Hn.varianceAggregate},"get")});Object.defineProperty(v,"stddevAggregate",{enumerable:!0,get:o(function(){return Hn.stddevAggregate},"get")});Object.defineProperty(v,"modeAggregate",{enumerable:!0,get:o(function(){return Hn.modeAggregate},"get")});Object.defineProperty(v,"createPercentileAggregate",{enumerable:!0,get:o(function(){return Hn.createPercentileAggregate},"get")});Object.defineProperty(v,"getNumericValue",{enumerable:!0,get:o(function(){return Hn.getNumericValue},"get")});Object.defineProperty(v,"createDecimalLiteral",{enumerable:!0,get:o(function(){return Hn.createDecimalLiteral},"get")});Object.defineProperty(v,"createDoubleLiteral",{enumerable:!0,get:o(function(){return Hn.createDoubleLiteral},"get")});var a5=Jw();Object.defineProperty(v,"QueryPlanCache",{enumerable:!0,get:o(function(){return a5.QueryPlanCache},"get")});var O_=Zw();Object.defineProperty(v,"SPARQLResultCache",{enumerable:!0,get:o(function(){return O_.SPARQLResultCache},"get")});Object.defineProperty(v,"createSPARQLResultCache",{enumerable:!0,get:o(function(){return O_.createSPARQLResultCache},"get")});var D_=e_();Object.defineProperty(v,"IncrementalIndexer",{enumerable:!0,get:o(function(){return D_.IncrementalIndexer},"get")});Object.defineProperty(v,"createIncrementalIndexer",{enumerable:!0,get:o(function(){return D_.createIncrementalIndexer},"get")});var o5=t_();Object.defineProperty(v,"ResultSerializer",{enumerable:!0,get:o(function(){return o5.ResultSerializer},"get")});var P_=gg();Object.defineProperty(v,"CaseWhenTransformer",{enumerable:!0,get:o(function(){return P_.CaseWhenTransformer},"get")});Object.defineProperty(v,"CaseWhenTransformerError",{enumerable:!0,get:o(function(){return P_.CaseWhenTransformerError},"get")});var c5=Og();Object.defineProperty(v,"FilterContainsOptimizer",{enumerable:!0,get:o(function(){return c5.FilterContainsOptimizer},"get")});var F_=r_();Object.defineProperty(v,"FileNotFoundError",{enumerable:!0,get:o(function(){return F_.FileNotFoundError},"get")});Object.defineProperty(v,"FileAlreadyExistsError",{enumerable:!0,get:o(function(){return F_.FileAlreadyExistsError},"get")});var P0=Km();Object.defineProperty(v,"TripleAlreadyExistsError",{enumerable:!0,get:o(function(){return P0.TripleAlreadyExistsError},"get")});Object.defineProperty(v,"TripleNotFoundError",{enumerable:!0,get:o(function(){return P0.TripleNotFoundError},"get")});Object.defineProperty(v,"TransactionError",{enumerable:!0,get:o(function(){return P0.TransactionError},"get")});var u5=ot();Object.defineProperty(v,"DI_TOKENS",{enumerable:!0,get:o(function(){return u5.DI_TOKENS},"get")});var hc=n_();Object.defineProperty(v,"registerCoreServices",{enumerable:!0,get:o(function(){return hc.registerCoreServices},"get")});Object.defineProperty(v,"createChildContainer",{enumerable:!0,get:o(function(){return hc.createChildContainer},"get")});Object.defineProperty(v,"getContainer",{enumerable:!0,get:o(function(){return hc.getContainer},"get")});Object.defineProperty(v,"resetContainer",{enumerable:!0,get:o(function(){return hc.resetContainer},"get")});Object.defineProperty(v,"container",{enumerable:!0,get:o(function(){return hc.container},"get")});var vi=u_();Object.defineProperty(v,"NODE_FLAGS",{enumerable:!0,get:o(function(){return vi.NODE_FLAGS},"get")});Object.defineProperty(v,"DEFAULT_COLORS",{enumerable:!0,get:o(function(){return vi.DEFAULT_COLORS},"get")});Object.defineProperty(v,"StringTable",{enumerable:!0,get:o(function(){return vi.StringTable},"get")});Object.defineProperty(v,"CompactGraphStore",{enumerable:!0,get:o(function(){return vi.CompactGraphStore},"get")});Object.defineProperty(v,"MemoryPool",{enumerable:!0,get:o(function(){return vi.MemoryPool},"get")});Object.defineProperty(v,"getGlobalPool",{enumerable:!0,get:o(function(){return vi.getGlobalPool},"get")});Object.defineProperty(v,"resetGlobalPool",{enumerable:!0,get:o(function(){return vi.resetGlobalPool},"get")});Object.defineProperty(v,"StreamingLoader",{enumerable:!0,get:o(function(){return vi.StreamingLoader},"get")});Object.defineProperty(v,"createStreamingSource",{enumerable:!0,get:o(function(){return vi.createStreamingSource},"get")});En(v_(),v);En(__(),v)});var Dt=y(F0=>{"use strict";F0.fromCallback=function(n){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")n.apply(this,e);else return new Promise((t,r)=>{e.push((i,s)=>i!=null?r(i):t(s)),n.apply(this,e)})},"name",{value:n.name})};F0.fromPromise=function(n){return Object.defineProperty(function(...e){let t=e[e.length-1];if(typeof t!="function")return n.apply(this,e);e.pop(),n.apply(this,e).then(r=>t(null,r),t)},"name",{value:n.name})}});var N_=y((bq,R_)=>{var Wi=require("constants"),l5=process.cwd,Nh=null,h5=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return Nh||(Nh=l5.call(process)),Nh};try{process.cwd()}catch{}typeof process.chdir=="function"&&(R0=process.chdir,process.chdir=function(n){Nh=null,R0.call(process,n)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,R0));var R0;R_.exports=f5;function f5(n){Wi.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(n),n.lutimes||t(n),n.chown=s(n.chown),n.fchown=s(n.fchown),n.lchown=s(n.lchown),n.chmod=r(n.chmod),n.fchmod=r(n.fchmod),n.lchmod=r(n.lchmod),n.chownSync=a(n.chownSync),n.fchownSync=a(n.fchownSync),n.lchownSync=a(n.lchownSync),n.chmodSync=i(n.chmodSync),n.fchmodSync=i(n.fchmodSync),n.lchmodSync=i(n.lchmodSync),n.stat=c(n.stat),n.fstat=c(n.fstat),n.lstat=c(n.lstat),n.statSync=u(n.statSync),n.fstatSync=u(n.fstatSync),n.lstatSync=u(n.lstatSync),n.chmod&&!n.lchmod&&(n.lchmod=function(h,f,d){d&&process.nextTick(d)},n.lchmodSync=function(){}),n.chown&&!n.lchown&&(n.lchown=function(h,f,d,m){m&&process.nextTick(m)},n.lchownSync=function(){}),h5==="win32"&&(n.rename=typeof n.rename!="function"?n.rename:(function(h){function f(d,m,_){var S=Date.now(),A=0;h(d,m,o(function I(D){if(D&&(D.code==="EACCES"||D.code==="EPERM"||D.code==="EBUSY")&&Date.now()-S<6e4){setTimeout(function(){n.stat(m,function(L,G){L&&L.code==="ENOENT"?h(d,m,I):_(D)})},A),A<100&&(A+=10);return}_&&_(D)},"CB"))}return o(f,"rename"),Object.setPrototypeOf&&Object.setPrototypeOf(f,h),f})(n.rename)),n.read=typeof n.read!="function"?n.read:(function(h){function f(d,m,_,S,A,I){var D;if(I&&typeof I=="function"){var L=0;D=o(function(G,W,Fe){if(G&&G.code==="EAGAIN"&&L<10)return L++,h.call(n,d,m,_,S,A,D);I.apply(this,arguments)},"callback")}return h.call(n,d,m,_,S,A,D)}return o(f,"read"),Object.setPrototypeOf&&Object.setPrototypeOf(f,h),f})(n.read),n.readSync=typeof n.readSync!="function"?n.readSync:(function(h){return function(f,d,m,_,S){for(var A=0;;)try{return h.call(n,f,d,m,_,S)}catch(I){if(I.code==="EAGAIN"&&A<10){A++;continue}throw I}}})(n.readSync);function e(h){h.lchmod=function(f,d,m){h.open(f,Wi.O_WRONLY|Wi.O_SYMLINK,d,function(_,S){if(_){m&&m(_);return}h.fchmod(S,d,function(A){h.close(S,function(I){m&&m(A||I)})})})},h.lchmodSync=function(f,d){var m=h.openSync(f,Wi.O_WRONLY|Wi.O_SYMLINK,d),_=!0,S;try{S=h.fchmodSync(m,d),_=!1}finally{if(_)try{h.closeSync(m)}catch{}else h.closeSync(m)}return S}}o(e,"patchLchmod");function t(h){Wi.hasOwnProperty("O_SYMLINK")&&h.futimes?(h.lutimes=function(f,d,m,_){h.open(f,Wi.O_SYMLINK,function(S,A){if(S){_&&_(S);return}h.futimes(A,d,m,function(I){h.close(A,function(D){_&&_(I||D)})})})},h.lutimesSync=function(f,d,m){var _=h.openSync(f,Wi.O_SYMLINK),S,A=!0;try{S=h.futimesSync(_,d,m),A=!1}finally{if(A)try{h.closeSync(_)}catch{}else h.closeSync(_)}return S}):h.futimes&&(h.lutimes=function(f,d,m,_){_&&process.nextTick(_)},h.lutimesSync=function(){})}o(t,"patchLutimes");function r(h){return h&&function(f,d,m){return h.call(n,f,d,function(_){l(_)&&(_=null),m&&m.apply(this,arguments)})}}o(r,"chmodFix");function i(h){return h&&function(f,d){try{return h.call(n,f,d)}catch(m){if(!l(m))throw m}}}o(i,"chmodFixSync");function s(h){return h&&function(f,d,m,_){return h.call(n,f,d,m,function(S){l(S)&&(S=null),_&&_.apply(this,arguments)})}}o(s,"chownFix");function a(h){return h&&function(f,d,m){try{return h.call(n,f,d,m)}catch(_){if(!l(_))throw _}}}o(a,"chownFixSync");function c(h){return h&&function(f,d,m){typeof d=="function"&&(m=d,d=null);function _(S,A){A&&(A.uid<0&&(A.uid+=4294967296),A.gid<0&&(A.gid+=4294967296)),m&&m.apply(this,arguments)}return o(_,"callback"),d?h.call(n,f,d,_):h.call(n,f,_)}}o(c,"statFix");function u(h){return h&&function(f,d){var m=d?h.call(n,f,d):h.call(n,f);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}o(u,"statFixSync");function l(h){if(!h||h.code==="ENOSYS")return!0;var f=!process.getuid||process.getuid()!==0;return!!(f&&(h.code==="EINVAL"||h.code==="EPERM"))}o(l,"chownErOk")}o(f5,"patch")});var j_=y((Tq,k_)=>{var L_=require("stream").Stream;k_.exports=d5;function d5(n){return{ReadStream:e,WriteStream:t};function e(r,i){if(!(this instanceof e))return new e(r,i);L_.call(this);var s=this;this.path=r,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var a=Object.keys(i),c=0,u=a.length;c<u;c++){var l=a[c];this[l]=i[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){s._read()});return}n.open(this.path,this.flags,this.mode,function(h,f){if(h){s.emit("error",h),s.readable=!1;return}s.fd=f,s.emit("open",f),s._read()})}function t(r,i){if(!(this instanceof t))return new t(r,i);L_.call(this),this.path=r,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var s=Object.keys(i),a=0,c=s.length;a<c;a++){var u=s[a];this[u]=i[u]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=n.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}o(d5,"legacy")});var V_=y((Cq,M_)=>{"use strict";M_.exports=m5;var p5=Object.getPrototypeOf||function(n){return n.__proto__};function m5(n){if(n===null||typeof n!="object")return n;if(n instanceof Object)var e={__proto__:p5(n)};else var e=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}o(m5,"clone")});var Ja=y((Iq,k0)=>{var ht=require("fs"),g5=N_(),y5=j_(),v5=V_(),Lh=require("util"),qt,jh;typeof Symbol=="function"&&typeof Symbol.for=="function"?(qt=Symbol.for("graceful-fs.queue"),jh=Symbol.for("graceful-fs.previous")):(qt="___graceful-fs.queue",jh="___graceful-fs.previous");function w5(){}o(w5,"noop");function B_(n,e){Object.defineProperty(n,qt,{get:o(function(){return e},"get")})}o(B_,"publishQueue");var qs=w5;Lh.debuglog?qs=Lh.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(qs=o(function(){var n=Lh.format.apply(Lh,arguments);n="GFS4: "+n.split(/\n/).join(`
GFS4: `),console.error(n)},"debug"));ht[qt]||($_=global[qt]||[],B_(ht,$_),ht.close=(function(n){function e(t,r){return n.call(ht,t,function(i){i||U_(),typeof r=="function"&&r.apply(this,arguments)})}return o(e,"close"),Object.defineProperty(e,jh,{value:n}),e})(ht.close),ht.closeSync=(function(n){function e(t){n.apply(ht,arguments),U_()}return o(e,"closeSync"),Object.defineProperty(e,jh,{value:n}),e})(ht.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){qs(ht[qt]),require("assert").equal(ht[qt].length,0)}));var $_;global[qt]||B_(global,ht[qt]);k0.exports=N0(v5(ht));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!ht.__patched&&(k0.exports=N0(ht),ht.__patched=!0);function N0(n){g5(n),n.gracefulify=N0,n.createReadStream=W,n.createWriteStream=Fe;var e=n.readFile;n.readFile=t;function t(U,ue,Se){return typeof ue=="function"&&(Se=ue,ue=null),Ke(U,ue,Se);function Ke(Ge,tt,ke,je){return e(Ge,tt,function(Re){Re&&(Re.code==="EMFILE"||Re.code==="ENFILE")?Xa([Ke,[Ge,tt,ke],Re,je||Date.now(),Date.now()]):typeof ke=="function"&&ke.apply(this,arguments)})}o(Ke,"go$readFile")}o(t,"readFile");var r=n.writeFile;n.writeFile=i;function i(U,ue,Se,Ke){return typeof Se=="function"&&(Ke=Se,Se=null),Ge(U,ue,Se,Ke);function Ge(tt,ke,je,Re,H){return r(tt,ke,je,function(k){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Xa([Ge,[tt,ke,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(Ge,"go$writeFile")}o(i,"writeFile");var s=n.appendFile;s&&(n.appendFile=a);function a(U,ue,Se,Ke){return typeof Se=="function"&&(Ke=Se,Se=null),Ge(U,ue,Se,Ke);function Ge(tt,ke,je,Re,H){return s(tt,ke,je,function(k){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Xa([Ge,[tt,ke,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(Ge,"go$appendFile")}o(a,"appendFile");var c=n.copyFile;c&&(n.copyFile=u);function u(U,ue,Se,Ke){return typeof Se=="function"&&(Ke=Se,Se=0),Ge(U,ue,Se,Ke);function Ge(tt,ke,je,Re,H){return c(tt,ke,je,function(k){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Xa([Ge,[tt,ke,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(Ge,"go$copyFile")}o(u,"copyFile");var l=n.readdir;n.readdir=f;var h=/^v[0-5]\./;function f(U,ue,Se){typeof ue=="function"&&(Se=ue,ue=null);var Ke=h.test(process.version)?o(function(ke,je,Re,H){return l(ke,Ge(ke,je,Re,H))},"go$readdir"):o(function(ke,je,Re,H){return l(ke,je,Ge(ke,je,Re,H))},"go$readdir");return Ke(U,ue,Se);function Ge(tt,ke,je,Re){return function(H,k){H&&(H.code==="EMFILE"||H.code==="ENFILE")?Xa([Ke,[tt,ke,je],H,Re||Date.now(),Date.now()]):(k&&k.sort&&k.sort(),typeof je=="function"&&je.call(this,H,k))}}}if(o(f,"readdir"),process.version.substr(0,4)==="v0.8"){var d=y5(n);I=d.ReadStream,L=d.WriteStream}var m=n.ReadStream;m&&(I.prototype=Object.create(m.prototype),I.prototype.open=D);var _=n.WriteStream;_&&(L.prototype=Object.create(_.prototype),L.prototype.open=G),Object.defineProperty(n,"ReadStream",{get:o(function(){return I},"get"),set:o(function(U){I=U},"set"),enumerable:!0,configurable:!0}),Object.defineProperty(n,"WriteStream",{get:o(function(){return L},"get"),set:o(function(U){L=U},"set"),enumerable:!0,configurable:!0});var S=I;Object.defineProperty(n,"FileReadStream",{get:o(function(){return S},"get"),set:o(function(U){S=U},"set"),enumerable:!0,configurable:!0});var A=L;Object.defineProperty(n,"FileWriteStream",{get:o(function(){return A},"get"),set:o(function(U){A=U},"set"),enumerable:!0,configurable:!0});function I(U,ue){return this instanceof I?(m.apply(this,arguments),this):I.apply(Object.create(I.prototype),arguments)}o(I,"ReadStream");function D(){var U=this;ct(U.path,U.flags,U.mode,function(ue,Se){ue?(U.autoClose&&U.destroy(),U.emit("error",ue)):(U.fd=Se,U.emit("open",Se),U.read())})}o(D,"ReadStream$open");function L(U,ue){return this instanceof L?(_.apply(this,arguments),this):L.apply(Object.create(L.prototype),arguments)}o(L,"WriteStream");function G(){var U=this;ct(U.path,U.flags,U.mode,function(ue,Se){ue?(U.destroy(),U.emit("error",ue)):(U.fd=Se,U.emit("open",Se))})}o(G,"WriteStream$open");function W(U,ue){return new n.ReadStream(U,ue)}o(W,"createReadStream");function Fe(U,ue){return new n.WriteStream(U,ue)}o(Fe,"createWriteStream");var et=n.open;n.open=ct;function ct(U,ue,Se,Ke){return typeof Se=="function"&&(Ke=Se,Se=null),Ge(U,ue,Se,Ke);function Ge(tt,ke,je,Re,H){return et(tt,ke,je,function(k,Me){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Xa([Ge,[tt,ke,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(Ge,"go$open")}return o(ct,"open"),n}o(N0,"patch");function Xa(n){qs("ENQUEUE",n[0].name,n[1]),ht[qt].push(n),L0()}o(Xa,"enqueue");var kh;function U_(){for(var n=Date.now(),e=0;e<ht[qt].length;++e)ht[qt][e].length>2&&(ht[qt][e][3]=n,ht[qt][e][4]=n);L0()}o(U_,"resetQueue");function L0(){if(clearTimeout(kh),kh=void 0,ht[qt].length!==0){var n=ht[qt].shift(),e=n[0],t=n[1],r=n[2],i=n[3],s=n[4];if(i===void 0)qs("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){qs("TIMEOUT",e.name,t);var a=t.pop();typeof a=="function"&&a.call(null,r)}else{var c=Date.now()-s,u=Math.max(s-i,1),l=Math.min(u*1.2,100);c>=l?(qs("RETRY",e.name,t),e.apply(null,t.concat([i]))):ht[qt].push(n)}kh===void 0&&(kh=setTimeout(L0,0))}}o(L0,"retry")});var pr=y(wi=>{"use strict";var q_=Dt().fromCallback,dr=Ja(),_5=["access","appendFile","chmod","chown","close","copyFile","cp","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","glob","lchmod","lchown","lutimes","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","statfs","symlink","truncate","unlink","utimes","writeFile"].filter(n=>typeof dr[n]=="function");Object.assign(wi,dr);_5.forEach(n=>{wi[n]=q_(dr[n])});wi.exists=function(n,e){return typeof e=="function"?dr.exists(n,e):new Promise(t=>dr.exists(n,t))};wi.read=function(n,e,t,r,i,s){return typeof s=="function"?dr.read(n,e,t,r,i,s):new Promise((a,c)=>{dr.read(n,e,t,r,i,(u,l,h)=>{if(u)return c(u);a({bytesRead:l,buffer:h})})})};wi.write=function(n,e,...t){return typeof t[t.length-1]=="function"?dr.write(n,e,...t):new Promise((r,i)=>{dr.write(n,e,...t,(s,a,c)=>{if(s)return i(s);r({bytesWritten:a,buffer:c})})})};wi.readv=function(n,e,...t){return typeof t[t.length-1]=="function"?dr.readv(n,e,...t):new Promise((r,i)=>{dr.readv(n,e,...t,(s,a,c)=>{if(s)return i(s);r({bytesRead:a,buffers:c})})})};wi.writev=function(n,e,...t){return typeof t[t.length-1]=="function"?dr.writev(n,e,...t):new Promise((r,i)=>{dr.writev(n,e,...t,(s,a,c)=>{if(s)return i(s);r({bytesWritten:a,buffers:c})})})};typeof dr.realpath.native=="function"?wi.realpath.native=q_(dr.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var W_=y((Pq,G_)=>{"use strict";var S5=require("path");G_.exports.checkPath=o(function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(S5.parse(e).root,""))){let r=new Error(`Path contains invalid characters: ${e}`);throw r.code="EINVAL",r}},"checkPath")});var Q_=y((Rq,j0)=>{"use strict";var z_=pr(),{checkPath:H_}=W_(),Y_=o(n=>{let e={mode:511};return typeof n=="number"?n:{...e,...n}.mode},"getMode");j0.exports.makeDir=async(n,e)=>(H_(n),z_.mkdir(n,{mode:Y_(e),recursive:!0}));j0.exports.makeDirSync=(n,e)=>(H_(n),z_.mkdirSync(n,{mode:Y_(e),recursive:!0}))});var Tn=y((Lq,K_)=>{"use strict";var b5=Dt().fromPromise,{makeDir:E5,makeDirSync:M0}=Q_(),V0=b5(E5);K_.exports={mkdirs:V0,mkdirsSync:M0,mkdirp:V0,mkdirpSync:M0,ensureDir:V0,ensureDirSync:M0}});var zi=y((kq,J_)=>{"use strict";var T5=Dt().fromPromise,X_=pr();function A5(n){return X_.access(n).then(()=>!0).catch(()=>!1)}o(A5,"pathExists");J_.exports={pathExists:T5(A5),pathExistsSync:X_.existsSync}});var $0=y((Mq,Z_)=>{"use strict";var Za=pr(),C5=Dt().fromPromise;async function x5(n,e,t){let r=await Za.open(n,"r+"),i=null;try{await Za.futimes(r,e,t)}finally{try{await Za.close(r)}catch(s){i=s}}if(i)throw i}o(x5,"utimesMillis");function I5(n,e,t){let r=Za.openSync(n,"r+");return Za.futimesSync(r,e,t),Za.closeSync(r)}o(I5,"utimesMillisSync");Z_.exports={utimesMillis:C5(x5),utimesMillisSync:I5}});var Gs=y(($q,n3)=>{"use strict";var eo=pr(),Pt=require("path"),e3=Dt().fromPromise;function O5(n,e,t){let r=t.dereference?i=>eo.stat(i,{bigint:!0}):i=>eo.lstat(i,{bigint:!0});return Promise.all([r(n),r(e).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,s])=>({srcStat:i,destStat:s}))}o(O5,"getStats");function D5(n,e,t){let r,i=t.dereference?a=>eo.statSync(a,{bigint:!0}):a=>eo.lstatSync(a,{bigint:!0}),s=i(n);try{r=i(e)}catch(a){if(a.code==="ENOENT")return{srcStat:s,destStat:null};throw a}return{srcStat:s,destStat:r}}o(D5,"getStatsSync");async function P5(n,e,t,r){let{srcStat:i,destStat:s}=await O5(n,e,r);if(s){if(fc(i,s)){let a=Pt.basename(n),c=Pt.basename(e);if(t==="move"&&a!==c&&a.toLowerCase()===c.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${n}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${n}'.`)}if(i.isDirectory()&&U0(n,e))throw new Error(Mh(n,e,t));return{srcStat:i,destStat:s}}o(P5,"checkPaths");function F5(n,e,t,r){let{srcStat:i,destStat:s}=D5(n,e,r);if(s){if(fc(i,s)){let a=Pt.basename(n),c=Pt.basename(e);if(t==="move"&&a!==c&&a.toLowerCase()===c.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${n}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${n}'.`)}if(i.isDirectory()&&U0(n,e))throw new Error(Mh(n,e,t));return{srcStat:i,destStat:s}}o(F5,"checkPathsSync");async function t3(n,e,t,r){let i=Pt.resolve(Pt.dirname(n)),s=Pt.resolve(Pt.dirname(t));if(s===i||s===Pt.parse(s).root)return;let a;try{a=await eo.stat(s,{bigint:!0})}catch(c){if(c.code==="ENOENT")return;throw c}if(fc(e,a))throw new Error(Mh(n,t,r));return t3(n,e,s,r)}o(t3,"checkParentPaths");function r3(n,e,t,r){let i=Pt.resolve(Pt.dirname(n)),s=Pt.resolve(Pt.dirname(t));if(s===i||s===Pt.parse(s).root)return;let a;try{a=eo.statSync(s,{bigint:!0})}catch(c){if(c.code==="ENOENT")return;throw c}if(fc(e,a))throw new Error(Mh(n,t,r));return r3(n,e,s,r)}o(r3,"checkParentPathsSync");function fc(n,e){return e.ino!==void 0&&e.dev!==void 0&&e.ino===n.ino&&e.dev===n.dev}o(fc,"areIdentical");function U0(n,e){let t=Pt.resolve(n).split(Pt.sep).filter(i=>i),r=Pt.resolve(e).split(Pt.sep).filter(i=>i);return t.every((i,s)=>r[s]===i)}o(U0,"isSrcSubdir");function Mh(n,e,t){return`Cannot ${t} '${n}' to a subdirectory of itself, '${e}'.`}o(Mh,"errMsg");n3.exports={checkPaths:e3(P5),checkPathsSync:F5,checkParentPaths:e3(t3),checkParentPathsSync:r3,isSrcSubdir:U0,areIdentical:fc}});var s3=y((Bq,i3)=>{"use strict";async function R5(n,e){let t=[];for await(let r of n)t.push(e(r).then(()=>null,i=>i??new Error("unknown error")));await Promise.all(t.map(r=>r.then(i=>{if(i!==null)throw i})))}o(R5,"asyncIteratorConcurrentProcess");i3.exports={asyncIteratorConcurrentProcess:R5}});var l3=y((Gq,u3)=>{"use strict";var Zt=pr(),dc=require("path"),{mkdirs:N5}=Tn(),{pathExists:L5}=zi(),{utimesMillis:k5}=$0(),pc=Gs(),{asyncIteratorConcurrentProcess:j5}=s3();async function M5(n,e,t={}){typeof t=="function"&&(t={filter:t}),t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001");let{srcStat:r,destStat:i}=await pc.checkPaths(n,e,"copy",t);if(await pc.checkParentPaths(n,r,e,"copy"),!await o3(n,e,t))return;let a=dc.dirname(e);await L5(a)||await N5(a),await c3(i,n,e,t)}o(M5,"copy");async function o3(n,e,t){return t.filter?t.filter(n,e):!0}o(o3,"runFilter");async function c3(n,e,t,r){let s=await(r.dereference?Zt.stat:Zt.lstat)(e);if(s.isDirectory())return B5(s,n,e,t,r);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return V5(s,n,e,t,r);if(s.isSymbolicLink())return q5(n,e,t,r);throw s.isSocket()?new Error(`Cannot copy a socket file: ${e}`):s.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}o(c3,"getStatsAndPerformCopy");async function V5(n,e,t,r,i){if(!e)return a3(n,t,r,i);if(i.overwrite)return await Zt.unlink(r),a3(n,t,r,i);if(i.errorOnExist)throw new Error(`'${r}' already exists`)}o(V5,"onFile");async function a3(n,e,t,r){if(await Zt.copyFile(e,t),r.preserveTimestamps){$5(n.mode)&&await U5(t,n.mode);let i=await Zt.stat(e);await k5(t,i.atime,i.mtime)}return Zt.chmod(t,n.mode)}o(a3,"copyFile");function $5(n){return(n&128)===0}o($5,"fileIsNotWritable");function U5(n,e){return Zt.chmod(n,e|128)}o(U5,"makeFileWritable");async function B5(n,e,t,r,i){e||await Zt.mkdir(r),await j5(await Zt.opendir(t),async s=>{let a=dc.join(t,s.name),c=dc.join(r,s.name);if(await o3(a,c,i)){let{destStat:l}=await pc.checkPaths(a,c,"copy",i);await c3(l,a,c,i)}}),e||await Zt.chmod(r,n.mode)}o(B5,"onDir");async function q5(n,e,t,r){let i=await Zt.readlink(e);if(r.dereference&&(i=dc.resolve(process.cwd(),i)),!n)return Zt.symlink(i,t);let s=null;try{s=await Zt.readlink(t)}catch(a){if(a.code==="EINVAL"||a.code==="UNKNOWN")return Zt.symlink(i,t);throw a}if(r.dereference&&(s=dc.resolve(process.cwd(),s)),pc.isSrcSubdir(i,s))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${s}'.`);if(pc.isSrcSubdir(s,i))throw new Error(`Cannot overwrite '${s}' with '${i}'.`);return await Zt.unlink(t),Zt.symlink(i,t)}o(q5,"onLink");u3.exports=M5});var m3=y((zq,p3)=>{"use strict";var mr=Ja(),mc=require("path"),G5=Tn().mkdirsSync,W5=$0().utimesMillisSync,gc=Gs();function z5(n,e,t){typeof t=="function"&&(t={filter:t}),t=t||{},t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:r,destStat:i}=gc.checkPathsSync(n,e,"copy",t);if(gc.checkParentPathsSync(n,r,e,"copy"),t.filter&&!t.filter(n,e))return;let s=mc.dirname(e);return mr.existsSync(s)||G5(s),h3(i,n,e,t)}o(z5,"copySync");function h3(n,e,t,r){let s=(r.dereference?mr.statSync:mr.lstatSync)(e);if(s.isDirectory())return Z5(s,n,e,t,r);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return H5(s,n,e,t,r);if(s.isSymbolicLink())return rN(n,e,t,r);throw s.isSocket()?new Error(`Cannot copy a socket file: ${e}`):s.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}o(h3,"getStats");function H5(n,e,t,r,i){return e?Y5(n,t,r,i):f3(n,t,r,i)}o(H5,"onFile");function Y5(n,e,t,r){if(r.overwrite)return mr.unlinkSync(t),f3(n,e,t,r);if(r.errorOnExist)throw new Error(`'${t}' already exists`)}o(Y5,"mayCopyFile");function f3(n,e,t,r){return mr.copyFileSync(e,t),r.preserveTimestamps&&Q5(n.mode,e,t),B0(t,n.mode)}o(f3,"copyFile");function Q5(n,e,t){return K5(n)&&X5(t,n),J5(e,t)}o(Q5,"handleTimestamps");function K5(n){return(n&128)===0}o(K5,"fileIsNotWritable");function X5(n,e){return B0(n,e|128)}o(X5,"makeFileWritable");function B0(n,e){return mr.chmodSync(n,e)}o(B0,"setDestMode");function J5(n,e){let t=mr.statSync(n);return W5(e,t.atime,t.mtime)}o(J5,"setDestTimestamps");function Z5(n,e,t,r,i){return e?d3(t,r,i):eN(n.mode,t,r,i)}o(Z5,"onDir");function eN(n,e,t,r){return mr.mkdirSync(t),d3(e,t,r),B0(t,n)}o(eN,"mkDirAndCopy");function d3(n,e,t){let r=mr.opendirSync(n);try{let i;for(;(i=r.readSync())!==null;)tN(i.name,n,e,t)}finally{r.closeSync()}}o(d3,"copyDir");function tN(n,e,t,r){let i=mc.join(e,n),s=mc.join(t,n);if(r.filter&&!r.filter(i,s))return;let{destStat:a}=gc.checkPathsSync(i,s,"copy",r);return h3(a,i,s,r)}o(tN,"copyDirItem");function rN(n,e,t,r){let i=mr.readlinkSync(e);if(r.dereference&&(i=mc.resolve(process.cwd(),i)),n){let s;try{s=mr.readlinkSync(t)}catch(a){if(a.code==="EINVAL"||a.code==="UNKNOWN")return mr.symlinkSync(i,t);throw a}if(r.dereference&&(s=mc.resolve(process.cwd(),s)),gc.isSrcSubdir(i,s))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${s}'.`);if(gc.isSrcSubdir(s,i))throw new Error(`Cannot overwrite '${s}' with '${i}'.`);return nN(i,t)}else return mr.symlinkSync(i,t)}o(rN,"onLink");function nN(n,e){return mr.unlinkSync(e),mr.symlinkSync(n,e)}o(nN,"copyLink");p3.exports=z5});var Vh=y((Yq,g3)=>{"use strict";var iN=Dt().fromPromise;g3.exports={copy:iN(l3()),copySync:m3()}});var yc=y((Qq,v3)=>{"use strict";var y3=Ja(),sN=Dt().fromCallback;function aN(n,e){y3.rm(n,{recursive:!0,force:!0},e)}o(aN,"remove");function oN(n){y3.rmSync(n,{recursive:!0,force:!0})}o(oN,"removeSync");v3.exports={remove:sN(aN),removeSync:oN}});var C3=y((Xq,A3)=>{"use strict";var cN=Dt().fromPromise,S3=pr(),b3=require("path"),E3=Tn(),T3=yc(),w3=cN(o(async function(e){let t;try{t=await S3.readdir(e)}catch{return E3.mkdirs(e)}return Promise.all(t.map(r=>T3.remove(b3.join(e,r))))},"emptyDir"));function _3(n){let e;try{e=S3.readdirSync(n)}catch{return E3.mkdirsSync(n)}e.forEach(t=>{t=b3.join(n,t),T3.removeSync(t)})}o(_3,"emptyDirSync");A3.exports={emptyDirSync:_3,emptydirSync:_3,emptyDir:w3,emptydir:w3}});var D3=y((Zq,O3)=>{"use strict";var uN=Dt().fromPromise,x3=require("path"),_i=pr(),I3=Tn();async function lN(n){let e;try{e=await _i.stat(n)}catch{}if(e&&e.isFile())return;let t=x3.dirname(n),r=null;try{r=await _i.stat(t)}catch(i){if(i.code==="ENOENT"){await I3.mkdirs(t),await _i.writeFile(n,"");return}else throw i}r.isDirectory()?await _i.writeFile(n,""):await _i.readdir(t)}o(lN,"createFile");function hN(n){let e;try{e=_i.statSync(n)}catch{}if(e&&e.isFile())return;let t=x3.dirname(n);try{_i.statSync(t).isDirectory()||_i.readdirSync(t)}catch(r){if(r&&r.code==="ENOENT")I3.mkdirsSync(t);else throw r}_i.writeFileSync(n,"")}o(hN,"createFileSync");O3.exports={createFile:uN(lN),createFileSync:hN}});var L3=y((tG,N3)=>{"use strict";var fN=Dt().fromPromise,P3=require("path"),Hi=pr(),F3=Tn(),{pathExists:dN}=zi(),{areIdentical:R3}=Gs();async function pN(n,e){let t;try{t=await Hi.lstat(e)}catch{}let r;try{r=await Hi.lstat(n)}catch(a){throw a.message=a.message.replace("lstat","ensureLink"),a}if(t&&R3(r,t))return;let i=P3.dirname(e);await dN(i)||await F3.mkdirs(i),await Hi.link(n,e)}o(pN,"createLink");function mN(n,e){let t;try{t=Hi.lstatSync(e)}catch{}try{let s=Hi.lstatSync(n);if(t&&R3(s,t))return}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let r=P3.dirname(e);return Hi.existsSync(r)||F3.mkdirsSync(r),Hi.linkSync(n,e)}o(mN,"createLinkSync");N3.exports={createLink:fN(pN),createLinkSync:mN}});var j3=y((nG,k3)=>{"use strict";var Yi=require("path"),vc=pr(),{pathExists:gN}=zi(),yN=Dt().fromPromise;async function vN(n,e){if(Yi.isAbsolute(n)){try{await vc.lstat(n)}catch(s){throw s.message=s.message.replace("lstat","ensureSymlink"),s}return{toCwd:n,toDst:n}}let t=Yi.dirname(e),r=Yi.join(t,n);if(await gN(r))return{toCwd:r,toDst:n};try{await vc.lstat(n)}catch(s){throw s.message=s.message.replace("lstat","ensureSymlink"),s}return{toCwd:n,toDst:Yi.relative(t,n)}}o(vN,"symlinkPaths");function wN(n,e){if(Yi.isAbsolute(n)){if(!vc.existsSync(n))throw new Error("absolute srcpath does not exist");return{toCwd:n,toDst:n}}let t=Yi.dirname(e),r=Yi.join(t,n);if(vc.existsSync(r))return{toCwd:r,toDst:n};if(!vc.existsSync(n))throw new Error("relative srcpath does not exist");return{toCwd:n,toDst:Yi.relative(t,n)}}o(wN,"symlinkPathsSync");k3.exports={symlinkPaths:yN(vN),symlinkPathsSync:wN}});var $3=y((sG,V3)=>{"use strict";var M3=pr(),_N=Dt().fromPromise;async function SN(n,e){if(e)return e;let t;try{t=await M3.lstat(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}o(SN,"symlinkType");function bN(n,e){if(e)return e;let t;try{t=M3.lstatSync(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}o(bN,"symlinkTypeSync");V3.exports={symlinkType:_N(SN),symlinkTypeSync:bN}});var G3=y((oG,q3)=>{"use strict";var EN=Dt().fromPromise,U3=require("path"),Yn=pr(),{mkdirs:TN,mkdirsSync:AN}=Tn(),{symlinkPaths:CN,symlinkPathsSync:xN}=j3(),{symlinkType:IN,symlinkTypeSync:ON}=$3(),{pathExists:DN}=zi(),{areIdentical:B3}=Gs();async function PN(n,e,t){let r;try{r=await Yn.lstat(e)}catch{}if(r&&r.isSymbolicLink()){let[c,u]=await Promise.all([Yn.stat(n),Yn.stat(e)]);if(B3(c,u))return}let i=await CN(n,e);n=i.toDst;let s=await IN(i.toCwd,t),a=U3.dirname(e);return await DN(a)||await TN(a),Yn.symlink(n,e,s)}o(PN,"createSymlink");function FN(n,e,t){let r;try{r=Yn.lstatSync(e)}catch{}if(r&&r.isSymbolicLink()){let c=Yn.statSync(n),u=Yn.statSync(e);if(B3(c,u))return}let i=xN(n,e);n=i.toDst,t=ON(i.toCwd,t);let s=U3.dirname(e);return Yn.existsSync(s)||AN(s),Yn.symlinkSync(n,e,t)}o(FN,"createSymlinkSync");q3.exports={createSymlink:EN(PN),createSymlinkSync:FN}});var J3=y((uG,X3)=>{"use strict";var{createFile:W3,createFileSync:z3}=D3(),{createLink:H3,createLinkSync:Y3}=L3(),{createSymlink:Q3,createSymlinkSync:K3}=G3();X3.exports={createFile:W3,createFileSync:z3,ensureFile:W3,ensureFileSync:z3,createLink:H3,createLinkSync:Y3,ensureLink:H3,ensureLinkSync:Y3,createSymlink:Q3,createSymlinkSync:K3,ensureSymlink:Q3,ensureSymlinkSync:K3}});var $h=y((lG,Z3)=>{function RN(n,{EOL:e=`
`,finalEOL:t=!0,replacer:r=null,spaces:i}={}){let s=t?e:"";return JSON.stringify(n,r,i).replace(/\n/g,e)+s}o(RN,"stringify");function NN(n){return Buffer.isBuffer(n)&&(n=n.toString("utf8")),n.replace(/^\uFEFF/,"")}o(NN,"stripBom");Z3.exports={stringify:RN,stripBom:NN}});var nS=y((fG,rS)=>{var to;try{to=Ja()}catch{to=require("fs")}var Uh=Dt(),{stringify:eS,stripBom:tS}=$h();async function LN(n,e={}){typeof e=="string"&&(e={encoding:e});let t=e.fs||to,r="throws"in e?e.throws:!0,i=await Uh.fromCallback(t.readFile)(n,e);i=tS(i);let s;try{s=JSON.parse(i,e?e.reviver:null)}catch(a){if(r)throw a.message=`${n}: ${a.message}`,a;return null}return s}o(LN,"_readFile");var kN=Uh.fromPromise(LN);function jN(n,e={}){typeof e=="string"&&(e={encoding:e});let t=e.fs||to,r="throws"in e?e.throws:!0;try{let i=t.readFileSync(n,e);return i=tS(i),JSON.parse(i,e.reviver)}catch(i){if(r)throw i.message=`${n}: ${i.message}`,i;return null}}o(jN,"readFileSync");async function MN(n,e,t={}){let r=t.fs||to,i=eS(e,t);await Uh.fromCallback(r.writeFile)(n,i,t)}o(MN,"_writeFile");var VN=Uh.fromPromise(MN);function $N(n,e,t={}){let r=t.fs||to,i=eS(e,t);return r.writeFileSync(n,i,t)}o($N,"writeFileSync");rS.exports={readFile:kN,readFileSync:jN,writeFile:VN,writeFileSync:$N}});var sS=y((pG,iS)=>{"use strict";var Bh=nS();iS.exports={readJson:Bh.readFile,readJsonSync:Bh.readFileSync,writeJson:Bh.writeFile,writeJsonSync:Bh.writeFileSync}});var qh=y((mG,cS)=>{"use strict";var UN=Dt().fromPromise,q0=pr(),aS=require("path"),oS=Tn(),BN=zi().pathExists;async function qN(n,e,t="utf-8"){let r=aS.dirname(n);return await BN(r)||await oS.mkdirs(r),q0.writeFile(n,e,t)}o(qN,"outputFile");function GN(n,...e){let t=aS.dirname(n);q0.existsSync(t)||oS.mkdirsSync(t),q0.writeFileSync(n,...e)}o(GN,"outputFileSync");cS.exports={outputFile:UN(qN),outputFileSync:GN}});var lS=y((yG,uS)=>{"use strict";var{stringify:WN}=$h(),{outputFile:zN}=qh();async function HN(n,e,t={}){let r=WN(e,t);await zN(n,r,t)}o(HN,"outputJson");uS.exports=HN});var fS=y((wG,hS)=>{"use strict";var{stringify:YN}=$h(),{outputFileSync:QN}=qh();function KN(n,e,t){let r=YN(e,t);QN(n,r,t)}o(KN,"outputJsonSync");hS.exports=KN});var pS=y((SG,dS)=>{"use strict";var XN=Dt().fromPromise,gr=sS();gr.outputJson=XN(lS());gr.outputJsonSync=fS();gr.outputJSON=gr.outputJson;gr.outputJSONSync=gr.outputJsonSync;gr.writeJSON=gr.writeJson;gr.writeJSONSync=gr.writeJsonSync;gr.readJSON=gr.readJson;gr.readJSONSync=gr.readJsonSync;dS.exports=gr});var wS=y((bG,vS)=>{"use strict";var JN=pr(),mS=require("path"),{copy:ZN}=Vh(),{remove:yS}=yc(),{mkdirp:e9}=Tn(),{pathExists:t9}=zi(),gS=Gs();async function r9(n,e,t={}){let r=t.overwrite||t.clobber||!1,{srcStat:i,isChangingCase:s=!1}=await gS.checkPaths(n,e,"move",t);await gS.checkParentPaths(n,i,e,"move");let a=mS.dirname(e);return mS.parse(a).root!==a&&await e9(a),n9(n,e,r,s)}o(r9,"move");async function n9(n,e,t,r){if(!r){if(t)await yS(e);else if(await t9(e))throw new Error("dest already exists.")}try{await JN.rename(n,e)}catch(i){if(i.code!=="EXDEV")throw i;await i9(n,e,t)}}o(n9,"doRename");async function i9(n,e,t){return await ZN(n,e,{overwrite:t,errorOnExist:!0,preserveTimestamps:!0}),yS(n)}o(i9,"moveAcrossDevice");vS.exports=r9});var TS=y((TG,ES)=>{"use strict";var SS=Ja(),W0=require("path"),s9=Vh().copySync,bS=yc().removeSync,a9=Tn().mkdirpSync,_S=Gs();function o9(n,e,t){t=t||{};let r=t.overwrite||t.clobber||!1,{srcStat:i,isChangingCase:s=!1}=_S.checkPathsSync(n,e,"move",t);return _S.checkParentPathsSync(n,i,e,"move"),c9(e)||a9(W0.dirname(e)),u9(n,e,r,s)}o(o9,"moveSync");function c9(n){let e=W0.dirname(n);return W0.parse(e).root===e}o(c9,"isParentRoot");function u9(n,e,t,r){if(r)return G0(n,e,t);if(t)return bS(e),G0(n,e,t);if(SS.existsSync(e))throw new Error("dest already exists.");return G0(n,e,t)}o(u9,"doRename");function G0(n,e,t){try{SS.renameSync(n,e)}catch(r){if(r.code!=="EXDEV")throw r;return l9(n,e,t)}}o(G0,"rename");function l9(n,e,t){return s9(n,e,{overwrite:t,errorOnExist:!0,preserveTimestamps:!0}),bS(n)}o(l9,"moveAcrossDevice");ES.exports=o9});var CS=y((CG,AS)=>{"use strict";var h9=Dt().fromPromise;AS.exports={move:h9(wS()),moveSync:TS()}});var ro=y((xG,xS)=>{"use strict";xS.exports={...pr(),...Vh(),...C3(),...J3(),...pS(),...Tn(),...CS(),...qh(),...zi(),...yc()}});var jb=y((sz,kb)=>{"use strict";kb.exports=Nb;function Nb(n,e,t){n instanceof RegExp&&(n=Rb(n,t)),e instanceof RegExp&&(e=Rb(e,t));var r=Lb(n,e,t);return r&&{start:r[0],end:r[1],pre:t.slice(0,r[0]),body:t.slice(r[0]+n.length,r[1]),post:t.slice(r[1]+e.length)}}o(Nb,"balanced");function Rb(n,e){var t=e.match(n);return t?t[0]:null}o(Rb,"maybeMatch");Nb.range=Lb;function Lb(n,e,t){var r,i,s,a,c,u=t.indexOf(n),l=t.indexOf(e,u+1),h=u;if(u>=0&&l>0){if(n===e)return[u,l];for(r=[],s=t.length;h>=0&&!c;)h==u?(r.push(h),u=t.indexOf(n,h+1)):r.length==1?c=[r.pop(),l]:(i=r.pop(),i<s&&(s=i,a=l),l=t.indexOf(e,h+1)),h=u<l&&u>=0?u:l;r.length&&(c=[s,a])}return c}o(Lb,"range")});var Wb=y((oz,Gb)=>{var Mb=jb();Gb.exports=k7;var Vb="\0SLASH"+Math.random()+"\0",$b="\0OPEN"+Math.random()+"\0",cy="\0CLOSE"+Math.random()+"\0",Ub="\0COMMA"+Math.random()+"\0",Bb="\0PERIOD"+Math.random()+"\0";function oy(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}o(oy,"numeric");function N7(n){return n.split("\\\\").join(Vb).split("\\{").join($b).split("\\}").join(cy).split("\\,").join(Ub).split("\\.").join(Bb)}o(N7,"escapeBraces");function L7(n){return n.split(Vb).join("\\").split($b).join("{").split(cy).join("}").split(Ub).join(",").split(Bb).join(".")}o(L7,"unescapeBraces");function qb(n){if(!n)return[""];var e=[],t=Mb("{","}",n);if(!t)return n.split(",");var r=t.pre,i=t.body,s=t.post,a=r.split(",");a[a.length-1]+="{"+i+"}";var c=qb(s);return s.length&&(a[a.length-1]+=c.shift(),a.push.apply(a,c)),e.push.apply(e,a),e}o(qb,"parseCommaParts");function k7(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),Ic(N7(n),!0).map(L7)):[]}o(k7,"expandTop");function j7(n){return"{"+n+"}"}o(j7,"embrace");function M7(n){return/^-?0\d/.test(n)}o(M7,"isPadded");function V7(n,e){return n<=e}o(V7,"lte");function $7(n,e){return n>=e}o($7,"gte");function Ic(n,e){var t=[],r=Mb("{","}",n);if(!r)return[n];var i=r.pre,s=r.post.length?Ic(r.post,!1):[""];if(/\$$/.test(r.pre))for(var a=0;a<s.length;a++){var c=i+"{"+r.body+"}"+s[a];t.push(c)}else{var u=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),h=u||l,f=r.body.indexOf(",")>=0;if(!h&&!f)return r.post.match(/,(?!,).*\}/)?(n=r.pre+"{"+r.body+cy+r.post,Ic(n)):[n];var d;if(h)d=r.body.split(/\.\./);else if(d=qb(r.body),d.length===1&&(d=Ic(d[0],!1).map(j7),d.length===1))return s.map(function(ue){return r.pre+d[0]+ue});var m;if(h){var _=oy(d[0]),S=oy(d[1]),A=Math.max(d[0].length,d[1].length),I=d.length==3?Math.abs(oy(d[2])):1,D=V7,L=S<_;L&&(I*=-1,D=$7);var G=d.some(M7);m=[];for(var W=_;D(W,S);W+=I){var Fe;if(l)Fe=String.fromCharCode(W),Fe==="\\"&&(Fe="");else if(Fe=String(W),G){var et=A-Fe.length;if(et>0){var ct=new Array(et+1).join("0");W<0?Fe="-"+ct+Fe.slice(1):Fe=ct+Fe}}m.push(Fe)}}else{m=[];for(var U=0;U<d.length;U++)m.push.apply(m,Ic(d[U],!1))}for(var U=0;U<m.length;U++)for(var a=0;a<s.length;a++){var c=i+m[U]+s[a];(!e||h||c)&&t.push(c)}}return t}o(Ic,"expand")});var TQ=Ze(Yf());var M1=Ze(j1(),1),{program:T8,createCommand:A8,createArgument:C8,createOption:x8,CommanderError:I8,InvalidArgumentError:O8,InvalidOptionArgumentError:D8,Command:Er,Argument:P8,Option:F8,Help:R8}=M1.default;var xc=require("fs"),ay=require("path"),wr=Ze(Gi());var xt=Ze(ro()),tr=Ze(require("path"));function qS(n){return typeof n>"u"||n===null}o(qS,"isNothing");function f9(n){return typeof n=="object"&&n!==null}o(f9,"isObject");function d9(n){return Array.isArray(n)?n:qS(n)?[]:[n]}o(d9,"toArray");function p9(n,e){var t,r,i,s;if(e)for(s=Object.keys(e),t=0,r=s.length;t<r;t+=1)i=s[t],n[i]=e[i];return n}o(p9,"extend");function m9(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}o(m9,"repeat");function g9(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}o(g9,"isNegativeZero");var y9=qS,v9=f9,w9=d9,_9=m9,S9=g9,b9=p9,Ct={isNothing:y9,isObject:v9,toArray:w9,repeat:_9,isNegativeZero:S9,extend:b9};function GS(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}o(GS,"formatError");function _c(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=GS(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}o(_c,"YAMLException$1");_c.prototype=Object.create(Error.prototype);_c.prototype.constructor=_c;_c.prototype.toString=o(function(e){return this.name+": "+GS(this,e)},"toString");var yr=_c;function z0(n,e,t,r,i){var s="",a="",c=Math.floor(i/2)-1;return r-e>c&&(s=" ... ",e=r-c+s.length),t-r>c&&(a=" ...",t=r+c-a.length),{str:s+n.slice(e,t).replace(/\t/g,"\u2192")+a,pos:r-e+s.length}}o(z0,"getLine");function H0(n,e){return Ct.repeat(" ",e-n.length)+n}o(H0,"padStart");function E9(n,e){if(e=Object.create(e||null),!n.buffer)return null;e.maxLength||(e.maxLength=79),typeof e.indent!="number"&&(e.indent=1),typeof e.linesBefore!="number"&&(e.linesBefore=3),typeof e.linesAfter!="number"&&(e.linesAfter=2);for(var t=/\r?\n|\r|\0/g,r=[0],i=[],s,a=-1;s=t.exec(n.buffer);)i.push(s.index),r.push(s.index+s[0].length),n.position<=s.index&&a<0&&(a=r.length-2);a<0&&(a=r.length-1);var c="",u,l,h=Math.min(n.line+e.linesAfter,i.length).toString().length,f=e.maxLength-(e.indent+h+3);for(u=1;u<=e.linesBefore&&!(a-u<0);u++)l=z0(n.buffer,r[a-u],i[a-u],n.position-(r[a]-r[a-u]),f),c=Ct.repeat(" ",e.indent)+H0((n.line-u+1).toString(),h)+" | "+l.str+`
`+c;for(l=z0(n.buffer,r[a],i[a],n.position,f),c+=Ct.repeat(" ",e.indent)+H0((n.line+1).toString(),h)+" | "+l.str+`
`,c+=Ct.repeat("-",e.indent+h+3+l.pos)+`^
`,u=1;u<=e.linesAfter&&!(a+u>=i.length);u++)l=z0(n.buffer,r[a+u],i[a+u],n.position-(r[a]-r[a+u]),f),c+=Ct.repeat(" ",e.indent)+H0((n.line+u+1).toString(),h)+" | "+l.str+`
`;return c.replace(/\n$/,"")}o(E9,"makeSnippet");var T9=E9,A9=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],C9=["scalar","sequence","mapping"];function x9(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}o(x9,"compileStyleAliases");function I9(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(A9.indexOf(t)===-1)throw new yr('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=x9(e.styleAliases||null),C9.indexOf(this.kind)===-1)throw new yr('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}o(I9,"Type$1");var Gt=I9;function IS(n,e){var t=[];return n[e].forEach(function(r){var i=t.length;t.forEach(function(s,a){s.tag===r.tag&&s.kind===r.kind&&s.multi===r.multi&&(i=a)}),t[i]=r}),t}o(IS,"compileList");function O9(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(i){i.multi?(n.multi[i.kind].push(i),n.multi.fallback.push(i)):n[i.kind][i.tag]=n.fallback[i.tag]=i}for(o(r,"collectType"),e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}o(O9,"compileMap");function Q0(n){return this.extend(n)}o(Q0,"Schema$1");Q0.prototype.extend=o(function(e){var t=[],r=[];if(e instanceof Gt)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new yr("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(s){if(!(s instanceof Gt))throw new yr("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new yr("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new yr("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(s){if(!(s instanceof Gt))throw new yr("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(Q0.prototype);return i.implicit=(this.implicit||[]).concat(t),i.explicit=(this.explicit||[]).concat(r),i.compiledImplicit=IS(i,"implicit"),i.compiledExplicit=IS(i,"explicit"),i.compiledTypeMap=O9(i.compiledImplicit,i.compiledExplicit),i},"extend");var WS=Q0,zS=new Gt("tag:yaml.org,2002:str",{kind:"scalar",construct:o(function(n){return n!==null?n:""},"construct")}),HS=new Gt("tag:yaml.org,2002:seq",{kind:"sequence",construct:o(function(n){return n!==null?n:[]},"construct")}),YS=new Gt("tag:yaml.org,2002:map",{kind:"mapping",construct:o(function(n){return n!==null?n:{}},"construct")}),QS=new WS({explicit:[zS,HS,YS]});function D9(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}o(D9,"resolveYamlNull");function P9(){return null}o(P9,"constructYamlNull");function F9(n){return n===null}o(F9,"isNull");var KS=new Gt("tag:yaml.org,2002:null",{kind:"scalar",resolve:D9,construct:P9,predicate:F9,represent:{canonical:o(function(){return"~"},"canonical"),lowercase:o(function(){return"null"},"lowercase"),uppercase:o(function(){return"NULL"},"uppercase"),camelcase:o(function(){return"Null"},"camelcase"),empty:o(function(){return""},"empty")},defaultStyle:"lowercase"});function R9(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}o(R9,"resolveYamlBoolean");function N9(n){return n==="true"||n==="True"||n==="TRUE"}o(N9,"constructYamlBoolean");function L9(n){return Object.prototype.toString.call(n)==="[object Boolean]"}o(L9,"isBoolean");var XS=new Gt("tag:yaml.org,2002:bool",{kind:"scalar",resolve:R9,construct:N9,predicate:L9,represent:{lowercase:o(function(n){return n?"true":"false"},"lowercase"),uppercase:o(function(n){return n?"TRUE":"FALSE"},"uppercase"),camelcase:o(function(n){return n?"True":"False"},"camelcase")},defaultStyle:"lowercase"});function k9(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}o(k9,"isHexCode");function j9(n){return 48<=n&&n<=55}o(j9,"isOctCode");function M9(n){return 48<=n&&n<=57}o(M9,"isDecCode");function V9(n){if(n===null)return!1;var e=n.length,t=0,r=!1,i;if(!e)return!1;if(i=n[t],(i==="-"||i==="+")&&(i=n[++t]),i==="0"){if(t+1===e)return!0;if(i=n[++t],i==="b"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(i!=="0"&&i!=="1")return!1;r=!0}return r&&i!=="_"}if(i==="x"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!k9(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}if(i==="o"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!j9(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}}if(i==="_")return!1;for(;t<e;t++)if(i=n[t],i!=="_"){if(!M9(n.charCodeAt(t)))return!1;r=!0}return!(!r||i==="_")}o(V9,"resolveYamlInteger");function $9(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}o($9,"constructYamlInteger");function U9(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!Ct.isNegativeZero(n)}o(U9,"isInteger");var JS=new Gt("tag:yaml.org,2002:int",{kind:"scalar",resolve:V9,construct:$9,predicate:U9,represent:{binary:o(function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},"binary"),octal:o(function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},"octal"),decimal:o(function(n){return n.toString(10)},"decimal"),hexadecimal:o(function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)},"hexadecimal")},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),B9=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function q9(n){return!(n===null||!B9.test(n)||n[n.length-1]==="_")}o(q9,"resolveYamlFloat");function G9(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}o(G9,"constructYamlFloat");var W9=/^[-+]?[0-9]+e/;function z9(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Ct.isNegativeZero(n))return"-0.0";return t=n.toString(10),W9.test(t)?t.replace("e",".e"):t}o(z9,"representYamlFloat");function H9(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||Ct.isNegativeZero(n))}o(H9,"isFloat");var ZS=new Gt("tag:yaml.org,2002:float",{kind:"scalar",resolve:q9,construct:G9,predicate:H9,represent:z9,defaultStyle:"lowercase"}),eb=QS.extend({implicit:[KS,XS,JS,ZS]}),tb=eb,rb=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),nb=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function Y9(n){return n===null?!1:rb.exec(n)!==null||nb.exec(n)!==null}o(Y9,"resolveYamlTimestamp");function Q9(n){var e,t,r,i,s,a,c,u=0,l=null,h,f,d;if(e=rb.exec(n),e===null&&(e=nb.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(t,r,i));if(s=+e[4],a=+e[5],c=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(h=+e[10],f=+(e[11]||0),l=(h*60+f)*6e4,e[9]==="-"&&(l=-l)),d=new Date(Date.UTC(t,r,i,s,a,c,u)),l&&d.setTime(d.getTime()-l),d}o(Q9,"constructYamlTimestamp");function K9(n){return n.toISOString()}o(K9,"representYamlTimestamp");var ib=new Gt("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:Y9,construct:Q9,instanceOf:Date,represent:K9});function X9(n){return n==="<<"||n===null}o(X9,"resolveYamlMerge");var sb=new Gt("tag:yaml.org,2002:merge",{kind:"scalar",resolve:X9}),ey=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function J9(n){if(n===null)return!1;var e,t,r=0,i=n.length,s=ey;for(t=0;t<i;t++)if(e=s.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}o(J9,"resolveYamlBinary");function Z9(n){var e,t,r=n.replace(/[\r\n=]/g,""),i=r.length,s=ey,a=0,c=[];for(e=0;e<i;e++)e%4===0&&e&&(c.push(a>>16&255),c.push(a>>8&255),c.push(a&255)),a=a<<6|s.indexOf(r.charAt(e));return t=i%4*6,t===0?(c.push(a>>16&255),c.push(a>>8&255),c.push(a&255)):t===18?(c.push(a>>10&255),c.push(a>>2&255)):t===12&&c.push(a>>4&255),new Uint8Array(c)}o(Z9,"constructYamlBinary");function e6(n){var e="",t=0,r,i,s=n.length,a=ey;for(r=0;r<s;r++)r%3===0&&r&&(e+=a[t>>18&63],e+=a[t>>12&63],e+=a[t>>6&63],e+=a[t&63]),t=(t<<8)+n[r];return i=s%3,i===0?(e+=a[t>>18&63],e+=a[t>>12&63],e+=a[t>>6&63],e+=a[t&63]):i===2?(e+=a[t>>10&63],e+=a[t>>4&63],e+=a[t<<2&63],e+=a[64]):i===1&&(e+=a[t>>2&63],e+=a[t<<4&63],e+=a[64],e+=a[64]),e}o(e6,"representYamlBinary");function t6(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}o(t6,"isBinary");var ab=new Gt("tag:yaml.org,2002:binary",{kind:"scalar",resolve:J9,construct:Z9,predicate:t6,represent:e6}),r6=Object.prototype.hasOwnProperty,n6=Object.prototype.toString;function i6(n){if(n===null)return!0;var e=[],t,r,i,s,a,c=n;for(t=0,r=c.length;t<r;t+=1){if(i=c[t],a=!1,n6.call(i)!=="[object Object]")return!1;for(s in i)if(r6.call(i,s))if(!a)a=!0;else return!1;if(!a)return!1;if(e.indexOf(s)===-1)e.push(s);else return!1}return!0}o(i6,"resolveYamlOmap");function s6(n){return n!==null?n:[]}o(s6,"constructYamlOmap");var ob=new Gt("tag:yaml.org,2002:omap",{kind:"sequence",resolve:i6,construct:s6}),a6=Object.prototype.toString;function o6(n){if(n===null)return!0;var e,t,r,i,s,a=n;for(s=new Array(a.length),e=0,t=a.length;e<t;e+=1){if(r=a[e],a6.call(r)!=="[object Object]"||(i=Object.keys(r),i.length!==1))return!1;s[e]=[i[0],r[i[0]]]}return!0}o(o6,"resolveYamlPairs");function c6(n){if(n===null)return[];var e,t,r,i,s,a=n;for(s=new Array(a.length),e=0,t=a.length;e<t;e+=1)r=a[e],i=Object.keys(r),s[e]=[i[0],r[i[0]]];return s}o(c6,"constructYamlPairs");var cb=new Gt("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:o6,construct:c6}),u6=Object.prototype.hasOwnProperty;function l6(n){if(n===null)return!0;var e,t=n;for(e in t)if(u6.call(t,e)&&t[e]!==null)return!1;return!0}o(l6,"resolveYamlSet");function h6(n){return n!==null?n:{}}o(h6,"constructYamlSet");var ub=new Gt("tag:yaml.org,2002:set",{kind:"mapping",resolve:l6,construct:h6}),ty=tb.extend({implicit:[ib,sb],explicit:[ab,ob,cb,ub]}),Ki=Object.prototype.hasOwnProperty,Gh=1,lb=2,hb=3,Wh=4,Y0=1,f6=2,OS=3,d6=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,p6=/[\x85\u2028\u2029]/,m6=/[,\[\]\{\}]/,fb=/^(?:!|!!|![a-z\-]+!)$/i,db=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function DS(n){return Object.prototype.toString.call(n)}o(DS,"_class");function Qn(n){return n===10||n===13}o(Qn,"is_EOL");function zs(n){return n===9||n===32}o(zs,"is_WHITE_SPACE");function Or(n){return n===9||n===32||n===10||n===13}o(Or,"is_WS_OR_EOL");function io(n){return n===44||n===91||n===93||n===123||n===125}o(io,"is_FLOW_INDICATOR");function g6(n){var e;return 48<=n&&n<=57?n-48:(e=n|32,97<=e&&e<=102?e-97+10:-1)}o(g6,"fromHexCode");function y6(n){return n===120?2:n===117?4:n===85?8:0}o(y6,"escapedHexLen");function v6(n){return 48<=n&&n<=57?n-48:-1}o(v6,"fromDecimalCode");function PS(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"\x85":n===95?"\xA0":n===76?"\u2028":n===80?"\u2029":""}o(PS,"simpleEscapeSequence");function w6(n){return n<=65535?String.fromCharCode(n):String.fromCharCode((n-65536>>10)+55296,(n-65536&1023)+56320)}o(w6,"charFromCodepoint");function pb(n,e,t){e==="__proto__"?Object.defineProperty(n,e,{configurable:!0,enumerable:!0,writable:!0,value:t}):n[e]=t}o(pb,"setProperty");var mb=new Array(256),gb=new Array(256);for(Ws=0;Ws<256;Ws++)mb[Ws]=PS(Ws)?1:0,gb[Ws]=PS(Ws);var Ws;function _6(n,e){this.input=n,this.filename=e.filename||null,this.schema=e.schema||ty,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=n.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}o(_6,"State$1");function yb(n,e){var t={name:n.filename,buffer:n.input.slice(0,-1),position:n.position,line:n.line,column:n.position-n.lineStart};return t.snippet=T9(t),new yr(e,t)}o(yb,"generateError");function K(n,e){throw yb(n,e)}o(K,"throwError");function zh(n,e){n.onWarning&&n.onWarning.call(null,yb(n,e))}o(zh,"throwWarning");var FS={YAML:o(function(e,t,r){var i,s,a;e.version!==null&&K(e,"duplication of %YAML directive"),r.length!==1&&K(e,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),i===null&&K(e,"ill-formed argument of the YAML directive"),s=parseInt(i[1],10),a=parseInt(i[2],10),s!==1&&K(e,"unacceptable YAML version of the document"),e.version=r[0],e.checkLineBreaks=a<2,a!==1&&a!==2&&zh(e,"unsupported YAML version of the document")},"handleYamlDirective"),TAG:o(function(e,t,r){var i,s;r.length!==2&&K(e,"TAG directive accepts exactly two arguments"),i=r[0],s=r[1],fb.test(i)||K(e,"ill-formed tag handle (first argument) of the TAG directive"),Ki.call(e.tagMap,i)&&K(e,'there is a previously declared suffix for "'+i+'" tag handle'),db.test(s)||K(e,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch{K(e,"tag prefix is malformed: "+s)}e.tagMap[i]=s},"handleTagDirective")};function Qi(n,e,t,r){var i,s,a,c;if(e<t){if(c=n.input.slice(e,t),r)for(i=0,s=c.length;i<s;i+=1)a=c.charCodeAt(i),a===9||32<=a&&a<=1114111||K(n,"expected valid JSON character");else d6.test(c)&&K(n,"the stream contains non-printable characters");n.result+=c}}o(Qi,"captureSegment");function RS(n,e,t,r){var i,s,a,c;for(Ct.isObject(t)||K(n,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(t),a=0,c=i.length;a<c;a+=1)s=i[a],Ki.call(e,s)||(pb(e,s,t[s]),r[s]=!0)}o(RS,"mergeMappings");function so(n,e,t,r,i,s,a,c,u){var l,h;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),l=0,h=i.length;l<h;l+=1)Array.isArray(i[l])&&K(n,"nested arrays are not supported inside keys"),typeof i=="object"&&DS(i[l])==="[object Object]"&&(i[l]="[object Object]");if(typeof i=="object"&&DS(i)==="[object Object]"&&(i="[object Object]"),i=String(i),e===null&&(e={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(s))for(l=0,h=s.length;l<h;l+=1)RS(n,e,s[l],t);else RS(n,e,s,t);else!n.json&&!Ki.call(t,i)&&Ki.call(e,i)&&(n.line=a||n.line,n.lineStart=c||n.lineStart,n.position=u||n.position,K(n,"duplicated mapping key")),pb(e,i,s),delete t[i];return e}o(so,"storeMappingPair");function ry(n){var e;e=n.input.charCodeAt(n.position),e===10?n.position++:e===13?(n.position++,n.input.charCodeAt(n.position)===10&&n.position++):K(n,"a line break is expected"),n.line+=1,n.lineStart=n.position,n.firstTabInLine=-1}o(ry,"readLineBreak");function Et(n,e,t){for(var r=0,i=n.input.charCodeAt(n.position);i!==0;){for(;zs(i);)i===9&&n.firstTabInLine===-1&&(n.firstTabInLine=n.position),i=n.input.charCodeAt(++n.position);if(e&&i===35)do i=n.input.charCodeAt(++n.position);while(i!==10&&i!==13&&i!==0);if(Qn(i))for(ry(n),i=n.input.charCodeAt(n.position),r++,n.lineIndent=0;i===32;)n.lineIndent++,i=n.input.charCodeAt(++n.position);else break}return t!==-1&&r!==0&&n.lineIndent<t&&zh(n,"deficient indentation"),r}o(Et,"skipSeparationSpace");function Qh(n){var e=n.position,t;return t=n.input.charCodeAt(e),!!((t===45||t===46)&&t===n.input.charCodeAt(e+1)&&t===n.input.charCodeAt(e+2)&&(e+=3,t=n.input.charCodeAt(e),t===0||Or(t)))}o(Qh,"testDocumentSeparator");function ny(n,e){e===1?n.result+=" ":e>1&&(n.result+=Ct.repeat(`
`,e-1))}o(ny,"writeFoldedLines");function S6(n,e,t){var r,i,s,a,c,u,l,h,f=n.kind,d=n.result,m;if(m=n.input.charCodeAt(n.position),Or(m)||io(m)||m===35||m===38||m===42||m===33||m===124||m===62||m===39||m===34||m===37||m===64||m===96||(m===63||m===45)&&(i=n.input.charCodeAt(n.position+1),Or(i)||t&&io(i)))return!1;for(n.kind="scalar",n.result="",s=a=n.position,c=!1;m!==0;){if(m===58){if(i=n.input.charCodeAt(n.position+1),Or(i)||t&&io(i))break}else if(m===35){if(r=n.input.charCodeAt(n.position-1),Or(r))break}else{if(n.position===n.lineStart&&Qh(n)||t&&io(m))break;if(Qn(m))if(u=n.line,l=n.lineStart,h=n.lineIndent,Et(n,!1,-1),n.lineIndent>=e){c=!0,m=n.input.charCodeAt(n.position);continue}else{n.position=a,n.line=u,n.lineStart=l,n.lineIndent=h;break}}c&&(Qi(n,s,a,!1),ny(n,n.line-u),s=a=n.position,c=!1),zs(m)||(a=n.position+1),m=n.input.charCodeAt(++n.position)}return Qi(n,s,a,!1),n.result?!0:(n.kind=f,n.result=d,!1)}o(S6,"readPlainScalar");function b6(n,e){var t,r,i;if(t=n.input.charCodeAt(n.position),t!==39)return!1;for(n.kind="scalar",n.result="",n.position++,r=i=n.position;(t=n.input.charCodeAt(n.position))!==0;)if(t===39)if(Qi(n,r,n.position,!0),t=n.input.charCodeAt(++n.position),t===39)r=n.position,n.position++,i=n.position;else return!0;else Qn(t)?(Qi(n,r,i,!0),ny(n,Et(n,!1,e)),r=i=n.position):n.position===n.lineStart&&Qh(n)?K(n,"unexpected end of the document within a single quoted scalar"):(n.position++,i=n.position);K(n,"unexpected end of the stream within a single quoted scalar")}o(b6,"readSingleQuotedScalar");function E6(n,e){var t,r,i,s,a,c;if(c=n.input.charCodeAt(n.position),c!==34)return!1;for(n.kind="scalar",n.result="",n.position++,t=r=n.position;(c=n.input.charCodeAt(n.position))!==0;){if(c===34)return Qi(n,t,n.position,!0),n.position++,!0;if(c===92){if(Qi(n,t,n.position,!0),c=n.input.charCodeAt(++n.position),Qn(c))Et(n,!1,e);else if(c<256&&mb[c])n.result+=gb[c],n.position++;else if((a=y6(c))>0){for(i=a,s=0;i>0;i--)c=n.input.charCodeAt(++n.position),(a=g6(c))>=0?s=(s<<4)+a:K(n,"expected hexadecimal character");n.result+=w6(s),n.position++}else K(n,"unknown escape sequence");t=r=n.position}else Qn(c)?(Qi(n,t,r,!0),ny(n,Et(n,!1,e)),t=r=n.position):n.position===n.lineStart&&Qh(n)?K(n,"unexpected end of the document within a double quoted scalar"):(n.position++,r=n.position)}K(n,"unexpected end of the stream within a double quoted scalar")}o(E6,"readDoubleQuotedScalar");function T6(n,e){var t=!0,r,i,s,a=n.tag,c,u=n.anchor,l,h,f,d,m,_=Object.create(null),S,A,I,D;if(D=n.input.charCodeAt(n.position),D===91)h=93,m=!1,c=[];else if(D===123)h=125,m=!0,c={};else return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=c),D=n.input.charCodeAt(++n.position);D!==0;){if(Et(n,!0,e),D=n.input.charCodeAt(n.position),D===h)return n.position++,n.tag=a,n.anchor=u,n.kind=m?"mapping":"sequence",n.result=c,!0;t?D===44&&K(n,"expected the node content, but found ','"):K(n,"missed comma between flow collection entries"),A=S=I=null,f=d=!1,D===63&&(l=n.input.charCodeAt(n.position+1),Or(l)&&(f=d=!0,n.position++,Et(n,!0,e))),r=n.line,i=n.lineStart,s=n.position,ao(n,e,Gh,!1,!0),A=n.tag,S=n.result,Et(n,!0,e),D=n.input.charCodeAt(n.position),(d||n.line===r)&&D===58&&(f=!0,D=n.input.charCodeAt(++n.position),Et(n,!0,e),ao(n,e,Gh,!1,!0),I=n.result),m?so(n,c,_,A,S,I,r,i,s):f?c.push(so(n,null,_,A,S,I,r,i,s)):c.push(S),Et(n,!0,e),D=n.input.charCodeAt(n.position),D===44?(t=!0,D=n.input.charCodeAt(++n.position)):t=!1}K(n,"unexpected end of the stream within a flow collection")}o(T6,"readFlowCollection");function A6(n,e){var t,r,i=Y0,s=!1,a=!1,c=e,u=0,l=!1,h,f;if(f=n.input.charCodeAt(n.position),f===124)r=!1;else if(f===62)r=!0;else return!1;for(n.kind="scalar",n.result="";f!==0;)if(f=n.input.charCodeAt(++n.position),f===43||f===45)Y0===i?i=f===43?OS:f6:K(n,"repeat of a chomping mode identifier");else if((h=v6(f))>=0)h===0?K(n,"bad explicit indentation width of a block scalar; it cannot be less than one"):a?K(n,"repeat of an indentation width identifier"):(c=e+h-1,a=!0);else break;if(zs(f)){do f=n.input.charCodeAt(++n.position);while(zs(f));if(f===35)do f=n.input.charCodeAt(++n.position);while(!Qn(f)&&f!==0)}for(;f!==0;){for(ry(n),n.lineIndent=0,f=n.input.charCodeAt(n.position);(!a||n.lineIndent<c)&&f===32;)n.lineIndent++,f=n.input.charCodeAt(++n.position);if(!a&&n.lineIndent>c&&(c=n.lineIndent),Qn(f)){u++;continue}if(n.lineIndent<c){i===OS?n.result+=Ct.repeat(`
`,s?1+u:u):i===Y0&&s&&(n.result+=`
`);break}for(r?zs(f)?(l=!0,n.result+=Ct.repeat(`
`,s?1+u:u)):l?(l=!1,n.result+=Ct.repeat(`
`,u+1)):u===0?s&&(n.result+=" "):n.result+=Ct.repeat(`
`,u):n.result+=Ct.repeat(`
`,s?1+u:u),s=!0,a=!0,u=0,t=n.position;!Qn(f)&&f!==0;)f=n.input.charCodeAt(++n.position);Qi(n,t,n.position,!1)}return!0}o(A6,"readBlockScalar");function NS(n,e){var t,r=n.tag,i=n.anchor,s=[],a,c=!1,u;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=s),u=n.input.charCodeAt(n.position);u!==0&&(n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,K(n,"tab characters must not be used in indentation")),!(u!==45||(a=n.input.charCodeAt(n.position+1),!Or(a))));){if(c=!0,n.position++,Et(n,!0,-1)&&n.lineIndent<=e){s.push(null),u=n.input.charCodeAt(n.position);continue}if(t=n.line,ao(n,e,hb,!1,!0),s.push(n.result),Et(n,!0,-1),u=n.input.charCodeAt(n.position),(n.line===t||n.lineIndent>e)&&u!==0)K(n,"bad indentation of a sequence entry");else if(n.lineIndent<e)break}return c?(n.tag=r,n.anchor=i,n.kind="sequence",n.result=s,!0):!1}o(NS,"readBlockSequence");function C6(n,e,t){var r,i,s,a,c,u,l=n.tag,h=n.anchor,f={},d=Object.create(null),m=null,_=null,S=null,A=!1,I=!1,D;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=f),D=n.input.charCodeAt(n.position);D!==0;){if(!A&&n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,K(n,"tab characters must not be used in indentation")),r=n.input.charCodeAt(n.position+1),s=n.line,(D===63||D===58)&&Or(r))D===63?(A&&(so(n,f,d,m,_,null,a,c,u),m=_=S=null),I=!0,A=!0,i=!0):A?(A=!1,i=!0):K(n,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),n.position+=1,D=r;else{if(a=n.line,c=n.lineStart,u=n.position,!ao(n,t,lb,!1,!0))break;if(n.line===s){for(D=n.input.charCodeAt(n.position);zs(D);)D=n.input.charCodeAt(++n.position);if(D===58)D=n.input.charCodeAt(++n.position),Or(D)||K(n,"a whitespace character is expected after the key-value separator within a block mapping"),A&&(so(n,f,d,m,_,null,a,c,u),m=_=S=null),I=!0,A=!1,i=!1,m=n.tag,_=n.result;else if(I)K(n,"can not read an implicit mapping pair; a colon is missed");else return n.tag=l,n.anchor=h,!0}else if(I)K(n,"can not read a block mapping entry; a multiline key may not be an implicit key");else return n.tag=l,n.anchor=h,!0}if((n.line===s||n.lineIndent>e)&&(A&&(a=n.line,c=n.lineStart,u=n.position),ao(n,e,Wh,!0,i)&&(A?_=n.result:S=n.result),A||(so(n,f,d,m,_,S,a,c,u),m=_=S=null),Et(n,!0,-1),D=n.input.charCodeAt(n.position)),(n.line===s||n.lineIndent>e)&&D!==0)K(n,"bad indentation of a mapping entry");else if(n.lineIndent<e)break}return A&&so(n,f,d,m,_,null,a,c,u),I&&(n.tag=l,n.anchor=h,n.kind="mapping",n.result=f),I}o(C6,"readBlockMapping");function x6(n){var e,t=!1,r=!1,i,s,a;if(a=n.input.charCodeAt(n.position),a!==33)return!1;if(n.tag!==null&&K(n,"duplication of a tag property"),a=n.input.charCodeAt(++n.position),a===60?(t=!0,a=n.input.charCodeAt(++n.position)):a===33?(r=!0,i="!!",a=n.input.charCodeAt(++n.position)):i="!",e=n.position,t){do a=n.input.charCodeAt(++n.position);while(a!==0&&a!==62);n.position<n.length?(s=n.input.slice(e,n.position),a=n.input.charCodeAt(++n.position)):K(n,"unexpected end of the stream within a verbatim tag")}else{for(;a!==0&&!Or(a);)a===33&&(r?K(n,"tag suffix cannot contain exclamation marks"):(i=n.input.slice(e-1,n.position+1),fb.test(i)||K(n,"named tag handle cannot contain such characters"),r=!0,e=n.position+1)),a=n.input.charCodeAt(++n.position);s=n.input.slice(e,n.position),m6.test(s)&&K(n,"tag suffix cannot contain flow indicator characters")}s&&!db.test(s)&&K(n,"tag name cannot contain such characters: "+s);try{s=decodeURIComponent(s)}catch{K(n,"tag name is malformed: "+s)}return t?n.tag=s:Ki.call(n.tagMap,i)?n.tag=n.tagMap[i]+s:i==="!"?n.tag="!"+s:i==="!!"?n.tag="tag:yaml.org,2002:"+s:K(n,'undeclared tag handle "'+i+'"'),!0}o(x6,"readTagProperty");function I6(n){var e,t;if(t=n.input.charCodeAt(n.position),t!==38)return!1;for(n.anchor!==null&&K(n,"duplication of an anchor property"),t=n.input.charCodeAt(++n.position),e=n.position;t!==0&&!Or(t)&&!io(t);)t=n.input.charCodeAt(++n.position);return n.position===e&&K(n,"name of an anchor node must contain at least one character"),n.anchor=n.input.slice(e,n.position),!0}o(I6,"readAnchorProperty");function O6(n){var e,t,r;if(r=n.input.charCodeAt(n.position),r!==42)return!1;for(r=n.input.charCodeAt(++n.position),e=n.position;r!==0&&!Or(r)&&!io(r);)r=n.input.charCodeAt(++n.position);return n.position===e&&K(n,"name of an alias node must contain at least one character"),t=n.input.slice(e,n.position),Ki.call(n.anchorMap,t)||K(n,'unidentified alias "'+t+'"'),n.result=n.anchorMap[t],Et(n,!0,-1),!0}o(O6,"readAlias");function ao(n,e,t,r,i){var s,a,c,u=1,l=!1,h=!1,f,d,m,_,S,A;if(n.listener!==null&&n.listener("open",n),n.tag=null,n.anchor=null,n.kind=null,n.result=null,s=a=c=Wh===t||hb===t,r&&Et(n,!0,-1)&&(l=!0,n.lineIndent>e?u=1:n.lineIndent===e?u=0:n.lineIndent<e&&(u=-1)),u===1)for(;x6(n)||I6(n);)Et(n,!0,-1)?(l=!0,c=s,n.lineIndent>e?u=1:n.lineIndent===e?u=0:n.lineIndent<e&&(u=-1)):c=!1;if(c&&(c=l||i),(u===1||Wh===t)&&(Gh===t||lb===t?S=e:S=e+1,A=n.position-n.lineStart,u===1?c&&(NS(n,A)||C6(n,A,S))||T6(n,S)?h=!0:(a&&A6(n,S)||b6(n,S)||E6(n,S)?h=!0:O6(n)?(h=!0,(n.tag!==null||n.anchor!==null)&&K(n,"alias node should not have any properties")):S6(n,S,Gh===t)&&(h=!0,n.tag===null&&(n.tag="?")),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):u===0&&(h=c&&NS(n,A))),n.tag===null)n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);else if(n.tag==="?"){for(n.result!==null&&n.kind!=="scalar"&&K(n,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+n.kind+'"'),f=0,d=n.implicitTypes.length;f<d;f+=1)if(_=n.implicitTypes[f],_.resolve(n.result)){n.result=_.construct(n.result),n.tag=_.tag,n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);break}}else if(n.tag!=="!"){if(Ki.call(n.typeMap[n.kind||"fallback"],n.tag))_=n.typeMap[n.kind||"fallback"][n.tag];else for(_=null,m=n.typeMap.multi[n.kind||"fallback"],f=0,d=m.length;f<d;f+=1)if(n.tag.slice(0,m[f].tag.length)===m[f].tag){_=m[f];break}_||K(n,"unknown tag !<"+n.tag+">"),n.result!==null&&_.kind!==n.kind&&K(n,"unacceptable node kind for !<"+n.tag+'> tag; it should be "'+_.kind+'", not "'+n.kind+'"'),_.resolve(n.result,n.tag)?(n.result=_.construct(n.result,n.tag),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):K(n,"cannot resolve a node with !<"+n.tag+"> explicit tag")}return n.listener!==null&&n.listener("close",n),n.tag!==null||n.anchor!==null||h}o(ao,"composeNode");function D6(n){var e=n.position,t,r,i,s=!1,a;for(n.version=null,n.checkLineBreaks=n.legacy,n.tagMap=Object.create(null),n.anchorMap=Object.create(null);(a=n.input.charCodeAt(n.position))!==0&&(Et(n,!0,-1),a=n.input.charCodeAt(n.position),!(n.lineIndent>0||a!==37));){for(s=!0,a=n.input.charCodeAt(++n.position),t=n.position;a!==0&&!Or(a);)a=n.input.charCodeAt(++n.position);for(r=n.input.slice(t,n.position),i=[],r.length<1&&K(n,"directive name must not be less than one character in length");a!==0;){for(;zs(a);)a=n.input.charCodeAt(++n.position);if(a===35){do a=n.input.charCodeAt(++n.position);while(a!==0&&!Qn(a));break}if(Qn(a))break;for(t=n.position;a!==0&&!Or(a);)a=n.input.charCodeAt(++n.position);i.push(n.input.slice(t,n.position))}a!==0&&ry(n),Ki.call(FS,r)?FS[r](n,r,i):zh(n,'unknown document directive "'+r+'"')}if(Et(n,!0,-1),n.lineIndent===0&&n.input.charCodeAt(n.position)===45&&n.input.charCodeAt(n.position+1)===45&&n.input.charCodeAt(n.position+2)===45?(n.position+=3,Et(n,!0,-1)):s&&K(n,"directives end mark is expected"),ao(n,n.lineIndent-1,Wh,!1,!0),Et(n,!0,-1),n.checkLineBreaks&&p6.test(n.input.slice(e,n.position))&&zh(n,"non-ASCII line breaks are interpreted as content"),n.documents.push(n.result),n.position===n.lineStart&&Qh(n)){n.input.charCodeAt(n.position)===46&&(n.position+=3,Et(n,!0,-1));return}if(n.position<n.length-1)K(n,"end of the stream or a document separator is expected");else return}o(D6,"readDocument");function vb(n,e){n=String(n),e=e||{},n.length!==0&&(n.charCodeAt(n.length-1)!==10&&n.charCodeAt(n.length-1)!==13&&(n+=`
`),n.charCodeAt(0)===65279&&(n=n.slice(1)));var t=new _6(n,e),r=n.indexOf("\0");for(r!==-1&&(t.position=r,K(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)D6(t);return t.documents}o(vb,"loadDocuments");function P6(n,e,t){e!==null&&typeof e=="object"&&typeof t>"u"&&(t=e,e=null);var r=vb(n,t);if(typeof e!="function")return r;for(var i=0,s=r.length;i<s;i+=1)e(r[i])}o(P6,"loadAll$1");function F6(n,e){var t=vb(n,e);if(t.length!==0){if(t.length===1)return t[0];throw new yr("expected a single document in the stream, but found more")}}o(F6,"load$1");var R6=P6,N6=F6,wb={loadAll:R6,load:N6},_b=Object.prototype.toString,Sb=Object.prototype.hasOwnProperty,iy=65279,L6=9,Sc=10,k6=13,j6=32,M6=33,V6=34,K0=35,$6=37,U6=38,B6=39,q6=42,bb=44,G6=45,Hh=58,W6=61,z6=62,H6=63,Y6=64,Eb=91,Tb=93,Q6=96,Ab=123,K6=124,Cb=125,er={};er[0]="\\0";er[7]="\\a";er[8]="\\b";er[9]="\\t";er[10]="\\n";er[11]="\\v";er[12]="\\f";er[13]="\\r";er[27]="\\e";er[34]='\\"';er[92]="\\\\";er[133]="\\N";er[160]="\\_";er[8232]="\\L";er[8233]="\\P";var X6=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],J6=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function Z6(n,e){var t,r,i,s,a,c,u;if(e===null)return{};for(t={},r=Object.keys(e),i=0,s=r.length;i<s;i+=1)a=r[i],c=String(e[a]),a.slice(0,2)==="!!"&&(a="tag:yaml.org,2002:"+a.slice(2)),u=n.compiledTypeMap.fallback[a],u&&Sb.call(u.styleAliases,c)&&(c=u.styleAliases[c]),t[a]=c;return t}o(Z6,"compileStyleMap");function e7(n){var e,t,r;if(e=n.toString(16).toUpperCase(),n<=255)t="x",r=2;else if(n<=65535)t="u",r=4;else if(n<=4294967295)t="U",r=8;else throw new yr("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+Ct.repeat("0",r-e.length)+e}o(e7,"encodeHex");var t7=1,bc=2;function r7(n){this.schema=n.schema||ty,this.indent=Math.max(1,n.indent||2),this.noArrayIndent=n.noArrayIndent||!1,this.skipInvalid=n.skipInvalid||!1,this.flowLevel=Ct.isNothing(n.flowLevel)?-1:n.flowLevel,this.styleMap=Z6(this.schema,n.styles||null),this.sortKeys=n.sortKeys||!1,this.lineWidth=n.lineWidth||80,this.noRefs=n.noRefs||!1,this.noCompatMode=n.noCompatMode||!1,this.condenseFlow=n.condenseFlow||!1,this.quotingType=n.quotingType==='"'?bc:t7,this.forceQuotes=n.forceQuotes||!1,this.replacer=typeof n.replacer=="function"?n.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}o(r7,"State");function LS(n,e){for(var t=Ct.repeat(" ",e),r=0,i=-1,s="",a,c=n.length;r<c;)i=n.indexOf(`
`,r),i===-1?(a=n.slice(r),r=c):(a=n.slice(r,i+1),r=i+1),a.length&&a!==`
`&&(s+=t),s+=a;return s}o(LS,"indentString");function X0(n,e){return`
`+Ct.repeat(" ",n.indent*e)}o(X0,"generateNextLine");function n7(n,e){var t,r,i;for(t=0,r=n.implicitTypes.length;t<r;t+=1)if(i=n.implicitTypes[t],i.resolve(e))return!0;return!1}o(n7,"testImplicitResolving");function Yh(n){return n===j6||n===L6}o(Yh,"isWhitespace");function Ec(n){return 32<=n&&n<=126||161<=n&&n<=55295&&n!==8232&&n!==8233||57344<=n&&n<=65533&&n!==iy||65536<=n&&n<=1114111}o(Ec,"isPrintable");function kS(n){return Ec(n)&&n!==iy&&n!==k6&&n!==Sc}o(kS,"isNsCharOrWhitespace");function jS(n,e,t){var r=kS(n),i=r&&!Yh(n);return(t?r:r&&n!==bb&&n!==Eb&&n!==Tb&&n!==Ab&&n!==Cb)&&n!==K0&&!(e===Hh&&!i)||kS(e)&&!Yh(e)&&n===K0||e===Hh&&i}o(jS,"isPlainSafe");function i7(n){return Ec(n)&&n!==iy&&!Yh(n)&&n!==G6&&n!==H6&&n!==Hh&&n!==bb&&n!==Eb&&n!==Tb&&n!==Ab&&n!==Cb&&n!==K0&&n!==U6&&n!==q6&&n!==M6&&n!==K6&&n!==W6&&n!==z6&&n!==B6&&n!==V6&&n!==$6&&n!==Y6&&n!==Q6}o(i7,"isPlainSafeFirst");function s7(n){return!Yh(n)&&n!==Hh}o(s7,"isPlainSafeLast");function wc(n,e){var t=n.charCodeAt(e),r;return t>=55296&&t<=56319&&e+1<n.length&&(r=n.charCodeAt(e+1),r>=56320&&r<=57343)?(t-55296)*1024+r-56320+65536:t}o(wc,"codePointAt");function xb(n){var e=/^\n* /;return e.test(n)}o(xb,"needIndentIndicator");var Ib=1,J0=2,Ob=3,Db=4,no=5;function a7(n,e,t,r,i,s,a,c){var u,l=0,h=null,f=!1,d=!1,m=r!==-1,_=-1,S=i7(wc(n,0))&&s7(wc(n,n.length-1));if(e||a)for(u=0;u<n.length;l>=65536?u+=2:u++){if(l=wc(n,u),!Ec(l))return no;S=S&&jS(l,h,c),h=l}else{for(u=0;u<n.length;l>=65536?u+=2:u++){if(l=wc(n,u),l===Sc)f=!0,m&&(d=d||u-_-1>r&&n[_+1]!==" ",_=u);else if(!Ec(l))return no;S=S&&jS(l,h,c),h=l}d=d||m&&u-_-1>r&&n[_+1]!==" "}return!f&&!d?S&&!a&&!i(n)?Ib:s===bc?no:J0:t>9&&xb(n)?no:a?s===bc?no:J0:d?Db:Ob}o(a7,"chooseScalarStyle");function o7(n,e,t,r,i){n.dump=(function(){if(e.length===0)return n.quotingType===bc?'""':"''";if(!n.noCompatMode&&(X6.indexOf(e)!==-1||J6.test(e)))return n.quotingType===bc?'"'+e+'"':"'"+e+"'";var s=n.indent*Math.max(1,t),a=n.lineWidth===-1?-1:Math.max(Math.min(n.lineWidth,40),n.lineWidth-s),c=r||n.flowLevel>-1&&t>=n.flowLevel;function u(l){return n7(n,l)}switch(o(u,"testAmbiguity"),a7(e,c,n.indent,a,u,n.quotingType,n.forceQuotes&&!r,i)){case Ib:return e;case J0:return"'"+e.replace(/'/g,"''")+"'";case Ob:return"|"+MS(e,n.indent)+VS(LS(e,s));case Db:return">"+MS(e,n.indent)+VS(LS(c7(e,a),s));case no:return'"'+u7(e)+'"';default:throw new yr("impossible error: invalid scalar style")}})()}o(o7,"writeScalar");function MS(n,e){var t=xb(n)?String(e):"",r=n[n.length-1]===`
`,i=r&&(n[n.length-2]===`
`||n===`
`),s=i?"+":r?"":"-";return t+s+`
`}o(MS,"blockHeader");function VS(n){return n[n.length-1]===`
`?n.slice(0,-1):n}o(VS,"dropEndingNewline");function c7(n,e){for(var t=/(\n+)([^\n]*)/g,r=(function(){var l=n.indexOf(`
`);return l=l!==-1?l:n.length,t.lastIndex=l,$S(n.slice(0,l),e)})(),i=n[0]===`
`||n[0]===" ",s,a;a=t.exec(n);){var c=a[1],u=a[2];s=u[0]===" ",r+=c+(!i&&!s&&u!==""?`
`:"")+$S(u,e),i=s}return r}o(c7,"foldString");function $S(n,e){if(n===""||n[0]===" ")return n;for(var t=/ [^ ]/g,r,i=0,s,a=0,c=0,u="";r=t.exec(n);)c=r.index,c-i>e&&(s=a>i?a:c,u+=`
`+n.slice(i,s),i=s+1),a=c;return u+=`
`,n.length-i>e&&a>i?u+=n.slice(i,a)+`
`+n.slice(a+1):u+=n.slice(i),u.slice(1)}o($S,"foldLine");function u7(n){for(var e="",t=0,r,i=0;i<n.length;t>=65536?i+=2:i++)t=wc(n,i),r=er[t],!r&&Ec(t)?(e+=n[i],t>=65536&&(e+=n[i+1])):e+=r||e7(t);return e}o(u7,"escapeString");function l7(n,e,t){var r="",i=n.tag,s,a,c;for(s=0,a=t.length;s<a;s+=1)c=t[s],n.replacer&&(c=n.replacer.call(t,String(s),c)),(Si(n,e,c,!1,!1)||typeof c>"u"&&Si(n,e,null,!1,!1))&&(r!==""&&(r+=","+(n.condenseFlow?"":" ")),r+=n.dump);n.tag=i,n.dump="["+r+"]"}o(l7,"writeFlowSequence");function US(n,e,t,r){var i="",s=n.tag,a,c,u;for(a=0,c=t.length;a<c;a+=1)u=t[a],n.replacer&&(u=n.replacer.call(t,String(a),u)),(Si(n,e+1,u,!0,!0,!1,!0)||typeof u>"u"&&Si(n,e+1,null,!0,!0,!1,!0))&&((!r||i!=="")&&(i+=X0(n,e)),n.dump&&Sc===n.dump.charCodeAt(0)?i+="-":i+="- ",i+=n.dump);n.tag=s,n.dump=i||"[]"}o(US,"writeBlockSequence");function h7(n,e,t){var r="",i=n.tag,s=Object.keys(t),a,c,u,l,h;for(a=0,c=s.length;a<c;a+=1)h="",r!==""&&(h+=", "),n.condenseFlow&&(h+='"'),u=s[a],l=t[u],n.replacer&&(l=n.replacer.call(t,u,l)),Si(n,e,u,!1,!1)&&(n.dump.length>1024&&(h+="? "),h+=n.dump+(n.condenseFlow?'"':"")+":"+(n.condenseFlow?"":" "),Si(n,e,l,!1,!1)&&(h+=n.dump,r+=h));n.tag=i,n.dump="{"+r+"}"}o(h7,"writeFlowMapping");function f7(n,e,t,r){var i="",s=n.tag,a=Object.keys(t),c,u,l,h,f,d;if(n.sortKeys===!0)a.sort();else if(typeof n.sortKeys=="function")a.sort(n.sortKeys);else if(n.sortKeys)throw new yr("sortKeys must be a boolean or a function");for(c=0,u=a.length;c<u;c+=1)d="",(!r||i!=="")&&(d+=X0(n,e)),l=a[c],h=t[l],n.replacer&&(h=n.replacer.call(t,l,h)),Si(n,e+1,l,!0,!0,!0)&&(f=n.tag!==null&&n.tag!=="?"||n.dump&&n.dump.length>1024,f&&(n.dump&&Sc===n.dump.charCodeAt(0)?d+="?":d+="? "),d+=n.dump,f&&(d+=X0(n,e)),Si(n,e+1,h,!0,f)&&(n.dump&&Sc===n.dump.charCodeAt(0)?d+=":":d+=": ",d+=n.dump,i+=d));n.tag=s,n.dump=i||"{}"}o(f7,"writeBlockMapping");function BS(n,e,t){var r,i,s,a,c,u;for(i=t?n.explicitTypes:n.implicitTypes,s=0,a=i.length;s<a;s+=1)if(c=i[s],(c.instanceOf||c.predicate)&&(!c.instanceOf||typeof e=="object"&&e instanceof c.instanceOf)&&(!c.predicate||c.predicate(e))){if(t?c.multi&&c.representName?n.tag=c.representName(e):n.tag=c.tag:n.tag="?",c.represent){if(u=n.styleMap[c.tag]||c.defaultStyle,_b.call(c.represent)==="[object Function]")r=c.represent(e,u);else if(Sb.call(c.represent,u))r=c.represent[u](e,u);else throw new yr("!<"+c.tag+'> tag resolver accepts not "'+u+'" style');n.dump=r}return!0}return!1}o(BS,"detectType");function Si(n,e,t,r,i,s,a){n.tag=null,n.dump=t,BS(n,t,!1)||BS(n,t,!0);var c=_b.call(n.dump),u=r,l;r&&(r=n.flowLevel<0||n.flowLevel>e);var h=c==="[object Object]"||c==="[object Array]",f,d;if(h&&(f=n.duplicates.indexOf(t),d=f!==-1),(n.tag!==null&&n.tag!=="?"||d||n.indent!==2&&e>0)&&(i=!1),d&&n.usedDuplicates[f])n.dump="*ref_"+f;else{if(h&&d&&!n.usedDuplicates[f]&&(n.usedDuplicates[f]=!0),c==="[object Object]")r&&Object.keys(n.dump).length!==0?(f7(n,e,n.dump,i),d&&(n.dump="&ref_"+f+n.dump)):(h7(n,e,n.dump),d&&(n.dump="&ref_"+f+" "+n.dump));else if(c==="[object Array]")r&&n.dump.length!==0?(n.noArrayIndent&&!a&&e>0?US(n,e-1,n.dump,i):US(n,e,n.dump,i),d&&(n.dump="&ref_"+f+n.dump)):(l7(n,e,n.dump),d&&(n.dump="&ref_"+f+" "+n.dump));else if(c==="[object String]")n.tag!=="?"&&o7(n,n.dump,e,s,u);else{if(c==="[object Undefined]")return!1;if(n.skipInvalid)return!1;throw new yr("unacceptable kind of an object to dump "+c)}n.tag!==null&&n.tag!=="?"&&(l=encodeURI(n.tag[0]==="!"?n.tag.slice(1):n.tag).replace(/!/g,"%21"),n.tag[0]==="!"?l="!"+l:l.slice(0,18)==="tag:yaml.org,2002:"?l="!!"+l.slice(18):l="!<"+l+">",n.dump=l+" "+n.dump)}return!0}o(Si,"writeNode");function d7(n,e){var t=[],r=[],i,s;for(Z0(n,t,r),i=0,s=r.length;i<s;i+=1)e.duplicates.push(t[r[i]]);e.usedDuplicates=new Array(s)}o(d7,"getDuplicateReferences");function Z0(n,e,t){var r,i,s;if(n!==null&&typeof n=="object")if(i=e.indexOf(n),i!==-1)t.indexOf(i)===-1&&t.push(i);else if(e.push(n),Array.isArray(n))for(i=0,s=n.length;i<s;i+=1)Z0(n[i],e,t);else for(r=Object.keys(n),i=0,s=r.length;i<s;i+=1)Z0(n[r[i]],e,t)}o(Z0,"inspectNode");function p7(n,e){e=e||{};var t=new r7(e);t.noRefs||d7(n,t);var r=n;return t.replacer&&(r=t.replacer.call({"":r},"",r)),Si(t,0,r,!0,!0)?t.dump+`
`:""}o(p7,"dump$1");var m7=p7,g7={dump:m7};function sy(n,e){return function(){throw new Error("Function yaml."+n+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}o(sy,"renamed");var y7=Gt,v7=WS,w7=QS,_7=eb,S7=tb,b7=ty,E7=wb.load,T7=wb.loadAll,A7=g7.dump,C7=yr,x7={binary:ab,float:ZS,map:YS,null:KS,pairs:cb,set:ub,timestamp:ib,bool:XS,int:JS,merge:sb,omap:ob,seq:HS,str:zS},I7=sy("safeLoad","load"),O7=sy("safeLoadAll","loadAll"),D7=sy("safeDump","dump"),Tc={Type:y7,Schema:v7,FAILSAFE_SCHEMA:w7,JSON_SCHEMA:_7,CORE_SCHEMA:S7,DEFAULT_SCHEMA:b7,load:E7,loadAll:T7,dump:A7,YAMLException:C7,types:x7,safeLoad:I7,safeLoadAll:O7,safeDump:D7};var Kh=class{constructor(e){this.rootPath=e}static{o(this,"FileSystemVaultAdapter")}async read(e){let t=this.resolvePath(e.path);if(!await xt.default.pathExists(t))throw new Error(`File not found: ${e.path}`);return xt.default.readFile(t,"utf-8")}async create(e,t){let r=this.resolvePath(e);if(await xt.default.pathExists(r))throw new Error(`File already exists: ${e}`);return await xt.default.ensureDir(tr.default.dirname(r)),await xt.default.writeFile(r,t,"utf-8"),this.createFileObject(e)}async modify(e,t){let r=this.resolvePath(e.path);if(!await xt.default.pathExists(r))throw new Error(`File not found: ${e.path}`);await xt.default.writeFile(r,t,"utf-8")}async delete(e){let t=this.resolvePath(e.path);if(!await xt.default.pathExists(t))throw new Error(`File not found: ${e.path}`);await xt.default.remove(t)}async exists(e){let t=this.resolvePath(e);return xt.default.pathExists(t)}getAbstractFileByPath(e){let t=this.resolvePath(e);try{let r=xt.default.statSync(t);if(r.isFile())return this.createFileObject(e);if(r.isDirectory())return this.createFolderObject(e)}catch{return null}return null}getAllFiles(){let e=[];return this.walkDirectory(this.rootPath,t=>{if(t.endsWith(".md")){let r=tr.default.relative(this.rootPath,t);e.push(this.createFileObject(r))}}),e}getFrontmatter(e){try{let t=xt.default.readFileSync(this.resolvePath(e.path),"utf-8");return this.extractFrontmatter(t)}catch{return null}}async updateFrontmatter(e,t){let r=await this.read(e),i=this.extractFrontmatter(r)||{},s=t(i),a=this.replaceFrontmatter(r,s);await this.modify(e,a)}async rename(e,t){let r=this.resolvePath(e.path),i=this.resolvePath(t);if(!await xt.default.pathExists(r))throw new Error(`File not found: ${e.path}`);await xt.default.ensureDir(tr.default.dirname(i)),await xt.default.move(r,i)}async createFolder(e){let t=this.resolvePath(e);await xt.default.ensureDir(t)}getFirstLinkpathDest(e,t){let r=tr.default.dirname(this.resolvePath(t)),i;if(tr.default.isAbsolute(e)?i=this.resolvePath(e):i=tr.default.resolve(r,e),e.endsWith(".md")||(i+=".md"),xt.default.existsSync(i)){let s=tr.default.relative(this.rootPath,i);return this.createFileObject(s)}return null}async process(e,t){let r=await this.read(e),i=t(r);return await this.modify(e,i),i}getDefaultNewFileParent(){return{path:"",name:""}}async updateLinks(e,t,r){return Promise.resolve()}resolvePath(e){return tr.default.isAbsolute(e)?e:tr.default.join(this.rootPath,e)}createFileObject(e){let t=tr.default.basename(e),r=tr.default.basename(e,tr.default.extname(e)),i=tr.default.dirname(e);return{path:e,basename:t,name:r,parent:i!=="."?this.createFolderObject(i):null}}createFolderObject(e){return{path:e,name:tr.default.basename(e)}}extractFrontmatter(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r)return null;try{let i=Tc.load(r[1]);return typeof i=="object"&&i!==null?i:null}catch{return null}}replaceFrontmatter(e,t){let r=Tc.dump(t,{lineWidth:-1,noRefs:!0,quotingType:'"'}),i=/^---\n([\s\S]*?)\n---/;return e.match(i)?e.replace(i,`---
${r.trim()}
---`):`---
${r.trim()}
---
${e}`}walkDirectory(e,t){let r=xt.default.readdirSync(e,{withFileTypes:!0});for(let i of r){let s=tr.default.join(e,i.name);i.isDirectory()?this.walkDirectory(s,t):i.isFile()&&t(s)}}};var Xh=class{static{o(this,"TableFormatter")}format(e){if(e.length===0)return"No results";let t=this.getAllVariables(e),r=e.map(i=>this.solutionToRow(i,t));return this.renderTable(t,r)}getAllVariables(e){let t=new Set;for(let r of e)for(let i of r.variables())t.add(i);return Array.from(t).sort()}solutionToRow(e,t){return t.map(r=>{let i=e.get(r);return i?this.formatValue(i.toString()):""})}formatValue(e){return e.length>50?e.substring(0,47)+"...":e}renderTable(e,t){let r=e.map((s,a)=>{let c=s.length+1,u=Math.max(...t.map(l=>l[a]?.length||0));return Math.max(c,u,10)}),i=[];i.push(this.renderSeparator(r,"top")),i.push(this.renderRow(e.map(s=>`?${s}`),r)),i.push(this.renderSeparator(r,"mid"));for(let s of t)i.push(this.renderRow(s,r));return i.push(this.renderSeparator(r,"bottom")),i.join(`
`)}renderRow(e,t){return`\u2502 ${e.map((i,s)=>i.padEnd(t[s])).join(" \u2502 ")} \u2502`}renderSeparator(e,t){let r=t==="top"?"\u250C":t==="mid"?"\u251C":"\u2514",i=t==="top"?"\u2510":t==="mid"?"\u2524":"\u2518",a=t==="mid"?"\u2500\u253C\u2500":"\u2500"+(t==="mid"?"\u253C":"\u2500")+"\u2500",c=e.map(u=>"\u2500".repeat(u+2));return`${r}${c.join(a)}${i}`}};var Jh=class{static{o(this,"JsonFormatter")}format(e){let t=e.map(r=>r.toJSON());return JSON.stringify(t,null,2)}};var Ac=class{static{o(this,"TriplesFormatter")}formatNTriples(e){return e.map(t=>t.toString()).join(`
`)}formatTable(e){if(e.length===0)return"No triples generated.";let t=[];t.push("Subject | Predicate | Object"),t.push("------- | --------- | ------");for(let r of e){let i=this.formatNode(r.subject),s=this.formatNode(r.predicate),a=this.formatNode(r.object);t.push(`${i} | ${s} | ${a}`)}return t.join(`
`)}formatJson(e){let t=e.map(r=>({subject:this.nodeToJson(r.subject),predicate:this.nodeToJson(r.predicate),object:this.nodeToJson(r.object)}));return JSON.stringify(t,null,2)}formatNode(e){return e.value!==void 0?String(e.value):String(e)}nodeToJson(e){return"datatype"in e||"language"in e?{type:"literal",value:String(e.value),...e.datatype&&{datatype:e.datatype.value||String(e.datatype)},...e.language&&{language:e.language}}:"id"in e&&String(e.id).startsWith("_:")?{type:"bnode",value:String(e.id)}:{type:"uri",value:String(e.value)}}};function Pb(n){return n.startsWith("VALIDATION_")?"validation":n.startsWith("PERMISSION_")?"permission":n.startsWith("STATE_")?"state":"internal"}o(Pb,"getErrorCategory");var ft=class{static{o(this,"ResponseBuilder")}static success(e,t){return{success:!0,data:e,...t&&{meta:t}}}static error(e,t,r,i){return{success:!1,error:{code:e,category:Pb(e),message:t,exitCode:r,...i?.recovery&&{recovery:i.recovery},...i?.context&&{context:i.context},...i?.stack&&{stack:i.stack}}}}};var vr=class extends Error{static{o(this,"CLIError")}constructor(e,t,r){super(e),this.name=this.constructor.name,this.context=t,this.recoveryHint=r,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}format(){let e=`\u274C ${this.name}: ${this.message}`;if(this.guidance&&(e+=`

\u{1F4A1} ${this.guidance}`),this.context&&Object.keys(this.context).length>0){e+=`

\u{1F4CB} Context:`;for(let[t,r]of Object.entries(this.context))e+=`
  ${t}: ${JSON.stringify(r)}`}return e}toStructuredResponse(e=!1){return ft.error(this.errorCode,this.message,this.exitCode,{recovery:this.recoveryHint||{message:this.guidance},context:this.context,stack:e?this.stack:void 0})}formatJson(e=!1){return JSON.stringify(this.toStructuredResponse(e),null,2)}};var ye=class n{static{o(this,"ErrorHandler")}static{this.outputFormat="text"}static setFormat(e){n.outputFormat=e}static getFormat(){return n.outputFormat}static isDebugMode(){return!!process.env.DEBUG}static handle(e){if(e instanceof vr){if(n.outputFormat==="json"){let i=e.toStructuredResponse(n.isDebugMode());console.log(JSON.stringify(i,null,2))}else console.error(e.format()),n.isDebugMode()&&(console.error(`
\u{1F4CD} Stack trace:`),console.error(e.stack));process.exit(e.exitCode)}let{exitCode:t,errorCode:r}=n.classifyError(e);if(n.outputFormat==="json"){let i=n.buildErrorResponse(r,e.message,t,n.isDebugMode()?e.stack:void 0);console.log(JSON.stringify(i,null,2))}else console.error(`\u274C Error: ${e.message}`),n.isDebugMode()&&console.error(e.stack);process.exit(t)}static handleWithMessage(e,t=1,r="INTERNAL_UNKNOWN"){if(n.outputFormat==="json"){let i=n.buildErrorResponse(r,e,t);console.log(JSON.stringify(i,null,2))}else console.error(`\u274C Error: ${e}`);process.exit(t)}static classifyError(e){let t=e.message.toLowerCase();return t.includes("transition")?{exitCode:6,errorCode:"STATE_INVALID_TRANSITION"}:t.includes("transaction")?{exitCode:7,errorCode:"INTERNAL_TRANSACTION_FAILED"}:t.includes("concurrent")||t.includes("modified")?{exitCode:8,errorCode:"STATE_CONCURRENT_MODIFICATION"}:e.message.includes("not found")||e.message.includes("ENOENT")?{exitCode:3,errorCode:"VALIDATION_FILE_NOT_FOUND"}:e.message.includes("EACCES")||e.message.includes("permission denied")?{exitCode:4,errorCode:"PERMISSION_DENIED"}:e.message.includes("Invalid")||e.message.includes("outside vault")||e.message.includes("Not a")?{exitCode:2,errorCode:"VALIDATION_INVALID_ARGUMENTS"}:{exitCode:1,errorCode:"INTERNAL_UNKNOWN"}}static buildErrorResponse(e,t,r,i){return ft.error(e,t,r,{recovery:n.getRecoveryHint(e),stack:i})}static getRecoveryHint(e){switch(e){case"VALIDATION_FILE_NOT_FOUND":return{message:"Verify the file path is correct and the file exists",suggestion:"Check file path spelling and ensure the file is in the vault"};case"VALIDATION_VAULT_NOT_FOUND":return{message:"Verify the vault path is correct",suggestion:"Check --vault option or current directory"};case"VALIDATION_INVALID_ARGUMENTS":return{message:"Check command syntax and argument format",suggestion:"Use --help for usage information"};case"STATE_INVALID_TRANSITION":return{message:"The requested state transition is not allowed",suggestion:"Check the current asset state and valid transitions"};case"STATE_CONCURRENT_MODIFICATION":return{message:"File was modified by another process",suggestion:"Wait and retry the command"};case"PERMISSION_DENIED":return{message:"Check file permissions",suggestion:"Ensure you have write access to the vault"};case"INTERNAL_TRANSACTION_FAILED":return{message:"Transaction could not complete",suggestion:"Check for locked files and retry"};default:return{message:"An unexpected error occurred",suggestion:"Check the error details and retry"}}}};var Cc=class extends vr{constructor(t,r){super(`File not found: ${t}`,{filepath:t,...r},{message:"Verify the file path is correct and the file exists",suggestion:`ls -la "${t}" or find . -name "$(basename ${t})"`});this.exitCode=3;this.errorCode="VALIDATION_FILE_NOT_FOUND";this.guidance=`Verify the file path is correct and the file exists.
Check:
  \u2022 File path spelling
  \u2022 File is in the vault directory
  \u2022 File has .md extension`}static{o(this,"FileNotFoundError")}};var nt=class extends vr{constructor(t,r,i){let s=`Check command syntax and argument format.
Use: exocortex command --help for usage information.`;super(t,i,{message:r||"Check command syntax and argument format",suggestion:"exocortex command --help"});this.exitCode=2;this.errorCode="VALIDATION_INVALID_ARGUMENTS";this.guidance=r||s}static{o(this,"InvalidArgumentsError")}};var bi=class extends vr{constructor(t,r){super(`Vault not found: ${t}`,{vaultPath:t,...r},{message:"Verify the vault path is correct and the directory exists",suggestion:`ls -la "${t}" or check --vault option`});this.exitCode=3;this.errorCode="VALIDATION_VAULT_NOT_FOUND";this.guidance=`The specified vault directory does not exist.
Check:
  \u2022 Path spelling and case sensitivity
  \u2022 Directory exists and is accessible
  \u2022 You have read permissions for the directory`}static{o(this,"VaultNotFoundError")}};function Fb(){return new Er("query").description("Execute SPARQL query against Obsidian vault").argument("<query>","SPARQL query string or path to .sparql file").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--format <type>","Output format: table|json|csv|ntriples","table").option("--output <type>","Response format: text|json (for MCP tools)","text").option("--explain","Show optimized query plan").option("--stats","Show execution statistics").option("--no-optimize","Disable query optimization").action(async(n,e)=>{let t=e.output||"text";ye.setFormat(t);try{let r=Date.now(),i=P7(n),s=(0,ay.resolve)(e.vault);if(!(0,xc.existsSync)(s))throw new bi(s);t==="text"&&console.log(`\u{1F4E6} Loading vault: ${s}...`);let a=Date.now(),c=new Kh(s),l=await new wr.NoteToRDFConverter(c).convertVault(),h=new wr.InMemoryTripleStore;await h.addAll(l);let f=Date.now()-a;t==="text"&&(console.log(`\u2705 Loaded ${l.length} triples in ${f}ms
`),console.log("\u{1F50D} Parsing SPARQL query..."));let m=new wr.SPARQLParser().parse(i);t==="text"&&console.log("\u{1F504} Translating to algebra...");let S=new wr.AlgebraTranslator().translate(m);if(!e.noOptimize&&S.type!=="construct")S=new wr.AlgebraOptimizer().optimize(S);else if(!e.noOptimize&&S.type==="construct"){let D=new wr.AlgebraOptimizer,L=S;S={...L,where:D.optimize(L.where)}}if(e.explain&&t==="text"){console.log("\u{1F4CA} Query Plan:");let D=new wr.AlgebraSerializer;if(S.type==="construct"){let L=S;console.log("CONSTRUCT Template:"),console.log("  (template patterns)"),console.log("WHERE:"),console.log(D.toString(L.where))}else console.log(D.toString(S));console.log()}t==="text"&&console.log("\u{1F3AF} Executing query...");let A=Date.now(),I=new wr.QueryExecutor(h);if(I.isConstructQuery(S)){let D=await I.executeConstruct(S),L=Date.now()-A,G=Date.now()-r;if(t==="json"){let W=new Ac,Fe={query:i,count:D.length,triples:JSON.parse(W.formatJson(D))},et=ft.success(Fe,{durationMs:G,itemCount:D.length,loadDurationMs:f,execDurationMs:L,triplesScanned:l.length});console.log(JSON.stringify(et,null,2))}else console.log(`\u2705 Generated ${D.length} triple(s) in ${L}ms
`),D.length>0?R7(D,e.format):console.log("No triples generated."),e.stats&&(console.log(`
\u{1F4CA} Execution Statistics:`),console.log(`  Vault loading: ${f}ms`),console.log(`  Query execution: ${L}ms`),console.log(`  Total time: ${G}ms`),console.log(`  Triples scanned: ${l.length}`),console.log(`  Triples generated: ${D.length}`))}else{let D=await I.executeAll(S),L=Date.now()-A,G=Date.now()-r;if(t==="json"){let W=D.map(ct=>ct.toJSON()),Fe={query:i,count:D.length,bindings:W},et=ft.success(Fe,{durationMs:G,itemCount:D.length,loadDurationMs:f,execDurationMs:L,triplesScanned:l.length});console.log(JSON.stringify(et,null,2))}else console.log(`\u2705 Found ${D.length} result(s) in ${L}ms
`),D.length>0?F7(D,e.format):console.log("No results found."),e.stats&&(console.log(`
\u{1F4CA} Execution Statistics:`),console.log(`  Vault loading: ${f}ms`),console.log(`  Query execution: ${L}ms`),console.log(`  Total time: ${G}ms`),console.log(`  Triples scanned: ${l.length}`),console.log(`  Results returned: ${D.length}`))}}catch(r){ye.handle(r)}})}o(Fb,"sparqlQueryCommand");function P7(n){if(n.includes("SELECT")||n.includes("CONSTRUCT"))return n;let e=(0,ay.resolve)(n);return(0,xc.existsSync)(e)?(0,xc.readFileSync)(e,"utf-8"):n}o(P7,"loadQuery");function F7(n,e){switch(e){case"json":let t=new Jh;console.log(t.format(n));break;case"table":default:let r=new Xh;console.log(r.format(n));break}}o(F7,"formatSelectResults");function R7(n,e){let t=new Ac;switch(e){case"json":console.log(t.formatJson(n));break;case"ntriples":console.log(t.formatNTriples(n));break;case"table":default:console.log(t.formatTable(n));break}}o(R7,"formatConstructResults");var ME=require("path");var It=Ze(ro()),ts=Ze(require("path"));var Zb=Ze(Wb(),1);var Oc=o(n=>{if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>65536)throw new TypeError("pattern is too long")},"assertValidPattern");var U7={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},Dc=o(n=>n.replace(/[[\]\\-]/g,"\\$&"),"braceEscape"),B7=o(n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"regexpEscape"),zb=o(n=>n.join(""),"rangesToString"),Hb=o((n,e)=>{let t=e;if(n.charAt(t)!=="[")throw new Error("not in a brace expression");let r=[],i=[],s=t+1,a=!1,c=!1,u=!1,l=!1,h=t,f="";e:for(;s<n.length;){let S=n.charAt(s);if((S==="!"||S==="^")&&s===t+1){l=!0,s++;continue}if(S==="]"&&a&&!u){h=s+1;break}if(a=!0,S==="\\"&&!u){u=!0,s++;continue}if(S==="["&&!u){for(let[A,[I,D,L]]of Object.entries(U7))if(n.startsWith(A,s)){if(f)return["$.",!1,n.length-t,!0];s+=A.length,L?i.push(I):r.push(I),c=c||D;continue e}}if(u=!1,f){S>f?r.push(Dc(f)+"-"+Dc(S)):S===f&&r.push(Dc(S)),f="",s++;continue}if(n.startsWith("-]",s+1)){r.push(Dc(S+"-")),s+=2;continue}if(n.startsWith("-",s+1)){f=S,s+=2;continue}r.push(Dc(S)),s++}if(h<s)return["",!1,0,!1];if(!r.length&&!i.length)return["$.",!1,n.length-t,!0];if(i.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!l){let S=r[0].length===2?r[0].slice(-1):r[0];return[B7(S),!1,h-t,!1]}let d="["+(l?"^":"")+zb(r)+"]",m="["+(l?"":"^")+zb(i)+"]";return[r.length&&i.length?"("+d+"|"+m+")":r.length?d:m,c,h-t,!0]},"parseClass");var An=o((n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/\[([^\/\\])\]/g,"$1"):n.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),"unescape");var q7=new Set(["!","?","+","*","@"]),Yb=o(n=>q7.has(n),"isExtglobType"),G7="(?!(?:^|/)\\.\\.?(?:$|/))",Zh="(?!\\.)",W7=new Set(["[","."]),z7=new Set(["..","."]),H7=new Set("().*{}+?[]^$\\!"),Y7=o(n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"regExpEscape"),uy="[^/]",Qb=uy+"*?",Kb=uy+"+?",oo=class n{static{o(this,"AST")}type;#e;#t;#s=!1;#n=[];#a;#_;#u;#h=!1;#o;#c;#i=!1;constructor(e,t,r={}){this.type=e,e&&(this.#t=!0),this.#a=t,this.#e=this.#a?this.#a.#e:this,this.#o=this.#e===this?r:this.#e.#o,this.#u=this.#e===this?[]:this.#e.#u,e==="!"&&!this.#e.#h&&this.#u.push(this),this.#_=this.#a?this.#a.#n.length:0}get hasMagic(){if(this.#t!==void 0)return this.#t;for(let e of this.#n)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#t=!0;return this.#t}toString(){return this.#c!==void 0?this.#c:this.type?this.#c=this.type+"("+this.#n.map(e=>String(e)).join("|")+")":this.#c=this.#n.map(e=>String(e)).join("")}#g(){if(this!==this.#e)throw new Error("should only call on root");if(this.#h)return this;this.toString(),this.#h=!0;let e;for(;e=this.#u.pop();){if(e.type!=="!")continue;let t=e,r=t.#a;for(;r;){for(let i=t.#_+1;!r.type&&i<r.#n.length;i++)for(let s of e.#n){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(r.#n[i])}t=r,r=t.#a}}return this}push(...e){for(let t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof n&&t.#a===this))throw new Error("invalid part: "+t);this.#n.push(t)}}toJSON(){let e=this.type===null?this.#n.slice().map(t=>typeof t=="string"?t:t.toJSON()):[this.type,...this.#n.map(t=>t.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#h&&this.#a?.type==="!")&&e.push({}),e}isStart(){if(this.#e===this)return!0;if(!this.#a?.isStart())return!1;if(this.#_===0)return!0;let e=this.#a;for(let t=0;t<this.#_;t++){let r=e.#n[t];if(!(r instanceof n&&r.type==="!"))return!1}return!0}isEnd(){if(this.#e===this||this.#a?.type==="!")return!0;if(!this.#a?.isEnd())return!1;if(!this.type)return this.#a?.isEnd();let e=this.#a?this.#a.#n.length:0;return this.#_===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){let t=new n(this.type,e);for(let r of this.#n)t.copyIn(r);return t}static#y(e,t,r,i){let s=!1,a=!1,c=-1,u=!1;if(t.type===null){let m=r,_="";for(;m<e.length;){let S=e.charAt(m++);if(s||S==="\\"){s=!s,_+=S;continue}if(a){m===c+1?(S==="^"||S==="!")&&(u=!0):S==="]"&&!(m===c+2&&u)&&(a=!1),_+=S;continue}else if(S==="["){a=!0,c=m,u=!1,_+=S;continue}if(!i.noext&&Yb(S)&&e.charAt(m)==="("){t.push(_),_="";let A=new n(S,t);m=n.#y(e,A,m,i),t.push(A);continue}_+=S}return t.push(_),m}let l=r+1,h=new n(null,t),f=[],d="";for(;l<e.length;){let m=e.charAt(l++);if(s||m==="\\"){s=!s,d+=m;continue}if(a){l===c+1?(m==="^"||m==="!")&&(u=!0):m==="]"&&!(l===c+2&&u)&&(a=!1),d+=m;continue}else if(m==="["){a=!0,c=l,u=!1,d+=m;continue}if(Yb(m)&&e.charAt(l)==="("){h.push(d),d="";let _=new n(m,h);h.push(_),l=n.#y(e,_,l,i);continue}if(m==="|"){h.push(d),d="",f.push(h),h=new n(null,t);continue}if(m===")")return d===""&&t.#n.length===0&&(t.#i=!0),h.push(d),d="",t.push(...f,h),l;d+=m}return t.type=null,t.#t=void 0,t.#n=[e.substring(r-1)],l}static fromGlob(e,t={}){let r=new n(null,void 0,t);return n.#y(e,r,0,t),r}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();let e=this.toString(),[t,r,i,s]=this.toRegExpSource();if(!(i||this.#t||this.#o.nocase&&!this.#o.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return r;let c=(this.#o.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${t}$`,c),{_src:t,_glob:e})}get options(){return this.#o}toRegExpSource(e){let t=e??!!this.#o.dot;if(this.#e===this&&this.#g(),!this.type){let u=this.isStart()&&this.isEnd(),l=this.#n.map(m=>{let[_,S,A,I]=typeof m=="string"?n.#f(m,this.#t,u):m.toRegExpSource(e);return this.#t=this.#t||A,this.#s=this.#s||I,_}).join(""),h="";if(this.isStart()&&typeof this.#n[0]=="string"&&!(this.#n.length===1&&z7.has(this.#n[0]))){let _=W7,S=t&&_.has(l.charAt(0))||l.startsWith("\\.")&&_.has(l.charAt(2))||l.startsWith("\\.\\.")&&_.has(l.charAt(4)),A=!t&&!e&&_.has(l.charAt(0));h=S?G7:A?Zh:""}let f="";return this.isEnd()&&this.#e.#h&&this.#a?.type==="!"&&(f="(?:$|\\/)"),[h+l+f,An(l),this.#t=!!this.#t,this.#s]}let r=this.type==="*"||this.type==="+",i=this.type==="!"?"(?:(?!(?:":"(?:",s=this.#d(t);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){let u=this.toString();return this.#n=[u],this.type=null,this.#t=void 0,[u,An(this.toString()),!1,!1]}let a=!r||e||t||!Zh?"":this.#d(!0);a===s&&(a=""),a&&(s=`(?:${s})(?:${a})*?`);let c="";if(this.type==="!"&&this.#i)c=(this.isStart()&&!t?Zh:"")+Kb;else{let u=this.type==="!"?"))"+(this.isStart()&&!t&&!e?Zh:"")+Qb+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&a?")":this.type==="*"&&a?")?":`)${this.type}`;c=i+s+u}return[c,An(s),this.#t=!!this.#t,this.#s]}#d(e){return this.#n.map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");let[r,i,s,a]=t.toRegExpSource(e);return this.#s=this.#s||a,r}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")}static#f(e,t,r=!1){let i=!1,s="",a=!1;for(let c=0;c<e.length;c++){let u=e.charAt(c);if(i){i=!1,s+=(H7.has(u)?"\\":"")+u;continue}if(u==="\\"){c===e.length-1?s+="\\\\":i=!0;continue}if(u==="["){let[l,h,f,d]=Hb(e,c);if(f){s+=l,a=a||h,c+=f-1,t=t||d;continue}}if(u==="*"){r&&e==="*"?s+=Kb:s+=Qb,t=!0;continue}if(u==="?"){s+=uy,t=!0;continue}s+=Y7(u)}return[s,An(e),!!t,a]}};var co=o((n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/[?*()[\]]/g,"[$&]"):n.replace(/[?*()[\]\\]/g,"\\$&"),"escape");var zt=o((n,e,t={})=>(Oc(e),!t.nocomment&&e.charAt(0)==="#"?!1:new jr(e,t).match(n)),"minimatch"),Q7=/^\*+([^+@!?\*\[\(]*)$/,K7=o(n=>e=>!e.startsWith(".")&&e.endsWith(n),"starDotExtTest"),X7=o(n=>e=>e.endsWith(n),"starDotExtTestDot"),J7=o(n=>(n=n.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(n)),"starDotExtTestNocase"),Z7=o(n=>(n=n.toLowerCase(),e=>e.toLowerCase().endsWith(n)),"starDotExtTestNocaseDot"),eL=/^\*+\.\*+$/,tL=o(n=>!n.startsWith(".")&&n.includes("."),"starDotStarTest"),rL=o(n=>n!=="."&&n!==".."&&n.includes("."),"starDotStarTestDot"),nL=/^\.\*+$/,iL=o(n=>n!=="."&&n!==".."&&n.startsWith("."),"dotStarTest"),sL=/^\*+$/,aL=o(n=>n.length!==0&&!n.startsWith("."),"starTest"),oL=o(n=>n.length!==0&&n!=="."&&n!=="..","starTestDot"),cL=/^\?+([^+@!?\*\[\(]*)?$/,uL=o(([n,e=""])=>{let t=eE([n]);return e?(e=e.toLowerCase(),r=>t(r)&&r.toLowerCase().endsWith(e)):t},"qmarksTestNocase"),lL=o(([n,e=""])=>{let t=tE([n]);return e?(e=e.toLowerCase(),r=>t(r)&&r.toLowerCase().endsWith(e)):t},"qmarksTestNocaseDot"),hL=o(([n,e=""])=>{let t=tE([n]);return e?r=>t(r)&&r.endsWith(e):t},"qmarksTestDot"),fL=o(([n,e=""])=>{let t=eE([n]);return e?r=>t(r)&&r.endsWith(e):t},"qmarksTest"),eE=o(([n])=>{let e=n.length;return t=>t.length===e&&!t.startsWith(".")},"qmarksTestNoExt"),tE=o(([n])=>{let e=n.length;return t=>t.length===e&&t!=="."&&t!==".."},"qmarksTestNoExtDot"),rE=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Xb={win32:{sep:"\\"},posix:{sep:"/"}},dL=rE==="win32"?Xb.win32.sep:Xb.posix.sep;zt.sep=dL;var Wt=Symbol("globstar **");zt.GLOBSTAR=Wt;var pL="[^/]",mL=pL+"*?",gL="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",yL="(?:(?!(?:\\/|^)\\.).)*?",vL=o((n,e={})=>t=>zt(t,n,e),"filter");zt.filter=vL;var Yr=o((n,e={})=>Object.assign({},n,e),"ext"),wL=o(n=>{if(!n||typeof n!="object"||!Object.keys(n).length)return zt;let e=zt;return Object.assign(o((r,i,s={})=>e(r,i,Yr(n,s)),"m"),{Minimatch:class extends e.Minimatch{static{o(this,"Minimatch")}constructor(i,s={}){super(i,Yr(n,s))}static defaults(i){return e.defaults(Yr(n,i)).Minimatch}},AST:class extends e.AST{static{o(this,"AST")}constructor(i,s,a={}){super(i,s,Yr(n,a))}static fromGlob(i,s={}){return e.AST.fromGlob(i,Yr(n,s))}},unescape:o((r,i={})=>e.unescape(r,Yr(n,i)),"unescape"),escape:o((r,i={})=>e.escape(r,Yr(n,i)),"escape"),filter:o((r,i={})=>e.filter(r,Yr(n,i)),"filter"),defaults:o(r=>e.defaults(Yr(n,r)),"defaults"),makeRe:o((r,i={})=>e.makeRe(r,Yr(n,i)),"makeRe"),braceExpand:o((r,i={})=>e.braceExpand(r,Yr(n,i)),"braceExpand"),match:o((r,i,s={})=>e.match(r,i,Yr(n,s)),"match"),sep:e.sep,GLOBSTAR:Wt})},"defaults");zt.defaults=wL;var nE=o((n,e={})=>(Oc(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:(0,Zb.default)(n)),"braceExpand");zt.braceExpand=nE;var _L=o((n,e={})=>new jr(n,e).makeRe(),"makeRe");zt.makeRe=_L;var SL=o((n,e,t={})=>{let r=new jr(e,t);return n=n.filter(i=>r.match(i)),r.options.nonull&&!n.length&&n.push(e),n},"match");zt.match=SL;var Jb=/[?*]|[+@!]\(.*?\)|\[|\]/,bL=o(n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"regExpEscape"),jr=class{static{o(this,"Minimatch")}options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){Oc(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||rE,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let e of this.set)for(let t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);let r=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let i=this.globParts.map((s,a,c)=>{if(this.isWindows&&this.windowsNoMagicRoot){let u=s[0]===""&&s[1]===""&&(s[2]==="?"||!Jb.test(s[2]))&&!Jb.test(s[3]),l=/^[a-z]:/i.test(s[0]);if(u)return[...s.slice(0,4),...s.slice(4).map(h=>this.parse(h))];if(l)return[s[0],...s.slice(1).map(h=>this.parse(h))]}return s.map(u=>this.parse(u))});if(this.debug(this.pattern,i),this.set=i.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){let a=this.set[s];a[0]===""&&a[1]===""&&this.globParts[s][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let r=0;r<e.length;r++)for(let i=0;i<e[r].length;i++)e[r][i]==="**"&&(e[r][i]="*");let{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let r=-1;for(;(r=t.indexOf("**",r+1))!==-1;){let i=r;for(;t[i+1]==="**";)i++;i!==r&&t.splice(r,i-r)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((r,i)=>{let s=r[r.length-1];return i==="**"&&s==="**"?r:i===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(r.pop(),r):(r.push(i),r)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let i=1;i<e.length-1;i++){let s=e[i];i===1&&s===""&&e[0]===""||(s==="."||s==="")&&(t=!0,e.splice(i,1),i--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let r=0;for(;(r=e.indexOf("..",r+1))!==-1;){let i=e[r-1];i&&i!=="."&&i!==".."&&i!=="**"&&(t=!0,e.splice(r-1,2),r-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let r of e){let i=-1;for(;(i=r.indexOf("**",i+1))!==-1;){let a=i;for(;r[a+1]==="**";)a++;a>i&&r.splice(i+1,a-i);let c=r[i+1],u=r[i+2],l=r[i+3];if(c!==".."||!u||u==="."||u===".."||!l||l==="."||l==="..")continue;t=!0,r.splice(i,1);let h=r.slice(0);h[i]="**",e.push(h),i--}if(!this.preserveMultipleSlashes){for(let a=1;a<r.length-1;a++){let c=r[a];a===1&&c===""&&r[0]===""||(c==="."||c==="")&&(t=!0,r.splice(a,1),a--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(t=!0,r.pop())}let s=0;for(;(s=r.indexOf("..",s+1))!==-1;){let a=r[s-1];if(a&&a!=="."&&a!==".."&&a!=="**"){t=!0;let u=s===1&&r[s+1]==="**"?["."]:[];r.splice(s-1,2,...u),r.length===0&&r.push(""),s-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){let i=this.partsMatch(e[t],e[r],!this.preserveMultipleSlashes);if(i){e[t]=[],e[r]=i;break}}return e.filter(t=>t.length)}partsMatch(e,t,r=!1){let i=0,s=0,a=[],c="";for(;i<e.length&&s<t.length;)if(e[i]===t[s])a.push(c==="b"?t[s]:e[i]),i++,s++;else if(r&&e[i]==="**"&&t[s]===e[i+1])a.push(e[i]),i++;else if(r&&t[s]==="**"&&e[i]===t[s+1])a.push(t[s]),s++;else if(e[i]==="*"&&t[s]&&(this.options.dot||!t[s].startsWith("."))&&t[s]!=="**"){if(c==="b")return!1;c="a",a.push(e[i]),i++,s++}else if(t[s]==="*"&&e[i]&&(this.options.dot||!e[i].startsWith("."))&&e[i]!=="**"){if(c==="a")return!1;c="b",a.push(t[s]),i++,s++}else return!1;return e.length===t.length&&a}parseNegate(){if(this.nonegate)return;let e=this.pattern,t=!1,r=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,r++;r&&(this.pattern=e.slice(r)),this.negate=t}matchOne(e,t,r=!1){let i=this.options;if(this.isWindows){let S=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),A=!S&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),I=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),D=!I&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),L=A?3:S?0:void 0,G=D?3:I?0:void 0;if(typeof L=="number"&&typeof G=="number"){let[W,Fe]=[e[L],t[G]];W.toLowerCase()===Fe.toLowerCase()&&(t[G]=W,G>L?t=t.slice(G):L>G&&(e=e.slice(L)))}}let{optimizationLevel:s=1}=this.options;s>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var a=0,c=0,u=e.length,l=t.length;a<u&&c<l;a++,c++){this.debug("matchOne loop");var h=t[c],f=e[a];if(this.debug(t,h,f),h===!1)return!1;if(h===Wt){this.debug("GLOBSTAR",[t,h,f]);var d=a,m=c+1;if(m===l){for(this.debug("** at the end");a<u;a++)if(e[a]==="."||e[a]===".."||!i.dot&&e[a].charAt(0)===".")return!1;return!0}for(;d<u;){var _=e[d];if(this.debug(`
globstar while`,e,d,t,m,_),this.matchOne(e.slice(d),t.slice(m),r))return this.debug("globstar found match!",d,u,_),!0;if(_==="."||_===".."||!i.dot&&_.charAt(0)==="."){this.debug("dot detected!",e,d,t,m);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(r&&(this.debug(`
>>> no match, partial?`,e,d,t,m),d===u))}let S;if(typeof h=="string"?(S=f===h,this.debug("string match",h,f,S)):(S=h.test(f),this.debug("pattern match",h,f,S)),!S)return!1}if(a===u&&c===l)return!0;if(a===u)return r;if(c===l)return a===u-1&&e[a]==="";throw new Error("wtf?")}braceExpand(){return nE(this.pattern,this.options)}parse(e){Oc(e);let t=this.options;if(e==="**")return Wt;if(e==="")return"";let r,i=null;(r=e.match(sL))?i=t.dot?oL:aL:(r=e.match(Q7))?i=(t.nocase?t.dot?Z7:J7:t.dot?X7:K7)(r[1]):(r=e.match(cL))?i=(t.nocase?t.dot?lL:uL:t.dot?hL:fL)(r):(r=e.match(eL))?i=t.dot?rL:tL:(r=e.match(nL))&&(i=iL);let s=oo.fromGlob(e,this.options).toMMPattern();return i&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:i}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,r=t.noglobstar?mL:t.dot?gL:yL,i=new Set(t.nocase?["i"]:[]),s=e.map(u=>{let l=u.map(h=>{if(h instanceof RegExp)for(let f of h.flags.split(""))i.add(f);return typeof h=="string"?bL(h):h===Wt?Wt:h._src});return l.forEach((h,f)=>{let d=l[f+1],m=l[f-1];h!==Wt||m===Wt||(m===void 0?d!==void 0&&d!==Wt?l[f+1]="(?:\\/|"+r+"\\/)?"+d:l[f]=r:d===void 0?l[f-1]=m+"(?:\\/|"+r+")?":d!==Wt&&(l[f-1]=m+"(?:\\/|\\/"+r+"\\/)"+d,l[f+1]=Wt))}),l.filter(h=>h!==Wt).join("/")}).join("|"),[a,c]=e.length>1?["(?:",")"]:["",""];s="^"+a+s+c+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let r=this.options;this.isWindows&&(e=e.split("\\").join("/"));let i=this.slashSplit(e);this.debug(this.pattern,"split",i);let s=this.set;this.debug(this.pattern,"set",s);let a=i[i.length-1];if(!a)for(let c=i.length-2;!a&&c>=0;c--)a=i[c];for(let c=0;c<s.length;c++){let u=s[c],l=i;if(r.matchBase&&u.length===1&&(l=[a]),this.matchOne(l,u,t))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(e){return zt.defaults(e).Minimatch}};zt.AST=oo;zt.Minimatch=jr;zt.escape=co;zt.unescape=An;var xE=require("node:url");var uo=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,sE=new Set,ly=typeof process=="object"&&process?process:{},aE=o((n,e,t,r)=>{typeof ly.emitWarning=="function"?ly.emitWarning(n,e,t,r):console.error(`[${t}] ${e}: ${n}`)},"emitWarning"),ef=globalThis.AbortController,iE=globalThis.AbortSignal;if(typeof ef>"u"){iE=class{static{o(this,"AbortSignal")}onabort;_onabort=[];reason;aborted=!1;addEventListener(r,i){this._onabort.push(i)}},ef=class{static{o(this,"AbortController")}constructor(){e()}signal=new iE;abort(r){if(!this.signal.aborted){this.signal.reason=r,this.signal.aborted=!0;for(let i of this.signal._onabort)i(r);this.signal.onabort?.(r)}}};let n=ly.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",e=o(()=>{n&&(n=!1,aE("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))},"warnACPolyfill")}var EL=o(n=>!sE.has(n),"shouldWarn");var Xi=o(n=>n&&n===Math.floor(n)&&n>0&&isFinite(n),"isPosInt"),oE=o(n=>Xi(n)?n<=Math.pow(2,8)?Uint8Array:n<=Math.pow(2,16)?Uint16Array:n<=Math.pow(2,32)?Uint32Array:n<=Number.MAX_SAFE_INTEGER?lo:null:null,"getUintArray"),lo=class extends Array{static{o(this,"ZeroArray")}constructor(e){super(e),this.fill(0)}},hy=class n{static{o(this,"Stack")}heap;length;static#e=!1;static create(e){let t=oE(e);if(!t)return[];n.#e=!0;let r=new n(e,t);return n.#e=!1,r}constructor(e,t){if(!n.#e)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},Pc=class n{static{o(this,"LRUCache")}#e;#t;#s;#n;#a;#_;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#u;#h;#o;#c;#i;#g;#y;#d;#f;#E;#m;#T;#A;#w;#S;#b;#p;static unsafeExposeInternals(e){return{starts:e.#A,ttls:e.#w,sizes:e.#T,keyMap:e.#o,keyList:e.#c,valList:e.#i,next:e.#g,prev:e.#y,get head(){return e.#d},get tail(){return e.#f},free:e.#E,isBackgroundFetch:o(t=>e.#l(t),"isBackgroundFetch"),backgroundFetch:o((t,r,i,s)=>e.#M(t,r,i,s),"backgroundFetch"),moveToTail:o(t=>e.#$(t),"moveToTail"),indexes:o(t=>e.#x(t),"indexes"),rindexes:o(t=>e.#I(t),"rindexes"),isStale:o(t=>e.#v(t),"isStale")}}get max(){return this.#e}get maxSize(){return this.#t}get calculatedSize(){return this.#h}get size(){return this.#u}get fetchMethod(){return this.#a}get memoMethod(){return this.#_}get dispose(){return this.#s}get disposeAfter(){return this.#n}constructor(e){let{max:t=0,ttl:r,ttlResolution:i=1,ttlAutopurge:s,updateAgeOnGet:a,updateAgeOnHas:c,allowStale:u,dispose:l,disposeAfter:h,noDisposeOnSet:f,noUpdateTTL:d,maxSize:m=0,maxEntrySize:_=0,sizeCalculation:S,fetchMethod:A,memoMethod:I,noDeleteOnFetchRejection:D,noDeleteOnStaleGet:L,allowStaleOnFetchRejection:G,allowStaleOnFetchAbort:W,ignoreFetchAbort:Fe}=e;if(t!==0&&!Xi(t))throw new TypeError("max option must be a nonnegative integer");let et=t?oE(t):Array;if(!et)throw new Error("invalid max value: "+t);if(this.#e=t,this.#t=m,this.maxEntrySize=_||this.#t,this.sizeCalculation=S,this.sizeCalculation){if(!this.#t&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(I!==void 0&&typeof I!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#_=I,A!==void 0&&typeof A!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#a=A,this.#b=!!A,this.#o=new Map,this.#c=new Array(t).fill(void 0),this.#i=new Array(t).fill(void 0),this.#g=new et(t),this.#y=new et(t),this.#d=0,this.#f=0,this.#E=hy.create(t),this.#u=0,this.#h=0,typeof l=="function"&&(this.#s=l),typeof h=="function"?(this.#n=h,this.#m=[]):(this.#n=void 0,this.#m=void 0),this.#S=!!this.#s,this.#p=!!this.#n,this.noDisposeOnSet=!!f,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!D,this.allowStaleOnFetchRejection=!!G,this.allowStaleOnFetchAbort=!!W,this.ignoreFetchAbort=!!Fe,this.maxEntrySize!==0){if(this.#t!==0&&!Xi(this.#t))throw new TypeError("maxSize must be a positive integer if specified");if(!Xi(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#D()}if(this.allowStale=!!u,this.noDeleteOnStaleGet=!!L,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!c,this.ttlResolution=Xi(i)||i===0?i:1,this.ttlAutopurge=!!s,this.ttl=r||0,this.ttl){if(!Xi(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#O()}if(this.#e===0&&this.ttl===0&&this.#t===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#t){let ct="LRU_CACHE_UNBOUNDED";EL(ct)&&(sE.add(ct),aE("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",ct,n))}}getRemainingTTL(e){return this.#o.has(e)?1/0:0}#O(){let e=new lo(this.#e),t=new lo(this.#e);this.#w=e,this.#A=t,this.#F=(s,a,c=uo.now())=>{if(t[s]=a!==0?c:0,e[s]=a,a!==0&&this.ttlAutopurge){let u=setTimeout(()=>{this.#v(s)&&this.#P(this.#c[s],"expire")},a+1);u.unref&&u.unref()}},this.#C=s=>{t[s]=e[s]!==0?uo.now():0},this.#r=(s,a)=>{if(e[a]){let c=e[a],u=t[a];if(!c||!u)return;s.ttl=c,s.start=u,s.now=r||i();let l=s.now-u;s.remainingTTL=c-l}};let r=0,i=o(()=>{let s=uo.now();if(this.ttlResolution>0){r=s;let a=setTimeout(()=>r=0,this.ttlResolution);a.unref&&a.unref()}return s},"getNow");this.getRemainingTTL=s=>{let a=this.#o.get(s);if(a===void 0)return 0;let c=e[a],u=t[a];if(!c||!u)return 1/0;let l=(r||i())-u;return c-l},this.#v=s=>{let a=t[s],c=e[s];return!!c&&!!a&&(r||i())-a>c}}#C=o(()=>{},"#updateItemAge");#r=o(()=>{},"#statusTTL");#F=o(()=>{},"#setItemTTL");#v=o(()=>!1,"#isStale");#D(){let e=new lo(this.#e);this.#h=0,this.#T=e,this.#R=t=>{this.#h-=e[t],e[t]=0},this.#L=(t,r,i,s)=>{if(this.#l(r))return 0;if(!Xi(i))if(s){if(typeof s!="function")throw new TypeError("sizeCalculation must be a function");if(i=s(r,t),!Xi(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i},this.#N=(t,r,i)=>{if(e[t]=r,this.#t){let s=this.#t-e[t];for(;this.#h>s;)this.#j(!0)}this.#h+=e[t],i&&(i.entrySize=r,i.totalCalculatedSize=this.#h)}}#R=o(e=>{},"#removeItemSize");#N=o((e,t,r)=>{},"#addItemSize");#L=o((e,t,r,i)=>{if(r||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0},"#requireSize");*#x({allowStale:e=this.allowStale}={}){if(this.#u)for(let t=this.#f;!(!this.#k(t)||((e||!this.#v(t))&&(yield t),t===this.#d));)t=this.#y[t]}*#I({allowStale:e=this.allowStale}={}){if(this.#u)for(let t=this.#d;!(!this.#k(t)||((e||!this.#v(t))&&(yield t),t===this.#f));)t=this.#g[t]}#k(e){return e!==void 0&&this.#o.get(this.#c[e])===e}*entries(){for(let e of this.#x())this.#i[e]!==void 0&&this.#c[e]!==void 0&&!this.#l(this.#i[e])&&(yield[this.#c[e],this.#i[e]])}*rentries(){for(let e of this.#I())this.#i[e]!==void 0&&this.#c[e]!==void 0&&!this.#l(this.#i[e])&&(yield[this.#c[e],this.#i[e]])}*keys(){for(let e of this.#x()){let t=this.#c[e];t!==void 0&&!this.#l(this.#i[e])&&(yield t)}}*rkeys(){for(let e of this.#I()){let t=this.#c[e];t!==void 0&&!this.#l(this.#i[e])&&(yield t)}}*values(){for(let e of this.#x())this.#i[e]!==void 0&&!this.#l(this.#i[e])&&(yield this.#i[e])}*rvalues(){for(let e of this.#I())this.#i[e]!==void 0&&!this.#l(this.#i[e])&&(yield this.#i[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let r of this.#x()){let i=this.#i[r],s=this.#l(i)?i.__staleWhileFetching:i;if(s!==void 0&&e(s,this.#c[r],this))return this.get(this.#c[r],t)}}forEach(e,t=this){for(let r of this.#x()){let i=this.#i[r],s=this.#l(i)?i.__staleWhileFetching:i;s!==void 0&&e.call(t,s,this.#c[r],this)}}rforEach(e,t=this){for(let r of this.#I()){let i=this.#i[r],s=this.#l(i)?i.__staleWhileFetching:i;s!==void 0&&e.call(t,s,this.#c[r],this)}}purgeStale(){let e=!1;for(let t of this.#I({allowStale:!0}))this.#v(t)&&(this.#P(this.#c[t],"expire"),e=!0);return e}info(e){let t=this.#o.get(e);if(t===void 0)return;let r=this.#i[t],i=this.#l(r)?r.__staleWhileFetching:r;if(i===void 0)return;let s={value:i};if(this.#w&&this.#A){let a=this.#w[t],c=this.#A[t];if(a&&c){let u=a-(uo.now()-c);s.ttl=u,s.start=Date.now()}}return this.#T&&(s.size=this.#T[t]),s}dump(){let e=[];for(let t of this.#x({allowStale:!0})){let r=this.#c[t],i=this.#i[t],s=this.#l(i)?i.__staleWhileFetching:i;if(s===void 0||r===void 0)continue;let a={value:s};if(this.#w&&this.#A){a.ttl=this.#w[t];let c=uo.now()-this.#A[t];a.start=Math.floor(Date.now()-c)}this.#T&&(a.size=this.#T[t]),e.unshift([r,a])}return e}load(e){this.clear();for(let[t,r]of e){if(r.start){let i=Date.now()-r.start;r.start=uo.now()-i}this.set(t,r.value,r)}}set(e,t,r={}){if(t===void 0)return this.delete(e),this;let{ttl:i=this.ttl,start:s,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:u}=r,{noUpdateTTL:l=this.noUpdateTTL}=r,h=this.#L(e,t,r.size||0,c);if(this.maxEntrySize&&h>this.maxEntrySize)return u&&(u.set="miss",u.maxEntrySizeExceeded=!0),this.#P(e,"set"),this;let f=this.#u===0?void 0:this.#o.get(e);if(f===void 0)f=this.#u===0?this.#f:this.#E.length!==0?this.#E.pop():this.#u===this.#e?this.#j(!1):this.#u,this.#c[f]=e,this.#i[f]=t,this.#o.set(e,f),this.#g[this.#f]=f,this.#y[f]=this.#f,this.#f=f,this.#u++,this.#N(f,h,u),u&&(u.set="add"),l=!1;else{this.#$(f);let d=this.#i[f];if(t!==d){if(this.#b&&this.#l(d)){d.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:m}=d;m!==void 0&&!a&&(this.#S&&this.#s?.(m,e,"set"),this.#p&&this.#m?.push([m,e,"set"]))}else a||(this.#S&&this.#s?.(d,e,"set"),this.#p&&this.#m?.push([d,e,"set"]));if(this.#R(f),this.#N(f,h,u),this.#i[f]=t,u){u.set="replace";let m=d&&this.#l(d)?d.__staleWhileFetching:d;m!==void 0&&(u.oldValue=m)}}else u&&(u.set="update")}if(i!==0&&!this.#w&&this.#O(),this.#w&&(l||this.#F(f,i,s),u&&this.#r(u,f)),!a&&this.#p&&this.#m){let d=this.#m,m;for(;m=d?.shift();)this.#n?.(...m)}return this}pop(){try{for(;this.#u;){let e=this.#i[this.#d];if(this.#j(!0),this.#l(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#p&&this.#m){let e=this.#m,t;for(;t=e?.shift();)this.#n?.(...t)}}}#j(e){let t=this.#d,r=this.#c[t],i=this.#i[t];return this.#b&&this.#l(i)?i.__abortController.abort(new Error("evicted")):(this.#S||this.#p)&&(this.#S&&this.#s?.(i,r,"evict"),this.#p&&this.#m?.push([i,r,"evict"])),this.#R(t),e&&(this.#c[t]=void 0,this.#i[t]=void 0,this.#E.push(t)),this.#u===1?(this.#d=this.#f=0,this.#E.length=0):this.#d=this.#g[t],this.#o.delete(r),this.#u--,t}has(e,t={}){let{updateAgeOnHas:r=this.updateAgeOnHas,status:i}=t,s=this.#o.get(e);if(s!==void 0){let a=this.#i[s];if(this.#l(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#v(s))i&&(i.has="stale",this.#r(i,s));else return r&&this.#C(s),i&&(i.has="hit",this.#r(i,s)),!0}else i&&(i.has="miss");return!1}peek(e,t={}){let{allowStale:r=this.allowStale}=t,i=this.#o.get(e);if(i===void 0||!r&&this.#v(i))return;let s=this.#i[i];return this.#l(s)?s.__staleWhileFetching:s}#M(e,t,r,i){let s=t===void 0?void 0:this.#i[t];if(this.#l(s))return s;let a=new ef,{signal:c}=r;c?.addEventListener("abort",()=>a.abort(c.reason),{signal:a.signal});let u={signal:a.signal,options:r,context:i},l=o((S,A=!1)=>{let{aborted:I}=a.signal,D=r.ignoreFetchAbort&&S!==void 0;if(r.status&&(I&&!A?(r.status.fetchAborted=!0,r.status.fetchError=a.signal.reason,D&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),I&&!D&&!A)return f(a.signal.reason);let L=m;return this.#i[t]===m&&(S===void 0?L.__staleWhileFetching?this.#i[t]=L.__staleWhileFetching:this.#P(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,S,u.options))),S},"cb"),h=o(S=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=S),f(S)),"eb"),f=o(S=>{let{aborted:A}=a.signal,I=A&&r.allowStaleOnFetchAbort,D=I||r.allowStaleOnFetchRejection,L=D||r.noDeleteOnFetchRejection,G=m;if(this.#i[t]===m&&(!L||G.__staleWhileFetching===void 0?this.#P(e,"fetch"):I||(this.#i[t]=G.__staleWhileFetching)),D)return r.status&&G.__staleWhileFetching!==void 0&&(r.status.returnedStale=!0),G.__staleWhileFetching;if(G.__returned===G)throw S},"fetchFail"),d=o((S,A)=>{let I=this.#a?.(e,s,u);I&&I instanceof Promise&&I.then(D=>S(D===void 0?void 0:D),A),a.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(S(void 0),r.allowStaleOnFetchAbort&&(S=o(D=>l(D,!0),"res")))})},"pcall");r.status&&(r.status.fetchDispatched=!0);let m=new Promise(d).then(l,h),_=Object.assign(m,{__abortController:a,__staleWhileFetching:s,__returned:void 0});return t===void 0?(this.set(e,_,{...u.options,status:void 0}),t=this.#o.get(e)):this.#i[t]=_,_}#l(e){if(!this.#b)return!1;let t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof ef}async fetch(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:u=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:d=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:_=this.allowStaleOnFetchAbort,context:S,forceRefresh:A=!1,status:I,signal:D}=t;if(!this.#b)return I&&(I.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:i,noDeleteOnStaleGet:s,status:I});let L={allowStale:r,updateAgeOnGet:i,noDeleteOnStaleGet:s,ttl:a,noDisposeOnSet:c,size:u,sizeCalculation:l,noUpdateTTL:h,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:d,allowStaleOnFetchAbort:_,ignoreFetchAbort:m,status:I,signal:D},G=this.#o.get(e);if(G===void 0){I&&(I.fetch="miss");let W=this.#M(e,G,L,S);return W.__returned=W}else{let W=this.#i[G];if(this.#l(W)){let ue=r&&W.__staleWhileFetching!==void 0;return I&&(I.fetch="inflight",ue&&(I.returnedStale=!0)),ue?W.__staleWhileFetching:W.__returned=W}let Fe=this.#v(G);if(!A&&!Fe)return I&&(I.fetch="hit"),this.#$(G),i&&this.#C(G),I&&this.#r(I,G),W;let et=this.#M(e,G,L,S),U=et.__staleWhileFetching!==void 0&&r;return I&&(I.fetch=Fe?"stale":"refresh",U&&Fe&&(I.returnedStale=!0)),U?et.__staleWhileFetching:et.__returned=et}}async forceFetch(e,t={}){let r=await this.fetch(e,t);if(r===void 0)throw new Error("fetch() returned undefined");return r}memo(e,t={}){let r=this.#_;if(!r)throw new Error("no memoMethod provided to constructor");let{context:i,forceRefresh:s,...a}=t,c=this.get(e,a);if(!s&&c!==void 0)return c;let u=r(e,c,{options:a,context:i});return this.set(e,u,a),u}get(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:a}=t,c=this.#o.get(e);if(c!==void 0){let u=this.#i[c],l=this.#l(u);return a&&this.#r(a,c),this.#v(c)?(a&&(a.get="stale"),l?(a&&r&&u.__staleWhileFetching!==void 0&&(a.returnedStale=!0),r?u.__staleWhileFetching:void 0):(s||this.#P(e,"expire"),a&&r&&(a.returnedStale=!0),r?u:void 0)):(a&&(a.get="hit"),l?u.__staleWhileFetching:(this.#$(c),i&&this.#C(c),u))}else a&&(a.get="miss")}#V(e,t){this.#y[t]=e,this.#g[e]=t}#$(e){e!==this.#f&&(e===this.#d?this.#d=this.#g[e]:this.#V(this.#y[e],this.#g[e]),this.#V(this.#f,e),this.#f=e)}delete(e){return this.#P(e,"delete")}#P(e,t){let r=!1;if(this.#u!==0){let i=this.#o.get(e);if(i!==void 0)if(r=!0,this.#u===1)this.#U(t);else{this.#R(i);let s=this.#i[i];if(this.#l(s)?s.__abortController.abort(new Error("deleted")):(this.#S||this.#p)&&(this.#S&&this.#s?.(s,e,t),this.#p&&this.#m?.push([s,e,t])),this.#o.delete(e),this.#c[i]=void 0,this.#i[i]=void 0,i===this.#f)this.#f=this.#y[i];else if(i===this.#d)this.#d=this.#g[i];else{let a=this.#y[i];this.#g[a]=this.#g[i];let c=this.#g[i];this.#y[c]=this.#y[i]}this.#u--,this.#E.push(i)}}if(this.#p&&this.#m?.length){let i=this.#m,s;for(;s=i?.shift();)this.#n?.(...s)}return r}clear(){return this.#U("delete")}#U(e){for(let t of this.#I({allowStale:!0})){let r=this.#i[t];if(this.#l(r))r.__abortController.abort(new Error("deleted"));else{let i=this.#c[t];this.#S&&this.#s?.(r,i,e),this.#p&&this.#m?.push([r,i,e])}}if(this.#o.clear(),this.#i.fill(void 0),this.#c.fill(void 0),this.#w&&this.#A&&(this.#w.fill(0),this.#A.fill(0)),this.#T&&this.#T.fill(0),this.#d=0,this.#f=0,this.#E.length=0,this.#h=0,this.#u=0,this.#p&&this.#m){let t=this.#m,r;for(;r=t?.shift();)this.#n?.(...r)}}};var po=require("node:path"),yE=require("node:url"),Zn=require("fs"),RL=Ze(require("node:fs"),1),es=require("node:fs/promises");var cf=require("node:events"),vy=Ze(require("node:stream"),1),fE=require("node:string_decoder");var cE=typeof process=="object"&&process?process:{stdout:null,stderr:null},TL=o(n=>!!n&&typeof n=="object"&&(n instanceof Zi||n instanceof vy.default||AL(n)||CL(n)),"isStream"),AL=o(n=>!!n&&typeof n=="object"&&n instanceof cf.EventEmitter&&typeof n.pipe=="function"&&n.pipe!==vy.default.Writable.prototype.pipe,"isReadable"),CL=o(n=>!!n&&typeof n=="object"&&n instanceof cf.EventEmitter&&typeof n.write=="function"&&typeof n.end=="function","isWritable"),Ei=Symbol("EOF"),Ti=Symbol("maybeEmitEnd"),Ji=Symbol("emittedEnd"),tf=Symbol("emittingEnd"),Fc=Symbol("emittedError"),rf=Symbol("closed"),uE=Symbol("read"),nf=Symbol("flush"),lE=Symbol("flushChunk"),Cn=Symbol("encoding"),ho=Symbol("decoder"),Ft=Symbol("flowing"),Rc=Symbol("paused"),fo=Symbol("resume"),Rt=Symbol("buffer"),_r=Symbol("pipes"),Nt=Symbol("bufferLength"),fy=Symbol("bufferPush"),sf=Symbol("bufferShift"),nr=Symbol("objectMode"),yt=Symbol("destroyed"),dy=Symbol("error"),py=Symbol("emitData"),hE=Symbol("emitEnd"),my=Symbol("emitEnd2"),Xn=Symbol("async"),gy=Symbol("abort"),af=Symbol("aborted"),Nc=Symbol("signal"),Hs=Symbol("dataListeners"),Mr=Symbol("discarded"),Lc=o(n=>Promise.resolve().then(n),"defer"),xL=o(n=>n(),"nodefer"),IL=o(n=>n==="end"||n==="finish"||n==="prefinish","isEndish"),OL=o(n=>n instanceof ArrayBuffer||!!n&&typeof n=="object"&&n.constructor&&n.constructor.name==="ArrayBuffer"&&n.byteLength>=0,"isArrayBufferLike"),DL=o(n=>!Buffer.isBuffer(n)&&ArrayBuffer.isView(n),"isArrayBufferView"),of=class{static{o(this,"Pipe")}src;dest;opts;ondrain;constructor(e,t,r){this.src=e,this.dest=t,this.opts=r,this.ondrain=()=>e[fo](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},yy=class extends of{static{o(this,"PipeProxyErrors")}unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,r){super(e,t,r),this.proxyErrors=i=>t.emit("error",i),e.on("error",this.proxyErrors)}},PL=o(n=>!!n.objectMode,"isObjectModeOptions"),FL=o(n=>!n.objectMode&&!!n.encoding&&n.encoding!=="buffer","isEncodingOptions"),Zi=class extends cf.EventEmitter{static{o(this,"Minipass")}[Ft]=!1;[Rc]=!1;[_r]=[];[Rt]=[];[nr];[Cn];[Xn];[ho];[Ei]=!1;[Ji]=!1;[tf]=!1;[rf]=!1;[Fc]=null;[Nt]=0;[yt]=!1;[Nc];[af]=!1;[Hs]=0;[Mr]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");PL(t)?(this[nr]=!0,this[Cn]=null):FL(t)?(this[Cn]=t.encoding,this[nr]=!1):(this[nr]=!1,this[Cn]=null),this[Xn]=!!t.async,this[ho]=this[Cn]?new fE.StringDecoder(this[Cn]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:o(()=>this[Rt],"get")}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:o(()=>this[_r],"get")});let{signal:r}=t;r&&(this[Nc]=r,r.aborted?this[gy]():r.addEventListener("abort",()=>this[gy]()))}get bufferLength(){return this[Nt]}get encoding(){return this[Cn]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[nr]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[Xn]}set async(e){this[Xn]=this[Xn]||!!e}[gy](){this[af]=!0,this.emit("abort",this[Nc]?.reason),this.destroy(this[Nc]?.reason)}get aborted(){return this[af]}set aborted(e){}write(e,t,r){if(this[af])return!1;if(this[Ei])throw new Error("write after end");if(this[yt])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(r=t,t="utf8"),t||(t="utf8");let i=this[Xn]?Lc:xL;if(!this[nr]&&!Buffer.isBuffer(e)){if(DL(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(OL(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[nr]?(this[Ft]&&this[Nt]!==0&&this[nf](!0),this[Ft]?this.emit("data",e):this[fy](e),this[Nt]!==0&&this.emit("readable"),r&&i(r),this[Ft]):e.length?(typeof e=="string"&&!(t===this[Cn]&&!this[ho]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[Cn]&&(e=this[ho].write(e)),this[Ft]&&this[Nt]!==0&&this[nf](!0),this[Ft]?this.emit("data",e):this[fy](e),this[Nt]!==0&&this.emit("readable"),r&&i(r),this[Ft]):(this[Nt]!==0&&this.emit("readable"),r&&i(r),this[Ft])}read(e){if(this[yt])return null;if(this[Mr]=!1,this[Nt]===0||e===0||e&&e>this[Nt])return this[Ti](),null;this[nr]&&(e=null),this[Rt].length>1&&!this[nr]&&(this[Rt]=[this[Cn]?this[Rt].join(""):Buffer.concat(this[Rt],this[Nt])]);let t=this[uE](e||null,this[Rt][0]);return this[Ti](),t}[uE](e,t){if(this[nr])this[sf]();else{let r=t;e===r.length||e===null?this[sf]():typeof r=="string"?(this[Rt][0]=r.slice(e),t=r.slice(0,e),this[Nt]-=e):(this[Rt][0]=r.subarray(e),t=r.subarray(0,e),this[Nt]-=e)}return this.emit("data",t),!this[Rt].length&&!this[Ei]&&this.emit("drain"),t}end(e,t,r){return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t="utf8"),e!==void 0&&this.write(e,t),r&&this.once("end",r),this[Ei]=!0,this.writable=!1,(this[Ft]||!this[Rc])&&this[Ti](),this}[fo](){this[yt]||(!this[Hs]&&!this[_r].length&&(this[Mr]=!0),this[Rc]=!1,this[Ft]=!0,this.emit("resume"),this[Rt].length?this[nf]():this[Ei]?this[Ti]():this.emit("drain"))}resume(){return this[fo]()}pause(){this[Ft]=!1,this[Rc]=!0,this[Mr]=!1}get destroyed(){return this[yt]}get flowing(){return this[Ft]}get paused(){return this[Rc]}[fy](e){this[nr]?this[Nt]+=1:this[Nt]+=e.length,this[Rt].push(e)}[sf](){return this[nr]?this[Nt]-=1:this[Nt]-=this[Rt][0].length,this[Rt].shift()}[nf](e=!1){do;while(this[lE](this[sf]())&&this[Rt].length);!e&&!this[Rt].length&&!this[Ei]&&this.emit("drain")}[lE](e){return this.emit("data",e),this[Ft]}pipe(e,t){if(this[yt])return e;this[Mr]=!1;let r=this[Ji];return t=t||{},e===cE.stdout||e===cE.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,r?t.end&&e.end():(this[_r].push(t.proxyErrors?new yy(this,e,t):new of(this,e,t)),this[Xn]?Lc(()=>this[fo]()):this[fo]()),e}unpipe(e){let t=this[_r].find(r=>r.dest===e);t&&(this[_r].length===1?(this[Ft]&&this[Hs]===0&&(this[Ft]=!1),this[_r]=[]):this[_r].splice(this[_r].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let r=super.on(e,t);if(e==="data")this[Mr]=!1,this[Hs]++,!this[_r].length&&!this[Ft]&&this[fo]();else if(e==="readable"&&this[Nt]!==0)super.emit("readable");else if(IL(e)&&this[Ji])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[Fc]){let i=t;this[Xn]?Lc(()=>i.call(this,this[Fc])):i.call(this,this[Fc])}return r}removeListener(e,t){return this.off(e,t)}off(e,t){let r=super.off(e,t);return e==="data"&&(this[Hs]=this.listeners("data").length,this[Hs]===0&&!this[Mr]&&!this[_r].length&&(this[Ft]=!1)),r}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[Hs]=0,!this[Mr]&&!this[_r].length&&(this[Ft]=!1)),t}get emittedEnd(){return this[Ji]}[Ti](){!this[tf]&&!this[Ji]&&!this[yt]&&this[Rt].length===0&&this[Ei]&&(this[tf]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[rf]&&this.emit("close"),this[tf]=!1)}emit(e,...t){let r=t[0];if(e!=="error"&&e!=="close"&&e!==yt&&this[yt])return!1;if(e==="data")return!this[nr]&&!r?!1:this[Xn]?(Lc(()=>this[py](r)),!0):this[py](r);if(e==="end")return this[hE]();if(e==="close"){if(this[rf]=!0,!this[Ji]&&!this[yt])return!1;let s=super.emit("close");return this.removeAllListeners("close"),s}else if(e==="error"){this[Fc]=r,super.emit(dy,r);let s=!this[Nc]||this.listeners("error").length?super.emit("error",r):!1;return this[Ti](),s}else if(e==="resume"){let s=super.emit("resume");return this[Ti](),s}else if(e==="finish"||e==="prefinish"){let s=super.emit(e);return this.removeAllListeners(e),s}let i=super.emit(e,...t);return this[Ti](),i}[py](e){for(let r of this[_r])r.dest.write(e)===!1&&this.pause();let t=this[Mr]?!1:super.emit("data",e);return this[Ti](),t}[hE](){return this[Ji]?!1:(this[Ji]=!0,this.readable=!1,this[Xn]?(Lc(()=>this[my]()),!0):this[my]())}[my](){if(this[ho]){let t=this[ho].end();if(t){for(let r of this[_r])r.dest.write(t);this[Mr]||super.emit("data",t)}}for(let t of this[_r])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[nr]||(e.dataLength=0);let t=this.promise();return this.on("data",r=>{e.push(r),this[nr]||(e.dataLength+=r.length)}),await t,e}async concat(){if(this[nr])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[Cn]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(yt,()=>t(new Error("stream destroyed"))),this.on("error",r=>t(r)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[Mr]=!1;let e=!1,t=o(async()=>(this.pause(),e=!0,{value:void 0,done:!0}),"stop");return{next:o(()=>{if(e)return t();let i=this.read();if(i!==null)return Promise.resolve({done:!1,value:i});if(this[Ei])return t();let s,a,c=o(f=>{this.off("data",u),this.off("end",l),this.off(yt,h),t(),a(f)},"onerr"),u=o(f=>{this.off("error",c),this.off("end",l),this.off(yt,h),this.pause(),s({value:f,done:!!this[Ei]})},"ondata"),l=o(()=>{this.off("error",c),this.off("data",u),this.off(yt,h),t(),s({done:!0,value:void 0})},"onend"),h=o(()=>c(new Error("stream destroyed")),"ondestroy");return new Promise((f,d)=>{a=d,s=f,this.once(yt,h),this.once("error",c),this.once("end",l),this.once("data",u)})},"next"),throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[Mr]=!1;let e=!1,t=o(()=>(this.pause(),this.off(dy,t),this.off(yt,t),this.off("end",t),e=!0,{done:!0,value:void 0}),"stop"),r=o(()=>{if(e)return t();let i=this.read();return i===null?t():{done:!1,value:i}},"next");return this.once("end",t),this.once(dy,t),this.once(yt,t),{next:r,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[yt])return e?this.emit("error",e):this.emit(yt),this;this[yt]=!0,this[Mr]=!0,this[Rt].length=0,this[Nt]=0;let t=this;return typeof t.close=="function"&&!this[rf]&&t.close(),e?this.emit("error",e):this.emit(yt),this}static get isStream(){return TL}};var NL=Zn.realpathSync.native,jc={lstatSync:Zn.lstatSync,readdir:Zn.readdir,readdirSync:Zn.readdirSync,readlinkSync:Zn.readlinkSync,realpathSync:NL,promises:{lstat:es.lstat,readdir:es.readdir,readlink:es.readlink,realpath:es.realpath}},vE=o(n=>!n||n===jc||n===RL?jc:{...jc,...n,promises:{...jc.promises,...n.promises||{}}},"fsFromOption"),wE=/^\\\\\?\\([a-z]:)\\?$/i,LL=o(n=>n.replace(/\//g,"\\").replace(wE,"$1\\"),"uncToDrive"),kL=/[\\\/]/,Kr=0,_E=1,SE=2,Jn=4,bE=6,EE=8,Ys=10,TE=12,Qr=15,kc=~Qr,wy=16,dE=32,Mc=64,xn=128,uf=256,hf=512,pE=Mc|xn|hf,jL=1023,_y=o(n=>n.isFile()?EE:n.isDirectory()?Jn:n.isSymbolicLink()?Ys:n.isCharacterDevice()?SE:n.isBlockDevice()?bE:n.isSocket()?TE:n.isFIFO()?_E:Kr,"entToType"),mE=new Map,Vc=o(n=>{let e=mE.get(n);if(e)return e;let t=n.normalize("NFKD");return mE.set(n,t),t},"normalize"),gE=new Map,lf=o(n=>{let e=gE.get(n);if(e)return e;let t=Vc(n.toLowerCase());return gE.set(n,t),t},"normalizeNocase"),ff=class extends Pc{static{o(this,"ResolveCache")}constructor(){super({max:256})}},Sy=class extends Pc{static{o(this,"ChildrenCache")}constructor(e=16*1024){super({maxSize:e,sizeCalculation:o(t=>t.length+1,"sizeCalculation")})}},AE=Symbol("PathScurry setAsCwd"),ir=class{static{o(this,"PathBase")}name;root;roots;parent;nocase;isCWD=!1;#e;#t;get dev(){return this.#t}#s;get mode(){return this.#s}#n;get nlink(){return this.#n}#a;get uid(){return this.#a}#_;get gid(){return this.#_}#u;get rdev(){return this.#u}#h;get blksize(){return this.#h}#o;get ino(){return this.#o}#c;get size(){return this.#c}#i;get blocks(){return this.#i}#g;get atimeMs(){return this.#g}#y;get mtimeMs(){return this.#y}#d;get ctimeMs(){return this.#d}#f;get birthtimeMs(){return this.#f}#E;get atime(){return this.#E}#m;get mtime(){return this.#m}#T;get ctime(){return this.#T}#A;get birthtime(){return this.#A}#w;#S;#b;#p;#O;#C;#r;#F;#v;#D;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(e,t=Kr,r,i,s,a,c){this.name=e,this.#w=s?lf(e):Vc(e),this.#r=t&jL,this.nocase=s,this.roots=i,this.root=r||this,this.#F=a,this.#b=c.fullpath,this.#O=c.relative,this.#C=c.relativePosix,this.parent=c.parent,this.parent?this.#e=this.parent.#e:this.#e=vE(c.fs)}depth(){return this.#S!==void 0?this.#S:this.parent?this.#S=this.parent.depth()+1:this.#S=0}childrenCache(){return this.#F}resolve(e){if(!e)return this;let t=this.getRootString(e),i=e.substring(t.length).split(this.splitSep);return t?this.getRoot(t).#R(i):this.#R(i)}#R(e){let t=this;for(let r of e)t=t.child(r);return t}children(){let e=this.#F.get(this);if(e)return e;let t=Object.assign([],{provisional:0});return this.#F.set(this,t),this.#r&=~wy,t}child(e,t){if(e===""||e===".")return this;if(e==="..")return this.parent||this;let r=this.children(),i=this.nocase?lf(e):Vc(e);for(let u of r)if(u.#w===i)return u;let s=this.parent?this.sep:"",a=this.#b?this.#b+s+e:void 0,c=this.newChild(e,Kr,{...t,parent:this,fullpath:a});return this.canReaddir()||(c.#r|=xn),r.push(c),c}relative(){if(this.isCWD)return"";if(this.#O!==void 0)return this.#O;let e=this.name,t=this.parent;if(!t)return this.#O=this.name;let r=t.relative();return r+(!r||!t.parent?"":this.sep)+e}relativePosix(){if(this.sep==="/")return this.relative();if(this.isCWD)return"";if(this.#C!==void 0)return this.#C;let e=this.name,t=this.parent;if(!t)return this.#C=this.fullpathPosix();let r=t.relativePosix();return r+(!r||!t.parent?"":"/")+e}fullpath(){if(this.#b!==void 0)return this.#b;let e=this.name,t=this.parent;if(!t)return this.#b=this.name;let i=t.fullpath()+(t.parent?this.sep:"")+e;return this.#b=i}fullpathPosix(){if(this.#p!==void 0)return this.#p;if(this.sep==="/")return this.#p=this.fullpath();if(!this.parent){let i=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(i)?this.#p=`//?/${i}`:this.#p=i}let e=this.parent,t=e.fullpathPosix(),r=t+(!t||!e.parent?"":"/")+this.name;return this.#p=r}isUnknown(){return(this.#r&Qr)===Kr}isType(e){return this[`is${e}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(this.#r&Qr)===EE}isDirectory(){return(this.#r&Qr)===Jn}isCharacterDevice(){return(this.#r&Qr)===SE}isBlockDevice(){return(this.#r&Qr)===bE}isFIFO(){return(this.#r&Qr)===_E}isSocket(){return(this.#r&Qr)===TE}isSymbolicLink(){return(this.#r&Ys)===Ys}lstatCached(){return this.#r&dE?this:void 0}readlinkCached(){return this.#v}realpathCached(){return this.#D}readdirCached(){let e=this.children();return e.slice(0,e.provisional)}canReadlink(){if(this.#v)return!0;if(!this.parent)return!1;let e=this.#r&Qr;return!(e!==Kr&&e!==Ys||this.#r&uf||this.#r&xn)}calledReaddir(){return!!(this.#r&wy)}isENOENT(){return!!(this.#r&xn)}isNamed(e){return this.nocase?this.#w===lf(e):this.#w===Vc(e)}async readlink(){let e=this.#v;if(e)return e;if(this.canReadlink()&&this.parent)try{let t=await this.#e.promises.readlink(this.fullpath()),r=(await this.parent.realpath())?.resolve(t);if(r)return this.#v=r}catch(t){this.#l(t.code);return}}readlinkSync(){let e=this.#v;if(e)return e;if(this.canReadlink()&&this.parent)try{let t=this.#e.readlinkSync(this.fullpath()),r=this.parent.realpathSync()?.resolve(t);if(r)return this.#v=r}catch(t){this.#l(t.code);return}}#N(e){this.#r|=wy;for(let t=e.provisional;t<e.length;t++){let r=e[t];r&&r.#L()}}#L(){this.#r&xn||(this.#r=(this.#r|xn)&kc,this.#x())}#x(){let e=this.children();e.provisional=0;for(let t of e)t.#L()}#I(){this.#r|=hf,this.#k()}#k(){if(this.#r&Mc)return;let e=this.#r;(e&Qr)===Jn&&(e&=kc),this.#r=e|Mc,this.#x()}#j(e=""){e==="ENOTDIR"||e==="EPERM"?this.#k():e==="ENOENT"?this.#L():this.children().provisional=0}#M(e=""){e==="ENOTDIR"?this.parent.#k():e==="ENOENT"&&this.#L()}#l(e=""){let t=this.#r;t|=uf,e==="ENOENT"&&(t|=xn),(e==="EINVAL"||e==="UNKNOWN")&&(t&=kc),this.#r=t,e==="ENOTDIR"&&this.parent&&this.parent.#k()}#V(e,t){return this.#P(e,t)||this.#$(e,t)}#$(e,t){let r=_y(e),i=this.newChild(e.name,r,{parent:this}),s=i.#r&Qr;return s!==Jn&&s!==Ys&&s!==Kr&&(i.#r|=Mc),t.unshift(i),t.provisional++,i}#P(e,t){for(let r=t.provisional;r<t.length;r++){let i=t[r];if((this.nocase?lf(e.name):Vc(e.name))===i.#w)return this.#U(e,i,r,t)}}#U(e,t,r,i){let s=t.name;return t.#r=t.#r&kc|_y(e),s!==e.name&&(t.name=e.name),r!==i.provisional&&(r===i.length-1?i.pop():i.splice(r,1),i.unshift(t)),i.provisional++,t}async lstat(){if((this.#r&xn)===0)try{return this.#W(await this.#e.promises.lstat(this.fullpath())),this}catch(e){this.#M(e.code)}}lstatSync(){if((this.#r&xn)===0)try{return this.#W(this.#e.lstatSync(this.fullpath())),this}catch(e){this.#M(e.code)}}#W(e){let{atime:t,atimeMs:r,birthtime:i,birthtimeMs:s,blksize:a,blocks:c,ctime:u,ctimeMs:l,dev:h,gid:f,ino:d,mode:m,mtime:_,mtimeMs:S,nlink:A,rdev:I,size:D,uid:L}=e;this.#E=t,this.#g=r,this.#A=i,this.#f=s,this.#h=a,this.#i=c,this.#T=u,this.#d=l,this.#t=h,this.#_=f,this.#o=d,this.#s=m,this.#m=_,this.#y=S,this.#n=A,this.#u=I,this.#c=D,this.#a=L;let G=_y(e);this.#r=this.#r&kc|G|dE,G!==Kr&&G!==Jn&&G!==Ys&&(this.#r|=Mc)}#q=[];#G=!1;#z(e){this.#G=!1;let t=this.#q.slice();this.#q.length=0,t.forEach(r=>r(null,e))}readdirCB(e,t=!1){if(!this.canReaddir()){t?e(null,[]):queueMicrotask(()=>e(null,[]));return}let r=this.children();if(this.calledReaddir()){let s=r.slice(0,r.provisional);t?e(null,s):queueMicrotask(()=>e(null,s));return}if(this.#q.push(e),this.#G)return;this.#G=!0;let i=this.fullpath();this.#e.readdir(i,{withFileTypes:!0},(s,a)=>{if(s)this.#j(s.code),r.provisional=0;else{for(let c of a)this.#V(c,r);this.#N(r)}this.#z(r.slice(0,r.provisional))})}#B;async readdir(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();if(this.#B)await this.#B;else{let r=o(()=>{},"resolve");this.#B=new Promise(i=>r=i);try{for(let i of await this.#e.promises.readdir(t,{withFileTypes:!0}))this.#V(i,e);this.#N(e)}catch(i){this.#j(i.code),e.provisional=0}this.#B=void 0,r()}return e.slice(0,e.provisional)}readdirSync(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();try{for(let r of this.#e.readdirSync(t,{withFileTypes:!0}))this.#V(r,e);this.#N(e)}catch(r){this.#j(r.code),e.provisional=0}return e.slice(0,e.provisional)}canReaddir(){if(this.#r&pE)return!1;let e=Qr&this.#r;return e===Kr||e===Jn||e===Ys}shouldWalk(e,t){return(this.#r&Jn)===Jn&&!(this.#r&pE)&&!e.has(this)&&(!t||t(this))}async realpath(){if(this.#D)return this.#D;if(!((hf|uf|xn)&this.#r))try{let e=await this.#e.promises.realpath(this.fullpath());return this.#D=this.resolve(e)}catch{this.#I()}}realpathSync(){if(this.#D)return this.#D;if(!((hf|uf|xn)&this.#r))try{let e=this.#e.realpathSync(this.fullpath());return this.#D=this.resolve(e)}catch{this.#I()}}[AE](e){if(e===this)return;e.isCWD=!1,this.isCWD=!0;let t=new Set([]),r=[],i=this;for(;i&&i.parent;)t.add(i),i.#O=r.join(this.sep),i.#C=r.join("/"),i=i.parent,r.push("..");for(i=e;i&&i.parent&&!t.has(i);)i.#O=void 0,i.#C=void 0,i=i.parent}},df=class n extends ir{static{o(this,"PathWin32")}sep="\\";splitSep=kL;constructor(e,t=Kr,r,i,s,a,c){super(e,t,r,i,s,a,c)}newChild(e,t=Kr,r={}){return new n(e,t,this.root,this.roots,this.nocase,this.childrenCache(),r)}getRootString(e){return po.win32.parse(e).root}getRoot(e){if(e=LL(e.toUpperCase()),e===this.root.name)return this.root;for(let[t,r]of Object.entries(this.roots))if(this.sameRoot(e,t))return this.roots[e]=r;return this.roots[e]=new mo(e,this).root}sameRoot(e,t=this.root.name){return e=e.toUpperCase().replace(/\//g,"\\").replace(wE,"$1\\"),e===t}},pf=class n extends ir{static{o(this,"PathPosix")}splitSep="/";sep="/";constructor(e,t=Kr,r,i,s,a,c){super(e,t,r,i,s,a,c)}getRootString(e){return e.startsWith("/")?"/":""}getRoot(e){return this.root}newChild(e,t=Kr,r={}){return new n(e,t,this.root,this.roots,this.nocase,this.childrenCache(),r)}},mf=class{static{o(this,"PathScurryBase")}root;rootPath;roots;cwd;#e;#t;#s;nocase;#n;constructor(e=process.cwd(),t,r,{nocase:i,childrenCacheSize:s=16*1024,fs:a=jc}={}){this.#n=vE(a),(e instanceof URL||e.startsWith("file://"))&&(e=(0,yE.fileURLToPath)(e));let c=t.resolve(e);this.roots=Object.create(null),this.rootPath=this.parseRootPath(c),this.#e=new ff,this.#t=new ff,this.#s=new Sy(s);let u=c.substring(this.rootPath.length).split(r);if(u.length===1&&!u[0]&&u.pop(),i===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=i,this.root=this.newRoot(this.#n),this.roots[this.rootPath]=this.root;let l=this.root,h=u.length-1,f=t.sep,d=this.rootPath,m=!1;for(let _ of u){let S=h--;l=l.child(_,{relative:new Array(S).fill("..").join(f),relativePosix:new Array(S).fill("..").join("/"),fullpath:d+=(m?"":f)+_}),m=!0}this.cwd=l}depth(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.depth()}childrenCache(){return this.#s}resolve(...e){let t="";for(let s=e.length-1;s>=0;s--){let a=e[s];if(!(!a||a===".")&&(t=t?`${a}/${t}`:a,this.isAbsolute(a)))break}let r=this.#e.get(t);if(r!==void 0)return r;let i=this.cwd.resolve(t).fullpath();return this.#e.set(t,i),i}resolvePosix(...e){let t="";for(let s=e.length-1;s>=0;s--){let a=e[s];if(!(!a||a===".")&&(t=t?`${a}/${t}`:a,this.isAbsolute(a)))break}let r=this.#t.get(t);if(r!==void 0)return r;let i=this.cwd.resolve(t).fullpathPosix();return this.#t.set(t,i),i}relative(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.relative()}relativePosix(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.relativePosix()}basename(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.name}dirname(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),(e.parent||e).fullpath()}async readdir(e=this.cwd,t={withFileTypes:!0}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd);let{withFileTypes:r}=t;if(e.canReaddir()){let i=await e.readdir();return r?i:i.map(s=>s.name)}else return[]}readdirSync(e=this.cwd,t={withFileTypes:!0}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd);let{withFileTypes:r=!0}=t;return e.canReaddir()?r?e.readdirSync():e.readdirSync().map(i=>i.name):[]}async lstat(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.lstat()}lstatSync(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.lstatSync()}async readlink(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e.withFileTypes,e=this.cwd);let r=await e.readlink();return t?r:r?.fullpath()}readlinkSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e.withFileTypes,e=this.cwd);let r=e.readlinkSync();return t?r:r?.fullpath()}async realpath(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e.withFileTypes,e=this.cwd);let r=await e.realpath();return t?r:r?.fullpath()}realpathSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e.withFileTypes,e=this.cwd);let r=e.realpathSync();return t?r:r?.fullpath()}async walk(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=[];(!s||s(e))&&c.push(r?e:e.fullpath());let u=new Set,l=o((f,d)=>{u.add(f),f.readdirCB((m,_)=>{if(m)return d(m);let S=_.length;if(!S)return d();let A=o(()=>{--S===0&&d()},"next");for(let I of _)(!s||s(I))&&c.push(r?I:I.fullpath()),i&&I.isSymbolicLink()?I.realpath().then(D=>D?.isUnknown()?D.lstat():D).then(D=>D?.shouldWalk(u,a)?l(D,A):A()):I.shouldWalk(u,a)?l(I,A):A()},!0)},"walk"),h=e;return new Promise((f,d)=>{l(h,m=>{if(m)return d(m);f(c)})})}walkSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=[];(!s||s(e))&&c.push(r?e:e.fullpath());let u=new Set([e]);for(let l of u){let h=l.readdirSync();for(let f of h){(!s||s(f))&&c.push(r?f:f.fullpath());let d=f;if(f.isSymbolicLink()){if(!(i&&(d=f.realpathSync())))continue;d.isUnknown()&&d.lstatSync()}d.shouldWalk(u,a)&&u.add(d)}}return c}[Symbol.asyncIterator](){return this.iterate()}iterate(e=this.cwd,t={}){return typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd),this.stream(e,t)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t;(!s||s(e))&&(yield r?e:e.fullpath());let c=new Set([e]);for(let u of c){let l=u.readdirSync();for(let h of l){(!s||s(h))&&(yield r?h:h.fullpath());let f=h;if(h.isSymbolicLink()){if(!(i&&(f=h.realpathSync())))continue;f.isUnknown()&&f.lstatSync()}f.shouldWalk(c,a)&&c.add(f)}}}stream(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=new Zi({objectMode:!0});(!s||s(e))&&c.write(r?e:e.fullpath());let u=new Set,l=[e],h=0,f=o(()=>{let d=!1;for(;!d;){let m=l.shift();if(!m){h===0&&c.end();return}h++,u.add(m);let _=o((A,I,D=!1)=>{if(A)return c.emit("error",A);if(i&&!D){let L=[];for(let G of I)G.isSymbolicLink()&&L.push(G.realpath().then(W=>W?.isUnknown()?W.lstat():W));if(L.length){Promise.all(L).then(()=>_(null,I,!0));return}}for(let L of I)L&&(!s||s(L))&&(c.write(r?L:L.fullpath())||(d=!0));h--;for(let L of I){let G=L.realpathCached()||L;G.shouldWalk(u,a)&&l.push(G)}d&&!c.flowing?c.once("drain",f):S||f()},"onReaddir"),S=!0;m.readdirCB(_,!0),S=!1}},"process");return f(),c}streamSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof ir||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=new Zi({objectMode:!0}),u=new Set;(!s||s(e))&&c.write(r?e:e.fullpath());let l=[e],h=0,f=o(()=>{let d=!1;for(;!d;){let m=l.shift();if(!m){h===0&&c.end();return}h++,u.add(m);let _=m.readdirSync();for(let S of _)(!s||s(S))&&(c.write(r?S:S.fullpath())||(d=!0));h--;for(let S of _){let A=S;if(S.isSymbolicLink()){if(!(i&&(A=S.realpathSync())))continue;A.isUnknown()&&A.lstatSync()}A.shouldWalk(u,a)&&l.push(A)}}d&&!c.flowing&&c.once("drain",f)},"process");return f(),c}chdir(e=this.cwd){let t=this.cwd;this.cwd=typeof e=="string"?this.cwd.resolve(e):e,this.cwd[AE](t)}},mo=class extends mf{static{o(this,"PathScurryWin32")}sep="\\";constructor(e=process.cwd(),t={}){let{nocase:r=!0}=t;super(e,po.win32,"\\",{...t,nocase:r}),this.nocase=r;for(let i=this.cwd;i;i=i.parent)i.nocase=this.nocase}parseRootPath(e){return po.win32.parse(e).root.toUpperCase()}newRoot(e){return new df(this.rootPath,Jn,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith("/")||e.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(e)}},go=class extends mf{static{o(this,"PathScurryPosix")}sep="/";constructor(e=process.cwd(),t={}){let{nocase:r=!1}=t;super(e,po.posix,"/",{...t,nocase:r}),this.nocase=r}parseRootPath(e){return"/"}newRoot(e){return new pf(this.rootPath,Jn,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith("/")}},$c=class extends go{static{o(this,"PathScurryDarwin")}constructor(e=process.cwd(),t={}){let{nocase:r=!0}=t;super(e,{...t,nocase:r})}},$z=process.platform==="win32"?df:pf,CE=process.platform==="win32"?mo:process.platform==="darwin"?$c:go;var ML=o(n=>n.length>=1,"isPatternList"),VL=o(n=>n.length>=1,"isGlobList"),yo=class n{static{o(this,"Pattern")}#e;#t;#s;length;#n;#a;#_;#u;#h;#o;#c=!0;constructor(e,t,r,i){if(!ML(e))throw new TypeError("empty pattern list");if(!VL(t))throw new TypeError("empty glob list");if(t.length!==e.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=e.length,r<0||r>=this.length)throw new TypeError("index out of range");if(this.#e=e,this.#t=t,this.#s=r,this.#n=i,this.#s===0){if(this.isUNC()){let[s,a,c,u,...l]=this.#e,[h,f,d,m,..._]=this.#t;l[0]===""&&(l.shift(),_.shift());let S=[s,a,c,u,""].join("/"),A=[h,f,d,m,""].join("/");this.#e=[S,...l],this.#t=[A,..._],this.length=this.#e.length}else if(this.isDrive()||this.isAbsolute()){let[s,...a]=this.#e,[c,...u]=this.#t;a[0]===""&&(a.shift(),u.shift());let l=s+"/",h=c+"/";this.#e=[l,...a],this.#t=[h,...u],this.length=this.#e.length}}}pattern(){return this.#e[this.#s]}isString(){return typeof this.#e[this.#s]=="string"}isGlobstar(){return this.#e[this.#s]===Wt}isRegExp(){return this.#e[this.#s]instanceof RegExp}globString(){return this.#_=this.#_||(this.#s===0?this.isAbsolute()?this.#t[0]+this.#t.slice(1).join("/"):this.#t.join("/"):this.#t.slice(this.#s).join("/"))}hasMore(){return this.length>this.#s+1}rest(){return this.#a!==void 0?this.#a:this.hasMore()?(this.#a=new n(this.#e,this.#t,this.#s+1,this.#n),this.#a.#o=this.#o,this.#a.#h=this.#h,this.#a.#u=this.#u,this.#a):this.#a=null}isUNC(){let e=this.#e;return this.#h!==void 0?this.#h:this.#h=this.#n==="win32"&&this.#s===0&&e[0]===""&&e[1]===""&&typeof e[2]=="string"&&!!e[2]&&typeof e[3]=="string"&&!!e[3]}isDrive(){let e=this.#e;return this.#u!==void 0?this.#u:this.#u=this.#n==="win32"&&this.#s===0&&this.length>1&&typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0])}isAbsolute(){let e=this.#e;return this.#o!==void 0?this.#o:this.#o=e[0]===""&&e.length>1||this.isDrive()||this.isUNC()}root(){let e=this.#e[0];return typeof e=="string"&&this.isAbsolute()&&this.#s===0?e:""}checkFollowGlobstar(){return!(this.#s===0||!this.isGlobstar()||!this.#c)}markFollowGlobstar(){return this.#s===0||!this.isGlobstar()||!this.#c?!1:(this.#c=!1,!0)}};var $L=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",vo=class{static{o(this,"Ignore")}relative;relativeChildren;absolute;absoluteChildren;platform;mmopts;constructor(e,{nobrace:t,nocase:r,noext:i,noglobstar:s,platform:a=$L}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[],this.platform=a,this.mmopts={dot:!0,nobrace:t,nocase:r,noext:i,noglobstar:s,optimizationLevel:2,platform:a,nocomment:!0,nonegate:!0};for(let c of e)this.add(c)}add(e){let t=new jr(e,this.mmopts);for(let r=0;r<t.set.length;r++){let i=t.set[r],s=t.globParts[r];if(!i||!s)throw new Error("invalid pattern object");for(;i[0]==="."&&s[0]===".";)i.shift(),s.shift();let a=new yo(i,s,0,this.platform),c=new jr(a.globString(),this.mmopts),u=s[s.length-1]==="**",l=a.isAbsolute();l?this.absolute.push(c):this.relative.push(c),u&&(l?this.absoluteChildren.push(c):this.relativeChildren.push(c))}}ignored(e){let t=e.fullpath(),r=`${t}/`,i=e.relative()||".",s=`${i}/`;for(let a of this.relative)if(a.match(i)||a.match(s))return!0;for(let a of this.absolute)if(a.match(t)||a.match(r))return!0;return!1}childrenIgnored(e){let t=e.fullpath()+"/",r=(e.relative()||".")+"/";for(let i of this.relativeChildren)if(i.match(r))return!0;for(let i of this.absoluteChildren)if(i.match(t))return!0;return!1}};var by=class n{static{o(this,"HasWalkedCache")}store;constructor(e=new Map){this.store=e}copy(){return new n(new Map(this.store))}hasWalked(e,t){return this.store.get(e.fullpath())?.has(t.globString())}storeWalked(e,t){let r=e.fullpath(),i=this.store.get(r);i?i.add(t.globString()):this.store.set(r,new Set([t.globString()]))}},Ey=class{static{o(this,"MatchRecord")}store=new Map;add(e,t,r){let i=(t?2:0)|(r?1:0),s=this.store.get(e);this.store.set(e,s===void 0?i:i&s)}entries(){return[...this.store.entries()].map(([e,t])=>[e,!!(t&2),!!(t&1)])}},Ty=class{static{o(this,"SubWalks")}store=new Map;add(e,t){if(!e.canReaddir())return;let r=this.store.get(e);r?r.find(i=>i.globString()===t.globString())||r.push(t):this.store.set(e,[t])}get(e){let t=this.store.get(e);if(!t)throw new Error("attempting to walk unknown path");return t}entries(){return this.keys().map(e=>[e,this.store.get(e)])}keys(){return[...this.store.keys()].filter(e=>e.canReaddir())}},Uc=class n{static{o(this,"Processor")}hasWalkedCache;matches=new Ey;subwalks=new Ty;patterns;follow;dot;opts;constructor(e,t){this.opts=e,this.follow=!!e.follow,this.dot=!!e.dot,this.hasWalkedCache=t?t.copy():new by}processPatterns(e,t){this.patterns=t;let r=t.map(i=>[e,i]);for(let[i,s]of r){this.hasWalkedCache.storeWalked(i,s);let a=s.root(),c=s.isAbsolute()&&this.opts.absolute!==!1;if(a){i=i.resolve(a==="/"&&this.opts.root!==void 0?this.opts.root:a);let f=s.rest();if(f)s=f;else{this.matches.add(i,!0,!1);continue}}if(i.isENOENT())continue;let u,l,h=!1;for(;typeof(u=s.pattern())=="string"&&(l=s.rest());)i=i.resolve(u),s=l,h=!0;if(u=s.pattern(),l=s.rest(),h){if(this.hasWalkedCache.hasWalked(i,s))continue;this.hasWalkedCache.storeWalked(i,s)}if(typeof u=="string"){let f=u===".."||u===""||u===".";this.matches.add(i.resolve(u),c,f);continue}else if(u===Wt){(!i.isSymbolicLink()||this.follow||s.checkFollowGlobstar())&&this.subwalks.add(i,s);let f=l?.pattern(),d=l?.rest();if(!l||(f===""||f===".")&&!d)this.matches.add(i,c,f===""||f===".");else if(f===".."){let m=i.parent||i;d?this.hasWalkedCache.hasWalked(m,d)||this.subwalks.add(m,d):this.matches.add(m,c,!0)}}else u instanceof RegExp&&this.subwalks.add(i,s)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new n(this.opts,this.hasWalkedCache)}filterEntries(e,t){let r=this.subwalks.get(e),i=this.child();for(let s of t)for(let a of r){let c=a.isAbsolute(),u=a.pattern(),l=a.rest();u===Wt?i.testGlobstar(s,a,l,c):u instanceof RegExp?i.testRegExp(s,u,l,c):i.testString(s,u,l,c)}return i}testGlobstar(e,t,r,i){if((this.dot||!e.name.startsWith("."))&&(t.hasMore()||this.matches.add(e,i,!1),e.canReaddir()&&(this.follow||!e.isSymbolicLink()?this.subwalks.add(e,t):e.isSymbolicLink()&&(r&&t.checkFollowGlobstar()?this.subwalks.add(e,r):t.markFollowGlobstar()&&this.subwalks.add(e,t)))),r){let s=r.pattern();if(typeof s=="string"&&s!==".."&&s!==""&&s!==".")this.testString(e,s,r.rest(),i);else if(s===".."){let a=e.parent||e;this.subwalks.add(a,r)}else s instanceof RegExp&&this.testRegExp(e,s,r.rest(),i)}}testRegExp(e,t,r,i){t.test(e.name)&&(r?this.subwalks.add(e,r):this.matches.add(e,i,!1))}testString(e,t,r,i){e.isNamed(t)&&(r?this.subwalks.add(e,r):this.matches.add(e,i,!1))}};var UL=o((n,e)=>typeof n=="string"?new vo([n],e):Array.isArray(n)?new vo(n,e):n,"makeIgnore"),gf=class{static{o(this,"GlobUtil")}path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#e=[];#t;#s;signal;maxDepth;includeChildMatches;constructor(e,t,r){if(this.patterns=e,this.path=t,this.opts=r,this.#s=!r.posix&&r.platform==="win32"?"\\":"/",this.includeChildMatches=r.includeChildMatches!==!1,(r.ignore||!this.includeChildMatches)&&(this.#t=UL(r.ignore??[],r),!this.includeChildMatches&&typeof this.#t.add!="function")){let i="cannot ignore child matches, ignore lacks add() method.";throw new Error(i)}this.maxDepth=r.maxDepth||1/0,r.signal&&(this.signal=r.signal,this.signal.addEventListener("abort",()=>{this.#e.length=0}))}#n(e){return this.seen.has(e)||!!this.#t?.ignored?.(e)}#a(e){return!!this.#t?.childrenIgnored?.(e)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;this.paused=!1;let e;for(;!this.paused&&(e=this.#e.shift());)e()}onResume(e){this.signal?.aborted||(this.paused?this.#e.push(e):e())}async matchCheck(e,t){if(t&&this.opts.nodir)return;let r;if(this.opts.realpath){if(r=e.realpathCached()||await e.realpath(),!r)return;e=r}let s=e.isUnknown()||this.opts.stat?await e.lstat():e;if(this.opts.follow&&this.opts.nodir&&s?.isSymbolicLink()){let a=await s.realpath();a&&(a.isUnknown()||this.opts.stat)&&await a.lstat()}return this.matchCheckTest(s,t)}matchCheckTest(e,t){return e&&(this.maxDepth===1/0||e.depth()<=this.maxDepth)&&(!t||e.canReaddir())&&(!this.opts.nodir||!e.isDirectory())&&(!this.opts.nodir||!this.opts.follow||!e.isSymbolicLink()||!e.realpathCached()?.isDirectory())&&!this.#n(e)?e:void 0}matchCheckSync(e,t){if(t&&this.opts.nodir)return;let r;if(this.opts.realpath){if(r=e.realpathCached()||e.realpathSync(),!r)return;e=r}let s=e.isUnknown()||this.opts.stat?e.lstatSync():e;if(this.opts.follow&&this.opts.nodir&&s?.isSymbolicLink()){let a=s.realpathSync();a&&(a?.isUnknown()||this.opts.stat)&&a.lstatSync()}return this.matchCheckTest(s,t)}matchFinish(e,t){if(this.#n(e))return;if(!this.includeChildMatches&&this.#t?.add){let s=`${e.relativePosix()}/**`;this.#t.add(s)}let r=this.opts.absolute===void 0?t:this.opts.absolute;this.seen.add(e);let i=this.opts.mark&&e.isDirectory()?this.#s:"";if(this.opts.withFileTypes)this.matchEmit(e);else if(r){let s=this.opts.posix?e.fullpathPosix():e.fullpath();this.matchEmit(s+i)}else{let s=this.opts.posix?e.relativePosix():e.relative(),a=this.opts.dotRelative&&!s.startsWith(".."+this.#s)?"."+this.#s:"";this.matchEmit(s?a+s+i:"."+i)}}async match(e,t,r){let i=await this.matchCheck(e,r);i&&this.matchFinish(i,t)}matchSync(e,t,r){let i=this.matchCheckSync(e,r);i&&this.matchFinish(i,t)}walkCB(e,t,r){this.signal?.aborted&&r(),this.walkCB2(e,t,new Uc(this.opts),r)}walkCB2(e,t,r,i){if(this.#a(e))return i();if(this.signal?.aborted&&i(),this.paused){this.onResume(()=>this.walkCB2(e,t,r,i));return}r.processPatterns(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||(s++,this.match(c,u,l).then(()=>a()));for(let c of r.subwalkTargets()){if(this.maxDepth!==1/0&&c.depth()>=this.maxDepth)continue;s++;let u=c.readdirCached();c.calledReaddir()?this.walkCB3(c,u,r,a):c.readdirCB((l,h)=>this.walkCB3(c,h,r,a),!0)}a()}walkCB3(e,t,r,i){r=r.filterEntries(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||(s++,this.match(c,u,l).then(()=>a()));for(let[c,u]of r.subwalks.entries())s++,this.walkCB2(c,u,r.child(),a);a()}walkCBSync(e,t,r){this.signal?.aborted&&r(),this.walkCB2Sync(e,t,new Uc(this.opts),r)}walkCB2Sync(e,t,r,i){if(this.#a(e))return i();if(this.signal?.aborted&&i(),this.paused){this.onResume(()=>this.walkCB2Sync(e,t,r,i));return}r.processPatterns(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||this.matchSync(c,u,l);for(let c of r.subwalkTargets()){if(this.maxDepth!==1/0&&c.depth()>=this.maxDepth)continue;s++;let u=c.readdirSync();this.walkCB3Sync(c,u,r,a)}a()}walkCB3Sync(e,t,r,i){r=r.filterEntries(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||this.matchSync(c,u,l);for(let[c,u]of r.subwalks.entries())s++,this.walkCB2Sync(c,u,r.child(),a);a()}},Bc=class extends gf{static{o(this,"GlobWalker")}matches=new Set;constructor(e,t,r){super(e,t,r)}matchEmit(e){this.matches.add(e)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((e,t)=>{this.walkCB(this.path,this.patterns,()=>{this.signal?.aborted?t(this.signal.reason):e(this.matches)})}),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{if(this.signal?.aborted)throw this.signal.reason}),this.matches}},qc=class extends gf{static{o(this,"GlobStream")}results;constructor(e,t,r){super(e,t,r),this.results=new Zi({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(e){this.results.write(e),this.results.flowing||this.pause()}stream(){let e=this.path;return e.isUnknown()?e.lstat().then(()=>{this.walkCB(e,this.patterns,()=>this.results.end())}):this.walkCB(e,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var BL=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",In=class{static{o(this,"Glob")}absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(e,t){if(!t)throw new TypeError("glob options required");if(this.withFileTypes=!!t.withFileTypes,this.signal=t.signal,this.follow=!!t.follow,this.dot=!!t.dot,this.dotRelative=!!t.dotRelative,this.nodir=!!t.nodir,this.mark=!!t.mark,t.cwd?(t.cwd instanceof URL||t.cwd.startsWith("file://"))&&(t.cwd=(0,xE.fileURLToPath)(t.cwd)):this.cwd="",this.cwd=t.cwd||"",this.root=t.root,this.magicalBraces=!!t.magicalBraces,this.nobrace=!!t.nobrace,this.noext=!!t.noext,this.realpath=!!t.realpath,this.absolute=t.absolute,this.includeChildMatches=t.includeChildMatches!==!1,this.noglobstar=!!t.noglobstar,this.matchBase=!!t.matchBase,this.maxDepth=typeof t.maxDepth=="number"?t.maxDepth:1/0,this.stat=!!t.stat,this.ignore=t.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof e=="string"&&(e=[e]),this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(e=e.map(u=>u.replace(/\\/g,"/"))),this.matchBase){if(t.noglobstar)throw new TypeError("base matching requires globstar");e=e.map(u=>u.includes("/")?u:`./**/${u}`)}if(this.pattern=e,this.platform=t.platform||BL,this.opts={...t,platform:this.platform},t.scurry){if(this.scurry=t.scurry,t.nocase!==void 0&&t.nocase!==t.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{let u=t.platform==="win32"?mo:t.platform==="darwin"?$c:t.platform?go:CE;this.scurry=new u(this.cwd,{nocase:t.nocase,fs:t.fs})}this.nocase=this.scurry.nocase;let r=this.platform==="darwin"||this.platform==="win32",i={...t,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:r,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},s=this.pattern.map(u=>new jr(u,i)),[a,c]=s.reduce((u,l)=>(u[0].push(...l.set),u[1].push(...l.globParts),u),[[],[]]);this.patterns=a.map((u,l)=>{let h=c[l];if(!h)throw new Error("invalid pattern object");return new yo(u,h,0,this.platform)})}async walk(){return[...await new Bc(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new Bc(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new qc(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new qc(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var Ay=o((n,e={})=>{Array.isArray(n)||(n=[n]);for(let t of n)if(new jr(t,e).hasMagic())return!0;return!1},"hasMagic");function vf(n,e={}){return new In(n,e).streamSync()}o(vf,"globStreamSync");function OE(n,e={}){return new In(n,e).stream()}o(OE,"globStream");function DE(n,e={}){return new In(n,e).walkSync()}o(DE,"globSync");async function IE(n,e={}){return new In(n,e).walk()}o(IE,"glob_");function wf(n,e={}){return new In(n,e).iterateSync()}o(wf,"globIterateSync");function PE(n,e={}){return new In(n,e).iterate()}o(PE,"globIterate");var qL=vf,GL=Object.assign(OE,{sync:vf}),WL=wf,zL=Object.assign(PE,{sync:wf}),HL=Object.assign(DE,{stream:vf,iterate:wf}),yf=Object.assign(IE,{glob:IE,globSync:DE,sync:HL,globStream:OE,stream:GL,globStreamSync:vf,streamSync:qL,globIterate:PE,iterate:zL,globIterateSync:wf,iterateSync:WL,Glob:In,hasMagic:Ay,escape:co,unescape:An});yf.glob=yf;var Qs=Ze(Gi());var rs=class{constructor(e){this.rootPath=e}static{o(this,"NodeFsAdapter")}async readFile(e){let t=this.resolvePath(e);if(!await It.default.pathExists(t))throw new Qs.FileNotFoundError(e);return It.default.readFile(t,"utf-8")}async fileExists(e){let t=this.resolvePath(e);return It.default.pathExists(t)}async getFileMetadata(e){let t=await this.readFile(e);return this.extractFrontmatter(t)}async createFile(e,t){let r=this.resolvePath(e);if(await It.default.pathExists(r))throw new Qs.FileAlreadyExistsError(e);return await It.default.ensureDir(ts.default.dirname(r)),await It.default.writeFile(r,t,"utf-8"),e}async updateFile(e,t){let r=this.resolvePath(e);if(!await It.default.pathExists(r))throw new Qs.FileNotFoundError(e);await It.default.writeFile(r,t,"utf-8")}async writeFile(e,t){let r=this.resolvePath(e);await It.default.ensureDir(ts.default.dirname(r)),await It.default.writeFile(r,t,"utf-8")}async deleteFile(e){let t=this.resolvePath(e);if(!await It.default.pathExists(t))throw new Qs.FileNotFoundError(e);await It.default.remove(t)}async renameFile(e,t){let r=this.resolvePath(e),i=this.resolvePath(t);if(!await It.default.pathExists(r))throw new Qs.FileNotFoundError(e);await It.default.ensureDir(ts.default.dirname(i)),await It.default.move(r,i)}async createDirectory(e){let t=this.resolvePath(e);await It.default.ensureDir(t)}async directoryExists(e){let t=this.resolvePath(e);return await It.default.pathExists(t)?(await It.default.stat(t)).isDirectory():!1}async getMarkdownFiles(e){let t=e?this.resolvePath(e):this.rootPath,r=ts.default.join(t,"**/*.md");return(await yf(r,{nodir:!0})).map(a=>ts.default.relative(this.rootPath,a))}async findFilesByMetadata(e){let t=await this.getMarkdownFiles(),r=[];for(let i of t)try{let s=await this.getFileMetadata(i);this.matchesQuery(s,e)&&r.push(i)}catch{continue}return r}async findFileByUID(e){let t=await this.findFilesByMetadata({exo__Asset_uid:e});return t.length>0?t[0]:null}resolvePath(e){return ts.default.isAbsolute(e)?e:ts.default.join(this.rootPath,e)}extractFrontmatter(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r)return{};try{let i=Tc.load(r[1]);return typeof i=="object"&&i!==null?i:{}}catch{return{}}}matchesQuery(e,t){for(let[r,i]of Object.entries(t)){let s=e[r];if(Array.isArray(s)){if(!s.some(a=>this.normalizeValue(a)===this.normalizeValue(i)))return!1}else if(this.normalizeValue(s)!==this.normalizeValue(i))return!1}return!0}normalizeValue(e){return e==null?"":String(e).replace(/["'[\]]/g,"").trim()}};var Gc=Ze(require("path")),Cy=Ze(ro());var wo=class{constructor(e){this.vaultRoot=e}static{o(this,"PathResolver")}resolve(e){if(!Gc.default.isAbsolute(e))return Gc.default.resolve(this.vaultRoot,e);let t=Gc.default.resolve(e),r=Gc.default.resolve(this.vaultRoot);if(!t.startsWith(r))throw new nt(`File path ${e} is outside vault root ${this.vaultRoot}`,"Provide a file path within the vault directory.",{filepath:e,vaultRoot:this.vaultRoot});return t}validate(e){if(!Cy.default.existsSync(e))throw new Cc(e);if(!Cy.default.statSync(e).isFile())throw new nt(`Not a file: ${e}`,"Provide a path to a file, not a directory.",{filepath:e});if(!e.endsWith(".md"))throw new nt(`Not a Markdown file: ${e}`,"Provide a path to a .md file.",{filepath:e})}getVaultRoot(){return this.vaultRoot}};var jE=Ze(Gi());var FE=Ze(Gi());var On=class{static{o(this,"BaseCommandExecutor")}constructor(e){this.pathResolver=e.pathResolver,this.fsAdapter=e.fsAdapter,this.frontmatterService=e.frontmatterService,this.dryRun=e.dryRun}resolveAndValidate(e){let t=this.pathResolver.resolve(e);this.pathResolver.validate(t);let r=t.replace(this.pathResolver.getVaultRoot()+"/","");return{resolvedPath:t,relativePath:r}}getCurrentTimestamp(){return FE.DateFormatter.toLocalTimestamp(new Date)}isAssetArchived(e){if(e?.exo__Asset_isArchived===!0)return!0;let t=e?.archived;if(t==null)return!1;if(typeof t=="boolean")return t;if(typeof t=="number")return t!==0;if(typeof t=="string"){let r=t.toLowerCase().trim();return r==="true"||r==="yes"||r==="1"}return!1}extractAliasesFromFrontmatter(e){let t=e.match(/aliases:\s*\n((?:  - .*\n?)*)/);return t?t[1].split(`
`).filter(i=>i.trim()).map(i=>i.replace(/^\s*-\s*/,"").trim()):[]}};var Wc=class extends On{static{o(this,"StatusCommandExecutor")}constructor(e){super(e)}async executeStart(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDoing]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_startTimestamp",i),await this.fsAdapter.updateFile(t,s),console.log(`\u2705 Started: ${e}`),console.log("   Status: Doing"),console.log(`   Start time: ${i}`),process.exit(0)}catch(t){ye.handle(t)}}async executeComplete(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDone]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_endTimestamp",i),s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(t,s),console.log(`\u2705 Completed: ${e}`),console.log("   Status: Done"),console.log(`   Completion time: ${i}`),process.exit(0)}catch(t){ye.handle(t)}}async executeTrash(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusTrashed]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(t,s),console.log(`\u2705 Trashed: ${e}`),console.log("   Status: Trashed"),console.log(`   Resolution time: ${i}`),process.exit(0)}catch(t){ye.handle(t)}}async executeArchive(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.frontmatterService.updateProperty(r,"archived","true");i=this.frontmatterService.removeProperty(i,"aliases"),await this.fsAdapter.updateFile(t,i),console.log(`\u2705 Archived: ${e}`),console.log("   Archived: true"),console.log("   Aliases removed"),process.exit(0)}catch(t){ye.handle(t)}}async executeMoveToBacklog(e){try{await this.updateStatus(e,"ems__EffortStatusBacklog","Backlog"),process.exit(0)}catch(t){ye.handle(t)}}async executeMoveToAnalysis(e){try{await this.updateStatus(e,"ems__EffortStatusAnalysis","Analysis"),process.exit(0)}catch(t){ye.handle(t)}}async executeMoveToToDo(e){try{await this.updateStatus(e,"ems__EffortStatusToDo","ToDo"),process.exit(0)}catch(t){ye.handle(t)}}async updateStatus(e,t,r){let{relativePath:i}=this.resolveAndValidate(e),s=await this.fsAdapter.readFile(i),a=this.frontmatterService.updateProperty(s,"ems__Effort_status",`"[[${t}]]"`);await this.fsAdapter.updateFile(i,a),console.log(`\u2705 Moved to ${r}: ${e}`),console.log(`   Status: ${r}`)}};var Ht=[];for(let n=0;n<256;++n)Ht.push((n+256).toString(16).slice(1));function RE(n,e=0){return(Ht[n[e+0]]+Ht[n[e+1]]+Ht[n[e+2]]+Ht[n[e+3]]+"-"+Ht[n[e+4]]+Ht[n[e+5]]+"-"+Ht[n[e+6]]+Ht[n[e+7]]+"-"+Ht[n[e+8]]+Ht[n[e+9]]+"-"+Ht[n[e+10]]+Ht[n[e+11]]+Ht[n[e+12]]+Ht[n[e+13]]+Ht[n[e+14]]+Ht[n[e+15]]).toLowerCase()}o(RE,"unsafeStringify");var NE=require("node:crypto");var Sf=new Uint8Array(256),_f=Sf.length;function xy(){return _f>Sf.length-16&&((0,NE.randomFillSync)(Sf),_f=0),Sf.slice(_f,_f+=16)}o(xy,"rng");var LE=require("node:crypto"),Iy={randomUUID:LE.randomUUID};function QL(n,e,t){n=n||{};let r=n.random??n.rng?.()??xy();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[t+i]=r[i];return e}return RE(r)}o(QL,"_v4");function KL(n,e,t){return Iy.randomUUID&&!e&&!n?Iy.randomUUID():QL(n,e,t)}o(KL,"v4");var Oy=KL;var _o=Ze(Gi());var zc=class extends On{static{o(this,"AssetCreationExecutor")}constructor(e){super(e)}async executeCreateTask(e,t,r={}){try{await this.createAsset(e,t,"ems__Task",r),process.exit(0)}catch(i){ye.handle(i)}}async executeCreateMeeting(e,t,r={}){try{await this.createAsset(e,t,"ems__Meeting",r),process.exit(0)}catch(i){ye.handle(i)}}async executeCreateProject(e,t,r={}){try{await this.createAsset(e,t,"ems__Project",r),process.exit(0)}catch(i){ye.handle(i)}}async executeCreateArea(e,t,r={}){try{await this.createAsset(e,t,"ems__Area",r),process.exit(0)}catch(i){ye.handle(i)}}async createAsset(e,t,r,i={}){if(!t||t.trim().length===0)throw new Error("Label cannot be empty");let s=t.trim(),{relativePath:a}=this.resolveAndValidate(e);if(await this.fsAdapter.fileExists(a))throw new _o.FileAlreadyExistsError(e);let u=Oy(),l=this.buildAssetFrontmatter(r,u,s,i),h=_o.MetadataHelpers.buildFileContent(l);await this.fsAdapter.createFile(a,h),console.log(`\u2705 Created ${this.getAssetTypeName(r)}: ${e}`),console.log(`   UID: ${u}`),console.log(`   Label: ${s}`),console.log(`   Class: ${r}`)}buildAssetFrontmatter(e,t,r,i={}){let s=_o.DateFormatter.toLocalTimestamp(new Date),a={exo__Asset_isDefinedBy:'"[[Ontology/EMS]]"',exo__Asset_uid:t,exo__Asset_label:r,exo__Asset_createdAt:s,exo__Instance_class:[`"[[${e}]]"`],aliases:[r]};return(e==="ems__Task"||e==="ems__Project"||e==="ems__Meeting")&&(a.ems__Effort_status='"[[ems__EffortStatusDraft]]"'),i.prototype&&(a.ems__Effort_prototype=`"[[${i.prototype}]]"`),i.area&&(a.ems__Effort_area=`"[[${i.area}]]"`),i.parent&&(a.ems__Effort_parent=`"[[${i.parent}]]"`),a}getAssetTypeName(e){return{ems__Task:"task",ems__Meeting:"meeting",ems__Project:"project",ems__Area:"area"}[e]||"asset"}};var Dy=Ze(require("path"));var kE=Ze(Gi());var Hc=class extends On{static{o(this,"PropertyCommandExecutor")}constructor(e){super(e)}async executeRenameToUid(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.getFileMetadata(t);if(!r.exo__Asset_uid)throw new Error("Asset missing exo__Asset_uid property");let i=Dy.default.basename(t,".md"),s=r.exo__Asset_uid;if(i===s&&(console.log(`\u2705 Already renamed: ${e}`),console.log(`   Current filename matches UID: ${s}.md`),process.exit(0)),!r.exo__Asset_label||r.exo__Asset_label.trim()===""){let u=await this.fsAdapter.readFile(t),l=this.frontmatterService.updateProperty(u,"exo__Asset_label",i),h=this.isAssetArchived(r),f=l;h||(f=this.frontmatterService.updateProperty(l,"aliases",`
  - ${i}`)),await this.fsAdapter.updateFile(t,f),console.log(`   Updated label: "${i}"`)}let a=Dy.default.dirname(t),c=a!=="."?`${a}/${s}.md`:`${s}.md`;await this.fsAdapter.renameFile(t,c),console.log("\u2705 Renamed to UID format"),console.log(`   Old: ${t}`),console.log(`   New: ${c}`),process.exit(0)}catch(t){ye.handle(t)}}async executeUpdateLabel(e,t){try{if(!t||t.trim().length===0)throw new Error("Label cannot be empty");let r=t.trim(),{relativePath:i}=this.resolveAndValidate(e),s=await this.fsAdapter.readFile(i),a=this.frontmatterService.updateProperty(s,"exo__Asset_label",r),c=this.frontmatterService.parse(a),u=this.extractAliasesFromFrontmatter(c.content);if(u.includes(r)||(u.length===0?a=this.frontmatterService.updateProperty(a,"aliases",`
  - ${r}`):a=this.frontmatterService.updateProperty(a,"aliases",`${u.map(l=>`
  - ${l}`).join("")}
  - ${r}`)),this.dryRun){if(console.log("\u{1F50D} DRY RUN: Preview of changes (not applied)"),console.log(`   File: ${e}`),console.log("   Changes:"),console.log(`     \u2022 exo__Asset_label: "${r}"`),u.includes(r))console.log("     \u2022 aliases: unchanged (label already present)");else{let l=u.length===0?[r]:[...u,r];console.log(`     \u2022 aliases: [${l.map(h=>`"${h}"`).join(", ")}]`)}console.log(`
\u{1F4A1} Run without --dry-run to apply changes`),process.exit(0)}await this.fsAdapter.updateFile(i,a),console.log("\u2705 Updated label"),console.log(`   File: ${e}`),console.log(`   New label: "${r}"`),console.log("   Aliases synchronized"),process.exit(0)}catch(r){ye.handle(r)}}async executeSchedule(e,t){try{await this.updatePlannedTimestamp(e,t,"ems__Effort_plannedStartTimestamp"),process.exit(0)}catch(r){ye.handle(r)}}async executeSetDeadline(e,t){try{await this.updatePlannedTimestamp(e,t,"ems__Effort_plannedEndTimestamp"),process.exit(0)}catch(r){ye.handle(r)}}async updatePlannedTimestamp(e,t,r){let{relativePath:i}=this.resolveAndValidate(e);if(!await this.fsAdapter.fileExists(i))throw new Error(`File not found: ${e}`);if(!/^\d{4}-\d{2}-\d{2}$/.test(t))throw new Error(`Invalid date format: ${t}. Expected YYYY-MM-DD (e.g., 2025-11-25)`);let a=kE.DateFormatter.toTimestampAtStartOfDay(t),c=await this.fsAdapter.readFile(i),u=this.frontmatterService.updateProperty(c,r,a);await this.fsAdapter.writeFile(i,u),console.log(`\u2705 ${r==="ems__Effort_plannedStartTimestamp"?"Scheduled":"Set deadline for"}: ${e}`),console.log(`   Date: ${t}`),console.log(`   Timestamp: ${a}`)}};var ns=Ze(require("path"));var Yc=class extends On{static{o(this,"FolderRepairExecutor")}constructor(e){super(e)}async executeRepairFolder(e){try{let{relativePath:t}=this.resolveAndValidate(e),i=(await this.fsAdapter.getFileMetadata(t))?.exo__Asset_isDefinedBy;if(!i)throw new Error("Cannot determine expected folder: missing exo__Asset_isDefinedBy");let s=this.extractReference(i);if(!s)throw new Error("Cannot determine expected folder: invalid exo__Asset_isDefinedBy format");let a=await this.findReferencedFile(s,t);if(!a)throw new Error(`Cannot determine expected folder: referenced asset not found: ${s}`);let c=ns.default.dirname(a),u=c==="."?"":c,l=ns.default.dirname(t),h=l==="."?"":l;if(this.normalizePath(h)===this.normalizePath(u))return console.log("\u2705 Already in correct folder"),console.log(`   File: ${e}`),console.log(`   Folder: ${u||"(root)"}`),process.exit(0),{moved:!1,oldPath:t,newPath:t,expectedFolder:u};if(this.dryRun){let _=ns.default.basename(t),S=u?`${u}/${_}`:_;return console.log("\u{1F50D} DRY RUN: Preview of changes (not applied)"),console.log(`   File: ${e}`),console.log(`   Current folder: ${h||"(root)"}`),console.log(`   Expected folder: ${u||"(root)"}`),console.log(`   Would move to: ${S}`),console.log(`
\u{1F4A1} Run without --dry-run to apply changes`),process.exit(0),{moved:!1,oldPath:t,newPath:S,expectedFolder:u}}let f=ns.default.basename(t),d=u?`${u}/${f}`:f;if(await this.fsAdapter.fileExists(d))throw new Error(`Cannot move file: ${d} already exists`);return u&&(await this.fsAdapter.directoryExists(u)||await this.fsAdapter.createDirectory(u)),await this.fsAdapter.renameFile(t,d),console.log("\u2705 Moved to correct folder"),console.log(`   Old path: ${t}`),console.log(`   New path: ${d}`),console.log(`   Expected folder: ${u||"(root)"}`),process.exit(0),{moved:!0,oldPath:t,newPath:d,expectedFolder:u}}catch(t){ye.handle(t)}}extractReference(e){if(typeof e!="string")return null;let t=e.trim().replace(/^["']|["']$/g,"");return t=t.replace(/^\[\[|\]\]$/g,""),t||null}async findReferencedFile(e,t){let r=e.endsWith(".md")?e:`${e}.md`;if(e.includes("/")&&await this.fsAdapter.fileExists(r))return r;let i=ns.default.dirname(t),s=i?`${i}/${r}`:r;if(await this.fsAdapter.fileExists(s))return s;let c=await this.fsAdapter.findFileByUID(e);return c||(await this.fsAdapter.getMarkdownFiles()).find(h=>{let f=ns.default.basename(h,".md"),d=ns.default.basename(r,".md");return f===d})||null}normalizePath(e){return e.replace(/\\/g,"/").replace(/^\.\//,"").replace(/\/$/,"")}};var bf=class{static{o(this,"CommandExecutor")}constructor(e,t=!1){this.context={pathResolver:new wo(e),fsAdapter:new rs(e),frontmatterService:new jE.FrontmatterService,dryRun:t},this.statusExecutor=new Wc(this.context),this.creationExecutor=new zc(this.context),this.propertyExecutor=new Hc(this.context),this.folderRepairExecutor=new Yc(this.context)}async execute(e,t,r){try{let i=this.context.pathResolver.resolve(t);this.context.pathResolver.validate(i),await this.context.fsAdapter.readFile(i.replace(this.context.pathResolver.getVaultRoot()+"/","")),console.log("\u2705 Command infrastructure verified"),console.log(`   Command: ${e}`),console.log(`   File: ${i}`),console.log(`   Vault: ${this.context.pathResolver.getVaultRoot()}`),Object.keys(r).length>0&&console.log(`   Options: ${JSON.stringify(r,null,2)}`),console.log(`
\u{1F4DD} Note: Actual command execution will be implemented in follow-up issues.`),console.log("    This PR establishes the infrastructure foundation."),process.exit(0)}catch(i){ye.handle(i)}}getVaultRoot(){return this.context.pathResolver.getVaultRoot()}async executeStart(e){return this.statusExecutor.executeStart(e)}async executeComplete(e){return this.statusExecutor.executeComplete(e)}async executeTrash(e){return this.statusExecutor.executeTrash(e)}async executeArchive(e){return this.statusExecutor.executeArchive(e)}async executeMoveToBacklog(e){return this.statusExecutor.executeMoveToBacklog(e)}async executeMoveToAnalysis(e){return this.statusExecutor.executeMoveToAnalysis(e)}async executeMoveToToDo(e){return this.statusExecutor.executeMoveToToDo(e)}async executeCreateTask(e,t,r={}){return this.creationExecutor.executeCreateTask(e,t,r)}async executeCreateMeeting(e,t,r={}){return this.creationExecutor.executeCreateMeeting(e,t,r)}async executeCreateProject(e,t,r={}){return this.creationExecutor.executeCreateProject(e,t,r)}async executeCreateArea(e,t,r={}){return this.creationExecutor.executeCreateArea(e,t,r)}async executeRenameToUid(e){return this.propertyExecutor.executeRenameToUid(e)}async executeUpdateLabel(e,t){return this.propertyExecutor.executeUpdateLabel(e,t)}async executeSchedule(e,t){return this.propertyExecutor.executeSchedule(e,t)}async executeSetDeadline(e,t){return this.propertyExecutor.executeSetDeadline(e,t)}async executeRepairFolder(e){return this.folderRepairExecutor.executeRepairFolder(e)}};function Yt(n,e,t,r,i){if(n==="json"){let s={command:e,filepath:t,action:r,...i&&{changes:i}},a=ft.success(s);console.log(JSON.stringify(a,null,2))}else console.log(`\u2705 ${r}`)}o(Yt,"outputResult");function Ks(n,e,t,r){let i=new nt(`--${e} option is required for ${t} command`,r,{command:t,missingOption:e});ye.handle(i)}o(Ks,"handleMissingOption");function VE(){return new Er("command").description("Execute plugin command on single asset").argument("<command-name>","Command to execute (rename-to-uid, start, complete, schedule, set-deadline, etc.)").argument("<filepath>","Path to asset file (relative to vault root or absolute)").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--label <value>","Asset label (required for update-label and creation commands)").option("--prototype <uid>","Prototype UID for inheritance (creation commands)").option("--area <uid>","Area UID for effort linkage (creation commands)").option("--parent <uid>","Parent UID for effort linkage (creation commands)").option("--date <value>","Date in YYYY-MM-DD format (required for schedule and set-deadline commands)").option("--dry-run","Preview changes without modifying files").option("--format <type>","Output format: text|json (default: text)","text").action(async(n,e,t)=>{let r=t.format||"text";ye.setFormat(r);try{let i=(0,ME.resolve)(t.vault),s=new bf(i,t.dryRun);switch(n){case"rename-to-uid":await s.executeRenameToUid(e),Yt(r,n,e,"Renamed file to UID-based name");break;case"update-label":t.label||Ks(r,"label","update-label",'exocortex command update-label <filepath> --label "<value>"'),await s.executeUpdateLabel(e,t.label),Yt(r,n,e,`Updated label to "${t.label}"`,{label:t.label});break;case"start":await s.executeStart(e),Yt(r,n,e,"Started task");break;case"complete":await s.executeComplete(e),Yt(r,n,e,"Completed task");break;case"trash":await s.executeTrash(e),Yt(r,n,e,"Moved task to trash");break;case"archive":await s.executeArchive(e),Yt(r,n,e,"Archived task");break;case"move-to-backlog":await s.executeMoveToBacklog(e),Yt(r,n,e,"Moved task to backlog");break;case"move-to-analysis":await s.executeMoveToAnalysis(e),Yt(r,n,e,"Moved task to analysis");break;case"move-to-todo":await s.executeMoveToToDo(e),Yt(r,n,e,"Moved task to todo");break;case"create-task":t.label||Ks(r,"label","create-task",'exocortex command create-task <filepath> --label "<value>"'),await s.executeCreateTask(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Yt(r,n,e,`Created task "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"create-meeting":t.label||Ks(r,"label","create-meeting",'exocortex command create-meeting <filepath> --label "<value>"'),await s.executeCreateMeeting(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Yt(r,n,e,`Created meeting "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"create-project":t.label||Ks(r,"label","create-project",'exocortex command create-project <filepath> --label "<value>"'),await s.executeCreateProject(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Yt(r,n,e,`Created project "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"create-area":t.label||Ks(r,"label","create-area",'exocortex command create-area <filepath> --label "<value>"'),await s.executeCreateArea(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Yt(r,n,e,`Created area "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"schedule":t.date||Ks(r,"date","schedule",'exocortex command schedule <filepath> --date "YYYY-MM-DD"'),await s.executeSchedule(e,t.date),Yt(r,n,e,`Scheduled task for ${t.date}`,{date:t.date});break;case"set-deadline":t.date||Ks(r,"date","set-deadline",'exocortex command set-deadline <filepath> --date "YYYY-MM-DD"'),await s.executeSetDeadline(e,t.date),Yt(r,n,e,`Set deadline to ${t.date}`,{date:t.date});break;case"repair-folder":{let a=await s.executeRepairFolder(e);Yt(r,n,e,a.moved?`Moved to correct folder: ${a.newPath}`:"Already in correct folder",{moved:a.moved,oldPath:a.oldPath,newPath:a.newPath,expectedFolder:a.expectedFolder});break}default:await s.execute(n,e,t),Yt(r,n,e,`Executed ${n}`);break}}catch(i){ye.handle(i)}})}o(VE,"commandCommand");var UE=require("path");var Ai=Ze(require("fs")),Py=Ze(require("path")),$E=require("events");var XL={watch:Ai.default.watch.bind(Ai.default),existsSync:Ai.default.existsSync.bind(Ai.default),statSync:Ai.default.statSync.bind(Ai.default),readFileSync:Ai.default.readFileSync.bind(Ai.default)},Ef=class extends $E.EventEmitter{constructor(t,r={}){super();this.watcher=null;this.debounceTimers=new Map;this.isRunning=!1;this.vaultPath=Py.default.resolve(t),this.fsAdapter=r.fsAdapter??XL,this.options={pattern:r.pattern??"**/*.md",assetType:r.assetType??"",debounceMs:r.debounceMs??100,recursive:r.recursive??!0}}static{o(this,"FileSystemWatcher")}start(){this.isRunning||(this.watcher=this.fsAdapter.watch(this.vaultPath,{recursive:this.options.recursive},(t,r)=>{r&&this.handleFileEvent(t,r.toString())}),this.watcher.on("error",t=>{this.emit("error",t)}),this.isRunning=!0,this.emit("started"))}stop(){if(this.isRunning){for(let t of this.debounceTimers.values())clearTimeout(t);this.debounceTimers.clear(),this.watcher&&(this.watcher.close(),this.watcher=null),this.isRunning=!1,this.emit("stopped")}}isWatching(){return this.isRunning}handleFileEvent(t,r){let i=Py.default.join(this.vaultPath,r),s=r;if(!this.matchesPattern(s))return;let a=this.debounceTimers.get(i);a&&clearTimeout(a);let c=setTimeout(()=>{this.debounceTimers.delete(i),this.processFileEvent(i,s)},this.options.debounceMs);this.debounceTimers.set(i,c)}processFileEvent(t,r){let i=this.fsAdapter.existsSync(t),s;if(!i)s="delete";else{let u=this.fsAdapter.statSync(t);s=Date.now()-u.birthtimeMs<1e3?"create":"modify"}let a;if(i&&t.endsWith(".md")&&(a=this.extractAssetType(t)),this.options.assetType&&a!==this.options.assetType)return;let c={type:s,path:t,relativePath:r,timestamp:new Date().toISOString(),assetType:a};this.emit("change",c)}matchesPattern(t){return this.options.pattern?zt(t,this.options.pattern):!0}extractAssetType(t){try{let i=this.fsAdapter.readFileSync(t,"utf-8").match(/^---\n([\s\S]*?)\n---/);if(!i)return;let a=i[1].match(/exo__Instance_class:\s*(?:\[?"?\[\[([^\]]+)\]\]"?\]?|"?\[\[([^\]]+)\]\]"?)/);return a?a[1]||a[2]:void 0}catch{return}}};var Fy=Ze(require("fs"));function BE(){return new Er("watch").description("Watch vault for file changes and emit NDJSON events").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--pattern <glob>","Glob pattern to filter files (e.g., '*.md', 'tasks/**')").option("--asset-type <type>","Filter by asset type (e.g., 'ems__Task', 'ems__Project')").option("--debounce <ms>","Debounce interval in milliseconds","100").action(async n=>{ye.setFormat("json");try{let e=(0,UE.resolve)(n.vault);if(!Fy.default.existsSync(e))throw new bi(e);if(!Fy.default.statSync(e).isDirectory())throw new nt(`Vault path is not a directory: ${e}`,"Provide a path to a directory, not a file",{vaultPath:e});let t=parseInt(n.debounce?.toString()??"100",10);if(isNaN(t)||t<0)throw new nt("--debounce must be a non-negative integer","Use a positive integer value for debounce",{debounce:n.debounce});let r=new Ef(e,{pattern:n.pattern,assetType:n.assetType,debounceMs:t});r.on("change",s=>{console.log(JSON.stringify(s))}),r.on("error",s=>{let a=ft.error("INTERNAL_OPERATION_FAILED",s.message,5,{recovery:{message:"Check file permissions and vault access",suggestion:"Ensure the vault directory is accessible"}});console.log(JSON.stringify(a))});let i=o(()=>{r.stop(),process.exit(0)},"shutdown");process.on("SIGINT",i),process.on("SIGTERM",i),console.error(`Watching vault: ${e}`),n.pattern&&console.error(`  Pattern filter: ${n.pattern}`),n.assetType&&console.error(`  Asset type filter: ${n.assetType}`),console.error(`  Debounce: ${t}ms`),console.error("Press Ctrl+C to stop"),r.start()}catch(e){ye.handle(e)}})}o(BE,"watchCommand");var Ny=require("path"),Ly=Ze(ro());var Xs=Ze(require("path"));var So=Ze(Gi());var Dn=Ze(ro()),Ry=Ze(require("crypto"));var Tf=class{constructor(){this.backups=new Map;this.fileHashes=new Map}static{o(this,"TransactionManager")}async begin(e){if(!Dn.default.existsSync(e))throw new Error(`Cannot backup non-existent file: ${e}`);let t=await Dn.default.readFile(e,"utf-8"),r=Ry.default.createHash("sha256").update(t).digest("hex");this.fileHashes.set(e,r);let i=`${e}.backup.${Date.now()}`;await Dn.default.writeFile(i,t,"utf-8"),this.backups.set(e,i)}async verify(e){let t=this.fileHashes.get(e);if(!t)return!0;if(!Dn.default.existsSync(e))return!1;let r=await Dn.default.readFile(e,"utf-8");return Ry.default.createHash("sha256").update(r).digest("hex")===t}async commit(){for(let e of this.backups.values())Dn.default.existsSync(e)&&await Dn.default.remove(e);this.backups.clear(),this.fileHashes.clear()}async rollback(){for(let[e,t]of this.backups.entries())Dn.default.existsSync(t)&&(await Dn.default.copy(t,e,{overwrite:!0}),await Dn.default.remove(t));this.backups.clear(),this.fileHashes.clear()}getTrackedFiles(){return Array.from(this.backups.keys())}};var Js=class{static{o(this,"BatchExecutor")}constructor(e,t=!1){this.pathResolver=new wo(e),this.fsAdapter=new rs(e),this.frontmatterService=new So.FrontmatterService,this.transactionManager=new Tf,this.dryRun=t}async executeBatch(e,t=!1){let r=Date.now(),i=[],s=0,a=0;if(e.length===0)return{success:!0,total:0,succeeded:0,failed:0,results:[],durationMs:Date.now()-r,atomic:t};if(t&&!this.dryRun)try{await this.backupAllFiles(e)}catch(u){return{success:!1,total:e.length,succeeded:0,failed:e.length,results:e.map(l=>({success:!1,command:l.command,filepath:l.filepath,error:`Backup failed: ${u.message}`})),durationMs:Date.now()-r,atomic:t}}for(let u of e){let l=await this.executeSingleOperation(u);if(i.push(l),l.success)s++;else if(a++,t&&!this.dryRun){await this.transactionManager.rollback();let h=i.length;for(let f=h;f<e.length;f++)i.push({success:!1,command:e[f].command,filepath:e[f].filepath,error:"Not executed due to atomic rollback"}),a++;return{success:!1,total:e.length,succeeded:0,failed:e.length,results:i,durationMs:Date.now()-r,atomic:t,rolledBack:!0}}}return t&&!this.dryRun&&await this.transactionManager.commit(),{success:a===0,total:e.length,succeeded:s,failed:a,results:i,durationMs:Date.now()-r,atomic:t,...t&&{rolledBack:!1}}}static parseInput(e){try{let t=JSON.parse(e);if(!Array.isArray(t))throw new nt("Batch input must be a JSON array of operations",`exo batch --input '[{"command":"start","filepath":"task.md"}]'`);for(let r of t){if(!r.command||typeof r.command!="string")throw new nt('Each operation must have a "command" string property','{"command":"start","filepath":"task.md"}');if(!r.filepath||typeof r.filepath!="string")throw new nt('Each operation must have a "filepath" string property','{"command":"start","filepath":"task.md"}')}return t}catch(t){throw t instanceof nt?t:new nt(`Failed to parse batch input: ${t.message}`,`exo batch --input '[{"command":"start","filepath":"task.md"}]'`)}}async backupAllFiles(e){let t=new Set;for(let r of e){let i=this.pathResolver.resolve(r.filepath);t.add(i)}for(let r of t)await this.transactionManager.begin(r)}async executeSingleOperation(e){try{let t=this.pathResolver.resolve(e.filepath);this.pathResolver.validate(t);let r=t.replace(this.pathResolver.getVaultRoot()+"/","");if(await this.fsAdapter.readFile(r),this.dryRun)return{success:!0,command:e.command,filepath:e.filepath,action:`Would execute ${e.command} (dry-run)`};switch(e.command){case"start":return await this.executeStart(r,e);case"complete":return await this.executeComplete(r,e);case"trash":return await this.executeTrash(r,e);case"archive":return await this.executeArchive(r,e);case"move-to-backlog":return await this.executeStatusUpdate(r,e,"ems__EffortStatusBacklog","Moved to backlog");case"move-to-analysis":return await this.executeStatusUpdate(r,e,"ems__EffortStatusAnalysis","Moved to analysis");case"move-to-todo":return await this.executeStatusUpdate(r,e,"ems__EffortStatusToDo","Moved to todo");case"update-label":return await this.executeUpdateLabel(r,e);case"schedule":return await this.executeSchedule(r,e);case"set-deadline":return await this.executeSetDeadline(r,e);case"repair-folder":return await this.executeRepairFolder(r,e);default:return{success:!1,command:e.command,filepath:e.filepath,error:`Unknown command: ${e.command}`}}}catch(t){return{success:!1,command:e.command,filepath:e.filepath,error:t.message}}}getCurrentTimestamp(){return So.DateFormatter.toLocalTimestamp(new Date)}async executeStart(e,t){let r=await this.fsAdapter.readFile(e),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDoing]]"');return s=this.frontmatterService.updateProperty(s,"ems__Effort_startTimestamp",i),await this.fsAdapter.updateFile(e,s),{success:!0,command:t.command,filepath:t.filepath,action:"Started task",changes:{status:"Doing",startTimestamp:i}}}async executeComplete(e,t){let r=await this.fsAdapter.readFile(e),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDone]]"');return s=this.frontmatterService.updateProperty(s,"ems__Effort_endTimestamp",i),s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(e,s),{success:!0,command:t.command,filepath:t.filepath,action:"Completed task",changes:{status:"Done",endTimestamp:i,resolutionTimestamp:i}}}async executeTrash(e,t){let r=await this.fsAdapter.readFile(e),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusTrashed]]"');return s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(e,s),{success:!0,command:t.command,filepath:t.filepath,action:"Trashed task",changes:{status:"Trashed",resolutionTimestamp:i}}}async executeArchive(e,t){let r=await this.fsAdapter.readFile(e),i=this.frontmatterService.updateProperty(r,"archived","true");return i=this.frontmatterService.removeProperty(i,"aliases"),await this.fsAdapter.updateFile(e,i),{success:!0,command:t.command,filepath:t.filepath,action:"Archived task",changes:{archived:!0,aliasesRemoved:!0}}}async executeStatusUpdate(e,t,r,i){let s=await this.fsAdapter.readFile(e),a=this.frontmatterService.updateProperty(s,"ems__Effort_status",`"[[${r}]]"`);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:i,changes:{status:r.replace("ems__EffortStatus","")}}}async executeUpdateLabel(e,t){let r=t.options?.label;if(!r||r.trim()==="")return{success:!1,command:t.command,filepath:t.filepath,error:'Missing required option: "label"'};let i=r.trim(),s=await this.fsAdapter.readFile(e),a=this.frontmatterService.updateProperty(s,"exo__Asset_label",`"${i}"`);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:`Updated label to "${i}"`,changes:{label:i}}}async executeSchedule(e,t){let r=t.options?.date;if(!r)return{success:!1,command:t.command,filepath:t.filepath,error:'Missing required option: "date"'};if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return{success:!1,command:t.command,filepath:t.filepath,error:`Invalid date format: ${r}. Expected YYYY-MM-DD`};let i=await this.fsAdapter.readFile(e),s=So.DateFormatter.toTimestampAtStartOfDay(r),a=this.frontmatterService.updateProperty(i,"ems__Effort_scheduledTimestamp",s);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:`Scheduled for ${r}`,changes:{scheduledTimestamp:s}}}async executeSetDeadline(e,t){let r=t.options?.date;if(!r)return{success:!1,command:t.command,filepath:t.filepath,error:'Missing required option: "date"'};if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return{success:!1,command:t.command,filepath:t.filepath,error:`Invalid date format: ${r}. Expected YYYY-MM-DD`};let i=await this.fsAdapter.readFile(e),s=So.DateFormatter.toTimestampAtStartOfDay(r),a=this.frontmatterService.updateProperty(i,"ems__Effort_deadlineTimestamp",s);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:`Set deadline to ${r}`,changes:{deadlineTimestamp:s}}}async executeRepairFolder(e,t){let i=(await this.fsAdapter.getFileMetadata(e))?.exo__Asset_isDefinedBy;if(!i)return{success:!1,command:t.command,filepath:t.filepath,error:"Cannot determine expected folder: missing exo__Asset_isDefinedBy"};let s=this.extractReference(i);if(!s)return{success:!1,command:t.command,filepath:t.filepath,error:"Cannot determine expected folder: invalid exo__Asset_isDefinedBy format"};let a=await this.findReferencedFile(s,e);if(!a)return{success:!1,command:t.command,filepath:t.filepath,error:`Cannot determine expected folder: referenced asset not found: ${s}`};let c=Xs.default.dirname(a),u=c==="."?"":c,l=Xs.default.dirname(e),h=l==="."?"":l;if(this.normalizePath(h)===this.normalizePath(u))return{success:!0,command:t.command,filepath:t.filepath,action:"Already in correct folder",changes:{moved:!1,folder:u||"(root)"}};let f=Xs.default.basename(e),d=u?`${u}/${f}`:f;return await this.fsAdapter.fileExists(d)?{success:!1,command:t.command,filepath:t.filepath,error:`Cannot move file: ${d} already exists`}:(await this.fsAdapter.renameFile(e,d),{success:!0,command:t.command,filepath:t.filepath,action:`Moved to ${u||"(root)"}`,changes:{moved:!0,oldPath:e,newPath:d,expectedFolder:u||"(root)"}})}extractReference(e){if(typeof e!="string")return null;let t=e.trim().replace(/^["']|["']$/g,"");return t=t.replace(/^\[\[|\]\]$/g,""),t||null}async findReferencedFile(e,t){let r=e.endsWith(".md")?e:`${e}.md`;if(e.includes("/")&&await this.fsAdapter.fileExists(r))return r;let i=Xs.default.dirname(t),s=i!=="."?`${i}/${r}`:r;if(await this.fsAdapter.fileExists(s))return s;let c=await this.fsAdapter.findFileByUID(e);return c||(await this.fsAdapter.getMarkdownFiles()).find(h=>{let f=Xs.default.basename(h,".md"),d=Xs.default.basename(r,".md");return f===d})||null}normalizePath(e){return e.replace(/\\/g,"/").replace(/^\.\//,"").replace(/\/$/,"")}};function JL(n,e){if(n==="json"){let t=ft.success(e,{durationMs:e.durationMs,itemCount:e.total});console.log(JSON.stringify(t,null,2))}else{if(console.log(`
\u{1F4E6} Batch Execution ${e.success?"Complete":"Failed"}`),console.log(`   Total: ${e.total} operations`),console.log(`   \u2705 Succeeded: ${e.succeeded}`),console.log(`   \u274C Failed: ${e.failed}`),console.log(`   \u23F1\uFE0F  Duration: ${e.durationMs}ms`),e.atomic&&console.log(`   \u{1F512} Atomic mode: ${e.rolledBack?"Rolled back":"Committed"}`),e.failed>0){console.log(`
\u{1F4CB} Failed Operations:`);for(let t of e.results.filter(r=>!r.success))console.log(`   \u274C ${t.command} ${t.filepath}: ${t.error}`)}if(e.succeeded>0&&n==="text"){console.log(`
\u{1F4CB} Successful Operations:`);for(let t of e.results.filter(r=>r.success))console.log(`   \u2705 ${t.command} ${t.filepath}: ${t.action}`)}}}o(JL,"outputResult");function qE(){return new Er("batch").description("Execute multiple operations in a single CLI invocation").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--input <json>","JSON array of operations to execute").option("--file <path>","Path to JSON file containing operations").option("--atomic","All-or-nothing execution (rollback on any failure)").option("--dry-run","Preview changes without modifying files").option("--format <type>","Output format: text|json (default: text)","text").action(async n=>{let e=n.format||"text";ye.setFormat(e);try{let t=(0,Ny.resolve)(n.vault),r;if(n.input)r=n.input;else if(n.file){let c=(0,Ny.resolve)(n.file);if(!Ly.default.existsSync(c))throw new nt(`Batch file not found: ${c}`,"exocortex batch --file operations.json");r=await Ly.default.readFile(c,"utf-8")}else throw new nt("Either --input or --file option is required",`exocortex batch --input '[{"command":"start","filepath":"task.md"}]' or exocortex batch --file operations.json`);let i=Js.parseInput(r);if(i.length===0)throw new nt("Batch input contains no operations",`exocortex batch --input '[{"command":"start","filepath":"task.md"}]'`);let a=await new Js(t,n.dryRun).executeBatch(i,n.atomic);JL(e,a),process.exit(a.success?0:5)}catch(t){ye.handle(t)}})}o(qE,"batchCommand");var GE=require("path");function ZL(n,e){if(n==="json"){let t=ft.success(e,{durationMs:e.durationMs,itemCount:e.total});console.log(JSON.stringify(t,null,2))}else{if(console.log(`
\u{1F4E6} Batch Repair ${e.success?"Complete":"Completed with Errors"}`),console.log(`   Total files: ${e.total}`),console.log(`   \u{1F4C1} Moved: ${e.movedCount}`),console.log(`   \u2705 Already correct: ${e.alreadyCorrectCount}`),console.log(`   \u274C Errors: ${e.errorCount}`),console.log(`   \u23F1\uFE0F  Duration: ${e.durationMs}ms`),e.errorCount>0){console.log(`
\u{1F4CB} Failed Files:`);for(let t of e.results.filter(r=>!r.success))console.log(`   \u274C ${t.filepath}: ${t.error}`)}if(e.movedCount>0&&n==="text"){console.log(`
\u{1F4CB} Moved Files:`);for(let t of e.results.filter(r=>r.success&&r.changes?.moved))console.log(`   \u{1F4C1} ${t.filepath} \u2192 ${t.changes?.newPath}`)}}}o(ZL,"outputResult");function WE(){return new Er("batch-repair").description("Batch repair folder locations for all markdown files in a directory").argument("<directory>","Directory to process (relative to vault root)").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--dry-run","Preview changes without modifying files").option("--format <type>","Output format: text|json (default: text)","text").option("--progress","Show progress during processing (default: true)",!0).option("--no-progress","Disable progress output").action(async(n,e)=>{let t=e.format||"text";ye.setFormat(t);try{let r=(0,GE.resolve)(e.vault),i=new rs(r),s=n;if(!await i.directoryExists(s))throw new nt(`Directory not found: ${s}`,"exocortex batch-repair <existing-directory>");let c=await i.getMarkdownFiles(s);if(c.length===0){if(t==="json"){let I=ft.success({success:!0,total:0,movedCount:0,alreadyCorrectCount:0,errorCount:0,results:[],durationMs:0,atomic:!1});console.log(JSON.stringify(I,null,2))}else console.log(`
\u{1F4C2} No markdown files found in ${s}`);process.exit(0)}let u=c.map(I=>({command:"repair-folder",filepath:I})),l=e.progress!==!1&&t==="text",h=0;l&&console.log(`
\u{1F50D} Processing ${c.length} files in ${s}...`);let d=await new Js(r,e.dryRun).executeBatch(u,!1),m=0,_=0,S=0;for(let I of d.results)if(I.success?I.changes?.moved?m++:_++:S++,l&&!e.dryRun){h++;let D=Math.round(h/c.length*100);process.stdout.write(`\r   Processing ${h}/${c.length} (${D}%)...`)}l&&process.stdout.write("\r"+" ".repeat(60)+"\r");let A={...d,movedCount:m,alreadyCorrectCount:_,errorCount:S};ZL(t,A),process.exit(A.success?0:5)}catch(r){ye.handle(r)}})}o(WE,"batchRepairCommand");var Af=require("fs"),Pn=require("path");function zE(){return new Er("resolve").description("Resolve UUID to file path").argument("<uuid>","Full or partial UUID to resolve").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--format <type>","Output format: uri|path|json (default: uri)","uri").option("--output <type>","Response format: text|json (for MCP tools)","text").option("--partial","Match partial UUIDs (returns all matches)").action(async(n,e)=>{let t=e.output||"text";ye.setFormat(t);try{let r=Date.now();if(!e8(n))throw new nt(`Invalid UUID format: ${n}`,"exocortex resolve <uuid> [--format uri|path|json] [--partial]",{uuid:n});let i=(0,Pn.resolve)(e.vault);if(!(0,Af.existsSync)(i))throw new bi(i);let s=t8(i,n,e.partial??!1),a=Date.now()-r;if(s.length===0){if(t==="json"){let c=ft.error("VALIDATION_FILE_NOT_FOUND",`UUID not found: ${n}`,3,{context:{uuid:n}});console.log(JSON.stringify(c,null,2))}else console.error(`UUID not found: ${n}`);process.exit(1)}e.partial||s.length>1?n8(s,i,e.format,t,n,a):r8(s[0],i,e.format,t,n,a)}catch(r){ye.handle(r)}})}o(zE,"resolveCommand");function e8(n){if(n.length<4)return!1;let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,t=/^[0-9a-f-]+$/i;return e.test(n)||t.test(n)}o(e8,"isValidUuidFormat");function t8(n,e,t){let r=[],i=e.toLowerCase();function s(a){let c=(0,Af.readdirSync)(a,{withFileTypes:!0});for(let u of c){let l=(0,Pn.join)(a,u.name);if(u.isDirectory())!u.name.startsWith(".")&&u.name!=="node_modules"&&s(l);else if(u.isFile()&&u.name.endsWith(".md")){let h=u.name.toLowerCase();t?h.includes(i)&&r.push(l):(h.startsWith(i+".md")||h.startsWith(i+" ")||h.startsWith(i+"-"))&&r.push(l)}}}return o(s,"walk"),s(n),r}o(t8,"findFilesWithUuid");function HE(n){return`obsidian://vault/${encodeURI(n)}`}o(HE,"pathToObsidianUri");function YE(n){let e=n.match(/^([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/i);return e?e[1]:(0,Pn.basename)(n,".md")}o(YE,"extractUuidFromFilename");function r8(n,e,t,r,i,s){let a=(0,Pn.relative)(e,n),c=HE(a),u=YE((0,Pn.basename)(n));if(r==="json"){let l={uuid:u,path:a,absolutePath:n,uri:c},h=ft.success(l,{durationMs:s,searchUuid:i});console.log(JSON.stringify(h,null,2))}else switch(t){case"path":console.log(n);break;case"json":console.log(JSON.stringify({uuid:u,path:a,absolutePath:n,uri:c},null,2));break;case"uri":default:console.log(c);break}}o(r8,"outputSingleResult");function n8(n,e,t,r,i,s){let a=n.map(c=>{let u=(0,Pn.relative)(e,c),l=HE(u);return{uuid:YE((0,Pn.basename)(c)),path:u,absolutePath:c,uri:l}});if(r==="json"){let c=ft.success({matches:a,count:a.length},{durationMs:s,searchUuid:i,itemCount:a.length});console.log(JSON.stringify(c,null,2))}else switch(t){case"path":for(let c of a)console.log(c.absolutePath);break;case"json":console.log(JSON.stringify(a,null,2));break;case"uri":default:for(let c of a)console.log(c.uri);break}}o(n8,"outputMultipleResults");var is=new Er;is.name("exocortex").description("CLI tool for Exocortex knowledge management system").version("0.1.0");is.command("sparql").description("SPARQL query execution").addCommand(Fb());is.addCommand(VE());is.addCommand(BE());is.addCommand(qE());is.addCommand(WE());is.addCommand(zE());is.parse();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
