#!/usr/bin/env node
// @kitelev/exocortex-cli v0.1.0
// CLI tool for Exocortex knowledge management system - SPARQL queries, task management, and more
// License: MIT

"use strict";var QS=Object.create;var mo=Object.defineProperty;var YS=Object.getOwnPropertyDescriptor;var XS=Object.getOwnPropertyNames;var JS=Object.getPrototypeOf,ZS=Object.prototype.hasOwnProperty;var o=(n,e)=>mo(n,"name",{value:e,configurable:!0});var eE=(n,e)=>()=>(n&&(e=n(n=0)),e);var v=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),tE=(n,e)=>{for(var t in e)mo(n,t,{get:e[t],enumerable:!0})},x1=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of XS(e))!ZS.call(n,i)&&i!==t&&mo(n,i,{get:()=>e[i],enumerable:!(r=YS(e,i))||r.enumerable});return n};var Ye=(n,e,t)=>(t=n!=null?QS(JS(n)):{},x1(e||!n||!n.__esModule?mo(t,"default",{value:n,enumerable:!0}):t,n)),dh=n=>x1(mo({},"__esModule",{value:!0}),n);var ph=v(()=>{var C1;(function(n){(function(e){var t=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:c(),r=i(n);typeof t.Reflect<"u"&&(r=i(t.Reflect,r)),e(r,t),typeof t.Reflect>"u"&&(t.Reflect=n);function i(u,l){return function(f,h){Object.defineProperty(u,f,{configurable:!0,writable:!0,value:h}),l&&l(f,h)}}o(i,"makeExporter");function s(){try{return Function("return this;")()}catch{}}o(s,"functionThis");function a(){try{return(0,eval)("(function() { return this; })()")}catch{}}o(a,"indirectEvalThis");function c(){return s()||a()}o(c,"sloppyModeThis")})(function(e,t){var r=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",s=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",u={__proto__:[]}instanceof Array,l=!c&&!u,f={create:c?function(){return we(Object.create(null))}:u?function(){return we({__proto__:null})}:function(){return we({})},has:l?function(w,E){return r.call(w,E)}:function(w,E){return E in w},get:l?function(w,E){return r.call(w,E)?w[E]:void 0}:function(w,E){return w[E]}},h=Object.getPrototypeOf(Function),d=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ce(),m=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ne(),_=typeof WeakMap=="function"?WeakMap:Pe(),b=i?Symbol.for("@reflect-metadata:registry"):void 0,C=se(),O=ae(C);function I(w,E,y,x){if(V(y)){if(!Ee(w))throw new TypeError;if(!Te(E))throw new TypeError;return He(w,E)}else{if(!Ee(w))throw new TypeError;if(!z(E))throw new TypeError;if(!z(x)&&!V(x)&&!de(x))throw new TypeError;return de(x)&&(x=void 0),y=le(y),qe(w,E,y,x)}}o(I,"decorate"),e("decorate",I);function L(w,E){function y(x,U){if(!z(x))throw new TypeError;if(!V(U)&&!Ie(U))throw new TypeError;H(w,E,x,U)}return o(y,"decorator"),y}o(L,"metadata"),e("metadata",L);function G(w,E,y,x){if(!z(y))throw new TypeError;return V(x)||(x=le(x)),H(w,E,y,x)}o(G,"defineMetadata"),e("defineMetadata",G);function W(w,E,y){if(!z(E))throw new TypeError;return V(y)||(y=le(y)),et(w,E,y)}o(W,"hasMetadata"),e("hasMetadata",W);function Fe(w,E,y){if(!z(E))throw new TypeError;return V(y)||(y=le(y)),Le(w,E,y)}o(Fe,"hasOwnMetadata"),e("hasOwnMetadata",Fe);function Ze(w,E,y){if(!z(E))throw new TypeError;return V(y)||(y=le(y)),je(w,E,y)}o(Ze,"getMetadata"),e("getMetadata",Ze);function ot(w,E,y){if(!z(E))throw new TypeError;return V(y)||(y=le(y)),Re(w,E,y)}o(ot,"getOwnMetadata"),e("getOwnMetadata",ot);function B(w,E){if(!z(w))throw new TypeError;return V(E)||(E=le(E)),k(w,E)}o(B,"getMetadataKeys"),e("getMetadataKeys",B);function ue(w,E){if(!z(w))throw new TypeError;return V(E)||(E=le(E)),Me(w,E)}o(ue,"getOwnMetadataKeys"),e("getOwnMetadataKeys",ue);function be(w,E,y){if(!z(E))throw new TypeError;if(V(y)||(y=le(y)),!z(E))throw new TypeError;V(y)||(y=le(y));var x=Q(E,y,!1);return V(x)?!1:x.OrdinaryDeleteMetadata(w,E,y)}o(be,"deleteMetadata"),e("deleteMetadata",be);function He(w,E){for(var y=w.length-1;y>=0;--y){var x=w[y],U=x(E);if(!V(U)&&!de(U)){if(!Te(U))throw new TypeError;E=U}}return E}o(He,"DecorateConstructor");function qe(w,E,y,x){for(var U=w.length-1;U>=0;--U){var Ke=w[U],nt=Ke(E,y,x);if(!V(nt)&&!de(nt)){if(!z(nt))throw new TypeError;x=nt}}return x}o(qe,"DecorateProperty");function et(w,E,y){var x=Le(w,E,y);if(x)return!0;var U=te(E);return de(U)?!1:et(w,U,y)}o(et,"OrdinaryHasMetadata");function Le(w,E,y){var x=Q(E,y,!1);return V(x)?!1:Se(x.OrdinaryHasOwnMetadata(w,E,y))}o(Le,"OrdinaryHasOwnMetadata");function je(w,E,y){var x=Le(w,E,y);if(x)return Re(w,E,y);var U=te(E);if(!de(U))return je(w,U,y)}o(je,"OrdinaryGetMetadata");function Re(w,E,y){var x=Q(E,y,!1);if(!V(x))return x.OrdinaryGetOwnMetadata(w,E,y)}o(Re,"OrdinaryGetOwnMetadata");function H(w,E,y,x){var U=Q(y,x,!0);U.OrdinaryDefineOwnMetadata(w,E,y,x)}o(H,"OrdinaryDefineOwnMetadata");function k(w,E){var y=Me(w,E),x=te(w);if(x===null)return y;var U=k(x,E);if(U.length<=0)return y;if(y.length<=0)return U;for(var Ke=new m,nt=[],_e=0,j=y;_e<j.length;_e++){var M=j[_e],$=Ke.has(M);$||(Ke.add(M),nt.push(M))}for(var q=0,ge=U;q<ge.length;q++){var M=ge[q],$=Ke.has(M);$||(Ke.add(M),nt.push(M))}return nt}o(k,"OrdinaryMetadataKeys");function Me(w,E){var y=Q(w,E,!1);return y?y.OrdinaryOwnMetadataKeys(w,E):[]}o(Me,"OrdinaryOwnMetadataKeys");function Ge(w){if(w===null)return 1;switch(typeof w){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return w===null?1:6;default:return 6}}o(Ge,"Type");function V(w){return w===void 0}o(V,"IsUndefined");function de(w){return w===null}o(de,"IsNull");function xe(w){return typeof w=="symbol"}o(xe,"IsSymbol");function z(w){return typeof w=="object"?w!==null:typeof w=="function"}o(z,"IsObject");function Ce(w,E){switch(Ge(w)){case 0:return w;case 1:return w;case 2:return w;case 3:return w;case 4:return w;case 5:return w}var y=E===3?"string":E===5?"number":"default",x=re(w,s);if(x!==void 0){var U=x.call(w,y);if(z(U))throw new TypeError;return U}return Oe(w,y==="default"?"number":y)}o(Ce,"ToPrimitive");function Oe(w,E){if(E==="string"){var y=w.toString;if(pe(y)){var x=y.call(w);if(!z(x))return x}var U=w.valueOf;if(pe(U)){var x=U.call(w);if(!z(x))return x}}else{var U=w.valueOf;if(pe(U)){var x=U.call(w);if(!z(x))return x}var Ke=w.toString;if(pe(Ke)){var x=Ke.call(w);if(!z(x))return x}}throw new TypeError}o(Oe,"OrdinaryToPrimitive");function Se(w){return!!w}o(Se,"ToBoolean");function De(w){return""+w}o(De,"ToString");function le(w){var E=Ce(w,3);return xe(E)?E:De(E)}o(le,"ToPropertyKey");function Ee(w){return Array.isArray?Array.isArray(w):w instanceof Object?w instanceof Array:Object.prototype.toString.call(w)==="[object Array]"}o(Ee,"IsArray");function pe(w){return typeof w=="function"}o(pe,"IsCallable");function Te(w){return typeof w=="function"}o(Te,"IsConstructor");function Ie(w){switch(Ge(w)){case 3:return!0;case 4:return!0;default:return!1}}o(Ie,"IsPropertyKey");function X(w,E){return w===E||w!==w&&E!==E}o(X,"SameValueZero");function re(w,E){var y=w[E];if(y!=null){if(!pe(y))throw new TypeError;return y}}o(re,"GetMethod");function ne(w){var E=re(w,a);if(!pe(E))throw new TypeError;var y=E.call(w);if(!z(y))throw new TypeError;return y}o(ne,"GetIterator");function J(w){return w.value}o(J,"IteratorValue");function Z(w){var E=w.next();return E.done?!1:E}o(Z,"IteratorStep");function ee(w){var E=w.return;E&&E.call(w)}o(ee,"IteratorClose");function te(w){var E=Object.getPrototypeOf(w);if(typeof w!="function"||w===h||E!==h)return E;var y=w.prototype,x=y&&Object.getPrototypeOf(y);if(x==null||x===Object.prototype)return E;var U=x.constructor;return typeof U!="function"||U===w?E:U}o(te,"OrdinaryGetPrototypeOf");function ie(){var w;!V(b)&&typeof t.Reflect<"u"&&!(b in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(w=oe(t.Reflect));var E,y,x,U=new _,Ke={registerProvider:nt,getProvider:j,setProvider:$};return Ke;function nt(q){if(!Object.isExtensible(Ke))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case w===q:break;case V(E):E=q;break;case E===q:break;case V(y):y=q;break;case y===q:break;default:x===void 0&&(x=new m),x.add(q);break}}function _e(q,ge){if(!V(E)){if(E.isProviderFor(q,ge))return E;if(!V(y)){if(y.isProviderFor(q,ge))return E;if(!V(x))for(var Ve=ne(x);;){var $e=Z(Ve);if(!$e)return;var Ft=J($e);if(Ft.isProviderFor(q,ge))return ee(Ve),Ft}}}if(!V(w)&&w.isProviderFor(q,ge))return w}function j(q,ge){var Ve=U.get(q),$e;return V(Ve)||($e=Ve.get(ge)),V($e)&&($e=_e(q,ge),V($e)||(V(Ve)&&(Ve=new d,U.set(q,Ve)),Ve.set(ge,$e))),$e}function M(q){if(V(q))throw new TypeError;return E===q||y===q||!V(x)&&x.has(q)}function $(q,ge,Ve){if(!M(Ve))throw new Error("Metadata provider not registered.");var $e=j(q,ge);if($e!==Ve){if(!V($e))return!1;var Ft=U.get(q);V(Ft)&&(Ft=new d,U.set(q,Ft)),Ft.set(ge,Ve)}return!0}}o(ie,"CreateMetadataRegistry");function se(){var w;return!V(b)&&z(t.Reflect)&&Object.isExtensible(t.Reflect)&&(w=t.Reflect[b]),V(w)&&(w=ie()),!V(b)&&z(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,b,{enumerable:!1,configurable:!1,writable:!1,value:w}),w}o(se,"GetOrCreateMetadataRegistry");function ae(w){var E=new _,y={isProviderFor:o(function(M,$){var q=E.get(M);return V(q)?!1:q.has($)},"isProviderFor"),OrdinaryDefineOwnMetadata:nt,OrdinaryHasOwnMetadata:U,OrdinaryGetOwnMetadata:Ke,OrdinaryOwnMetadataKeys:_e,OrdinaryDeleteMetadata:j};return C.registerProvider(y),y;function x(M,$,q){var ge=E.get(M),Ve=!1;if(V(ge)){if(!q)return;ge=new d,E.set(M,ge),Ve=!0}var $e=ge.get($);if(V($e)){if(!q)return;if($e=new d,ge.set($,$e),!w.setProvider(M,$,y))throw ge.delete($),Ve&&E.delete(M),new Error("Wrong provider for target.")}return $e}o(x,"GetOrCreateMetadataMap");function U(M,$,q){var ge=x($,q,!1);return V(ge)?!1:Se(ge.has(M))}o(U,"OrdinaryHasOwnMetadata");function Ke(M,$,q){var ge=x($,q,!1);if(!V(ge))return ge.get(M)}o(Ke,"OrdinaryGetOwnMetadata");function nt(M,$,q,ge){var Ve=x(q,ge,!0);Ve.set(M,$)}o(nt,"OrdinaryDefineOwnMetadata");function _e(M,$){var q=[],ge=x(M,$,!1);if(V(ge))return q;for(var Ve=ge.keys(),$e=ne(Ve),Ft=0;;){var vr=Z($e);if(!vr)return q.length=Ft,q;var xr=J(vr);try{q[Ft]=xr}catch(rr){try{ee($e)}finally{throw rr}}Ft++}}o(_e,"OrdinaryOwnMetadataKeys");function j(M,$,q){var ge=x($,q,!1);if(V(ge)||!ge.delete(M))return!1;if(ge.size===0){var Ve=E.get($);V(Ve)||(Ve.delete(q),Ve.size===0&&E.delete(Ve))}return!0}o(j,"OrdinaryDeleteMetadata")}o(ae,"CreateMetadataProvider");function oe(w){var E=w.defineMetadata,y=w.hasOwnMetadata,x=w.getOwnMetadata,U=w.getOwnMetadataKeys,Ke=w.deleteMetadata,nt=new _,_e={isProviderFor:o(function(j,M){var $=nt.get(j);return!V($)&&$.has(M)?!0:U(j,M).length?(V($)&&($=new m,nt.set(j,$)),$.add(M),!0):!1},"isProviderFor"),OrdinaryDefineOwnMetadata:E,OrdinaryHasOwnMetadata:y,OrdinaryGetOwnMetadata:x,OrdinaryOwnMetadataKeys:U,OrdinaryDeleteMetadata:Ke};return _e}o(oe,"CreateFallbackProvider");function Q(w,E,y){var x=C.getProvider(w,E);if(!V(x))return x;if(y){if(C.setProvider(w,E,O))return O;throw new Error("Illegal state.")}}o(Q,"GetMetadataProvider");function ce(){var w={},E=[],y=(function(){function _e(j,M,$){this._index=0,this._keys=j,this._values=M,this._selector=$}return o(_e,"MapIterator"),_e.prototype["@@iterator"]=function(){return this},_e.prototype[a]=function(){return this},_e.prototype.next=function(){var j=this._index;if(j>=0&&j<this._keys.length){var M=this._selector(this._keys[j],this._values[j]);return j+1>=this._keys.length?(this._index=-1,this._keys=E,this._values=E):this._index++,{value:M,done:!1}}return{value:void 0,done:!0}},_e.prototype.throw=function(j){throw this._index>=0&&(this._index=-1,this._keys=E,this._values=E),j},_e.prototype.return=function(j){return this._index>=0&&(this._index=-1,this._keys=E,this._values=E),{value:j,done:!0}},_e})(),x=(function(){function _e(){this._keys=[],this._values=[],this._cacheKey=w,this._cacheIndex=-2}return o(_e,"Map"),Object.defineProperty(_e.prototype,"size",{get:o(function(){return this._keys.length},"get"),enumerable:!0,configurable:!0}),_e.prototype.has=function(j){return this._find(j,!1)>=0},_e.prototype.get=function(j){var M=this._find(j,!1);return M>=0?this._values[M]:void 0},_e.prototype.set=function(j,M){var $=this._find(j,!0);return this._values[$]=M,this},_e.prototype.delete=function(j){var M=this._find(j,!1);if(M>=0){for(var $=this._keys.length,q=M+1;q<$;q++)this._keys[q-1]=this._keys[q],this._values[q-1]=this._values[q];return this._keys.length--,this._values.length--,X(j,this._cacheKey)&&(this._cacheKey=w,this._cacheIndex=-2),!0}return!1},_e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=w,this._cacheIndex=-2},_e.prototype.keys=function(){return new y(this._keys,this._values,U)},_e.prototype.values=function(){return new y(this._keys,this._values,Ke)},_e.prototype.entries=function(){return new y(this._keys,this._values,nt)},_e.prototype["@@iterator"]=function(){return this.entries()},_e.prototype[a]=function(){return this.entries()},_e.prototype._find=function(j,M){if(!X(this._cacheKey,j)){this._cacheIndex=-1;for(var $=0;$<this._keys.length;$++)if(X(this._keys[$],j)){this._cacheIndex=$;break}}return this._cacheIndex<0&&M&&(this._cacheIndex=this._keys.length,this._keys.push(j),this._values.push(void 0)),this._cacheIndex},_e})();return x;function U(_e,j){return _e}function Ke(_e,j){return j}function nt(_e,j){return[_e,j]}}o(ce,"CreateMapPolyfill");function Ne(){var w=(function(){function E(){this._map=new d}return o(E,"Set"),Object.defineProperty(E.prototype,"size",{get:o(function(){return this._map.size},"get"),enumerable:!0,configurable:!0}),E.prototype.has=function(y){return this._map.has(y)},E.prototype.add=function(y){return this._map.set(y,y),this},E.prototype.delete=function(y){return this._map.delete(y)},E.prototype.clear=function(){this._map.clear()},E.prototype.keys=function(){return this._map.keys()},E.prototype.values=function(){return this._map.keys()},E.prototype.entries=function(){return this._map.entries()},E.prototype["@@iterator"]=function(){return this.keys()},E.prototype[a]=function(){return this.keys()},E})();return w}o(Ne,"CreateSetPolyfill");function Pe(){var w=16,E=f.create(),y=x();return(function(){function j(){this._key=x()}return o(j,"WeakMap"),j.prototype.has=function(M){var $=U(M,!1);return $!==void 0?f.has($,this._key):!1},j.prototype.get=function(M){var $=U(M,!1);return $!==void 0?f.get($,this._key):void 0},j.prototype.set=function(M,$){var q=U(M,!0);return q[this._key]=$,this},j.prototype.delete=function(M){var $=U(M,!1);return $!==void 0?delete $[this._key]:!1},j.prototype.clear=function(){this._key=x()},j})();function x(){var j;do j="@@WeakMap@@"+_e();while(f.has(E,j));return E[j]=!0,j}function U(j,M){if(!r.call(j,y)){if(!M)return;Object.defineProperty(j,y,{value:f.create()})}return j[y]}function Ke(j,M){for(var $=0;$<M;++$)j[$]=Math.random()*255|0;return j}function nt(j){if(typeof Uint8Array=="function"){var M=new Uint8Array(j);return typeof crypto<"u"?crypto.getRandomValues(M):typeof msCrypto<"u"?msCrypto.getRandomValues(M):Ke(M,j),M}return Ke(new Array(j),j)}function _e(){var j=nt(w);j[6]=j[6]&79|64,j[8]=j[8]&191|128;for(var M="",$=0;$<w;++$){var q=j[$];($===4||$===6||$===8)&&(M+="-"),q<16&&(M+="0"),M+=q.toString(16).toLowerCase()}return M}}o(Pe,"CreateWeakMapPolyfill");function we(w){return w.__=void 0,delete w.__,w}o(we,"MakeDictionary")})})(C1||(C1={}))});var go=v(gh=>{var Qc=class extends Error{static{o(this,"CommanderError")}constructor(e,t,r){super(r),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name,this.code=t,this.exitCode=e,this.nestedError=void 0}},mh=class extends Qc{static{o(this,"InvalidArgumentError")}constructor(e){super(1,"commander.invalidArgument",e),Error.captureStackTrace(this,this.constructor),this.name=this.constructor.name}};gh.CommanderError=Qc;gh.InvalidArgumentError=mh});var Yc=v(vh=>{var{InvalidArgumentError:rE}=go(),yh=class{static{o(this,"Argument")}constructor(e,t){switch(this.description=t||"",this.variadic=!1,this.parseArg=void 0,this.defaultValue=void 0,this.defaultValueDescription=void 0,this.argChoices=void 0,e[0]){case"<":this.required=!0,this._name=e.slice(1,-1);break;case"[":this.required=!1,this._name=e.slice(1,-1);break;default:this.required=!0,this._name=e;break}this._name.endsWith("...")&&(this.variadic=!0,this._name=this._name.slice(0,-3))}name(){return this._name}_collectValue(e,t){return t===this.defaultValue||!Array.isArray(t)?[e]:(t.push(e),t)}default(e,t){return this.defaultValue=e,this.defaultValueDescription=t,this}argParser(e){return this.parseArg=e,this}choices(e){return this.argChoices=e.slice(),this.parseArg=(t,r)=>{if(!this.argChoices.includes(t))throw new rE(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._collectValue(t,r):t},this}argRequired(){return this.required=!0,this}argOptional(){return this.required=!1,this}};function nE(n){let e=n.name()+(n.variadic===!0?"...":"");return n.required?"<"+e+">":"["+e+"]"}o(nE,"humanReadableArgName");vh.Argument=yh;vh.humanReadableArgName=nE});var bh=v(_h=>{var{humanReadableArgName:iE}=Yc(),wh=class{static{o(this,"Help")}constructor(){this.helpWidth=void 0,this.minWidthToWrap=40,this.sortSubcommands=!1,this.sortOptions=!1,this.showGlobalOptions=!1}prepareContext(e){this.helpWidth=this.helpWidth??e.helpWidth??80}visibleCommands(e){let t=e.commands.filter(i=>!i._hidden),r=e._getHelpCommand();return r&&!r._hidden&&t.push(r),this.sortSubcommands&&t.sort((i,s)=>i.name().localeCompare(s.name())),t}compareOptions(e,t){let r=o(i=>i.short?i.short.replace(/^-/,""):i.long.replace(/^--/,""),"getSortKey");return r(e).localeCompare(r(t))}visibleOptions(e){let t=e.options.filter(i=>!i.hidden),r=e._getHelpOption();if(r&&!r.hidden){let i=r.short&&e._findOption(r.short),s=r.long&&e._findOption(r.long);!i&&!s?t.push(r):r.long&&!s?t.push(e.createOption(r.long,r.description)):r.short&&!i&&t.push(e.createOption(r.short,r.description))}return this.sortOptions&&t.sort(this.compareOptions),t}visibleGlobalOptions(e){if(!this.showGlobalOptions)return[];let t=[];for(let r=e.parent;r;r=r.parent){let i=r.options.filter(s=>!s.hidden);t.push(...i)}return this.sortOptions&&t.sort(this.compareOptions),t}visibleArguments(e){return e._argsDescription&&e.registeredArguments.forEach(t=>{t.description=t.description||e._argsDescription[t.name()]||""}),e.registeredArguments.find(t=>t.description)?e.registeredArguments:[]}subcommandTerm(e){let t=e.registeredArguments.map(r=>iE(r)).join(" ");return e._name+(e._aliases[0]?"|"+e._aliases[0]:"")+(e.options.length?" [options]":"")+(t?" "+t:"")}optionTerm(e){return e.flags}argumentTerm(e){return e.name()}longestSubcommandTermLength(e,t){return t.visibleCommands(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleSubcommandTerm(t.subcommandTerm(i)))),0)}longestOptionTermLength(e,t){return t.visibleOptions(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleOptionTerm(t.optionTerm(i)))),0)}longestGlobalOptionTermLength(e,t){return t.visibleGlobalOptions(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleOptionTerm(t.optionTerm(i)))),0)}longestArgumentTermLength(e,t){return t.visibleArguments(e).reduce((r,i)=>Math.max(r,this.displayWidth(t.styleArgumentTerm(t.argumentTerm(i)))),0)}commandUsage(e){let t=e._name;e._aliases[0]&&(t=t+"|"+e._aliases[0]);let r="";for(let i=e.parent;i;i=i.parent)r=i.name()+" "+r;return r+t+" "+e.usage()}commandDescription(e){return e.description()}subcommandDescription(e){return e.summary()||e.description()}optionDescription(e){let t=[];if(e.argChoices&&t.push(`choices: ${e.argChoices.map(r=>JSON.stringify(r)).join(", ")}`),e.defaultValue!==void 0&&(e.required||e.optional||e.isBoolean()&&typeof e.defaultValue=="boolean")&&t.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`),e.presetArg!==void 0&&e.optional&&t.push(`preset: ${JSON.stringify(e.presetArg)}`),e.envVar!==void 0&&t.push(`env: ${e.envVar}`),t.length>0){let r=`(${t.join(", ")})`;return e.description?`${e.description} ${r}`:r}return e.description}argumentDescription(e){let t=[];if(e.argChoices&&t.push(`choices: ${e.argChoices.map(r=>JSON.stringify(r)).join(", ")}`),e.defaultValue!==void 0&&t.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`),t.length>0){let r=`(${t.join(", ")})`;return e.description?`${e.description} ${r}`:r}return e.description}formatItemList(e,t,r){return t.length===0?[]:[r.styleTitle(e),...t,""]}groupItems(e,t,r){let i=new Map;return e.forEach(s=>{let a=r(s);i.has(a)||i.set(a,[])}),t.forEach(s=>{let a=r(s);i.has(a)||i.set(a,[]),i.get(a).push(s)}),i}formatHelp(e,t){let r=t.padWidth(e,t),i=t.helpWidth??80;function s(h,d){return t.formatItem(h,r,d,t)}o(s,"callFormatItem");let a=[`${t.styleTitle("Usage:")} ${t.styleUsage(t.commandUsage(e))}`,""],c=t.commandDescription(e);c.length>0&&(a=a.concat([t.boxWrap(t.styleCommandDescription(c),i),""]));let u=t.visibleArguments(e).map(h=>s(t.styleArgumentTerm(t.argumentTerm(h)),t.styleArgumentDescription(t.argumentDescription(h))));if(a=a.concat(this.formatItemList("Arguments:",u,t)),this.groupItems(e.options,t.visibleOptions(e),h=>h.helpGroupHeading??"Options:").forEach((h,d)=>{let m=h.map(_=>s(t.styleOptionTerm(t.optionTerm(_)),t.styleOptionDescription(t.optionDescription(_))));a=a.concat(this.formatItemList(d,m,t))}),t.showGlobalOptions){let h=t.visibleGlobalOptions(e).map(d=>s(t.styleOptionTerm(t.optionTerm(d)),t.styleOptionDescription(t.optionDescription(d))));a=a.concat(this.formatItemList("Global Options:",h,t))}return this.groupItems(e.commands,t.visibleCommands(e),h=>h.helpGroup()||"Commands:").forEach((h,d)=>{let m=h.map(_=>s(t.styleSubcommandTerm(t.subcommandTerm(_)),t.styleSubcommandDescription(t.subcommandDescription(_))));a=a.concat(this.formatItemList(d,m,t))}),a.join(`
`)}displayWidth(e){return O1(e).length}styleTitle(e){return e}styleUsage(e){return e.split(" ").map(t=>t==="[options]"?this.styleOptionText(t):t==="[command]"?this.styleSubcommandText(t):t[0]==="["||t[0]==="<"?this.styleArgumentText(t):this.styleCommandText(t)).join(" ")}styleCommandDescription(e){return this.styleDescriptionText(e)}styleOptionDescription(e){return this.styleDescriptionText(e)}styleSubcommandDescription(e){return this.styleDescriptionText(e)}styleArgumentDescription(e){return this.styleDescriptionText(e)}styleDescriptionText(e){return e}styleOptionTerm(e){return this.styleOptionText(e)}styleSubcommandTerm(e){return e.split(" ").map(t=>t==="[options]"?this.styleOptionText(t):t[0]==="["||t[0]==="<"?this.styleArgumentText(t):this.styleSubcommandText(t)).join(" ")}styleArgumentTerm(e){return this.styleArgumentText(e)}styleOptionText(e){return e}styleArgumentText(e){return e}styleSubcommandText(e){return e}styleCommandText(e){return e}padWidth(e,t){return Math.max(t.longestOptionTermLength(e,t),t.longestGlobalOptionTermLength(e,t),t.longestSubcommandTermLength(e,t),t.longestArgumentTermLength(e,t))}preformatted(e){return/\n[^\S\r\n]/.test(e)}formatItem(e,t,r,i){let a=" ".repeat(2);if(!r)return a+e;let c=e.padEnd(t+e.length-i.displayWidth(e)),u=2,f=(this.helpWidth??80)-t-u-2,h;return f<this.minWidthToWrap||i.preformatted(r)?h=r:h=i.boxWrap(r,f).replace(/\n/g,`
`+" ".repeat(t+u)),a+c+" ".repeat(u)+h.replace(/\n/g,`
${a}`)}boxWrap(e,t){if(t<this.minWidthToWrap)return e;let r=e.split(/\r\n|\n/),i=/[\s]*[^\s]+/g,s=[];return r.forEach(a=>{let c=a.match(i);if(c===null){s.push("");return}let u=[c.shift()],l=this.displayWidth(u[0]);c.forEach(f=>{let h=this.displayWidth(f);if(l+h<=t){u.push(f),l+=h;return}s.push(u.join(""));let d=f.trimStart();u=[d],l=this.displayWidth(d)}),s.push(u.join(""))}),s.join(`
`)}};function O1(n){let e=/\x1b\[\d*(;\d*)*m/g;return n.replace(e,"")}o(O1,"stripColor");_h.Help=wh;_h.stripColor=O1});var Ah=v(Th=>{var{InvalidArgumentError:sE}=go(),Sh=class{static{o(this,"Option")}constructor(e,t){this.flags=e,this.description=t||"",this.required=e.includes("<"),this.optional=e.includes("["),this.variadic=/\w\.\.\.[>\]]$/.test(e),this.mandatory=!1;let r=aE(e);this.short=r.shortFlag,this.long=r.longFlag,this.negate=!1,this.long&&(this.negate=this.long.startsWith("--no-")),this.defaultValue=void 0,this.defaultValueDescription=void 0,this.presetArg=void 0,this.envVar=void 0,this.parseArg=void 0,this.hidden=!1,this.argChoices=void 0,this.conflictsWith=[],this.implied=void 0,this.helpGroupHeading=void 0}default(e,t){return this.defaultValue=e,this.defaultValueDescription=t,this}preset(e){return this.presetArg=e,this}conflicts(e){return this.conflictsWith=this.conflictsWith.concat(e),this}implies(e){let t=e;return typeof e=="string"&&(t={[e]:!0}),this.implied=Object.assign(this.implied||{},t),this}env(e){return this.envVar=e,this}argParser(e){return this.parseArg=e,this}makeOptionMandatory(e=!0){return this.mandatory=!!e,this}hideHelp(e=!0){return this.hidden=!!e,this}_collectValue(e,t){return t===this.defaultValue||!Array.isArray(t)?[e]:(t.push(e),t)}choices(e){return this.argChoices=e.slice(),this.parseArg=(t,r)=>{if(!this.argChoices.includes(t))throw new sE(`Allowed choices are ${this.argChoices.join(", ")}.`);return this.variadic?this._collectValue(t,r):t},this}name(){return this.long?this.long.replace(/^--/,""):this.short.replace(/^-/,"")}attributeName(){return this.negate?D1(this.name().replace(/^no-/,"")):D1(this.name())}helpGroup(e){return this.helpGroupHeading=e,this}is(e){return this.short===e||this.long===e}isBoolean(){return!this.required&&!this.optional&&!this.negate}},Eh=class{static{o(this,"DualOptions")}constructor(e){this.positiveOptions=new Map,this.negativeOptions=new Map,this.dualOptions=new Set,e.forEach(t=>{t.negate?this.negativeOptions.set(t.attributeName(),t):this.positiveOptions.set(t.attributeName(),t)}),this.negativeOptions.forEach((t,r)=>{this.positiveOptions.has(r)&&this.dualOptions.add(r)})}valueFromOption(e,t){let r=t.attributeName();if(!this.dualOptions.has(r))return!0;let i=this.negativeOptions.get(r).presetArg,s=i!==void 0?i:!1;return t.negate===(s===e)}};function D1(n){return n.split("-").reduce((e,t)=>e+t[0].toUpperCase()+t.slice(1))}o(D1,"camelcase");function aE(n){let e,t,r=/^-[^-]$/,i=/^--[^-]/,s=n.split(/[ |,]+/).concat("guard");if(r.test(s[0])&&(e=s.shift()),i.test(s[0])&&(t=s.shift()),!e&&r.test(s[0])&&(e=s.shift()),!e&&i.test(s[0])&&(e=t,t=s.shift()),s[0].startsWith("-")){let a=s[0],c=`option creation failed due to '${a}' in option flags '${n}'`;throw/^-[^-][^-]/.test(a)?new Error(`${c}
- a short flag is a single dash and a single character
  - either use a single dash and a single character (for a short flag)
  - or use a double dash for a long option (and can have two, like '--ws, --workspace')`):r.test(a)?new Error(`${c}
- too many short flags`):i.test(a)?new Error(`${c}
- too many long flags`):new Error(`${c}
- unrecognised flag format`)}if(e===void 0&&t===void 0)throw new Error(`option creation failed due to no flags found in '${n}'.`);return{shortFlag:e,longFlag:t}}o(aE,"splitOptionFlags");Th.Option=Sh;Th.DualOptions=Eh});var P1=v(I1=>{function oE(n,e){if(Math.abs(n.length-e.length)>3)return Math.max(n.length,e.length);let t=[];for(let r=0;r<=n.length;r++)t[r]=[r];for(let r=0;r<=e.length;r++)t[0][r]=r;for(let r=1;r<=e.length;r++)for(let i=1;i<=n.length;i++){let s=1;n[i-1]===e[r-1]?s=0:s=1,t[i][r]=Math.min(t[i-1][r]+1,t[i][r-1]+1,t[i-1][r-1]+s),i>1&&r>1&&n[i-1]===e[r-2]&&n[i-2]===e[r-1]&&(t[i][r]=Math.min(t[i][r],t[i-2][r-2]+1))}return t[n.length][e.length]}o(oE,"editDistance");function cE(n,e){if(!e||e.length===0)return"";e=Array.from(new Set(e));let t=n.startsWith("--");t&&(n=n.slice(2),e=e.map(a=>a.slice(2)));let r=[],i=3,s=.4;return e.forEach(a=>{if(a.length<=1)return;let c=oE(n,a),u=Math.max(n.length,a.length);(u-c)/u>s&&(c<i?(i=c,r=[a]):c===i&&r.push(a))}),r.sort((a,c)=>a.localeCompare(c)),t&&(r=r.map(a=>`--${a}`)),r.length>1?`
(Did you mean one of ${r.join(", ")}?)`:r.length===1?`
(Did you mean ${r[0]}?)`:""}o(cE,"suggestSimilar");I1.suggestSimilar=cE});var k1=v(Ih=>{var uE=require("node:events").EventEmitter,xh=require("node:child_process"),Zn=require("node:path"),Xc=require("node:fs"),Ue=require("node:process"),{Argument:lE,humanReadableArgName:fE}=Yc(),{CommanderError:Ch}=go(),{Help:hE,stripColor:dE}=bh(),{Option:F1,DualOptions:pE}=Ah(),{suggestSimilar:R1}=P1(),Oh=class n extends uE{static{o(this,"Command")}constructor(e){super(),this.commands=[],this.options=[],this.parent=null,this._allowUnknownOption=!1,this._allowExcessArguments=!1,this.registeredArguments=[],this._args=this.registeredArguments,this.args=[],this.rawArgs=[],this.processedArgs=[],this._scriptPath=null,this._name=e||"",this._optionValues={},this._optionValueSources={},this._storeOptionsAsProperties=!1,this._actionHandler=null,this._executableHandler=!1,this._executableFile=null,this._executableDir=null,this._defaultCommandName=null,this._exitCallback=null,this._aliases=[],this._combineFlagAndOptionalValue=!0,this._description="",this._summary="",this._argsDescription=void 0,this._enablePositionalOptions=!1,this._passThroughOptions=!1,this._lifeCycleHooks={},this._showHelpAfterError=!1,this._showSuggestionAfterError=!0,this._savedState=null,this._outputConfiguration={writeOut:o(t=>Ue.stdout.write(t),"writeOut"),writeErr:o(t=>Ue.stderr.write(t),"writeErr"),outputError:o((t,r)=>r(t),"outputError"),getOutHelpWidth:o(()=>Ue.stdout.isTTY?Ue.stdout.columns:void 0,"getOutHelpWidth"),getErrHelpWidth:o(()=>Ue.stderr.isTTY?Ue.stderr.columns:void 0,"getErrHelpWidth"),getOutHasColors:o(()=>Dh()??(Ue.stdout.isTTY&&Ue.stdout.hasColors?.()),"getOutHasColors"),getErrHasColors:o(()=>Dh()??(Ue.stderr.isTTY&&Ue.stderr.hasColors?.()),"getErrHasColors"),stripColor:o(t=>dE(t),"stripColor")},this._hidden=!1,this._helpOption=void 0,this._addImplicitHelpCommand=void 0,this._helpCommand=void 0,this._helpConfiguration={},this._helpGroupHeading=void 0,this._defaultCommandGroup=void 0,this._defaultOptionGroup=void 0}copyInheritedSettings(e){return this._outputConfiguration=e._outputConfiguration,this._helpOption=e._helpOption,this._helpCommand=e._helpCommand,this._helpConfiguration=e._helpConfiguration,this._exitCallback=e._exitCallback,this._storeOptionsAsProperties=e._storeOptionsAsProperties,this._combineFlagAndOptionalValue=e._combineFlagAndOptionalValue,this._allowExcessArguments=e._allowExcessArguments,this._enablePositionalOptions=e._enablePositionalOptions,this._showHelpAfterError=e._showHelpAfterError,this._showSuggestionAfterError=e._showSuggestionAfterError,this}_getCommandAndAncestors(){let e=[];for(let t=this;t;t=t.parent)e.push(t);return e}command(e,t,r){let i=t,s=r;typeof i=="object"&&i!==null&&(s=i,i=null),s=s||{};let[,a,c]=e.match(/([^ ]+) *(.*)/),u=this.createCommand(a);return i&&(u.description(i),u._executableHandler=!0),s.isDefault&&(this._defaultCommandName=u._name),u._hidden=!!(s.noHelp||s.hidden),u._executableFile=s.executableFile||null,c&&u.arguments(c),this._registerCommand(u),u.parent=this,u.copyInheritedSettings(this),i?this:u}createCommand(e){return new n(e)}createHelp(){return Object.assign(new hE,this.configureHelp())}configureHelp(e){return e===void 0?this._helpConfiguration:(this._helpConfiguration=e,this)}configureOutput(e){return e===void 0?this._outputConfiguration:(this._outputConfiguration={...this._outputConfiguration,...e},this)}showHelpAfterError(e=!0){return typeof e!="string"&&(e=!!e),this._showHelpAfterError=e,this}showSuggestionAfterError(e=!0){return this._showSuggestionAfterError=!!e,this}addCommand(e,t){if(!e._name)throw new Error(`Command passed to .addCommand() must have a name
- specify the name in Command constructor or using .name()`);return t=t||{},t.isDefault&&(this._defaultCommandName=e._name),(t.noHelp||t.hidden)&&(e._hidden=!0),this._registerCommand(e),e.parent=this,e._checkForBrokenPassThrough(),this}createArgument(e,t){return new lE(e,t)}argument(e,t,r,i){let s=this.createArgument(e,t);return typeof r=="function"?s.default(i).argParser(r):s.default(r),this.addArgument(s),this}arguments(e){return e.trim().split(/ +/).forEach(t=>{this.argument(t)}),this}addArgument(e){let t=this.registeredArguments.slice(-1)[0];if(t?.variadic)throw new Error(`only the last argument can be variadic '${t.name()}'`);if(e.required&&e.defaultValue!==void 0&&e.parseArg===void 0)throw new Error(`a default value for a required argument is never used: '${e.name()}'`);return this.registeredArguments.push(e),this}helpCommand(e,t){if(typeof e=="boolean")return this._addImplicitHelpCommand=e,e&&this._defaultCommandGroup&&this._initCommandGroup(this._getHelpCommand()),this;let r=e??"help [command]",[,i,s]=r.match(/([^ ]+) *(.*)/),a=t??"display help for command",c=this.createCommand(i);return c.helpOption(!1),s&&c.arguments(s),a&&c.description(a),this._addImplicitHelpCommand=!0,this._helpCommand=c,(e||t)&&this._initCommandGroup(c),this}addHelpCommand(e,t){return typeof e!="object"?(this.helpCommand(e,t),this):(this._addImplicitHelpCommand=!0,this._helpCommand=e,this._initCommandGroup(e),this)}_getHelpCommand(){return this._addImplicitHelpCommand??(this.commands.length&&!this._actionHandler&&!this._findCommand("help"))?(this._helpCommand===void 0&&this.helpCommand(void 0,void 0),this._helpCommand):null}hook(e,t){let r=["preSubcommand","preAction","postAction"];if(!r.includes(e))throw new Error(`Unexpected value for event passed to hook : '${e}'.
Expecting one of '${r.join("', '")}'`);return this._lifeCycleHooks[e]?this._lifeCycleHooks[e].push(t):this._lifeCycleHooks[e]=[t],this}exitOverride(e){return e?this._exitCallback=e:this._exitCallback=t=>{if(t.code!=="commander.executeSubCommandAsync")throw t},this}_exit(e,t,r){this._exitCallback&&this._exitCallback(new Ch(e,t,r)),Ue.exit(e)}action(e){let t=o(r=>{let i=this.registeredArguments.length,s=r.slice(0,i);return this._storeOptionsAsProperties?s[i]=this:s[i]=this.opts(),s.push(this),e.apply(this,s)},"listener");return this._actionHandler=t,this}createOption(e,t){return new F1(e,t)}_callParseArg(e,t,r,i){try{return e.parseArg(t,r)}catch(s){if(s.code==="commander.invalidArgument"){let a=`${i} ${s.message}`;this.error(a,{exitCode:s.exitCode,code:s.code})}throw s}}_registerOption(e){let t=e.short&&this._findOption(e.short)||e.long&&this._findOption(e.long);if(t){let r=e.long&&this._findOption(e.long)?e.long:e.short;throw new Error(`Cannot add option '${e.flags}'${this._name&&` to command '${this._name}'`} due to conflicting flag '${r}'
-  already used by option '${t.flags}'`)}this._initOptionGroup(e),this.options.push(e)}_registerCommand(e){let t=o(i=>[i.name()].concat(i.aliases()),"knownBy"),r=t(e).find(i=>this._findCommand(i));if(r){let i=t(this._findCommand(r)).join("|"),s=t(e).join("|");throw new Error(`cannot add command '${s}' as already have command '${i}'`)}this._initCommandGroup(e),this.commands.push(e)}addOption(e){this._registerOption(e);let t=e.name(),r=e.attributeName();if(e.negate){let s=e.long.replace(/^--no-/,"--");this._findOption(s)||this.setOptionValueWithSource(r,e.defaultValue===void 0?!0:e.defaultValue,"default")}else e.defaultValue!==void 0&&this.setOptionValueWithSource(r,e.defaultValue,"default");let i=o((s,a,c)=>{s==null&&e.presetArg!==void 0&&(s=e.presetArg);let u=this.getOptionValue(r);s!==null&&e.parseArg?s=this._callParseArg(e,s,u,a):s!==null&&e.variadic&&(s=e._collectValue(s,u)),s==null&&(e.negate?s=!1:e.isBoolean()||e.optional?s=!0:s=""),this.setOptionValueWithSource(r,s,c)},"handleOptionValue");return this.on("option:"+t,s=>{let a=`error: option '${e.flags}' argument '${s}' is invalid.`;i(s,a,"cli")}),e.envVar&&this.on("optionEnv:"+t,s=>{let a=`error: option '${e.flags}' value '${s}' from env '${e.envVar}' is invalid.`;i(s,a,"env")}),this}_optionEx(e,t,r,i,s){if(typeof t=="object"&&t instanceof F1)throw new Error("To add an Option object use addOption() instead of option() or requiredOption()");let a=this.createOption(t,r);if(a.makeOptionMandatory(!!e.mandatory),typeof i=="function")a.default(s).argParser(i);else if(i instanceof RegExp){let c=i;i=o((u,l)=>{let f=c.exec(u);return f?f[0]:l},"fn"),a.default(s).argParser(i)}else a.default(i);return this.addOption(a)}option(e,t,r,i){return this._optionEx({},e,t,r,i)}requiredOption(e,t,r,i){return this._optionEx({mandatory:!0},e,t,r,i)}combineFlagAndOptionalValue(e=!0){return this._combineFlagAndOptionalValue=!!e,this}allowUnknownOption(e=!0){return this._allowUnknownOption=!!e,this}allowExcessArguments(e=!0){return this._allowExcessArguments=!!e,this}enablePositionalOptions(e=!0){return this._enablePositionalOptions=!!e,this}passThroughOptions(e=!0){return this._passThroughOptions=!!e,this._checkForBrokenPassThrough(),this}_checkForBrokenPassThrough(){if(this.parent&&this._passThroughOptions&&!this.parent._enablePositionalOptions)throw new Error(`passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`)}storeOptionsAsProperties(e=!0){if(this.options.length)throw new Error("call .storeOptionsAsProperties() before adding options");if(Object.keys(this._optionValues).length)throw new Error("call .storeOptionsAsProperties() before setting option values");return this._storeOptionsAsProperties=!!e,this}getOptionValue(e){return this._storeOptionsAsProperties?this[e]:this._optionValues[e]}setOptionValue(e,t){return this.setOptionValueWithSource(e,t,void 0)}setOptionValueWithSource(e,t,r){return this._storeOptionsAsProperties?this[e]=t:this._optionValues[e]=t,this._optionValueSources[e]=r,this}getOptionValueSource(e){return this._optionValueSources[e]}getOptionValueSourceWithGlobals(e){let t;return this._getCommandAndAncestors().forEach(r=>{r.getOptionValueSource(e)!==void 0&&(t=r.getOptionValueSource(e))}),t}_prepareUserArgs(e,t){if(e!==void 0&&!Array.isArray(e))throw new Error("first parameter to parse must be array or undefined");if(t=t||{},e===void 0&&t.from===void 0){Ue.versions?.electron&&(t.from="electron");let i=Ue.execArgv??[];(i.includes("-e")||i.includes("--eval")||i.includes("-p")||i.includes("--print"))&&(t.from="eval")}e===void 0&&(e=Ue.argv),this.rawArgs=e.slice();let r;switch(t.from){case void 0:case"node":this._scriptPath=e[1],r=e.slice(2);break;case"electron":Ue.defaultApp?(this._scriptPath=e[1],r=e.slice(2)):r=e.slice(1);break;case"user":r=e.slice(0);break;case"eval":r=e.slice(1);break;default:throw new Error(`unexpected parse option { from: '${t.from}' }`)}return!this._name&&this._scriptPath&&this.nameFromFilename(this._scriptPath),this._name=this._name||"program",r}parse(e,t){this._prepareForParse();let r=this._prepareUserArgs(e,t);return this._parseCommand([],r),this}async parseAsync(e,t){this._prepareForParse();let r=this._prepareUserArgs(e,t);return await this._parseCommand([],r),this}_prepareForParse(){this._savedState===null?this.saveStateBeforeParse():this.restoreStateBeforeParse()}saveStateBeforeParse(){this._savedState={_name:this._name,_optionValues:{...this._optionValues},_optionValueSources:{...this._optionValueSources}}}restoreStateBeforeParse(){if(this._storeOptionsAsProperties)throw new Error(`Can not call parse again when storeOptionsAsProperties is true.
- either make a new Command for each call to parse, or stop storing options as properties`);this._name=this._savedState._name,this._scriptPath=null,this.rawArgs=[],this._optionValues={...this._savedState._optionValues},this._optionValueSources={...this._savedState._optionValueSources},this.args=[],this.processedArgs=[]}_checkForMissingExecutable(e,t,r){if(Xc.existsSync(e))return;let i=t?`searched for local subcommand relative to directory '${t}'`:"no directory for search for local subcommand, use .executableDir() to supply a custom directory",s=`'${e}' does not exist
 - if '${r}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead
 - if the default executable name is not suitable, use the executableFile option to supply a custom name or path
 - ${i}`;throw new Error(s)}_executeSubCommand(e,t){t=t.slice();let r=!1,i=[".js",".ts",".tsx",".mjs",".cjs"];function s(f,h){let d=Zn.resolve(f,h);if(Xc.existsSync(d))return d;if(i.includes(Zn.extname(h)))return;let m=i.find(_=>Xc.existsSync(`${d}${_}`));if(m)return`${d}${m}`}o(s,"findFile"),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let a=e._executableFile||`${this._name}-${e._name}`,c=this._executableDir||"";if(this._scriptPath){let f;try{f=Xc.realpathSync(this._scriptPath)}catch{f=this._scriptPath}c=Zn.resolve(Zn.dirname(f),c)}if(c){let f=s(c,a);if(!f&&!e._executableFile&&this._scriptPath){let h=Zn.basename(this._scriptPath,Zn.extname(this._scriptPath));h!==this._name&&(f=s(c,`${h}-${e._name}`))}a=f||a}r=i.includes(Zn.extname(a));let u;Ue.platform!=="win32"?r?(t.unshift(a),t=N1(Ue.execArgv).concat(t),u=xh.spawn(Ue.argv[0],t,{stdio:"inherit"})):u=xh.spawn(a,t,{stdio:"inherit"}):(this._checkForMissingExecutable(a,c,e._name),t.unshift(a),t=N1(Ue.execArgv).concat(t),u=xh.spawn(Ue.execPath,t,{stdio:"inherit"})),u.killed||["SIGUSR1","SIGUSR2","SIGTERM","SIGINT","SIGHUP"].forEach(h=>{Ue.on(h,()=>{u.killed===!1&&u.exitCode===null&&u.kill(h)})});let l=this._exitCallback;u.on("close",f=>{f=f??1,l?l(new Ch(f,"commander.executeSubCommandAsync","(close)")):Ue.exit(f)}),u.on("error",f=>{if(f.code==="ENOENT")this._checkForMissingExecutable(a,c,e._name);else if(f.code==="EACCES")throw new Error(`'${a}' not executable`);if(!l)Ue.exit(1);else{let h=new Ch(1,"commander.executeSubCommandAsync","(error)");h.nestedError=f,l(h)}}),this.runningCommand=u}_dispatchSubcommand(e,t,r){let i=this._findCommand(e);i||this.help({error:!0}),i._prepareForParse();let s;return s=this._chainOrCallSubCommandHook(s,i,"preSubcommand"),s=this._chainOrCall(s,()=>{if(i._executableHandler)this._executeSubCommand(i,t.concat(r));else return i._parseCommand(t,r)}),s}_dispatchHelpCommand(e){e||this.help();let t=this._findCommand(e);return t&&!t._executableHandler&&t.help(),this._dispatchSubcommand(e,[],[this._getHelpOption()?.long??this._getHelpOption()?.short??"--help"])}_checkNumberOfArguments(){this.registeredArguments.forEach((e,t)=>{e.required&&this.args[t]==null&&this.missingArgument(e.name())}),!(this.registeredArguments.length>0&&this.registeredArguments[this.registeredArguments.length-1].variadic)&&this.args.length>this.registeredArguments.length&&this._excessArguments(this.args)}_processArguments(){let e=o((r,i,s)=>{let a=i;if(i!==null&&r.parseArg){let c=`error: command-argument value '${i}' is invalid for argument '${r.name()}'.`;a=this._callParseArg(r,i,s,c)}return a},"myParseArg");this._checkNumberOfArguments();let t=[];this.registeredArguments.forEach((r,i)=>{let s=r.defaultValue;r.variadic?i<this.args.length?(s=this.args.slice(i),r.parseArg&&(s=s.reduce((a,c)=>e(r,c,a),r.defaultValue))):s===void 0&&(s=[]):i<this.args.length&&(s=this.args[i],r.parseArg&&(s=e(r,s,r.defaultValue))),t[i]=s}),this.processedArgs=t}_chainOrCall(e,t){return e?.then&&typeof e.then=="function"?e.then(()=>t()):t()}_chainOrCallHooks(e,t){let r=e,i=[];return this._getCommandAndAncestors().reverse().filter(s=>s._lifeCycleHooks[t]!==void 0).forEach(s=>{s._lifeCycleHooks[t].forEach(a=>{i.push({hookedCommand:s,callback:a})})}),t==="postAction"&&i.reverse(),i.forEach(s=>{r=this._chainOrCall(r,()=>s.callback(s.hookedCommand,this))}),r}_chainOrCallSubCommandHook(e,t,r){let i=e;return this._lifeCycleHooks[r]!==void 0&&this._lifeCycleHooks[r].forEach(s=>{i=this._chainOrCall(i,()=>s(this,t))}),i}_parseCommand(e,t){let r=this.parseOptions(t);if(this._parseOptionsEnv(),this._parseOptionsImplied(),e=e.concat(r.operands),t=r.unknown,this.args=e.concat(t),e&&this._findCommand(e[0]))return this._dispatchSubcommand(e[0],e.slice(1),t);if(this._getHelpCommand()&&e[0]===this._getHelpCommand().name())return this._dispatchHelpCommand(e[1]);if(this._defaultCommandName)return this._outputHelpIfRequested(t),this._dispatchSubcommand(this._defaultCommandName,e,t);this.commands.length&&this.args.length===0&&!this._actionHandler&&!this._defaultCommandName&&this.help({error:!0}),this._outputHelpIfRequested(r.unknown),this._checkForMissingMandatoryOptions(),this._checkForConflictingOptions();let i=o(()=>{r.unknown.length>0&&this.unknownOption(r.unknown[0])},"checkForUnknownOptions"),s=`command:${this.name()}`;if(this._actionHandler){i(),this._processArguments();let a;return a=this._chainOrCallHooks(a,"preAction"),a=this._chainOrCall(a,()=>this._actionHandler(this.processedArgs)),this.parent&&(a=this._chainOrCall(a,()=>{this.parent.emit(s,e,t)})),a=this._chainOrCallHooks(a,"postAction"),a}if(this.parent?.listenerCount(s))i(),this._processArguments(),this.parent.emit(s,e,t);else if(e.length){if(this._findCommand("*"))return this._dispatchSubcommand("*",e,t);this.listenerCount("command:*")?this.emit("command:*",e,t):this.commands.length?this.unknownCommand():(i(),this._processArguments())}else this.commands.length?(i(),this.help({error:!0})):(i(),this._processArguments())}_findCommand(e){if(e)return this.commands.find(t=>t._name===e||t._aliases.includes(e))}_findOption(e){return this.options.find(t=>t.is(e))}_checkForMissingMandatoryOptions(){this._getCommandAndAncestors().forEach(e=>{e.options.forEach(t=>{t.mandatory&&e.getOptionValue(t.attributeName())===void 0&&e.missingMandatoryOptionValue(t)})})}_checkForConflictingLocalOptions(){let e=this.options.filter(r=>{let i=r.attributeName();return this.getOptionValue(i)===void 0?!1:this.getOptionValueSource(i)!=="default"});e.filter(r=>r.conflictsWith.length>0).forEach(r=>{let i=e.find(s=>r.conflictsWith.includes(s.attributeName()));i&&this._conflictingOption(r,i)})}_checkForConflictingOptions(){this._getCommandAndAncestors().forEach(e=>{e._checkForConflictingLocalOptions()})}parseOptions(e){let t=[],r=[],i=t;function s(f){return f.length>1&&f[0]==="-"}o(s,"maybeOption");let a=o(f=>/^-(\d+|\d*\.\d+)(e[+-]?\d+)?$/.test(f)?!this._getCommandAndAncestors().some(h=>h.options.map(d=>d.short).some(d=>/^-\d$/.test(d))):!1,"negativeNumberArg"),c=null,u=null,l=0;for(;l<e.length||u;){let f=u??e[l++];if(u=null,f==="--"){i===r&&i.push(f),i.push(...e.slice(l));break}if(c&&(!s(f)||a(f))){this.emit(`option:${c.name()}`,f);continue}if(c=null,s(f)){let h=this._findOption(f);if(h){if(h.required){let d=e[l++];d===void 0&&this.optionMissingArgument(h),this.emit(`option:${h.name()}`,d)}else if(h.optional){let d=null;l<e.length&&(!s(e[l])||a(e[l]))&&(d=e[l++]),this.emit(`option:${h.name()}`,d)}else this.emit(`option:${h.name()}`);c=h.variadic?h:null;continue}}if(f.length>2&&f[0]==="-"&&f[1]!=="-"){let h=this._findOption(`-${f[1]}`);if(h){h.required||h.optional&&this._combineFlagAndOptionalValue?this.emit(`option:${h.name()}`,f.slice(2)):(this.emit(`option:${h.name()}`),u=`-${f.slice(2)}`);continue}}if(/^--[^=]+=/.test(f)){let h=f.indexOf("="),d=this._findOption(f.slice(0,h));if(d&&(d.required||d.optional)){this.emit(`option:${d.name()}`,f.slice(h+1));continue}}if(i===t&&s(f)&&!(this.commands.length===0&&a(f))&&(i=r),(this._enablePositionalOptions||this._passThroughOptions)&&t.length===0&&r.length===0){if(this._findCommand(f)){t.push(f),r.push(...e.slice(l));break}else if(this._getHelpCommand()&&f===this._getHelpCommand().name()){t.push(f,...e.slice(l));break}else if(this._defaultCommandName){r.push(f,...e.slice(l));break}}if(this._passThroughOptions){i.push(f,...e.slice(l));break}i.push(f)}return{operands:t,unknown:r}}opts(){if(this._storeOptionsAsProperties){let e={},t=this.options.length;for(let r=0;r<t;r++){let i=this.options[r].attributeName();e[i]=i===this._versionOptionName?this._version:this[i]}return e}return this._optionValues}optsWithGlobals(){return this._getCommandAndAncestors().reduce((e,t)=>Object.assign(e,t.opts()),{})}error(e,t){this._outputConfiguration.outputError(`${e}
`,this._outputConfiguration.writeErr),typeof this._showHelpAfterError=="string"?this._outputConfiguration.writeErr(`${this._showHelpAfterError}
`):this._showHelpAfterError&&(this._outputConfiguration.writeErr(`
`),this.outputHelp({error:!0}));let r=t||{},i=r.exitCode||1,s=r.code||"commander.error";this._exit(i,s,e)}_parseOptionsEnv(){this.options.forEach(e=>{if(e.envVar&&e.envVar in Ue.env){let t=e.attributeName();(this.getOptionValue(t)===void 0||["default","config","env"].includes(this.getOptionValueSource(t)))&&(e.required||e.optional?this.emit(`optionEnv:${e.name()}`,Ue.env[e.envVar]):this.emit(`optionEnv:${e.name()}`))}})}_parseOptionsImplied(){let e=new pE(this.options),t=o(r=>this.getOptionValue(r)!==void 0&&!["default","implied"].includes(this.getOptionValueSource(r)),"hasCustomOptionValue");this.options.filter(r=>r.implied!==void 0&&t(r.attributeName())&&e.valueFromOption(this.getOptionValue(r.attributeName()),r)).forEach(r=>{Object.keys(r.implied).filter(i=>!t(i)).forEach(i=>{this.setOptionValueWithSource(i,r.implied[i],"implied")})})}missingArgument(e){let t=`error: missing required argument '${e}'`;this.error(t,{code:"commander.missingArgument"})}optionMissingArgument(e){let t=`error: option '${e.flags}' argument missing`;this.error(t,{code:"commander.optionMissingArgument"})}missingMandatoryOptionValue(e){let t=`error: required option '${e.flags}' not specified`;this.error(t,{code:"commander.missingMandatoryOptionValue"})}_conflictingOption(e,t){let r=o(a=>{let c=a.attributeName(),u=this.getOptionValue(c),l=this.options.find(h=>h.negate&&c===h.attributeName()),f=this.options.find(h=>!h.negate&&c===h.attributeName());return l&&(l.presetArg===void 0&&u===!1||l.presetArg!==void 0&&u===l.presetArg)?l:f||a},"findBestOptionFromValue"),i=o(a=>{let c=r(a),u=c.attributeName();return this.getOptionValueSource(u)==="env"?`environment variable '${c.envVar}'`:`option '${c.flags}'`},"getErrorMessage"),s=`error: ${i(e)} cannot be used with ${i(t)}`;this.error(s,{code:"commander.conflictingOption"})}unknownOption(e){if(this._allowUnknownOption)return;let t="";if(e.startsWith("--")&&this._showSuggestionAfterError){let i=[],s=this;do{let a=s.createHelp().visibleOptions(s).filter(c=>c.long).map(c=>c.long);i=i.concat(a),s=s.parent}while(s&&!s._enablePositionalOptions);t=R1(e,i)}let r=`error: unknown option '${e}'${t}`;this.error(r,{code:"commander.unknownOption"})}_excessArguments(e){if(this._allowExcessArguments)return;let t=this.registeredArguments.length,r=t===1?"":"s",s=`error: too many arguments${this.parent?` for '${this.name()}'`:""}. Expected ${t} argument${r} but got ${e.length}.`;this.error(s,{code:"commander.excessArguments"})}unknownCommand(){let e=this.args[0],t="";if(this._showSuggestionAfterError){let i=[];this.createHelp().visibleCommands(this).forEach(s=>{i.push(s.name()),s.alias()&&i.push(s.alias())}),t=R1(e,i)}let r=`error: unknown command '${e}'${t}`;this.error(r,{code:"commander.unknownCommand"})}version(e,t,r){if(e===void 0)return this._version;this._version=e,t=t||"-V, --version",r=r||"output the version number";let i=this.createOption(t,r);return this._versionOptionName=i.attributeName(),this._registerOption(i),this.on("option:"+i.name(),()=>{this._outputConfiguration.writeOut(`${e}
`),this._exit(0,"commander.version",e)}),this}description(e,t){return e===void 0&&t===void 0?this._description:(this._description=e,t&&(this._argsDescription=t),this)}summary(e){return e===void 0?this._summary:(this._summary=e,this)}alias(e){if(e===void 0)return this._aliases[0];let t=this;if(this.commands.length!==0&&this.commands[this.commands.length-1]._executableHandler&&(t=this.commands[this.commands.length-1]),e===t._name)throw new Error("Command alias can't be the same as its name");let r=this.parent?._findCommand(e);if(r){let i=[r.name()].concat(r.aliases()).join("|");throw new Error(`cannot add alias '${e}' to command '${this.name()}' as already have command '${i}'`)}return t._aliases.push(e),this}aliases(e){return e===void 0?this._aliases:(e.forEach(t=>this.alias(t)),this)}usage(e){if(e===void 0){if(this._usage)return this._usage;let t=this.registeredArguments.map(r=>fE(r));return[].concat(this.options.length||this._helpOption!==null?"[options]":[],this.commands.length?"[command]":[],this.registeredArguments.length?t:[]).join(" ")}return this._usage=e,this}name(e){return e===void 0?this._name:(this._name=e,this)}helpGroup(e){return e===void 0?this._helpGroupHeading??"":(this._helpGroupHeading=e,this)}commandsGroup(e){return e===void 0?this._defaultCommandGroup??"":(this._defaultCommandGroup=e,this)}optionsGroup(e){return e===void 0?this._defaultOptionGroup??"":(this._defaultOptionGroup=e,this)}_initOptionGroup(e){this._defaultOptionGroup&&!e.helpGroupHeading&&e.helpGroup(this._defaultOptionGroup)}_initCommandGroup(e){this._defaultCommandGroup&&!e.helpGroup()&&e.helpGroup(this._defaultCommandGroup)}nameFromFilename(e){return this._name=Zn.basename(e,Zn.extname(e)),this}executableDir(e){return e===void 0?this._executableDir:(this._executableDir=e,this)}helpInformation(e){let t=this.createHelp(),r=this._getOutputContext(e);t.prepareContext({error:r.error,helpWidth:r.helpWidth,outputHasColors:r.hasColors});let i=t.formatHelp(this,t);return r.hasColors?i:this._outputConfiguration.stripColor(i)}_getOutputContext(e){e=e||{};let t=!!e.error,r,i,s;return t?(r=o(c=>this._outputConfiguration.writeErr(c),"baseWrite"),i=this._outputConfiguration.getErrHasColors(),s=this._outputConfiguration.getErrHelpWidth()):(r=o(c=>this._outputConfiguration.writeOut(c),"baseWrite"),i=this._outputConfiguration.getOutHasColors(),s=this._outputConfiguration.getOutHelpWidth()),{error:t,write:o(c=>(i||(c=this._outputConfiguration.stripColor(c)),r(c)),"write"),hasColors:i,helpWidth:s}}outputHelp(e){let t;typeof e=="function"&&(t=e,e=void 0);let r=this._getOutputContext(e),i={error:r.error,write:r.write,command:this};this._getCommandAndAncestors().reverse().forEach(a=>a.emit("beforeAllHelp",i)),this.emit("beforeHelp",i);let s=this.helpInformation({error:r.error});if(t&&(s=t(s),typeof s!="string"&&!Buffer.isBuffer(s)))throw new Error("outputHelp callback must return a string or a Buffer");r.write(s),this._getHelpOption()?.long&&this.emit(this._getHelpOption().long),this.emit("afterHelp",i),this._getCommandAndAncestors().forEach(a=>a.emit("afterAllHelp",i))}helpOption(e,t){return typeof e=="boolean"?(e?(this._helpOption===null&&(this._helpOption=void 0),this._defaultOptionGroup&&this._initOptionGroup(this._getHelpOption())):this._helpOption=null,this):(this._helpOption=this.createOption(e??"-h, --help",t??"display help for command"),(e||t)&&this._initOptionGroup(this._helpOption),this)}_getHelpOption(){return this._helpOption===void 0&&this.helpOption(void 0,void 0),this._helpOption}addHelpOption(e){return this._helpOption=e,this._initOptionGroup(e),this}help(e){this.outputHelp(e);let t=Number(Ue.exitCode??0);t===0&&e&&typeof e!="function"&&e.error&&(t=1),this._exit(t,"commander.help","(outputHelp)")}addHelpText(e,t){let r=["beforeAll","before","after","afterAll"];if(!r.includes(e))throw new Error(`Unexpected value for position to addHelpText.
Expecting one of '${r.join("', '")}'`);let i=`${e}Help`;return this.on(i,s=>{let a;typeof t=="function"?a=t({error:s.error,command:s.command}):a=t,a&&s.write(`${a}
`)}),this}_outputHelpIfRequested(e){let t=this._getHelpOption();t&&e.find(i=>t.is(i))&&(this.outputHelp(),this._exit(0,"commander.helpDisplayed","(outputHelp)"))}};function N1(n){return n.map(e=>{if(!e.startsWith("--inspect"))return e;let t,r="127.0.0.1",i="9229",s;return(s=e.match(/^(--inspect(-brk)?)$/))!==null?t=s[1]:(s=e.match(/^(--inspect(-brk|-port)?)=([^:]+)$/))!==null?(t=s[1],/^\d+$/.test(s[3])?i=s[3]:r=s[3]):(s=e.match(/^(--inspect(-brk|-port)?)=([^:]+):(\d+)$/))!==null&&(t=s[1],r=s[3],i=s[4]),t&&i!=="0"?`${t}=${r}:${parseInt(i)+1}`:e})}o(N1,"incrementNodeInspectorPort");function Dh(){if(Ue.env.NO_COLOR||Ue.env.FORCE_COLOR==="0"||Ue.env.FORCE_COLOR==="false")return!1;if(Ue.env.FORCE_COLOR||Ue.env.CLICOLOR_FORCE!==void 0)return!0}o(Dh,"useColor");Ih.Command=Oh;Ih.useColor=Dh});var V1=v(Lr=>{var{Argument:L1}=Yc(),{Command:Ph}=k1(),{CommanderError:mE,InvalidArgumentError:j1}=go(),{Help:gE}=bh(),{Option:M1}=Ah();Lr.program=new Ph;Lr.createCommand=n=>new Ph(n);Lr.createOption=(n,e)=>new M1(n,e);Lr.createArgument=(n,e)=>new L1(n,e);Lr.Command=Ph;Lr.Option=M1;Lr.Argument=L1;Lr.Help=gE;Lr.CommanderError=mE;Lr.InvalidArgumentError=j1;Lr.InvalidOptionArgumentError=j1});var Fh=v(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.AssetClass=void 0;var B1;(function(n){n.AREA="ems__Area",n.TASK="ems__Task",n.PROJECT="ems__Project",n.MEETING="ems__Meeting",n.INITIATIVE="ems__Initiative",n.TASK_PROTOTYPE="ems__TaskPrototype",n.MEETING_PROTOTYPE="ems__MeetingPrototype",n.EVENT_PROTOTYPE="exo__EventPrototype",n.PROJECT_PROTOTYPE="ems__ProjectPrototype",n.EVENT="exo__Event",n.DAILY_NOTE="pn__DailyNote",n.CONCEPT="ims__Concept",n.SESSION_START_EVENT="ems__SessionStartEvent",n.SESSION_END_EVENT="ems__SessionEndEvent",n.PROTOTYPE="exo__Prototype",n.CLASS="exo__Class"})(B1||(Jc.AssetClass=B1={}))});var Rh=v(Zc=>{"use strict";Object.defineProperty(Zc,"__esModule",{value:!0});Zc.EffortStatus=void 0;var U1;(function(n){n.DRAFT="ems__EffortStatusDraft",n.BACKLOG="ems__EffortStatusBacklog",n.ANALYSIS="ems__EffortStatusAnalysis",n.TODO="ems__EffortStatusToDo",n.DOING="ems__EffortStatusDoing",n.DONE="ems__EffortStatusDone",n.TRASHED="ems__EffortStatusTrashed"})(U1||(Zc.EffortStatus=U1={}))});var G1=v(q1=>{"use strict";Object.defineProperty(q1,"__esModule",{value:!0})});var z1=v(W1=>{"use strict";Object.defineProperty(W1,"__esModule",{value:!0})});var K1=v(H1=>{"use strict";Object.defineProperty(H1,"__esModule",{value:!0})});var Y1=v(Q1=>{"use strict";Object.defineProperty(Q1,"__esModule",{value:!0})});var Xe=v(eu=>{"use strict";Object.defineProperty(eu,"__esModule",{value:!0});eu.IRI=void 0;var Nh=class n{static{o(this,"IRI")}constructor(e){let t=e.trim();if(t.length===0)throw new Error("IRI cannot be empty");if(!n.isValidIRI(t))throw new Error("Invalid IRI format");this._value=t}get value(){return this._value}equals(e){return this._value===e._value}toString(){return this._value}static isValidIRI(e){if(!e||e.trim().length===0||/\s/.test(e)||!/^[a-z][a-z0-9+.-]*:/i.test(e))return!1;let r=["http","https","ftp","ftps","file","mailto","tel","data","ws","wss","urn","obsidian"],i=e.match(/^([a-z][a-z0-9+.-]*?):/i);if(i){let s=i[1].toLowerCase();if(!r.includes(s))return!1}try{return new URL(e),!0}catch{return/^urn:[a-z0-9][a-z0-9-]{0,31}:[^\s]+$/i.test(e)}}};eu.IRI=Nh});var dt=v(is=>{"use strict";Object.defineProperty(is,"__esModule",{value:!0});is.Literal=void 0;is.parseLanguageTag=X1;is.createDirectionalLiteral=vE;is.createLiteralFromLanguageTag=wE;var yE="http://www.w3.org/2001/XMLSchema#string",yo=class{static{o(this,"Literal")}constructor(e,t,r,i){if(e.length===0)throw new Error("Literal value cannot be empty");if(t&&r)throw new Error("Literal cannot have both datatype and language tag");if(i&&!r)throw new Error("Literal cannot have direction without language tag");if(i&&i!=="ltr"&&i!=="rtl")throw new Error('Direction must be "ltr" or "rtl"');this._value=e,this._datatype=t,this._language=r?r.toLowerCase():void 0,this._direction=i}get value(){return this._value}get datatype(){return this._datatype}get language(){return this._language}get direction(){return this._direction}hasDirection(){return this._direction!==void 0}equals(e){if(this._value!==e._value||this._language!==e._language||this._direction!==e._direction)return!1;let t=this.normalizedDatatype(),r=e.normalizedDatatype();return t===r}normalizedDatatype(){return!this._datatype||this._datatype.value===yE?null:this._datatype.value}toString(){let e=`"${this._value}"`;return this._datatype?e+=`^^<${this._datatype.value}>`:this._language&&(e+=`@${this._language}`,this._direction&&(e+=`--${this._direction}`)),e}};is.Literal=yo;function X1(n){let t=n.lastIndexOf("--");if(t===-1)return{language:n.toLowerCase()};let r=n.substring(t+2),i=n.substring(0,t);return r==="ltr"||r==="rtl"?{language:i.toLowerCase(),direction:r}:{language:n.toLowerCase()}}o(X1,"parseLanguageTag");function vE(n,e,t){return new yo(n,void 0,e,t)}o(vE,"createDirectionalLiteral");function wE(n,e){let{language:t,direction:r}=X1(e);return new yo(n,void 0,t,r)}o(wE,"createLiteralFromLanguageTag")});var Wt=v(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.BlankNode=void 0;var tu=class n{static{o(this,"BlankNode")}constructor(e){let t=e.trim();if(t.length===0)throw new Error("BlankNode id cannot be empty");this._id=t}get id(){return this._id}equals(e){return this._id===e._id}toString(){return`_:${this._id}`}static generateId(){return`b${++n.counter}`}static create(){return new n(n.generateId())}};ru.BlankNode=tu;tu.counter=0});var Dn=v(nu=>{"use strict";Object.defineProperty(nu,"__esModule",{value:!0});nu.Namespace=void 0;var J1=Xe(),ar=class{static{o(this,"Namespace")}constructor(e,t){if(e.trim().length===0)throw new Error("Namespace prefix cannot be empty");this._prefix=e,this._iri=new J1.IRI(t)}get prefix(){return this._prefix}get iri(){return this._iri}term(e){return new J1.IRI(`${this._iri.value}${e}`)}expand(e){let t=e.split(":");if(t.length!==2)return null;let[r,i]=t;return r!==this._prefix?null:this.term(i)}};nu.Namespace=ar;ar.RDF=new ar("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#");ar.RDFS=new ar("rdfs","http://www.w3.org/2000/01/rdf-schema#");ar.OWL=new ar("owl","http://www.w3.org/2002/07/owl#");ar.XSD=new ar("xsd","http://www.w3.org/2001/XMLSchema#");ar.EXO=new ar("exo","https://exocortex.my/ontology/exo#");ar.EMS=new ar("ems","https://exocortex.my/ontology/ems#")});var wi=v(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});iu.Triple=void 0;var kh=Xe(),Lh=dt(),jh=Wt(),Mh=class{static{o(this,"Triple")}constructor(e,t,r){this._subject=e,this._predicate=t,this._object=r}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}equals(e){return!(!this.equalsNode(this._subject,e._subject)||!this._predicate.equals(e._predicate)||!this.equalsNode(this._object,e._object))}equalsNode(e,t){return e instanceof kh.IRI&&t instanceof kh.IRI||e instanceof jh.BlankNode&&t instanceof jh.BlankNode||e instanceof Lh.Literal&&t instanceof Lh.Literal||this.isQuotedTriple(e)&&this.isQuotedTriple(t)?e.equals(t):!1}isQuotedTriple(e){return typeof e=="object"&&e!==null&&"termType"in e&&e.termType==="QuotedTriple"}toString(){let e=this.nodeToString(this._subject),t=`<${this._predicate.value}>`,r=this.nodeToString(this._object);return`${e} ${t} ${r} .`}nodeToString(e){return e instanceof kh.IRI?`<${e.value}>`:e instanceof jh.BlankNode||e instanceof Lh.Literal||this.isQuotedTriple(e)?e.toString():""}};iu.Triple=Mh});var vo=v(su=>{"use strict";Object.defineProperty(su,"__esModule",{value:!0});su.QuotedTriple=void 0;var Vh=Xe(),$h=dt(),Bh=Wt(),Uh=class n{static{o(this,"QuotedTriple")}constructor(e,t,r){this._subject=e,this._predicate=t,this._object=r}get subject(){return this._subject}get predicate(){return this._predicate}get object(){return this._object}equals(e){return!(!this.equalsNode(this._subject,e._subject)||!this._predicate.equals(e._predicate)||!this.equalsNode(this._object,e._object))}equalsNode(e,t){return e instanceof Vh.IRI&&t instanceof Vh.IRI||e instanceof Bh.BlankNode&&t instanceof Bh.BlankNode||e instanceof $h.Literal&&t instanceof $h.Literal||e instanceof n&&t instanceof n?e.equals(t):!1}get termType(){return"QuotedTriple"}toString(){let e=this.nodeToString(this._subject),t=`<${this._predicate.value}>`,r=this.nodeToString(this._object);return`<< ${e} ${t} ${r} >>`}nodeToString(e){return e instanceof Vh.IRI?`<${e.value}>`:e instanceof Bh.BlankNode||e instanceof $h.Literal||e instanceof n?e.toString():""}};su.QuotedTriple=Uh});var Z1=v(vt=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});vt.QuotedTriple=vt.Triple=vt.Namespace=vt.BlankNode=vt.createLiteralFromLanguageTag=vt.createDirectionalLiteral=vt.parseLanguageTag=vt.Literal=vt.IRI=void 0;var _E=Xe();Object.defineProperty(vt,"IRI",{enumerable:!0,get:o(function(){return _E.IRI},"get")});var au=dt();Object.defineProperty(vt,"Literal",{enumerable:!0,get:o(function(){return au.Literal},"get")});Object.defineProperty(vt,"parseLanguageTag",{enumerable:!0,get:o(function(){return au.parseLanguageTag},"get")});Object.defineProperty(vt,"createDirectionalLiteral",{enumerable:!0,get:o(function(){return au.createDirectionalLiteral},"get")});Object.defineProperty(vt,"createLiteralFromLanguageTag",{enumerable:!0,get:o(function(){return au.createLiteralFromLanguageTag},"get")});var bE=Wt();Object.defineProperty(vt,"BlankNode",{enumerable:!0,get:o(function(){return bE.BlankNode},"get")});var SE=Dn();Object.defineProperty(vt,"Namespace",{enumerable:!0,get:o(function(){return SE.Namespace},"get")});var EE=wi();Object.defineProperty(vt,"Triple",{enumerable:!0,get:o(function(){return EE.Triple},"get")});var TE=vo();Object.defineProperty(vt,"QuotedTriple",{enumerable:!0,get:o(function(){return TE.QuotedTriple},"get")})});var ss=v(cu=>{"use strict";Object.defineProperty(cu,"__esModule",{value:!0});cu.WikiLinkHelpers=void 0;var ou=class{static{o(this,"WikiLinkHelpers")}static normalize(e){return e?e.replace(this.WIKI_LINK_PATTERN,"").trim():""}static normalizeArray(e){return e?(Array.isArray(e)?e:[e]).map(r=>this.normalize(r)).filter(r=>r.length>0):[]}static equals(e,t){return this.normalize(e)===this.normalize(t)}static includes(e,t){let r=this.normalizeArray(e),i=this.normalize(t);return r.includes(i)}};cu.WikiLinkHelpers=ou;ou.WIKI_LINK_PATTERN=/\[\[|\]\]/g});var zt=v(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.EffortStatus=Xs.AssetClass=void 0;var AE=Fh();Object.defineProperty(Xs,"AssetClass",{enumerable:!0,get:o(function(){return AE.AssetClass},"get")});var xE=Rh();Object.defineProperty(Xs,"EffortStatus",{enumerable:!0,get:o(function(){return xE.EffortStatus},"get")})});var _i=v(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.hasClass=os;Ht.isAreaOrProject=CE;Ht.isEffort=OE;Ht.hasStatus=DE;Ht.isAssetArchived=IE;Ht.hasEmptyProperties=PE;Ht.needsFolderRepair=FE;Ht.getTodayDateString=qh;Ht.isPlannedForToday=RE;Ht.hasPlannedStartTimestamp=NE;Ht.extractDailyNoteDate=kE;Ht.isCurrentDateGteDay=LE;Ht.inheritsFromPrototype=ry;Ht.isPrototypeClass=ME;var ty=ss(),as=zt();function os(n,e){return n?(Array.isArray(n)?n:[n]).some(r=>ty.WikiLinkHelpers.normalize(r)===e):!1}o(os,"hasClass");function CE(n){return os(n,as.AssetClass.AREA)||os(n,as.AssetClass.PROJECT)}o(CE,"isAreaOrProject");function OE(n){return os(n,as.AssetClass.TASK)||os(n,as.AssetClass.PROJECT)||os(n,as.AssetClass.MEETING)}o(OE,"isEffort");function DE(n,e){if(!n)return!1;let t=Array.isArray(n)?n[0]:n;return t?ty.WikiLinkHelpers.normalize(t)===e:!1}o(DE,"hasStatus");function IE(n){if(n===!0||n===1)return!0;if(typeof n=="string"){let e=n.toLowerCase();return e==="true"||e==="yes"}return!1}o(IE,"isAssetArchived");function PE(n){return!n||Object.keys(n).length===0?!1:Object.values(n).some(e=>!!(e==null||typeof e=="string"&&e.trim()===""||Array.isArray(e)&&e.length===0||typeof e=="object"&&!Array.isArray(e)&&Object.keys(e).length===0))}o(PE,"hasEmptyProperties");function FE(n,e){if(!e)return!1;let t=n.replace(/\/$/,""),r=e.replace(/\/$/,"");return t!==r}o(FE,"needsFolderRepair");function qh(){let n=new Date,e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}o(qh,"getTodayDateString");function RE(n){let e=n.ems__Effort_plannedStartTimestamp;if(!e)return!1;let t=qh();return typeof e=="string"?e.split("T")[0]===t:Array.isArray(e)&&e.length>0?String(e[0]).split("T")[0]===t:!1}o(RE,"isPlannedForToday");function NE(n){let e=n.ems__Effort_plannedStartTimestamp;return e?typeof e=="string"?e.trim().length>0:Array.isArray(e)&&e.length>0?String(e[0]).trim().length>0:!1:!1}o(NE,"hasPlannedStartTimestamp");function kE(n){let e=n.pn__DailyNote_day;if(!e)return null;if(typeof e=="string"){let t=e.match(/\[\[([^\[\]]+)\]\]/);return t?t[1]:e}if(Array.isArray(e)&&e.length>0){let t=String(e[0]),r=t.match(/\[\[([^\[\]]+)\]\]/);return r?r[1]:t}return null}o(kE,"extractDailyNoteDate");function LE(n){return qh()>=n}o(LE,"isCurrentDateGteDay");function ey(n){return n?n.replace(/^["']|["']$/g,"").replace(/\[\[|\]\]/g,"").trim():""}o(ey,"normalizeWithQuotes");var jE=10;function ry(n,e=jE){let t=n.exo__Class_superClass;if(!t)return!1;let r=new Set,i=[],s=Array.isArray(t)?t:[t];for(let a of s){let c=ey(a);c&&i.push({className:c,depth:0})}for(;i.length>0;){let a=i.shift();if(!a)continue;let{className:c,depth:u}=a;if(u>e)continue;if(c===as.AssetClass.PROTOTYPE)return!0;if(r.has(c))continue;r.add(c);let l=`${c}__exo__Class_superClass`,f=n[l];if(f){let h=Array.isArray(f)?f:[f];for(let d of h){let m=ey(d);m&&!r.has(m)&&i.push({className:m,depth:u+1})}}}return!1}o(ry,"inheritsFromPrototype");function ME(n,e){return os(n,as.AssetClass.CLASS)?ry(e):!1}o(ME,"isPrototypeClass")});var iy=v(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.canCreateTask=VE;wo.canCreateRelatedTask=$E;wo.canConvertTaskToProject=BE;var uu=_i(),ny=zt();function VE(n){return(0,uu.isAreaOrProject)(n.instanceClass)}o(VE,"canCreateTask");function $E(n){return!(!(0,uu.hasClass)(n.instanceClass,ny.AssetClass.TASK)||(0,uu.isAssetArchived)(n.isArchived))}o($E,"canCreateRelatedTask");function BE(n){return(0,uu.hasClass)(n.instanceClass,ny.AssetClass.TASK)}o(BE,"canConvertTaskToProject")});var sy=v(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.canCreateProject=UE;Js.canMoveToAnalysis=qE;Js.canMoveToToDo=GE;Js.canConvertProjectToTask=WE;var bi=_i(),Si=zt();function UE(n){return(0,bi.hasClass)(n.instanceClass,Si.AssetClass.AREA)||(0,bi.hasClass)(n.instanceClass,Si.AssetClass.INITIATIVE)||(0,bi.hasClass)(n.instanceClass,Si.AssetClass.PROJECT)}o(UE,"canCreateProject");function qE(n){return(0,bi.hasClass)(n.instanceClass,Si.AssetClass.PROJECT)?(0,bi.hasStatus)(n.currentStatus,Si.EffortStatus.BACKLOG):!1}o(qE,"canMoveToAnalysis");function GE(n){return(0,bi.hasClass)(n.instanceClass,Si.AssetClass.PROJECT)?(0,bi.hasStatus)(n.currentStatus,Si.EffortStatus.ANALYSIS):!1}o(GE,"canMoveToToDo");function WE(n){return(0,bi.hasClass)(n.instanceClass,Si.AssetClass.PROJECT)}o(WE,"canConvertProjectToTask")});var cy=v(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.canCreateChildArea=zE;lu.canSetActiveFocus=HE;var ay=_i(),oy=zt();function zE(n){return(0,ay.hasClass)(n.instanceClass,oy.AssetClass.AREA)}o(zE,"canCreateChildArea");function HE(n){return(0,ay.hasClass)(n.instanceClass,oy.AssetClass.AREA)}o(HE,"canSetActiveFocus")});var ly=v(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.canPlanOnToday=KE;br.canPlanForEvening=QE;br.canShiftDayBackward=YE;br.canShiftDayForward=XE;br.canSetDraftStatus=JE;br.canMoveToBacklog=ZE;br.canStartEffort=eT;br.canMarkDone=tT;br.canTrashEffort=rT;br.canVoteOnEffort=nT;br.canRollbackStatus=iT;br.canArchiveTask=sT;var uy=ss(),tt=_i(),Cr=zt();function KE(n){return!(!(0,tt.isEffort)(n.instanceClass)||(0,tt.isPlannedForToday)(n.metadata))}o(KE,"canPlanOnToday");function QE(n){return!(0,tt.hasClass)(n.instanceClass,Cr.AssetClass.TASK)&&!(0,tt.hasClass)(n.instanceClass,Cr.AssetClass.MEETING)?!1:(0,tt.hasStatus)(n.currentStatus,Cr.EffortStatus.BACKLOG)}o(QE,"canPlanForEvening");function YE(n){return(0,tt.isEffort)(n.instanceClass)?(0,tt.hasPlannedStartTimestamp)(n.metadata):!1}o(YE,"canShiftDayBackward");function XE(n){return(0,tt.isEffort)(n.instanceClass)?(0,tt.hasPlannedStartTimestamp)(n.metadata):!1}o(XE,"canShiftDayForward");function JE(n){return(0,tt.isEffort)(n.instanceClass)?!n.currentStatus:!1}o(JE,"canSetDraftStatus");function ZE(n){return(0,tt.isEffort)(n.instanceClass)?(0,tt.hasStatus)(n.currentStatus,Cr.EffortStatus.DRAFT):!1}o(ZE,"canMoveToBacklog");function eT(n){return(0,tt.isEffort)(n.instanceClass)?(0,tt.hasClass)(n.instanceClass,Cr.AssetClass.TASK)||(0,tt.hasClass)(n.instanceClass,Cr.AssetClass.MEETING)?(0,tt.hasStatus)(n.currentStatus,Cr.EffortStatus.BACKLOG):(0,tt.hasClass)(n.instanceClass,Cr.AssetClass.PROJECT)?(0,tt.hasStatus)(n.currentStatus,Cr.EffortStatus.TODO):!1:!1}o(eT,"canStartEffort");function tT(n){return(0,tt.isEffort)(n.instanceClass)?(0,tt.hasStatus)(n.currentStatus,Cr.EffortStatus.DOING):!1}o(tT,"canMarkDone");function rT(n){return(0,tt.isEffort)(n.instanceClass)?n.currentStatus?!(Array.isArray(n.currentStatus)?n.currentStatus:[n.currentStatus]).some(r=>{let i=uy.WikiLinkHelpers.normalize(r);return i===Cr.EffortStatus.TRASHED||i===Cr.EffortStatus.DONE}):!0:!1}o(rT,"canTrashEffort");function nT(n){return!(!(0,tt.isEffort)(n.instanceClass)||(0,tt.isAssetArchived)(n.isArchived))}o(nT,"canVoteOnEffort");function iT(n){if(!(0,tt.isEffort)(n.instanceClass)||(0,tt.isAssetArchived)(n.isArchived)||!n.currentStatus)return!1;let e=Array.isArray(n.currentStatus)?n.currentStatus[0]:n.currentStatus;return!(!e||uy.WikiLinkHelpers.normalize(e)===Cr.EffortStatus.TRASHED)}o(iT,"canRollbackStatus");function sT(n){return!(0,tt.isAssetArchived)(n.isArchived)}o(sT,"canArchiveTask")});var fy=v(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.canCreateEvent=aT;Gr.canCreateInstance=oT;Gr.canCleanProperties=cT;Gr.canRepairFolder=uT;Gr.canRenameToUid=lT;Gr.canCopyLabelToAliases=fT;Gr.canCreateNarrowerConcept=hT;Gr.canCreateSubclass=dT;Gr.canCreateTaskForDailyNote=pT;var Sr=_i(),Ei=zt();function aT(n){return(0,Sr.isAreaOrProject)(n.instanceClass)}o(aT,"canCreateEvent");function oT(n){return(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.TASK_PROTOTYPE)||(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.MEETING_PROTOTYPE)||(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.EVENT_PROTOTYPE)||(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.PROJECT_PROTOTYPE)?!0:(0,Sr.isPrototypeClass)(n.instanceClass,n.metadata)}o(oT,"canCreateInstance");function cT(n){return(0,Sr.hasEmptyProperties)(n.metadata)}o(cT,"canCleanProperties");function uT(n){return(0,Sr.needsFolderRepair)(n.currentFolder,n.expectedFolder)}o(uT,"canRepairFolder");function lT(n,e){let t=n.metadata.exo__Asset_uid;return!t||(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.CONCEPT)?!1:e!==t}o(lT,"canRenameToUid");function fT(n){let e=n.metadata.exo__Asset_label;if(!e||typeof e!="string"||e.trim()==="")return!1;let t=e.trim(),r=n.metadata.aliases;return!r||!Array.isArray(r)||r.length===0?!0:!r.some(i=>typeof i!="string"?!1:i.trim()===t)}o(fT,"canCopyLabelToAliases");function hT(n){return(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.CONCEPT)}o(hT,"canCreateNarrowerConcept");function dT(n){return(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.CLASS)}o(dT,"canCreateSubclass");function pT(n){if(!(0,Sr.hasClass)(n.instanceClass,Ei.AssetClass.DAILY_NOTE)||n.isArchived)return!1;let e=(0,Sr.extractDailyNoteDate)(n.metadata);return e?(0,Sr.isCurrentDateGteDay)(e):!1}o(pT,"canCreateTaskForDailyNote")});var dy=v(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.canCreateTaskForDailyNote=N.canCreateSubclass=N.canCreateNarrowerConcept=N.canCopyLabelToAliases=N.canRenameToUid=N.canRepairFolder=N.canCleanProperties=N.canCreateInstance=N.canCreateEvent=N.canArchiveTask=N.canRollbackStatus=N.canVoteOnEffort=N.canTrashEffort=N.canMarkDone=N.canStartEffort=N.canMoveToBacklog=N.canSetDraftStatus=N.canShiftDayForward=N.canShiftDayBackward=N.canPlanForEvening=N.canPlanOnToday=N.canSetActiveFocus=N.canCreateChildArea=N.canConvertProjectToTask=N.canMoveToToDo=N.canMoveToAnalysis=N.canCreateProject=N.canConvertTaskToProject=N.canCreateRelatedTask=N.canCreateTask=N.isPrototypeClass=N.inheritsFromPrototype=N.isCurrentDateGteDay=N.extractDailyNoteDate=N.hasPlannedStartTimestamp=N.isPlannedForToday=N.getTodayDateString=N.needsFolderRepair=N.hasEmptyProperties=N.isAssetArchived=N.hasStatus=N.isEffort=N.isAreaOrProject=N.hasClass=void 0;var Er=_i();Object.defineProperty(N,"hasClass",{enumerable:!0,get:o(function(){return Er.hasClass},"get")});Object.defineProperty(N,"isAreaOrProject",{enumerable:!0,get:o(function(){return Er.isAreaOrProject},"get")});Object.defineProperty(N,"isEffort",{enumerable:!0,get:o(function(){return Er.isEffort},"get")});Object.defineProperty(N,"hasStatus",{enumerable:!0,get:o(function(){return Er.hasStatus},"get")});Object.defineProperty(N,"isAssetArchived",{enumerable:!0,get:o(function(){return Er.isAssetArchived},"get")});Object.defineProperty(N,"hasEmptyProperties",{enumerable:!0,get:o(function(){return Er.hasEmptyProperties},"get")});Object.defineProperty(N,"needsFolderRepair",{enumerable:!0,get:o(function(){return Er.needsFolderRepair},"get")});Object.defineProperty(N,"getTodayDateString",{enumerable:!0,get:o(function(){return Er.getTodayDateString},"get")});Object.defineProperty(N,"isPlannedForToday",{enumerable:!0,get:o(function(){return Er.isPlannedForToday},"get")});Object.defineProperty(N,"hasPlannedStartTimestamp",{enumerable:!0,get:o(function(){return Er.hasPlannedStartTimestamp},"get")});Object.defineProperty(N,"extractDailyNoteDate",{enumerable:!0,get:o(function(){return Er.extractDailyNoteDate},"get")});Object.defineProperty(N,"isCurrentDateGteDay",{enumerable:!0,get:o(function(){return Er.isCurrentDateGteDay},"get")});Object.defineProperty(N,"inheritsFromPrototype",{enumerable:!0,get:o(function(){return Er.inheritsFromPrototype},"get")});Object.defineProperty(N,"isPrototypeClass",{enumerable:!0,get:o(function(){return Er.isPrototypeClass},"get")});var Gh=iy();Object.defineProperty(N,"canCreateTask",{enumerable:!0,get:o(function(){return Gh.canCreateTask},"get")});Object.defineProperty(N,"canCreateRelatedTask",{enumerable:!0,get:o(function(){return Gh.canCreateRelatedTask},"get")});Object.defineProperty(N,"canConvertTaskToProject",{enumerable:!0,get:o(function(){return Gh.canConvertTaskToProject},"get")});var fu=sy();Object.defineProperty(N,"canCreateProject",{enumerable:!0,get:o(function(){return fu.canCreateProject},"get")});Object.defineProperty(N,"canMoveToAnalysis",{enumerable:!0,get:o(function(){return fu.canMoveToAnalysis},"get")});Object.defineProperty(N,"canMoveToToDo",{enumerable:!0,get:o(function(){return fu.canMoveToToDo},"get")});Object.defineProperty(N,"canConvertProjectToTask",{enumerable:!0,get:o(function(){return fu.canConvertProjectToTask},"get")});var hy=cy();Object.defineProperty(N,"canCreateChildArea",{enumerable:!0,get:o(function(){return hy.canCreateChildArea},"get")});Object.defineProperty(N,"canSetActiveFocus",{enumerable:!0,get:o(function(){return hy.canSetActiveFocus},"get")});var jr=ly();Object.defineProperty(N,"canPlanOnToday",{enumerable:!0,get:o(function(){return jr.canPlanOnToday},"get")});Object.defineProperty(N,"canPlanForEvening",{enumerable:!0,get:o(function(){return jr.canPlanForEvening},"get")});Object.defineProperty(N,"canShiftDayBackward",{enumerable:!0,get:o(function(){return jr.canShiftDayBackward},"get")});Object.defineProperty(N,"canShiftDayForward",{enumerable:!0,get:o(function(){return jr.canShiftDayForward},"get")});Object.defineProperty(N,"canSetDraftStatus",{enumerable:!0,get:o(function(){return jr.canSetDraftStatus},"get")});Object.defineProperty(N,"canMoveToBacklog",{enumerable:!0,get:o(function(){return jr.canMoveToBacklog},"get")});Object.defineProperty(N,"canStartEffort",{enumerable:!0,get:o(function(){return jr.canStartEffort},"get")});Object.defineProperty(N,"canMarkDone",{enumerable:!0,get:o(function(){return jr.canMarkDone},"get")});Object.defineProperty(N,"canTrashEffort",{enumerable:!0,get:o(function(){return jr.canTrashEffort},"get")});Object.defineProperty(N,"canVoteOnEffort",{enumerable:!0,get:o(function(){return jr.canVoteOnEffort},"get")});Object.defineProperty(N,"canRollbackStatus",{enumerable:!0,get:o(function(){return jr.canRollbackStatus},"get")});Object.defineProperty(N,"canArchiveTask",{enumerable:!0,get:o(function(){return jr.canArchiveTask},"get")});var ei=fy();Object.defineProperty(N,"canCreateEvent",{enumerable:!0,get:o(function(){return ei.canCreateEvent},"get")});Object.defineProperty(N,"canCreateInstance",{enumerable:!0,get:o(function(){return ei.canCreateInstance},"get")});Object.defineProperty(N,"canCleanProperties",{enumerable:!0,get:o(function(){return ei.canCleanProperties},"get")});Object.defineProperty(N,"canRepairFolder",{enumerable:!0,get:o(function(){return ei.canRepairFolder},"get")});Object.defineProperty(N,"canRenameToUid",{enumerable:!0,get:o(function(){return ei.canRenameToUid},"get")});Object.defineProperty(N,"canCopyLabelToAliases",{enumerable:!0,get:o(function(){return ei.canCopyLabelToAliases},"get")});Object.defineProperty(N,"canCreateNarrowerConcept",{enumerable:!0,get:o(function(){return ei.canCreateNarrowerConcept},"get")});Object.defineProperty(N,"canCreateSubclass",{enumerable:!0,get:o(function(){return ei.canCreateSubclass},"get")});Object.defineProperty(N,"canCreateTaskForDailyNote",{enumerable:!0,get:o(function(){return ei.canCreateTaskForDailyNote},"get")})});var py=v(cs=>{"use strict";var mT=cs&&cs.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),gT=cs&&cs.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&mT(e,n,t)};Object.defineProperty(cs,"__esModule",{value:!0});gT(dy(),cs)});var zh=v(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0});_o.PropertyFieldType=void 0;_o.rangeToFieldType=wT;var kt;(function(n){n.Text="text",n.Number="number",n.Date="date",n.DateTime="datetime",n.Boolean="boolean",n.Reference="reference",n.Enum="enum",n.StatusSelect="status-select",n.SizeSelect="size-select",n.Wikilink="wikilink",n.Timestamp="timestamp",n.Unknown="unknown"})(kt||(_o.PropertyFieldType=kt={}));var my="http://www.w3.org/2001/XMLSchema#",yT="https://exocortex.my/ontology/exo#",vT="https://exocortex.my/ontology/ems#";function wT(n){if(!n)return kt.Unknown;let e=n.trim();if(!e)return kt.Unknown;if(e.startsWith(my)){let t=e.substring(my.length);return Wh(t)}if(e.startsWith("xsd:")){let t=e.substring(4);return Wh(t)}if(e.includes("XMLSchema#")){let t=e.indexOf("XMLSchema#"),r=e.substring(t+10);return Wh(r)}return e.startsWith(vT)||e.startsWith("ems:")?_T(e):e.startsWith(yT)||e.startsWith("exo:")||bT(e)?kt.Reference:kt.Text}o(wT,"rangeToFieldType");function Wh(n){switch(n.toLowerCase()){case"string":case"normalizedstring":case"token":case"language":case"nmtoken":case"name":case"ncname":case"anyuri":return kt.Text;case"integer":case"int":case"long":case"short":case"byte":case"nonnegativeinteger":case"positiveinteger":case"nonpositiveinteger":case"negativeinteger":case"unsignedlong":case"unsignedint":case"unsignedshort":case"unsignedbyte":case"decimal":case"float":case"double":return kt.Number;case"date":return kt.Date;case"datetime":case"datetimestamp":return kt.DateTime;case"boolean":return kt.Boolean;case"time":return kt.Timestamp;default:return kt.Text}}o(Wh,"xsdTypeToFieldType");function _T(n){let e=n.toLowerCase();return e.includes("effortstatus")?kt.StatusSelect:e.includes("tasksize")?kt.SizeSelect:kt.Reference}o(_T,"emsTypeToFieldType");function bT(n){let e=n.toLowerCase();return e.includes("exocortex.my/ontology")?!0:["asset","task","project","area","effort","class","property","concept"].some(r=>e.includes(r))}o(bT,"isClassReference")});var yy=v(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.propertyNameToUri=ST;bo.uriToPropertyName=gy;bo.extractPropertyLabel=ET;function ST(n){return n.replace(/^([a-z]+)__/,"$1:")}o(ST,"propertyNameToUri");function gy(n){if(n.startsWith("http://")||n.startsWith("https://")){let e=n.match(/\/([a-z]+)#([A-Za-z0-9_]+)$/);if(e)return`${e[1]}__${e[2]}`;let t=n.lastIndexOf("#"),r=n.lastIndexOf("/"),i=Math.max(t,r);return i>=0?n.substring(i+1):n}return n.replace(/^([a-z]+):/,"$1__")}o(gy,"uriToPropertyName");function ET(n){let r=(n.includes(":")?gy(n):n).replace(/^[a-z]+__/,"").split("_");return(r.length>1?r.slice(1).join(" "):r[0]).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/^./,s=>s.toUpperCase())}o(ET,"extractPropertyLabel")});var hu={};tE(hu,{__assign:()=>Kh,__asyncDelegator:()=>LT,__asyncGenerator:()=>kT,__asyncValues:()=>jT,__await:()=>So,__awaiter:()=>DT,__classPrivateFieldGet:()=>BT,__classPrivateFieldSet:()=>UT,__createBinding:()=>PT,__decorate:()=>xT,__exportStar:()=>FT,__extends:()=>TT,__generator:()=>IT,__importDefault:()=>$T,__importStar:()=>VT,__makeTemplateObject:()=>MT,__metadata:()=>OT,__param:()=>CT,__read:()=>vy,__rest:()=>AT,__spread:()=>RT,__spreadArrays:()=>NT,__values:()=>Qh});function TT(n,e){Hh(n,e);function t(){this.constructor=n}o(t,"__"),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function AT(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function xT(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}function CT(n,e){return function(t,r){e(t,r,n)}}function OT(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function DT(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return o(i,"adopt"),new(t||(t=Promise))(function(s,a){function c(f){try{l(r.next(f))}catch(h){a(h)}}o(c,"fulfilled");function u(f){try{l(r.throw(f))}catch(h){a(h)}}o(u,"rejected");function l(f){f.done?s(f.value):i(f.value).then(c,u)}o(l,"step"),l((r=r.apply(n,e||[])).next())})}function IT(n,e){var t={label:0,sent:o(function(){if(s[0]&1)throw s[1];return s[1]},"sent"),trys:[],ops:[]},r,i,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(f){return u([l,f])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(f){l=[6,f],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function PT(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}function FT(n,e){for(var t in n)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=n[t])}function Qh(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:o(function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}},"next")};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function vy(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(c){a={error:c}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s}function RT(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(vy(arguments[e]));return n}function NT(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,i++)r[i]=s[a];return r}function So(n){return this instanceof So?(this.v=n,this):new So(n)}function kT(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,s=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(d){r[d]&&(i[d]=function(m){return new Promise(function(_,b){s.push([d,m,_,b])>1||c(d,m)})})}function c(d,m){try{u(r[d](m))}catch(_){h(s[0][3],_)}}function u(d){d.value instanceof So?Promise.resolve(d.value.v).then(l,f):h(s[0][2],d)}function l(d){c("next",d)}function f(d){c("throw",d)}function h(d,m){d(m),s.shift(),s.length&&c(s[0][0],s[0][1])}}function LT(n){var e,t;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=n[i]?function(a){return(t=!t)?{value:So(n[i](a)),done:i==="return"}:s?s(a):a}:s}}function jT(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Qh=="function"?Qh(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(a){return new Promise(function(c,u){a=n[s](a),i(c,u,a.done,a.value)})}}function i(s,a,c,u){Promise.resolve(u).then(function(l){s({value:l,done:c})},a)}}function MT(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function VT(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)Object.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e.default=n,e}function $T(n){return n&&n.__esModule?n:{default:n}}function BT(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function UT(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t}var Hh,Kh,du=eE(()=>{Hh=o(function(n,e){return Hh=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Hh(n,e)},"extendStatics");o(TT,"__extends");Kh=o(function(){return Kh=Object.assign||o(function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},"__assign"),Kh.apply(this,arguments)},"__assign");o(AT,"__rest");o(xT,"__decorate");o(CT,"__param");o(OT,"__metadata");o(DT,"__awaiter");o(IT,"__generator");o(PT,"__createBinding");o(FT,"__exportStar");o(Qh,"__values");o(vy,"__read");o(RT,"__spread");o(NT,"__spreadArrays");o(So,"__await");o(kT,"__asyncGenerator");o(LT,"__asyncDelegator");o(jT,"__asyncValues");o(MT,"__makeTemplateObject");o(VT,"__importStar");o($T,"__importDefault");o(BT,"__classPrivateFieldGet");o(UT,"__classPrivateFieldSet")});var Jh=v(Xh=>{"use strict";Object.defineProperty(Xh,"__esModule",{value:!0});var Yh;(function(n){n[n.Transient=0]="Transient",n[n.Singleton=1]="Singleton",n[n.ResolutionScoped=2]="ResolutionScoped",n[n.ContainerScoped=3]="ContainerScoped"})(Yh||(Yh={}));Xh.default=Yh});var wy=v(Zh=>{"use strict";Object.defineProperty(Zh,"__esModule",{value:!0});var qT=Jh();Object.defineProperty(Zh,"Lifecycle",{enumerable:!0,get:o(function(){return qT.default},"get")})});var us=v(Wr=>{"use strict";Object.defineProperty(Wr,"__esModule",{value:!0});Wr.defineInjectionTokenMetadata=Wr.getParamInfo=Wr.INJECTION_TOKEN_METADATA_KEY=void 0;Wr.INJECTION_TOKEN_METADATA_KEY="injectionTokens";function GT(n){let e=Reflect.getMetadata("design:paramtypes",n)||[],t=Reflect.getOwnMetadata(Wr.INJECTION_TOKEN_METADATA_KEY,n)||{};return Object.keys(t).forEach(r=>{e[+r]=t[r]}),e}o(GT,"getParamInfo");Wr.getParamInfo=GT;function WT(n,e){return function(t,r,i){let s=Reflect.getOwnMetadata(Wr.INJECTION_TOKEN_METADATA_KEY,t)||{};s[i]=e?{token:n,transform:e.transformToken,transformArgs:e.args||[]}:n,Reflect.defineMetadata(Wr.INJECTION_TOKEN_METADATA_KEY,s,t)}}o(WT,"defineInjectionTokenMetadata");Wr.defineInjectionTokenMetadata=WT});var ed=v(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.isClassProvider=void 0;function zT(n){return!!n.useClass}o(zT,"isClassProvider");pu.isClassProvider=zT});var td=v(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});mu.isFactoryProvider=void 0;function HT(n){return!!n.useFactory}o(HT,"isFactoryProvider");mu.isFactoryProvider=HT});var yu=v(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.delay=Zs.DelayedConstructor=void 0;var gu=class{static{o(this,"DelayedConstructor")}constructor(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}createProxy(e){let t={},r=!1,i,s=o(()=>(r||(i=e(this.wrap()),r=!0),i),"delayedObject");return new Proxy(t,this.createHandler(s))}createHandler(e){let t={},r=o(i=>{t[i]=(...s)=>{s[0]=e();let a=Reflect[i];return a(...s)}},"install");return this.reflectMethods.forEach(r),t}};Zs.DelayedConstructor=gu;function KT(n){if(typeof n>"u")throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new gu(n)}o(KT,"delay");Zs.delay=KT});var vu=v(In=>{"use strict";Object.defineProperty(In,"__esModule",{value:!0});In.isConstructorToken=In.isTransformDescriptor=In.isTokenDescriptor=In.isNormalToken=void 0;var QT=yu();function YT(n){return typeof n=="string"||typeof n=="symbol"}o(YT,"isNormalToken");In.isNormalToken=YT;function XT(n){return typeof n=="object"&&"token"in n&&"multiple"in n}o(XT,"isTokenDescriptor");In.isTokenDescriptor=XT;function JT(n){return typeof n=="object"&&"token"in n&&"transform"in n}o(JT,"isTransformDescriptor");In.isTransformDescriptor=JT;function ZT(n){return typeof n=="function"||n instanceof QT.DelayedConstructor}o(ZT,"isConstructorToken");In.isConstructorToken=ZT});var rd=v(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});wu.isTokenProvider=void 0;function eA(n){return!!n.useToken}o(eA,"isTokenProvider");wu.isTokenProvider=eA});var nd=v(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.isValueProvider=void 0;function tA(n){return n.useValue!=null}o(tA,"isValueProvider");_u.isValueProvider=tA});var id=v(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});var rA=ed();Object.defineProperty(ls,"isClassProvider",{enumerable:!0,get:o(function(){return rA.isClassProvider},"get")});var nA=td();Object.defineProperty(ls,"isFactoryProvider",{enumerable:!0,get:o(function(){return nA.isFactoryProvider},"get")});var iA=vu();Object.defineProperty(ls,"isNormalToken",{enumerable:!0,get:o(function(){return iA.isNormalToken},"get")});var sA=rd();Object.defineProperty(ls,"isTokenProvider",{enumerable:!0,get:o(function(){return sA.isTokenProvider},"get")});var aA=nd();Object.defineProperty(ls,"isValueProvider",{enumerable:!0,get:o(function(){return aA.isValueProvider},"get")})});var _y=v(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.isProvider=void 0;var oA=ed(),cA=nd(),uA=rd(),lA=td();function fA(n){return oA.isClassProvider(n)||cA.isValueProvider(n)||uA.isTokenProvider(n)||lA.isFactoryProvider(n)}o(fA,"isProvider");bu.isProvider=fA});var od=v(ad=>{"use strict";Object.defineProperty(ad,"__esModule",{value:!0});var sd=class{static{o(this,"RegistryBase")}constructor(){this._registryMap=new Map}entries(){return this._registryMap.entries()}getAll(e){return this.ensure(e),this._registryMap.get(e)}get(e){this.ensure(e);let t=this._registryMap.get(e);return t[t.length-1]||null}set(e,t){this.ensure(e),this._registryMap.get(e).push(t)}setAll(e,t){this._registryMap.set(e,t)}has(e){return this.ensure(e),this._registryMap.get(e).length>0}clear(){this._registryMap.clear()}ensure(e){this._registryMap.has(e)||this._registryMap.set(e,[])}};ad.default=sd});var by=v(ud=>{"use strict";Object.defineProperty(ud,"__esModule",{value:!0});var hA=od(),cd=class extends hA.default{static{o(this,"Registry")}};ud.default=cd});var Sy=v(fd=>{"use strict";Object.defineProperty(fd,"__esModule",{value:!0});var ld=class{static{o(this,"ResolutionContext")}constructor(){this.scopedResolutions=new Map}};fd.default=ld});var hd=v(Su=>{"use strict";Object.defineProperty(Su,"__esModule",{value:!0});Su.formatErrorCtor=void 0;function dA(n,e){return n===null?`at position #${e}`:`"${n.split(",")[e].trim()}" at position #${e}`}o(dA,"formatDependency");function pA(n,e,t="    "){return[n,...e.message.split(`
`).map(r=>t+r)].join(`
`)}o(pA,"composeErrorMessage");function mA(n,e,t){let[,r=null]=n.toString().match(/constructor\(([\w, ]+)\)/)||[],i=dA(r,e);return pA(`Cannot inject the dependency ${i} of "${n.name}" constructor. Reason:`,t)}o(mA,"formatErrorCtor");Su.formatErrorCtor=mA});var Ey=v(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.isDisposable=void 0;function gA(n){return!(typeof n.dispose!="function"||n.dispose.length>0)}o(gA,"isDisposable");Eu.isDisposable=gA});var Ay=v(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.PostResolutionInterceptors=fs.PreResolutionInterceptors=void 0;var Ty=od(),Tu=class extends Ty.default{static{o(this,"PreResolutionInterceptors")}};fs.PreResolutionInterceptors=Tu;var Au=class extends Ty.default{static{o(this,"PostResolutionInterceptors")}};fs.PostResolutionInterceptors=Au;var dd=class{static{o(this,"Interceptors")}constructor(){this.preResolution=new Tu,this.postResolution=new Au}};fs.default=dd});var Ti=v(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.instance=ti.typeInfo=void 0;var yA=(du(),dh(hu)),or=id(),vA=_y(),xu=vu(),wA=by(),Tr=Jh(),Cu=Sy(),_A=hd(),bA=yu(),SA=Ey(),EA=Ay();ti.typeInfo=new Map;var pd=class n{static{o(this,"InternalDependencyContainer")}constructor(e){this.parent=e,this._registry=new wA.default,this.interceptors=new EA.default,this.disposed=!1,this.disposables=new Set}register(e,t,r={lifecycle:Tr.default.Transient}){this.ensureNotDisposed();let i;if(vA.isProvider(t)?i=t:i={useClass:t},or.isTokenProvider(i)){let s=[e],a=i;for(;a!=null;){let c=a.useToken;if(s.includes(c))throw new Error(`Token registration cycle detected! ${[...s,c].join(" -> ")}`);s.push(c);let u=this._registry.get(c);u&&or.isTokenProvider(u.provider)?a=u.provider:a=null}}if((r.lifecycle===Tr.default.Singleton||r.lifecycle==Tr.default.ContainerScoped||r.lifecycle==Tr.default.ResolutionScoped)&&(or.isValueProvider(i)||or.isFactoryProvider(i)))throw new Error(`Cannot use lifecycle "${Tr.default[r.lifecycle]}" with ValueProviders or FactoryProviders`);return this._registry.set(e,{provider:i,options:r}),this}registerType(e,t){return this.ensureNotDisposed(),or.isNormalToken(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})}registerInstance(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})}registerSingleton(e,t){if(this.ensureNotDisposed(),or.isNormalToken(e)){if(or.isNormalToken(t))return this.register(e,{useToken:t},{lifecycle:Tr.default.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:Tr.default.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}let r=e;return t&&!or.isNormalToken(t)&&(r=t),this.register(e,{useClass:r},{lifecycle:Tr.default.Singleton})}resolve(e,t=new Cu.default,r=!1){this.ensureNotDisposed();let i=this.getRegistration(e);if(!i&&or.isNormalToken(e)){if(r)return;throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"Single"),i){let s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(xu.isConstructorToken(e)){let s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")}executePreResolutionInterceptor(e,t){if(this.interceptors.preResolution.has(e)){let r=[];for(let i of this.interceptors.preResolution.getAll(e))i.options.frequency!="Once"&&r.push(i),i.callback(e,t);this.interceptors.preResolution.setAll(e,r)}}executePostResolutionInterceptor(e,t,r){if(this.interceptors.postResolution.has(e)){let i=[];for(let s of this.interceptors.postResolution.getAll(e))s.options.frequency!="Once"&&i.push(s),s.callback(e,t,r);this.interceptors.postResolution.setAll(e,i)}}resolveRegistration(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===Tr.default.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);let r=e.options.lifecycle===Tr.default.Singleton,i=e.options.lifecycle===Tr.default.ContainerScoped,s=r||i,a;return or.isValueProvider(e.provider)?a=e.provider.useValue:or.isTokenProvider(e.provider)?a=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):or.isClassProvider(e.provider)?a=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):or.isFactoryProvider(e.provider)?a=e.provider.useFactory(this):a=this.construct(e.provider,t),e.options.lifecycle===Tr.default.ResolutionScoped&&t.scopedResolutions.set(e,a),a}resolveAll(e,t=new Cu.default,r=!1){this.ensureNotDisposed();let i=this.getAllRegistrations(e);if(!i&&or.isNormalToken(e)){if(r)return[];throw new Error(`Attempted to resolve unregistered dependency token: "${e.toString()}"`)}if(this.executePreResolutionInterceptor(e,"All"),i){let a=i.map(c=>this.resolveRegistration(c,t));return this.executePostResolutionInterceptor(e,a,"All"),a}let s=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,s,"All"),s}isRegistered(e,t=!1){return this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)}reset(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()}clearInstances(){this.ensureNotDisposed();for(let[e,t]of this._registry.entries())this._registry.setAll(e,t.filter(r=>!or.isValueProvider(r.provider)).map(r=>(r.instance=void 0,r)))}createChildContainer(){this.ensureNotDisposed();let e=new n(this);for(let[t,r]of this._registry.entries())r.some(({options:i})=>i.lifecycle===Tr.default.ContainerScoped)&&e._registry.setAll(t,r.map(i=>i.options.lifecycle===Tr.default.ContainerScoped?{provider:i.provider,options:i.options}:i));return e}beforeResolution(e,t,r={frequency:"Always"}){this.interceptors.preResolution.set(e,{callback:t,options:r})}afterResolution(e,t,r={frequency:"Always"}){this.interceptors.postResolution.set(e,{callback:t,options:r})}dispose(){return yA.__awaiter(this,void 0,void 0,function*(){this.disposed=!0;let e=[];this.disposables.forEach(t=>{let r=t.dispose();r&&e.push(r)}),yield Promise.all(e)})}getRegistration(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null}getAllRegistrations(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null}construct(e,t){if(e instanceof bA.DelayedConstructor)return e.createProxy(i=>this.resolve(i,t));let r=(()=>{let i=ti.typeInfo.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error(`TypeInfo not known for "${e.name}"`)}let s=i.map(this.resolveParams(t,e));return new e(...s)})();return SA.isDisposable(r)&&this.disposables.add(r),r}resolveParams(e,t){return(r,i)=>{try{return xu.isTokenDescriptor(r)?xu.isTransformDescriptor(r)?r.multiple?this.resolve(r.transform).transform(this.resolveAll(r.token,new Cu.default,r.isOptional),...r.transformArgs):this.resolve(r.transform).transform(this.resolve(r.token,e,r.isOptional),...r.transformArgs):r.multiple?this.resolveAll(r.token,new Cu.default,r.isOptional):this.resolve(r.token,e,r.isOptional):xu.isTransformDescriptor(r)?this.resolve(r.transform,e).transform(this.resolve(r.token,e),...r.transformArgs):this.resolve(r,e)}catch(s){throw new Error(_A.formatErrorCtor(t,i,s))}}}ensureNotDisposed(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")}};ti.instance=new pd;ti.default=ti.instance});var xy=v(gd=>{"use strict";Object.defineProperty(gd,"__esModule",{value:!0});var TA=us(),ri=Ti(),md=vu(),AA=hd();function xA(){return function(n){let e=TA.getParamInfo(n);return class extends n{constructor(...t){super(...t.concat(e.slice(t.length).map((r,i)=>{try{return md.isTokenDescriptor(r)?md.isTransformDescriptor(r)?r.multiple?ri.instance.resolve(r.transform).transform(ri.instance.resolveAll(r.token),...r.transformArgs):ri.instance.resolve(r.transform).transform(ri.instance.resolve(r.token),...r.transformArgs):r.multiple?ri.instance.resolveAll(r.token):ri.instance.resolve(r.token):md.isTransformDescriptor(r)?ri.instance.resolve(r.transform).transform(ri.instance.resolve(r.token),...r.transformArgs):ri.instance.resolve(r)}catch(s){let a=i+t.length;throw new Error(AA.formatErrorCtor(n,a,s))}})))}}}}o(xA,"autoInjectable");gd.default=xA});var Cy=v(yd=>{"use strict";Object.defineProperty(yd,"__esModule",{value:!0});var CA=us();function OA(n,e){let t={token:n,multiple:!1,isOptional:e&&e.isOptional};return CA.defineInjectionTokenMetadata(t)}o(OA,"inject");yd.default=OA});var Ou=v(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});var DA=us(),IA=Ti(),Oy=Ti();function PA(n){return function(e){IA.typeInfo.set(e,DA.getParamInfo(e)),n&&n.token&&(Array.isArray(n.token)?n.token.forEach(t=>{Oy.instance.register(t,e)}):Oy.instance.register(n.token,e))}}o(PA,"injectable");vd.default=PA});var Dy=v(wd=>{"use strict";Object.defineProperty(wd,"__esModule",{value:!0});var FA=(du(),dh(hu)),RA=Ti();function NA(n=[]){return function(e){return n.forEach(t=>{var{token:r,options:i}=t,s=FA.__rest(t,["token","options"]);return RA.instance.register(r,s,i)}),e}}o(NA,"registry");wd.default=NA});var Iy=v(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});var kA=Ou(),LA=Ti();function jA(){return function(n){kA.default()(n),LA.instance.registerSingleton(n)}}o(jA,"singleton");_d.default=jA});var Py=v(bd=>{"use strict";Object.defineProperty(bd,"__esModule",{value:!0});var MA=us();function VA(n,e){let t={token:n,multiple:!0,isOptional:e&&e.isOptional};return MA.defineInjectionTokenMetadata(t)}o(VA,"injectAll");bd.default=VA});var Fy=v(Sd=>{"use strict";Object.defineProperty(Sd,"__esModule",{value:!0});var $A=us();function BA(n,e,...t){let r={token:n,multiple:!0,transform:e,transformArgs:t};return $A.defineInjectionTokenMetadata(r)}o(BA,"injectAllWithTransform");Sd.default=BA});var Ry=v(Ed=>{"use strict";Object.defineProperty(Ed,"__esModule",{value:!0});var UA=us();function qA(n,e,...t){return UA.defineInjectionTokenMetadata(n,{transformToken:e,args:t})}o(qA,"injectWithTransform");Ed.default=qA});var Ny=v(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});var GA=Ou(),WA=Ti();function zA(n,e){return function(t){GA.default()(t),WA.instance.register(e||t,t,{lifecycle:n})}}o(zA,"scoped");Td.default=zA});var ky=v(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});var HA=xy();Object.defineProperty(zr,"autoInjectable",{enumerable:!0,get:o(function(){return HA.default},"get")});var KA=Cy();Object.defineProperty(zr,"inject",{enumerable:!0,get:o(function(){return KA.default},"get")});var QA=Ou();Object.defineProperty(zr,"injectable",{enumerable:!0,get:o(function(){return QA.default},"get")});var YA=Dy();Object.defineProperty(zr,"registry",{enumerable:!0,get:o(function(){return YA.default},"get")});var XA=Iy();Object.defineProperty(zr,"singleton",{enumerable:!0,get:o(function(){return XA.default},"get")});var JA=Py();Object.defineProperty(zr,"injectAll",{enumerable:!0,get:o(function(){return JA.default},"get")});var ZA=Fy();Object.defineProperty(zr,"injectAllWithTransform",{enumerable:!0,get:o(function(){return ZA.default},"get")});var ex=Ry();Object.defineProperty(zr,"injectWithTransform",{enumerable:!0,get:o(function(){return ex.default},"get")});var tx=Ny();Object.defineProperty(zr,"scoped",{enumerable:!0,get:o(function(){return tx.default},"get")})});var Ly=v(Ad=>{"use strict";Object.defineProperty(Ad,"__esModule",{value:!0});function rx(n){let e;return t=>(e==null&&(e=n(t)),e)}o(rx,"instanceCachingFactory");Ad.default=rx});var jy=v(xd=>{"use strict";Object.defineProperty(xd,"__esModule",{value:!0});function nx(n){let e=new WeakMap;return t=>{let r=e.get(t);return r==null&&(r=n(t),e.set(t,r)),r}}o(nx,"instancePerContainerCachingFactory");xd.default=nx});var My=v(Cd=>{"use strict";Object.defineProperty(Cd,"__esModule",{value:!0});function ix(n,e,t,r=!0){let i,s;return a=>{let c=n(a);return(!r||s!==c)&&((s=c)?i=a.resolve(e):i=a.resolve(t)),i}}o(ix,"predicateAwareClassFactory");Cd.default=ix});var Vy=v(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});var sx=Ly();Object.defineProperty(Eo,"instanceCachingFactory",{enumerable:!0,get:o(function(){return sx.default},"get")});var ax=jy();Object.defineProperty(Eo,"instancePerContainerCachingFactory",{enumerable:!0,get:o(function(){return ax.default},"get")});var ox=My();Object.defineProperty(Eo,"predicateAwareClassFactory",{enumerable:!0,get:o(function(){return ox.default},"get")})});var Je=v(Ai=>{"use strict";Object.defineProperty(Ai,"__esModule",{value:!0});var Od=(du(),dh(hu));if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var cx=wy();Object.defineProperty(Ai,"Lifecycle",{enumerable:!0,get:o(function(){return cx.Lifecycle},"get")});Od.__exportStar(ky(),Ai);Od.__exportStar(Vy(),Ai);Od.__exportStar(id(),Ai);var ux=yu();Object.defineProperty(Ai,"delay",{enumerable:!0,get:o(function(){return ux.delay},"get")});var lx=Ti();Object.defineProperty(Ai,"container",{enumerable:!0,get:o(function(){return lx.instance},"get")})});var $y=v(Dd=>{"use strict";Object.defineProperty(Dd,"__esModule",{value:!0});Dd.default="ffffffff-ffff-ffff-ffff-ffffffffffff"});var By=v(Id=>{"use strict";Object.defineProperty(Id,"__esModule",{value:!0});Id.default="00000000-0000-0000-0000-000000000000"});var Uy=v(Pd=>{"use strict";Object.defineProperty(Pd,"__esModule",{value:!0});Pd.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});var To=v(Fd=>{"use strict";Object.defineProperty(Fd,"__esModule",{value:!0});var fx=Uy();function hx(n){return typeof n=="string"&&fx.default.test(n)}o(hx,"validate");Fd.default=hx});var Ao=v(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});var dx=To();function px(n){if(!(0,dx.default)(n))throw TypeError("Invalid UUID");let e;return Uint8Array.of((e=parseInt(n.slice(0,8),16))>>>24,e>>>16&255,e>>>8&255,e&255,(e=parseInt(n.slice(9,13),16))>>>8,e&255,(e=parseInt(n.slice(14,18),16))>>>8,e&255,(e=parseInt(n.slice(19,23),16))>>>8,e&255,(e=parseInt(n.slice(24,36),16))/1099511627776&255,e/4294967296&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255)}o(px,"parse");Rd.default=px});var ni=v(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.unsafeStringify=void 0;var mx=To(),Lt=[];for(let n=0;n<256;++n)Lt.push((n+256).toString(16).slice(1));function qy(n,e=0){return(Lt[n[e+0]]+Lt[n[e+1]]+Lt[n[e+2]]+Lt[n[e+3]]+"-"+Lt[n[e+4]]+Lt[n[e+5]]+"-"+Lt[n[e+6]]+Lt[n[e+7]]+"-"+Lt[n[e+8]]+Lt[n[e+9]]+"-"+Lt[n[e+10]]+Lt[n[e+11]]+Lt[n[e+12]]+Lt[n[e+13]]+Lt[n[e+14]]+Lt[n[e+15]]).toLowerCase()}o(qy,"unsafeStringify");xo.unsafeStringify=qy;function gx(n,e=0){let t=qy(n,e);if(!(0,mx.default)(t))throw TypeError("Stringified UUID is invalid");return t}o(gx,"stringify");xo.default=gx});var Pu=v(Nd=>{"use strict";Object.defineProperty(Nd,"__esModule",{value:!0});var yx=require("crypto"),Iu=new Uint8Array(256),Du=Iu.length;function vx(){return Du>Iu.length-16&&((0,yx.randomFillSync)(Iu),Du=0),Iu.slice(Du,Du+=16)}o(vx,"rng");Nd.default=vx});var kd=v(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.updateV1State=void 0;var Gy=Pu(),wx=ni(),Co={};function _x(n,e,t){let r,i=n?._v6??!1;if(n){let s=Object.keys(n);s.length===1&&s[0]==="_v6"&&(n=void 0)}if(n)r=Wy(n.random??n.rng?.()??(0,Gy.default)(),n.msecs,n.nsecs,n.clockseq,n.node,e,t);else{let s=Date.now(),a=(0,Gy.default)();zy(Co,s,a),r=Wy(a,Co.msecs,Co.nsecs,i?void 0:Co.clockseq,i?void 0:Co.node,e,t)}return e??(0,wx.unsafeStringify)(r)}o(_x,"v1");function zy(n,e,t){return n.msecs??=-1/0,n.nsecs??=0,e===n.msecs?(n.nsecs++,n.nsecs>=1e4&&(n.node=void 0,n.nsecs=0)):e>n.msecs?n.nsecs=0:e<n.msecs&&(n.node=void 0),n.node||(n.node=t.slice(10,16),n.node[0]|=1,n.clockseq=(t[8]<<8|t[9])&16383),n.msecs=e,n}o(zy,"updateV1State");Oo.updateV1State=zy;function Wy(n,e,t,r,i,s,a=0){if(n.length<16)throw new Error("Random bytes length must be >= 16");if(!s)s=new Uint8Array(16),a=0;else if(a<0||a+16>s.length)throw new RangeError(`UUID byte range ${a}:${a+15} is out of buffer bounds`);e??=Date.now(),t??=0,r??=(n[8]<<8|n[9])&16383,i??=n.slice(10,16),e+=122192928e5;let c=((e&268435455)*1e4+t)%4294967296;s[a++]=c>>>24&255,s[a++]=c>>>16&255,s[a++]=c>>>8&255,s[a++]=c&255;let u=e/4294967296*1e4&268435455;s[a++]=u>>>8&255,s[a++]=u&255,s[a++]=u>>>24&15|16,s[a++]=u>>>16&255,s[a++]=r>>>8|128,s[a++]=r&255;for(let l=0;l<6;++l)s[a++]=i[l];return s}o(Wy,"v1Bytes");Oo.default=_x});var jd=v(Ld=>{"use strict";Object.defineProperty(Ld,"__esModule",{value:!0});var bx=Ao(),Sx=ni();function Ex(n){let e=typeof n=="string"?(0,bx.default)(n):n,t=Tx(e);return typeof n=="string"?(0,Sx.unsafeStringify)(t):t}o(Ex,"v1ToV6");Ld.default=Ex;function Tx(n){return Uint8Array.of((n[6]&15)<<4|n[7]>>4&15,(n[7]&15)<<4|(n[4]&240)>>4,(n[4]&15)<<4|(n[5]&240)>>4,(n[5]&15)<<4|(n[0]&240)>>4,(n[0]&15)<<4|(n[1]&240)>>4,(n[1]&15)<<4|(n[2]&240)>>4,96|n[2]&15,n[3],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}o(Tx,"_v1ToV6")});var Hy=v(Md=>{"use strict";Object.defineProperty(Md,"__esModule",{value:!0});var Ax=require("crypto");function xx(n){return Array.isArray(n)?n=Buffer.from(n):typeof n=="string"&&(n=Buffer.from(n,"utf8")),(0,Ax.createHash)("md5").update(n).digest()}o(xx,"md5");Md.default=xx});var Do=v(ii=>{"use strict";Object.defineProperty(ii,"__esModule",{value:!0});ii.URL=ii.DNS=ii.stringToBytes=void 0;var Ky=Ao(),Cx=ni();function Qy(n){n=unescape(encodeURIComponent(n));let e=new Uint8Array(n.length);for(let t=0;t<n.length;++t)e[t]=n.charCodeAt(t);return e}o(Qy,"stringToBytes");ii.stringToBytes=Qy;ii.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8";ii.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function Ox(n,e,t,r,i,s){let a=typeof t=="string"?Qy(t):t,c=typeof r=="string"?(0,Ky.default)(r):r;if(typeof r=="string"&&(r=(0,Ky.default)(r)),r?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+a.length);if(u.set(c),u.set(a,c.length),u=e(u),u[6]=u[6]&15|n,u[8]=u[8]&63|128,i){s=s||0;for(let l=0;l<16;++l)i[s+l]=u[l];return i}return(0,Cx.unsafeStringify)(u)}o(Ox,"v35");ii.default=Ox});var Xy=v(hs=>{"use strict";Object.defineProperty(hs,"__esModule",{value:!0});hs.URL=hs.DNS=void 0;var Dx=Hy(),Vd=Do(),Yy=Do();Object.defineProperty(hs,"DNS",{enumerable:!0,get:o(function(){return Yy.DNS},"get")});Object.defineProperty(hs,"URL",{enumerable:!0,get:o(function(){return Yy.URL},"get")});function $d(n,e,t,r){return(0,Vd.default)(48,Dx.default,n,e,t,r)}o($d,"v3");$d.DNS=Vd.DNS;$d.URL=Vd.URL;hs.default=$d});var Jy=v(Bd=>{"use strict";Object.defineProperty(Bd,"__esModule",{value:!0});var Ix=require("crypto");Bd.default={randomUUID:Ix.randomUUID}});var e2=v(Ud=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});var Zy=Jy(),Px=Pu(),Fx=ni();function Rx(n,e,t){if(Zy.default.randomUUID&&!e&&!n)return Zy.default.randomUUID();n=n||{};let r=n.random??n.rng?.()??(0,Px.default)();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[t+i]=r[i];return e}return(0,Fx.unsafeStringify)(r)}o(Rx,"v4");Ud.default=Rx});var t2=v(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});var Nx=require("crypto");function kx(n){return Array.isArray(n)?n=Buffer.from(n):typeof n=="string"&&(n=Buffer.from(n,"utf8")),(0,Nx.createHash)("sha1").update(n).digest()}o(kx,"sha1");qd.default=kx});var n2=v(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.URL=ds.DNS=void 0;var Lx=t2(),Gd=Do(),r2=Do();Object.defineProperty(ds,"DNS",{enumerable:!0,get:o(function(){return r2.DNS},"get")});Object.defineProperty(ds,"URL",{enumerable:!0,get:o(function(){return r2.URL},"get")});function Wd(n,e,t,r){return(0,Gd.default)(80,Lx.default,n,e,t,r)}o(Wd,"v5");Wd.DNS=Gd.DNS;Wd.URL=Gd.URL;ds.default=Wd});var i2=v(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});var jx=ni(),Mx=kd(),Vx=jd();function $x(n,e,t){n??={},t??=0;let r=(0,Mx.default)({...n,_v6:!0},new Uint8Array(16));if(r=(0,Vx.default)(r),e){for(let i=0;i<16;i++)e[t+i]=r[i];return e}return(0,jx.unsafeStringify)(r)}o($x,"v6");zd.default=$x});var s2=v(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});var Bx=Ao(),Ux=ni();function qx(n){let e=typeof n=="string"?(0,Bx.default)(n):n,t=Gx(e);return typeof n=="string"?(0,Ux.unsafeStringify)(t):t}o(qx,"v6ToV1");Hd.default=qx;function Gx(n){return Uint8Array.of((n[3]&15)<<4|n[4]>>4&15,(n[4]&15)<<4|(n[5]&240)>>4,(n[5]&15)<<4|n[6]&15,n[7],(n[1]&15)<<4|(n[2]&240)>>4,(n[2]&15)<<4|(n[3]&240)>>4,16|(n[0]&240)>>4,(n[0]&15)<<4|(n[1]&240)>>4,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}o(Gx,"_v6ToV1")});var u2=v(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.updateV7State=void 0;var a2=Pu(),Wx=ni(),Kd={};function zx(n,e,t){let r;if(n)r=o2(n.random??n.rng?.()??(0,a2.default)(),n.msecs,n.seq,e,t);else{let i=Date.now(),s=(0,a2.default)();c2(Kd,i,s),r=o2(s,Kd.msecs,Kd.seq,e,t)}return e??(0,Wx.unsafeStringify)(r)}o(zx,"v7");function c2(n,e,t){return n.msecs??=-1/0,n.seq??=0,e>n.msecs?(n.seq=t[6]<<23|t[7]<<16|t[8]<<8|t[9],n.msecs=e):(n.seq=n.seq+1|0,n.seq===0&&n.msecs++),n}o(c2,"updateV7State");Io.updateV7State=c2;function o2(n,e,t,r,i=0){if(n.length<16)throw new Error("Random bytes length must be >= 16");if(!r)r=new Uint8Array(16),i=0;else if(i<0||i+16>r.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);return e??=Date.now(),t??=n[6]*127<<24|n[7]<<16|n[8]<<8|n[9],r[i++]=e/1099511627776&255,r[i++]=e/4294967296&255,r[i++]=e/16777216&255,r[i++]=e/65536&255,r[i++]=e/256&255,r[i++]=e&255,r[i++]=112|t>>>28&15,r[i++]=t>>>20&255,r[i++]=128|t>>>14&63,r[i++]=t>>>6&255,r[i++]=t<<2&255|n[10]&3,r[i++]=n[11],r[i++]=n[12],r[i++]=n[13],r[i++]=n[14],r[i++]=n[15],r}o(o2,"v7Bytes");Io.default=zx});var l2=v(Qd=>{"use strict";Object.defineProperty(Qd,"__esModule",{value:!0});var Hx=To();function Kx(n){if(!(0,Hx.default)(n))throw TypeError("Invalid UUID");return parseInt(n.slice(14,15),16)}o(Kx,"version");Qd.default=Kx});var Or=v(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.version=We.validate=We.v7=We.v6ToV1=We.v6=We.v5=We.v4=We.v3=We.v1ToV6=We.v1=We.stringify=We.parse=We.NIL=We.MAX=void 0;var Qx=$y();Object.defineProperty(We,"MAX",{enumerable:!0,get:o(function(){return Qx.default},"get")});var Yx=By();Object.defineProperty(We,"NIL",{enumerable:!0,get:o(function(){return Yx.default},"get")});var Xx=Ao();Object.defineProperty(We,"parse",{enumerable:!0,get:o(function(){return Xx.default},"get")});var Jx=ni();Object.defineProperty(We,"stringify",{enumerable:!0,get:o(function(){return Jx.default},"get")});var Zx=kd();Object.defineProperty(We,"v1",{enumerable:!0,get:o(function(){return Zx.default},"get")});var eC=jd();Object.defineProperty(We,"v1ToV6",{enumerable:!0,get:o(function(){return eC.default},"get")});var tC=Xy();Object.defineProperty(We,"v3",{enumerable:!0,get:o(function(){return tC.default},"get")});var rC=e2();Object.defineProperty(We,"v4",{enumerable:!0,get:o(function(){return rC.default},"get")});var nC=n2();Object.defineProperty(We,"v5",{enumerable:!0,get:o(function(){return nC.default},"get")});var iC=i2();Object.defineProperty(We,"v6",{enumerable:!0,get:o(function(){return iC.default},"get")});var sC=s2();Object.defineProperty(We,"v6ToV1",{enumerable:!0,get:o(function(){return sC.default},"get")});var aC=u2();Object.defineProperty(We,"v7",{enumerable:!0,get:o(function(){return aC.default},"get")});var oC=To();Object.defineProperty(We,"validate",{enumerable:!0,get:o(function(){return oC.default},"get")});var cC=l2();Object.defineProperty(We,"version",{enumerable:!0,get:o(function(){return cC.default},"get")})});var Mr=v(Fu=>{"use strict";Object.defineProperty(Fu,"__esModule",{value:!0});Fu.MetadataHelpers=void 0;var Yd=class{static{o(this,"MetadataHelpers")}static findAllReferencingProperties(e,t){let r=[];for(let[i,s]of Object.entries(e))this.containsReference(s,t)&&r.push(i);return r}static findReferencingProperty(e,t){for(let[r,i]of Object.entries(e))if(this.containsReference(i,t))return r}static containsReference(e,t){if(!e)return!1;let r=t.replace(/\.md$/,"");if(typeof e=="string"){let i=/\[\[([^\[\]]+)\]\]/g,s;for(;(s=i.exec(e))!==null;){let c=s[1].split("|")[0].trim();if(c===r||c.endsWith(`/${r}`))return!0}return!1}return Array.isArray(e)?e.some(i=>this.containsReference(i,t)):!1}static isAssetArchived(e){let t=e?.exo__Asset_isArchived;if(t!=null){if(t===!0||t===1)return!0;if(typeof t=="string"){let i=t.toLowerCase().trim();if(i==="true"||i==="yes"||i==="1")return!0}if(typeof t=="boolean")return t}let r=e?.archived;if(r==null)return!1;if(typeof r=="boolean")return r;if(typeof r=="number")return r!==0;if(typeof r=="string"){let i=r.toLowerCase().trim();return i==="true"||i==="yes"||i==="1"}return!1}static getPropertyValue(e,t){return t==="Name"||t==="title"?e.title:t==="created"?e.created:t==="modified"?e.modified:t==="path"?e.path:e.metadata?.[t]}static ensureQuoted(e){return!e||e==='""'?'""':e.startsWith('"')&&e.endsWith('"')?e:`"${e}"`}static buildFileContent(e,t){let r=Object.entries(e).map(([s,a])=>{if(Array.isArray(a)){let c=a.map(u=>`  - ${u}`).join(`
`);return`${s}:
${c}`}return`${s}: ${a}`}).join(`
`),i=t?`
${t}
`:`
`;return`---
${r}
---
${i}`}};Fu.MetadataHelpers=Yd});var cr=v(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});Ru.DateFormatter=void 0;var Xd=class n{static{o(this,"DateFormatter")}static toISOTimestamp(e){return e.toISOString().replace(/\.\d{3}Z$/,"Z")}static toLocalTimestamp(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),c=String(e.getSeconds()).padStart(2,"0");return`${t}-${r}-${i}T${s}:${a}:${c}`}static toDateWikilink(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`"[[${t}-${r}-${i}]]"`}static getTodayWikilink(){return n.toDateWikilink(new Date)}static toDateString(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${i}`}static parseWikilink(e){let r=e.replace(/^["']|["']$/g,"").match(/\[\[(\d{4}-\d{2}-\d{2})\]\]/);return r?r[1]:null}static addDays(e,t){let r=new Date(e);return r.setDate(r.getDate()+t),r}static isSameDay(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}static getTodayStartTimestamp(){let e=new Date;return e.setHours(0,0,0,0),n.toLocalTimestamp(e)}static toTimestampAtStartOfDay(e){let t=e.split("-").map(Number);if(t.length!==3||t.some(isNaN))throw new Error(`Invalid date format: ${e}. Expected YYYY-MM-DD`);let[r,i,s]=t,a=new Date(r,i-1,s,0,0,0,0);if(isNaN(a.getTime()))throw new Error(`Invalid date values: ${e}`);return n.toLocalTimestamp(a)}static normalizeTimestamp(e){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return e;let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`Invalid timestamp format: ${e}`);return n.toISOTimestamp(t)}static isISOTimestamp(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e)}};Ru.DateFormatter=Xd});var Po=v(Nu=>{"use strict";Object.defineProperty(Nu,"__esModule",{value:!0});Nu.MetadataExtractor=void 0;var uC=Mr(),Jd=class{static{o(this,"MetadataExtractor")}constructor(e){this.vault=e}extractMetadata(e){return e?this.vault.getFrontmatter(e)||{}:{}}extractInstanceClass(e){return e.exo__Instance_class||null}extractStatus(e){return e.ems__Effort_status||null}extractIsArchived(e){return uC.MetadataHelpers.isAssetArchived(e)}static extractIsDefinedBy(e){let t=e.exo__Asset_isDefinedBy||'""';return Array.isArray(t)&&(t=t[0]||'""'),t}extractExpectedFolder(e){let t=e.exo__Asset_isDefinedBy;if(!t)return null;let r=Array.isArray(t)?t[0]:t;if(!r||typeof r!="string")return null;let i=r.replace(/["'[\]]/g,"").trim();if(!i)return null;let s=i.split("/");return s.pop(),s.join("/")}extractCommandVisibilityContext(e){let t=this.extractMetadata(e),r=this.extractInstanceClass(t),i=this.extractStatus(t),s=this.extractIsArchived(t),a=e.parent?.path||"",c=this.extractExpectedFolder(t);return{instanceClass:r,currentStatus:i,metadata:t,isArchived:s,currentFolder:a,expectedFolder:c}}extractCache(e){return e?this.vault.getFrontmatter(e):null}};Nu.MetadataExtractor=Jd});var ku=v(ps=>{"use strict";var lC=ps&&ps.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(ps,"__esModule",{value:!0});ps.TaskFrontmatterGenerator=void 0;var fC=Je(),f2=Or(),Zd=cr(),hC=ss(),h2=Po(),d2=Mr(),pt=zt(),dC=_i(),pC={[pt.AssetClass.AREA]:"ems__Effort_area",[pt.AssetClass.PROJECT]:"ems__Effort_parent",[pt.AssetClass.TASK_PROTOTYPE]:"exo__Asset_prototype",[pt.AssetClass.MEETING_PROTOTYPE]:"exo__Asset_prototype",[pt.AssetClass.EVENT_PROTOTYPE]:"exo__Asset_prototype",[pt.AssetClass.PROJECT_PROTOTYPE]:"exo__Asset_prototype"},mC={[pt.AssetClass.AREA]:pt.AssetClass.TASK,[pt.AssetClass.PROJECT]:pt.AssetClass.TASK,[pt.AssetClass.TASK_PROTOTYPE]:pt.AssetClass.TASK,[pt.AssetClass.MEETING_PROTOTYPE]:pt.AssetClass.MEETING,[pt.AssetClass.EVENT_PROTOTYPE]:pt.AssetClass.EVENT,[pt.AssetClass.PROJECT_PROTOTYPE]:pt.AssetClass.PROJECT},ep=class{static{o(this,"TaskFrontmatterGenerator")}generateTaskFrontmatter(e,t,r,i,s,a,c){let u=new Date,l=Zd.DateFormatter.toLocalTimestamp(u),f=h2.MetadataExtractor.extractIsDefinedBy(e),h=hC.WikiLinkHelpers.normalize(r),d=pC[h],m=mC[h]||pt.AssetClass.TASK,_={};_.exo__Asset_isDefinedBy=d2.MetadataHelpers.ensureQuoted(f),_.exo__Asset_uid=s||(0,f2.v4)(),_.exo__Asset_createdAt=l,_.exo__Instance_class=[`"[[${m}]]"`],_.ems__Effort_status='"[[ems__EffortStatusDraft]]"',d?_[d]=`"[[${t}]]"`:(0,dC.isPrototypeClass)(r,e)&&(_.exo__Asset_prototype=`"[[${t}]]"`);let b=i;if(m===pt.AssetClass.MEETING&&(!i||i.trim()==="")){let C=e.exo__Asset_label||t,O=Zd.DateFormatter.toDateString(u);b=`${C} ${O}`}if(b&&b.trim()!==""){let C=b.trim();_.exo__Asset_label=C,_.aliases=[C]}return a&&(_.ems__Task_size=a),c&&(_.ems__Effort_plannedStartTimestamp=c),_}generateRelatedTaskFrontmatter(e,t,r,i,s){let a=new Date,c=Zd.DateFormatter.toLocalTimestamp(a),u=h2.MetadataExtractor.extractIsDefinedBy(e),l={};if(l.exo__Asset_isDefinedBy=d2.MetadataHelpers.ensureQuoted(u),l.exo__Asset_uid=i||(0,f2.v4)(),l.exo__Asset_createdAt=c,l.exo__Instance_class=[`"[[${pt.AssetClass.TASK}]]"`],l.ems__Effort_status='"[[ems__EffortStatusDraft]]"',l.exo__Asset_relates=[`"[[${t}]]"`],r&&r.trim()!==""){let f=r.trim();l.exo__Asset_label=f,l.aliases=[f]}return s&&(l.ems__Task_size=s),l}};ps.TaskFrontmatterGenerator=ep;ps.TaskFrontmatterGenerator=ep=lC([(0,fC.injectable)()],ep)});var Lu=v(ms=>{"use strict";var gC=ms&&ms.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(ms,"__esModule",{value:!0});ms.AlgorithmExtractor=void 0;var yC=Je(),tp=class{static{o(this,"AlgorithmExtractor")}extractH2Section(e,t){let r=e.split(`
`),i=`## ${t}`,s=!1,a=[];for(let u of r){if(u.trim()===i){s=!0;continue}if(s){if(u.startsWith("## ")||u.startsWith("# "))break;a.push(u)}}return a.length===0?null:a.join(`
`).trim()||null}};ms.AlgorithmExtractor=tp;ms.AlgorithmExtractor=tp=gC([(0,yC.injectable)()],tp)});var m2=v(p2=>{"use strict";Object.defineProperty(p2,"__esModule",{value:!0})});var at=v(ju=>{"use strict";Object.defineProperty(ju,"__esModule",{value:!0});ju.DI_TOKENS=void 0;ju.DI_TOKENS={IFileSystemAdapter:Symbol.for("IFileSystemAdapter"),IVaultAdapter:Symbol.for("IVaultAdapter"),IVaultContext:Symbol.for("IVaultContext"),IMultiVaultManager:Symbol.for("IMultiVaultManager"),ILogger:Symbol.for("ILogger"),IEventBus:Symbol.for("IEventBus"),IConfiguration:Symbol.for("IConfiguration"),INotificationService:Symbol.for("INotificationService"),TaskCreationService:Symbol.for("TaskCreationService"),ProjectCreationService:Symbol.for("ProjectCreationService"),AreaCreationService:Symbol.for("AreaCreationService"),ClassCreationService:Symbol.for("ClassCreationService"),ConceptCreationService:Symbol.for("ConceptCreationService"),FleetingNoteCreationService:Symbol.for("FleetingNoteCreationService"),SupervisionCreationService:Symbol.for("SupervisionCreationService"),GenericAssetCreationService:Symbol.for("GenericAssetCreationService"),TaskFrontmatterGenerator:Symbol.for("TaskFrontmatterGenerator"),DynamicFrontmatterGenerator:Symbol.for("DynamicFrontmatterGenerator"),AlgorithmExtractor:Symbol.for("AlgorithmExtractor"),TaskStatusService:Symbol.for("TaskStatusService"),EffortStatusWorkflow:Symbol.for("EffortStatusWorkflow"),StatusTimestampService:Symbol.for("StatusTimestampService"),PropertyCleanupService:Symbol.for("PropertyCleanupService"),FolderRepairService:Symbol.for("FolderRepairService"),LabelToAliasService:Symbol.for("LabelToAliasService"),RenameToUidService:Symbol.for("RenameToUidService"),PlanningService:Symbol.for("PlanningService"),EffortVotingService:Symbol.for("EffortVotingService"),SessionEventService:Symbol.for("SessionEventService"),AssetConversionService:Symbol.for("AssetConversionService"),NoteToRDFConverter:Symbol.for("NoteToRDFConverter"),AreaHierarchyBuilder:Symbol.for("AreaHierarchyBuilder"),URIConstructionService:Symbol.for("URIConstructionService")}});var np=v(jt=>{"use strict";var vC=jt&&jt.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),wC=jt&&jt.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),_C=jt&&jt.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},bC=jt&&jt.__importStar||(function(){var n=o(function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)},"ownKeys");return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&vC(t,e,r[i]);return wC(t,e),t}})(),SC=jt&&jt.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},EC=jt&&jt.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(jt,"__esModule",{value:!0});jt.TaskCreationService=void 0;var g2=Je(),y2=Or(),TC=ss(),v2=Mr(),AC=zt(),xC=ku(),CC=Lu(),NL=bC(m2()),OC=at(),rp=class{static{o(this,"TaskCreationService")}constructor(e,t,r){this.vault=e,this.frontmatterGenerator=t,this.algorithmExtractor=r}async createTask(e,t,r,i,s,a){let c=(0,y2.v4)(),u=`${c}.md`,l=this.frontmatterGenerator.generateTaskFrontmatter(t,e.basename,r,i,c,s,a),f="";if(TC.WikiLinkHelpers.normalize(r)===AC.AssetClass.TASK_PROTOTYPE){let C=await this.vault.read(e),O=this.algorithmExtractor.extractH2Section(C,"Algorithm");O&&(f=`## Algorithm

${O}`)}let d=v2.MetadataHelpers.buildFileContent(l,f),m=e.parent?.path||"",_=m?`${m}/${u}`:u;return await this.vault.create(_,d)}async createRelatedTask(e,t,r,i){let s=(0,y2.v4)(),a=`${s}.md`,c=this.frontmatterGenerator.generateRelatedTaskFrontmatter(t,e.basename,r,s,i),u=v2.MetadataHelpers.buildFileContent(c),l=e.parent?.path||"",f=l?`${l}/${a}`:a,h=await this.vault.create(f,u);return await this.addRelationToSourceFile(e,s),h}generateTaskFrontmatter(e,t,r,i,s,a,c){return this.frontmatterGenerator.generateTaskFrontmatter(e,t,r,i,s,a,c)}generateRelatedTaskFrontmatter(e,t,r,i,s){return this.frontmatterGenerator.generateRelatedTaskFrontmatter(e,t,r,i,s)}extractH2Section(e,t){return this.algorithmExtractor.extractH2Section(e,t)}async addRelationToSourceFile(e,t){let r=await this.vault.read(e),i=this.addRelationToFrontmatter(r,t);await this.vault.modify(e,i)}addRelationToFrontmatter(e,t){let r=/^---\r?\n([\s\S]*?)\r?\n---/,i=e.match(r),s=e.includes(`\r
`)?`\r
`:`
`;if(!i)return`---${s}exo__Asset_relates:${s}  - "[[${t}]]"${s}---${s}${e}`;let c=i[1];if(c.includes("exo__Asset_relates:")){let u=c.match(/exo__Asset_relates:\r?\n((?: {2}- .*\r?\n)*)/);if(u){let l=u[1],f=`  - "[[${t}]]"${s}`;c=c.replace(/exo__Asset_relates:\r?\n((?: {2}- .*\r?\n)*)/,`exo__Asset_relates:${s}${l}${f}`)}}else c+=`${s}exo__Asset_relates:${s}  - "[[${t}]]"`;return e.replace(r,`---${s}${c}${s}---`)}};jt.TaskCreationService=rp;jt.TaskCreationService=rp=_C([(0,g2.injectable)(),EC(0,(0,g2.inject)(OC.DI_TOKENS.IVaultAdapter)),SC("design:paramtypes",[Object,xC.TaskFrontmatterGenerator,CC.AlgorithmExtractor])],rp)});var sp=v(Hr=>{"use strict";var DC=Hr&&Hr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},IC=Hr&&Hr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},PC=Hr&&Hr.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Hr,"__esModule",{value:!0});Hr.ProjectCreationService=void 0;var w2=Je(),_2=Or(),FC=ss(),Mu=zt(),RC=cr(),NC=Po(),b2=Mr(),kC=at(),LC={[Mu.AssetClass.AREA]:"ems__Effort_area",[Mu.AssetClass.INITIATIVE]:"ems__Effort_parent",[Mu.AssetClass.PROJECT]:"ems__Effort_parent"},ip=class{static{o(this,"ProjectCreationService")}constructor(e){this.vault=e}async createProject(e,t,r,i){let s=(0,_2.v4)(),a=`${s}.md`,c=this.generateProjectFrontmatter(t,e.basename,r,i,s),u=b2.MetadataHelpers.buildFileContent(c),l=e.parent?.path||"",f=l?`${l}/${a}`:a;return await this.vault.create(f,u)}generateProjectFrontmatter(e,t,r,i,s){let a=new Date,c=RC.DateFormatter.toLocalTimestamp(a),u=NC.MetadataExtractor.extractIsDefinedBy(e),l=FC.WikiLinkHelpers.normalize(r),f=LC[l]||"ems__Effort_area",h={};if(h.exo__Asset_isDefinedBy=b2.MetadataHelpers.ensureQuoted(u),h.exo__Asset_uid=s||(0,_2.v4)(),h.exo__Asset_createdAt=c,h.exo__Instance_class=[`"[[${Mu.AssetClass.PROJECT}]]"`],h.ems__Effort_status='"[[ems__EffortStatusDraft]]"',h[f]=`"[[${t}]]"`,i&&i.trim()!==""){let d=i.trim();h.exo__Asset_label=d,h.aliases=[d]}return h}};Hr.ProjectCreationService=ip;Hr.ProjectCreationService=ip=DC([(0,w2.injectable)(),PC(0,(0,w2.inject)(kC.DI_TOKENS.IVaultAdapter)),IC("design:paramtypes",[Object])],ip)});var ea=v($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});$u.FrontmatterService=void 0;var Vu=class n{static{o(this,"FrontmatterService")}parse(e){let t=e.match(n.FRONTMATTER_REGEX);return t?{exists:!0,content:t[1],originalContent:e}:{exists:!1,content:"",originalContent:e}}updateProperty(e,t,r){let i=this.parse(e);if(!i.exists)return this.createFrontmatter(e,{[t]:r});let s=i.content;if(this.hasProperty(s,t)){let a=new RegExp(`${this.escapeRegex(t)}:.*$`,"m");s=s.replace(a,`${t}: ${r}`)}else{let a=s.length>0?`
`:"";s+=`${a}${t}: ${r}`}return e.replace(n.FRONTMATTER_REGEX,`---
${s}
---`)}addProperty(e,t,r){return this.updateProperty(e,t,r)}removeProperty(e,t){let r=this.parse(e);if(!r.exists||!this.hasProperty(r.content,t))return e;let i=new RegExp(`
?${this.escapeRegex(t)}:.*(?:
 {2}- .*)*`,"gm"),s=r.content.replace(i,"");return e.replace(n.FRONTMATTER_REGEX,`---
${s}
---`)}hasProperty(e,t){return e.includes(`${t}:`)}createFrontmatter(e,t){let i=`---
${Object.entries(t).map(([a,c])=>`${a}: ${c}`).join(`
`)}
---`,s=e.startsWith(`
`)?"":`
`;return`${i}${s}${e}`}getPropertyValue(e,t){let r=new RegExp(`${this.escapeRegex(t)}:\\s*(.*)$`,"m"),i=e.match(r);return i?i[1].trim():null}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};$u.FrontmatterService=Vu;Vu.FRONTMATTER_REGEX=/^---\n([\s\S]*?)\n---/});var Bu=v(gs=>{"use strict";var jC=gs&&gs.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(gs,"__esModule",{value:!0});gs.EffortStatusWorkflow=void 0;var MC=Je(),Dr=zt(),ap=class{static{o(this,"EffortStatusWorkflow")}getPreviousStatus(e,t){let r=this.normalizeStatus(e);if(r===Dr.EffortStatus.DRAFT)return null;if(r===Dr.EffortStatus.BACKLOG)return this.wrapStatus(Dr.EffortStatus.DRAFT);if(r===Dr.EffortStatus.ANALYSIS)return this.wrapStatus(Dr.EffortStatus.BACKLOG);if(r===Dr.EffortStatus.TODO)return this.wrapStatus(Dr.EffortStatus.ANALYSIS);if(r===Dr.EffortStatus.DOING)return this.hasInstanceClass(t,Dr.AssetClass.PROJECT)?this.wrapStatus(Dr.EffortStatus.TODO):this.wrapStatus(Dr.EffortStatus.BACKLOG);if(r===Dr.EffortStatus.DONE)return this.wrapStatus(Dr.EffortStatus.DOING)}normalizeStatus(e){return e.replace(/["'[\]]/g,"").trim()}wrapStatus(e){return`"[[${e}]]"`}hasInstanceClass(e,t){return e?(Array.isArray(e)?e:[e]).some(i=>i.replace(/["'[\]]/g,"").trim()===t):!1}};gs.EffortStatusWorkflow=ap;gs.EffortStatusWorkflow=ap=jC([(0,MC.injectable)()],ap)});var Uu=v(Kr=>{"use strict";var VC=Kr&&Kr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},$C=Kr&&Kr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},BC=Kr&&Kr.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Kr,"__esModule",{value:!0});Kr.StatusTimestampService=void 0;var S2=Je(),UC=ea(),Fo=cr(),qC=at(),op=class{static{o(this,"StatusTimestampService")}constructor(e){this.vault=e,this.frontmatterService=new UC.FrontmatterService}async addStartTimestamp(e){let t=await this.vault.read(e),r=Fo.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_startTimestamp",r);await this.vault.modify(e,i)}async addEndTimestamp(e,t){let r=await this.vault.read(e),i=t||new Date,s=Fo.DateFormatter.toLocalTimestamp(i),a=this.frontmatterService.updateProperty(r,"ems__Effort_endTimestamp",s);await this.vault.modify(e,a)}async addResolutionTimestamp(e){let t=await this.vault.read(e),r=Fo.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_resolutionTimestamp",r);await this.vault.modify(e,i)}async addEndAndResolutionTimestamps(e,t){let r=await this.vault.read(e),i=t||new Date,s=Fo.DateFormatter.toLocalTimestamp(i),a=this.frontmatterService.updateProperty(r,"ems__Effort_endTimestamp",s);a=this.frontmatterService.updateProperty(a,"ems__Effort_resolutionTimestamp",s),await this.vault.modify(e,a)}async removeStartTimestamp(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_startTimestamp");await this.vault.modify(e,r)}async removeEndTimestamp(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_endTimestamp");await this.vault.modify(e,r)}async removeResolutionTimestamp(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_resolutionTimestamp");await this.vault.modify(e,r)}async removeEndAndResolutionTimestamps(e){let t=await this.vault.read(e),r=this.frontmatterService.removeProperty(t,"ems__Effort_endTimestamp");r=this.frontmatterService.removeProperty(r,"ems__Effort_resolutionTimestamp"),await this.vault.modify(e,r)}async shiftPlannedEndTimestamp(e,t){let r=await this.vault.read(e),i=this.frontmatterService.parse(r);if(!i.exists)return;let s=this.frontmatterService.getPropertyValue(i.content,"ems__Effort_plannedEndTimestamp");if(!s)return;let a=new Date(s.replace(/["']/g,""));if(isNaN(a.getTime()))return;let c=new Date(a.getTime()+t),u=Fo.DateFormatter.toLocalTimestamp(c),l=this.frontmatterService.updateProperty(r,"ems__Effort_plannedEndTimestamp",u);await this.vault.modify(e,l)}};Kr.StatusTimestampService=op;Kr.StatusTimestampService=op=VC([(0,S2.injectable)(),BC(0,(0,S2.inject)(qC.DI_TOKENS.IVaultAdapter)),$C("design:paramtypes",[Object])],op)});var up=v(Qr=>{"use strict";var GC=Qr&&Qr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},WC=Qr&&Qr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},zC=Qr&&Qr.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.TaskStatusService=void 0;var E2=Je(),HC=ea(),ys=cr(),KC=Bu(),QC=Uu(),YC=at(),cp=class{static{o(this,"TaskStatusService")}constructor(e,t,r){this.vault=e,this.workflow=t,this.timestampService=r,this.frontmatterService=new HC.FrontmatterService}async setDraftStatus(e){await this.updateStatus(e,"ems__EffortStatusDraft")}async moveToBacklog(e){await this.updateStatus(e,"ems__EffortStatusBacklog")}async moveToAnalysis(e){await this.updateStatus(e,"ems__EffortStatusAnalysis")}async moveToToDo(e){await this.updateStatus(e,"ems__EffortStatusToDo")}async startEffort(e){let t=await this.vault.read(e),r=ys.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_status",'"[[ems__EffortStatusDoing]]"');i=this.frontmatterService.updateProperty(i,"ems__Effort_startTimestamp",r),await this.vault.modify(e,i)}async markTaskAsDone(e){let t=await this.vault.read(e),r=ys.DateFormatter.toLocalTimestamp(new Date),i=this.frontmatterService.updateProperty(t,"ems__Effort_status",'"[[ems__EffortStatusDone]]"');i=this.frontmatterService.updateProperty(i,"ems__Effort_endTimestamp",r),i=this.frontmatterService.updateProperty(i,"ems__Effort_resolutionTimestamp",r),await this.vault.modify(e,i)}async syncEffortEndTimestamp(e,t){await this.timestampService.addEndAndResolutionTimestamps(e,t)}async shiftPlannedEndTimestamp(e,t){await this.timestampService.shiftPlannedEndTimestamp(e,t)}async trashEffort(e,t){let r=await this.vault.read(e),i=ys.DateFormatter.toLocalTimestamp(new Date),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusTrashed]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),t&&(s=this.appendTrashReason(s,t)),await this.vault.modify(e,s)}appendTrashReason(e,t){let r=`

## Trash Reason

${t}`;return e.trimEnd()+r}async archiveTask(e){let t=await this.vault.read(e),r=this.frontmatterService.updateProperty(t,"archived","true");r=this.frontmatterService.removeProperty(r,"aliases"),await this.vault.modify(e,r)}async planOnToday(e){let t=await this.vault.read(e),r=ys.DateFormatter.getTodayStartTimestamp(),i=this.frontmatterService.updateProperty(t,"ems__Effort_plannedStartTimestamp",r);await this.vault.modify(e,i)}async planForEvening(e){let t=await this.vault.read(e),r=new Date;r.setHours(19,0,0,0);let i=ys.DateFormatter.toLocalTimestamp(r),s=this.frontmatterService.updateProperty(t,"ems__Effort_plannedStartTimestamp",i);await this.vault.modify(e,s)}async shiftDayBackward(e){await this.shiftDay(e,-1)}async shiftDayForward(e){await this.shiftDay(e,1)}async rollbackStatus(e){let t=await this.vault.read(e),r=this.extractCurrentStatus(t),i=this.extractInstanceClass(t);if(!r)throw new Error("No current status to rollback from");let s=this.workflow.getPreviousStatus(r,i);if(s===void 0)throw new Error("Cannot rollback from current status");let a=t;s===null?a=this.frontmatterService.removeProperty(a,"ems__Effort_status"):a=this.frontmatterService.updateProperty(a,"ems__Effort_status",s);let c=this.workflow.normalizeStatus(r);c==="ems__EffortStatusDone"?(a=this.frontmatterService.removeProperty(a,"ems__Effort_endTimestamp"),a=this.frontmatterService.removeProperty(a,"ems__Effort_resolutionTimestamp")):c==="ems__EffortStatusDoing"&&(a=this.frontmatterService.removeProperty(a,"ems__Effort_startTimestamp")),await this.vault.modify(e,a)}async updateStatus(e,t){let r=await this.vault.read(e),i=this.frontmatterService.updateProperty(r,"ems__Effort_status",`"[[${t}]]"`);await this.vault.modify(e,i)}async shiftDay(e,t){let r=await this.vault.read(e),i=this.extractPlannedStartTimestamp(r);if(!i)throw new Error("ems__Effort_plannedStartTimestamp property not found");let s=this.parseDateFromTimestamp(i);if(!s)throw new Error("Invalid date format in ems__Effort_plannedStartTimestamp");let a=ys.DateFormatter.addDays(s,t);a.setHours(0,0,0,0);let c=ys.DateFormatter.toLocalTimestamp(a),u=this.frontmatterService.updateProperty(r,"ems__Effort_plannedStartTimestamp",c);await this.vault.modify(e,u)}parseDateFromTimestamp(e){let t=new Date(e);return isNaN(t.getTime())?null:t}extractPlannedStartTimestamp(e){let t=this.frontmatterService.parse(e);return t.exists?this.frontmatterService.getPropertyValue(t.content,"ems__Effort_plannedStartTimestamp"):null}extractCurrentStatus(e){let t=this.frontmatterService.parse(e);return t.exists?this.frontmatterService.getPropertyValue(t.content,"ems__Effort_status"):null}extractInstanceClass(e){let t=this.frontmatterService.parse(e);if(!t.exists)return null;let r=t.content.match(/exo__Instance_class:\s*\n((?:\s*-\s*.*\n?)+)/);return r?r[1].split(`
`).filter(s=>s.trim()).map(s=>s.replace(/^\s*-\s*/,"").trim()):this.frontmatterService.getPropertyValue(t.content,"exo__Instance_class")}};Qr.TaskStatusService=cp;Qr.TaskStatusService=cp=GC([(0,E2.injectable)(),zC(0,(0,E2.inject)(YC.DI_TOKENS.IVaultAdapter)),WC("design:paramtypes",[Object,KC.EffortStatusWorkflow,QC.StatusTimestampService])],cp)});var fp=v(Yr=>{"use strict";var XC=Yr&&Yr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},JC=Yr&&Yr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},ZC=Yr&&Yr.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Yr,"__esModule",{value:!0});Yr.AreaCreationService=void 0;var T2=Je(),A2=Or(),eO=zt(),tO=cr(),rO=Po(),x2=Mr(),nO=at(),lp=class{static{o(this,"AreaCreationService")}constructor(e){this.vault=e}async createChildArea(e,t,r){let i=(0,A2.v4)(),s=`${i}.md`,a=this.generateChildAreaFrontmatter(t,e.basename,r,i),c=x2.MetadataHelpers.buildFileContent(a),u=e.parent?.path||"",l=u?`${u}/${s}`:s;return await this.vault.create(l,c)}generateChildAreaFrontmatter(e,t,r,i){let s=new Date,a=tO.DateFormatter.toLocalTimestamp(s),c=rO.MetadataExtractor.extractIsDefinedBy(e),u={};if(u.exo__Asset_isDefinedBy=x2.MetadataHelpers.ensureQuoted(c),u.exo__Asset_uid=i||(0,A2.v4)(),u.exo__Asset_createdAt=a,u.exo__Instance_class=[`"[[${eO.AssetClass.AREA}]]"`],u.ems__Area_parent=`"[[${t}]]"`,r&&r.trim()!==""){let l=r.trim();u.exo__Asset_label=l,u.aliases=[l]}return u}};Yr.AreaCreationService=lp;Yr.AreaCreationService=lp=XC([(0,T2.injectable)(),ZC(0,(0,T2.inject)(nO.DI_TOKENS.IVaultAdapter)),JC("design:paramtypes",[Object])],lp)});var dp=v(Xr=>{"use strict";var iO=Xr&&Xr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},sO=Xr&&Xr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},aO=Xr&&Xr.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.AreaHierarchyBuilder=void 0;var C2=Je(),O2=zt(),oO=at(),hp=class{static{o(this,"AreaHierarchyBuilder")}constructor(e){this.vault=e}buildHierarchy(e,t){let r=this.vault.getAbstractFileByPath(e);if(!this.isFile(r))return null;let i=this.vault.getFrontmatter(r)||{};if(this.extractInstanceClass(i)!==O2.AssetClass.AREA)return null;let a=this.collectAllAreasFromVault(),c=new Set;return this.buildTree(e,a,c,0)}isFile(e){return e&&typeof e=="object"&&"basename"in e&&"path"in e}extractInstanceClass(e){let t=e.exo__Instance_class||"";return Array.isArray(t)?this.cleanWikiLink(t[0]||""):this.cleanWikiLink(t)}cleanWikiLink(e){return typeof e!="string"?"":e.replace(/^\[\[|\]\]$/g,"").trim()}collectAllAreasFromVault(){let e=new Map,t=new Map,r=this.vault.getAllFiles();for(let i of r){let s=this.vault.getFrontmatter(i)||{};if(this.extractInstanceClass(s)===O2.AssetClass.AREA){let c=this.extractParentPath(s);e.set(i.path,{path:i.path,title:i.basename,label:s.exo__Asset_label||void 0,isArchived:this.isArchived(s),depth:0,parentPath:c||void 0}),t.set(i.basename,i.path)}}for(let[,i]of e.entries())i.parentPath&&t.has(i.parentPath)&&(i.parentPath=t.get(i.parentPath));return e}extractParentPath(e){let t=e.ems__Area_parent;if(!t)return null;if(Array.isArray(t)){let r=t[0]||"";return this.cleanWikiLink(r)}return this.cleanWikiLink(t)}isArchived(e){let t=e.exo__Asset_archived;if(t===!0||t==="true")return!0;if(Array.isArray(t)&&t.length>0){let r=t[0];return r===!0||r==="true"}return!1}buildTree(e,t,r,i){if(r.has(e))return null;r.add(e);let s=t.get(e);if(!s)return null;let a=[];for(let[c,u]of t.entries())if(u.parentPath===e){let l=this.buildTree(c,t,r,i+1);l&&a.push(l)}return a.sort((c,u)=>{let l=c.label||c.title,f=u.label||u.title;return l.localeCompare(f)}),{path:s.path,title:s.title,label:s.label,isArchived:s.isArchived,depth:i,parentPath:s.parentPath,children:a}}};Xr.AreaHierarchyBuilder=hp;Xr.AreaHierarchyBuilder=hp=iO([(0,C2.injectable)(),aO(0,(0,C2.inject)(oO.DI_TOKENS.IVaultAdapter)),sO("design:paramtypes",[Object])],hp)});var mp=v(Jr=>{"use strict";var cO=Jr&&Jr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},uO=Jr&&Jr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},lO=Jr&&Jr.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Jr,"__esModule",{value:!0});Jr.ClassCreationService=void 0;var D2=Je(),fO=Or(),hO=cr(),dO=Mr(),pO=at(),pp=class{static{o(this,"ClassCreationService")}constructor(e){this.vault=e}async createSubclass(e,t,r){let i=(0,fO.v4)(),s=this.generateFileName(t),a=s.endsWith(".md")?s:`${s}.md`,c=this.generateClassFrontmatter(e.basename,t,i,r),u=dO.MetadataHelpers.buildFileContent(c),l="classes",f=`${l}/${a}`;return this.vault.getAbstractFileByPath(l)||await this.vault.createFolder(l),await this.vault.create(f,u)}generateFileName(e){let t=e.toLowerCase().replace(/[^a-z0-9]+/g,"-");for(;t.startsWith("-");)t=t.slice(1);for(;t.endsWith("-");)t=t.slice(0,-1);return t}generateClassFrontmatter(e,t,r,i){let s=new Date,a=hO.DateFormatter.toLocalTimestamp(s),c={};c.exo__Asset_uid=r,c.exo__Asset_label=t,c.exo__Asset_createdAt=a,c.exo__Instance_class=['"[[exo__Class]]"'],c.exo__Class_superClass=`"[[${e}]]"`;let u=i.exo__Asset_isDefinedBy||'"[[Ontology/EXO]]"';return c.exo__Asset_isDefinedBy=u,c.aliases=[t],c}};Jr.ClassCreationService=pp;Jr.ClassCreationService=pp=cO([(0,D2.injectable)(),lO(0,(0,D2.inject)(pO.DI_TOKENS.IVaultAdapter)),uO("design:paramtypes",[Object])],pp)});var yp=v(Zr=>{"use strict";var mO=Zr&&Zr.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},gO=Zr&&Zr.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},yO=Zr&&Zr.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.ConceptCreationService=void 0;var I2=Je(),vO=Or(),wO=cr(),_O=Mr(),bO=zt(),SO=at(),gp=class{static{o(this,"ConceptCreationService")}constructor(e){this.vault=e}async createNarrowerConcept(e,t,r,i){let s=(0,vO.v4)(),a=t.endsWith(".md")?t:`${t}.md`,c=this.generateConceptFrontmatter(e.basename,r,i,s),u=_O.MetadataHelpers.buildFileContent(c),l="concepts",f=`${l}/${a}`;return this.vault.getAbstractFileByPath(l)||await this.vault.createFolder(l),await this.vault.create(f,u)}generateConceptFrontmatter(e,t,r,i){let s=new Date,a=wO.DateFormatter.toLocalTimestamp(s),c={};return c.exo__Asset_isDefinedBy='"[[!concepts]]"',c.exo__Asset_uid=i,c.exo__Asset_createdAt=a,c.exo__Instance_class=[`"[[${bO.AssetClass.CONCEPT}]]"`],c.ims__Concept_broader=`"[[${e}]]"`,c.ims__Concept_definition=t,r.length>0&&(c.aliases=r),c}};Zr.ConceptCreationService=gp;Zr.ConceptCreationService=gp=mO([(0,I2.injectable)(),yO(0,(0,I2.inject)(SO.DI_TOKENS.IVaultAdapter)),gO("design:paramtypes",[Object])],gp)});var wp=v(en=>{"use strict";var EO=en&&en.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},TO=en&&en.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},AO=en&&en.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(en,"__esModule",{value:!0});en.EffortVotingService=void 0;var P2=Je(),xO=at(),vp=class{static{o(this,"EffortVotingService")}constructor(e){this.vault=e}async incrementEffortVotes(e){let t=await this.vault.read(e),i=this.extractVoteCount(t)+1,s=this.updateFrontmatterWithVotes(t,i);return await this.vault.modify(e,s),i}extractVoteCount(e){let t=/^---\r?\n([\s\S]*?)\r?\n---/,r=e.match(t);if(!r)return 0;let s=r[1].match(/ems__Effort_votes:\s*(\d+)/);return s&&s[1]?parseInt(s[1],10):0}updateFrontmatterWithVotes(e,t){let r=/^---\r?\n([\s\S]*?)\r?\n---/,i=e.match(r),s=e.includes(`\r
`)?`\r
`:`
`;if(!i)return`---${s}ems__Effort_votes: ${t}${s}---${s}${e}`;let c=i[1];return c.includes("ems__Effort_votes:")?c=c.replace(/ems__Effort_votes:.*$/m,`ems__Effort_votes: ${t}`):c+=`${s}ems__Effort_votes: ${t}`,e.replace(r,`---${s}${c}${s}---`)}};en.EffortVotingService=vp;en.EffortVotingService=vp=EO([(0,P2.injectable)(),AO(0,(0,P2.inject)(xO.DI_TOKENS.IVaultAdapter)),TO("design:paramtypes",[Object])],vp)});var bp=v(tn=>{"use strict";var CO=tn&&tn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},OO=tn&&tn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},DO=tn&&tn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(tn,"__esModule",{value:!0});tn.FolderRepairService=void 0;var F2=Je(),IO=at(),_p=class{static{o(this,"FolderRepairService")}constructor(e){this.vault=e}async getExpectedFolder(e,t){let r=t?.exo__Asset_isDefinedBy;if(!r)return null;let i=this.extractReference(r);if(!i)return null;let s=this.vault.getFirstLinkpathDest(i,e.path);return s?this.getFileFolder(s):null}async repairFolder(e,t){let r=`${t}/${e.name}`;if(this.vault.getAbstractFileByPath(r))throw new Error(`Cannot move file: ${r} already exists`);await this.ensureFolderExists(t),await this.vault.rename(e,r)}getFileFolder(e){return e.parent?.path||""}extractReference(e){if(typeof e!="string")return null;let t=e.trim().replace(/^["']|["']$/g,"");return t=t.replace(/^\[\[|\]\]$/g,""),t||null}async ensureFolderExists(e){if(!e)return;let t=this.vault.getAbstractFileByPath(e);if(!(t&&"children"in t))try{await this.vault.createFolder(e)}catch(r){if(r instanceof Error&&r.message.includes("Folder already exists"))return;throw r}}};tn.FolderRepairService=_p;tn.FolderRepairService=_p=CO([(0,F2.injectable)(),DO(0,(0,F2.inject)(IO.DI_TOKENS.IVaultAdapter)),OO("design:paramtypes",[Object])],_p)});var Ep=v(rn=>{"use strict";var PO=rn&&rn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},FO=rn&&rn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},RO=rn&&rn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(rn,"__esModule",{value:!0});rn.LabelToAliasService=void 0;var R2=Je(),NO=at(),Sp=class{static{o(this,"LabelToAliasService")}constructor(e){this.vault=e}async copyLabelToAliases(e){let t=await this.vault.read(e),r=this.extractLabel(t);if(!r)throw new Error("No exo__Asset_label found in file");let i=this.addLabelToAliases(t,r);await this.vault.modify(e,i)}extractLabel(e){let t=/^---\r?\n([\s\S]*?)\r?\n---/,r=e.match(t);if(!r)return null;let s=r[1].match(/exo__Asset_label:\s*["']?([^"'\r\n]+)["']?/);return s&&s[1]?s[1].trim():null}addLabelToAliases(e,t){let r=/^---\r?\n([\s\S]*?)\r?\n---/,i=e.match(r),s=e.includes(`\r
`)?`\r
`:`
`;if(!i)return`---${s}aliases:${s}  - "${t}"${s}---${s}${e}`;let c=i[1];return c.includes("aliases:")?c.match(/(aliases:\r?\n(?: {2}- .*\r?\n)*)/)&&(c=c.replace(/(aliases:\r?\n(?: {2}- .*\r?\n)*)/,`$1  - "${t}"${s}`)):c+=`${s}aliases:${s}  - "${t}"`,e.replace(r,`---${s}${c}${s}---`)}};rn.LabelToAliasService=Sp;rn.LabelToAliasService=Sp=PO([(0,R2.injectable)(),RO(0,(0,R2.inject)(NO.DI_TOKENS.IVaultAdapter)),FO("design:paramtypes",[Object])],Sp)});var Tp=v(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});qu.LoggingService=void 0;var Ro=class{static{o(this,"LoggingService")}static setVerbose(e){this.isVerbose=e}static setDevelopmentMode(e){this.isDevelopment=e}static checkIsDevelopment(){return this.isDevelopment!==void 0?this.isDevelopment:typeof process<"u"?(this.isDevelopment=!1,this.isDevelopment):(this.isDevelopment=!1,this.isDevelopment)}static debug(e,t){this.isVerbose&&console.debug(`[Exocortex] ${e}`,t??"")}static info(e,t){console.log(`[Exocortex] ${e}`,t??"")}static warn(e,t){console.warn(`[Exocortex] ${e}`,t??"")}static error(e,t,r){let i=this.checkIsDevelopment(),s=r?` [${r}]`:"";if(i){let a=t?.stack?`
  Stack trace:
${t.stack}`:"";console.error(`[Exocortex ERROR]${s} ${e}${a}`,t??"")}else{let a=t?.message?`
  Details: ${t.message}`:"";console.error(`[Exocortex ERROR]${s} ${e}${a}`)}}};qu.LoggingService=Ro;Ro.isVerbose=!1;Ro.isDevelopment=void 0});var Cp=v(nn=>{"use strict";var kO=nn&&nn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},LO=nn&&nn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},N2=nn&&nn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(nn,"__esModule",{value:!0});nn.PropertyCleanupService=void 0;var Ap=Je(),k2=at(),xp=class{static{o(this,"PropertyCleanupService")}constructor(e,t){this.vault=e,this.logger=t,this.logger.debug("PropertyCleanupService initialized")}async cleanEmptyProperties(e){this.logger.debug("Cleaning empty properties",{path:e.path});let t=await this.vault.read(e),r=this.removeEmptyPropertiesFromContent(t);await this.vault.modify(e,r),this.logger.info("Empty properties cleaned",{path:e.path})}removeEmptyPropertiesFromContent(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r)return e;let s=r[1].split(`
`),a=[],c=0;for(;c<s.length;){let l=s[c],f=l.trim();if(f===""){a.push(l),c++;continue}let h=f.match(/^([^:]+):\s*(.*)$/);if(h){let d=h[2];if(d===""&&c+1<s.length&&s[c+1].match(/^\s+- /)){let _=[],b=c+1;for(;b<s.length&&s[b].match(/^\s+- /);)_.push(s[b]),b++;if(_.every(O=>{let I=O.replace(/^\s+- /,"").trim();return this.isEmptyValue(I)})){c=b;continue}else{a.push(l);for(let O=c+1;O<b;O++)a.push(s[O]);c=b;continue}}if(this.isEmptyValue(d)){c++;continue}a.push(l),c++}else f.match(/^\s*- /)||a.push(l),c++}let u=a.join(`
`);return e.replace(t,`---
${u}
---`)}isEmptyValue(e){let t=e.trim();return t===""||t==="null"||t==="undefined"||t==="[]"||t==="{}"||t==='""'||t==="''"}};nn.PropertyCleanupService=xp;nn.PropertyCleanupService=xp=kO([(0,Ap.injectable)(),N2(0,(0,Ap.inject)(k2.DI_TOKENS.IVaultAdapter)),N2(1,(0,Ap.inject)(k2.DI_TOKENS.ILogger)),LO("design:paramtypes",[Object,Object])],xp)});var Dp=v(sn=>{"use strict";var jO=sn&&sn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},MO=sn&&sn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},VO=sn&&sn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(sn,"__esModule",{value:!0});sn.RenameToUidService=void 0;var L2=Je(),$O=at(),Op=class{static{o(this,"RenameToUidService")}constructor(e){this.vault=e}async renameToUid(e,t){let r=t.exo__Asset_uid;if(!r)throw new Error("Asset has no exo__Asset_uid property");let i=e.basename,s=r;if(i===s)throw new Error("File is already named according to UID");let a=t.exo__Asset_label;if(!a||a.trim()===""){let f=this.isAssetArchived(t);await this.updateLabel(e,i,f)}let u=e.parent?.path||"",l=u?`${u}/${s}.md`:`${s}.md`;await this.vault.updateLinks(e.path,l,i),await this.vault.rename(e,l)}async updateLabel(e,t,r){await this.vault.process(e,i=>{let s=/^---\n([\s\S]*?)\n---/,a=i.match(s);if(!a)return i;let c=a[1],u=r?`${c}
exo__Asset_label: ${t}`:`${c}
exo__Asset_label: ${t}
aliases:
  - ${t}`;return i.replace(s,`---
${u}
---`)})}isAssetArchived(e){if(e?.exo__Asset_isArchived===!0)return!0;let t=e?.archived;if(t==null)return!1;if(typeof t=="boolean")return t;if(typeof t=="number")return t!==0;if(typeof t=="string"){let r=t.toLowerCase().trim();return r==="true"||r==="yes"||r==="1"}return!1}};sn.RenameToUidService=Op;sn.RenameToUidService=Op=jO([(0,L2.injectable)(),VO(0,(0,L2.inject)($O.DI_TOKENS.IVaultAdapter)),MO("design:paramtypes",[Object])],Op)});var Pp=v(an=>{"use strict";var BO=an&&an.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},UO=an&&an.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},qO=an&&an.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(an,"__esModule",{value:!0});an.SupervisionCreationService=void 0;var j2=Je(),GO=Or(),WO=cr(),zO=at(),Ip=class{static{o(this,"SupervisionCreationService")}constructor(e){this.vault=e}async createSupervision(e){let t=(0,GO.v4)(),r=`${t}.md`,i=this.generateFrontmatter(t),s=this.generateBody(e),a=this.buildFileContent(i,s),c=`01 Inbox/${r}`;return await this.vault.create(c,a)}generateFrontmatter(e){let t=new Date,r=WO.DateFormatter.toLocalTimestamp(t);return{exo__Asset_isDefinedBy:'"[[!kitelev]]"',exo__Asset_uid:e,exo__Asset_createdAt:r,exo__Instance_class:['"[[ztlk__FleetingNote]]"'],ztlk__FleetingNote_type:'"[[CBT-Diary Record]]"'}}generateBody(e){return[{label:"\u0421\u0438\u0442\u0443\u0430\u0446\u0438\u044F/\u0442\u0440\u0438\u0433\u0433\u0435\u0440",value:e.situation},{label:"\u042D\u043C\u043E\u0446\u0438\u0438",value:e.emotions},{label:"\u041C\u044B\u0441\u043B\u0438",value:e.thoughts},{label:"\u041F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u0435",value:e.behavior},{label:"\u041A\u0440\u0430\u0442\u043A\u043E\u0441\u0440\u043E\u0447\u043D\u044B\u0435 \u043F\u043E\u0441\u043B\u0435\u0434\u0441\u0442\u0432\u0438\u044F \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u044F",value:e.shortTermConsequences},{label:"\u0414\u043E\u043B\u0433\u043E\u0441\u0440\u043E\u0447\u043D\u044B\u0435 \u043F\u043E\u0441\u043B\u0435\u0434\u0441\u0442\u0432\u0438\u044F \u043F\u043E\u0432\u0435\u0434\u0435\u043D\u0438\u044F",value:e.longTermConsequences}].map(r=>`- ${r.label}: ${r.value}`).join(`
`)}buildFileContent(e,t){return`---
${Object.entries(e).map(([i,s])=>{if(Array.isArray(s)){let a=s.map(c=>`  - ${c}`).join(`
`);return`${i}:
${a}`}return`${i}: ${s}`}).join(`
`)}
---

${t}
`}};an.SupervisionCreationService=Ip;an.SupervisionCreationService=Ip=BO([(0,j2.injectable)(),qO(0,(0,j2.inject)(zO.DI_TOKENS.IVaultAdapter)),UO("design:paramtypes",[Object])],Ip)});var Rp=v(on=>{"use strict";var HO=on&&on.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},KO=on&&on.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},QO=on&&on.__param||function(n,e){return function(t,r){e(t,r,n)}},Fp;Object.defineProperty(on,"__esModule",{value:!0});on.FleetingNoteCreationService=void 0;var M2=Je(),YO=Or(),XO=cr(),JO=Mr(),ZO=at(),Gu=Fp=class{static{o(this,"FleetingNoteCreationService")}constructor(e){this.vault=e}async createFleetingNote(e){let t=(0,YO.v4)(),r=`${t}.md`,i=this.generateFrontmatter(t,e),s=JO.MetadataHelpers.buildFileContent(i),a=`${Fp.INBOX_FOLDER}/${r}`;return await this.vault.create(a,s)}generateFrontmatter(e,t){let r=new Date,i=XO.DateFormatter.toLocalTimestamp(r),s=t.trim();return{exo__Asset_isDefinedBy:'"[[!kitelev]]"',exo__Asset_uid:e,exo__Asset_createdAt:i,exo__Instance_class:['"[[ztlk__FleetingNote]]"'],exo__Asset_label:s,aliases:[s]}}};on.FleetingNoteCreationService=Gu;Gu.INBOX_FOLDER="01 Inbox";on.FleetingNoteCreationService=Gu=Fp=HO([(0,M2.injectable)(),QO(0,(0,M2.inject)(ZO.DI_TOKENS.IVaultAdapter)),KO("design:paramtypes",[Object])],Gu)});var kp=v(vs=>{"use strict";var e4=vs&&vs.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};Object.defineProperty(vs,"__esModule",{value:!0});vs.DynamicFrontmatterGenerator=void 0;var t4=Je(),r4=Or(),No=cr(),Np=class{static{o(this,"DynamicFrontmatterGenerator")}generate(e,t,r,i){let s={},a=new Date;i?.isDefinedBy&&(s.exo__Asset_isDefinedBy=this.ensureQuoted(i.isDefinedBy)),s.exo__Asset_uid=i?.uid||(0,r4.v4)(),s.exo__Asset_createdAt=i?.createdAt||No.DateFormatter.toLocalTimestamp(a),s.exo__Instance_class=[this.formatWikilink(e)];let c=new Map;for(let l of r)c.set(l.name,l.type);for(let[l,f]of Object.entries(t)){if(f==null||l==="exo__Asset_uid"||l==="exo__Asset_createdAt"||l==="exo__Instance_class"||l==="exo__Asset_isDefinedBy")continue;let h=c.get(l);s[l]=this.formatValue(f,h)}let u=t.exo__Asset_label;if(u&&typeof u=="string"&&u.trim()!==""){let l=u.trim();s.exo__Asset_label=l,s.aliases=[l]}return s}formatValue(e,t){if(e==null)return null;if(!t)return this.formatInferredValue(e);switch(t){case"text":return this.formatText(e);case"wikilink":return this.formatWikilink(e);case"status-select":case"size-select":return this.formatWikilink(e);case"number":return this.formatNumber(e);case"boolean":return this.formatBoolean(e);case"timestamp":return this.formatTimestamp(e);default:return this.formatText(e)}}formatText(e){return typeof e=="string"?e:String(e)}formatWikilink(e){let t=String(e);return t.startsWith('"[[')&&t.endsWith(']]"')?t:t.startsWith("[[")&&t.endsWith("]]")?`"${t}"`:`"[[${t}]]"`}formatNumber(e){if(typeof e=="number")return e;let t=Number(e);return isNaN(t)?0:t}formatBoolean(e){if(typeof e=="boolean")return e;if(typeof e=="string"){let t=e.toLowerCase().trim();return t==="true"||t==="yes"||t==="1"}return typeof e=="number"?e!==0:!!e}formatTimestamp(e){if(e instanceof Date)return No.DateFormatter.toLocalTimestamp(e);if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(e))return e;if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return e.replace("Z","");let t=new Date(e);return isNaN(t.getTime())?e:No.DateFormatter.toLocalTimestamp(t)}if(typeof e=="number"){let t=new Date(e);if(!isNaN(t.getTime()))return No.DateFormatter.toLocalTimestamp(t)}return String(e)}formatInferredValue(e){return typeof e=="boolean"||typeof e=="number"?e:e instanceof Date?No.DateFormatter.toLocalTimestamp(e):typeof e=="string"?e.startsWith("[[")||e.startsWith('"[[')?this.formatWikilink(e):e:String(e)}ensureQuoted(e){return!e||e==='""'?'""':e.startsWith('"')&&e.endsWith('"')?e:`"${e}"`}generateYAML(e,t,r,i){let s=this.generate(e,t,r,i);return this.toYAML(s)}toYAML(e){return`---
${Object.entries(e).map(([r,i])=>{if(Array.isArray(i)){let s=i.map(a=>`  - ${a}`).join(`
`);return`${r}:
${s}`}return`${r}: ${i}`}).join(`
`)}
---`}};vs.DynamicFrontmatterGenerator=Np;vs.DynamicFrontmatterGenerator=Np=e4([(0,t4.injectable)()],Np)});var jp=v(cn=>{"use strict";var n4=cn&&cn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},i4=cn&&cn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},s4=cn&&cn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(cn,"__esModule",{value:!0});cn.PlanningService=void 0;var V2=Je(),a4=ea(),o4=cr(),c4=at(),Lp=class{static{o(this,"PlanningService")}constructor(e){this.vault=e,this.frontmatterService=new a4.FrontmatterService}async planOnToday(e){let t=this.vault.getAbstractFileByPath(e);if(!t||!this.isFile(t))throw new Error(`File not found: ${e}`);let r=await this.vault.read(t),i=o4.DateFormatter.getTodayStartTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_plannedStartTimestamp",i);await this.vault.modify(t,s)}isFile(e){return"basename"in e}};cn.PlanningService=Lp;cn.PlanningService=Lp=n4([(0,V2.injectable)(),s4(0,(0,V2.inject)(c4.DI_TOKENS.IVaultAdapter)),i4("design:paramtypes",[Object])],Lp)});var Vp=v(un=>{"use strict";var u4=un&&un.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},l4=un&&un.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},f4=un&&un.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(un,"__esModule",{value:!0});un.AssetConversionService=void 0;var $2=Je(),B2=zt(),h4=ea(),Wu=Tp(),d4=at(),Mp=class{static{o(this,"AssetConversionService")}constructor(e){this.vault=e,this.frontmatterService=new h4.FrontmatterService}async convertTaskToProject(e){try{let t=await this.vault.read(e),r=this.removeInstanceClassProperty(t);return r=this.frontmatterService.updateProperty(r,"exo__Instance_class",`["[[${B2.AssetClass.PROJECT}]]"]`),await this.vault.modify(e,r),Wu.LoggingService.info(`Converted Task to Project: ${e.basename} (${e.path})`),e}catch(t){let r=`Failed to convert Task to Project: ${e.path}`;throw Wu.LoggingService.error(r,t instanceof Error?t:void 0),new Error(r)}}async convertProjectToTask(e){try{let t=await this.vault.read(e),r=this.removeInstanceClassProperty(t);return r=this.frontmatterService.updateProperty(r,"exo__Instance_class",`["[[${B2.AssetClass.TASK}]]"]`),await this.vault.modify(e,r),Wu.LoggingService.info(`Converted Project to Task: ${e.basename} (${e.path})`),e}catch(t){let r=`Failed to convert Project to Task: ${e.path}`;throw Wu.LoggingService.error(r,t instanceof Error?t:void 0),new Error(r)}}removeInstanceClassProperty(e){let t=this.frontmatterService.parse(e);if(!t.exists)return e;let r=/^exo__Instance_class:.*$(\n  -.*$)*/gm,i=t.content.replace(r,"").replace(/\n\n+/g,`
`).trim();return e.replace(/^---\n[\s\S]*?\n---/,`---
${i}
---`)}};un.AssetConversionService=Mp;un.AssetConversionService=Mp=u4([(0,$2.injectable)(),f4(0,(0,$2.inject)(d4.DI_TOKENS.IVaultAdapter)),l4("design:paramtypes",[Object])],Mp)});var Bp=v(ln=>{"use strict";var p4=ln&&ln.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},m4=ln&&ln.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},g4=ln&&ln.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(ln,"__esModule",{value:!0});ln.SessionEventService=void 0;var U2=Je(),y4=Or(),q2=zt(),v4=cr(),w4=Mr(),_4=at(),$p=class{static{o(this,"SessionEventService")}constructor(e){this.vault=e,this.folderPathCache=null,this.defaultOntologyAsset=null}setDefaultOntologyAsset(e){this.defaultOntologyAsset=e,this.folderPathCache=null}async createSessionStartEvent(e){return this.createSessionEvent(e,q2.AssetClass.SESSION_START_EVENT)}async createSessionEndEvent(e){return this.createSessionEvent(e,q2.AssetClass.SESSION_END_EVENT)}async getOntologyAssetFolder(){if(this.folderPathCache!==null)return this.folderPathCache;if(!this.defaultOntologyAsset){let r=this.vault.getDefaultNewFileParent();return this.folderPathCache=r?.path||"",this.folderPathCache}let e=this.vault.getAllFiles();for(let r of e)if(r.basename===this.defaultOntologyAsset){let i=r.parent?.path||"";return this.folderPathCache=i,this.folderPathCache}let t=this.vault.getDefaultNewFileParent();return this.folderPathCache=t?.path||"",this.folderPathCache}async createSessionEvent(e,t){let r=(0,y4.v4)(),i=v4.DateFormatter.toLocalTimestamp(new Date),s=this.defaultOntologyAsset?`"[[${this.defaultOntologyAsset}]]"`:'"[[!kitelev]]"',a={exo__Asset_uid:r,exo__Asset_createdAt:i,exo__Asset_isDefinedBy:s,exo__Instance_class:[`"[[${t}]]"`],ems__SessionEvent_timestamp:i,ems__Session_area:`"[[${e}]]"`},c=w4.MetadataHelpers.buildFileContent(a),u=await this.getOntologyAssetFolder();u&&!await this.vault.exists(u)&&await this.vault.createFolder(u);let l=u?`${u}/${r}.md`:`${r}.md`;return await this.vault.create(l,c)}};ln.SessionEventService=$p;ln.SessionEventService=$p=p4([(0,U2.injectable)(),g4(0,(0,U2.inject)(_4.DI_TOKENS.IVaultAdapter)),m4("design:paramtypes",[Object])],$p)});var qp=v(fn=>{"use strict";var b4=fn&&fn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},S4=fn&&fn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},E4=fn&&fn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(fn,"__esModule",{value:!0});fn.URIConstructionService=void 0;var G2=Je(),T4=at(),Up=class{static{o(this,"URIConstructionService")}constructor(e){this.fileSystem=e,this.defaultOntologyURL="https://exocortex.my/default/",this.strictValidation=!0}configure(e){e?.defaultOntologyURL&&(this.defaultOntologyURL=e.defaultOntologyURL),e?.strictValidation!==void 0&&(this.strictValidation=e.strictValidation)}async constructAssetURI(e){let t=this.extractUID(e);if(!t){if(this.strictValidation)throw new Error(`Asset missing exo__Asset_uid: ${e.path}`);return console.warn(`Asset ${e.path} missing UID, using filename fallback`),this.constructFallbackURI(e)}let r=await this.resolveOntologyURL(e);if(!this.validateOntologyURL(r))throw new Error(`Invalid ontology URL: ${r}`);return`${r.endsWith("/")?r:`${r}/`}${t}`}validateOntologyURL(e){if(!e)return!1;try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}async resolveOntologyURL(e){let t=e.frontmatter?.exo__Asset_isDefinedBy;if(!t)return this.defaultOntologyURL;let r=this.extractWikiLink(t),i=r,s=await this.fileSystem.fileExists(r);return!s&&!r.endsWith(".md")&&(i=`${r}.md`,s=await this.fileSystem.fileExists(i)),s?(await this.fileSystem.getFileMetadata(i))?.exo__Ontology_url||this.defaultOntologyURL:(console.warn(`Ontology file not found: ${r}, using default`),this.defaultOntologyURL)}extractUID(e){return e.frontmatter?.exo__Asset_uid||null}extractWikiLink(e){return e.replace(/^\[\[|\]\]$/g,"")}constructFallbackURI(e){let t=e.path.split("/").pop()?.replace(".md","")||"unknown";return`${this.defaultOntologyURL}${t}`}};fn.URIConstructionService=Up;fn.URIConstructionService=Up=b4([(0,G2.injectable)(),E4(0,(0,G2.inject)(T4.DI_TOKENS.IFileSystemAdapter)),S4("design:paramtypes",[Object])],Up)});var Wp=v(hn=>{"use strict";var A4=hn&&hn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},x4=hn&&hn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},C4=hn&&hn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(hn,"__esModule",{value:!0});hn.GenericAssetCreationService=void 0;var W2=Je(),O4=Or(),ko=cr(),D4=Mr(),I4=at(),Pn=zh(),Gp=class{static{o(this,"GenericAssetCreationService")}constructor(e){this.vault=e}async createAsset(e,t){let r=(0,O4.v4)(),i=`${r}.md`,s=this.generateFrontmatter(e,t||[],r),a=D4.MetadataHelpers.buildFileContent(s),c=e.folderPath||this.getDefaultFolderPath(e);this.vault.getAbstractFileByPath(c)||await this.vault.createFolder(c);let l=c?`${c}/${i}`:i;return await this.vault.create(l,a)}generateFrontmatter(e,t,r){let i=new Date,s={},a=new Map;for(let c of t)a.set(c.name,c.fieldType);if(s.exo__Asset_uid=r,s.exo__Asset_createdAt=ko.DateFormatter.toLocalTimestamp(i),s.exo__Instance_class=[this.formatWikilink(e.className)],e.label&&e.label.trim()!==""){let c=e.label.trim();s.exo__Asset_label=c,s.aliases=[c]}if(e.parentFile&&e.parentMetadata&&this.inheritParentContext(s,e),e.propertyValues)for(let[c,u]of Object.entries(e.propertyValues)){if(c==="exo__Asset_uid"||c==="exo__Asset_createdAt"||c==="exo__Instance_class"||c==="exo__Asset_label"||c==="aliases"||u==null)continue;let l=a.get(c);s[c]=this.formatValue(u,l)}return s}inheritParentContext(e,t){let r=t.parentMetadata||{},i=t.parentFile?.basename;if((t.className==="ems__Task"||t.className.startsWith("ems__Task"))&&(e.ems__Effort_parent=i?this.formatWikilink(i):null),t.className==="ems__Project"||t.className.startsWith("ems__Project")){let s=r.exo__Instance_class;this.isAreaClass(s)&&(e.ems__Project_area=i?this.formatWikilink(i):null)}r.exo__Asset_isDefinedBy&&(e.exo__Asset_isDefinedBy=r.exo__Asset_isDefinedBy)}isAreaClass(e){return e?(Array.isArray(e)?e:[e]).some(r=>String(r).includes("Area")||String(r).includes("ems__Area")):!1}getDefaultFolderPath(e){if(e.parentFile?.parent?.path)return e.parentFile.parent.path;let t={ems__Task:"tasks",ems__Project:"projects",ems__Area:"areas",ems__Meeting:"meetings",exo__Event:"events",ims__Concept:"concepts"};if(t[e.className])return t[e.className];for(let[r,i]of Object.entries(t))if(e.className.startsWith(r))return i;return"assets"}formatValue(e,t){if(e==null)return null;if(!t)return this.formatInferredValue(e);switch(t){case Pn.PropertyFieldType.Text:return String(e);case Pn.PropertyFieldType.Wikilink:case Pn.PropertyFieldType.Reference:case Pn.PropertyFieldType.StatusSelect:case Pn.PropertyFieldType.SizeSelect:return this.formatWikilink(String(e));case Pn.PropertyFieldType.Number:return typeof e=="number"?e:Number(e)||0;case Pn.PropertyFieldType.Boolean:return this.formatBoolean(e);case Pn.PropertyFieldType.Date:case Pn.PropertyFieldType.DateTime:case Pn.PropertyFieldType.Timestamp:return this.formatTimestamp(e);default:return String(e)}}formatInferredValue(e){return typeof e=="boolean"||typeof e=="number"?e:e instanceof Date?ko.DateFormatter.toLocalTimestamp(e):typeof e=="string"?e.startsWith("[[")||e.startsWith('"[[')?this.formatWikilink(e):e:String(e)}formatWikilink(e){return e.startsWith('"[[')&&e.endsWith(']]"')?e:e.startsWith("[[")&&e.endsWith("]]")?`"${e}"`:`"[[${e}]]"`}formatBoolean(e){if(typeof e=="boolean")return e;if(typeof e=="string"){let t=e.toLowerCase().trim();return t==="true"||t==="yes"||t==="1"}return typeof e=="number"?e!==0:!!e}formatTimestamp(e){if(e instanceof Date)return ko.DateFormatter.toLocalTimestamp(e);if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/.test(e))return e;if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$/.test(e))return e.replace("Z","");let t=new Date(e);return isNaN(t.getTime())?e:ko.DateFormatter.toLocalTimestamp(t)}if(typeof e=="number"){let t=new Date(e);if(!isNaN(t.getTime()))return ko.DateFormatter.toLocalTimestamp(t)}return String(e)}};hn.GenericAssetCreationService=Gp;hn.GenericAssetCreationService=Gp=A4([(0,W2.injectable)(),C4(0,(0,W2.inject)(I4.DI_TOKENS.IVaultAdapter)),x4("design:paramtypes",[Object])],Gp)});var z2=v(zu=>{"use strict";Object.defineProperty(zu,"__esModule",{value:!0});zu.EffortSortingHelpers=void 0;var zp=class n{static{o(this,"EffortSortingHelpers")}static getTimeFromTimestamp(e){if(!e)return"00:00:00";let t=new Date(e);if(isNaN(t.getTime()))return"00:00:00";let r=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${r}:${i}:${s}`}static sortByStartTime(e,t){let r=n.getTimeFromTimestamp(e.startTimestamp),i=n.getTimeFromTimestamp(t.startTimestamp),s=r==="00:00:00",a=i==="00:00:00";return s&&!a?1:!s&&a?-1:r.localeCompare(i)}static sortByPriority(e,t){if(e.isTrashed!==t.isTrashed)return e.isTrashed?1:-1;if(e.isDone!==t.isDone)return e.isDone?1:-1;let r=typeof e.metadata.ems__Effort_votes=="number"?e.metadata.ems__Effort_votes:0,i=typeof t.metadata.ems__Effort_votes=="number"?t.metadata.ems__Effort_votes:0;return r!==i?i-r:e.startTime&&t.startTime?e.startTime.localeCompare(t.startTime):e.startTime?-1:t.startTime?1:0}};zu.EffortSortingHelpers=zp});var H2=v(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});Hu.FilenameValidator=void 0;var ws=class{static{o(this,"FilenameValidator")}static validate(e,t={}){let{maxLength:r=this.DEFAULT_MAX_LENGTH,replacementChar:i=this.DEFAULT_REPLACEMENT,allowEmpty:s=!1}=t,a=[];if(!e||e.trim().length===0)return s||a.push("Filename cannot be empty"),{valid:a.length===0,sanitized:"",errors:a};e.endsWith(" ")&&a.push("Filename should not end with a space");let c=e.trim();this.INVALID_CHARS_PATTERN.test(c)&&a.push('Filename contains invalid characters: / \\ : * ? " < > |');let u=this.getBaseName(c);this.RESERVED_NAMES.has(u.toUpperCase())&&a.push(`"${u}" is a reserved filename on Windows`),c.length>r&&a.push(`Filename exceeds maximum length of ${r} characters`),c.startsWith(".")&&a.push("Filename should not start with a dot"),c.endsWith(".")&&a.push("Filename should not end with a dot");let l=this.sanitize(e,{maxLength:r,replacementChar:i});return{valid:a.length===0,sanitized:l,errors:a}}static sanitize(e,t={}){let{maxLength:r=this.DEFAULT_MAX_LENGTH,replacementChar:i=this.DEFAULT_REPLACEMENT}=t;if(!e||e.trim().length===0)return"";let s=e.trim();for(s=s.replace(this.INVALID_CHARS_PATTERN,i);s.startsWith(".")&&s.length>1;)s=s.substring(1);for(;s.length>0&&(s.endsWith(".")||s.endsWith(" "));)s=s.slice(0,-1);for(s.includes(i)&&(s=s.split(i).filter(l=>l!=="").join(i));s.startsWith(i);)s=s.slice(i.length);for(;s.endsWith(i);)s=s.slice(0,-i.length);let a=this.getBaseName(s);if(this.RESERVED_NAMES.has(a.toUpperCase())){let c=this.getExtension(s);s=a+i+c}if(s.length>r)for(s=s.slice(0,r);s.endsWith(i);)s=s.slice(0,-i.length);return s}static hasInvalidChars(e){return this.INVALID_CHARS_PATTERN.test(e)}static getInvalidChars(e){let t=e.match(this.INVALID_CHARS_PATTERN);return t?[...new Set(t)]:[]}static getBaseName(e){let t=e.lastIndexOf(".");return t===-1||t===0?e:e.substring(0,t)}static getExtension(e){let t=e.lastIndexOf(".");return t===-1||t===0?"":e.substring(t)}};Hu.FilenameValidator=ws;ws.INVALID_CHARS_PATTERN=/[/\\:*?"<>|\x00-\x1F]/g;ws.RESERVED_NAMES=new Set(["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"]);ws.DEFAULT_MAX_LENGTH=200;ws.DEFAULT_REPLACEMENT="_"});var Kp=v(Ku=>{"use strict";Object.defineProperty(Ku,"__esModule",{value:!0});Ku.NTriplesSerializer=void 0;var Hp=class{static{o(this,"NTriplesSerializer")}serialize(e,t={}){let r=t.newline??`
`;return e.length===0?"":e.map(i=>i.toString()).join(r)+r}serializeChunk(e,t){return e.length===0?"":e.map(r=>r.toString()).join(t)+t}};Ku.NTriplesSerializer=Hp});var K2=v(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});Qu.TurtleSerializer=void 0;var ta=Dn(),P4=Kp(),F4={rdf:ta.Namespace.RDF.iri.value,rdfs:ta.Namespace.RDFS.iri.value,owl:ta.Namespace.OWL.iri.value,xsd:ta.Namespace.XSD.iri.value,exo:ta.Namespace.EXO.iri.value,ems:ta.Namespace.EMS.iri.value},Qp=class{static{o(this,"TurtleSerializer")}constructor(){this.nTriplesSerializer=new P4.NTriplesSerializer}serialize(e,t={}){let r=t.newline??`
`,i=this.composePrefixes(t),s=this.serializePrefixes(i,r),a=this.nTriplesSerializer.serialize(e,{newline:r}).trimEnd();return s?a?`${s}${r}${r}${a}${r}`:`${s}${r}`:a?`${a}${r}`:""}serializePrefixes(e,t){let r=Object.entries(e);return r.length===0?"":r.map(([i,s])=>`@prefix ${i}: <${s}> .`).join(t)}composePrefixes(e){return e.includeDefaultPrefixes??!0?{...F4,...e.prefixes??{}}:{...e.prefixes??{}}}serializeTriplesOnly(e,t){return this.nTriplesSerializer.serializeChunk(e,t).trimEnd()}};Qu.TurtleSerializer=Qp});var X2=v(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.JSONLDSerializer=void 0;var Q2=Xe(),Y2=Wt(),R4=dt(),ra=Dn(),N4={rdf:ra.Namespace.RDF.iri.value,rdfs:ra.Namespace.RDFS.iri.value,owl:ra.Namespace.OWL.iri.value,xsd:ra.Namespace.XSD.iri.value,exo:ra.Namespace.EXO.iri.value,ems:ra.Namespace.EMS.iri.value},Yp=class{static{o(this,"JSONLDSerializer")}toDocument(e,t={}){let r={...N4,...t.context??{}},i=new Map;for(let s of e){let a=this.subjectToId(s.subject),c=this.compactIri(s.predicate.value,r),u=this.objectToJSONLD(s.object,r),l=i.get(a)??{"@id":a},f=l[c];f===void 0?l[c]=u:Array.isArray(f)?f.push(u):l[c]=[f,u],i.set(a,l)}return{"@context":r,"@graph":Array.from(i.values())}}serialize(e,t={}){let r=this.toDocument(e,t),i=t.pretty?t.indent??2:void 0;return JSON.stringify(r,null,i)}subjectToId(e){return e instanceof Q2.IRI?e.value:e instanceof Y2.BlankNode?`_:${e.id}`:String(e)}compactIri(e,t){for(let[r,i]of Object.entries(t))if(e.startsWith(i)){let s=e.slice(i.length);if(s.length>0)return`${r}:${s}`}return e}objectToJSONLD(e,t){if(e instanceof Q2.IRI)return{"@id":e.value};if(e instanceof Y2.BlankNode)return{"@id":`_:${e.id}`};if(e instanceof R4.Literal){let r={"@value":e.value};return e.datatype?r["@type"]=this.compactIri(e.datatype.value,t):e.language&&(r["@language"]=e.language,e.hasDirection()&&e.direction&&(r["@direction"]=e.direction)),r}return e}};Yu.JSONLDSerializer=Yp});var Zp=v(Xu=>{"use strict";Object.defineProperty(Xu,"__esModule",{value:!0});Xu.NTriplesParser=void 0;var k4=wi(),J2=Xe(),Xp=dt(),L4=Wt(),na=Dn(),j4={rdf:na.Namespace.RDF.iri.value,rdfs:na.Namespace.RDFS.iri.value,owl:na.Namespace.OWL.iri.value,xsd:na.Namespace.XSD.iri.value,exo:na.Namespace.EXO.iri.value,ems:na.Namespace.EMS.iri.value},Jp=class{static{o(this,"NTriplesParser")}parse(e,t={}){let r={prefixes:{...j4,...t.prefixes??{}},strict:t.strict??!1},i=[];return e.split(/\r?\n/).forEach((a,c)=>{let u=a.trim();!u||u.startsWith("#")||i.push(this.parseLine(u,c+1,r))}),i}parseLine(e,t,r){if(!e.endsWith("."))throw new Error(`Invalid RDF statement at line ${t}: missing '.' terminator`);let s=e.slice(0,-1).trim(),a=this.parseSubject(s,t,r);s=a.rest.trim();let c=this.parsePredicate(s,t,r);s=c.rest.trim();let u=this.parseObject(s,t,r);if(s=u.rest.trim(),s.length>0)throw new Error(`Unexpected tokens after object at line ${t}`);return new k4.Triple(a.node,c.node,u.node)}parseSubject(e,t,r){return e.startsWith("<")?this.consumeIRI(e,t,r):e.startsWith("_:")?this.consumeBlankNode(e,t):this.consumePrefixedName(e,t,r)}parsePredicate(e,t,r){return e.startsWith("<")?this.consumeIRI(e,t,r):this.consumePrefixedName(e,t,r)}parseObject(e,t,r){return e.startsWith("<")?this.consumeIRI(e,t,r):e.startsWith("_:")?this.consumeBlankNode(e,t):e.startsWith('"')?this.consumeLiteral(e,t,r):this.consumePrefixedName(e,t,r)}consumePrefixedName(e,t,r){let i=e.match(/^([a-zA-Z_][\w-]*):([^\s]+)(?:\s+(.*))?$/);if(!i)throw new Error(`Invalid token at line ${t}: ${e}`);let[,s,a,c]=i,u=r.prefixes[s];if(!u)throw new Error(`Unknown prefix "${s}" at line ${t}`);return{node:new J2.IRI(`${u}${a}`),rest:(c??"").trimStart()}}consumeIRI(e,t,r){let i=this.findClosingBracket(e,"<",">");if(i===-1)throw new Error(`Invalid IRI at line ${t}`);let s=e.slice(1,i),a=new J2.IRI(s),c=e.slice(i+1).trimStart();return{node:a,rest:c}}consumeBlankNode(e,t){let r=e.match(/^_:(\w+)(?:\s+(.*))?$/);if(!r)throw new Error(`Invalid blank node identifier at line ${t}`);let[,i,s]=r;return{node:new L4.BlankNode(i),rest:(s??"").trimStart()}}consumeLiteral(e,t,r){let{value:i,rest:s}=this.consumeQuotedString(e,t),a=s.trimStart();if(a.startsWith("^^")){a=a.slice(2).trimStart();let c=a.startsWith("<")?this.consumeIRI(a,t,r):this.consumePrefixedName(a,t,r);return{node:new Xp.Literal(i,c.node),rest:c.rest}}if(a.startsWith("@")){let c=a.match(/^@([a-zA-Z-]+)(?:\s+(.*))?$/);if(!c)throw new Error(`Invalid language tag at line ${t}`);let[,u,l]=c;return{node:new Xp.Literal(i,void 0,u),rest:(l??"").trimStart()}}return{node:new Xp.Literal(i),rest:a}}consumeQuotedString(e,t){if(!e.startsWith('"'))throw new Error(`Expected quoted string at line ${t}`);let r="";for(let i=1;i<e.length;i++){let s=e[i];if(s==="\\"){if(i+1>=e.length)throw new Error(`Invalid escape sequence at line ${t}`);let a=e[i+1];switch(a){case"t":r+="	",i+=1;break;case"b":r+="\b",i+=1;break;case"n":r+=`
`,i+=1;break;case"r":r+="\r",i+=1;break;case"f":r+="\f",i+=1;break;case'"':r+='"',i+=1;break;case"\\":r+="\\",i+=1;break;case"u":{let c=e.slice(i+2,i+6);if(c.length!==4||!/^[0-9a-fA-F]{4}$/.test(c))throw new Error(`Invalid \\u escape at line ${t}`);r+=String.fromCharCode(parseInt(c,16)),i+=5;break}case"U":{let c=e.slice(i+2,i+10);if(c.length!==8||!/^[0-9a-fA-F]{8}$/.test(c))throw new Error(`Invalid \\U escape at line ${t}`);r+=String.fromCodePoint(parseInt(c,16)),i+=9;break}default:throw new Error(`Unknown escape sequence \\${a} at line ${t}`)}continue}if(s==='"'){let a=e.slice(i+1);return{value:r,rest:a}}r+=s}throw new Error(`Unterminated string literal at line ${t}`)}findClosingBracket(e,t,r){let i=0;for(let s=0;s<e.length;s++){let a=e[s];if(a===t){i++;continue}if(a===r&&(i--,i===0))return s}return-1}};Xu.NTriplesParser=Jp});var Z2=v(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});Ju.TurtleParser=void 0;var ia=Dn(),M4=Zp(),V4={rdf:ia.Namespace.RDF.iri.value,rdfs:ia.Namespace.RDFS.iri.value,owl:ia.Namespace.OWL.iri.value,xsd:ia.Namespace.XSD.iri.value,exo:ia.Namespace.EXO.iri.value,ems:ia.Namespace.EMS.iri.value},$4=/^@prefix\s+([a-zA-Z_][\w-]*):\s*<([^>]+)>\s*\.$/,em=class{static{o(this,"TurtleParser")}constructor(){this.nTriplesParser=new M4.NTriplesParser}parse(e,t={}){let r={...V4,...t.prefixes??{}},i=this.collectStatements(e),s=[];return i.forEach(({statement:a,lineNumber:c})=>{if(this.isPrefixStatement(a)){let l=a.match($4);if(!l)throw new Error(`Invalid prefix declaration at line ${c}`);let[,f,h]=l;r[f]=h;return}if(a.includes(";")||a.includes(","))throw new Error(`Complex Turtle statements with ';' or ',' are not supported (line ${c})`);let u=this.normalizeShortcuts(a);s.push(this.nTriplesParser.parseLine(u,c,{prefixes:r,strict:!1}))}),s}collectStatements(e){let t=e.split(/\r?\n/),r=[],i="",s=0;if(t.forEach((a,c)=>{let u=a.trim();!u||u.startsWith("#")||(i||(s=c+1),i=i?`${i} ${u}`:u,u.endsWith(".")&&(r.push({statement:i,lineNumber:s}),i=""))}),i)throw new Error(`Unterminated Turtle statement near line ${s}`);return r}isPrefixStatement(e){return e.startsWith("@prefix")}normalizeShortcuts(e){return e.includes(" a ")?e.replace(/\sa\s/g," rdf:type "):e}};Ju.TurtleParser=em});var e3=v(Zu=>{"use strict";Object.defineProperty(Zu,"__esModule",{value:!0});Zu.RDFSerializer=void 0;var sa=wi(),_s=Xe(),bs=dt(),tm=Wt(),Fn=Dn(),B4=K2(),U4=Kp(),q4=X2(),G4=Z2(),W4=Zp(),z4=1024,H4=`
`,K4={rdf:Fn.Namespace.RDF.iri.value,rdfs:Fn.Namespace.RDFS.iri.value,owl:Fn.Namespace.OWL.iri.value,xsd:Fn.Namespace.XSD.iri.value,exo:Fn.Namespace.EXO.iri.value,ems:Fn.Namespace.EMS.iri.value},rm=class{static{o(this,"RDFSerializer")}constructor(e){this.store=e,this.turtleSerializer=new B4.TurtleSerializer,this.nTriplesSerializer=new U4.NTriplesSerializer,this.jsonldSerializer=new q4.JSONLDSerializer,this.turtleParser=new G4.TurtleParser,this.nTriplesParser=new W4.NTriplesParser}async serialize(e,t={}){let r=await this.store.match();return this.serializeTriples(r,e,t)}serializeTriples(e,t,r={}){switch(t){case"turtle":return this.turtleSerializer.serialize(e,{prefixes:r.prefixes,includeDefaultPrefixes:r.includeDefaultPrefixes,newline:r.newline});case"n-triples":return this.nTriplesSerializer.serialize(e,{newline:r.newline});case"json-ld":return this.jsonldSerializer.serialize(e,{context:r.prefixes,pretty:r.pretty,indent:r.indent});default:throw new Error(`Unsupported serialization format: ${t}`)}}stream(e,t={}){let r=t.newline??H4,i=t.batchSize??z4,s=t.includeDefaultPrefixes,a=t.prefixes,c=this,u=!1,l=[],f=[],h=0,d=o(async()=>{if(!u){if(f=await c.store.match(),e==="json-ld"){let _=c.jsonldSerializer.toDocument(f,{context:a,pretty:!1});l.push(...c.buildJsonLdChunks(_))}else if(e==="turtle"){let _=c.turtleSerializer.serializePrefixes(c.composePrefixes(a,s),r);_&&l.push(`${_}${r}${r}`)}u=!0}},"ensureInitialized");return{async next(){if(await d(),l.length>0)return{value:l.shift(),done:!1};if(e==="json-ld")return{value:void 0,done:!0};if(h>=f.length)return{value:void 0,done:!0};let _=f.slice(h,h+i);h+=_.length;let b="";if(e==="turtle"){let C=c.turtleSerializer.serializeTriplesOnly(_,r);C&&(b=`${C}${r}`)}else e==="n-triples"&&(b=c.nTriplesSerializer.serializeChunk(_,r));return b?{value:b,done:!1}:this.next()},async return(){return l=[],f=[],h=0,{value:void 0,done:!0}},[Symbol.asyncIterator](){return this}}}async load(e,t,r={}){let i=this.parse(e,t,r);return r.mode!=="append"&&await this.store.clear(),await this.store.addAll(i),i.length}parse(e,t,r={}){switch(t){case"turtle":return this.turtleParser.parse(e,this.buildTurtleParseOptions(r));case"n-triples":return this.nTriplesParser.parse(e,this.buildNTriplesParseOptions(r));case"json-ld":return this.parseJsonLd(e,r);default:throw new Error(`Unsupported serialization format: ${t}`)}}buildTurtleParseOptions(e){return{prefixes:this.composePrefixes(e.prefixes,!0),strict:e.strict}}buildNTriplesParseOptions(e){return{prefixes:this.composePrefixes(e.prefixes,!0),strict:e.strict}}composePrefixes(e,t){return t??!0?{...K4,...e??{}}:{...e??{}}}parseJsonLd(e,t){let r;try{r=JSON.parse(e)}catch(l){throw new Error(`Invalid JSON-LD document: ${l.message}`)}let i=this.composePrefixes(t.prefixes,!0),s=this.extractContext(r),a={...i,...s},c=this.extractGraph(r),u=[];return c.forEach((l,f)=>{if(!l||typeof l!="object"||Array.isArray(l))throw new Error(`Invalid JSON-LD node at index ${f}`);let h=this.parseSubjectFromNode(l,a,f),d=Object.entries(l);for(let[m,_]of d){if(m==="@id"||m==="@context")continue;if(m==="@type"){this.collectTypeTriples(h,_,u,a);continue}let b=this.expandTerm(m,a),C=new _s.IRI(b);this.collectTriplesForValue(h,C,_,u,a)}}),u}extractContext(e){if(!e||typeof e!="object"||Array.isArray(e))return{};let t=e["@context"];if(!t||typeof t!="object"||Array.isArray(t))return{};let r={};return Object.entries(t).forEach(([i,s])=>{typeof s=="string"&&(r[i]=s)}),r}extractGraph(e){if(Array.isArray(e))return e;if(!e||typeof e!="object")return[];let t=e["@graph"];return Array.isArray(t)?t:[e]}parseSubjectFromNode(e,t,r){let i=e["@id"];if(typeof i=="string"){if(i.startsWith("_:"))return new tm.BlankNode(i.slice(2));if(this.isAbsoluteIri(i))return new _s.IRI(i);let s=this.expandTerm(i,t);return new _s.IRI(s)}return new tm.BlankNode(`jsonld_${r}`)}collectTypeTriples(e,t,r,i){let s=Fn.Namespace.RDF.term("type");(Array.isArray(t)?t:[t]).forEach(c=>{if(typeof c!="string")throw new Error("Invalid @type value in JSON-LD node");let u=this.expandTerm(c,i);r.push(new sa.Triple(e,s,new _s.IRI(u)))})}collectTriplesForValue(e,t,r,i,s){if(r!=null){if(Array.isArray(r)){r.forEach(a=>this.collectTriplesForValue(e,t,a,i,s));return}if(typeof r=="object"){let a=r;if(typeof a["@id"]=="string"){let c=this.parseIdNode(a["@id"],s);i.push(new sa.Triple(e,t,c));return}if(a["@value"]!==void 0){let c=this.parseLiteralObject(a,s);i.push(new sa.Triple(e,t,c));return}}if(typeof r=="string"){i.push(new sa.Triple(e,t,new bs.Literal(r)));return}if(typeof r=="number"){let a=Number.isInteger(r)?Fn.Namespace.XSD.term("integer"):Fn.Namespace.XSD.term("decimal");i.push(new sa.Triple(e,t,new bs.Literal(r.toString(),a)));return}if(typeof r=="boolean"){let a=Fn.Namespace.XSD.term("boolean");i.push(new sa.Triple(e,t,new bs.Literal(r.toString(),a)));return}throw new Error("Unsupported JSON-LD value encountered")}}parseIdNode(e,t){if(e.startsWith("_:"))return new tm.BlankNode(e.slice(2));if(this.isAbsoluteIri(e))return new _s.IRI(e);let r=this.expandTerm(e,t);return new _s.IRI(r)}parseLiteralObject(e,t){let r=e["@value"];if(typeof r!="string")throw new Error("JSON-LD literal values must be strings");if(typeof e["@language"]=="string"){let i=e["@direction"];return i==="ltr"||i==="rtl"?new bs.Literal(r,void 0,e["@language"],i):new bs.Literal(r,void 0,e["@language"])}if(typeof e["@type"]=="string"){let i=this.expandTerm(e["@type"],t);return new bs.Literal(r,new _s.IRI(i))}return new bs.Literal(r)}expandTerm(e,t){if(this.isAbsoluteIri(e))return e;let r=e.indexOf(":");if(r>0){let s=e.slice(0,r),a=e.slice(r+1),c=t[s];if(!c)throw new Error(`Unknown prefix "${s}" in JSON-LD document`);return`${c}${a}`}let i=t["@vocab"];if(i)return`${i}${e}`;throw new Error(`Unable to expand JSON-LD term "${e}"`)}isAbsoluteIri(e){return/^[a-z][a-z0-9+.-]*:/i.test(e)}buildJsonLdChunks(e){let t=[],r=JSON.stringify(e["@context"]);return t.push(`{"@context":${r},"@graph":[`),e["@graph"].forEach((i,s)=>{let a=JSON.stringify(i);s>0?t.push(`,${a}`):t.push(a)}),t.push(`]}
`),t}};Zu.RDFSerializer=rm});var t3=v(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.TransactionError=xi.TripleNotFoundError=xi.TripleAlreadyExistsError=void 0;var nm=class extends Error{static{o(this,"TripleAlreadyExistsError")}constructor(e){super(`Triple already exists: ${e.toString()}`),this.name="TripleAlreadyExistsError"}};xi.TripleAlreadyExistsError=nm;var im=class extends Error{static{o(this,"TripleNotFoundError")}constructor(e){super(`Triple not found: ${e.toString()}`),this.name="TripleNotFoundError"}};xi.TripleNotFoundError=im;var sm=class extends Error{static{o(this,"TransactionError")}constructor(e){super(e),this.name="TransactionError"}};xi.TransactionError=sm});var om=v(el=>{"use strict";Object.defineProperty(el,"__esModule",{value:!0});el.LRUCache=void 0;var am=class{static{o(this,"LRUCache")}constructor(e){this.maxSize=e,this.cache=new Map}get(e){let t=this.cache.get(e);return t!==void 0&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){let r=this.cache.keys().next().value;r!==void 0&&this.cache.delete(r)}this.cache.set(e,t)}clear(){this.cache.clear()}size(){return this.cache.size}};el.LRUCache=am});var r3=v(rl=>{"use strict";Object.defineProperty(rl,"__esModule",{value:!0});rl.InMemoryTripleStore=void 0;var Ci=t3(),tl=Xe(),Q4=Wt(),Y4=dt(),X4=Dn(),J4=om(),Z4=X4.Namespace.XSD.term("string").value,eD=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi,aa="__default__",cm=class n{static{o(this,"InMemoryTripleStore")}constructor(){this.triples=new Map,this.spo=new Map,this.sop=new Map,this.pso=new Map,this.pos=new Map,this.osp=new Map,this.ops=new Map,this.queryCache=new J4.LRUCache(1e3),this.uuidIndex=new Map,this.namedGraphs=new Map}async add(e){let t=this.getTripleKey(e);if(this.triples.has(t))return;this.triples.set(t,e);let r=this.getNodeKey(e.subject),i=this.getNodeKey(e.predicate),s=this.getNodeKey(e.object);this.addToIndex(this.spo,r,i,s),this.addToIndex(this.sop,r,s,i),this.addToIndex(this.pso,i,r,s),this.addToIndex(this.pos,i,s,r),this.addToIndex(this.osp,s,r,i),this.addToIndex(this.ops,s,i,r),this.addToUUIDIndex(e.subject),this.queryCache.clear()}async remove(e){let t=this.getTripleKey(e);if(!this.triples.has(t))return!1;this.triples.delete(t);let r=this.getNodeKey(e.subject),i=this.getNodeKey(e.predicate),s=this.getNodeKey(e.object);return this.removeFromIndex(this.spo,r,i,s),this.removeFromIndex(this.sop,r,s,i),this.removeFromIndex(this.pso,i,r,s),this.removeFromIndex(this.pos,i,s,r),this.removeFromIndex(this.osp,s,r,i),this.removeFromIndex(this.ops,s,i,r),this.queryCache.clear(),!0}async has(e){let t=this.getTripleKey(e);return this.triples.has(t)}async match(e,t,r){let i=this.getMatchCacheKey(e,t,r),s=this.queryCache.get(i);if(s!==void 0)return s;let a;return!e&&!t&&!r?a=Array.from(this.triples.values()):e&&t&&r?a=this.matchSPO(e,t,r):e&&t?a=this.matchSP(e,t):e&&r?a=this.matchSO(e,r):t&&r?a=this.matchPO(t,r):e?a=this.matchS(e):t?a=this.matchP(t):r?a=this.matchO(r):a=[],this.queryCache.set(i,a),a}async addAll(e){for(let t of e)await this.add(t)}async removeAll(e){let t=0;for(let r of e)await this.remove(r)&&t++;return t}async clear(){this.triples.clear(),this.spo.clear(),this.sop.clear(),this.pso.clear(),this.pos.clear(),this.osp.clear(),this.ops.clear(),this.uuidIndex.clear(),this.queryCache.clear()}async count(){return this.triples.size}async subjects(){let e=new Set;for(let t of this.triples.values())e.add(t.subject);return Array.from(e)}async predicates(){let e=new Set;for(let t of this.triples.values())e.add(t.predicate);return Array.from(e)}async objects(){let e=new Set;for(let t of this.triples.values())e.add(t.object);return Array.from(e)}async beginTransaction(){return new um(this)}async findSubjectsByUUID(e){return this.findSubjectsByUUIDSync(e)}findSubjectsByUUIDSync(e){let t=e.toLowerCase(),r=this.uuidIndex.get(t);if(!r||r.size===0)return[];let i=[];for(let s of r)this.spo.has(`i:${s}`)&&i.push(new tl.IRI(s));return i}addToUUIDIndex(e){if(!(e instanceof tl.IRI))return;let t=e.value,r=t.match(eD);if(r)for(let i of r){let s=i.toLowerCase();this.uuidIndex.has(s)||this.uuidIndex.set(s,new Set),this.uuidIndex.get(s).add(t)}}matchSPO(e,t,r){let i=this.getNodeKey(e),s=this.getNodeKey(t),a=this.getNodeKey(r),c=this.spo.get(i);if(!c)return[];let u=c.get(s);if(!u)return[];if(u.has(a)){let l=this.buildTripleKey(i,s,a),f=this.triples.get(l);return f?[f]:[]}return[]}matchSP(e,t){let r=this.getNodeKey(e),i=this.getNodeKey(t),s=this.spo.get(r);if(!s)return[];let a=s.get(i);return a?this.getTriplesByKeys(Array.from(a).map(c=>this.buildTripleKey(r,i,c))):[]}matchSO(e,t){let r=this.getNodeKey(e),i=this.getNodeKey(t),s=this.sop.get(r);if(!s)return[];let a=s.get(i);return a?this.getTriplesByKeys(Array.from(a).map(c=>this.buildTripleKey(r,c,i))):[]}matchPO(e,t){let r=this.getNodeKey(e),i=this.getNodeKey(t),s=this.pos.get(r);if(!s)return[];let a=s.get(i);return a?this.getTriplesByKeys(Array.from(a).map(c=>this.buildTripleKey(c,r,i))):[]}matchS(e){let t=this.getNodeKey(e),r=this.spo.get(t);if(!r)return[];let i=[];for(let[s,a]of r.entries())for(let c of a)i.push(this.buildTripleKey(t,s,c));return this.getTriplesByKeys(i)}matchP(e){let t=this.getNodeKey(e),r=this.pso.get(t);if(!r)return[];let i=[];for(let[s,a]of r.entries())for(let c of a)i.push(this.buildTripleKey(s,t,c));return this.getTriplesByKeys(i)}matchO(e){let t=this.getNodeKey(e),r=this.osp.get(t);if(!r)return[];let i=[];for(let[s,a]of r.entries())for(let c of a)i.push(this.buildTripleKey(s,c,t));return this.getTriplesByKeys(i)}getTriplesByKeys(e){let t=[];for(let r of e){let i=this.triples.get(r);i&&t.push(i)}return t}addToIndex(e,t,r,i){e.has(t)||e.set(t,new Map);let s=e.get(t);s.has(r)||s.set(r,new Set),s.get(r).add(i)}removeFromIndex(e,t,r,i){let s=e.get(t);if(!s)return;let a=s.get(r);a&&(a.delete(i),a.size===0&&s.delete(r),s.size===0&&e.delete(t))}getTripleKey(e){let t=this.getNodeKey(e.subject),r=this.getNodeKey(e.predicate),i=this.getNodeKey(e.object);return this.buildTripleKey(t,r,i)}buildTripleKey(e,t,r){return`${e}|${t}|${r}`}getNodeKey(e){if(e instanceof tl.IRI)return`i:${e.value}`;if(e instanceof Q4.BlankNode)return`b:${e.id}`;if(e instanceof Y4.Literal){let t=`l:${e.value}`;return e.datatype&&e.datatype.value!==Z4?t+=`^^${e.datatype.value}`:e.language&&(t+=`@${e.language}`),t}return""}getMatchCacheKey(e,t,r){let i=e?this.getNodeKey(e):"?",s=t?this.getNodeKey(t):"?",a=r?this.getNodeKey(r):"?";return`${i}|${s}|${a}`}getGraphKey(e){return e?e.value:aa}getOrCreateGraphStore(e){let t=this.getGraphKey(e);return t===aa?this:(this.namedGraphs.has(t)||this.namedGraphs.set(t,new n),this.namedGraphs.get(t))}async addToGraph(e,t){await this.getOrCreateGraphStore(t).add(e)}async removeFromGraph(e,t){let r=this.getGraphKey(t);if(r===aa)return this.remove(e);let i=this.namedGraphs.get(r);return i?i.remove(e):!1}async matchInGraph(e,t,r,i){let s=this.getGraphKey(i);if(s===aa)return this.match(e,t,r);let a=this.namedGraphs.get(s);return a?a.match(e,t,r):[]}async getNamedGraphs(){return Array.from(this.namedGraphs.keys()).map(e=>new tl.IRI(e))}async hasGraph(e){let t=this.namedGraphs.get(e.value);return t?await t.count()>0:!1}async clearGraph(e){let t=this.getGraphKey(e);if(t===aa){await this.clear();return}let r=this.namedGraphs.get(t);r&&(await r.clear(),this.namedGraphs.delete(t))}async countInGraph(e){let t=this.getGraphKey(e);if(t===aa)return this.count();let r=this.namedGraphs.get(t);return r?r.count():0}};rl.InMemoryTripleStore=cm;var um=class{static{o(this,"InMemoryTransaction")}constructor(e){this.store=e,this.operations=[],this.committed=!1,this.rolledBack=!1}async add(e){if(this.committed)throw new Ci.TransactionError("Transaction already committed");if(this.rolledBack)throw new Ci.TransactionError("Transaction already rolled back");this.operations.push({type:"add",triple:e})}async remove(e){if(this.committed)throw new Ci.TransactionError("Transaction already committed");if(this.rolledBack)throw new Ci.TransactionError("Transaction already rolled back");return this.operations.push({type:"remove",triple:e}),!0}async commit(){if(this.committed)throw new Ci.TransactionError("Transaction already committed");if(this.rolledBack)throw new Ci.TransactionError("Transaction already rolled back");for(let e of this.operations)e.type==="add"?await this.store.add(e.triple):await this.store.remove(e.triple);this.committed=!0,this.operations=[]}async rollback(){if(this.committed)throw new Ci.TransactionError("Transaction already committed");if(this.rolledBack)throw new Ci.TransactionError("Transaction already rolled back");this.operations=[],this.rolledBack=!0}}});var fm=v(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0});nl.RDFVocabularyMapper=void 0;var Ir=wi(),n3=Xe(),me=Dn(),lm=class{static{o(this,"RDFVocabularyMapper")}constructor(){this.propertyMappings=new Map([["exo__Instance_class",me.Namespace.RDF.term("type")],["exo__Asset_isDefinedBy",me.Namespace.RDFS.term("isDefinedBy")],["exo__Class_superClass",me.Namespace.RDFS.term("subClassOf")],["exo__Property_range",me.Namespace.RDFS.term("range")],["exo__Property_domain",me.Namespace.RDFS.term("domain")],["exo__Property_superProperty",me.Namespace.RDFS.term("subPropertyOf")]])}generateClassHierarchyTriples(){let e=[];return e.push(new Ir.Triple(me.Namespace.EXO.term("Asset"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.RDFS.term("Resource"))),e.push(new Ir.Triple(me.Namespace.EXO.term("Class"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.RDFS.term("Class"))),e.push(new Ir.Triple(me.Namespace.EXO.term("Property"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.RDF.term("Property"))),e.push(new Ir.Triple(me.Namespace.EMS.term("Task"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.EXO.term("Asset"))),e.push(new Ir.Triple(me.Namespace.EMS.term("Project"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.EXO.term("Asset"))),e.push(new Ir.Triple(me.Namespace.EMS.term("Area"),me.Namespace.RDFS.term("subClassOf"),me.Namespace.EXO.term("Asset"))),e}generatePropertyHierarchyTriples(){let e=[];return e.push(new Ir.Triple(me.Namespace.EXO.term("Instance_class"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDF.term("type"))),e.push(new Ir.Triple(me.Namespace.EXO.term("Asset_isDefinedBy"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("isDefinedBy"))),e.push(new Ir.Triple(me.Namespace.EXO.term("Class_superClass"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("subClassOf"))),e.push(new Ir.Triple(me.Namespace.EXO.term("Property_range"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("range"))),e.push(new Ir.Triple(me.Namespace.EXO.term("Property_domain"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("domain"))),e.push(new Ir.Triple(me.Namespace.EXO.term("Property_superProperty"),me.Namespace.RDFS.term("subPropertyOf"),me.Namespace.RDFS.term("subPropertyOf"))),e}generateMappedTriple(e,t,r){let i=this.propertyMappings.get(t);if(!i)return null;let s;if(r instanceof n3.IRI)s=r;else{let a=r.match(/^(ems|exo)__(.+)$/);if(a){let[,c,u]=a;s=(c==="ems"?me.Namespace.EMS:me.Namespace.EXO).term(u)}else s=new n3.IRI(r)}return new Ir.Triple(e,i,s)}hasMappingFor(e){return this.propertyMappings.has(e)}};nl.RDFVocabularyMapper=lm});var dm=v(dn=>{"use strict";var tD=dn&&dn.__decorate||function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},rD=dn&&dn.__metadata||function(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)},nD=dn&&dn.__param||function(n,e){return function(t,r){e(t,r,n)}};Object.defineProperty(dn,"__esModule",{value:!0});dn.NoteToRDFConverter=void 0;var i3=Je(),il=wi(),s3=Xe(),Rn=dt(),si=Dn(),iD=at(),sD=fm(),hm=class{static{o(this,"NoteToRDFConverter")}constructor(e){this.vault=e,this.OBSIDIAN_VAULT_SCHEME="obsidian://vault/",this.vocabularyMapper=new sD.RDFVocabularyMapper}async convertNote(e){let t=this.vault.getFrontmatter(e);if(!t)return[];let r=[],i=this.notePathToIRI(e.path),s=si.Namespace.EXO.term("Asset_fileName");r.push(new il.Triple(i,s,new Rn.Literal(e.basename)));for(let[a,c]of Object.entries(t)){if(!this.isExocortexProperty(a))continue;let u=this.propertyKeyToIRI(a),l=Array.isArray(c)?c:[c];for(let f of l)if(a==="exo__Instance_class"){let h=this.valueToClassURI(f);r.push(new il.Triple(i,u,h))}else{let h=await this.valueToRDFObject(f,e);if(r.push(new il.Triple(i,u,h)),this.vocabularyMapper.hasMappingFor(a)&&h instanceof s3.IRI){let d=this.vocabularyMapper.generateMappedTriple(i,a,h);d&&r.push(d)}}if(a==="exo__Instance_class")for(let f of l){let h=this.expandClassValue(f);if(h){let d=si.Namespace.RDF.term("type");r.push(new il.Triple(i,d,h))}}}return r}async convertVault(){let e=this.vault.getAllFiles(),t=[];for(let r of e)try{let i=await this.convertNote(r);t.push(...i)}catch(i){console.warn(`\u26A0\uFE0F Skipping file with invalid IRI: ${r.path}`),console.warn(`   Reason: ${i instanceof Error?i.message:String(i)}`);continue}return t}notePathToIRI(e){let t=encodeURI(e);return new s3.IRI(`${this.OBSIDIAN_VAULT_SCHEME}${t}`)}isExocortexProperty(e){return e.startsWith("exo__")||e.startsWith("ems__")}propertyKeyToIRI(e){if(e.startsWith("exo__")){let t=e.substring(5);return si.Namespace.EXO.term(t)}if(e.startsWith("ems__")){let t=e.substring(5);return si.Namespace.EMS.term(t)}throw new Error(`Invalid property key: ${e}`)}async valueToRDFObject(e,t){if(typeof e=="string"){let r=this.removeQuotes(e),i=this.extractWikilink(r);if(i){let s=this.vault.getFirstLinkpathDest(i,t.path);if(s)return this.notePathToIRI(s.path);if(this.isClassReference(i)){let a=this.expandClassValue(i);if(a)return a}return new Rn.Literal(r)}if(this.isClassReference(r)){let s=this.expandClassValue(r);if(s)return s}return this.isISO8601DateTime(r)?new Rn.Literal(r,si.Namespace.XSD.term("dateTime")):new Rn.Literal(r)}return typeof e=="boolean"?new Rn.Literal(e.toString()):typeof e=="number"?new Rn.Literal(e.toString(),si.Namespace.XSD.term("decimal")):e instanceof Date?new Rn.Literal(e.toISOString(),si.Namespace.XSD.term("dateTime")):new Rn.Literal(String(e))}isISO8601DateTime(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{1,3})?(Z|[+-]\d{2}:\d{2})?$/.test(e)}removeQuotes(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.substring(1,t.length-1):e}extractWikilink(e){let t=e.match(/^\[\[([^\]]+)\]\]$/);return t?t[1]:null}valueToClassURI(e){if(typeof e!="string")return new Rn.Literal(String(e));let t=this.removeQuotes(e),i=this.extractWikilink(t)||t,s=this.expandClassValue(i);return s||new Rn.Literal(t)}isClassReference(e){return(e.startsWith("ems__")||e.startsWith("exo__"))&&!/\s/.test(e)}expandClassValue(e){let t=this.removeQuotes(e);if(t.startsWith("ems__")){let r=t.substring(5);return si.Namespace.EMS.term(r)}if(t.startsWith("exo__")){let r=t.substring(5);return si.Namespace.EXO.term(r)}return null}};dn.NoteToRDFConverter=hm;dn.NoteToRDFConverter=hm=tD([(0,i3.injectable)(),nD(0,(0,i3.inject)(iD.DI_TOKENS.IVaultAdapter)),rD("design:paramtypes",[Object])],hm)});var pm=v((TM,a3)=>{var oa=class{static{o(this,"Wildcard")}constructor(){return aD||this}equals(e){return e&&this.termType===e.termType}};Object.defineProperty(oa.prototype,"value",{enumerable:!0,value:"*"});Object.defineProperty(oa.prototype,"termType",{enumerable:!0,value:"Wildcard"});var aD=new oa;a3.exports.Wildcard=oa});var c3=v((xM,o3)=>{var oD=(function(){var n=o(function(A,T,D,R){for(D=D||{},R=A.length;R--;D[A[R]]=T);return D},"o"),e=[6,12,13,15,16,24,32,36,41,45,100,110,113,115,116,123,126,131,197,224,229,308,329,330,331,332,333],t=[2,247],r=[100,110,113,115,116,123,126,131,329,330,331,332,333],i=[2,409],s=[1,18],a=[1,27],c=[13,16,45,197,224,229,308],u=[28,29,53],l=[28,53],f=[1,42],h=[1,45],d=[1,41],m=[1,44],_=[123,126],b=[1,67],C=[39,45,87],O=[13,16,45,197,224,308],I=[1,87],L=[2,281],G=[1,86],W=[13,16,45,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],Fe=[6,28,29,53,63,70,73,81,83,85],Ze=[6,13,16,28,29,53,63,70,73,81,83,85,87,308],ot=[6,13,16,28,29,45,53,63,70,73,81,82,83,85,87,89,197,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314],B=[6,13,16,28,29,31,39,45,47,48,53,63,70,73,81,82,83,85,87,89,109,112,121,123,126,128,159,160,161,163,164,174,193,197,224,229,231,232,242,246,250,263,265,272,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,337,338,340,341,342,343,344,345,346],ue=[13,16,308],be=[112,132,327,334],He=[13,16,112,132,308],qe=[1,111],et=[1,117],Le=[112,132,327,328,334],je=[13,16,112,132,308,328],Re=[28,29,45,53,87],H=[1,138],k=[1,151],Me=[1,128],Ge=[1,127],V=[1,129],de=[1,140],xe=[1,141],z=[1,142],Ce=[1,143],Oe=[1,144],Se=[1,145],De=[1,147],le=[1,148],Ee=[2,457],pe=[1,158],Te=[1,159],Ie=[1,160],X=[1,152],re=[1,153],ne=[1,156],J=[1,171],Z=[1,172],ee=[1,173],te=[1,174],ie=[1,175],se=[1,176],ae=[1,167],oe=[1,168],Q=[1,169],ce=[1,170],Ne=[1,157],Pe=[1,166],we=[1,161],w=[1,162],E=[1,163],y=[1,164],x=[1,165],U=[6,13,16,29,31,45,82,85,87,89,112,159,160,161,163,164,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335],Ke=[1,195],nt=[6,31,73,81,83,85],_e=[2,285],j=[1,199],M=[1,201],$=[6,31,70,73,81,83,85],q=[2,283],ge=[1,207],Ve=[1,218],$e=[1,223],Ft=[1,219],vr=[1,225],xr=[1,226],rr=[1,224],M0=[6,63,70,73,81,83,85],V0=[1,236],$0=[2,334],B0=[1,243],U0=[1,241],Rt=[6,193],Cc=[2,349],q0=[2,339],gi=[28,128],G0=[47,48,193,272],Oc=[47,48,193,242,272],$s=[47,48,193,242,246,272],Bs=[47,48,193,242,246,250,263,265,272,290,297,298,299,300,301,302,341,342,343,344,345,346],xt=[39,47,48,193,242,246,250,263,265,272,290,297,298,299,300,301,302,338,341,342,343,344,345,346],W0=[1,271],z0=[1,270],gt=[6,13,16,29,31,39,45,47,48,70,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,231,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,338,341,342,343,344,345,346,347,348,349,350,351],H0=[1,281],K0=[1,280],nr=[13,16,29,31,39,45,47,48,82,85,87,89,112,159,160,161,163,164,174,193,197,224,229,231,232,242,246,250,263,265,272,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,338,341,342,343,344,345,346],io=[45,89],Dc=[13,16,29,31,39,45,47,48,82,85,87,89,112,159,160,161,163,164,174,193,197,224,229,231,232,242,246,250,263,265,272,290,292,293,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,338,341,342,343,344,345,346],Ic=[13,16,31,82,174,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312],Pc=[31,89],Fc=[48,87],Ki=[6,13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,337,338],En=[6,13,16,39,45,48,82,87,89,231,263,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,337,338,340],Q0=[1,313],Us=[6,85],zf=[6,31,81,83,85],Y0=[2,361],Wn=[2,353],Qi=[1,343],so=[31,112,335],zn=[13,16,29,31,45,48,82,85,87,89,112,159,160,161,163,164,193,197,224,229,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],Hf=[13,16,29,31,45,48,82,85,87,89,112,159,160,161,163,164,193,197,224,229,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335],X0=[6,109,193],Yi=[31,112],yt=[13,16,45,82,87,224,263,265,268,269,270,271,273,274,276,277,279,280,283,285,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312,346,347,348,349,350,351],Kf=[1,390],Qf=[1,391],yi=[13,16,87,197,308,314],J0=[13,16,39,45,82,87,224,263,265,268,269,270,271,273,274,276,277,279,280,283,285,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312,346,347,348,349,350,351],Rc=[1,417],Nc=[1,418],Z0=[13,16,48,197,229,308],vi=[6,31,85],e1=[6,13,16,31,45,73,81,83,85,268,269,270,271,273,274,276,277,279,280,283,285,308,346,347,348,349,350,351],Yf=[6,13,16,29,31,45,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,231,268,269,270,271,273,274,276,277,279,280,283,285,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,346,347,348,349,350,351],Xi=[29,31,85,112,159,160,161,163,164],kc=[1,443],Lc=[1,444],t1=[1,449],Ji=[31,112,193,232,318,335],jc=[13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],r1=[13,16,31,45,48,82,87,89,112,193,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],Xf=[13,16,29,31,45,48,82,85,87,89,112,159,160,161,163,164,193,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],ao=[13,16,31,48,82,174,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312],oo=[31,45],n1=[1,507],i1=[1,508],s1=[6,13,16,29,31,39,45,47,48,63,70,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,231,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,336,338,341,342,343,344,345,346,347,348,349,350,351],Mc=[29,31,85,112,159,160,161,163,164,335],Zi=[6,13,16,31,45,70,73,81,83,85,87,268,269,270,271,273,274,276,277,279,280,283,285,308,346,347,348,349,350,351],a1=[13,16,31,45,48,82,87,89,112,193,197,231,232,272,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,317,318,335],o1=[2,352],Jf=[13,16,197,308,314],c1=[1,565],qs=[6,13,16,31,45,76,78,81,83,85,87,268,269,270,271,273,274,276,277,279,280,283,285,308,346,347,348,349,350,351],u1=[13,16,29,31,45,82,85,87,89,112,159,160,161,163,164,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],Hn=[13,16,29,31,45,82,85,87,89,112,159,160,161,163,164,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335],l1=[13,16,87,308],Kn=[2,364],Gs=[29,31,85,112,159,160,161,163,164,193,232,318,335],Vc=[31,112,193,232,272,318,335],Qn=[2,359],f1=[13,16,48,82,174,294,295,296,297,298,299,300,301,302,303,304,305,306,308,312],$c=[29,31,85,112,159,160,161,163,164,193,232,272,318,335],h1=[13,16,31,45,82,87,89,112,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],d1=[2,347],Zf={trace:o(function(){},"trace"),yy:{},symbols_:{error:2,QueryOrUpdate:3,Prologue:4,QueryOrUpdate_group0:5,EOF:6,Query:7,Qry:8,Query_option0:9,Prologue_repetition0:10,BaseDecl:11,BASE:12,IRIREF:13,PrefixDecl:14,PREFIX:15,PNAME_NS:16,SelectClauseWildcard:17,Qry_repetition0:18,WhereClause:19,SolutionModifierNoGroup:20,SelectClauseVars:21,Qry_repetition1:22,SolutionModifier:23,CONSTRUCT:24,ConstructTemplate:25,Qry_repetition2:26,Qry_repetition3:27,WHERE:28,"{":29,Qry_option0:30,"}":31,DESCRIBE:32,Qry_group0:33,Qry_repetition4:34,Qry_option1:35,ASK:36,Qry_repetition5:37,SelectClauseBase:38,"*":39,SelectClauseVars_repetition_plus0:40,SELECT:41,SelectClauseBase_option0:42,SelectClauseItem:43,Var:44,"(":45,Expression:46,AS:47,")":48,SubSelect:49,SubSelect_option0:50,SubSelect_option1:51,DatasetClause:52,FROM:53,DatasetClause_option0:54,iri:55,WhereClause_option0:56,GroupGraphPattern:57,SolutionModifier_option0:58,SolutionModifierNoGroup_option0:59,SolutionModifierNoGroup_option1:60,SolutionModifierNoGroup_option2:61,GroupClause:62,GROUP:63,BY:64,GroupClause_repetition_plus0:65,GroupCondition:66,BuiltInCall:67,FunctionCall:68,HavingClause:69,HAVING:70,HavingClause_repetition_plus0:71,OrderClause:72,ORDER:73,OrderClause_repetition_plus0:74,OrderCondition:75,ASC:76,BrackettedExpression:77,DESC:78,Constraint:79,LimitOffsetClauses:80,LIMIT:81,INTEGER:82,OFFSET:83,ValuesClause:84,VALUES:85,InlineData:86,VAR:87,InlineData_repetition0:88,NIL:89,InlineData_repetition1:90,InlineData_repetition_plus2:91,InlineData_repetition3:92,DataBlock:93,DataBlockValueList:94,DataBlockValueList_repetition_plus0:95,Update:96,Update_repetition0:97,Update1:98,Update_option0:99,LOAD:100,Update1_option0:101,Update1_option1:102,Update1_group0:103,Update1_option2:104,GraphRefAll:105,Update1_group1:106,Update1_option3:107,GraphOrDefault:108,TO:109,CREATE:110,Update1_option4:111,GRAPH:112,INSERTDATA:113,QuadPattern:114,DELETEDATA:115,DELETEWHERE:116,Update1_option5:117,InsertDeleteClause:118,Update1_repetition0:119,IntoGraphClause:120,INTO:121,GraphRef:122,DELETE:123,InsertDeleteClause_option0:124,InsertClause:125,INSERT:126,UsingClause:127,USING:128,UsingClause_option0:129,WithClause:130,WITH:131,DEFAULT:132,GraphOrDefault_option0:133,GraphRefAll_group0:134,Quads:135,Quads_option0:136,Quads_repetition0:137,QuadsNotTriples:138,VarOrIri:139,QuadsNotTriples_option0:140,QuadsNotTriples_option1:141,QuadsNotTriples_option2:142,TriplesTemplate:143,TriplesTemplate_repetition0:144,TriplesSameSubject:145,TriplesTemplate_option0:146,GroupGraphPatternSub:147,GroupGraphPatternSub_option0:148,GroupGraphPatternSub_repetition0:149,GroupGraphPatternSubTail:150,GraphPatternNotTriples:151,GroupGraphPatternSubTail_option0:152,GroupGraphPatternSubTail_option1:153,TriplesBlock:154,TriplesBlock_repetition0:155,TriplesSameSubjectPath:156,TriplesBlock_option0:157,GroupOrUnionGraphPattern:158,OPTIONAL:159,MINUS:160,SERVICE:161,GraphPatternNotTriples_option0:162,FILTER:163,BIND:164,InlineDataOneVar:165,InlineDataFull:166,InlineDataOneVar_repetition0:167,InlineDataFull_repetition0:168,InlineDataFull_repetition_plus1:169,InlineDataFull_repetition2:170,DataBlockValue:171,Literal:172,QuotedTriple:173,UNDEF:174,GroupOrUnionGraphPattern_repetition0:175,ArgList:176,ArgList_option0:177,ArgList_repetition0:178,ExpressionList:179,ExpressionList_repetition0:180,ConstructTemplate_option0:181,ConstructTriples:182,ConstructTriples_repetition0:183,ConstructTriples_option0:184,VarOrTermOrQuotedTP:185,PropertyListNotEmpty:186,TriplesNode:187,PropertyList:188,PropertyList_option0:189,VerbObjectList:190,PropertyListNotEmpty_repetition0:191,SemiOptionalVerbObjectList:192,";":193,SemiOptionalVerbObjectList_option0:194,Verb:195,ObjectList:196,a:197,ObjectList_repetition0:198,Object:199,GraphNode:200,Object_option0:201,PropertyListPathNotEmpty:202,TriplesNodePath:203,TriplesSameSubjectPath_option0:204,O:205,PropertyListPathNotEmpty_repetition0:206,PropertyListPathNotEmptyTail:207,O_group0:208,ObjectListPath:209,ObjectListPath_repetition0:210,ObjectPath:211,GraphNodePath:212,ObjectPath_option0:213,Path:214,Path_repetition0:215,PathSequence:216,PathSequence_repetition0:217,PathEltOrInverse:218,PathElt:219,PathPrimary:220,PathElt_option0:221,PathEltOrInverse_option0:222,IriOrA:223,"!":224,PathNegatedPropertySet:225,PathOneInPropertySet:226,PathNegatedPropertySet_repetition0:227,PathNegatedPropertySet_option0:228,"^":229,TriplesNode_repetition_plus0:230,"[":231,"]":232,TriplesNodePath_repetition_plus0:233,VarOrTermOrQuotedTPExpr:234,VarOrTerm:235,GraphTerm:236,BlankNode:237,ConditionalOrExpression:238,ConditionalAndExpression:239,ConditionalOrExpression_repetition0:240,ConditionalOrExpressionTail:241,"||":242,RelationalExpression:243,ConditionalAndExpression_repetition0:244,ConditionalAndExpressionTail:245,"&&":246,NumericExpression:247,RelationalExpression_group0:248,RelationalExpression_option0:249,IN:250,MultiplicativeExpression:251,NumericExpression_repetition0:252,AdditiveExpressionTail:253,AdditiveExpressionTail_group0:254,NumericLiteralPositive:255,AdditiveExpressionTail_repetition0:256,NumericLiteralNegative:257,AdditiveExpressionTail_repetition1:258,UnaryExpression:259,MultiplicativeExpression_repetition0:260,MultiplicativeExpressionTail:261,MultiplicativeExpressionTail_group0:262,"+":263,PrimaryExpression:264,"-":265,ExprQuotedTP:266,Aggregate:267,FUNC_ARITY0:268,FUNC_ARITY1:269,FUNC_ARITY1_SPARQL_STAR:270,FUNC_ARITY2:271,",":272,FUNC_ARITY3:273,FUNC_ARITY3_SPARQL_STAR:274,BuiltInCall_group0:275,BOUND:276,BNODE:277,BuiltInCall_option0:278,EXISTS:279,COUNT:280,Aggregate_option0:281,Aggregate_group0:282,FUNC_AGGREGATE:283,Aggregate_option1:284,GROUP_CONCAT:285,Aggregate_option2:286,Aggregate_option3:287,GroupConcatSeparator:288,SEPARATOR:289,"=":290,String:291,LANGTAG:292,"^^":293,DECIMAL:294,DOUBLE:295,BOOLEAN:296,INTEGER_POSITIVE:297,DECIMAL_POSITIVE:298,DOUBLE_POSITIVE:299,INTEGER_NEGATIVE:300,DECIMAL_NEGATIVE:301,DOUBLE_NEGATIVE:302,STRING_LITERAL1:303,STRING_LITERAL2:304,STRING_LITERAL_LONG1:305,STRING_LITERAL_LONG2:306,PrefixedName:307,PNAME_LN:308,BLANK_NODE_LABEL:309,ANON:310,QuotedTP:311,"<<":312,qtSubjectOrObject:313,">>":314,DataValueTerm:315,AnnotationPattern:316,"{|":317,"|}":318,AnnotationPatternPath:319,ExprVarOrTerm:320,QueryOrUpdate_group0_option0:321,Prologue_repetition0_group0:322,Qry_group0_repetition_plus0:323,SelectClauseBase_option0_group0:324,DISTINCT:325,REDUCED:326,NAMED:327,SILENT:328,CLEAR:329,DROP:330,ADD:331,MOVE:332,COPY:333,ALL:334,".":335,UNION:336,"|":337,"/":338,PathElt_option0_group0:339,"?":340,"!=":341,"<":342,">":343,"<=":344,">=":345,NOT:346,CONCAT:347,COALESCE:348,SUBSTR:349,REGEX:350,REPLACE:351,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",12:"BASE",13:"IRIREF",15:"PREFIX",16:"PNAME_NS",24:"CONSTRUCT",28:"WHERE",29:"{",31:"}",32:"DESCRIBE",36:"ASK",39:"*",41:"SELECT",45:"(",47:"AS",48:")",53:"FROM",63:"GROUP",64:"BY",70:"HAVING",73:"ORDER",76:"ASC",78:"DESC",81:"LIMIT",82:"INTEGER",83:"OFFSET",85:"VALUES",87:"VAR",89:"NIL",100:"LOAD",109:"TO",110:"CREATE",112:"GRAPH",113:"INSERTDATA",115:"DELETEDATA",116:"DELETEWHERE",121:"INTO",123:"DELETE",126:"INSERT",128:"USING",131:"WITH",132:"DEFAULT",159:"OPTIONAL",160:"MINUS",161:"SERVICE",163:"FILTER",164:"BIND",174:"UNDEF",193:";",197:"a",224:"!",229:"^",231:"[",232:"]",242:"||",246:"&&",250:"IN",263:"+",265:"-",268:"FUNC_ARITY0",269:"FUNC_ARITY1",270:"FUNC_ARITY1_SPARQL_STAR",271:"FUNC_ARITY2",272:",",273:"FUNC_ARITY3",274:"FUNC_ARITY3_SPARQL_STAR",276:"BOUND",277:"BNODE",279:"EXISTS",280:"COUNT",283:"FUNC_AGGREGATE",285:"GROUP_CONCAT",289:"SEPARATOR",290:"=",292:"LANGTAG",293:"^^",294:"DECIMAL",295:"DOUBLE",296:"BOOLEAN",297:"INTEGER_POSITIVE",298:"DECIMAL_POSITIVE",299:"DOUBLE_POSITIVE",300:"INTEGER_NEGATIVE",301:"DECIMAL_NEGATIVE",302:"DOUBLE_NEGATIVE",303:"STRING_LITERAL1",304:"STRING_LITERAL2",305:"STRING_LITERAL_LONG1",306:"STRING_LITERAL_LONG2",308:"PNAME_LN",309:"BLANK_NODE_LABEL",310:"ANON",312:"<<",314:">>",317:"{|",318:"|}",325:"DISTINCT",326:"REDUCED",327:"NAMED",328:"SILENT",329:"CLEAR",330:"DROP",331:"ADD",332:"MOVE",333:"COPY",334:"ALL",335:".",336:"UNION",337:"|",338:"/",340:"?",341:"!=",342:"<",343:">",344:"<=",345:">=",346:"NOT",347:"CONCAT",348:"COALESCE",349:"SUBSTR",350:"REGEX",351:"REPLACE"},productions_:[0,[3,3],[7,2],[4,1],[11,2],[14,3],[8,4],[8,4],[8,5],[8,7],[8,5],[8,4],[17,2],[21,2],[38,2],[43,1],[43,5],[49,4],[49,4],[52,3],[19,2],[23,2],[20,3],[62,3],[66,1],[66,1],[66,3],[66,5],[66,1],[69,2],[72,3],[75,2],[75,2],[75,1],[75,1],[80,2],[80,2],[80,4],[80,4],[84,2],[86,4],[86,4],[86,6],[86,2],[94,3],[96,3],[98,4],[98,3],[98,5],[98,4],[98,2],[98,2],[98,2],[98,5],[120,2],[118,3],[118,1],[125,2],[127,3],[130,2],[108,1],[108,2],[122,2],[105,1],[105,1],[114,3],[135,2],[138,7],[143,3],[57,3],[57,3],[147,2],[150,3],[154,3],[151,1],[151,2],[151,2],[151,3],[151,4],[151,2],[151,6],[151,1],[93,1],[93,1],[165,4],[166,4],[166,6],[171,1],[171,1],[171,1],[171,1],[158,2],[79,1],[79,1],[79,1],[68,2],[176,1],[176,5],[179,1],[179,4],[25,3],[182,3],[145,2],[145,2],[188,1],[186,2],[192,2],[190,2],[195,1],[195,1],[196,2],[199,2],[156,2],[156,2],[202,2],[207,1],[207,2],[205,2],[209,2],[211,2],[214,2],[216,2],[219,2],[218,2],[220,1],[220,2],[220,3],[225,1],[225,1],[225,4],[226,1],[226,2],[187,3],[187,3],[203,3],[203,3],[200,1],[200,1],[212,1],[212,1],[234,1],[235,1],[235,1],[139,1],[139,1],[44,1],[236,1],[236,1],[236,1],[236,1],[46,1],[238,2],[241,2],[239,2],[245,2],[243,1],[243,3],[243,4],[247,2],[253,2],[253,2],[253,2],[251,2],[261,2],[259,2],[259,2],[259,2],[259,1],[264,1],[264,1],[264,1],[264,1],[264,1],[264,1],[264,1],[77,3],[67,1],[67,2],[67,4],[67,4],[67,6],[67,8],[67,8],[67,2],[67,4],[67,2],[67,4],[67,3],[267,5],[267,5],[267,6],[288,4],[172,1],[172,2],[172,3],[172,1],[172,1],[172,1],[172,1],[172,1],[172,1],[255,1],[255,1],[255,1],[257,1],[257,1],[257,1],[291,1],[291,1],[291,1],[291,1],[55,1],[55,1],[307,1],[307,1],[237,1],[237,1],[311,5],[173,5],[313,1],[313,1],[313,1],[313,1],[313,1],[315,1],[315,1],[315,1],[185,1],[185,1],[185,1],[316,3],[319,3],[266,5],[320,1],[320,1],[320,1],[223,1],[223,1],[321,0],[321,1],[5,1],[5,1],[5,1],[9,0],[9,1],[322,1],[322,1],[10,0],[10,2],[18,0],[18,2],[22,0],[22,2],[26,0],[26,2],[27,0],[27,2],[30,0],[30,1],[323,1],[323,2],[33,1],[33,1],[34,0],[34,2],[35,0],[35,1],[37,0],[37,2],[40,1],[40,2],[324,1],[324,1],[42,0],[42,1],[50,0],[50,1],[51,0],[51,1],[54,0],[54,1],[56,0],[56,1],[58,0],[58,1],[59,0],[59,1],[60,0],[60,1],[61,0],[61,1],[65,1],[65,2],[71,1],[71,2],[74,1],[74,2],[88,0],[88,2],[90,0],[90,2],[91,1],[91,2],[92,0],[92,2],[95,1],[95,2],[97,0],[97,4],[99,0],[99,2],[101,0],[101,1],[102,0],[102,1],[103,1],[103,1],[104,0],[104,1],[106,1],[106,1],[106,1],[107,0],[107,1],[111,0],[111,1],[117,0],[117,1],[119,0],[119,2],[124,0],[124,1],[129,0],[129,1],[133,0],[133,1],[134,1],[134,1],[134,1],[136,0],[136,1],[137,0],[137,2],[140,0],[140,1],[141,0],[141,1],[142,0],[142,1],[144,0],[144,3],[146,0],[146,1],[148,0],[148,1],[149,0],[149,2],[152,0],[152,1],[153,0],[153,1],[155,0],[155,3],[157,0],[157,1],[162,0],[162,1],[167,0],[167,2],[168,0],[168,2],[169,1],[169,2],[170,0],[170,2],[175,0],[175,3],[177,0],[177,1],[178,0],[178,3],[180,0],[180,3],[181,0],[181,1],[183,0],[183,3],[184,0],[184,1],[189,0],[189,1],[191,0],[191,2],[194,0],[194,1],[198,0],[198,3],[201,0],[201,1],[204,0],[204,1],[206,0],[206,2],[208,1],[208,1],[210,0],[210,3],[213,0],[213,1],[215,0],[215,3],[217,0],[217,3],[339,1],[339,1],[339,1],[221,0],[221,1],[222,0],[222,1],[227,0],[227,3],[228,0],[228,1],[230,1],[230,2],[233,1],[233,2],[240,0],[240,2],[244,0],[244,2],[248,1],[248,1],[248,1],[248,1],[248,1],[248,1],[249,0],[249,1],[252,0],[252,2],[254,1],[254,1],[256,0],[256,2],[258,0],[258,2],[260,0],[260,2],[262,1],[262,1],[275,1],[275,1],[275,1],[275,1],[275,1],[278,0],[278,1],[281,0],[281,1],[282,1],[282,1],[284,0],[284,1],[286,0],[286,1],[287,0],[287,1]],performAction:o(function(T,D,R,K,ve,p,sr){var g=p.length-1;switch(ve){case 1:if(p[g-1]=p[g-1]||{},Ae.base&&(p[g-1].base=Ae.base),Ae.base="",p[g-1].prefixes=Ae.prefixes,Ae.prefixes=null,Ae.pathOnly){if(p[g-1].type==="path"||"termType"in p[g-1])return p[g-1];throw new Error("Received full SPARQL query in path only mode")}else if(p[g-1].type==="path"||"termType"in p[g-1])throw new Error("Received only path in full SPARQL mode");if(p[g-1].type==="update"){let Qe={};for(let ct of p[g-1].updates)if(ct.updateType==="insert"){let Be={};for(let ze of ct.insert)if(ze.type==="bgp"||ze.type==="graph")for(let wr of ze.triples)wr.subject.termType==="BlankNode"&&(Be[wr.subject.value]=!0),wr.predicate.termType==="BlankNode"&&(Be[wr.predicate.value]=!0),wr.object.termType==="BlankNode"&&(Be[wr.object.value]=!0);for(let ze of Object.keys(Be)){if(Qe[ze])throw new Error("Detected reuse blank node across different INSERT DATA clauses");Qe[ze]=!0}}}return p[g-1];case 2:this.$={...p[g-1],...p[g],type:"query"};break;case 4:Ae.base=co(p[g]);break;case 5:Ae.prefixes||(Ae.prefixes={}),p[g-1]=p[g-1].substr(0,p[g-1].length-1),p[g]=co(p[g]),Ae.prefixes[p[g-1]]=p[g];break;case 6:this.$={...p[g-3],...rs(p[g-2]),...p[g-1],...p[g]};break;case 7:if(!Ae.skipValidation&&(oh(p[g-3].variables.map(ct=>ah(ct.expression))).some(ct=>ct.aggregation==="count"&&!(ct.expression instanceof Bc))||p[g].group)){for(let ct of p[g-3].variables)if(ct.termType==="Variable"){if(!p[g].group||!p[g].group.map(Be=>Ks(Be)).includes(Ks(ct)))throw Error("Projection of ungrouped variable (?"+Ks(ct)+")")}else if(ah(ct.expression).length===0){let Be=zS(ct.expression);for(let ze of Be)if(!p[g].group||!p[g].group.map||!p[g].group.map(wr=>Ks(wr)).includes(Ks(ze)))throw Error("Use of ungrouped variable in projection of operation (?"+Ks(ze)+")")}}let Cn=p[g-1].where.filter(Qe=>Qe.type==="query");if(Cn.length>0){let Qe=p[g-3].variables.filter(Be=>Be.variable&&Be.variable.value).map(Be=>Be.variable.value),ct=oh(Cn.map(Be=>Be.variables)).map(Be=>Be.value||Be.variable.value);for(let Be of Qe)if(ct.indexOf(Be)>=0)throw Error("Target id of 'AS' (?"+Be+") already used in subquery")}this.$=ht(p[g-3],rs(p[g-2]),p[g-1],p[g]);break;case 8:this.$=ht({queryType:"CONSTRUCT",template:p[g-3]},rs(p[g-2]),p[g-1],p[g]);break;case 9:this.$=ht({queryType:"CONSTRUCT",template:p[g-2]=p[g-2]?p[g-2].triples:[]},rs(p[g-5]),{where:[{type:"bgp",triples:ts([],p[g-2])}]},p[g]);break;case 10:this.$=ht({queryType:"DESCRIBE",variables:p[g-3]==="*"?[new Bc]:p[g-3]},rs(p[g-2]),p[g-1],p[g]);break;case 11:this.$=ht({queryType:"ASK"},rs(p[g-2]),p[g-1],p[g]);break;case 12:this.$=ht(p[g-1],{variables:[new Bc]});break;case 13:let po=p[g].map(Qe=>Qe.value||Qe.variable.value),Qs=HS(po);if(Qs.length>0)throw Error("Two or more of the resulting columns have the same name (?"+Qs[0]+")");this.$=ht(p[g-1],{variables:p[g]});break;case 14:this.$=ht({queryType:"SELECT"},p[g]&&(p[g-1]=ir(p[g]),p[g]={},p[g][p[g-1]]=!0,p[g]));break;case 16:case 27:this.$=Ws(p[g-3],{variable:p[g-1]});break;case 17:case 18:this.$=ht(p[g-3],p[g-2],p[g-1],p[g],{type:"query"});break;case 19:case 58:this.$={iri:p[g],named:!!p[g-1]};break;case 20:this.$={where:p[g].patterns};break;case 21:this.$=ht(p[g-1],p[g]);break;case 22:this.$=ht(p[g-2],p[g-1],p[g]);break;case 23:this.$={group:p[g]};break;case 24:case 25:case 28:case 31:case 33:case 34:this.$=Ws(p[g]);break;case 26:this.$=Ws(p[g-1]);break;case 29:this.$={having:p[g]};break;case 30:this.$={order:p[g]};break;case 32:this.$=Ws(p[g],{descending:!0});break;case 35:this.$={limit:Hs(p[g])};break;case 36:this.$={offset:Hs(p[g])};break;case 37:this.$={limit:Hs(p[g-2]),offset:Hs(p[g])};break;case 38:this.$={limit:Hs(p[g]),offset:Hs(p[g-2])};break;case 39:case 43:this.$={type:"values",values:p[g]};break;case 40:case 84:this.$=p[g-1].map(Qe=>({[p[g-3]]:Qe}));break;case 41:case 85:this.$=p[g-1].map(()=>({}));break;case 42:case 86:var xn=p[g-4].length;p[g-4]=p[g-4].map(eh),this.$=p[g-1].map(function(Qe){if(Qe.length!==xn)throw Error("Inconsistent VALUES length");for(var ct={},Be=0;Be<xn;Be++)ct["?"+p[g-4][Be].value]=Qe[Be];return ct});break;case 44:case 65:case 100:case 126:case 175:this.$=p[g-1];break;case 45:this.$={type:"update",updates:Yn(p[g-2],p[g-1])};break;case 46:this.$=ht({type:"load",silent:!!p[g-2],source:p[g-1]},p[g]&&{destination:p[g]});break;case 47:this.$={type:ir(p[g-2]),silent:!!p[g-1],graph:p[g]};break;case 48:this.$={type:ir(p[g-4]),silent:!!p[g-3],source:p[g-2],destination:p[g]};break;case 49:this.$={type:"create",silent:!!p[g-2],graph:{type:"graph",name:p[g]}};break;case 50:this.$={updateType:"insert",insert:T1(p[g])};break;case 51:this.$={updateType:"delete",delete:lh(T1(p[g]))};break;case 52:this.$={updateType:"deletewhere",delete:lh(p[g])};break;case 53:this.$={updateType:"insertdelete",...p[g-4],...p[g-3],...rs(p[g-2],"using"),where:p[g].patterns};break;case 54:case 57:case 62:case 167:case 191:case 236:this.$=p[g];break;case 55:this.$={delete:lh(p[g-1]),insert:p[g]||[]};break;case 56:this.$={delete:[],insert:p[g]};break;case 59:this.$={graph:p[g]};break;case 60:this.$={type:"graph",default:!0};break;case 61:case 63:this.$={type:"graph",name:p[g]};break;case 64:this.$={[ir(p[g])]:!0};break;case 66:this.$=p[g-1]?Tn(p[g],[p[g-1]]):Tn(p[g]);break;case 67:var fo=ht(p[g-3]||{triples:[]},{type:"graph",name:p[g-5]});this.$=p[g]?[fo,p[g]]:[fo];break;case 68:case 73:this.$={type:"bgp",triples:Tn(p[g-2],[p[g-1]])};break;case 69:this.$={type:"group",patterns:[p[g-1]]};break;case 70:for(let Qe of p[g-1].filter(ct=>ct.type==="bind")){let ct=p[g-1].indexOf(Qe),Be=new Set;for(let ze of p[g-1].slice(0,ct))(ze.type==="group"||ze.type==="bgp")&&S1(ze).forEach(wr=>Be.add(wr));if(Be.has(Qe.variable.value))throw Error("Variable used to bind is already bound (?"+Qe.variable.value+")")}this.$={type:"group",patterns:p[g-1]};break;case 71:this.$=p[g-1]?Tn([p[g-1]],p[g]):Tn(p[g]);break;case 72:this.$=p[g]?[p[g-2],p[g]]:p[g-2];break;case 75:this.$=ht(p[g],{type:"optional"});break;case 76:this.$=ht(p[g],{type:"minus"});break;case 77:this.$=ht(p[g],{type:"graph",name:p[g-1]});break;case 78:this.$=ht(p[g],{type:"service",name:p[g-1],silent:!!p[g-2]});break;case 79:this.$={type:"filter",expression:p[g]};break;case 80:this.$={type:"bind",variable:p[g-1],expression:p[g-3]};break;case 89:this.$=lo(p[g]);break;case 90:this.$=void 0;break;case 91:this.$=p[g-1].length?{type:"union",patterns:Tn(p[g-1].map(rh),[rh(p[g])])}:p[g];break;case 95:this.$={...p[g],function:p[g-1]};break;case 96:this.$={type:"functionCall",args:[]};break;case 97:this.$={type:"functionCall",args:Yn(p[g-2],p[g-1]),distinct:!!p[g-3]};break;case 98:case 115:case 128:case 247:case 249:case 251:case 253:case 255:case 263:case 267:case 297:case 299:case 303:case 307:case 328:case 341:case 349:case 355:case 361:case 367:case 369:case 373:case 375:case 379:case 381:case 385:case 391:case 395:case 401:case 405:case 409:case 411:case 420:case 428:case 430:case 440:case 444:case 446:case 448:this.$=[];break;case 99:this.$=Yn(p[g-2],p[g-1]);break;case 101:this.$=Tn(p[g-2],[p[g-1]]);break;case 102:case 112:this.$=uh(p[g].map(Qe=>ht(Xn(p[g-1]),Qe)));break;case 103:this.$=uh(ts(p[g].map(Qe=>ht(Xn(p[g-1].entity),Qe)),p[g-1].triples));break;case 105:this.$=Tn([p[g-1]],p[g]);break;case 106:this.$=Tn(p[g]);break;case 107:this.$=sh(p[g-1],p[g]);break;case 109:case 237:this.$=Ae.factory.namedNode(LS);break;case 110:case 118:this.$=Yn(p[g-1],p[g]);break;case 111:this.$=p[g]?{annotation:p[g],object:p[g-1]}:p[g-1];break;case 113:this.$=p[g]?uh(ts(p[g].map(Qe=>ht(Xn(p[g-1].entity),Qe)),p[g-1].triples)):p[g-1].triples;break;case 114:this.$=sh(...p[g-1],p[g]);break;case 116:this.$=sh(...p[g]);break;case 117:case 159:case 163:this.$=[p[g-1],p[g]];break;case 119:this.$=p[g]?{object:p[g-1],annotation:p[g]}:p[g-1];break;case 120:this.$=p[g-1].length?zs("|",Yn(p[g-1],p[g])):p[g];break;case 121:this.$=p[g-1].length?zs("/",Yn(p[g-1],p[g])):p[g];break;case 122:this.$=p[g]?zs(p[g],[p[g-1]]):p[g-1];break;case 123:this.$=p[g-1]?zs(p[g-1],[p[g]]):p[g];break;case 125:case 131:this.$=zs(p[g-1],[p[g]]);break;case 129:this.$=zs("|",Yn(p[g-2],p[g-1]));break;case 132:case 134:this.$=GS(p[g-1]);break;case 133:case 135:this.$=WS(p[g-1]);break;case 140:this.$={entity:p[g],triples:[]};break;case 145:this.$=eh(p[g]);break;case 149:this.$=Ae.factory.namedNode(p1);break;case 151:case 153:case 158:case 162:this.$=th(p[g-1],p[g]);break;case 152:this.$=["||",p[g]];break;case 154:this.$=["&&",p[g]];break;case 156:this.$=Nt(p[g-1],[p[g-2],p[g]]);break;case 157:this.$=Nt(p[g-2]?"notin":"in",[p[g-3],p[g]]);break;case 160:this.$=["+",th(p[g-1],p[g])];break;case 161:var Gc=An(p[g-1].value.replace("-",""),p[g-1].datatype);this.$=["-",th(Gc,p[g])];break;case 164:this.$=Nt("UPLUS",[p[g]]);break;case 165:this.$=Nt(p[g-1],[p[g]]);break;case 166:this.$=Nt("UMINUS",[p[g]]);break;case 177:this.$=Nt(ir(p[g-1]));break;case 178:this.$=Nt(ir(p[g-3]),[p[g-1]]);break;case 179:this.$=lo(Nt(ir(p[g-3]),[p[g-1]]));break;case 180:this.$=Nt(ir(p[g-5]),[p[g-3],p[g-1]]);break;case 181:this.$=Nt(ir(p[g-7]),[p[g-5],p[g-3],p[g-1]]);break;case 182:this.$=lo(Nt(ir(p[g-7]),[p[g-5],p[g-3],p[g-1]]));break;case 183:this.$=Nt(ir(p[g-1]),p[g]);break;case 184:this.$=Nt("bound",[eh(p[g-1])]);break;case 185:this.$=Nt(p[g-1],[]);break;case 186:this.$=Nt(p[g-3],[p[g-1]]);break;case 187:this.$=Nt(p[g-2]?"notexists":"exists",[rh(p[g])]);break;case 188:case 189:this.$=Ws(p[g-1],{type:"aggregate",aggregation:ir(p[g-4]),distinct:!!p[g-2]});break;case 190:this.$=Ws(p[g-2],{type:"aggregate",aggregation:ir(p[g-5]),distinct:!!p[g-3],separator:typeof p[g-1]=="string"?p[g-1]:" "});break;case 192:this.$=An(p[g]);break;case 193:this.$=$S(p[g-1],ir(p[g].substr(1)));break;case 194:this.$=An(p[g-2],p[g]);break;case 195:case 204:this.$=An(p[g],m1);break;case 196:case 205:this.$=An(p[g],g1);break;case 197:case 206:this.$=An(ir(p[g]),y1);break;case 200:this.$=An(p[g].toLowerCase(),VS);break;case 201:this.$=An(p[g].substr(1),m1);break;case 202:this.$=An(p[g].substr(1),g1);break;case 203:this.$=An(p[g].substr(1).toLowerCase(),y1);break;case 207:case 208:this.$=b1(p[g],1);break;case 209:case 210:this.$=b1(p[g],3);break;case 211:this.$=Ae.factory.namedNode(co(p[g]));break;case 213:var Wc=p[g].indexOf(":"),ho=p[g].substr(0,Wc),zc=Ae.prefixes[ho];if(!zc)throw new Error("Unknown prefix: "+ho);var ft=co(zc+p[g].substr(Wc+1));this.$=Ae.factory.namedNode(ft);break;case 214:if(p[g]=p[g].substr(0,p[g].length-1),!(p[g]in Ae.prefixes))throw new Error("Unknown prefix: "+p[g]);var ft=co(Ae.prefixes[p[g]]);this.$=Ae.factory.namedNode(ft);break;case 215:this.$=uo(p[g].replace(/^(_:)/,""));break;case 216:this.$=uo();break;case 217:case 218:case 232:this.$=lo(nh(p[g-3],p[g-2],p[g-1]));break;case 230:case 231:this.$=lo(p[g-1]);break;case 248:case 250:case 252:case 254:case 256:case 260:case 264:case 268:case 270:case 292:case 294:case 296:case 298:case 300:case 302:case 304:case 306:case 329:case 342:case 356:case 368:case 370:case 372:case 374:case 392:case 402:case 425:case 427:case 429:case 431:case 441:case 445:case 447:case 449:p[g-1].push(p[g]);break;case 259:case 269:case 291:case 293:case 295:case 301:case 305:case 371:case 424:case 426:this.$=[p[g]];break;case 308:p[g-3].push(p[g-2]);break;case 350:case 362:case 376:case 380:case 382:case 386:case 396:case 406:case 410:case 412:case 421:p[g-2].push(p[g-1]);break}},"anonymous"),table:[n(e,t,{3:1,4:2,10:3}),{1:[3]},n(r,[2,307],{5:4,7:5,321:6,214:7,8:8,96:9,215:10,17:11,21:12,97:16,38:17,6:[2,238],13:i,16:i,45:i,197:i,224:i,229:i,308:i,24:[1,13],32:[1,14],36:[1,15],41:s}),n([6,13,16,24,32,36,41,45,100,110,113,115,116,123,126,131,197,224,229,308,329,330,331,332,333],[2,3],{322:19,11:20,14:21,12:[1,22],15:[1,23]}),{6:[1,24]},{6:[2,240]},{6:[2,241]},{6:[2,242]},{6:[2,243],9:25,84:26,85:a},{6:[2,239]},n(c,[2,411],{216:28,217:29}),n(u,[2,249],{18:30}),n(u,[2,251],{22:31}),n(l,[2,255],{25:32,27:33,29:[1,34]}),{13:f,16:h,33:35,39:[1,37],44:39,55:40,87:d,139:38,307:43,308:m,323:36},n(u,[2,267],{37:46}),n(_,[2,326],{98:47,103:49,106:50,117:55,130:61,100:[1,48],110:[1,51],113:[1,52],115:[1,53],116:[1,54],131:[1,62],329:[1,56],330:[1,57],331:[1,58],332:[1,59],333:[1,60]}),{39:[1,63],40:64,43:65,44:66,45:b,87:d},n(C,[2,273],{42:68,324:69,325:[1,70],326:[1,71]}),n(e,[2,248]),n(e,[2,245]),n(e,[2,246]),{13:[1,72]},{16:[1,73]},{1:[2,1]},{6:[2,2]},{6:[2,244]},{45:[1,77],85:[1,78],86:74,87:[1,75],89:[1,76]},n([6,13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312],[2,120],{337:[1,79]}),n(O,[2,418],{218:80,222:81,229:[1,82]}),{19:83,28:I,29:L,52:84,53:G,56:85},{19:88,28:I,29:L,52:89,53:G,56:85},n(u,[2,253],{26:90}),{28:[1,91],52:92,53:G},n(W,[2,385],{181:93,182:94,183:95,31:[2,383]}),n(Fe,[2,263],{34:96}),n(Fe,[2,261],{44:39,55:40,307:43,139:97,13:f,16:h,87:d,308:m}),n(Fe,[2,262]),n(Ze,[2,259]),n(ot,[2,143]),n(ot,[2,144]),n([6,13,16,28,29,31,39,45,47,48,53,63,70,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,197,224,229,231,232,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,314,317,318,335,338,341,342,343,344,345,346,347,348,349,350,351],[2,145]),n(B,[2,211]),n(B,[2,212]),n(B,[2,213]),n(B,[2,214]),{19:98,28:I,29:L,52:99,53:G,56:85},{6:[2,309],99:100,193:[1,101]},n(ue,[2,311],{101:102,328:[1,103]}),n(be,[2,317],{104:104,328:[1,105]}),n(He,[2,322],{107:106,328:[1,107]}),{111:108,112:[2,324],328:[1,109]},{29:qe,114:110},{29:qe,114:112},{29:qe,114:113},{118:114,123:[1,115],125:116,126:et},n(Le,[2,315]),n(Le,[2,316]),n(je,[2,319]),n(je,[2,320]),n(je,[2,321]),n(_,[2,327]),{13:f,16:h,55:118,307:43,308:m},n(u,[2,12]),n(u,[2,13],{44:66,43:119,45:b,87:d}),n(Re,[2,269]),n(Re,[2,15]),{13:f,16:h,44:136,45:H,46:120,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(C,[2,14]),n(C,[2,274]),n(C,[2,271]),n(C,[2,272]),n(e,[2,4]),{13:[1,177]},n(U,[2,39]),{29:[1,178]},{29:[1,179]},{87:[1,181],91:180},{45:[1,187],87:[1,185],89:[1,186],93:182,165:183,166:184},n(c,[2,410]),n([6,13,16,45,48,82,87,89,231,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,337],[2,121],{338:[1,188]}),{13:f,16:h,45:[1,193],55:194,197:Ke,219:189,220:190,223:191,224:[1,192],307:43,308:m},n(O,[2,419]),n(nt,_e,{20:196,59:197,69:198,70:j}),n(u,[2,250]),{29:M,57:200},n(ue,[2,279],{54:202,327:[1,203]}),{29:[2,282]},n($,q,{23:204,58:205,62:206,63:ge}),n(u,[2,252]),{19:208,28:I,29:L,52:209,53:G,56:85},{29:[1,210]},n(l,[2,256]),{31:[1,211]},{31:[2,384]},{13:f,16:h,44:215,45:Ve,55:220,82:k,87:d,89:$e,145:212,172:221,185:213,187:214,231:Ft,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},n(M0,[2,265],{56:85,35:227,52:228,19:229,28:I,29:L,53:G}),n(Ze,[2,260]),n($,q,{58:205,62:206,23:230,63:ge}),n(u,[2,268]),{6:[2,45]},n(e,t,{10:3,4:231}),{13:f,16:h,55:232,307:43,308:m},n(ue,[2,312]),{105:233,112:V0,122:234,132:[1,237],134:235,327:[1,238],334:[1,239]},n(be,[2,318]),n(ue,$0,{108:240,133:242,112:B0,132:U0}),n(He,[2,323]),{112:[1,244]},{112:[2,325]},n(Rt,[2,50]),n(W,Cc,{135:245,136:246,143:247,144:248,31:q0,112:q0}),n(Rt,[2,51]),n(Rt,[2,52]),n(gi,[2,328],{119:249}),{29:qe,114:250},n(gi,[2,56]),{29:qe,114:251},n(_,[2,59]),n(Re,[2,270]),{47:[1,252]},n(G0,[2,150]),n(Oc,[2,428],{240:253}),n($s,[2,430],{244:254}),n($s,[2,155],{248:255,249:256,250:[2,438],290:[1,257],341:[1,258],342:[1,259],343:[1,260],344:[1,261],345:[1,262],346:[1,263]}),n(Bs,[2,440],{252:264}),n(xt,[2,448],{260:265}),{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,255:154,257:155,264:266,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,255:154,257:155,264:267,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,255:154,257:155,264:268,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(xt,[2,167]),n(xt,[2,168]),n(xt,[2,169]),n(xt,[2,170],{176:269,45:W0,89:z0}),n(xt,[2,171]),n(xt,[2,172]),n(xt,[2,173]),n(xt,[2,174]),{13:f,16:h,44:136,45:H,46:272,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(gt,[2,176]),{89:[1,273]},{45:[1,274]},{45:[1,275]},{45:[1,276]},{45:[1,277]},{45:[1,278]},{45:H0,89:K0,179:279},{45:[1,282]},{45:[1,284],89:[1,283]},{279:[1,285]},n(nr,[2,192],{292:[1,286],293:[1,287]}),n(nr,[2,195]),n(nr,[2,196]),n(nr,[2,197]),n(nr,[2,198]),n(nr,[2,199]),n(nr,[2,200]),{13:f,16:h,44:39,55:40,82:k,87:d,139:289,172:291,255:154,257:155,266:290,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,320:288},{45:[1,292]},{45:[1,293]},{45:[1,294]},n(io,[2,452]),n(io,[2,453]),n(io,[2,454]),n(io,[2,455]),n(io,[2,456]),{279:[2,458]},n(Dc,[2,207]),n(Dc,[2,208]),n(Dc,[2,209]),n(Dc,[2,210]),n(nr,[2,201]),n(nr,[2,202]),n(nr,[2,203]),n(nr,[2,204]),n(nr,[2,205]),n(nr,[2,206]),n(e,[2,5]),n(Ic,[2,297],{88:295}),n(Pc,[2,299],{90:296}),{48:[1,297],87:[1,298]},n(Fc,[2,301]),n(U,[2,43]),n(U,[2,82]),n(U,[2,83]),{29:[1,299]},{29:[1,300]},{87:[1,302],169:301},n(c,[2,412]),n(Ki,[2,123]),n(Ki,[2,416],{221:303,339:304,39:[1,306],263:[1,307],340:[1,305]}),n(En,[2,124]),{13:f,16:h,45:[1,311],55:194,89:[1,310],197:Ke,223:312,225:308,226:309,229:Q0,307:43,308:m},n(c,i,{215:10,214:314}),n(En,[2,236]),n(En,[2,237]),n(Us,[2,6]),n(zf,[2,287],{60:315,72:316,73:[1,317]}),n(nt,[2,286]),{13:f,16:h,45:H,55:323,67:321,68:322,71:318,77:320,79:319,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,307:43,308:m,346:Pe,347:we,348:w,349:E,350:y,351:x},n([6,31,63,70,73,81,83,85],[2,20]),n(W,Y0,{38:17,49:324,147:325,17:326,21:327,148:328,154:329,155:330,29:Wn,31:Wn,85:Wn,112:Wn,159:Wn,160:Wn,161:Wn,163:Wn,164:Wn,41:s}),{13:f,16:h,55:331,307:43,308:m},n(ue,[2,280]),n(Us,[2,7]),n(nt,_e,{59:197,69:198,20:332,70:j}),n($,[2,284]),{64:[1,333]},n($,q,{58:205,62:206,23:334,63:ge}),n(u,[2,254]),n(W,Cc,{144:248,30:335,143:336,31:[2,257]}),n(u,[2,100]),{31:[2,387],184:337,335:[1,338]},{13:f,16:h,44:39,55:40,87:d,139:342,186:339,190:340,195:341,197:Qi,307:43,308:m},n(so,[2,389],{44:39,55:40,307:43,190:340,195:341,139:342,188:344,189:345,186:346,13:f,16:h,87:d,197:Qi,308:m}),n(zn,[2,227]),n(zn,[2,228]),n(zn,[2,229]),{13:f,16:h,44:215,45:Ve,55:220,82:k,87:d,89:$e,172:221,185:351,187:350,200:348,230:347,231:Ft,234:349,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},{13:f,16:h,44:39,55:40,87:d,139:342,186:352,190:340,195:341,197:Qi,307:43,308:m},n(zn,[2,146]),n(zn,[2,147]),n(zn,[2,148]),n(zn,[2,149]),{13:f,16:h,44:354,55:355,82:k,87:d,172:357,237:356,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:358,312:rr,313:353},n(Hf,[2,215]),n(Hf,[2,216]),n($,q,{58:205,62:206,23:359,63:ge}),n(Fe,[2,264]),n(M0,[2,266]),n(Us,[2,11]),n(r,[2,308],{6:[2,310]}),n(Rt,[2,313],{102:360,120:361,121:[1,362]}),n(Rt,[2,47]),n(Rt,[2,63]),n(Rt,[2,64]),{13:f,16:h,55:363,307:43,308:m},n(Rt,[2,336]),n(Rt,[2,337]),n(Rt,[2,338]),{109:[1,364]},n(X0,[2,60]),{13:f,16:h,55:365,307:43,308:m},n(ue,[2,335]),{13:f,16:h,55:366,307:43,308:m},{31:[1,367]},n(Yi,[2,341],{137:368}),n(Yi,[2,340]),{13:f,16:h,44:215,45:Ve,55:220,82:k,87:d,89:$e,145:369,172:221,185:213,187:214,231:Ft,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},{28:[1,370],127:371,128:[1,372]},n(gi,[2,330],{124:373,125:374,126:et}),n(gi,[2,57]),{44:375,87:d},n(G0,[2,151],{241:376,242:[1,377]}),n(Oc,[2,153],{245:378,246:[1,379]}),{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,247:380,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{250:[1,381]},n(yt,[2,432]),n(yt,[2,433]),n(yt,[2,434]),n(yt,[2,435]),n(yt,[2,436]),n(yt,[2,437]),{250:[2,439]},n([47,48,193,242,246,250,272,290,341,342,343,344,345,346],[2,158],{253:382,254:383,255:384,257:385,263:[1,386],265:[1,387],297:J,298:Z,299:ee,300:te,301:ie,302:se}),n(Bs,[2,162],{261:388,262:389,39:Kf,338:Qf}),n(xt,[2,164]),n(xt,[2,165]),n(xt,[2,166]),n(gt,[2,95]),n(gt,[2,96]),n(yt,[2,377],{177:392,325:[1,393]}),{48:[1,394]},n(gt,[2,177]),{13:f,16:h,44:136,45:H,46:395,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,46:396,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,46:397,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,46:398,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,46:399,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(gt,[2,183]),n(gt,[2,98]),n(yt,[2,381],{180:400}),{87:[1,401]},n(gt,[2,185]),{13:f,16:h,44:136,45:H,46:402,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{29:M,57:403},n(nr,[2,193]),{13:f,16:h,55:404,307:43,308:m},{13:f,16:h,44:39,55:40,87:d,139:342,195:405,197:Qi,307:43,308:m},n(yi,[2,233]),n(yi,[2,234]),n(yi,[2,235]),n(J0,[2,459],{281:406,325:[1,407]}),n(yt,[2,463],{284:408,325:[1,409]}),n(yt,[2,465],{286:410,325:[1,411]}),{13:f,16:h,31:[1,412],55:414,82:k,171:413,172:415,173:416,174:Rc,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Nc},{31:[1,419],89:[1,420]},{29:[1,421]},n(Fc,[2,302]),n(Ic,[2,367],{167:422}),n(Pc,[2,369],{168:423}),{48:[1,424],87:[1,425]},n(Fc,[2,371]),n(Ki,[2,122]),n(Ki,[2,417]),n(Ki,[2,413]),n(Ki,[2,414]),n(Ki,[2,415]),n(En,[2,125]),n(En,[2,127]),n(En,[2,128]),n(Z0,[2,420],{227:426}),n(En,[2,130]),{13:f,16:h,55:194,197:Ke,223:427,307:43,308:m},{48:[1,428]},n(vi,[2,289],{61:429,80:430,81:[1,431],83:[1,432]}),n(zf,[2,288]),{64:[1,433]},n(nt,[2,29],{307:43,267:139,275:146,278:149,77:320,67:321,68:322,55:323,79:434,13:f,16:h,45:H,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,276:De,277:le,279:Ee,280:pe,283:Te,285:Ie,308:m,346:Pe,347:we,348:w,349:E,350:y,351:x}),n(e1,[2,293]),n(Yf,[2,92]),n(Yf,[2,93]),n(Yf,[2,94]),{45:W0,89:z0,176:269},{31:[1,435]},{31:[1,436]},{19:437,28:I,29:L,56:85},{19:438,28:I,29:L,56:85},n(Xi,[2,355],{149:439}),n(Xi,[2,354]),{13:f,16:h,44:215,45:kc,55:220,82:k,87:d,89:$e,156:440,172:221,185:441,203:442,231:Lc,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},n(Fe,[2,19]),n(vi,[2,21]),{13:f,16:h,44:450,45:t1,55:323,65:445,66:446,67:447,68:448,87:d,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,307:43,308:m,346:Pe,347:we,348:w,349:E,350:y,351:x},n(Us,[2,8]),{31:[1,451]},{31:[2,258]},{31:[2,101]},n(W,[2,386],{31:[2,388]}),n(so,[2,102]),n(Ji,[2,391],{191:452}),n(W,[2,395],{196:453,198:454}),n(W,[2,108]),n(W,[2,109]),n(so,[2,103]),n(so,[2,104]),n(so,[2,390]),{13:f,16:h,44:215,45:Ve,48:[1,455],55:220,82:k,87:d,89:$e,172:221,185:351,187:350,200:456,231:Ft,234:349,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},n(jc,[2,424]),n(r1,[2,136]),n(r1,[2,137]),n(Xf,[2,140]),{232:[1,457]},{13:f,16:h,44:39,55:40,87:d,139:342,195:458,197:Qi,307:43,308:m},n(yi,[2,219]),n(yi,[2,220]),n(yi,[2,221]),n(yi,[2,222]),n(yi,[2,223]),n(Us,[2,10]),n(Rt,[2,46]),n(Rt,[2,314]),{112:V0,122:459},n(Rt,[2,62]),n(ue,$0,{133:242,108:460,112:B0,132:U0}),n(X0,[2,61]),n(Rt,[2,49]),n([6,28,126,128,193],[2,65]),{31:[2,66],112:[1,462],138:461},n(Yi,[2,351],{146:463,335:[1,464]}),{29:M,57:465},n(gi,[2,329]),n(ue,[2,332],{129:466,327:[1,467]}),n(gi,[2,55]),n(gi,[2,331]),{48:[1,468]},n(Oc,[2,429]),{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,239:469,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n($s,[2,431]),{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,243:470,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n($s,[2,156]),{45:H0,89:K0,179:471},n(Bs,[2,441]),{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,251:472,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(xt,[2,444],{256:473}),n(xt,[2,446],{258:474}),n(yt,[2,442]),n(yt,[2,443]),n(xt,[2,449]),{13:f,16:h,44:136,45:H,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,255:154,257:155,259:475,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(yt,[2,450]),n(yt,[2,451]),n(yt,[2,379],{178:476}),n(yt,[2,378]),n([6,13,16,29,31,39,45,47,48,73,76,78,81,82,83,85,87,89,112,159,160,161,163,164,193,231,242,246,250,263,265,268,269,270,271,272,273,274,276,277,279,280,283,285,290,294,295,296,297,298,299,300,301,302,303,304,305,306,308,309,310,312,335,338,341,342,343,344,345,346,347,348,349,350,351],[2,175]),{48:[1,477]},{48:[1,478]},{272:[1,479]},{272:[1,480]},{272:[1,481]},{13:f,16:h,44:136,45:H,46:482,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{48:[1,483]},{48:[1,484]},n(gt,[2,187]),n(nr,[2,194]),{13:f,16:h,44:39,55:40,82:k,87:d,139:289,172:291,255:154,257:155,266:290,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,320:485},{13:f,16:h,39:[1,487],44:136,45:H,46:488,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,282:486,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(J0,[2,460]),{13:f,16:h,44:136,45:H,46:489,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(yt,[2,464]),{13:f,16:h,44:136,45:H,46:490,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(yt,[2,466]),n(U,[2,40]),n(Ic,[2,298]),n(ao,[2,87]),n(ao,[2,88]),n(ao,[2,89]),n(ao,[2,90]),{13:f,16:h,55:492,82:k,172:493,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,311:494,312:rr,315:491},n(U,[2,41]),n(Pc,[2,300]),n(oo,[2,303],{92:495}),{13:f,16:h,31:[1,496],55:414,82:k,171:497,172:415,173:416,174:Rc,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Nc},{31:[1,498],89:[1,499]},{29:[1,500]},n(Fc,[2,372]),{13:f,16:h,48:[2,422],55:194,197:Ke,223:312,226:502,228:501,229:Q0,307:43,308:m},n(En,[2,131]),n(En,[2,126]),n(vi,[2,22]),n(vi,[2,290]),{82:[1,503]},{82:[1,504]},{13:f,16:h,44:510,45:H,55:323,67:321,68:322,74:505,75:506,76:n1,77:320,78:i1,79:509,87:d,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,307:43,308:m,346:Pe,347:we,348:w,349:E,350:y,351:x},n(e1,[2,294]),n(s1,[2,69]),n(s1,[2,70]),n(nt,_e,{59:197,69:198,20:511,70:j}),n($,q,{58:205,62:206,23:512,63:ge}),{29:[2,375],31:[2,71],84:522,85:a,112:[1,518],150:513,151:514,158:515,159:[1,516],160:[1,517],161:[1,519],163:[1,520],164:[1,521],175:523},n(Xi,[2,363],{157:524,335:[1,525]}),n(c,i,{215:10,202:526,205:527,208:528,214:529,44:530,87:d}),n(Mc,[2,399],{215:10,205:527,208:528,214:529,44:530,204:531,202:532,13:i,16:i,45:i,197:i,224:i,229:i,308:i,87:d}),{13:f,16:h,44:215,45:kc,55:220,82:k,87:d,89:$e,172:221,185:351,203:536,212:534,231:Lc,233:533,234:535,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},n(c,i,{215:10,205:527,208:528,214:529,44:530,202:537,87:d}),n($,[2,23],{307:43,267:139,275:146,278:149,55:323,67:447,68:448,44:450,66:538,13:f,16:h,45:t1,87:d,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,276:De,277:le,279:Ee,280:pe,283:Te,285:Ie,308:m,346:Pe,347:we,348:w,349:E,350:y,351:x}),n(Zi,[2,291]),n(Zi,[2,24]),n(Zi,[2,25]),{13:f,16:h,44:136,45:H,46:539,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(Zi,[2,28]),n($,q,{58:205,62:206,23:540,63:ge}),n([31,112,232,318,335],[2,105],{192:541,193:[1,542]}),n(Ji,[2,107]),{13:f,16:h,44:215,45:Ve,55:220,82:k,87:d,89:$e,172:221,185:351,187:350,199:543,200:544,231:Ft,234:349,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},n(a1,[2,132]),n(jc,[2,425]),n(a1,[2,133]),{13:f,16:h,44:354,55:355,82:k,87:d,172:357,237:356,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:358,312:rr,313:545},n(Rt,[2,54]),n(Rt,[2,48]),n(Yi,[2,342]),{13:f,16:h,44:39,55:40,87:d,139:546,307:43,308:m},n(Yi,[2,68]),n(W,[2,350],{31:o1,112:o1}),n(Rt,[2,53]),{13:f,16:h,55:547,307:43,308:m},n(ue,[2,333]),n(Re,[2,16]),n(Oc,[2,152]),n($s,[2,154]),n($s,[2,157]),n(Bs,[2,159]),n(Bs,[2,160],{262:389,261:548,39:Kf,338:Qf}),n(Bs,[2,161],{262:389,261:549,39:Kf,338:Qf}),n(xt,[2,163]),{13:f,16:h,44:136,45:H,46:550,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(gt,[2,178]),n(gt,[2,179]),{13:f,16:h,44:136,45:H,46:551,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,46:552,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,46:553,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{48:[1,554],272:[1,555]},n(gt,[2,184]),n(gt,[2,186]),{314:[1,556]},{48:[1,557]},{48:[2,461]},{48:[2,462]},{48:[1,558]},{48:[2,467],193:[1,561],287:559,288:560},{13:f,16:h,55:194,197:Ke,223:562,307:43,308:m},n(Jf,[2,224]),n(Jf,[2,225]),n(Jf,[2,226]),{31:[1,563],45:c1,94:564},n(U,[2,84]),n(Ic,[2,368]),n(U,[2,85]),n(Pc,[2,370]),n(oo,[2,373],{170:566}),{48:[1,567]},{48:[2,423],337:[1,568]},n(vi,[2,35],{83:[1,569]}),n(vi,[2,36],{81:[1,570]}),n(zf,[2,30],{307:43,267:139,275:146,278:149,77:320,67:321,68:322,55:323,79:509,44:510,75:571,13:f,16:h,45:H,76:n1,78:i1,87:d,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,276:De,277:le,279:Ee,280:pe,283:Te,285:Ie,308:m,346:Pe,347:we,348:w,349:E,350:y,351:x}),n(qs,[2,295]),{45:H,77:572},{45:H,77:573},n(qs,[2,33]),n(qs,[2,34]),{31:[2,275],50:574,84:575,85:a},{31:[2,277],51:576,84:577,85:a},n(Xi,[2,356]),n(u1,[2,357],{152:578,335:[1,579]}),n(Hn,[2,74]),{29:M,57:580},{29:M,57:581},{13:f,16:h,44:39,55:40,87:d,139:582,307:43,308:m},n(l1,[2,365],{162:583,328:[1,584]}),{13:f,16:h,45:H,55:323,67:321,68:322,77:320,79:585,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,307:43,308:m,346:Pe,347:we,348:w,349:E,350:y,351:x},{45:[1,586]},n(Hn,[2,81]),{29:M,57:587},n(Xi,[2,73]),n(W,[2,362],{29:Kn,31:Kn,85:Kn,112:Kn,159:Kn,160:Kn,161:Kn,163:Kn,164:Kn}),n(Mc,[2,112]),n(Gs,[2,401],{206:588}),n(W,[2,405],{209:589,210:590}),n(W,[2,403]),n(W,[2,404]),n(Mc,[2,113]),n(Mc,[2,400]),{13:f,16:h,44:215,45:kc,48:[1,591],55:220,82:k,87:d,89:$e,172:221,185:351,203:536,212:592,231:Lc,234:535,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},n(jc,[2,426]),n(Xf,[2,138]),n(Xf,[2,139]),{232:[1,593]},n(Zi,[2,292]),{47:[1,595],48:[1,594]},n(Us,[2,9]),n(Ji,[2,392]),n(Ji,[2,393],{44:39,55:40,307:43,195:341,139:342,194:596,190:597,13:f,16:h,87:d,197:Qi,308:m}),n(Ji,[2,110],{272:[1,598]}),n(Vc,[2,397],{201:599,316:600,317:[1,601]}),{314:[1,602]},{29:[1,603]},n(gi,[2,58]),n(xt,[2,445]),n(xt,[2,447]),{48:[1,604],272:[1,605]},{48:[1,606]},{272:[1,607]},{272:[1,608]},n(gt,[2,99]),n(yt,[2,382]),n([13,16,39,47,48,87,193,197,242,246,250,263,265,272,290,297,298,299,300,301,302,308,314,338,341,342,343,344,345,346],[2,232]),n(gt,[2,188]),n(gt,[2,189]),{48:[1,609]},{48:[2,468]},{289:[1,610]},{13:f,16:h,55:492,82:k,172:493,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,311:494,312:rr,315:611},n(U,[2,42]),n(oo,[2,304]),{13:f,16:h,55:414,82:k,95:612,171:613,172:415,173:416,174:Rc,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Nc},{31:[1,614],45:c1,94:615},n(En,[2,129]),n(Z0,[2,421]),{82:[1,616]},{82:[1,617]},n(qs,[2,296]),n(qs,[2,31]),n(qs,[2,32]),{31:[2,17]},{31:[2,276]},{31:[2,18]},{31:[2,278]},n(W,Y0,{155:330,153:618,154:619,29:Qn,31:Qn,85:Qn,112:Qn,159:Qn,160:Qn,161:Qn,163:Qn,164:Qn}),n(u1,[2,358]),n(Hn,[2,75]),n(Hn,[2,76]),{29:M,57:620},{13:f,16:h,44:39,55:40,87:d,139:621,307:43,308:m},n(l1,[2,366]),n(Hn,[2,79]),{13:f,16:h,44:136,45:H,46:622,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(Hn,[2,91],{336:[1,623]}),n([29,31,85,112,159,160,161,163,164,232,318,335],[2,114],{207:624,193:[1,625]}),n(Gs,[2,117]),{13:f,16:h,44:215,45:kc,55:220,82:k,87:d,89:$e,172:221,185:351,203:536,211:626,212:627,231:Lc,234:535,236:216,237:222,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,309:vr,310:xr,311:217,312:rr},n(zn,[2,134]),n(jc,[2,427]),n(zn,[2,135]),n(Zi,[2,26]),{44:628,87:d},n(Ji,[2,106]),n(Ji,[2,394]),n(W,[2,396]),n(Vc,[2,111]),n(Vc,[2,398]),{13:f,16:h,44:39,55:40,87:d,139:342,186:629,190:340,195:341,197:Qi,307:43,308:m},n(Hf,[2,217]),n(W,Cc,{144:248,140:630,143:631,31:[2,343]}),n(gt,[2,97]),n(yt,[2,380]),n(gt,[2,180]),{13:f,16:h,44:136,45:H,46:632,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},{13:f,16:h,44:136,45:H,46:633,55:133,67:132,68:134,77:131,82:k,87:d,172:135,224:Me,238:121,239:122,243:123,247:124,251:125,255:154,257:155,259:126,263:Ge,264:130,265:V,266:137,267:139,268:de,269:xe,270:z,271:Ce,273:Oe,274:Se,275:146,276:De,277:le,278:149,279:Ee,280:pe,283:Te,285:Ie,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Ne,346:Pe,347:we,348:w,349:E,350:y,351:x},n(gt,[2,190]),{290:[1,634]},{314:[1,635]},{13:f,16:h,48:[1,636],55:414,82:k,171:637,172:415,173:416,174:Rc,255:154,257:155,291:150,294:X,295:re,296:ne,297:J,298:Z,299:ee,300:te,301:ie,302:se,303:ae,304:oe,305:Q,306:ce,307:43,308:m,312:Nc},n(f1,[2,305]),n(U,[2,86]),n(oo,[2,374]),n(vi,[2,37]),n(vi,[2,38]),n(Xi,[2,72]),n(Xi,[2,360]),n(Hn,[2,77]),{29:M,57:638},{47:[1,639]},{29:[2,376]},n(Gs,[2,402]),n(Gs,[2,115],{215:10,208:528,214:529,44:530,205:640,13:i,16:i,45:i,197:i,224:i,229:i,308:i,87:d}),n(Gs,[2,118],{272:[1,641]}),n($c,[2,407],{213:642,319:643,317:[1,644]}),{48:[1,645]},{318:[1,646]},{31:[1,647]},{31:[2,344]},{48:[1,648]},{48:[1,649]},{291:650,303:ae,304:oe,305:Q,306:ce},n(ao,[2,218]),n(oo,[2,44]),n(f1,[2,306]),n(Hn,[2,78]),{44:651,87:d},n(Gs,[2,116]),n(W,[2,406]),n($c,[2,119]),n($c,[2,408]),n(c,i,{215:10,205:527,208:528,214:529,44:530,202:652,87:d}),n(Zi,[2,27]),n(Vc,[2,230]),n(h1,[2,345],{141:653,335:[1,654]}),n(gt,[2,181]),n(gt,[2,182]),{48:[2,191]},{48:[1,655]},{318:[1,656]},n(W,Cc,{144:248,142:657,143:658,31:d1,112:d1}),n(h1,[2,346]),n(Hn,[2,80]),n($c,[2,231]),n(Yi,[2,67]),n(Yi,[2,348])],defaultActions:{5:[2,240],6:[2,241],7:[2,242],9:[2,239],24:[2,1],25:[2,2],26:[2,244],87:[2,282],94:[2,384],100:[2,45],109:[2,325],166:[2,458],263:[2,439],336:[2,258],337:[2,101],487:[2,461],488:[2,462],560:[2,468],574:[2,17],575:[2,276],576:[2,18],577:[2,278],623:[2,376],631:[2,344],650:[2,191]},parseError:o(function(T,D){if(D.recoverable)this.trace(T);else{var R=new Error(T);throw R.hash=D,R}},"parseError"),parse:o(function(T){var D=this,R=[0],K=[],ve=[null],p=[],sr=this.table,g="",xn=0,fo=0,Gc=0,Wc=2,ho=1,zc=p.slice.call(arguments,1),ft=Object.create(this.lexer),Cn={yy:{}};for(var po in this.yy)Object.prototype.hasOwnProperty.call(this.yy,po)&&(Cn.yy[po]=this.yy[po]);ft.setInput(T,Cn.yy),Cn.yy.lexer=ft,Cn.yy.parser=this,typeof ft.yylloc>"u"&&(ft.yylloc={});var Qs=ft.yylloc;p.push(Qs);var Qe=ft.options&&ft.options.ranges;typeof Cn.yy.parseError=="function"?this.parseError=Cn.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function ct(On){R.length=R.length-2*On,ve.length=ve.length-On,p.length=p.length-On}o(ct,"popStack");for(var Be=o(function(){var On;return On=ft.lex()||ho,typeof On!="number"&&(On=D.symbols_[On]||On),On},"lex"),ze,wr,ns,kr,iN,fh,Ys={},Hc,Jn,A1,Kc;;){if(ns=R[R.length-1],this.defaultActions[ns]?kr=this.defaultActions[ns]:((ze===null||typeof ze>"u")&&(ze=Be()),kr=sr[ns]&&sr[ns][ze]),typeof kr>"u"||!kr.length||!kr[0]){var hh="";Kc=[];for(Hc in sr[ns])this.terminals_[Hc]&&Hc>Wc&&Kc.push("'"+this.terminals_[Hc]+"'");ft.showPosition?hh="Parse error on line "+(xn+1)+`:
`+ft.showPosition()+`
Expecting `+Kc.join(", ")+", got '"+(this.terminals_[ze]||ze)+"'":hh="Parse error on line "+(xn+1)+": Unexpected "+(ze==ho?"end of input":"'"+(this.terminals_[ze]||ze)+"'"),this.parseError(hh,{text:ft.match,token:this.terminals_[ze]||ze,line:ft.yylineno,loc:Qs,expected:Kc})}if(kr[0]instanceof Array&&kr.length>1)throw new Error("Parse Error: multiple actions possible at state: "+ns+", token: "+ze);switch(kr[0]){case 1:R.push(ze),ve.push(ft.yytext),p.push(ft.yylloc),R.push(kr[1]),ze=null,wr?(ze=wr,wr=null):(fo=ft.yyleng,g=ft.yytext,xn=ft.yylineno,Qs=ft.yylloc,Gc>0&&Gc--);break;case 2:if(Jn=this.productions_[kr[1]][1],Ys.$=ve[ve.length-Jn],Ys._$={first_line:p[p.length-(Jn||1)].first_line,last_line:p[p.length-1].last_line,first_column:p[p.length-(Jn||1)].first_column,last_column:p[p.length-1].last_column},Qe&&(Ys._$.range=[p[p.length-(Jn||1)].range[0],p[p.length-1].range[1]]),fh=this.performAction.apply(Ys,[g,fo,xn,Cn.yy,kr[1],ve,p].concat(zc)),typeof fh<"u")return fh;Jn&&(R=R.slice(0,-1*Jn*2),ve=ve.slice(0,-1*Jn),p=p.slice(0,-1*Jn)),R.push(this.productions_[kr[1]][0]),ve.push(Ys.$),p.push(Ys._$),A1=sr[R[R.length-2]][R[R.length-1]],R.push(A1);break;case 3:return!0}}return!0},"parse")},Bc=pm().Wildcard,Uc="http://www.w3.org/1999/02/22-rdf-syntax-ns#",LS=Uc+"type",jS=Uc+"first",MS=Uc+"rest",p1=Uc+"nil",qc="http://www.w3.org/2001/XMLSchema#",m1=qc+"integer",g1=qc+"decimal",y1=qc+"double",VS=qc+"boolean",es="",v1="",w1="";function ir(A){return A.toLowerCase()}o(ir,"lowercase");function Yn(A,T){return A.push(T),A}o(Yn,"appendTo");function ts(A,T){return A.push.apply(A,T),A}o(ts,"appendAllTo");function ht(A){A||(A={});for(var T=1,D=arguments.length,R;T<D&&(R=arguments[T]||{});T++)for(var K in R)A[K]=R[K];return A}o(ht,"extend");function Tn(){for(var A=[],T=0,D=arguments.length;T<D;T++)A=A.concat.apply(A,arguments[T]);return A}o(Tn,"unionAll");function co(A){if(A[0]==="<"&&(A=A.substring(1,A.length-1)),/^[a-z][a-z0-9.+-]*:/i.test(A))return A;if(!Ae.base)throw new Error("Cannot resolve relative IRI "+A+" because no base IRI was set.");switch(es!==Ae.base&&(es=Ae.base,v1=es.replace(/[^\/:]*$/,""),w1=es.match(/^(?:[a-z]+:\/*)?[^\/]*/)[0]),A[0]){case void 0:return es;case"#":return es+A;case"?":return es.replace(/(?:\?.*)?$/,A);case"/":return w1+A;default:return v1+A}}o(co,"resolveIRI");function eh(A){if(A){var T=A[0];if(T==="?"||T==="$")return Ae.factory.variable(A.substr(1))}return A}o(eh,"toVar");function Nt(A,T){return{type:"operation",operator:A,args:T||[]}}o(Nt,"operation");function Ws(A,T){var D={expression:A==="*"?new Bc:A};if(T)for(var R in T)D[R]=T[R];return D}o(Ws,"expression");function zs(A,T){return{type:"path",pathType:A,items:T}}o(zs,"path");function th(A,T){for(var D=0,R=T.length,K;D<R&&(K=T[D]);D++)A=Nt(K[0],[A,K[1]]);return A}o(th,"createOperationTree");function rs(A,T){var D=[],R=[],K=A.length,ve,p={};if(!K)return null;for(var sr=0;sr<K&&(ve=A[sr]);sr++)(ve.named?R:D).push(ve.iri);return p[T||"from"]={default:D,named:R},p}o(rs,"groupDatasets");function Hs(A){return parseInt(A,10)}o(Hs,"toInt");function rh(A){return A.type==="group"&&A.patterns.length===1?A.patterns[0]:A}o(rh,"degroupSingle");function An(A,T){return T&&T.termType!=="NamedNode"&&(T=Ae.factory.namedNode(T)),Ae.factory.literal(A,T)}o(An,"createTypedLiteral");function $S(A,T){return Ae.factory.literal(A,T)}o($S,"createLangLiteral");function nh(A,T,D){if(!("termType"in T))throw new Error("Nested triples cannot contain paths");return Ae.factory.quad(A,T,D)}o(nh,"nestedTriple");function Xn(A,T,D,R){var K={};return A!=null&&(K.subject=A),T!=null&&(K.predicate=T),D!=null&&(K.object=D),R!=null&&(K.annotations=R),K}o(Xn,"triple");function uo(A){return typeof A=="string"?A.startsWith("e_")?Ae.factory.blankNode(A):Ae.factory.blankNode("e_"+A):Ae.factory.blankNode("g_"+_1++)}o(uo,"blank");var _1=0;Ae._resetBlanks=function(){_1=0};var BS=/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\(.)/g,US={"\\":"\\","'":"'",'"':'"',t:"	",b:"\b",n:`
`,r:"\r",f:"\f"},qS=/[\uD800-\uDBFF]([^\uDC00-\uDFFF]|$)/,ih=String.fromCharCode;function b1(A,T){A=A.substring(T,A.length-T);try{A=A.replace(BS,function(D,R,K,ve){var p;if(R){if(p=parseInt(R,16),isNaN(p))throw new Error;return ih(p)}else if(K){if(p=parseInt(K,16),isNaN(p))throw new Error;return p<65535?ih(p):ih(55296+((p-=65536)>>10),56320+(p&1023))}else{var sr=US[ve];if(!sr)throw new Error;return sr}})}catch{return""}if(qS.exec(A))throw new Error("Invalid unicode codepoint of surrogate pair without corresponding codepoint in "+A);return A}o(b1,"unescapeString");function GS(A){var T=uo(),D=T,R=[],K,ve=[];A.forEach(function(xn){R.push(xn.entity),ts(ve,xn.triples)});for(var p=0,sr=0,g=R.length,K=Array(g*2);p<g;)K[sr++]=Xn(D,Ae.factory.namedNode(jS),R[p]),K[sr++]=Xn(D,Ae.factory.namedNode(MS),D=++p<g?uo():Ae.factory.namedNode(p1));return{entity:T,triples:ts(K,ve)}}o(GS,"createList");function WS(A){var T=uo();return{entity:T,triples:A.map(function(D){return ht(Xn(T),D)})}}o(WS,"createAnonymousObject");function sh(A,T,D){var R=[],K=[];return T.forEach(function(ve){let p=null;ve.annotation&&(p=ve.annotation,ve=ve.object),R.push(Xn(null,A,ve.entity,p)),ts(K,ve.triples)}),Tn(R,D||[],K)}o(sh,"objectListToTriples");function rN(A){for(var T=[],D,R=0,K;K=A[R];R++)switch(K.type){case"bgp":K.triples.length&&(D?ts(D.triples,K.triples):Yn(T,D=K));break;default:(!K.patterns||K.patterns.length>0)&&(Yn(T,K),D=null)}return T}o(rN,"mergeAdjacentBGPs");function Ks(A){return A.variable?A.variable.value:A.value||A.expression.value}o(Ks,"getExpressionId");function ah(A){if(!A)return[];if(A.type==="aggregate")return[A];if(A.type==="operation"){let T=[];for(let D of A.args)T.push(...ah(D));return T}return[]}o(ah,"getAggregatesOfExpression");function zS(A){let T=new Set,D=o(function(R){R&&(R.termType==="Variable"?T.add(R):R.type==="operation"&&R.args.forEach(D))},"visitExpression");return D(A),T}o(zS,"getVariablesFromExpression");function oh(A,T=1,D=[]){for(let R of A)T>0&&R instanceof Array?oh(R,T-1,D):D.push(R);return D}o(oh,"flatten");function ch(A){return A.termType==="Variable"}o(ch,"isVariable");function S1(A){if(A.triples){let T=[];for(let D of A.triples)ch(D.subject)&&T.push(D.subject.value),ch(D.predicate)&&T.push(D.predicate.value),ch(D.object)&&T.push(D.object.value);return T}else if(A.patterns){let T=[];for(let D of A.patterns)T.push(...S1(D));return T}return[]}o(S1,"getBoundVarsFromGroupGraphPattern");function HS(A){let T=A.slice().sort(),D=[];for(let R=0;R<T.length-1;R++)T[R+1]==T[R]&&D.push(T[R]);return D}o(HS,"getDuplicatesInArray");function lo(A){if(!Ae.sparqlStar)throw new Error("SPARQL-star support is not enabled");return A}o(lo,"ensureSparqlStar");function E1(A,T,D){for(let R of T){let K=Xn("subject"in R?R.subject:A,R.predicate,R.object);D.push(K),R.annotations&&E1(nh(A,R.predicate,R.object),R.annotations,D)}}o(E1,"_applyAnnotations");function uh(A){if(Ae.sparqlStar){let T=[];return A.forEach(D=>{let R=Xn(D.subject,D.predicate,D.object);T.push(R),D.annotations&&E1(nh(D.subject,D.predicate,D.object),D.annotations,T)}),T}return A}o(uh,"applyAnnotations");function nN(A){if(!Ae.sparqlStarNestedQuads)throw new Error("Lenient SPARQL-star support with nested quads is not enabled");return A}o(nN,"ensureSparqlStarNestedQuads");function T1(A){for(let T of A){if(T.type==="graph"&&T.name.termType==="Variable")throw new Error("Detected illegal variable in GRAPH");if(T.type==="bgp"||T.type==="graph"){for(let D of T.triples)if(D.subject.termType==="Variable"||D.predicate.termType==="Variable"||D.object.termType==="Variable")throw new Error("Detected illegal variable in BGP")}}return A}o(T1,"ensureNoVariables");function lh(A){for(let T of A)if(T.type==="bgp"){for(let D of T.triples)if(D.subject.termType==="BlankNode"||D.predicate.termType==="BlankNode"||D.object.termType==="BlankNode")throw new Error("Detected illegal blank node in BGP")}return A}o(lh,"ensureNoBnodes");var KS=(function(){var A={EOF:1,parseError:o(function(D,R){if(this.yy.parser)this.yy.parser.parseError(D,R);else throw new Error(D)},"parseError"),setInput:o(function(T,D){return this.yy=D||this.yy||{},this._input=T,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},"setInput"),input:o(function(){var T=this._input[0];this.yytext+=T,this.yyleng++,this.offset++,this.match+=T,this.matched+=T;var D=T.match(/(?:\r\n?|\n).*/g);return D?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),T},"input"),unput:o(function(T){var D=T.length,R=T.split(/(?:\r\n?|\n)/g);this._input=T+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-D),this.offset-=D;var K=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),R.length-1&&(this.yylineno-=R.length-1);var ve=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:R?(R.length===K.length?this.yylloc.first_column:0)+K[K.length-R.length].length-R[0].length:this.yylloc.first_column-D},this.options.ranges&&(this.yylloc.range=[ve[0],ve[0]+this.yyleng-D]),this.yyleng=this.yytext.length,this},"unput"),more:o(function(){return this._more=!0,this},"more"),reject:o(function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},"reject"),less:o(function(T){this.unput(this.match.slice(T))},"less"),pastInput:o(function(){var T=this.matched.substr(0,this.matched.length-this.match.length);return(T.length>20?"...":"")+T.substr(-20).replace(/\n/g,"")},"pastInput"),upcomingInput:o(function(){var T=this.match;return T.length<20&&(T+=this._input.substr(0,20-T.length)),(T.substr(0,20)+(T.length>20?"...":"")).replace(/\n/g,"")},"upcomingInput"),showPosition:o(function(){var T=this.pastInput(),D=new Array(T.length+1).join("-");return T+this.upcomingInput()+`
`+D+"^"},"showPosition"),test_match:o(function(T,D){var R,K,ve;if(this.options.backtrack_lexer&&(ve={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(ve.yylloc.range=this.yylloc.range.slice(0))),K=T[0].match(/(?:\r\n?|\n).*/g),K&&(this.yylineno+=K.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:K?K[K.length-1].length-K[K.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+T[0].length},this.yytext+=T[0],this.match+=T[0],this.matches=T,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(T[0].length),this.matched+=T[0],R=this.performAction.call(this,this.yy,this,D,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),R)return R;if(this._backtrack){for(var p in ve)this[p]=ve[p];return!1}return!1},"test_match"),next:o(function(){if(this.done)return this.EOF;this._input||(this.done=!0);var T,D,R,K;this._more||(this.yytext="",this.match="");for(var ve=this._currentRules(),p=0;p<ve.length;p++)if(R=this._input.match(this.rules[ve[p]]),R&&(!D||R[0].length>D[0].length)){if(D=R,K=p,this.options.backtrack_lexer){if(T=this.test_match(R,ve[p]),T!==!1)return T;if(this._backtrack){D=!1;continue}else return!1}else if(!this.options.flex)break}return D?(T=this.test_match(D,ve[K]),T!==!1?T:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},"next"),lex:o(function(){var D=this.next();return D||this.lex()},"lex"),begin:o(function(D){this.conditionStack.push(D)},"begin"),popState:o(function(){var D=this.conditionStack.length-1;return D>0?this.conditionStack.pop():this.conditionStack[0]},"popState"),_currentRules:o(function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},"_currentRules"),topState:o(function(D){return D=this.conditionStack.length-1-Math.abs(D||0),D>=0?this.conditionStack[D]:"INITIAL"},"topState"),pushState:o(function(D){this.begin(D)},"pushState"),stateStackSize:o(function(){return this.conditionStack.length},"stateStackSize"),options:{flex:!0,"case-insensitive":!0},performAction:o(function(D,R,K,ve){var p=ve;switch(K){case 0:break;case 1:return 12;case 2:return 15;case 3:return 41;case 4:return 325;case 5:return 326;case 6:return 45;case 7:return 47;case 8:return 48;case 9:return 39;case 10:return 24;case 11:return 28;case 12:return 29;case 13:return 31;case 14:return 32;case 15:return 36;case 16:return 53;case 17:return 327;case 18:return 63;case 19:return 64;case 20:return 70;case 21:return 73;case 22:return 76;case 23:return 78;case 24:return 81;case 25:return 83;case 26:return 85;case 27:return 193;case 28:return 100;case 29:return 328;case 30:return 121;case 31:return 329;case 32:return 330;case 33:return 110;case 34:return 331;case 35:return 109;case 36:return 332;case 37:return 333;case 38:return 113;case 39:return 115;case 40:return 116;case 41:return 131;case 42:return 123;case 43:return 126;case 44:return 128;case 45:return 132;case 46:return 112;case 47:return 334;case 48:return 335;case 49:return 159;case 50:return 161;case 51:return 164;case 52:return 174;case 53:return 160;case 54:return 336;case 55:return 163;case 56:return 312;case 57:return 314;case 58:return 317;case 59:return 318;case 60:return 272;case 61:return 197;case 62:return 337;case 63:return 338;case 64:return 229;case 65:return 340;case 66:return 263;case 67:return 224;case 68:return 231;case 69:return 232;case 70:return 242;case 71:return 246;case 72:return 290;case 73:return 341;case 74:return 342;case 75:return 343;case 76:return 344;case 77:return 345;case 78:return 250;case 79:return 346;case 80:return 265;case 81:return 276;case 82:return 277;case 83:return 268;case 84:return 269;case 85:return 270;case 86:return 271;case 87:return 347;case 88:return 348;case 89:return 273;case 90:return 274;case 91:return 350;case 92:return 349;case 93:return 351;case 94:return 279;case 95:return 280;case 96:return 283;case 97:return 285;case 98:return 289;case 99:return 293;case 100:return 296;case 101:return 13;case 102:return 16;case 103:return 308;case 104:return 309;case 105:return 87;case 106:return 292;case 107:return 82;case 108:return 294;case 109:return 295;case 110:return 297;case 111:return 298;case 112:return 299;case 113:return 300;case 114:return 301;case 115:return 302;case 116:return"EXPONENT";case 117:return 303;case 118:return 304;case 119:return 305;case 120:return 306;case 121:return 89;case 122:return 310;case 123:return 6;case 124:return"INVALID";case 125:console.log(R.yytext);break}},"anonymous"),rules:[/^(?:\s+|(#[^\n\r]*))/i,/^(?:BASE)/i,/^(?:PREFIX)/i,/^(?:SELECT)/i,/^(?:DISTINCT)/i,/^(?:REDUCED)/i,/^(?:\()/i,/^(?:AS)/i,/^(?:\))/i,/^(?:\*)/i,/^(?:CONSTRUCT)/i,/^(?:WHERE)/i,/^(?:\{)/i,/^(?:\})/i,/^(?:DESCRIBE)/i,/^(?:ASK)/i,/^(?:FROM)/i,/^(?:NAMED)/i,/^(?:GROUP)/i,/^(?:BY)/i,/^(?:HAVING)/i,/^(?:ORDER)/i,/^(?:ASC)/i,/^(?:DESC)/i,/^(?:LIMIT)/i,/^(?:OFFSET)/i,/^(?:VALUES)/i,/^(?:;)/i,/^(?:LOAD)/i,/^(?:SILENT)/i,/^(?:INTO)/i,/^(?:CLEAR)/i,/^(?:DROP)/i,/^(?:CREATE)/i,/^(?:ADD)/i,/^(?:TO)/i,/^(?:MOVE)/i,/^(?:COPY)/i,/^(?:INSERT((\s+|(#[^\n\r]*)\n\r?)+)DATA)/i,/^(?:DELETE((\s+|(#[^\n\r]*)\n\r?)+)DATA)/i,/^(?:DELETE((\s+|(#[^\n\r]*)\n\r?)+)WHERE)/i,/^(?:WITH)/i,/^(?:DELETE)/i,/^(?:INSERT)/i,/^(?:USING)/i,/^(?:DEFAULT)/i,/^(?:GRAPH)/i,/^(?:ALL)/i,/^(?:\.)/i,/^(?:OPTIONAL)/i,/^(?:SERVICE)/i,/^(?:BIND)/i,/^(?:UNDEF)/i,/^(?:MINUS)/i,/^(?:UNION)/i,/^(?:FILTER)/i,/^(?:<<)/i,/^(?:>>)/i,/^(?:\{\|)/i,/^(?:\|\})/i,/^(?:,)/i,/^(?:a)/i,/^(?:\|)/i,/^(?:\/)/i,/^(?:\^)/i,/^(?:\?)/i,/^(?:\+)/i,/^(?:!)/i,/^(?:\[)/i,/^(?:\])/i,/^(?:\|\|)/i,/^(?:&&)/i,/^(?:=)/i,/^(?:!=)/i,/^(?:<)/i,/^(?:>)/i,/^(?:<=)/i,/^(?:>=)/i,/^(?:IN)/i,/^(?:NOT)/i,/^(?:-)/i,/^(?:BOUND)/i,/^(?:BNODE)/i,/^(?:(RAND|NOW|UUID|STRUUID))/i,/^(?:(LANG|DATATYPE|IRI|URI|ABS|CEIL|FLOOR|ROUND|STRLEN|STR|UCASE|LCASE|ENCODE_FOR_URI|YEAR|MONTH|DAY|HOURS|MINUTES|SECONDS|TIMEZONE|TZ|MD5|SHA1|SHA256|SHA384|SHA512|isIRI|isURI|isBLANK|isLITERAL|isNUMERIC))/i,/^(?:(SUBJECT|PREDICATE|OBJECT|isTRIPLE))/i,/^(?:(LANGMATCHES|CONTAINS|STRSTARTS|STRENDS|STRBEFORE|STRAFTER|STRLANG|STRDT|sameTerm))/i,/^(?:CONCAT)/i,/^(?:COALESCE)/i,/^(?:IF)/i,/^(?:TRIPLE)/i,/^(?:REGEX)/i,/^(?:SUBSTR)/i,/^(?:REPLACE)/i,/^(?:EXISTS)/i,/^(?:COUNT)/i,/^(?:SUM|MIN|MAX|AVG|SAMPLE)/i,/^(?:GROUP_CONCAT)/i,/^(?:SEPARATOR)/i,/^(?:\^\^)/i,/^(?:true|false)/i,/^(?:(<(?:[^<>\"\{\}\|\^`\\\u0000-\u0020])*>))/i,/^(?:((([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.)*(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040]))?)?:))/i,/^(?:(((([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.)*(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040]))?)?:)((?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|:|[0-9]|((%([0-9A-Fa-f])([0-9A-Fa-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.|:|((%([0-9A-Fa-f])([0-9A-Fa-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%))))*(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|:|((%([0-9A-Fa-f])([0-9A-Fa-f]))|(\\(_|~|\.|-|!|\$|&|'|\(|\)|\*|\+|,|;|=|\/|\?|#|@|%)))))?)))/i,/^(?:(_:(?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|[0-9])(?:(?:(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])|\.)*(((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|-|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040]))?))/i,/^(?:([\?\$]((?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|[0-9])(?:((?:([A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])|_))|[0-9]|\u00B7|[\u0300-\u036F\u203F-\u2040])*)))/i,/^(?:(@[a-zA-Z]+(?:-[a-zA-Z0-9]+)*))/i,/^(?:([0-9]+))/i,/^(?:([0-9]*\.[0-9]+))/i,/^(?:([0-9]+\.[0-9]*([eE][+-]?[0-9]+)|\.([0-9])+([eE][+-]?[0-9]+)|([0-9])+([eE][+-]?[0-9]+)))/i,/^(?:(\+([0-9]+)))/i,/^(?:(\+([0-9]*\.[0-9]+)))/i,/^(?:(\+([0-9]+\.[0-9]*([eE][+-]?[0-9]+)|\.([0-9])+([eE][+-]?[0-9]+)|([0-9])+([eE][+-]?[0-9]+))))/i,/^(?:(-([0-9]+)))/i,/^(?:(-([0-9]*\.[0-9]+)))/i,/^(?:(-([0-9]+\.[0-9]*([eE][+-]?[0-9]+)|\.([0-9])+([eE][+-]?[0-9]+)|([0-9])+([eE][+-]?[0-9]+))))/i,/^(?:([eE][+-]?[0-9]+))/i,/^(?:('(?:(?:[^\u0027\u005C\u000A\u000D])|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])))*'))/i,/^(?:("(?:(?:[^\u0022\u005C\u000A\u000D])|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])))*"))/i,/^(?:('''(?:(?:'|'')?(?:[^'\\]|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f]))))*'''))/i,/^(?:("""(?:(?:"|"")?(?:[^\"\\]|(\\[tbnrf\\\"']|\\u([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])|\\U([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f]))))*"""))/i,/^(?:(\((\u0020|\u0009|\u000D|\u000A)*\)))/i,/^(?:(\[(\u0020|\u0009|\u000D|\u000A)*\]))/i,/^(?:$)/i,/^(?:.)/i,/^(?:.)/i],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125],inclusive:!0}}};return A})();Zf.lexer=KS;function Ae(){this.yy={}}return o(Ae,"Parser"),Ae.prototype=Zf,Zf.Parser=Ae,new Ae})();o3.exports=oD});var h3=v((OM,f3)=>{var cD="http://www.w3.org/2001/XMLSchema#integer",uD="http://www.w3.org/2001/XMLSchema#string";function it(n){this._options=n=n||{};var e=n.prefixes||{};this._prefixByIri={};var t=[];for(var r in e){var i=e[r];Lo(i)&&(this._prefixByIri[i]=r,t.push(i))}var s=t.join("|").replace(/[\]\/\(\)\*\+\?\.\\\$]/g,"\\$&");this._prefixRegex=new RegExp("^("+s+")([a-zA-Z][\\-_a-zA-Z0-9]*)$"),this._usedPrefixes={},this._sparqlStar=n.sparqlStar,this._indent=Lo(n.indent)?n.indent:"  ",this._newline=Lo(n.newline)?n.newline:`
`,this._explicitDatatype=!!n.explicitDatatype}o(it,"Generator");it.prototype.toQuery=function(n){var e="";return n.queryType&&(e+=n.queryType.toUpperCase()+" "),n.reduced&&(e+="REDUCED "),n.distinct&&(e+="DISTINCT "),n.variables?e+=Pr(n.variables,void 0,function(t){return/^[?$]/.test(t)?t:Oi(t)?this.toEntity(t):"("+this.toExpression(t.expression)+" AS "+sl(t.variable)+")"},this)+" ":n.template&&(e+=this.group(n.template,!0)+this._newline),n.from&&(e+=this.graphs("FROM ",n.from.default)+this.graphs("FROM NAMED ",n.from.named)),n.where&&(e+="WHERE "+this.group(n.where,!0)+this._newline),n.updates&&(e+=Pr(n.updates,";"+this._newline,this.toUpdate,this)),n.group&&(e+="GROUP BY "+Pr(n.group,void 0,function(t){var r=Oi(t.expression)?this.toEntity(t.expression):"("+this.toExpression(t.expression)+")";return t.variable?"("+r+" AS "+sl(t.variable)+")":r},this)+this._newline),n.having&&(e+="HAVING ("+Pr(n.having,void 0,this.toExpression,this)+")"+this._newline),n.order&&(e+="ORDER BY "+Pr(n.order,void 0,function(t){var r="("+this.toExpression(t.expression)+")";return t.descending?"DESC "+r:r},this)+this._newline),n.offset&&(e+="OFFSET "+n.offset+this._newline),n.limit&&(e+="LIMIT "+n.limit+this._newline),n.values&&(e+=this.values(n)),e=this.baseAndPrefixes(n)+e,e.trim()};it.prototype.baseAndPrefixes=function(n){var e=n.base?"BASE <"+n.base+">"+this._newline:"",t="";for(var r in n.prefixes)(this._options.allPrefixes||this._usedPrefixes[r])&&(t+="PREFIX "+r+": <"+n.prefixes[r]+">"+this._newline);return e+t};it.prototype.toPattern=function(n){var e=n.type||n instanceof Array&&"array"||(n.subject&&n.predicate&&n.object?"triple":"");if(!(e in this))throw new Error("Unknown entry type: "+e);return this[e](n)};it.prototype.triple=function(n){return this.toEntity(n.subject)+" "+this.toEntity(n.predicate)+" "+this.toEntity(n.object)+"."};it.prototype.array=function(n){return Pr(n,this._newline,this.toPattern,this)};it.prototype.bgp=function(n){return this.encodeTriples(n.triples)};it.prototype.encodeTriples=function(n){if(!n.length)return"";for(var e=[],t=void 0,r=void 0,i=0;i<n.length;i++){var s=n[i];Ss(s.subject,t)?Ss(s.predicate,r)?e.push(","):(r=s.predicate,e.push(";"+this._newline,this._indent,this.toEntity(r))):(t&&e.push("."+this._newline),t=s.subject,r=s.predicate,e.push(this.toEntity(t)," ",this.toEntity(r))),e.push(" ",this.toEntity(s.object))}return e.push("."),e.join("")};it.prototype.graph=function(n){return"GRAPH "+this.toEntity(n.name)+" "+this.group(n)};it.prototype.graphs=function(n,e){return!e||e.length===0?"":Pr(e,"",function(t){return n+this.toEntity(t)+this._newline},this)};it.prototype.group=function(n,e){return n=e!==!0?this.array(n.patterns||n.triples):this.toPattern(n.type!=="group"?n:n.patterns),n.indexOf(this._newline)===-1?"{ "+n+" }":"{"+this._newline+this.indent(n)+this._newline+"}"};it.prototype.query=function(n){return this.toQuery(n)};it.prototype.filter=function(n){return"FILTER("+this.toExpression(n.expression)+")"};it.prototype.bind=function(n){return"BIND("+this.toExpression(n.expression)+" AS "+sl(n.variable)+")"};it.prototype.optional=function(n){return"OPTIONAL "+this.group(n)};it.prototype.union=function(n){return Pr(n.patterns,this._newline+"UNION"+this._newline,function(e){return this.group(e,!0)},this)};it.prototype.minus=function(n){return"MINUS "+this.group(n)};it.prototype.values=function(n){var e=Object.keys(n.values.reduce(function(i,s){for(var a in s)i[a]=!0;return i},{})),t,r;return e.length===1?t=r="":(t="(",r=")"),"VALUES "+t+e.join(" ")+r+" {"+this._newline+Pr(n.values,this._newline,function(i){return"  "+t+Pr(e,void 0,function(s){return i[s]?this.toEntity(i[s]):"UNDEF"},this)+r},this)+this._newline+"}"};it.prototype.service=function(n){return"SERVICE "+(n.silent?"SILENT ":"")+this.toEntity(n.name)+" "+this.group(n)};it.prototype.toExpression=function(n){if(Oi(n))return this.toEntity(n);switch(n.type.toLowerCase()){case"aggregate":return n.aggregation.toUpperCase()+"("+(n.distinct?"DISTINCT ":"")+this.toExpression(n.expression)+(typeof n.separator=="string"?'; SEPARATOR = "'+n.separator.replace(u3,l3)+'"':"")+")";case"functioncall":return this.toEntity(n.function)+"("+Pr(n.args,", ",this.toExpression,this)+")";case"operation":var e=n.operator.toUpperCase(),t=n.args||[];switch(n.operator.toLowerCase()){case"<":case">":case">=":case"<=":case"&&":case"||":case"=":case"!=":case"+":case"-":case"*":case"/":return(Oi(t[0])?this.toEntity(t[0]):"("+this.toExpression(t[0])+")")+" "+e+" "+(Oi(t[1])?this.toEntity(t[1]):"("+this.toExpression(t[1])+")");case"!":return"!("+this.toExpression(t[0])+")";case"uplus":return"+("+this.toExpression(t[0])+")";case"uminus":return"-("+this.toExpression(t[0])+")";case"notin":e="NOT IN";case"in":return this.toExpression(t[0])+" "+e+"("+(Lo(t[1])?t[1]:Pr(t[1],", ",this.toExpression,this))+")";case"notexists":e="NOT EXISTS";case"exists":return e+" "+this.group(t[0],!0);default:return e+"("+Pr(t,", ",this.toExpression,this)+")"}default:throw new Error("Unknown expression type: "+n.type)}};it.prototype.toEntity=function(n){if(Oi(n))switch(n.termType){case"Wildcard":return"*";case"Variable":return sl(n);case"BlankNode":return"_:"+n.value;case"Literal":var e=n.value||"",t=n.language||"",r=n.datatype;if(n='"'+e.replace(u3,l3)+'"',t)n+="@"+t;else if(r){if(!this._explicitDatatype)switch(r.value){case uD:return n;case cD:if(/^\d+$/.test(e))return e+" "}n+="^^"+this.encodeIRI(r.value)}return n;case"Quad":if(!this._sparqlStar)throw new Error("SPARQL* support is not enabled");return n.graph&&n.graph.termType!=="DefaultGraph"?"<< GRAPH "+this.toEntity(n.graph)+" { "+this.toEntity(n.subject)+" "+this.toEntity(n.predicate)+" "+this.toEntity(n.object)+" }  >>":"<< "+this.toEntity(n.subject)+" "+this.toEntity(n.predicate)+" "+this.toEntity(n.object)+" >>";default:return this.encodeIRI(n.value)}else{var i=n.items.map(this.toEntity,this),s=n.pathType;switch(s){case"^":case"!":return s+i[0];case"*":case"+":case"?":return"("+i[0]+s+")";default:return"("+i.join(s)+")"}}};var u3=/["\\\t\n\r\b\f]/g,l3=o(function(n){return lD[n]},"escapeReplacer"),lD={"\\":"\\\\",'"':'\\"',"	":"\\t","\n":"\\n","\r":"\\r","\b":"\\b","\f":"\\f"};it.prototype.encodeIRI=function(n){var e=this._prefixRegex.exec(n);if(e){var t=this._prefixByIri[e[1]];return this._usedPrefixes[t]=!0,t+":"+e[2]}return"<"+n+">"};it.prototype.toUpdate=function(n){switch(n.type||n.updateType){case"load":return"LOAD"+(n.source?" "+this.toEntity(n.source):"")+(n.destination?" INTO GRAPH "+this.toEntity(n.destination):"");case"insert":return"INSERT DATA "+this.group(n.insert,!0);case"delete":return"DELETE DATA "+this.group(n.delete,!0);case"deletewhere":return"DELETE WHERE "+this.group(n.delete,!0);case"insertdelete":return(n.graph?"WITH "+this.toEntity(n.graph)+this._newline:"")+(n.delete.length?"DELETE "+this.group(n.delete,!0)+this._newline:"")+(n.insert.length?"INSERT "+this.group(n.insert,!0)+this._newline:"")+(n.using?this.graphs("USING ",n.using.default):"")+(n.using?this.graphs("USING NAMED ",n.using.named):"")+"WHERE "+this.group(n.where,!0);case"add":case"copy":case"move":return n.type.toUpperCase()+" "+(n.silent?"SILENT ":"")+(n.source.default?"DEFAULT":this.toEntity(n.source.name))+" TO "+this.toEntity(n.destination.name);case"create":case"clear":case"drop":return n.type.toUpperCase()+(n.silent?" SILENT ":" ")+(n.graph.default?"DEFAULT":n.graph.named?"NAMED":n.graph.all?"ALL":"GRAPH "+this.toEntity(n.graph.name));default:throw new Error("Unknown update query type: "+n.type)}};it.prototype.indent=function(n){return n.replace(/^/gm,this._indent)};function sl(n){return"?"+n.value}o(sl,"variableToString");function Lo(n){return typeof n=="string"}o(Lo,"isString");function Oi(n){return typeof n.termType=="string"}o(Oi,"isTerm");function Ss(n,e){if(!n||!Oi(n)||!e||!Oi(e)||n.termType!==e.termType)return!1;switch(n.termType){case"Literal":return n.value===e.value&&n.language===e.language&&Ss(n.datatype,e.datatype);case"Quad":return Ss(n.subject,e.subject)&&Ss(n.predicate,e.predicate)&&Ss(n.object,e.object)&&Ss(n.graph,e.graph);default:return n.value===e.value}}o(Ss,"equalTerms");function Pr(n,e,t,r){return n.map(t,r).join(Lo(e)?e:" ")}o(Pr,"mapJoin");function fD(n={}){return{stringify:o(function(e){var t=Object.create(n);return t.prefixes=e.prefixes,new it(t).toQuery(e)},"stringify"),createGenerator:o(function(){return new it(n)},"createGenerator")}}o(fD,"_Generator");f3.exports={Generator:fD}});var gm=v(al=>{"use strict";Object.defineProperty(al,"__esModule",{value:!0});al.BlankNode=void 0;var mm=class{static{o(this,"BlankNode")}constructor(e){this.termType="BlankNode",this.value=e}equals(e){return!!e&&e.termType==="BlankNode"&&e.value===this.value}};al.BlankNode=mm});var ym=v(ol=>{"use strict";Object.defineProperty(ol,"__esModule",{value:!0});ol.DefaultGraph=void 0;var jo=class{static{o(this,"DefaultGraph")}constructor(){this.termType="DefaultGraph",this.value=""}equals(e){return!!e&&e.termType==="DefaultGraph"}};ol.DefaultGraph=jo;jo.INSTANCE=new jo});var ul=v(cl=>{"use strict";Object.defineProperty(cl,"__esModule",{value:!0});cl.NamedNode=void 0;var vm=class{static{o(this,"NamedNode")}constructor(e){this.termType="NamedNode",this.value=e}equals(e){return!!e&&e.termType==="NamedNode"&&e.value===this.value}};cl.NamedNode=vm});var wm=v(ll=>{"use strict";Object.defineProperty(ll,"__esModule",{value:!0});ll.Literal=void 0;var d3=ul(),Mo=class n{static{o(this,"Literal")}constructor(e,t){this.termType="Literal",this.value=e,typeof t=="string"?(this.language=t,this.datatype=n.RDF_LANGUAGE_STRING):t?(this.language="",this.datatype=t):(this.language="",this.datatype=n.XSD_STRING)}equals(e){return!!e&&e.termType==="Literal"&&e.value===this.value&&e.language===this.language&&this.datatype.equals(e.datatype)}};ll.Literal=Mo;Mo.RDF_LANGUAGE_STRING=new d3.NamedNode("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString");Mo.XSD_STRING=new d3.NamedNode("http://www.w3.org/2001/XMLSchema#string")});var bm=v(fl=>{"use strict";Object.defineProperty(fl,"__esModule",{value:!0});fl.Quad=void 0;var _m=class{static{o(this,"Quad")}constructor(e,t,r,i){this.termType="Quad",this.value="",this.subject=e,this.predicate=t,this.object=r,this.graph=i}equals(e){return!!e&&(e.termType==="Quad"||!e.termType)&&this.subject.equals(e.subject)&&this.predicate.equals(e.predicate)&&this.object.equals(e.object)&&this.graph.equals(e.graph)}};fl.Quad=_m});var Em=v(hl=>{"use strict";Object.defineProperty(hl,"__esModule",{value:!0});hl.Variable=void 0;var Sm=class{static{o(this,"Variable")}constructor(e){this.termType="Variable",this.value=e}equals(e){return!!e&&e.termType==="Variable"&&e.value===this.value}};hl.Variable=Sm});var m3=v(dl=>{"use strict";Object.defineProperty(dl,"__esModule",{value:!0});dl.DataFactory=void 0;var hD=gm(),dD=ym(),p3=wm(),pD=ul(),mD=bm(),gD=Em(),yD=0,Tm=class{static{o(this,"DataFactory")}constructor(e){this.blankNodeCounter=0,e=e||{},this.blankNodePrefix=e.blankNodePrefix||`df_${yD++}_`}namedNode(e){return new pD.NamedNode(e)}blankNode(e){return new hD.BlankNode(e||`${this.blankNodePrefix}${this.blankNodeCounter++}`)}literal(e,t){return new p3.Literal(e,t)}variable(e){return new gD.Variable(e)}defaultGraph(){return dD.DefaultGraph.INSTANCE}quad(e,t,r,i){return new mD.Quad(e,t,r,i||this.defaultGraph())}fromTerm(e){switch(e.termType){case"NamedNode":return this.namedNode(e.value);case"BlankNode":return this.blankNode(e.value);case"Literal":return e.language?this.literal(e.value,e.language):e.datatype.equals(p3.Literal.XSD_STRING)?this.literal(e.value):this.literal(e.value,this.fromTerm(e.datatype));case"Variable":return this.variable(e.value);case"DefaultGraph":return this.defaultGraph();case"Quad":return this.quad(this.fromTerm(e.subject),this.fromTerm(e.predicate),this.fromTerm(e.object),this.fromTerm(e.graph))}}fromQuad(e){return this.fromTerm(e)}resetBlankNodeCounter(){this.blankNodeCounter=0}};dl.DataFactory=Tm});var g3=v(Fr=>{"use strict";var vD=Fr&&Fr.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),Es=Fr&&Fr.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&vD(e,n,t)};Object.defineProperty(Fr,"__esModule",{value:!0});Es(gm(),Fr);Es(m3(),Fr);Es(ym(),Fr);Es(wm(),Fr);Es(ul(),Fr);Es(bm(),Fr);Es(Em(),Fr)});var v3=v((zM,y3)=>{var{Parser:ai}=c3(),{Generator:wD}=h3(),{Wildcard:_D}=pm(),{DataFactory:bD}=g3();function SD({prefixes:n,baseIRI:e,factory:t,pathOnly:r,sparqlStar:i,skipValidation:s,skipUngroupedVariableCheck:a}={}){let c={};for(let l in n??{})c[l]=n[l];let u=new ai;return u.parse=function(){return ai.base=e||"",ai.prefixes=Object.create(c),ai.factory=t||new bD,ai.sparqlStar=!!i,ai.pathOnly=!!r,ai.skipValidation=!!s||!!a,ai.prototype.parse.apply(u,arguments)},u._resetBlanks=ai._resetBlanks,u}o(SD,"_Parser");y3.exports={Parser:SD,Generator:wD,Wildcard:_D}});var xm=v(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.CaseWhenTransformerError=ca.CaseWhenTransformer=void 0;var Am=class{static{o(this,"CaseWhenTransformer")}transform(e){let t=e,r,i=0,s=100;do if(r=t,t=this.transformSinglePass(t),i++,i>s)throw new oi("Too many nested CASE expressions (max 100 iterations)");while(t!==r);return t}transformSinglePass(e){let t=this.findCasePositions(e);if(t.length===0)return e;let r=e;for(let i=t.length-1;i>=0;i--){let s=t[i],a=this.extractCaseExpression(r,s);if(a){let c=this.convertCaseToIf(a.content);r=r.substring(0,s)+c+r.substring(s+a.length)}}return r}findCasePositions(e){let t=[],r=e.toUpperCase(),i=0;for(;i<e.length;){if(e[i]==="'"||e[i]==='"'){let s=e[i];for(i++;i<e.length&&e[i]!==s;)e[i]==="\\"&&i++,i++;i++;continue}if(r.substring(i,i+4)==="CASE"&&this.isWordBoundary(e,i,4)){t.push(i),i+=4;continue}i++}return t}extractCaseExpression(e,t){let r=1,i=t+4,s=e.toUpperCase();for(;i<e.length&&r>0;){if(e[i]==="'"||e[i]==='"'){let a=e[i];for(i++;i<e.length&&e[i]!==a;)e[i]==="\\"&&i++,i++;i++;continue}if(s.substring(i,i+4)==="CASE"&&this.isWordBoundary(e,i,4)){r++,i+=4;continue}if(s.substring(i,i+3)==="END"&&this.isWordBoundary(e,i,3)){if(r--,r===0){let a=e.substring(t,i+3);return{content:a,length:a.length}}i+=3;continue}i++}if(r>0)throw new oi(`Unclosed CASE expression at position ${t}`);return null}isWordBoundary(e,t,r){let i=t>0?e[t-1]:"",s=t===0||!/[a-zA-Z0-9_?$]/.test(i),a=t+r<e.length?e[t+r]:"",c=t+r>=e.length||!/[a-zA-Z0-9_]/.test(a);return s&&c}convertCaseToIf(e){let t=this.extractWhenClauses(e),r=this.extractElseClause(e);if(t.length===0)throw new oi("CASE expression must have at least one WHEN clause");let i=r!==null?r:'""';for(let s=t.length-1;s>=0;s--){let{condition:a,result:c}=t[s];i=`IF(${a}, ${c}, ${i})`}return i}extractWhenClauses(e){let t=[],r=e.replace(/^\s*CASE\s+/i,"").replace(/\s*END\s*$/i,""),i=this.findKeywordPositions(r,"WHEN"),s=this.findKeywordPositions(r,"ELSE"),a=s.length>0?s[0]:r.length;for(let c=0;c<i.length;c++){let u=i[c]+4,l=c+1<i.length?i[c+1]:a,f=r.substring(u,l).trim(),h=this.parseWhenClause(f);h&&t.push(h)}return t}findKeywordPositions(e,t){let r=[],i=e.toUpperCase(),s=0,a=0;for(;s<e.length;){let c=e[s];if(c==="'"||c==='"'){let u=c;for(s++;s<e.length&&e[s]!==u;)e[s]==="\\"&&s++,s++;s++;continue}if(c==="("){a++,s++;continue}if(c===")"){a--,s++;continue}if(a===0&&i.substring(s,s+t.length)===t&&this.isWordBoundary(e,s,t.length)){r.push(s),s+=t.length;continue}s++}return r}parseWhenClause(e){let t=this.findKeywordPositions(e,"THEN");if(t.length===0)throw new oi(`WHEN clause missing THEN keyword: ${e.substring(0,50)}...`);let r=t[0],i=e.substring(0,r).trim(),s=e.substring(r+4).trim();if(!i)throw new oi("WHEN clause has empty condition");if(!s)throw new oi("WHEN clause has empty result");return{condition:i,result:s}}extractElseClause(e){let t=e.replace(/^\s*CASE\s+/i,"").replace(/\s*END\s*$/i,""),r=this.findKeywordPositions(t,"ELSE");if(r.length>0){let i=r[0];return t.substring(i+4).trim()}return null}};ca.CaseWhenTransformer=Am;var oi=class extends Error{static{o(this,"CaseWhenTransformerError")}constructor(e){super(`CASE WHEN transformation error: ${e}`),this.name="CaseWhenTransformerError"}};ca.CaseWhenTransformerError=oi});var Cm=v(ua=>{"use strict";Object.defineProperty(ua,"__esModule",{value:!0});ua.LateralTransformerError=ua.LateralTransformer=void 0;var pl=class n{static{o(this,"LateralTransformer")}transform(e){let t=e,r,i=0,s=100;do if(r=t,t=this.transformSinglePass(t),i++,i>s)throw new Di("Too many nested LATERAL joins (max 100 iterations)");while(t!==r);return t}hasLateral(e){return this.findLateralPositions(e).length>0}static isLateralJoin(e){if(e.type==="group"&&e.patterns){for(let t of e.patterns)if(t.type==="query"&&t.queryType==="SELECT"&&t.variables&&Array.isArray(t.variables)){for(let r of t.variables)if(r.termType==="Variable"&&r.value===n.LATERAL_MARKER)return!0}}if(e.type==="query"&&e.queryType==="SELECT"&&e.variables&&Array.isArray(e.variables)){for(let t of e.variables)if(t.termType==="Variable"&&t.value===n.LATERAL_MARKER)return!0}return!1}transformSinglePass(e){let t=this.findLateralPositions(e);if(t.length===0)return e;let r=e;for(let i=t.length-1;i>=0;i--){let s=t[i],a=this.extractLateralExpression(r,s);if(a){let c=this.transformLateral(a.content);r=r.substring(0,s)+c+r.substring(s+a.length)}}return r}findLateralPositions(e){let t=[],r=e.toUpperCase(),i=0;for(;i<e.length;){if(e[i]==="'"||e[i]==='"'){let s=e[i];for(i++;i<e.length&&e[i]!==s;)e[i]==="\\"&&i++,i++;i++;continue}if(e[i]==="#"){for(;i<e.length&&e[i]!==`
`;)i++;continue}if(r.substring(i,i+7)==="LATERAL"&&this.isWordBoundary(e,i,7)){t.push(i),i+=7;continue}i++}return t}extractLateralExpression(e,t){let r=t+7;for(;r<e.length&&/\s/.test(e[r]);)r++;if(e[r]!=="{")throw new Di(`Expected '{' after LATERAL keyword at position ${t}`);let i=1;for(r++;r<e.length&&i>0;){if(e[r]==="'"||e[r]==='"'){let s=e[r];for(r++;r<e.length&&e[r]!==s;)e[r]==="\\"&&r++,r++;r++;continue}if(e[r]==="#"){for(;r<e.length&&e[r]!==`
`;)r++;continue}if(e[r]==="{"){i++,r++;continue}if(e[r]==="}"){if(i--,i===0){let s=e.substring(t,r+1);return{content:s,length:s.length}}r++;continue}r++}if(i>0)throw new Di(`Unclosed LATERAL block at position ${t}`);return null}transformLateral(e){let t=e.indexOf("{");if(t===-1)throw new Di("LATERAL expression missing opening brace");let r=e.substring(t+1,e.length-1).trim();if(!r.toUpperCase().trim().startsWith("SELECT"))throw new Di("LATERAL block must contain a SELECT subquery");let a=r.toUpperCase().indexOf("SELECT")+6;for(;a<r.length&&/\s/.test(r[a]);)a++;let c=r.substring(a).toUpperCase();return c.startsWith("DISTINCT")?a+=8:c.startsWith("REDUCED")&&(a+=7),`{ ${r.substring(0,a)+` ?${n.LATERAL_MARKER}`+r.substring(a)} }`}isWordBoundary(e,t,r){let i=t>0?e[t-1]:"",s=t===0||!/[a-zA-Z0-9_]/.test(i),a=t+r<e.length?e[t+r]:"",c=t+r>=e.length||!/[a-zA-Z0-9_]/.test(a);return s&&c}};ua.LateralTransformer=pl;pl.LATERAL_MARKER="__LATERAL_JOIN__";var Di=class extends Error{static{o(this,"LateralTransformerError")}constructor(e){super(`LATERAL transformation error: ${e}`),this.name="LateralTransformerError"}};ua.LateralTransformerError=Di});var w3=v(Ii=>{"use strict";Object.defineProperty(Ii,"__esModule",{value:!0});Ii.PrefixStarTransformerError=Ii.PrefixStarTransformer=Ii.WellKnownPrefixResolver=void 0;var ml=class{static{o(this,"WellKnownPrefixResolver")}constructor(){this.wellKnownPrefixes=new Map;let e=new Map;e.set("schema","http://schema.org/"),this.wellKnownPrefixes.set("http://schema.org/",e);let t=new Map;t.set("foaf","http://xmlns.com/foaf/0.1/"),this.wellKnownPrefixes.set("http://xmlns.com/foaf/0.1/",t);let r=new Map;r.set("dc","http://purl.org/dc/elements/1.1/"),r.set("dcterms","http://purl.org/dc/terms/"),this.wellKnownPrefixes.set("http://purl.org/dc/elements/1.1/",r),this.wellKnownPrefixes.set("http://purl.org/dc/terms/",r);let i=new Map;i.set("rdf","http://www.w3.org/1999/02/22-rdf-syntax-ns#"),i.set("rdfs","http://www.w3.org/2000/01/rdf-schema#"),this.wellKnownPrefixes.set("http://www.w3.org/1999/02/22-rdf-syntax-ns#",i),this.wellKnownPrefixes.set("http://www.w3.org/2000/01/rdf-schema#",i);let s=new Map;s.set("owl","http://www.w3.org/2002/07/owl#"),this.wellKnownPrefixes.set("http://www.w3.org/2002/07/owl#",s);let a=new Map;a.set("xsd","http://www.w3.org/2001/XMLSchema#"),this.wellKnownPrefixes.set("http://www.w3.org/2001/XMLSchema#",a);let c=new Map;c.set("skos","http://www.w3.org/2004/02/skos/core#"),this.wellKnownPrefixes.set("http://www.w3.org/2004/02/skos/core#",c);let u=new Map;u.set("prov","http://www.w3.org/ns/prov#"),this.wellKnownPrefixes.set("http://www.w3.org/ns/prov#",u);let l=new Map;l.set("geo","http://www.w3.org/2003/01/geo/wgs84_pos#"),this.wellKnownPrefixes.set("http://www.w3.org/2003/01/geo/wgs84_pos#",l);let f=new Map;f.set("dcat","http://www.w3.org/ns/dcat#"),this.wellKnownPrefixes.set("http://www.w3.org/ns/dcat#",f)}async resolve(e){let t=e.endsWith("#")||e.endsWith("/")?e:e+(e.includes("#")?"":"/"),r=this.wellKnownPrefixes.get(t);if(r)return r;let i=t.slice(0,-1),s=this.wellKnownPrefixes.get(i);return s||new Map}addVocabulary(e,t){this.wellKnownPrefixes.set(e,t)}};Ii.WellKnownPrefixResolver=ml;var Om=class{static{o(this,"PrefixStarTransformer")}constructor(e){this.resolver=e??new ml}async transform(e){let t=this.findPrefixStarDeclarations(e);if(t.length===0)return e;let r=[],i=[];for(let a of t)try{let c=await this.resolver.resolve(a.uri);for(let[u,l]of c)r.push(`PREFIX ${u}: <${l}>`);if(c.size===0){let u=this.extractPrefixFromUri(a.uri);u&&r.push(`PREFIX ${u}: <${a.uri}>`)}}catch(c){let u=c instanceof Error?c.message:String(c);i.push(`Failed to resolve vocabulary ${a.uri}: ${u}`)}if(r.length===0&&i.length>0)throw new la(i.join("; "));let s=e;for(let a=t.length-1;a>=0;a--){let c=t[a];s=s.substring(0,c.startPos)+s.substring(c.endPos)}return r.length>0&&(s=r.join(`
`)+`
`+s.trimStart()),s}findPrefixStarDeclarations(e){let t=[],r=e.toUpperCase(),i=0;for(;i<e.length;){if(e[i]==="'"||e[i]==='"'){let s=e[i];for(i++;i<e.length&&e[i]!==s;)e[i]==="\\"&&i++,i++;i++;continue}if(r.substring(i,i+6)==="PREFIX"){let s=i;for(i+=6;i<e.length&&/\s/.test(e[i]);)i++;if(e[i]==="*"){for(i++;i<e.length&&/\s/.test(e[i]);)i++;if(e[i]==="<"){i++;let a=i;for(;i<e.length&&e[i]!==">";)i++;if(e[i]===">"){let c=e.substring(a,i);i++;let u=this.findDeclarationEnd(e,i);t.push({uri:c,startPos:s,endPos:u}),i=u;continue}else throw new la(`Unclosed IRI in PREFIX* declaration at position ${a}`)}else throw new la(`Expected IRI after PREFIX* at position ${i}`)}else continue}i++}return t}findDeclarationEnd(e,t){let r=t;for(;r<e.length;){let i=e[r];if(i===`
`)return r+1;let s=e.substring(r).toUpperCase();if(s.startsWith("PREFIX")||s.startsWith("BASE")||s.startsWith("SELECT")||s.startsWith("CONSTRUCT")||s.startsWith("DESCRIBE")||s.startsWith("ASK"))return r;if(/\s/.test(i)){r++;continue}break}return r}extractPrefixFromUri(e){let t=e.replace(/^https?:\/\//,"");t=t.replace(/\/$/,"").replace(/#$/,"");let r=t.split(/[/.#]+/).filter(Boolean);if(r.length===0)return null;let i=r[r.length-1];return/^(ontology|vocab|schema|ns|core)$/i.test(i)&&r.length>1?r[r.length-2].toLowerCase():i.toLowerCase().replace(/[^a-z0-9]/g,"")}};Ii.PrefixStarTransformer=Om;var la=class extends Error{static{o(this,"PrefixStarTransformerError")}constructor(e){super(`PREFIX* transformation error: ${e}`),this.name="PrefixStarTransformerError"}};Ii.PrefixStarTransformerError=la});var Dm=v(ha=>{"use strict";Object.defineProperty(ha,"__esModule",{value:!0});ha.DescribeOptionsTransformer=ha.DescribeOptionsTransformerError=void 0;var gl=class extends Error{static{o(this,"DescribeOptionsTransformerError")}constructor(e){super(e),this.name="DescribeOptionsTransformerError"}};ha.DescribeOptionsTransformerError=gl;var fa=class n{static{o(this,"DescribeOptionsTransformer")}transform(e){if(!n.DESCRIBE_QUERY_PATTERN.test(e))return{query:e};let t=e,r={},i=!1,s=n.DEPTH_PATTERN.exec(e);if(s){let a=parseInt(s[1],10);if(a<0)throw new gl(`DESCRIBE DEPTH must be a non-negative integer, got: ${a}`);r.depth=a,i=!0,n.DEPTH_PATTERN.lastIndex=0,t=t.replace(n.DEPTH_PATTERN,"")}return n.DEPTH_PATTERN.lastIndex=0,n.SYMMETRIC_PATTERN.test(e)&&(r.symmetric=!0,i=!0,n.SYMMETRIC_PATTERN.lastIndex=0,t=t.replace(n.SYMMETRIC_PATTERN,"")),n.SYMMETRIC_PATTERN.lastIndex=0,t=t.replace(/\s{2,}/g," ").trim(),{query:t,options:i?r:void 0}}hasDescribeOptions(e){let t=n.DEPTH_PATTERN.test(e);n.DEPTH_PATTERN.lastIndex=0;let r=n.SYMMETRIC_PATTERN.test(e);return n.SYMMETRIC_PATTERN.lastIndex=0,t||r}};ha.DescribeOptionsTransformer=fa;fa.DEPTH_PATTERN=/\bDEPTH\s+(\d+)/gi;fa.SYMMETRIC_PATTERN=/\bSYMMETRIC\b/gi;fa.DESCRIBE_QUERY_PATTERN=/\bDESCRIBE\b/i});var _3=v(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});da.DirectionalLangTagTransformerError=da.DirectionalLangTagTransformer=void 0;var yl=class n{static{o(this,"DirectionalLangTagTransformer")}constructor(){this.directionMappings=new Map}transform(e){return this.directionMappings.clear(),e.replace(n.DIRECTIONAL_TAG_REGEX,(t,r,i,s,a)=>{let c=s.toLowerCase();return this.directionMappings.set(c,a),`${r}${i}${r}@${s}`})}getDirection(e){return this.directionMappings.get(e.toLowerCase())}getAllMappings(){return new Map(this.directionMappings)}hasDirectionalTags(e){return n.DIRECTIONAL_TAG_REGEX.lastIndex=0,n.DIRECTIONAL_TAG_REGEX.test(e)}clearMappings(){this.directionMappings.clear()}};da.DirectionalLangTagTransformer=yl;yl.DIRECTIONAL_TAG_REGEX=/(["'])((?:[^\\]|\\.)*?)\1@([a-zA-Z]+(?:-[a-zA-Z0-9]+)*)--(ltr|rtl)/g;var Im=class extends Error{static{o(this,"DirectionalLangTagTransformerError")}constructor(e){super(`Directional language tag transformation error: ${e}`),this.name="DirectionalLangTagTransformerError"}};da.DirectionalLangTagTransformerError=Im});var b3=v(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.TripleTermTransformerError=ma.TripleTermTransformer=void 0;var Pm=class{static{o(this,"TripleTermTransformer")}transform(e){let t=e,r,i=0,s=100;do if(r=t,t=this.transformSinglePass(t),i++,i>s)throw new pa("Too many nested triple terms (max 100 iterations)");while(t!==r);return t}hasTripleTermSyntax(e){return this.findTripleTermPositions(e).length>0}transformSinglePass(e){let t=this.findTripleTermPositions(e);if(t.length===0)return e;let r=e;for(let i=t.length-1;i>=0;i--){let s=t[i],a=this.extractTripleTerm(r,s);if(a){let c=this.convertToStandardSyntax(a.content);r=r.substring(0,s)+c+r.substring(s+a.length)}}return r}findTripleTermPositions(e){let t=[],r=0;for(;r<e.length;){if(e[r]==="'"){r=this.skipStringLiteral(e,r,"'");continue}if(e[r]==='"'){r=this.skipStringLiteral(e,r,'"');continue}if(e.substring(r,r+2)==="<<"&&this.isParenthesizedTripleTerm(e,r)){t.push(r),r+=2;continue}r++}return t}skipStringLiteral(e,t,r){let i=r.repeat(3);if(e.substring(t,t+3)===i){for(t+=3;t<e.length;){if(e.substring(t,t+3)===i)return t+3;e[t]==="\\"&&t++,t++}return t}for(t++;t<e.length&&e[t]!==r;)e[t]==="\\"&&t++,t++;return t+1}isParenthesizedTripleTerm(e,t){let r=t+2;for(;r<e.length&&/\s/.test(e[r]);)r++;return e[r]==="("}extractTripleTerm(e,t){let r=t+2;for(;r<e.length&&/\s/.test(e[r]);)r++;if(e[r]!=="(")return null;r++;let i=1;for(;r<e.length&&i>0;){if(e[r]==="'"||e[r]==='"'){r=this.skipStringLiteral(e,r,e[r]);continue}if(e.substring(r,r+2)==="<<"&&this.isParenthesizedTripleTerm(e,r)){for(r+=2;r<e.length&&/\s/.test(e[r]);)r++;e[r]==="("&&(i++,r++);continue}if(e.substring(r,r+2)==="<<"){r+=2;let s=1;for(;r<e.length&&s>0;){if(e[r]==="'"||e[r]==='"'){r=this.skipStringLiteral(e,r,e[r]);continue}if(e.substring(r,r+2)==="<<"){s++,r+=2;continue}if(e.substring(r,r+2)===">>"){s--,r+=2;continue}r++}continue}if(e[r]==="("){i++,r++;continue}if(e[r]===")"){let s=r+1;for(;s<e.length&&/\s/.test(e[s]);)s++;if(e.substring(s,s+2)===">>"){if(i--,i===0){let a=e.substring(t,s+2);return{content:a,length:a.length}}r=s+2;continue}r++;continue}r++}if(i>0)throw new pa(`Unclosed triple term at position ${t}: missing )>>`);return null}convertToStandardSyntax(e){let t=e.match(/^<<\s*\(\s*([\s\S]*?)\s*\)\s*>>$/);if(!t)throw new pa(`Invalid triple term syntax: ${e.substring(0,50)}...`);return`<< ${t[1]} >>`}};ma.TripleTermTransformer=Pm;var pa=class extends Error{static{o(this,"TripleTermTransformerError")}constructor(e){super(`Triple term transformation error: ${e}`),this.name="TripleTermTransformerError"}};ma.TripleTermTransformerError=pa});var T3=v(Vr=>{"use strict";var ED=Vr&&Vr.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),TD=Vr&&Vr.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),AD=Vr&&Vr.__importStar||(function(){var n=o(function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)},"ownKeys");return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&ED(t,e,r[i]);return TD(t,e),t}})();Object.defineProperty(Vr,"__esModule",{value:!0});Vr.SPARQLParser=Vr.SPARQLParseError=void 0;var S3=AD(v3()),Fm=xm(),Rm=Cm(),E3=w3(),Nm=Dm(),xD=_3(),km=b3(),bt=class extends Error{static{o(this,"SPARQLParseError")}constructor(e,t,r,i){super(e,i?{cause:i}:void 0),this.name="SPARQLParseError",this.line=t,this.column=r}};Vr.SPARQLParseError=bt;var Lm=class{static{o(this,"SPARQLParser")}constructor(e){this.lastDirectionMappings=new Map,this.parser=new S3.Parser({sparqlStar:!0}),this.generator=new S3.Generator({sparqlStar:!0}),this.caseWhenTransformer=new Fm.CaseWhenTransformer,this.lateralTransformer=new Rm.LateralTransformer,this.prefixStarTransformer=new E3.PrefixStarTransformer(e?.vocabularyResolver),this.describeOptionsTransformer=new Nm.DescribeOptionsTransformer,this.directionalLangTagTransformer=new xD.DirectionalLangTagTransformer,this.tripleTermTransformer=new km.TripleTermTransformer}parse(e){try{let t=this.describeOptionsTransformer.transform(e);this.lastDescribeOptions=t.options;let r=t.query;r=this.directionalLangTagTransformer.transform(r),this.lastDirectionMappings=this.directionalLangTagTransformer.getAllMappings(),r=this.lateralTransformer.transform(r),r=this.caseWhenTransformer.transform(r),r=this.tripleTermTransformer.transform(r);let i=this.parser.parse(r);return this.validateQuery(i),this.lastDescribeOptions&&this.isDescribeQuery(i)&&(i.describeOptions=this.lastDescribeOptions),i}catch(t){if(t instanceof Nm.DescribeOptionsTransformerError)throw new bt(t.message);if(t instanceof Rm.LateralTransformerError)throw new bt(t.message);if(t instanceof Fm.CaseWhenTransformerError)throw new bt(t.message);if(t instanceof km.TripleTermTransformerError)throw new bt(t.message);if(t instanceof Error){let r=t.message.match(/line (\d+), column (\d+)/),i=r?parseInt(r[1],10):void 0,s=r?parseInt(r[2],10):void 0;throw new bt(`SPARQL syntax error: ${t.message}`,i,s,t)}throw t}}parseWithOptions(e){return{query:this.parse(e),describeOptions:this.lastDescribeOptions}}getLastDescribeOptions(){return this.lastDescribeOptions}async parseAsync(e){try{let t=this.describeOptionsTransformer.transform(e);this.lastDescribeOptions=t.options;let r=t.query;r=this.directionalLangTagTransformer.transform(r),this.lastDirectionMappings=this.directionalLangTagTransformer.getAllMappings(),r=await this.prefixStarTransformer.transform(r),r=this.lateralTransformer.transform(r),r=this.caseWhenTransformer.transform(r),r=this.tripleTermTransformer.transform(r);let i=this.parser.parse(r);return this.validateQuery(i),this.lastDescribeOptions&&this.isDescribeQuery(i)&&(i.describeOptions=this.lastDescribeOptions),i}catch(t){if(t instanceof Nm.DescribeOptionsTransformerError)throw new bt(t.message);if(t instanceof E3.PrefixStarTransformerError)throw new bt(t.message);if(t instanceof Rm.LateralTransformerError)throw new bt(t.message);if(t instanceof Fm.CaseWhenTransformerError)throw new bt(t.message);if(t instanceof km.TripleTermTransformerError)throw new bt(t.message);if(t instanceof Error){let r=t.message.match(/line (\d+), column (\d+)/),i=r?parseInt(r[1],10):void 0,s=r?parseInt(r[2],10):void 0;throw new bt(`SPARQL syntax error: ${t.message}`,i,s,t)}throw t}}async parseAsyncWithOptions(e){return{query:await this.parseAsync(e),describeOptions:this.lastDescribeOptions}}hasPrefixStar(e){return/PREFIX\s*\*/i.test(e)}hasLateral(e){return this.lateralTransformer.hasLateral(e)}hasDescribeOptions(e){return this.describeOptionsTransformer.hasDescribeOptions(e)}hasDirectionalLangTags(e){return this.directionalLangTagTransformer.hasDirectionalTags(e)}hasTripleTermSyntax(e){return this.tripleTermTransformer.hasTripleTermSyntax(e)}getLastDirectionMappings(){return new Map(this.lastDirectionMappings)}getDirectionForLanguage(e){return this.lastDirectionMappings.get(e.toLowerCase())}toString(e){try{return this.generator.stringify(e)}catch(t){throw t instanceof Error?new bt(`Failed to serialize SPARQL query: ${t.message}`,void 0,void 0,t):t}}getQueryType(e){if("queryType"in e&&e.type==="query")return e.queryType;throw new bt("Query does not have a valid queryType property")}isSelectQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="SELECT"}isConstructQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="CONSTRUCT"}isAskQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="ASK"}isDescribeQuery(e){return"queryType"in e&&e.type==="query"&&e.queryType==="DESCRIBE"}isUpdateQuery(e){return e.type==="update"}isInsertDataOperation(e){return"updateType"in e&&e.updateType==="insert"}isDeleteDataOperation(e){return"updateType"in e&&e.updateType==="delete"}validateQuery(e){if(!e||typeof e!="object")throw new bt("Invalid query: not an object");if(e.type!=="query"&&e.type!=="update")throw new bt(`Invalid type: expected "query" or "update", got "${e.type}"`);if(e.type==="query"){let t=["SELECT","CONSTRUCT","ASK","DESCRIBE"];if(!t.includes(e.queryType))throw new bt(`Invalid query type: expected one of ${t.join(", ")}, got "${e.queryType}"`)}}};Vr.SPARQLParser=Lm});var x3=v(ga=>{"use strict";Object.defineProperty(ga,"__esModule",{value:!0});ga.AlgebraTranslator=ga.AlgebraTranslatorError=void 0;var A3=Cm(),fe=class extends Error{static{o(this,"AlgebraTranslatorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="AlgebraTranslatorError"}};ga.AlgebraTranslatorError=fe;var jm=class{static{o(this,"AlgebraTranslator")}constructor(){this.directionMappings=new Map,this.aggregateCounter=0}setDirectionMappings(e){this.directionMappings=e}translate(e){if(e.type!=="query")throw new fe("Only query operations are supported (not updates)");if(e.queryType==="SELECT")return this.translateSelect(e);if(e.queryType==="CONSTRUCT")return this.translateConstruct(e);if(e.queryType==="ASK")return this.translateAsk(e);if(e.queryType==="DESCRIBE")return this.translateDescribe(e);throw new fe(`Query type ${e.queryType} not yet supported`)}translateSelect(e){let t;if(!e.where||e.where.length===0)throw new fe("SELECT query must have WHERE clause");t=this.translateWhere(e.where),this.aggregateCounter=0;let r=new Map,i=this.extractAggregatesWithMapping(e.variables,r),s=this.extractGroupVariables(e.group);if((i.length>0||s.length>0)&&(t={type:"group",variables:s,aggregates:i,input:t}),e.variables&&e.variables.length>0){for(let c of e.variables){let u=c;if(u.expression&&u.variable){if(u.expression.type==="aggregate")continue;let l=this.transformExpressionWithAggregateVars(u.expression,r);t={type:"extend",variable:u.variable.value,expression:l,input:t}}}let a=e.variables.filter(c=>c.termType==="Variable"||c.variable).map(c=>c.termType==="Variable"?c.value:c.variable.value);a.length>0&&(t={type:"project",variables:a,input:t})}return e.distinct&&(t={type:"distinct",input:t}),e.reduced&&(t={type:"reduced",input:t}),e.order&&e.order.length>0&&(t={type:"orderby",comparators:e.order.map(a=>this.translateOrderComparator(a)),input:t}),(e.limit!==void 0||e.offset!==void 0)&&(t={type:"slice",limit:e.limit,offset:e.offset,input:t}),t}translateConstruct(e){let t=this.translateConstructTemplate(e.template??[]);if(!e.where||e.where.length===0)throw new fe("CONSTRUCT query must have WHERE clause");let r=this.translateWhere(e.where);return{type:"construct",template:t,where:r}}translateConstructTemplate(e){return!e||!Array.isArray(e)?[]:e.map(t=>this.translateTriple(t))}translateAsk(e){return{type:"ask",where:e.where&&e.where.length>0?this.translateWhere(e.where):{type:"bgp",triples:[]}}}extractAggregatesWithMapping(e,t){if(!e)return[];let r=[];for(let i of e)!i.expression||!i.variable||(i.expression.type==="aggregate"?(r.push({variable:i.variable.value,expression:this.translateAggregateExpression(i.expression)}),t.set(i.expression,i.variable.value)):this.collectNestedAggregates(i.expression,r,t));return r}collectNestedAggregates(e,t,r){if(e){if(e.type==="aggregate"){let i=`__agg${this.aggregateCounter++}`;t.push({variable:i,expression:this.translateAggregateExpression(e)}),r.set(e,i)}else if(e.type==="operation"&&e.args)for(let i of e.args)this.collectNestedAggregates(i,t,r)}}transformExpressionWithAggregateVars(e,t){if(t.has(e))return{type:"variable",name:t.get(e)};if(e.type==="operation"&&e.args){let r=e.args.map(c=>this.transformExpressionWithAggregateVars(c,t)),i=["=","!=","<",">","<=",">="],s=["&&","||","!"],a=["+","-","*","/"];return i.includes(e.operator)?{type:"comparison",operator:e.operator,left:r[0],right:r[1]}:s.includes(e.operator)?{type:"logical",operator:e.operator,operands:r}:a.includes(e.operator)?{type:"arithmetic",operator:e.operator,left:r[0],right:r[1]}:{type:"function",function:e.operator,args:r}}return this.translateExpression(e)}extractGroupVariables(e){return e?e.filter(t=>t.expression&&t.expression.termType==="Variable").map(t=>t.expression.value):[]}translateAggregateExpression(e){let t=e.aggregation;if(typeof t=="string"){let r=t.toLowerCase();return["count","sum","avg","min","max","group_concat","sample"].includes(r)?{type:"aggregate",aggregation:r,expression:e.expression?this.translateExpression(e.expression):void 0,distinct:e.distinct||!1,separator:e.separator}:{type:"aggregate",aggregation:{type:"custom",iri:t},expression:e.expression?this.translateExpression(e.expression):void 0,distinct:e.distinct||!1,separator:e.separator}}if(t&&typeof t=="object"){let r;if(t.termType==="NamedNode"&&t.value)r=t.value;else if("value"in t)r=String(t.value);else throw new fe(`Invalid custom aggregate: expected IRI but got ${JSON.stringify(t)}`);return{type:"aggregate",aggregation:{type:"custom",iri:r},expression:e.expression?this.translateExpression(e.expression):void 0,distinct:e.distinct||!1,separator:e.separator}}throw new fe(`Unknown aggregate format: ${JSON.stringify(t)}`)}isLateralPattern(e){if(e.type==="query"&&this.isLateralSubquery(e))return!0;if(e.type==="group"&&e.patterns?.length===1){let t=e.patterns[0];if(t.type==="query"&&this.isLateralSubquery(t))return!0}return!1}extractLateralSubquery(e){if(e.type==="query")return e;if(e.type==="group"&&e.patterns?.length===1)return e.patterns[0];throw new fe("Invalid lateral pattern structure")}translateWhere(e){if(e.length===0)throw new fe("Empty WHERE clause");let t=e.filter(a=>a.type==="filter"),r=e.filter(a=>a.type==="bind"),i=e.filter(a=>a.type!=="filter"&&a.type!=="bind"),s;if(i.length===0)s={type:"bgp",triples:[]};else if(i.length===1)s=this.translatePattern(i[0]);else{s=this.translatePattern(i[0]);for(let a=1;a<i.length;a++){let c=i[a];if(this.isLateralPattern(c)){let u=this.extractLateralSubquery(c),l=this.removeLateralMarker(u),f=this.translateSelect(l);s={type:"lateraljoin",left:s,right:f}}else{let u=this.translatePattern(c);s={type:"join",left:s,right:u}}}}for(let a of r)s=this.translateBind(a,s);for(let a of t)s={type:"filter",expression:this.translateExpression(a.expression),input:s};return s}translatePattern(e){if(!e||!e.type)throw new fe("Invalid pattern: missing type");switch(e.type){case"bgp":return this.translateBGP(e);case"filter":return this.translateFilter(e);case"optional":return this.translateOptional(e);case"union":return this.translateUnion(e);case"minus":return this.translateMinus(e);case"values":return this.translateValues(e);case"group":return this.translateWhere(e.patterns);case"query":return this.translateSubquery(e);case"service":return this.translateService(e);case"graph":return this.translateGraph(e);default:throw new fe(`Unsupported pattern type: ${e.type}`)}}translateBGP(e){if(!e.triples||!Array.isArray(e.triples))throw new fe("BGP pattern must have triples array");return{type:"bgp",triples:e.triples.map(t=>this.translateTriple(t))}}translateTriple(e){if(!e.subject||!e.predicate||!e.object)throw new fe("Triple must have subject, predicate, and object");return{subject:this.translateTripleElement(e.subject),predicate:this.translatePredicate(e.predicate),object:this.translateTripleElement(e.object)}}translatePredicate(e){return e.type==="path"?this.translatePropertyPath(e):this.translateTripleElement(e)}translatePropertyPath(e){if(!e.pathType)throw new fe("Property path must have pathType");if(!e.items||!Array.isArray(e.items))throw new fe("Property path must have items array");let t=e.items.map(r=>this.translatePathItem(r));switch(e.pathType){case"/":return{type:"path",pathType:"/",items:t};case"|":return{type:"path",pathType:"|",items:t};case"^":if(t.length!==1)throw new fe("Inverse path must have exactly one item");return{type:"path",pathType:"^",items:[t[0]]};case"+":if(t.length!==1)throw new fe("OneOrMore path must have exactly one item");return{type:"path",pathType:"+",items:[t[0]]};case"*":if(t.length!==1)throw new fe("ZeroOrMore path must have exactly one item");return{type:"path",pathType:"*",items:[t[0]]};case"?":if(t.length!==1)throw new fe("ZeroOrOne path must have exactly one item");return{type:"path",pathType:"?",items:[t[0]]};default:throw new fe(`Unsupported property path type: ${e.pathType}`)}}translatePathItem(e){if(e.type==="path")return this.translatePropertyPath(e);if(e.termType==="NamedNode")return{type:"iri",value:e.value};throw new fe(`Unsupported path item type: ${e.type||e.termType}`)}translateTripleElement(e){if(!e||!e.termType)throw new fe("Triple element must have termType");switch(e.termType){case"Variable":return{type:"variable",value:e.value};case"NamedNode":return{type:"iri",value:e.value};case"Literal":{let t={type:"literal",value:e.value,datatype:e.datatype?.value,language:e.language};if(e.language){let r=this.directionMappings.get(e.language.toLowerCase());r&&(t.direction=r)}return t}case"BlankNode":return{type:"blank",value:e.value};case"Quad":return this.translateQuotedTriple(e);default:throw new fe(`Unsupported term type: ${e.termType}`)}}translateQuotedTriple(e){if(!e.subject||!e.predicate||!e.object)throw new fe("Quoted triple must have subject, predicate, and object");let t=this.translateTripleElement(e.subject),r=this.translateQuotedTriplePredicate(e.predicate),i=this.translateTripleElement(e.object);return{type:"quoted",subject:t,predicate:r,object:i}}translateQuotedTriplePredicate(e){if(!e||!e.termType)throw new fe("Quoted triple predicate must have termType");switch(e.termType){case"Variable":return{type:"variable",value:e.value};case"NamedNode":return{type:"iri",value:e.value};default:throw new fe(`Quoted triple predicate must be IRI or Variable, got: ${e.termType}`)}}translateFilter(e){if(!e.expression)throw new fe("Filter pattern must have expression");let t=e.patterns?this.translateWhere(e.patterns):{type:"bgp",triples:[]};return{type:"filter",expression:this.translateExpression(e.expression),input:t}}translateExpression(e){if(!e)throw new fe("Expression cannot be null or undefined");if(e.type==="operation")return this.translateOperationExpression(e);if(e.type==="functioncall"||e.type==="functionCall")return{type:"functionCall",function:e.function,args:e.args.map(t=>this.translateExpression(t))};if(e.termType)return this.translateTermExpression(e);throw new fe(`Unsupported expression structure: ${JSON.stringify(e)}`)}translateOperationExpression(e){let t=["=","!=","<",">","<=",">="],r=["&&","||","!"],i=["+","-","*","/"];return t.includes(e.operator)?{type:"comparison",operator:e.operator,left:this.translateExpression(e.args[0]),right:this.translateExpression(e.args[1])}:r.includes(e.operator)?{type:"logical",operator:e.operator,operands:e.args.map(s=>this.translateExpression(s))}:i.includes(e.operator)?{type:"arithmetic",operator:e.operator,left:this.translateExpression(e.args[0]),right:this.translateExpression(e.args[1])}:e.operator==="exists"||e.operator==="notexists"?this.translateExistsExpression(e):e.operator==="in"||e.operator==="notin"?this.translateInExpression(e):{type:"function",function:e.operator,args:e.args.map(s=>this.translateExpression(s))}}translateExistsExpression(e){if(!e.args||e.args.length!==1)throw new fe("EXISTS/NOT EXISTS must have exactly one pattern argument");let t=e.args[0],r;return t.type==="group"&&t.patterns?r=this.translateWhere(t.patterns):t.type==="bgp"?r=this.translateBGP(t):r=this.translatePattern(t),{type:"exists",negated:e.operator==="notexists",pattern:r}}translateInExpression(e){if(!e.args||e.args.length!==2)throw new fe("IN/NOT IN must have exactly 2 arguments (expression and list)");let t=e.args[0],r=e.args[1];if(!Array.isArray(r))throw new fe("IN/NOT IN second argument must be an array of values");return{type:"in",expression:this.translateExpression(t),list:r.map(i=>this.translateExpression(i)),negated:e.operator==="notin"}}translateTermExpression(e){if(e.termType==="Variable")return{type:"variable",name:e.value};if(e.termType==="Literal"){let t=e.value;return e.datatype&&(e.datatype.value.includes("#integer")||e.datatype.value.includes("#decimal")?t=parseFloat(e.value):e.datatype.value.includes("#boolean")&&(t=e.value==="true")),{type:"literal",value:t,datatype:e.datatype?.value}}return{type:"literal",value:String(e.value||e)}}translateOptional(e){if(!e.patterns||e.patterns.length===0)throw new fe("OPTIONAL pattern must have patterns");return{type:"leftjoin",left:{type:"bgp",triples:[]},right:this.translateWhere(e.patterns),expression:e.expression?this.translateExpression(e.expression):void 0}}translateUnion(e){if(!e.patterns||e.patterns.length<2)throw new fe("UNION pattern must have at least 2 patterns");let t=o(i=>i.type==="graph"?this.translateGraph(i):i.type==="service"?this.translateService(i):i.patterns&&Array.isArray(i.patterns)?this.translateWhere(i.patterns):this.translateWhere([i]),"translateBranch"),r={type:"union",left:t(e.patterns[0]),right:t(e.patterns[1])};for(let i=2;i<e.patterns.length;i++)r={type:"union",left:r,right:t(e.patterns[i])};return r}translateMinus(e){if(!e.patterns||e.patterns.length===0)throw new fe("MINUS pattern must have patterns");return{type:"minus",left:{type:"bgp",triples:[]},right:this.translateWhere(e.patterns)}}translateValues(e){if(!e.values||!Array.isArray(e.values))throw new fe("VALUES pattern must have values array");let t=new Set;for(let i of e.values)for(let s of Object.keys(i)){let a=s.startsWith("?")?s.slice(1):s;t.add(a)}let r=e.values.map(i=>this.translateValuesBinding(i));return{type:"values",variables:Array.from(t),bindings:r}}translateValuesBinding(e){let t={};for(let[r,i]of Object.entries(e)){let s=r.startsWith("?")?r.slice(1):r,a=i;if(a)if(a.termType==="NamedNode")t[s]={type:"iri",value:a.value};else if(a.termType==="Literal"){let c={type:"literal",value:a.value,datatype:a.datatype?.value,language:a.language||void 0};if(a.language){let u=this.directionMappings.get(a.language.toLowerCase());u&&(c.direction=u)}t[s]=c}else throw new fe(`Unsupported VALUES term type: ${a.termType}`)}return t}translateBind(e,t){if(!e.variable||!e.expression)throw new fe("BIND pattern must have variable and expression");return{type:"extend",variable:e.variable.value,expression:this.translateExpression(e.expression),input:t}}translateOrderComparator(e){return{expression:this.translateExpression(e.expression),descending:e.descending||!1}}isLateralSubquery(e){return e.queryType!=="SELECT"||!e.variables?!1:e.variables.some(t=>t.termType==="Variable"&&t.value===A3.LateralTransformer.LATERAL_MARKER)}removeLateralMarker(e){return e.variables?{...e,variables:e.variables.filter(t=>!(t.termType==="Variable"&&t.value===A3.LateralTransformer.LATERAL_MARKER))}:e}translateSubquery(e){if(e.queryType!=="SELECT")throw new fe(`Only SELECT subqueries are supported, got: ${e.queryType}`);let t=this.removeLateralMarker(e);return{type:"subquery",query:this.translateSelect(t)}}translateService(e){if(!e.name||e.name.termType!=="NamedNode")throw new fe("SERVICE pattern must have a NamedNode endpoint");if(!e.patterns||!Array.isArray(e.patterns))throw new fe("SERVICE pattern must have patterns array");let t=this.translateWhere(e.patterns);return{type:"service",endpoint:e.name.value,pattern:t,silent:e.silent||!1}}translateGraph(e){if(!e.name)throw new fe("GRAPH pattern must have a name (IRI or variable)");if(!e.patterns||!Array.isArray(e.patterns))throw new fe("GRAPH pattern must have patterns array");let t;if(e.name.termType==="NamedNode")t={type:"iri",value:e.name.value};else if(e.name.termType==="Variable")t={type:"variable",value:e.name.value};else throw new fe(`GRAPH pattern name must be NamedNode or Variable, got: ${e.name.termType}`);let r=this.translateWhere(e.patterns);return{type:"graph",name:t,pattern:r}}translateDescribe(e){let t=[];if(e.variables&&Array.isArray(e.variables))for(let s of e.variables){let a=s;a.termType==="Wildcard"||a.value==="*"||(a.termType==="Variable"?t.push({type:"variable",value:a.value}):a.termType==="NamedNode"&&t.push({type:"iri",value:a.value}))}let r;e.where&&e.where.length>0&&(r=this.translateWhere(e.where));let i=e.describeOptions;return{type:"describe",resources:t,where:r,depth:i?.depth,symmetric:i?.symmetric}}};ga.AlgebraTranslator=jm});var Vm=v(vl=>{"use strict";Object.defineProperty(vl,"__esModule",{value:!0});vl.FilterContainsOptimizer=void 0;var CD=Xe(),OD=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i,Mm=class{static{o(this,"FilterContainsOptimizer")}constructor(){this.tripleStore=null,this.lastOptimizationHints=[]}setTripleStore(e){this.tripleStore=e}getLastOptimizationHints(){return this.lastOptimizationHints}clearHints(){this.lastOptimizationHints=[]}async optimize(e){return this.clearHints(),this.optimizeRecursive(e)}optimizeSync(e,t){return this.clearHints(),this.optimizeSyncRecursive(e,t)}async optimizeRecursive(e){return e.type==="filter"?this.optimizeFilter(e):e.type==="join"?{type:"join",left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="leftjoin"?{...e,left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="union"?{type:"union",left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="minus"?{...e,left:await this.optimizeRecursive(e.left),right:await this.optimizeRecursive(e.right)}:e.type==="project"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="orderby"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="slice"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="distinct"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="reduced"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="group"?{...e,input:await this.optimizeRecursive(e.input)}:e.type==="extend"?{...e,input:await this.optimizeRecursive(e.input)}:e}optimizeSyncRecursive(e,t){return e.type==="filter"?this.optimizeFilterSync(e,t):e.type==="join"?{type:"join",left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="leftjoin"?{...e,left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="union"?{type:"union",left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="minus"?{...e,left:this.optimizeSyncRecursive(e.left,t),right:this.optimizeSyncRecursive(e.right,t)}:e.type==="project"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="orderby"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="slice"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="distinct"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="reduced"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="group"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e.type==="extend"?{...e,input:this.optimizeSyncRecursive(e.input,t)}:e}async optimizeFilter(e){let t=this.detectContainsUUIDPattern(e.expression);if(!t)return{type:"filter",expression:e.expression,input:await this.optimizeRecursive(e.input)};let r=[];return this.tripleStore&&(r=await this.findSubjectsContainingUUID(t.uuid)),this.rewriteFilter(e,t,r)}optimizeFilterSync(e,t){let r=this.detectContainsUUIDPattern(e.expression);if(!r)return{type:"filter",expression:e.expression,input:this.optimizeSyncRecursive(e.input,t)};let i=t?t.filter(s=>s.includes(r.uuid)):[];return this.rewriteFilter(e,r,i)}rewriteFilter(e,t,r){if(this.lastOptimizationHints.push({type:"uuid-index-lookup",originalPattern:`FILTER(CONTAINS(STR(?${t.variable}), "${t.uuid}"))`,suggestedRewrite:r.length===1?`VALUES ?${t.variable} { <${r[0]}> }`:r.length>1?`VALUES ?${t.variable} { ${r.map(i=>`<${i}>`).join(" ")} }`:"No matching URIs found for UUID",estimatedSpeedup:r.length>0?"O(n) \u2192 O(1)":"N/A",matchedUri:r.length===1?r[0]:void 0}),r.length===0)return{type:"filter",expression:e.expression,input:this.optimizeSyncRecursive(e.input)};if(r.length===1){let i=this.injectSubjectConstraint(e.input,t.variable,r[0]);if(i!==e.input)return i}return this.createValuesJoin(e,t,r)}detectContainsUUIDPattern(e){if(e.type==="function"||e.type==="functionCall"){let t=e;if((typeof t.function=="string"?t.function.toLowerCase():t.function?.value?.toLowerCase()??"")==="contains"&&t.args.length===2)return this.analyzeContainsArgs(t.args[0],t.args[1],e)}if(e.type==="logical"&&e.operator==="&&")for(let t of e.operands){let r=this.detectContainsUUIDPattern(t);if(r)return r}return null}analyzeContainsArgs(e,t,r){let i=null;if(e.type==="function"||e.type==="functionCall"){let s=e;if((typeof s.function=="string"?s.function.toLowerCase():s.function?.value?.toLowerCase()??"")==="str"&&s.args.length===1){let c=s.args[0];c.type==="variable"&&(i=c.name)}}if(!i&&e.type==="variable"&&(i=e.name),!i)return null;if(t.type==="literal"){let c=String(t.value).match(OD);if(c)return{variable:i,uuid:c[0].toLowerCase(),originalExpression:r}}return null}async findSubjectsContainingUUID(e){if(!this.tripleStore)return[];if(this.tripleStore.findSubjectsByUUID)return(await this.tripleStore.findSubjectsByUUID(e)).map(s=>s.value);let t=await this.tripleStore.subjects(),r=[];for(let i of t)i instanceof CD.IRI&&i.value.toLowerCase().includes(e.toLowerCase())&&r.push(i.value);return r}injectSubjectConstraint(e,t,r){if(e.type==="bgp"){let i=e.triples.map(a=>a.subject.type==="variable"&&a.subject.value===t?{...a,subject:{type:"iri",value:r}}:a);if(i.some((a,c)=>a.subject!==e.triples[c].subject))return{type:"bgp",triples:i}}if(e.type==="join"){let i=this.injectSubjectConstraint(e.left,t,r),s=this.injectSubjectConstraint(e.right,t,r);if(i!==e.left||s!==e.right)return{type:"join",left:i,right:s}}if(e.type==="filter"){let i=this.injectSubjectConstraint(e.input,t,r);if(i!==e.input)return{...e,input:i}}return e}createValuesJoin(e,t,r){return{type:"join",left:{type:"values",variables:[t.variable],bindings:r.map(a=>({[t.variable]:{type:"iri",value:a}}))},right:this.optimizeSyncRecursive(e.input)}}analyzeQuery(e){let t=[];return this.analyzeRecursive(e,t),t}analyzeRecursive(e,t){if(e.type==="filter"){let r=this.detectContainsUUIDPattern(e.expression);r&&t.push({type:"uuid-index-lookup",originalPattern:`FILTER(CONTAINS(STR(?${r.variable}), "${r.uuid}"))`,suggestedRewrite:`Use --optimize flag or rewrite as VALUES ?${r.variable} { <uri-containing-uuid> }`,estimatedSpeedup:"O(n) \u2192 O(1) with UUID index lookup"}),this.analyzeRecursive(e.input,t);return}e.type==="join"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="leftjoin"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="union"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="minus"?(this.analyzeRecursive(e.left,t),this.analyzeRecursive(e.right,t)):e.type==="project"?this.analyzeRecursive(e.input,t):e.type==="orderby"?this.analyzeRecursive(e.input,t):e.type==="slice"?this.analyzeRecursive(e.input,t):e.type==="distinct"?this.analyzeRecursive(e.input,t):e.type==="reduced"?this.analyzeRecursive(e.input,t):e.type==="group"?this.analyzeRecursive(e.input,t):e.type==="extend"&&this.analyzeRecursive(e.input,t)}};vl.FilterContainsOptimizer=Mm});var C3=v(wl=>{"use strict";Object.defineProperty(wl,"__esModule",{value:!0});wl.AlgebraOptimizer=void 0;var DD=Vm(),$m=class{static{o(this,"AlgebraOptimizer")}constructor(){this.stats=new Map,this.tripleStore=null,this.filterContainsOptimizer=new DD.FilterContainsOptimizer}setTripleStore(e){this.tripleStore=e,this.filterContainsOptimizer.setTripleStore(e)}getOptimizationHints(){return this.filterContainsOptimizer.getLastOptimizationHints()}analyzeQuery(e){return this.filterContainsOptimizer.analyzeQuery(e)}optimize(e){let t=e;return t=this.eliminateEmptyBGPInFilterJoin(t),t=this.filterPushDown(t),t=this.joinReordering(t),t}async optimizeAsync(e){let t=e;return t=this.eliminateEmptyBGPInFilterJoin(t),this.tripleStore&&(t=await this.filterContainsOptimizer.optimize(t)),t=this.filterPushDown(t),t=this.joinReordering(t),t}optimizeWithSubjects(e,t){let r=e;return r=this.eliminateEmptyBGPInFilterJoin(r),r=this.filterContainsOptimizer.optimizeSync(r,t),r=this.filterPushDown(r),r=this.joinReordering(r),r}eliminateEmptyBGPInFilterJoin(e){if(e.type==="join"){if(e.left.type==="filter"){let t=e.left;if(t.input.type==="bgp"&&t.input.triples.length===0)return{type:"filter",expression:t.expression,input:this.eliminateEmptyBGPInFilterJoin(e.right)}}if(e.right.type==="filter"){let t=e.right;if(t.input.type==="bgp"&&t.input.triples.length===0)return{type:"filter",expression:t.expression,input:this.eliminateEmptyBGPInFilterJoin(e.left)}}return{type:"join",left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}}return e.type==="filter"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="leftjoin"?{...e,left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}:e.type==="union"?{...e,left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}:e.type==="minus"?{...e,left:this.eliminateEmptyBGPInFilterJoin(e.left),right:this.eliminateEmptyBGPInFilterJoin(e.right)}:e.type==="project"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="orderby"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="slice"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e.type==="distinct"?{...e,input:this.eliminateEmptyBGPInFilterJoin(e.input)}:e}filterPushDown(e){return e.type==="filter"?this.pushDownFilter(e):e.type==="join"?{type:"join",left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="leftjoin"?{...e,left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="union"?{type:"union",left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="minus"?{...e,left:this.filterPushDown(e.left),right:this.filterPushDown(e.right)}:e.type==="project"?{...e,input:this.filterPushDown(e.input)}:e.type==="orderby"?{...e,input:this.filterPushDown(e.input)}:e.type==="slice"?{...e,input:this.filterPushDown(e.input)}:e.type==="distinct"?{...e,input:this.filterPushDown(e.input)}:e}pushDownFilter(e){let t=e.input;if(t.type==="join"){let r=this.getFilterVariables(e.expression),i=this.getOperationVariables(t.left),s=this.getOperationVariables(t.right),a=r.every(u=>i.has(u)),c=r.every(u=>s.has(u));return a&&!c?{type:"join",left:{type:"filter",expression:e.expression,input:this.filterPushDown(t.left)},right:this.filterPushDown(t.right)}:c&&!a?{type:"join",left:this.filterPushDown(t.left),right:{type:"filter",expression:e.expression,input:this.filterPushDown(t.right)}}:{type:"filter",expression:e.expression,input:{type:"join",left:this.filterPushDown(t.left),right:this.filterPushDown(t.right)}}}return t.type==="union"?{type:"union",left:{type:"filter",expression:e.expression,input:this.filterPushDown(t.left)},right:{type:"filter",expression:e.expression,input:this.filterPushDown(t.right)}}:{type:"filter",expression:e.expression,input:this.filterPushDown(t)}}getFilterVariables(e){let t=[];if(e.type==="variable")t.push(e.name);else if(e.type==="comparison")t.push(...this.getFilterVariables(e.left)),t.push(...this.getFilterVariables(e.right));else if(e.type==="logical")for(let r of e.operands)t.push(...this.getFilterVariables(r));else if(e.type==="function")for(let r of e.args)t.push(...this.getFilterVariables(r));return Array.from(new Set(t))}getOperationVariables(e){let t=new Set;if(e.type==="bgp")for(let r of e.triples)r.subject.type==="variable"&&t.add(r.subject.value),r.predicate.type==="variable"&&t.add(r.predicate.value),r.object.type==="variable"&&t.add(r.object.value);else if(e.type==="join"){let r=this.getOperationVariables(e.left),i=this.getOperationVariables(e.right);return new Set([...r,...i])}else{if(e.type==="filter")return this.getOperationVariables(e.input);if(e.type==="leftjoin"){let r=this.getOperationVariables(e.left),i=this.getOperationVariables(e.right);return new Set([...r,...i])}else if(e.type==="union"){let r=this.getOperationVariables(e.left),i=this.getOperationVariables(e.right);return new Set([...r,...i])}else{if(e.type==="minus")return this.getOperationVariables(e.left);if(e.type==="project")return new Set(e.variables)}}return t}joinReordering(e){return e.type==="join"?this.reorderJoin(e):e.type==="filter"?{...e,input:this.joinReordering(e.input)}:e.type==="leftjoin"?{...e,left:this.joinReordering(e.left),right:this.joinReordering(e.right)}:e.type==="union"?{...e,left:this.joinReordering(e.left),right:this.joinReordering(e.right)}:e.type==="minus"?{...e,left:this.joinReordering(e.left),right:this.joinReordering(e.right)}:e.type==="project"?{...e,input:this.joinReordering(e.input)}:e.type==="orderby"?{...e,input:this.joinReordering(e.input)}:e.type==="slice"?{...e,input:this.joinReordering(e.input)}:e.type==="distinct"?{...e,input:this.joinReordering(e.input)}:e}reorderJoin(e){let t=this.estimateCost(e.left);return this.estimateCost(e.right)<t?{type:"join",left:this.joinReordering(e.right),right:this.joinReordering(e.left)}:{type:"join",left:this.joinReordering(e.left),right:this.joinReordering(e.right)}}estimateCost(e){if(e.type==="bgp"){let t=e.triples.length*100;for(let r of e.triples)r.subject.type==="variable"&&(t+=10),r.predicate.type==="variable"&&(t+=20),r.object.type==="variable"&&(t+=10);return t}return e.type==="filter"?this.estimateCost(e.input)*.3:e.type==="join"?this.estimateCost(e.left)*this.estimateCost(e.right):e.type==="leftjoin"?this.estimateCost(e.left)+this.estimateCost(e.right)*.5:e.type==="union"?this.estimateCost(e.left)+this.estimateCost(e.right):e.type==="minus"?this.estimateCost(e.left)+this.estimateCost(e.right)*.3:100}setStatistics(e,t){this.stats.set(e,t)}getStatistics(e){return this.stats.get(e)}};wl.AlgebraOptimizer=$m});var O3=v(_l=>{"use strict";Object.defineProperty(_l,"__esModule",{value:!0});_l.AlgebraSerializer=void 0;var Bm=class{static{o(this,"AlgebraSerializer")}toString(e,t=0){let r="  ".repeat(t);switch(e.type){case"bgp":return`${r}BGP [
${e.triples.map(l=>`${r}  ${this.tripleToString(l)}`).join(`
`)}
${r}]`;case"filter":return`${r}Filter(
${r}  ${this.expressionToString(e.expression)}
${this.toString(e.input,t+1)}
${r})`;case"join":return`${r}Join(
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"leftjoin":let i=e.expression?` ${this.expressionToString(e.expression)}`:"";return`${r}LeftJoin(${i}
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"union":return`${r}Union(
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"minus":return`${r}Minus(
${this.toString(e.left,t+1)}
${this.toString(e.right,t+1)}
${r})`;case"project":return`${r}Project [${e.variables.map(l=>`?${l}`).join(", ")}](
${this.toString(e.input,t+1)}
${r})`;case"orderby":let s=e.comparators.map(l=>`${this.expressionToString(l.expression)} ${l.descending?"DESC":"ASC"}`).join(", ");return`${r}OrderBy [${s}](
${this.toString(e.input,t+1)}
${r})`;case"slice":let a=[];return e.offset!==void 0&&a.push(`OFFSET ${e.offset}`),e.limit!==void 0&&a.push(`LIMIT ${e.limit}`),`${r}Slice [${a.join(", ")}](
${this.toString(e.input,t+1)}
${r})`;case"distinct":return`${r}Distinct(
${this.toString(e.input,t+1)}
${r})`;case"group":let c=e.variables.length>0?`[${e.variables.map(l=>`?${l}`).join(", ")}]`:"[]",u=e.aggregates.length>0?e.aggregates.map(l=>`?${l.variable} = ${l.expression.aggregation}(${l.expression.distinct?"DISTINCT ":""}${l.expression.expression?this.expressionToString(l.expression.expression):"*"})`).join(", "):"";return`${r}Group ${c}${u?` [${u}]`:""}(
${this.toString(e.input,t+1)}
${r})`;case"extend":return`${r}Extend (?${e.variable} = ${this.expressionToString(e.expression)})(
${this.toString(e.input,t+1)}
${r})`;case"subquery":return`${r}Subquery(
${this.toString(e.query,t+1)}
${r})`;default:return`${r}Unknown(${e.type})`}}tripleToString(e){return`${this.elementToString(e.subject)} ${this.predicateToString(e.predicate)} ${this.elementToString(e.object)}`}predicateToString(e){return this.isPropertyPath(e)?this.propertyPathToString(e):this.elementToString(e)}isPropertyPath(e){return e.type==="path"}propertyPathToString(e){let t=e.items.map(r=>r.type==="path"?`(${this.propertyPathToString(r)})`:`<${r.value}>`);switch(e.pathType){case"/":return t.join("/");case"|":return t.join("|");case"^":return`^${t[0]}`;case"+":return`${t[0]}+`;case"*":return`${t[0]}*`;case"?":return`${t[0]}?`}}elementToString(e){switch(e.type){case"variable":return`?${e.value}`;case"iri":return`<${e.value}>`;case"literal":let t=`"${e.value}"`;return e.language&&(t+=`@${e.language}`),e.datatype&&(t+=`^^<${e.datatype}>`),t;case"blank":return`_:${e.value}`;default:return String(e)}}expressionToString(e){switch(e.type){case"variable":return`?${e.name}`;case"literal":return typeof e.value=="string"?`"${e.value}"`:String(e.value);case"comparison":return`(${this.expressionToString(e.left)} ${e.operator} ${this.expressionToString(e.right)})`;case"logical":return e.operator==="!"?`!(${this.expressionToString(e.operands[0])})`:`(${e.operands.map(t=>this.expressionToString(t)).join(` ${e.operator} `)})`;case"arithmetic":return`(${this.expressionToString(e.left)} ${e.operator} ${this.expressionToString(e.right)})`;case"function":return`${e.function}(${e.args.map(t=>this.expressionToString(t)).join(", ")})`;case"exists":return`${e.negated?"NOT EXISTS":"EXISTS"} { ${this.toString(e.pattern,0)} }`;default:return"unknown"}}toJSON(e){return JSON.stringify(e,null,2)}};_l.AlgebraSerializer=Bm});var ci=v(bl=>{"use strict";Object.defineProperty(bl,"__esModule",{value:!0});bl.SolutionMapping=void 0;var D3=dt(),I3=Xe(),P3=Wt(),Um=class n{static{o(this,"SolutionMapping")}constructor(e){this.bindings=e?new Map(e):new Map}get(e){return this.bindings.get(e)}set(e,t){this.bindings.set(e,t)}has(e){return this.bindings.has(e)}variables(){return Array.from(this.bindings.keys())}getBindings(){return new Map(this.bindings)}isCompatibleWith(e){for(let[t,r]of this.bindings.entries()){let i=e.get(t);if(i!==void 0&&!this.areEqual(r,i))return!1}return!0}merge(e){if(!this.isCompatibleWith(e))return null;let t=new n(this.bindings);for(let[r,i]of e.getBindings().entries())t.set(r,i);return t}clone(){return new n(this.bindings)}areEqual(e,t){return e instanceof D3.Literal&&t instanceof D3.Literal?e.equals(t):e instanceof I3.IRI&&t instanceof I3.IRI?e.value===t.value:e instanceof P3.BlankNode&&t instanceof P3.BlankNode?e.id===t.id:!1}toJSON(){let e={};for(let[t,r]of this.bindings.entries())e[t]=r.toString();return e}size(){return this.bindings.size}};bl.SolutionMapping=Um});var R3=v(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.PropertyPathExecutor=ya.PropertyPathExecutorError=void 0;var ID=ci(),Sl=Xe(),F3=Wt(),Vo=class extends Error{static{o(this,"PropertyPathExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="PropertyPathExecutorError"}};ya.PropertyPathExecutorError=Vo;var qm=class{static{o(this,"PropertyPathExecutor")}constructor(e){this.tripleStore=e,this.MAX_DEPTH=100}async*execute(e,t,r){let i=await this.resolveElement(e),s=this.isVariable(r)?null:await this.resolveElement(r);for(let a of i){let c=await this.evaluatePath(a,t,s);for(let u of c){let l=new ID.SolutionMapping;this.isVariable(e)&&l.set(e.value,a),this.isVariable(r)&&l.set(r.value,u),yield l}}}async*executeWithBindings(e,t){if(!this.isPropertyPath(e.predicate))throw new Vo("Predicate is not a property path");let r=this.instantiateElement(e.subject,t),i=this.instantiateElement(e.object,t);for await(let s of this.execute(r,e.predicate,i)){let a=t.merge(s);a!==null&&(yield a)}}async evaluatePath(e,t,r){switch(t.pathType){case"/":return this.evaluateSequencePath(e,t.items,r);case"|":return this.evaluateAlternativePath(e,t.items,r);case"^":return this.evaluateInversePath(e,t.items[0],r);case"+":return this.evaluateOneOrMorePath(e,t.items[0],r);case"*":return this.evaluateZeroOrMorePath(e,t.items[0],r);case"?":return this.evaluateZeroOrOnePath(e,t.items[0],r)}}async evaluateSequencePath(e,t,r){let i=new Set([e]);for(let s=0;s<t.length;s++){let a=t[s],c=s===t.length-1,u=new Set;for(let l of i){let f=await this.evaluatePathItem(l,a,c?r:null);for(let h of f)u.add(h)}if(i=u,i.size===0)break}return i}async evaluateAlternativePath(e,t,r){let i=new Set;for(let s of t){let a=await this.evaluatePathItem(e,s,r);for(let c of a)i.add(c)}return i}async evaluateInversePath(e,t,r){if(t.type==="iri"){let i=new Sl.IRI(t.value),s=await this.tripleStore.match(void 0,i,e),a=new Set;for(let c of s)(r===null||this.nodeInSet(c.subject,r))&&a.add(c.subject);return a}else return this.evaluatePath(e,this.invertPath(t),r)}async evaluateOneOrMorePath(e,t,r){let i=new Set,s=new Set,a=[{node:e,depth:0}];for(;a.length>0;){let{node:c,depth:u}=a.shift();if(u>=this.MAX_DEPTH)continue;let l=await this.evaluatePathItem(c,t,null);for(let f of l){let h=this.nodeToKey(f);(r===null||this.nodeInSet(f,r))&&s.add(f),i.has(h)||(i.add(h),a.push({node:f,depth:u+1}))}}return s}async evaluateZeroOrMorePath(e,t,r){let i=await this.evaluateOneOrMorePath(e,t,r);return(r===null||this.nodeInSet(e,r))&&i.add(e),i}async evaluateZeroOrOnePath(e,t,r){let i=new Set;(r===null||this.nodeInSet(e,r))&&i.add(e);let s=await this.evaluatePathItem(e,t,r);for(let a of s)i.add(a);return i}async evaluatePathItem(e,t,r){if(t.type==="iri"){let i=new Sl.IRI(t.value),s=await this.tripleStore.match(e,i,void 0),a=new Set;for(let c of s)(r===null||this.nodeInSet(c.object,r))&&a.add(c.object);return a}else return this.evaluatePath(e,t,r)}invertPath(e){switch(e.pathType){case"^":return e.items[0];case"/":return{type:"path",pathType:"/",items:[...e.items].reverse().map(r=>r.type==="iri"?{type:"path",pathType:"^",items:[r]}:this.invertPath(r))};case"|":return{type:"path",pathType:"|",items:e.items.map(r=>r.type==="iri"?{type:"path",pathType:"^",items:[r]}:this.invertPath(r))};case"+":case"*":case"?":let t=e.items[0].type==="iri"?{type:"path",pathType:"^",items:[e.items[0]]}:this.invertPath(e.items[0]);return{type:"path",pathType:e.pathType,items:[t]}}}async resolveElement(e){if(this.isVariable(e)){let r=new Set,i=await this.tripleStore.match(void 0,void 0,void 0);for(let s of i)r.add(s.subject),r.add(s.object);return r}let t=new Set;switch(e.type){case"iri":t.add(new Sl.IRI(e.value));break;case"blank":t.add(new F3.BlankNode(e.value));break;default:throw new Vo(`Unsupported element type in subject/object position: ${e.type}`)}return t}instantiateElement(e,t){if(this.isVariable(e)){let r=t.get(e.value);if(r){if(r instanceof Sl.IRI)return{type:"iri",value:r.value};if(r instanceof F3.BlankNode)return{type:"blank",value:r.id}}}return e}isVariable(e){return e.type==="variable"}isPropertyPath(e){return e.type==="path"}nodeToKey(e){return e.toString()}nodeInSet(e,t){let r=this.nodeToKey(e);for(let i of t)if(this.nodeToKey(i)===r)return!0;return!1}};ya.PropertyPathExecutor=qm});var zm=v(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va.BGPExecutor=va.BGPExecutorError=void 0;var El=ci(),Pi=Xe(),Gm=dt(),Tl=Wt(),Al=vo(),PD=R3(),Kt=class extends Error{static{o(this,"BGPExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="BGPExecutorError"}};va.BGPExecutorError=Kt;var Wm=class{static{o(this,"BGPExecutor")}constructor(e){this.tripleStore=e,this.propertyPathExecutor=new PD.PropertyPathExecutor(e)}async*execute(e){if(e.triples.length===0){yield new El.SolutionMapping;return}let t=this.matchTriplePattern(e.triples[0]);for(let r=1;r<e.triples.length;r++)t=this.joinWithPattern(t,e.triples[r]);for await(let r of t)yield r}async executeAll(e){let t=[];for await(let r of this.execute(e))t.push(r);return t}async*executeInGraph(e,t){if(e.triples.length===0){yield new El.SolutionMapping;return}let r=this.matchTriplePatternInGraph(e.triples[0],t);for(let i=1;i<e.triples.length;i++)r=this.joinWithPatternInGraph(r,e.triples[i],t);for await(let i of r)yield i}async*matchTriplePatternInGraph(e,t){if(this.isPropertyPath(e.predicate))throw new Kt("Property paths within named graphs are not yet supported");let r=e.predicate,i=this.isVariable(e.subject)?void 0:this.toRDFTermAsSubject(e.subject),s=this.isVariable(r)?void 0:this.toRDFTermAsPredicate(r),a=this.isVariable(e.object)?void 0:this.toRDFTerm(e.object);if(!this.tripleStore.matchInGraph)throw new Kt("Triple store does not support named graph operations");let c=await this.tripleStore.matchInGraph(i,s,a,t);for(let u of c){let l=new El.SolutionMapping;this.isVariable(e.subject)&&l.set(e.subject.value,u.subject),this.isVariable(r)&&l.set(r.value,u.predicate),this.isVariable(e.object)&&l.set(e.object.value,u.object),yield l}}async*joinWithPatternInGraph(e,t,r){let i=[];for await(let s of e)i.push(s);for(let s of i){let a=this.instantiatePattern(t,s);for await(let c of this.matchTriplePatternInGraph(a,r)){let u=s.merge(c);u!==null&&(yield u)}}}async*matchTriplePattern(e){if(this.isPropertyPath(e.predicate)){yield*this.propertyPathExecutor.execute(e.subject,e.predicate,e.object);return}let t=e.predicate,r=this.isVariable(e.subject)||this.isQuotedTriple(e.subject)&&this.hasVariablesInQuotedTriple(e.subject)?void 0:this.toRDFTermAsSubject(e.subject),i=this.isVariable(t)?void 0:this.toRDFTermAsPredicate(t),s=this.isVariable(e.object)||this.isQuotedTriple(e.object)&&this.hasVariablesInQuotedTriple(e.object)?void 0:this.toRDFTerm(e.object),a=await this.tripleStore.match(r,i,s);for(let c of a){let u=new El.SolutionMapping;if(this.isVariable(e.subject))u.set(e.subject.value,c.subject);else if(this.isQuotedTriple(e.subject)){let l=this.matchQuotedTriplePattern(e.subject,c.subject);if(l===null)continue;for(let[f,h]of l.entries())u.set(f,h)}if(this.isVariable(t)&&u.set(t.value,c.predicate),this.isVariable(e.object))u.set(e.object.value,c.object);else if(this.isQuotedTriple(e.object)){let l=this.matchQuotedTriplePattern(e.object,c.object);if(l===null)continue;for(let[f,h]of l.entries())u.set(f,h)}yield u}}hasVariablesInQuotedTriple(e){return!!(this.isVariable(e.subject)||e.predicate.type==="variable"||this.isVariable(e.object)||this.isQuotedTriple(e.subject)&&this.hasVariablesInQuotedTriple(e.subject)||this.isQuotedTriple(e.object)&&this.hasVariablesInQuotedTriple(e.object))}matchQuotedTriplePattern(e,t){if(!(t instanceof Al.QuotedTriple))return null;let r=new Map;if(this.isVariable(e.subject))r.set(e.subject.value,t.subject);else if(this.isQuotedTriple(e.subject)){let i=this.matchQuotedTriplePattern(e.subject,t.subject);if(i===null)return null;for(let[s,a]of i)r.set(s,a)}else if(!this.elementsMatch(e.subject,t.subject))return null;if(e.predicate.type==="variable")r.set(e.predicate.value,t.predicate);else if(e.predicate.value!==t.predicate.value)return null;if(this.isVariable(e.object))r.set(e.object.value,t.object);else if(this.isQuotedTriple(e.object)){let i=this.matchQuotedTriplePattern(e.object,t.object);if(i===null)return null;for(let[s,a]of i)r.set(s,a)}else if(!this.elementsMatch(e.object,t.object))return null;return r}elementsMatch(e,t){switch(e.type){case"iri":return t instanceof Pi.IRI&&e.value===t.value;case"literal":return!(!(t instanceof Gm.Literal)||e.value!==t.value||e.datatype!==t.datatype?.value||e.language!==t.language||e.direction!==t.direction);case"blank":return t instanceof Tl.BlankNode&&e.value===t.id;case"quoted":return t instanceof Al.QuotedTriple?this.toRDFQuotedTriple(e).equals(t):!1;default:return!1}}isPropertyPath(e){return e.type==="path"}async*joinWithPattern(e,t){let r=[];for await(let i of e)r.push(i);for(let i of r){let s=this.instantiatePattern(t,i);for await(let a of this.matchTriplePattern(s)){let c=i.merge(a);c!==null&&(yield c)}}}instantiatePattern(e,t){let r=this.isPropertyPath(e.predicate)?e.predicate:this.instantiateElement(e.predicate,t);return{subject:this.instantiateElement(e.subject,t),predicate:r,object:this.instantiateElement(e.object,t)}}instantiateElement(e,t){if(this.isVariable(e)){let r=t.get(e.value);if(r)return this.toAlgebraElement(r)}return this.isQuotedTriple(e)?this.instantiateQuotedTriple(e,t):e}instantiateQuotedTriple(e,t){let r=this.instantiateElement(e.subject,t),i=e.predicate.type==="variable"?this.instantiatePredicateVariable(e.predicate,t):e.predicate,s=this.instantiateElement(e.object,t);return{type:"quoted",subject:r,predicate:i,object:s}}instantiatePredicateVariable(e,t){let r=t.get(e.value);return r&&r instanceof Pi.IRI?{type:"iri",value:r.value}:e}isVariable(e){return e.type==="variable"}isQuotedTriple(e){return e.type==="quoted"}toRDFTermAsSubject(e){switch(e.type){case"iri":return new Pi.IRI(e.value);case"blank":return new Tl.BlankNode(e.value);case"literal":throw new Kt("Literals cannot appear in subject position");case"variable":throw new Kt(`Cannot convert variable to RDF term: ${e.value}`);case"quoted":return this.toRDFQuotedTriple(e);default:throw new Kt(`Unknown element type: ${e.type}`)}}toRDFQuotedTriple(e){let t=this.toRDFTermAsSubject(e.subject),r=e.predicate.type==="iri"?new Pi.IRI(e.predicate.value):(()=>{throw new Kt("Quoted triple predicate must be IRI")})(),i=this.toRDFTerm(e.object);return new Al.QuotedTriple(t,r,i)}toRDFTermAsPredicate(e){switch(e.type){case"iri":return new Pi.IRI(e.value);case"literal":throw new Kt("Literals cannot appear in predicate position");case"blank":throw new Kt("Blank nodes cannot appear in predicate position");case"variable":throw new Kt(`Cannot convert variable to RDF term: ${e.value}`);default:throw new Kt(`Unknown element type: ${e.type}`)}}toRDFTerm(e){switch(e.type){case"iri":return new Pi.IRI(e.value);case"literal":return new Gm.Literal(e.value,e.datatype?new Pi.IRI(e.datatype):void 0,e.language,e.direction);case"blank":return new Tl.BlankNode(e.value);case"variable":throw new Kt(`Cannot convert variable to RDF term: ${e.value}`);case"quoted":return this.toRDFQuotedTriple(e);default:throw new Kt(`Unknown element type: ${e.type}`)}}toAlgebraElement(e){if(e instanceof Pi.IRI)return{type:"iri",value:e.value};if(e instanceof Gm.Literal)return{type:"literal",value:e.value,datatype:e.datatype?.value,language:e.language,direction:e.direction};if(e instanceof Tl.BlankNode)return{type:"blank",value:e.id};if(e instanceof Al.QuotedTriple)return this.toAlgebraQuotedTriple(e);throw new Kt(`Unknown RDF term type: ${e.constructor?.name||"unknown"}`)}toAlgebraQuotedTriple(e){return{type:"quoted",subject:this.toAlgebraElement(e.subject),predicate:{type:"iri",value:e.predicate.value},object:this.toAlgebraElement(e.object)}}};va.BGPExecutor=Wm});var Km=v(xl=>{"use strict";Object.defineProperty(xl,"__esModule",{value:!0});xl.BuiltInFunctions=void 0;var he=Xe(),P=dt(),ur=Wt(),wa=vo(),Hm=Or(),$o=class{static{o(this,"BuiltInFunctions")}static str(e){if(e===void 0)throw new Error("STR: argument is undefined");return e instanceof he.IRI||e instanceof P.Literal?e.value:e instanceof ur.BlankNode?e.id:String(e)}static lang(e){if(e===void 0)throw new Error("LANG: argument is undefined");return e instanceof P.Literal&&e.language?e.language:""}static langdir(e){if(e===void 0)throw new Error("LANGDIR: argument is undefined");return!(e instanceof P.Literal)||!e.language?"":e.direction?`${e.language}--${e.direction}`:e.language}static langMatches(e,t){let[r,i]=this.parseDirectionalLangTag(e),[s,a]=this.parseDirectionalLangTag(t),c=r.toLowerCase(),u=s.toLowerCase();return u==="*"?c!=="":c===""?u==="":a&&i!==a?!1:c===u?!0:c.startsWith(u+"-")}static parseDirectionalLangTag(e){let t=e.indexOf("--");if(t===-1)return[e,void 0];let r=e.substring(0,t),i=e.substring(t+2).toLowerCase();return[r,i]}static datatype(e){if(e===void 0)throw new Error("DATATYPE: argument is undefined");if(e instanceof P.Literal)return e.datatype?e.datatype:e.language?new he.IRI("http://www.w3.org/1999/02/22-rdf-syntax-ns#langString"):new he.IRI("http://www.w3.org/2001/XMLSchema#string");throw new Error("DATATYPE: argument must be a literal")}static bound(e){return e!==void 0}static isIRI(e){return e===void 0?!1:e instanceof he.IRI}static isBlank(e){return e===void 0?!1:e instanceof ur.BlankNode}static isLiteral(e){return e===void 0?!1:e instanceof P.Literal}static isTriple(e){return e===void 0?!1:e instanceof wa.QuotedTriple}static hasLangdir(e){return e===void 0||!(e instanceof P.Literal)?!1:!!e.language&&!!e.direction}static isNumeric(e){if(e===void 0||!(e instanceof P.Literal))return!1;let t=e.datatype?.value;return t?["http://www.w3.org/2001/XMLSchema#integer","http://www.w3.org/2001/XMLSchema#decimal","http://www.w3.org/2001/XMLSchema#float","http://www.w3.org/2001/XMLSchema#double","http://www.w3.org/2001/XMLSchema#nonPositiveInteger","http://www.w3.org/2001/XMLSchema#negativeInteger","http://www.w3.org/2001/XMLSchema#long","http://www.w3.org/2001/XMLSchema#int","http://www.w3.org/2001/XMLSchema#short","http://www.w3.org/2001/XMLSchema#byte","http://www.w3.org/2001/XMLSchema#nonNegativeInteger","http://www.w3.org/2001/XMLSchema#unsignedLong","http://www.w3.org/2001/XMLSchema#unsignedInt","http://www.w3.org/2001/XMLSchema#unsignedShort","http://www.w3.org/2001/XMLSchema#unsignedByte","http://www.w3.org/2001/XMLSchema#positiveInteger"].includes(t):!1}static regex(e,t,r){try{return new RegExp(t,r).test(e)}catch(i){throw new Error(`REGEX: invalid pattern '${t}': ${i.message}`)}}static compare(e,t,r){if(this.isDayTimeDurationValue(e)&&this.isDayTimeDurationValue(t))return this.compareDurations(e instanceof P.Literal?e:String(e),t instanceof P.Literal?t:String(t),r);let i=this.toComparableValue(e),s=this.toComparableValue(t);switch(r){case"=":return i===s;case"!=":return i!==s;case"<":return i<s;case">":return i>s;case"<=":return i<=s;case">=":return i>=s;default:throw new Error(`Unknown comparison operator: ${r}`)}}static isDayTimeDurationValue(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#dayTimeDuration":!1}static toComparableValue(e){if(typeof e=="string"||typeof e=="number")return e;if(e instanceof P.Literal){let t=e.datatype?.value;if(t?.includes("#integer")||t?.includes("#decimal")||t?.includes("#double")){let r=parseFloat(e.value);if(!isNaN(r))return r}if(t==="http://www.w3.org/2001/XMLSchema#dayTimeDuration")try{return this.parseDayTimeDuration(e.value)}catch{return e.value}return e.value}return e instanceof he.IRI?e.value:e instanceof ur.BlankNode?e.id:String(e)}static contains(e,t){return e.includes(t)}static strStarts(e,t){return e.startsWith(t)}static strEnds(e,t){return e.endsWith(t)}static strlen(e){return e.length}static ucase(e){return e.toUpperCase()}static lcase(e){return e.toLowerCase()}static substr(e,t,r){let i=t-1;if(i<0){if(r!==void 0){let s=r+i;return s<=0?"":e.substring(0,s)}return e}return r!==void 0?e.substring(i,i+r):e.substring(i)}static strBefore(e,t){if(t==="")return"";let r=e.indexOf(t);return r===-1?"":e.substring(0,r)}static strAfter(e,t){if(t==="")return e;let r=e.indexOf(t);return r===-1?"":e.substring(r+t.length)}static concat(...e){return e.join("")}static replace(e,t,r,i){try{let s=new RegExp(t,i||"g");return e.replace(s,r)}catch(s){throw new Error(`REPLACE: invalid pattern '${t}': ${s.message}`)}}static parseDate(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`PARSEDATE: invalid date string '${e}'`);return t.getTime()}static dateBefore(e,t){let r=this.parseDate(e),i=this.parseDate(t);return r<i}static dateAfter(e,t){let r=this.parseDate(e),i=this.parseDate(t);return r>i}static dateInRange(e,t,r){let i=this.parseDate(e),s=this.parseDate(t),a=this.parseDate(r);return i>=s&&i<=a}static dateDiffMinutes(e,t){let r=this.parseDate(e),i=this.parseDate(t),s=Math.abs(i-r);return Math.round(s/(1e3*60))}static dateDiffHours(e,t){let r=this.parseDate(e),i=this.parseDate(t),s=Math.abs(i-r);return Math.round(s/(1e3*60*60)*100)/100}static logicalAnd(e){return e.every(t=>t===!0)}static logicalOr(e){return e.some(t=>t===!0)}static logicalNot(e){return!e}static year(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`YEAR: invalid date string '${e}'`);return t.getFullYear()}static month(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`MONTH: invalid date string '${e}'`);return t.getMonth()+1}static day(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`DAY: invalid date string '${e}'`);return t.getDate()}static hours(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`HOURS: invalid date string '${e}'`);return t.getHours()}static minutes(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`MINUTES: invalid date string '${e}'`);return t.getMinutes()}static seconds(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`SECONDS: invalid date string '${e}'`);return t.getSeconds()+t.getMilliseconds()/1e3}static timezone(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`TIMEZONE: invalid date string '${e}'`);let r;if(e.endsWith("Z"))r="PT0S";else{let i=e.match(/([+-]\d{2}):?(\d{2})$/);if(i){let s=parseInt(i[1],10),a=parseInt(i[2],10),c=s>=0?"":"-",u=Math.abs(s);a===0?r=`${c}PT${u}H`:r=`${c}PT${u}H${a}M`}else{let s=-t.getTimezoneOffset(),a=Math.floor(Math.abs(s)/60),c=Math.abs(s)%60,u=s>=0?"":"-";c===0?r=`${u}PT${a}H`:r=`${u}PT${a}H${c}M`}}return new P.Literal(r,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static tz(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`TZ: invalid date string '${e}'`);if(e.endsWith("Z"))return"Z";let r=e.match(/([+-]\d{2}:\d{2})$/);if(r)return r[1];let i=e.match(/([+-])(\d{2})(\d{2})$/);return i?`${i[1]}${i[2]}:${i[3]}`:""}static now(){return new Date().toISOString()}static msToMinutes(e){return Math.round(e/(1e3*60))}static msToHours(e){return Math.round(e/(1e3*60*60)*100)/100}static msToSeconds(e){return Math.round(e/1e3)}static abs(e){return Math.abs(e)}static round(e){return Math.round(e)}static ceil(e){return Math.ceil(e)}static floor(e){return Math.floor(e)}static rand(){return Math.random()}static coalesce(e){for(let t of e)if(t!=null)return t}static if(e,t,r){return e?t:r}static xsdDateTime(e){let t=new Date(e);if(isNaN(t.getTime()))throw new Error(`xsd:dateTime: invalid date string '${e}'`);return new P.Literal(t.toISOString(),new he.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static xsdInteger(e){let t=parseInt(e,10);if(isNaN(t))throw new Error(`xsd:integer: cannot convert '${e}' to integer`);return new P.Literal(String(t),new he.IRI("http://www.w3.org/2001/XMLSchema#integer"))}static xsdDecimal(e){let t=parseFloat(e);if(isNaN(t))throw new Error(`xsd:decimal: cannot convert '${e}' to decimal`);return new P.Literal(String(t),new he.IRI("http://www.w3.org/2001/XMLSchema#decimal"))}static encodeForUri(e){return encodeURIComponent(e)}static md5(e){return require("crypto").createHash("md5").update(e).digest("hex")}static sha1(e){return require("crypto").createHash("sha1").update(e).digest("hex")}static sha256(e){return require("crypto").createHash("sha256").update(e).digest("hex")}static sha384(e){return require("crypto").createHash("sha384").update(e).digest("hex")}static sha512(e){return require("crypto").createHash("sha512").update(e).digest("hex")}static sameTerm(e,t){if(e===void 0&&t===void 0)return!0;if(e===void 0||t===void 0||e.constructor!==t.constructor)return!1;if(e instanceof he.IRI&&t instanceof he.IRI)return e.value===t.value;if(e instanceof ur.BlankNode&&t instanceof ur.BlankNode)return e.id===t.id;if(e instanceof P.Literal&&t instanceof P.Literal){if(e.value!==t.value||e.language!==t.language)return!1;let r=e.datatype?.value,i=t.datatype?.value;return r===i}return!1}static iri(e){if(e===void 0)throw new Error("IRI: argument is undefined");if(e instanceof he.IRI)return e;if(e instanceof P.Literal)return new he.IRI(e.value);throw e instanceof ur.BlankNode?new Error("IRI: cannot convert blank node to IRI"):new Error("IRI: unsupported term type")}static uri(e){return this.iri(e)}static bnode(e){if(e===void 0){let t=`b${(0,Hm.v4)().replace(/-/g,"").substring(0,12)}`;return new ur.BlankNode(t)}if(e instanceof P.Literal)return new ur.BlankNode(e.value);if(e instanceof ur.BlankNode)return e;throw new Error("BNODE: argument must be a string literal or omitted")}static strdt(e,t){if(e===void 0)throw new Error("STRDT: lexical form is undefined");if(t===void 0)throw new Error("STRDT: datatype IRI is undefined");let r;if(e instanceof P.Literal){if(e.language)throw new Error("STRDT: lexical form must not have a language tag");r=e.value}else if(typeof e=="string")r=e;else throw new Error("STRDT: lexical form must be a string literal");let i;if(t instanceof he.IRI)i=t;else if(t instanceof P.Literal)i=new he.IRI(t.value);else throw new Error("STRDT: datatype must be an IRI");return new P.Literal(r,i)}static strlang(e,t){if(e===void 0)throw new Error("STRLANG: lexical form is undefined");if(t===void 0)throw new Error("STRLANG: language tag is undefined");let r;if(e instanceof P.Literal){if(e.language)throw new Error("STRLANG: lexical form must not already have a language tag");r=e.value}else if(typeof e=="string")r=e;else throw new Error("STRLANG: lexical form must be a string literal");let i;if(t instanceof P.Literal)i=t.value;else if(typeof t=="string")i=t;else throw new Error("STRLANG: language tag must be a string literal");if(i==="")throw new Error("STRLANG: language tag cannot be empty");return new P.Literal(r,void 0,i)}static strlangdir(e,t,r){if(e===void 0)throw new Error("STRLANGDIR: lexical form is undefined");if(t===void 0)throw new Error("STRLANGDIR: language tag is undefined");if(r===void 0)throw new Error("STRLANGDIR: direction is undefined");let i;if(e instanceof P.Literal){if(e.language)throw new Error("STRLANGDIR: lexical form must not already have a language tag");i=e.value}else if(typeof e=="string")i=e;else throw new Error("STRLANGDIR: lexical form must be a string literal");let s;if(t instanceof P.Literal)s=t.value;else if(typeof t=="string")s=t;else throw new Error("STRLANGDIR: language tag must be a string literal");if(s==="")throw new Error("STRLANGDIR: language tag cannot be empty");let a;if(r instanceof P.Literal)a=r.value.toLowerCase();else throw new Error("STRLANGDIR: direction must be a string literal");if(a!=="ltr"&&a!=="rtl")throw new Error(`STRLANGDIR: invalid direction '${a}'. Must be 'ltr' or 'rtl'`);return new P.Literal(i,void 0,s,a)}static uuid(){let e=(0,Hm.v4)();return new he.IRI(`urn:uuid:${e}`)}static struuid(){let e=(0,Hm.v4)();return new P.Literal(e)}static parseDayTimeDuration(e){if(!e)throw new Error("parseDayTimeDuration: duration string is empty");let t=!1,r=e.trim();if(r.startsWith("-")&&(t=!0,r=r.substring(1)),!r.startsWith("P"))throw new Error(`parseDayTimeDuration: invalid format, must start with 'P': '${e}'`);r=r.substring(1);let i=0,s=r.indexOf("T"),a="",c="";if(s===-1?a=r:(a=r.substring(0,s),c=r.substring(s+1)),a){let u=a.match(/^(\d+(?:\.\d+)?)D$/);if(u){let l=parseFloat(u[1]);i+=l*24*60*60*1e3}else if(a!=="")throw new Error(`parseDayTimeDuration: invalid day component: '${a}' in '${e}'`)}if(c){let u=c,l=u.match(/^(\d+(?:\.\d+)?)H/);if(l){let d=parseFloat(l[1]);i+=d*60*60*1e3,u=u.substring(l[0].length)}let f=u.match(/^(\d+(?:\.\d+)?)M/);if(f){let d=parseFloat(f[1]);i+=d*60*1e3,u=u.substring(f[0].length)}let h=u.match(/^(\d+(?:\.\d+)?)S$/);if(h){let d=parseFloat(h[1]);i+=d*1e3,u=u.substring(h[0].length)}if(u!=="")throw new Error(`parseDayTimeDuration: invalid time component: '${u}' in '${e}'`)}return t?-i:i}static formatDayTimeDuration(e){let t=e<0,r=Math.abs(e),i=Math.floor(r/(1440*60*1e3));r=r%(1440*60*1e3);let s=Math.floor(r/(3600*1e3));r=r%(3600*1e3);let a=Math.floor(r/(60*1e3));r=r%(60*1e3);let c=r/1e3,u=t?"-P":"P";return i>0&&(u+=`${i}D`),(s>0||a>0||c>0||i===0)&&(u+="T",s>0&&(u+=`${s}H`),a>0&&(u+=`${a}M`),(c>0||s===0&&a===0)&&(Number.isInteger(c)?u+=`${c}S`:u+=`${parseFloat(c.toFixed(3))}S`)),u}static xsdDayTimeDuration(e){return this.parseDayTimeDuration(e),new P.Literal(e,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static compareDurations(e,t,r){let i=e instanceof P.Literal?e.value:e,s=t instanceof P.Literal?t.value:t,a=this.parseDayTimeDuration(i),c=this.parseDayTimeDuration(s);switch(r){case"=":return a===c;case"!=":return a!==c;case"<":return a<c;case">":return a>c;case"<=":return a<=c;case">=":return a>=c;default:throw new Error(`compareDurations: unknown operator: ${r}`)}}static isDayTimeDuration(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#dayTimeDuration":!1}static isDate(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#date":!1}static dateDiff(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r),a=this.parseXSDDate(i);if(s===null)throw new Error(`dateDiff: invalid first date: '${r}'`);if(a===null)throw new Error(`dateDiff: invalid second date: '${i}'`);let c=s.getTime()-a.getTime(),u=Math.round(c/(1440*60*1e3)),l=this.formatDateDuration(u);return new P.Literal(l,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static parseXSDDate(e){let t=/^(-?\d{4})-(\d{2})-(\d{2})(Z|[+-]\d{2}:\d{2})?$/,r=e.match(t);if(!r){let l=new Date(e);return isNaN(l.getTime())?null:new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()))}let i=parseInt(r[1],10),s=parseInt(r[2],10)-1,a=parseInt(r[3],10),c=r[4],u=new Date(Date.UTC(i,s,a));if(c&&c!=="Z"){let l=c.match(/([+-])(\d{2}):(\d{2})/);if(l){let f=l[1]==="+"?1:-1,h=parseInt(l[2],10),d=parseInt(l[3],10),m=f*(h*60+d)*60*1e3;u=new Date(u.getTime()-m)}}return u}static formatDateDuration(e){if(e===0)return"P0D";let t=e<0,r=Math.abs(e);return t?`-P${r}D`:`P${r}D`}static dateTimeDiff(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r),a=new Date(i);if(isNaN(s.getTime()))throw new Error(`dateTimeDiff: invalid first dateTime: '${r}'`);if(isNaN(a.getTime()))throw new Error(`dateTimeDiff: invalid second dateTime: '${i}'`);let c=s.getTime()-a.getTime(),u=this.formatDayTimeDuration(c);return new P.Literal(u,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static dateTimeAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeAdd: invalid dateTime: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()+a,u=new Date(c);return new P.Literal(u.toISOString(),new he.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateTimeSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeSubtract: invalid dateTime: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()-a,u=new Date(c);return new P.Literal(u.toISOString(),new he.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateAdd: invalid date: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()+a,u=new Date(c),l=u.getUTCFullYear(),f=String(u.getUTCMonth()+1).padStart(2,"0"),h=String(u.getUTCDate()).padStart(2,"0"),d=`${l}-${f}-${h}`;return new P.Literal(d,new he.IRI("http://www.w3.org/2001/XMLSchema#date"))}static dateSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateSubtract: invalid date: '${r}'`);let a=this.parseDayTimeDuration(i),c=s.getTime()-a,u=new Date(c),l=u.getUTCFullYear(),f=String(u.getUTCMonth()+1).padStart(2,"0"),h=String(u.getUTCDate()).padStart(2,"0"),d=`${l}-${f}-${h}`;return new P.Literal(d,new he.IRI("http://www.w3.org/2001/XMLSchema#date"))}static parseYearMonthDuration(e){let t=/^(-)?P(?:(\d+)Y)?(?:(\d+)M)?$/,r=e.match(t);if(!r)throw new Error(`parseYearMonthDuration: invalid format: '${e}'`);let i=r[1]==="-",s=parseInt(r[2]||"0",10),a=parseInt(r[3]||"0",10);if(!r[2]&&!r[3])throw new Error(`parseYearMonthDuration: invalid format (no duration components): '${e}'`);let c=s*12+a;return i?-c:c}static isYearMonthDuration(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#yearMonthDuration":!1}static dateTimeAddYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeAddYearMonth: invalid dateTime: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();return s.setUTCMonth(s.getUTCMonth()+a),s.getUTCDate()!==c&&s.setUTCDate(0),new P.Literal(s.toISOString(),new he.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateTimeSubtractYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=new Date(r);if(isNaN(s.getTime()))throw new Error(`dateTimeSubtractYearMonth: invalid dateTime: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();return s.setUTCMonth(s.getUTCMonth()-a),s.getUTCDate()!==c&&s.setUTCDate(0),new P.Literal(s.toISOString(),new he.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static dateAddYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateAddYearMonth: invalid date: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();s.setUTCMonth(s.getUTCMonth()+a),s.getUTCDate()!==c&&s.setUTCDate(0);let u=s.getUTCFullYear(),l=String(s.getUTCMonth()+1).padStart(2,"0"),f=String(s.getUTCDate()).padStart(2,"0"),h=`${u}-${l}-${f}`;return new P.Literal(h,new he.IRI("http://www.w3.org/2001/XMLSchema#date"))}static dateSubtractYearMonth(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDDate(r);if(s===null)throw new Error(`dateSubtractYearMonth: invalid date: '${r}'`);let a=this.parseYearMonthDuration(i),c=s.getUTCDate();s.setUTCMonth(s.getUTCMonth()-a),s.getUTCDate()!==c&&s.setUTCDate(0);let u=s.getUTCFullYear(),l=String(s.getUTCMonth()+1).padStart(2,"0"),f=String(s.getUTCDate()).padStart(2,"0"),h=`${u}-${l}-${f}`;return new P.Literal(h,new he.IRI("http://www.w3.org/2001/XMLSchema#date"))}static durationAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseDayTimeDuration(r),a=this.parseDayTimeDuration(i),c=this.formatDayTimeDuration(s+a);return new P.Literal(c,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static durationSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseDayTimeDuration(r),a=this.parseDayTimeDuration(i),c=this.formatDayTimeDuration(s-a);return new P.Literal(c,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static durationMultiply(e,t){let r=e instanceof P.Literal?e.value:e,i=this.parseDayTimeDuration(r),s=this.formatDayTimeDuration(i*t);return new P.Literal(s,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static durationDivide(e,t){if(t===0)throw new Error("durationDivide: division by zero");let r=e instanceof P.Literal?e.value:e,i=this.parseDayTimeDuration(r),s=this.formatDayTimeDuration(i/t);return new P.Literal(s,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static formatYearMonthDuration(e){let t=e<0,r=Math.abs(e),i=Math.floor(r/12),s=r%12,a=t?"-P":"P";return i>0&&(a+=`${i}Y`),(s>0||i===0)&&(a+=`${s}M`),a}static yearMonthDurationAdd(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseYearMonthDuration(r),a=this.parseYearMonthDuration(i),c=this.formatYearMonthDuration(s+a);return new P.Literal(c,new he.IRI("http://www.w3.org/2001/XMLSchema#yearMonthDuration"))}static yearMonthDurationSubtract(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseYearMonthDuration(r),a=this.parseYearMonthDuration(i),c=this.formatYearMonthDuration(s-a);return new P.Literal(c,new he.IRI("http://www.w3.org/2001/XMLSchema#yearMonthDuration"))}static parseYearMonthDurationComponents(e){let t=/^(-)?P(?:(\d+)Y)?(?:(\d+)M)?$/,r=e.match(t);if(!r)throw new Error(`parseYearMonthDurationComponents: invalid format: '${e}'`);let i=r[1]==="-",s=parseInt(r[2]||"0",10),a=parseInt(r[3]||"0",10);if(!r[2]&&!r[3])throw new Error(`parseYearMonthDurationComponents: invalid format (no duration components): '${e}'`);return{years:s,months:a,negative:i}}static durationYears(e){let t=e instanceof P.Literal?e.value:e,r=this.parseYearMonthDurationComponents(t);return r.negative?-r.years:r.years}static durationMonths(e){let t=e instanceof P.Literal?e.value:e,r=this.parseYearMonthDurationComponents(t);return r.negative?-r.months:r.months}static durationToDays(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/(1440*60*1e3)}static durationToHours(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/(3600*1e3)}static durationToMinutes(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/(60*1e3)}static durationToSeconds(e){let t=e instanceof P.Literal?e.value:e;return this.parseDayTimeDuration(t)/1e3}static parseDurationComponents(e){if(!e)throw new Error("parseDurationComponents: duration string is empty");let t=!1,r=e.trim();if(r.startsWith("-")&&(t=!0,r=r.substring(1)),!r.startsWith("P"))throw new Error(`parseDurationComponents: invalid format, must start with 'P': '${e}'`);r=r.substring(1);let i=0,s=0,a=0,c=0,u=r.indexOf("T"),l="",f="";if(u===-1?l=r:(l=r.substring(0,u),f=r.substring(u+1)),l){let h=l.match(/^(\d+(?:\.\d+)?)D$/);if(h)i=parseFloat(h[1]);else if(l!=="")throw new Error(`parseDurationComponents: invalid day component: '${l}' in '${e}'`)}if(f){let h=f,d=h.match(/^(\d+(?:\.\d+)?)H/);d&&(s=parseFloat(d[1]),h=h.substring(d[0].length));let m=h.match(/^(\d+(?:\.\d+)?)M/);m&&(a=parseFloat(m[1]),h=h.substring(m[0].length));let _=h.match(/^(\d+(?:\.\d+)?)S$/);if(_&&(c=parseFloat(_[1]),h=h.substring(_[0].length)),h!=="")throw new Error(`parseDurationComponents: invalid time component: '${h}' in '${e}'`)}return{negative:t,days:i,hours:s,minutes:a,seconds:c}}static durationDays(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t),i=Math.floor(r.days);return r.negative?-i:i}static durationHours(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t),i=Math.floor(r.hours);return r.negative?-i:i}static durationMinutes(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t),i=Math.floor(r.minutes);return r.negative?-i:i}static durationSeconds(e){let t=e instanceof P.Literal?e.value:e,r=this.parseDurationComponents(t);return r.negative?-r.seconds:r.seconds}static adjust(e,t){let r=e instanceof P.Literal?e.value:e,i=new Date(r);if(isNaN(i.getTime()))throw new Error(`ADJUST: invalid dateTime: '${r}'`);if(t==null){let Fe=i.getUTCFullYear(),Ze=String(i.getUTCMonth()+1).padStart(2,"0"),ot=String(i.getUTCDate()).padStart(2,"0"),B=String(i.getUTCHours()).padStart(2,"0"),ue=String(i.getUTCMinutes()).padStart(2,"0"),be=String(i.getUTCSeconds()).padStart(2,"0"),He=i.getUTCMilliseconds(),qe=`${Fe}-${Ze}-${ot}T${B}:${ue}:${be}`;return He>0&&(qe+=`.${String(He).padStart(3,"0")}`),new P.Literal(qe,new he.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}let s=t instanceof P.Literal?t.value:t,a=this.parseDayTimeDuration(s),c=840*60*1e3;if(Math.abs(a)>c)throw new Error(`ADJUST: timezone offset out of range: '${s}'`);let u=i.getTime(),l=new Date(u+a),f=l.getUTCFullYear(),h=String(l.getUTCMonth()+1).padStart(2,"0"),d=String(l.getUTCDate()).padStart(2,"0"),m=String(l.getUTCHours()).padStart(2,"0"),_=String(l.getUTCMinutes()).padStart(2,"0"),b=String(l.getUTCSeconds()).padStart(2,"0"),C=l.getUTCMilliseconds(),O=a>=0?"+":"-",I=Math.floor(Math.abs(a)/(3600*1e3)),L=Math.floor(Math.abs(a)%(3600*1e3)/(60*1e3)),G=`${O}${String(I).padStart(2,"0")}:${String(L).padStart(2,"0")}`,W=`${f}-${h}-${d}T${m}:${_}:${b}`;return C>0&&(W+=`.${String(C).padStart(3,"0")}`),W+=G,new P.Literal(W,new he.IRI("http://www.w3.org/2001/XMLSchema#dateTime"))}static normalize(e,t){if(e===void 0)throw new Error("NORMALIZE: string argument is undefined");let r;if(e instanceof P.Literal)r=e.value;else if(e instanceof he.IRI)r=e.value;else if(e instanceof ur.BlankNode)r=e.id;else if(typeof e=="string")r=e;else throw new Error("NORMALIZE: first argument must be a string or literal");let i="NFC";if(t!==void 0)if(t instanceof P.Literal)i=t.value.toUpperCase();else if(typeof t=="string")i=t.toUpperCase();else if(t instanceof he.IRI)i=t.value.toUpperCase();else throw new Error("NORMALIZE: second argument must be a string literal");if(!this.VALID_NORMALIZATION_FORMS.includes(i))throw new Error(`NORMALIZE: invalid normalization form '${i}'. Valid forms are: NFC, NFD, NFKC, NFKD`);let s=r.normalize(i);return new P.Literal(s,new he.IRI("http://www.w3.org/2001/XMLSchema#string"))}static fold(e){if(e===void 0)throw new Error("FOLD: string argument is undefined");let t;if(e instanceof P.Literal)t=e.value;else if(e instanceof he.IRI)t=e.value;else if(e instanceof ur.BlankNode)t=e.id;else if(typeof e=="string")t=e;else throw new Error("FOLD: argument must be a string or literal");let r=this.unicodeCaseFold(t);return new P.Literal(r,new he.IRI("http://www.w3.org/2001/XMLSchema#string"))}static unicodeCaseFold(e){let t="";for(let r of e){let i=this.CASE_FOLDING_MAP.get(r);i!==void 0?t+=i:t+=r.toLowerCase()}return t}static isTime(e){return e instanceof P.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#time":!1}static timeDiff(e,t){let r=e instanceof P.Literal?e.value:e,i=t instanceof P.Literal?t.value:t,s=this.parseXSDTime(r),a=this.parseXSDTime(i);if(s===null)throw new Error(`timeDiff: invalid first time: '${r}'`);if(a===null)throw new Error(`timeDiff: invalid second time: '${i}'`);let c=s-a,u=this.formatDayTimeDuration(c);return new P.Literal(u,new he.IRI("http://www.w3.org/2001/XMLSchema#dayTimeDuration"))}static parseXSDTime(e){let t=/^(\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(Z|[+-]\d{2}:\d{2})?$/,r=e.match(t);if(!r)return null;let i=parseInt(r[1],10),s=parseInt(r[2],10),a=parseInt(r[3],10),c=r[4],u=r[5];if(i<0||i>24||s<0||s>59||a<0||a>59||i===24&&(s!==0||a!==0))return null;let l=0;if(c){let h=c.padEnd(3,"0").slice(0,3);l=parseInt(h,10)}let f=i*60*60*1e3+s*60*1e3+a*1e3+l;if(i===24&&(f=1440*60*1e3),u&&u!=="Z"){let h=u.match(/([+-])(\d{2}):(\d{2})/);if(h){let d=h[1]==="+"?1:-1,m=parseInt(h[2],10),_=parseInt(h[3],10),b=d*(m*60+_)*60*1e3;f-=b}}return f}static triple(e,t,r){if(e===void 0)throw new Error("TRIPLE: subject is undefined");if(t===void 0)throw new Error("TRIPLE: predicate is undefined");if(r===void 0)throw new Error("TRIPLE: object is undefined");if(e instanceof P.Literal)throw new Error("TRIPLE: subject must be IRI, BlankNode, or QuotedTriple, got Literal");if(!(t instanceof he.IRI)){let c=t instanceof P.Literal?"Literal":t instanceof ur.BlankNode?"BlankNode":t instanceof wa.QuotedTriple?"QuotedTriple":typeof t;throw new Error(`TRIPLE: predicate must be IRI, got ${c}`)}let i=e,s=t,a=r;return new wa.QuotedTriple(i,s,a)}static subject(e){if(e===void 0)throw new Error("SUBJECT: argument is undefined");if(!(e instanceof wa.QuotedTriple)){let t=e instanceof he.IRI?"IRI":e instanceof P.Literal?"Literal":e instanceof ur.BlankNode?"BlankNode":typeof e;throw new Error(`SUBJECT: argument must be QuotedTriple, got ${t}`)}return e.subject}static predicate(e){if(e===void 0)throw new Error("PREDICATE: argument is undefined");if(!(e instanceof wa.QuotedTriple)){let t=e instanceof he.IRI?"IRI":e instanceof P.Literal?"Literal":e instanceof ur.BlankNode?"BlankNode":typeof e;throw new Error(`PREDICATE: argument must be QuotedTriple, got ${t}`)}return e.predicate}static object(e){if(e===void 0)throw new Error("OBJECT: argument is undefined");if(!(e instanceof wa.QuotedTriple)){let t=e instanceof he.IRI?"IRI":e instanceof P.Literal?"Literal":e instanceof ur.BlankNode?"BlankNode":typeof e;throw new Error(`OBJECT: argument must be QuotedTriple, got ${t}`)}return e.object}};xl.BuiltInFunctions=$o;$o.VALID_NORMALIZATION_FORMS=["NFC","NFD","NFKC","NFKD"];$o.CASE_FOLDING_MAP=new Map([["\xDF","ss"],["\u1E9E","ss"],["\u03A3","\u03C3"],["\u03C2","\u03C3"],["\u0130","i\u0307"],["I","i"],["\u0587","\u0565\u0582"],["\uFB00","ff"],["\uFB01","fi"],["\uFB02","fl"],["\uFB03","ffi"],["\uFB04","ffl"],["\uFB05","st"],["\uFB06","st"],["\u0390","\u03B9\u0308\u0301"],["\u03B0","\u03C5\u0308\u0301"],["\u017F","s"],["\u1E9B","\u1E61"],["\u212A","k"],["\u212B","\xE5"]])});var Cl=v(_a=>{"use strict";Object.defineProperty(_a,"__esModule",{value:!0});_a.FilterExecutor=_a.FilterExecutorError=void 0;var F=Km(),Ts=dt(),Mt=class extends Error{static{o(this,"FilterExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="FilterExecutorError"}};_a.FilterExecutorError=Mt;var Qm=class{static{o(this,"FilterExecutor")}constructor(){this.existsEvaluator=null,this.tripleStore=null,this.uuidCache=new Map}setExistsEvaluator(e){this.existsEvaluator=e}setTripleStore(e){this.tripleStore=e,this.uuidCache.clear()}async*execute(e,t){let r=this.expressionContainsExists(e.expression);for await(let i of t)try{let s;r?s=await this.evaluateExpressionAsync(e.expression,i):s=this.evaluateExpression(e.expression,i),s===!0&&(yield i)}catch{continue}}expressionContainsExists(e){if(e.type==="exists")return!0;if(e.type==="logical")return e.operands.some(t=>this.expressionContainsExists(t));if(e.type==="comparison")return this.expressionContainsExists(e.left)||this.expressionContainsExists(e.right);if(e.type==="in"){let t=e;return this.expressionContainsExists(t.expression)||t.list.some(r=>this.expressionContainsExists(r))}return!1}async executeAll(e,t){let r=[];async function*i(){for(let s of t)yield s}o(i,"generator");for await(let s of this.execute(e,i()))r.push(s);return r}evaluateExpression(e,t){let r=e;if(r.termType)switch(r.termType){case"Variable":return t.get(r.value);case"Literal":return r.value;case"NamedNode":return r.value;default:throw new Mt(`Unsupported termType: ${r.termType}`)}switch(e.type){case"comparison":return this.evaluateComparison(e,t);case"logical":return this.evaluateLogical(e,t);case"arithmetic":return this.evaluateArithmetic(e,t);case"function":case"functionCall":return this.evaluateFunction(e,t);case"variable":return t.get(e.name);case"literal":return e.value;case"in":return this.evaluateIn(e,t);case"exists":throw new Mt("EXISTS expressions require async evaluation. Use evaluateExpressionAsync instead.");default:throw new Mt(`Unsupported expression type: ${e.type}, expr.termType=${r.termType}`)}}async evaluateExpressionAsync(e,t){return e.type==="exists"?this.evaluateExists(e,t):e.type==="logical"?this.evaluateLogicalAsync(e,t):this.evaluateExpression(e,t)}async evaluateExists(e,t){if(!this.existsEvaluator)throw new Mt("EXISTS evaluator not set. Call setExistsEvaluator before evaluating EXISTS expressions.");let r=await this.existsEvaluator(e.pattern,t);return e.negated?!r:r}async evaluateLogicalAsync(e,t){if(e.operator==="!"){let i=await this.evaluateExpressionAsync(e.operands[0],t);return F.BuiltInFunctions.logicalNot(i)}let r=[];for(let i of e.operands){let s=await this.evaluateExpressionAsync(i,t);r.push(s)}if(e.operator==="&&")return F.BuiltInFunctions.logicalAnd(r);if(e.operator==="||")return F.BuiltInFunctions.logicalOr(r);throw new Mt(`Unknown logical operator: ${e.operator}`)}evaluateComparison(e,t){let r=this.evaluateExpression(e.left,t),i=this.evaluateExpression(e.right,t);return F.BuiltInFunctions.compare(r,i,e.operator)}evaluateLogical(e,t){if(e.operator==="!"){let i=this.evaluateExpression(e.operands[0],t);return F.BuiltInFunctions.logicalNot(i)}let r=e.operands.map(i=>this.evaluateExpression(i,t));if(e.operator==="&&")return F.BuiltInFunctions.logicalAnd(r);if(e.operator==="||")return F.BuiltInFunctions.logicalOr(r);throw new Mt(`Unknown logical operator: ${e.operator}`)}evaluateIn(e,t){let r=this.evaluateExpression(e.expression,t),i=e.list.some(s=>{let a=this.evaluateExpression(s,t);return F.BuiltInFunctions.compare(r,a,"=")});return e.negated?!i:i}evaluateArithmetic(e,t){let r=this.evaluateExpression(e.left,t),i=this.evaluateExpression(e.right,t);if(e.operator==="-"&&this.isDateValue(r)&&this.isDateValue(i))return F.BuiltInFunctions.dateDiff(r,i);if(e.operator==="-"&&this.isTimeValue(r)&&this.isTimeValue(i))return F.BuiltInFunctions.timeDiff(r,i);if(e.operator==="-"&&this.isDateTimeValue(r)&&this.isDateTimeValue(i))return F.BuiltInFunctions.dateTimeDiff(r,i);if(e.operator==="+"&&this.isDateValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateAdd(r,i);if(e.operator==="-"&&this.isDateValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateSubtract(r,i);if(e.operator==="+"&&this.isDateValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateAddYearMonth(r,i);if(e.operator==="-"&&this.isDateValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateSubtractYearMonth(r,i);if(e.operator==="+"&&this.isDateTimeValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateTimeAdd(r,i);if(e.operator==="-"&&this.isDateTimeValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.dateTimeSubtract(r,i);if(e.operator==="+"&&this.isDateTimeValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateTimeAddYearMonth(r,i);if(e.operator==="-"&&this.isDateTimeValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.dateTimeSubtractYearMonth(r,i);if(e.operator==="+"&&this.isDayTimeDurationValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.durationAdd(r,i);if(e.operator==="-"&&this.isDayTimeDurationValue(r)&&this.isDayTimeDurationValue(i))return F.BuiltInFunctions.durationSubtract(r,i);if(e.operator==="*"&&this.isDayTimeDurationValue(r)&&!this.isDayTimeDurationValue(i)){let c=this.toNumericValue(i);return F.BuiltInFunctions.durationMultiply(r,c)}if(e.operator==="*"&&!this.isDayTimeDurationValue(r)&&this.isDayTimeDurationValue(i)){let c=this.toNumericValue(r);return F.BuiltInFunctions.durationMultiply(i,c)}if(e.operator==="/"&&this.isDayTimeDurationValue(r)&&!this.isDayTimeDurationValue(i)){let c=this.toNumericValue(i);if(c===0)throw new Mt("Division by zero");return F.BuiltInFunctions.durationDivide(r,c)}if(e.operator==="+"&&this.isYearMonthDurationValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.yearMonthDurationAdd(r,i);if(e.operator==="-"&&this.isYearMonthDurationValue(r)&&this.isYearMonthDurationValue(i))return F.BuiltInFunctions.yearMonthDurationSubtract(r,i);let s=this.toNumericValue(r),a=this.toNumericValue(i);switch(e.operator){case"+":return s+a;case"-":return s-a;case"*":return s*a;case"/":if(a===0)throw new Mt("Division by zero");return s/a;default:throw new Mt(`Unknown arithmetic operator: ${e.operator}`)}}isDayTimeDurationValue(e){return e instanceof Ts.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#dayTimeDuration":!1}isYearMonthDurationValue(e){return e instanceof Ts.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#yearMonthDuration":!1}toNumericValue(e){if(typeof e=="number")return e;if(e instanceof Ts.Literal){let t=e.datatype?.value||"";if(t.includes("#integer")||t.includes("#decimal")||t.includes("#double")||t.includes("#float")){let i=parseFloat(e.value);if(!isNaN(i))return i}let r=parseFloat(e.value);if(!isNaN(r))return r}if(typeof e=="string"){let t=parseFloat(e);if(!isNaN(t))return t}if(e&&typeof e=="object"&&"value"in e){let t=parseFloat(String(e.value));if(!isNaN(t))return t}throw new Mt(`Cannot convert to number: ${e}`)}isDateTimeValue(e){if(e instanceof Ts.Literal){let t=e.datatype?.value||"";return t.includes("#dateTime")||t.includes("#date")?!0:/^\d{4}-\d{2}-\d{2}(T|\s)/.test(e.value)}return typeof e=="string"?/^\d{4}-\d{2}-\d{2}(T|\s)/.test(e):!1}isDateValue(e){return e instanceof Ts.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#date":!1}isTimeValue(e){return e instanceof Ts.Literal?(e.datatype?.value||"")==="http://www.w3.org/2001/XMLSchema#time":!1}evaluateFunction(e,t){let r;if(typeof e.function=="string")r=e.function.toLowerCase();else if(e.function&&typeof e.function=="object"&&"value"in e.function){let i=e.function.value;r=((i.includes("#")?i.split("#").pop():i.split("/").pop())||i).toLowerCase()}else throw new Mt(`Unknown function format: ${e.function}`);switch(r){case"str":let i=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.str(i);case"lang":let s=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.lang(s);case"datatype":let a=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.datatype(a).value;case"bound":if(e.args[0].type==="variable"){let y=t.get(e.args[0].name);return F.BuiltInFunctions.bound(y)}return!0;case"isiri":case"isuri":let c=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isIRI(c);case"isblank":let u=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isBlank(u);case"isliteral":let l=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isLiteral(l);case"regex":let f=this.getStringValue(this.evaluateExpression(e.args[0],t)),h=this.getStringValue(this.evaluateExpression(e.args[1],t)),d=e.args[2]?this.getStringValue(this.evaluateExpression(e.args[2],t)):void 0;return F.BuiltInFunctions.regex(f,h,d);case"langmatches":let m=this.getStringValue(this.evaluateExpression(e.args[0],t)),_=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.langMatches(m,_);case"contains":let b=this.getStringValue(this.evaluateExpression(e.args[0],t)),C=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.contains(b,C);case"strstarts":let O=this.getStringValue(this.evaluateExpression(e.args[0],t)),I=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strStarts(O,I);case"strends":let L=this.getStringValue(this.evaluateExpression(e.args[0],t)),G=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strEnds(L,G);case"strlen":let W=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.strlen(W);case"ucase":let Fe=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.ucase(Fe);case"lcase":let Ze=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.lcase(Ze);case"substr":let ot=this.getStringValue(this.evaluateExpression(e.args[0],t)),B=Number(this.evaluateExpression(e.args[1],t));if(e.args[2]){let y=Number(this.evaluateExpression(e.args[2],t));return F.BuiltInFunctions.substr(ot,B,y)}return F.BuiltInFunctions.substr(ot,B);case"strbefore":let ue=this.getStringValue(this.evaluateExpression(e.args[0],t)),be=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strBefore(ue,be);case"strafter":let He=this.getStringValue(this.evaluateExpression(e.args[0],t)),qe=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.strAfter(He,qe);case"concat":let et=e.args.map(y=>this.getStringValue(this.evaluateExpression(y,t)));return F.BuiltInFunctions.concat(...et);case"replace":let Le=this.getStringValue(this.evaluateExpression(e.args[0],t)),je=this.getStringValue(this.evaluateExpression(e.args[1],t)),Re=this.getStringValue(this.evaluateExpression(e.args[2],t)),H=e.args[3]?this.getStringValue(this.evaluateExpression(e.args[3],t)):void 0;return F.BuiltInFunctions.replace(Le,je,Re,H);case"parsedate":let k=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.parseDate(k);case"datebefore":let Me=this.getStringValue(this.evaluateExpression(e.args[0],t)),Ge=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateBefore(Me,Ge);case"dateafter":let V=this.getStringValue(this.evaluateExpression(e.args[0],t)),de=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateAfter(V,de);case"dateinrange":let xe=this.getStringValue(this.evaluateExpression(e.args[0],t)),z=this.getStringValue(this.evaluateExpression(e.args[1],t)),Ce=this.getStringValue(this.evaluateExpression(e.args[2],t));return F.BuiltInFunctions.dateInRange(xe,z,Ce);case"datediffminutes":let Oe=this.getStringValue(this.evaluateExpression(e.args[0],t)),Se=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateDiffMinutes(Oe,Se);case"datediffhours":let De=this.getStringValue(this.evaluateExpression(e.args[0],t)),le=this.getStringValue(this.evaluateExpression(e.args[1],t));return F.BuiltInFunctions.dateDiffHours(De,le);case"year":case"years":{let y=this.evaluateExpression(e.args[0],t);return this.isYearMonthDurationValue(y)?F.BuiltInFunctions.durationYears(y):F.BuiltInFunctions.year(this.getStringValue(y))}case"month":case"months":{let y=this.evaluateExpression(e.args[0],t);return this.isYearMonthDurationValue(y)?F.BuiltInFunctions.durationMonths(y):F.BuiltInFunctions.month(this.getStringValue(y))}case"day":case"days":{let y=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(y)?F.BuiltInFunctions.durationDays(y):F.BuiltInFunctions.day(this.getStringValue(y))}case"hours":{let y=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(y)?F.BuiltInFunctions.durationHours(y):F.BuiltInFunctions.hours(this.getStringValue(y))}case"minutes":{let y=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(y)?F.BuiltInFunctions.durationMinutes(y):F.BuiltInFunctions.minutes(this.getStringValue(y))}case"seconds":{let y=this.evaluateExpression(e.args[0],t);return this.isDayTimeDurationValue(y)?F.BuiltInFunctions.durationSeconds(y):F.BuiltInFunctions.seconds(this.getStringValue(y))}case"timezone":let Ee=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.timezone(Ee);case"tz":let pe=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.tz(pe);case"adjust":{let y=this.evaluateExpression(e.args[0],t),x=e.args.length>1?this.evaluateExpression(e.args[1],t):void 0;return F.BuiltInFunctions.adjust(y,x)}case"now":return F.BuiltInFunctions.now();case"datetime":case"xsd:datetime":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdDateTime(this.getStringValue(y))}case"integer":case"xsd:integer":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdInteger(this.getStringValue(y))}case"decimal":case"xsd:decimal":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdDecimal(this.getStringValue(y))}case"daytimeduration":case"xsd:daytimeduration":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.xsdDayTimeDuration(this.getStringValue(y))}case"durationtodays":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToDays(y)}case"durationtohours":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToHours(y)}case"durationtominutes":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToMinutes(y)}case"durationtoseconds":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationToSeconds(y)}case"durationdays":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationDays(y)}case"durationhours":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationHours(y)}case"durationminutes":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationMinutes(y)}case"durationseconds":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationSeconds(y)}case"durationyears":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationYears(y)}case"durationmonths":{let y=this.evaluateExpression(e.args[0],t);return F.BuiltInFunctions.durationMonths(y)}case"datetimediff":{let y=this.evaluateExpression(e.args[0],t),x=this.evaluateExpression(e.args[1],t);return F.BuiltInFunctions.dateTimeDiff(y,x)}case"datetimeadd":{let y=this.evaluateExpression(e.args[0],t),x=this.evaluateExpression(e.args[1],t);return F.BuiltInFunctions.dateTimeAdd(y,x)}case"datetimesubtract":{let y=this.evaluateExpression(e.args[0],t),x=this.evaluateExpression(e.args[1],t);return F.BuiltInFunctions.dateTimeSubtract(y,x)}case"mstominutes":let Te=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.msToMinutes(Te);case"mstohours":let Ie=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.msToHours(Ie);case"mstoseconds":let X=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.msToSeconds(X);case"abs":let re=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.abs(re);case"round":let ne=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.round(ne);case"ceil":let J=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.ceil(J);case"floor":let Z=Number(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.floor(Z);case"rand":return F.BuiltInFunctions.rand();case"coalesce":for(let y of e.args)try{let x=this.evaluateExpression(y,t);if(x!=null)return x}catch{continue}return;case"if":if(!e.args||e.args.length!==3)throw new Mt("IF requires exactly 3 arguments");let ee=this.evaluateExpression(e.args[0],t);return this.toBoolean(ee)?this.evaluateExpression(e.args[1],t):this.evaluateExpression(e.args[2],t);case"encode_for_uri":let ie=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.encodeForUri(ie);case"isnumeric":let se=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isNumeric(se);case"haslangdir":let ae=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.hasLangdir(ae);case"istriple":let oe=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.isTriple(oe);case"sameterm":let Q=this.getTermFromExpression(e.args[0],t),ce=this.getTermFromExpression(e.args[1],t);return F.BuiltInFunctions.sameTerm(Q,ce);case"md5":let Ne=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.md5(Ne);case"sha1":let Pe=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha1(Pe);case"sha256":let we=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha256(we);case"sha384":let w=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha384(w);case"sha512":let E=this.getStringValue(this.evaluateExpression(e.args[0],t));return F.BuiltInFunctions.sha512(E);case"byuuid":return this.evaluateByUUID(e,t);case"subject":{let y=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.subject(y)}case"predicate":{let y=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.predicate(y)}case"object":{let y=this.getTermFromExpression(e.args[0],t);return F.BuiltInFunctions.object(y)}case"triple":{let y=this.getTermFromExpression(e.args[0],t),x=this.getTermFromExpression(e.args[1],t),U=this.getTermFromExpression(e.args[2],t);return F.BuiltInFunctions.triple(y,x,U)}default:throw new Mt(`Unknown function: ${r}`)}}getTermFromExpression(e,t){if(e.type==="variable")return t.get(e.name)}getStringValue(e){return e==null?"":typeof e=="object"&&"value"in e?String(e.value):String(e)}toBoolean(e){if(typeof e=="boolean")return e;if(typeof e=="number")return!isNaN(e)&&e!==0;if(typeof e=="string")return e.length>0;if(e instanceof Ts.Literal){let t=e.datatype?.value||"";if(t.includes("#boolean"))return e.value==="true"||e.value==="1";if(t.includes("#integer")||t.includes("#decimal")||t.includes("#double")||t.includes("#float")){let r=parseFloat(e.value);return!isNaN(r)&&r!==0}return e.value.length>0}return!!e}evaluateByUUID(e,t){if(!e.args||e.args.length!==1)throw new Mt("exo:byUUID requires exactly 1 argument (UUID string)");let r=this.evaluateExpression(e.args[0],t),i=this.getStringValue(r);if(!i)return;let s=i.toLowerCase();if(this.uuidCache.has(s))return this.uuidCache.get(s)??void 0;if(!this.tripleStore){this.uuidCache.set(s,null);return}if(this.tripleStore.findSubjectsByUUIDSync){let a=this.tripleStore.findSubjectsByUUIDSync(s);if(a.length===0){this.uuidCache.set(s,null);return}let c=a[0];return this.uuidCache.set(s,c),c}this.uuidCache.set(s,null)}cacheUUIDResult(e,t){let r=e.toLowerCase();this.uuidCache.set(r,t)}getCachedUUID(e){let t=e.toLowerCase();if(this.uuidCache.has(t))return this.uuidCache.get(t)}};_a.FilterExecutor=Qm});var Xm=v(Ol=>{"use strict";Object.defineProperty(Ol,"__esModule",{value:!0});Ol.OptionalExecutor=void 0;var Ym=class{static{o(this,"OptionalExecutor")}async*execute(e,t){let r=[];for await(let s of e)r.push(s);let i=[];for await(let s of t)i.push(s);for(let s of r){let a=!1;for(let c of i){let u=s.merge(c);u!==null&&(yield u,a=!0)}a||(yield s)}}async executeAll(e,t){let r=[];async function*i(){for(let a of e)yield a}o(i,"generateLeft");async function*s(){for(let a of t)yield a}o(s,"generateRight");for await(let a of this.execute(i(),s()))r.push(a);return r}};Ol.OptionalExecutor=Ym});var Zm=v(Dl=>{"use strict";Object.defineProperty(Dl,"__esModule",{value:!0});Dl.UnionExecutor=void 0;var Jm=class{static{o(this,"UnionExecutor")}async*execute(e,t){let r=new Set;for await(let i of e){let s=this.getSolutionKey(i);r.has(s)||(r.add(s),yield i)}for await(let i of t){let s=this.getSolutionKey(i);r.has(s)||(r.add(s),yield i)}}async executeAll(e,t){let r=[];async function*i(){for(let a of e)yield a}o(i,"generateLeft");async function*s(){for(let a of t)yield a}o(s,"generateRight");for await(let a of this.execute(i(),s()))r.push(a);return r}getSolutionKey(e){let t=e.toJSON();return Object.keys(t).sort().map(i=>`${i}=${t[i]}`).join("|")}};Dl.UnionExecutor=Jm});var ng=v(Il=>{"use strict";Object.defineProperty(Il,"__esModule",{value:!0});Il.ConstructExecutor=void 0;var FD=wi(),As=Xe(),eg=dt(),tg=Wt(),RD=vo(),rg=class{static{o(this,"ConstructExecutor")}async execute(e,t){let r=[],i=new Set;for(let s of t)for(let a of e)try{let c=this.instantiateTriple(a,s),u=`${c.subject.toString()}|${c.predicate.toString()}|${c.object.toString()}`;i.has(u)||(i.add(u),r.push(c))}catch{continue}return r}instantiateTriple(e,t){if(this.isPropertyPath(e.predicate))throw new Error("Property paths are not supported in CONSTRUCT templates");let r=this.instantiateElement(e.subject,t),i=this.instantiateElement(e.predicate,t),s=this.instantiateElement(e.object,t);return new FD.Triple(r,i,s)}isPropertyPath(e){return e.type==="path"}instantiateElement(e,t){if(e.type==="variable"){let r=t.get(e.value);if(!r)throw new Error(`Unbound variable: ${e.value}`);return r}if(e.type==="iri")return new As.IRI(e.value);if(e.type==="literal")return new eg.Literal(e.value,e.datatype?new As.IRI(e.datatype):void 0,e.language);if(e.type==="blank")return new tg.BlankNode(e.value);if(e.type==="quoted")return this.instantiateQuotedTriple(e,t);throw new Error(`Unknown element type: ${e.type}`)}instantiateQuotedTriple(e,t){let r=this.instantiateQuotedSubject(e.subject,t),i=this.instantiateQuotedPredicate(e.predicate,t),s=this.instantiateQuotedObject(e.object,t);return new RD.QuotedTriple(r,i,s)}instantiateQuotedSubject(e,t){if(e.type==="variable"){let r=t.get(e.value);if(!r)throw new Error(`Unbound variable in quoted triple subject: ${e.value}`);if(r instanceof eg.Literal)throw new Error("Literals cannot appear in quoted triple subject position");return r}if(e.type==="iri")return new As.IRI(e.value);if(e.type==="blank")return new tg.BlankNode(e.value);if(e.type==="quoted")return this.instantiateQuotedTriple(e,t);throw new Error(`Invalid element type for quoted triple subject: ${e.type}`)}instantiateQuotedPredicate(e,t){if(e.type==="variable"){let r=t.get(e.value);if(!r)throw new Error(`Unbound variable in quoted triple predicate: ${e.value}`);if(!(r instanceof As.IRI))throw new Error("Quoted triple predicate must be an IRI");return r}return new As.IRI(e.value)}instantiateQuotedObject(e,t){if(e.type==="variable"){let i=t.get(e.value);if(!i)throw new Error(`Unbound variable in quoted triple object: ${e.value}`);return i}if(e.type==="iri")return new As.IRI(e.value);if(e.type==="blank")return new tg.BlankNode(e.value);if(e.type==="literal")return new eg.Literal(e.value,e.datatype?new As.IRI(e.datatype):void 0,e.language);if(e.type==="quoted")return this.instantiateQuotedTriple(e,t);let r=e;throw new Error(`Invalid element type for quoted triple object: ${r.type}`)}};Il.ConstructExecutor=rg});var k3=v(Pl=>{"use strict";Object.defineProperty(Pl,"__esModule",{value:!0});Pl.DescribeExecutor=void 0;var N3=Xe(),ig=class{static{o(this,"DescribeExecutor")}constructor(e){this.tripleStore=e}async execute(e,t){let r=[],i=new Set,s=new Set,a=t?.depth;for(let c of e)await this.describeResourceWithDepth(c,a,1,t?.symmetric??!0,r,i,s);return r}async describeResourceWithDepth(e,t,r,i,s,a,c){let u=e.toString();if(c.has(u)||(c.add(u),t!==void 0&&r>t))return;let l=[],f=await this.tripleStore.match(e,void 0,void 0);if(l.push(...f),i){let d=await this.tripleStore.match(void 0,void 0,e);l.push(...d)}let h=[];for(let d of l){let m=`${d.subject.toString()}|${d.predicate.toString()}|${d.object.toString()}`;a.has(m)||(a.add(m),s.push(d),(t===void 0||r<t)&&(this.isIRI(d.subject)&&d.subject.toString()!==u&&h.push(d.subject),this.isIRI(d.object)&&d.object.toString()!==u&&h.push(d.object)))}for(let d of h)await this.describeResourceWithDepth(d,t,r+1,i,s,a,c)}isIRI(e){return e?e instanceof N3.IRI||e.termType==="NamedNode"||typeof e.value=="string"&&e.value.startsWith("http"):!1}async describeByIRI(e,t){let r=new N3.IRI(e);return this.execute([r],t)}};Pl.DescribeExecutor=ig});var L3=v(Fl=>{"use strict";Object.defineProperty(Fl,"__esModule",{value:!0});Fl.MinusExecutor=void 0;var sg=class{static{o(this,"MinusExecutor")}async*execute(e,t){let r=[];for await(let s of e)r.push(s);let i=[];for await(let s of t)i.push(s);for(let s of r){let a=!1;for(let c of i)if(this.areCompatible(s,c)){a=!0;break}a||(yield s)}}async executeAll(e,t){let r=[];async function*i(){for(let a of e)yield a}o(i,"generateLeft");async function*s(){for(let a of t)yield a}o(s,"generateRight");for await(let a of this.execute(i(),s()))r.push(a);return r}areCompatible(e,t){let r=e.variables(),i=new Set(t.variables()),s=r.filter(a=>i.has(a));if(s.length===0)return!1;for(let a of s){let c=e.get(a),u=t.get(a);if(c===void 0||u===void 0||c.toString()!==u.toString())return!1}return!0}};Fl.MinusExecutor=sg});var M3=v(ba=>{"use strict";Object.defineProperty(ba,"__esModule",{value:!0});ba.ValuesExecutor=ba.ValuesExecutorError=void 0;var ND=ci(),j3=Xe(),kD=dt(),Rl=class extends Error{static{o(this,"ValuesExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="ValuesExecutorError"}};ba.ValuesExecutorError=Rl;var ag=class{static{o(this,"ValuesExecutor")}async*execute(e){if(e.bindings.length!==0)for(let t of e.bindings)yield this.createSolutionMapping(t)}async executeAll(e){let t=[];for await(let r of this.execute(e))t.push(r);return t}createSolutionMapping(e){let t=new ND.SolutionMapping;for(let[r,i]of Object.entries(e)){let s=this.toRDFTerm(i);t.set(r,s)}return t}toRDFTerm(e){if(e.type==="iri")return new j3.IRI(e.value);if(e.type==="literal")return new kD.Literal(e.value,e.datatype?new j3.IRI(e.datatype):void 0,e.language,e.direction);throw new Rl(`Unknown term type: ${e.type}`)}};ba.ValuesExecutor=ag});var og=v(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});Ea.CustomAggregateRegistry=Ea.CustomAggregateError=void 0;var Sa=class extends Error{static{o(this,"CustomAggregateError")}constructor(e,t){super(e),this.iri=t,this.name="CustomAggregateError"}};Ea.CustomAggregateError=Sa;var Nl=class n{static{o(this,"CustomAggregateRegistry")}constructor(){this.aggregates=new Map}static getInstance(){return n.instance||(n.instance=new n),n.instance}static resetInstance(){n.instance&&n.instance.clear(),n.instance=null}register(e,t){if(!e||typeof e!="string")throw new Sa("Aggregate IRI must be a non-empty string");if(!t||typeof t.init!="function"||typeof t.step!="function"||typeof t.finalize!="function")throw new Sa("Aggregate must implement init(), step(), and finalize() methods",e);if(this.aggregates.has(e))throw new Sa(`Aggregate with IRI "${e}" is already registered`,e);this.aggregates.set(e,t)}unregister(e){return this.aggregates.delete(e)}get(e){return this.aggregates.get(e)}has(e){return this.aggregates.has(e)}getRegisteredIris(){return Array.from(this.aggregates.keys())}clear(){this.aggregates.clear()}get size(){return this.aggregates.size}};Ea.CustomAggregateRegistry=Nl;Nl.instance=null});var cg=v(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.BUILT_IN_AGGREGATES=ke.modeAggregate=ke.stddevAggregate=ke.varianceAggregate=ke.medianAggregate=ke.EXO_AGGREGATE_NS=void 0;ke.getNumericValue=kl;ke.createDecimalLiteral=pn;ke.createDoubleLiteral=MD;ke.createPercentileAggregate=xs;var Cs=dt(),Ta=Xe(),LD=new Ta.IRI("http://www.w3.org/2001/XMLSchema#decimal"),jD=new Ta.IRI("http://www.w3.org/2001/XMLSchema#double");ke.EXO_AGGREGATE_NS="https://exocortex.my/ontology/agg#";function kl(n){return n==null?NaN:typeof n=="number"?n:typeof n=="string"?parseFloat(n):n instanceof Cs.Literal?parseFloat(n.value):n instanceof Ta.IRI?NaN:typeof n=="boolean"?n?1:0:NaN}o(kl,"getNumericValue");function pn(n){return new Cs.Literal(String(n),LD)}o(pn,"createDecimalLiteral");function MD(n){return new Cs.Literal(String(n),jD)}o(MD,"createDoubleLiteral");ke.medianAggregate={init(){return{values:[]}},step(n,e){let t=n,r=kl(e);isNaN(r)||t.values.push(r)},finalize(n){let e=n,{values:t}=e;if(t.length===0)return pn(0);let r=[...t].sort((a,c)=>a-c),i=Math.floor(r.length/2),s=r.length%2!==0?r[i]:(r[i-1]+r[i])/2;return pn(s)}};ke.varianceAggregate={init(){return{values:[]}},step(n,e){let t=n,r=kl(e);isNaN(r)||t.values.push(r)},finalize(n){let e=n,{values:t}=e;if(t.length===0)return pn(0);let r=t.reduce((s,a)=>s+a,0)/t.length,i=t.reduce((s,a)=>s+Math.pow(a-r,2),0)/t.length;return pn(i)}};ke.stddevAggregate={init(){return{values:[]}},step(n,e){ke.varianceAggregate.step(n,e)},finalize(n){let e=n,{values:t}=e;if(t.length===0)return pn(0);let r=t.reduce((s,a)=>s+a,0)/t.length,i=t.reduce((s,a)=>s+Math.pow(a-r,2),0)/t.length;return pn(Math.sqrt(i))}};ke.modeAggregate={init(){return{counts:new Map,values:new Map}},step(n,e){if(e==null)return;let t=n,r=String(e instanceof Cs.Literal||e instanceof Ta.IRI?e.value:e),i=t.counts.get(r)||0;t.counts.set(r,i+1),t.values.set(r,e)},finalize(n){let e=n;if(e.counts.size===0)return new Cs.Literal(" ",new Ta.IRI("http://www.w3.org/2001/XMLSchema#string"));let t="",r=0;for(let[a,c]of e.counts)c>r&&(r=c,t=a);let i=e.values.get(t);if(i instanceof Cs.Literal)return i;let s=parseFloat(t);return isNaN(s)?new Cs.Literal(t,new Ta.IRI("http://www.w3.org/2001/XMLSchema#string")):pn(s)}};function xs(n){let e=Math.max(0,Math.min(100,n))/100;return{init(){return{values:[],percentile:e}},step(t,r){let i=t,s=kl(r);isNaN(s)||i.values.push(s)},finalize(t){let r=t,{values:i}=r;if(i.length===0)return pn(0);let s=[...i].sort((h,d)=>h-d),a=r.percentile*(s.length-1),c=Math.floor(a),u=Math.ceil(a);if(c===u)return pn(s[c]);let l=a-c,f=s[c]*(1-l)+s[u]*l;return pn(f)}}}o(xs,"createPercentileAggregate");ke.BUILT_IN_AGGREGATES={[`${ke.EXO_AGGREGATE_NS}median`]:ke.medianAggregate,[`${ke.EXO_AGGREGATE_NS}variance`]:ke.varianceAggregate,[`${ke.EXO_AGGREGATE_NS}stddev`]:ke.stddevAggregate,[`${ke.EXO_AGGREGATE_NS}mode`]:ke.modeAggregate,[`${ke.EXO_AGGREGATE_NS}percentile25`]:xs(25),[`${ke.EXO_AGGREGATE_NS}percentile50`]:xs(50),[`${ke.EXO_AGGREGATE_NS}percentile75`]:xs(75),[`${ke.EXO_AGGREGATE_NS}percentile90`]:xs(90),[`${ke.EXO_AGGREGATE_NS}percentile95`]:xs(95),[`${ke.EXO_AGGREGATE_NS}percentile99`]:xs(99)}});var B3=v(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});Aa.AggregateExecutor=Aa.AggregateExecutorError=void 0;var St=dt(),lg=Xe(),VD=Cl(),$D=og(),BD=cg(),V3=new lg.IRI("http://www.w3.org/2001/XMLSchema#integer"),Os=new lg.IRI("http://www.w3.org/2001/XMLSchema#decimal"),Nn=new lg.IRI("http://www.w3.org/2001/XMLSchema#string");function $3(n){return typeof n=="object"&&n.type==="custom"}o($3,"isCustomAggregation");var Bo=class extends Error{static{o(this,"AggregateExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="AggregateExecutorError"}};Aa.AggregateExecutorError=Bo;var ug=class{static{o(this,"AggregateExecutor")}constructor(){this.filterExecutor=new VD.FilterExecutor}execute(e,t){let r=this.groupSolutions(t,e.variables),i=[];for(let[s,a]of r.entries()){let c=new Map;for(let f of e.variables)if(a.length>0){let h=a[0].get(f);h&&c.set(f,h)}for(let f of e.aggregates){let h=this.computeAggregate(f.expression,a);c.set(f.variable,h)}let{SolutionMapping:u}=ci(),l=new u;for(let[f,h]of c.entries())l.set(f,h);i.push(l)}if(i.length===0&&e.aggregates.length>0){let s=this.createEmptyAggregateResult(e);s&&i.push(s)}return i}groupSolutions(e,t){let r=new Map;if(t.length===0)return r.set("",e),r;for(let i of e){let s=this.computeGroupKey(i,t),a=r.get(s);a?a.push(i):r.set(s,[i])}return r}computeGroupKey(e,t){return t.map(r=>{let i=e.get(r);return i?this.termToString(i):""}).join("|")}termToString(e){if(e&&typeof e=="object"){if("value"in e)return String(e.value);if("id"in e)return String(e.id)}return String(e)}computeAggregate(e,t){if($3(e.aggregation))return this.computeCustomAggregate(e,t);let r=this.extractValues(e,t),i=e.aggregation;switch(i){case"count":{let s=this.computeCount(r,e.distinct);return new St.Literal(String(s),V3)}case"sum":{let s=this.computeSum(r);return new St.Literal(String(s),Os)}case"avg":{let s=this.computeAvg(r);return new St.Literal(String(s),Os)}case"min":{let s=this.computeMin(r);return s===void 0?new St.Literal("",Nn):typeof s=="number"?new St.Literal(String(s),Os):new St.Literal(String(s),Nn)}case"max":{let s=this.computeMax(r);return s===void 0?new St.Literal("",Nn):typeof s=="number"?new St.Literal(String(s),Os):new St.Literal(String(s),Nn)}case"group_concat":{let s=this.computeGroupConcat(r,e.separator||" ",e.distinct);return new St.Literal(s||" ",Nn)}case"sample":{let s=this.computeSample(r,e.distinct);return s===void 0?new St.Literal(" ",Nn):typeof s=="number"?new St.Literal(String(s),Os):new St.Literal(String(s),Nn)}default:{let s=i;throw new Bo(`Unknown aggregation function: ${s}`)}}}computeCustomAggregate(e,t){let i=e.aggregation.iri,a=$D.CustomAggregateRegistry.getInstance().get(i);if(a||(a=BD.BUILT_IN_AGGREGATES[i]),!a)throw new Bo(`Unknown custom aggregate function: ${i}. Register it with CustomAggregateRegistry.getInstance().register() or use a built-in aggregate.`);let c=a.init();for(let u of t){let l=null;if(e.expression){let f=this.evaluateExpression(e.expression,u);f!==void 0&&(l=f)}else l=1;a.step(c,l)}return a.finalize(c)}extractValues(e,t){if(!e.expression)return t.map(()=>1);let r=[];for(let i of t){let s=this.evaluateExpression(e.expression,i);s!=null&&r.push(s)}return r}evaluateExpression(e,t){if(e.type==="variable"){let r=t.get(e.name);return r==null?void 0:typeof r=="number"||typeof r=="string"||typeof r=="boolean"?r:typeof r=="object"&&"value"in r?r.value:r}if(e.type==="literal")return e.value;try{return this.filterExecutor.evaluateExpression(e,t)}catch{return}}computeCount(e,t){return t?new Set(e.map(r=>String(r))).size:e.length}computeSum(e){return e.map(r=>parseFloat(String(r))).filter(r=>!isNaN(r)).reduce((r,i)=>r+i,0)}computeAvg(e){let t=e.map(r=>parseFloat(String(r))).filter(r=>!isNaN(r));return t.length===0?0:t.reduce((r,i)=>r+i,0)/t.length}computeMin(e){if(e.length===0)return;let t=e.map(i=>parseFloat(String(i))).filter(i=>!isNaN(i));if(t.length>0)return Math.min(...t);let r=e.map(i=>String(i));return r.reduce((i,s)=>s<i?s:i,r[0])}computeMax(e){if(e.length===0)return;let t=e.map(i=>parseFloat(String(i))).filter(i=>!isNaN(i));if(t.length>0)return Math.max(...t);let r=e.map(i=>String(i));return r.reduce((i,s)=>s>i?s:i,r[0])}computeGroupConcat(e,t,r){let i=e.map(s=>String(s));return r&&(i=[...new Set(i)]),i.join(t)}computeSample(e,t){if(e.length===0)return;if(t){let s=[...new Set(e.map(u=>String(u)))];if(s.length===0)return;let a=s[0],c=parseFloat(a);return isNaN(c)?a:c}let r=e[0];if(typeof r=="number")return r;let i=parseFloat(String(r));return isNaN(i)?String(r):i}createEmptyAggregateResult(e){let{SolutionMapping:t}=ci(),r=new t;for(let i of e.aggregates){let s=i.expression.aggregation;if($3(s)){r.set(i.variable,new St.Literal("0",Os));continue}switch(s){case"count":r.set(i.variable,new St.Literal("0",V3));break;case"sum":case"avg":r.set(i.variable,new St.Literal("0",Os));break;case"group_concat":r.set(i.variable,new St.Literal(" ",Nn));break;case"min":case"max":case"sample":r.set(i.variable,new St.Literal("",Nn));break;default:r.set(i.variable,new St.Literal("",Nn))}}return r}};Aa.AggregateExecutor=ug});var q3=v(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.ServiceExecutor=xa.ServiceExecutorError=void 0;var UD=ci(),U3=Xe(),qD=dt(),GD=Wt(),Ds=class extends Error{static{o(this,"ServiceExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="ServiceExecutorError"}};xa.ServiceExecutorError=Ds;var fg=class{static{o(this,"ServiceExecutor")}constructor(e={}){this.timeout=e.timeout??3e4,this.httpClient=e.httpClient??((t,r)=>fetch(t,r)),this.maxRetries=e.maxRetries??2,this.retryDelay=e.retryDelay??1e3}async*execute(e,t){try{let r=t(e.pattern),i=await this.executeRemoteQuery(e.endpoint,r);for(let s of i)yield s}catch(r){if(e.silent)return;throw r}}async executeRemoteQuery(e,t){let r;for(let i=0;i<=this.maxRetries;i++)try{let s=new AbortController,a=setTimeout(()=>s.abort(),this.timeout);try{let c=await this.httpClient(e,{method:"POST",headers:{"Content-Type":"application/sparql-query",Accept:"application/sparql-results+json"},body:t,signal:s.signal});if(!c.ok)throw new Ds(`Remote SPARQL endpoint returned ${c.status}: ${c.statusText}`);let u=await c.json();return this.parseJsonResults(u)}finally{clearTimeout(a)}}catch(s){if(r=s instanceof Error?s:new Error(String(s)),this.isRetryableError(r)&&i<this.maxRetries){await this.delay(this.retryDelay);continue}throw new Ds(`Failed to query remote SPARQL endpoint ${e}: ${r.message}`,r)}throw new Ds(`Failed to query remote SPARQL endpoint ${e} after ${this.maxRetries+1} attempts`,r)}parseJsonResults(e){return!e.results||!Array.isArray(e.results.bindings)?[]:e.results.bindings.map(t=>this.parseBinding(t))}parseBinding(e){let t=new UD.SolutionMapping;for(let[r,i]of Object.entries(e)){let s=this.parseRDFTerm(i);t.set(r,s)}return t}parseRDFTerm(e){switch(e.type){case"uri":return new U3.IRI(e.value);case"literal":{let t=e.datatype?new U3.IRI(e.datatype):void 0;return new qD.Literal(e.value,t,e["xml:lang"])}case"bnode":return new GD.BlankNode(e.value);default:throw new Ds(`Unknown RDF term type: ${e.type}`)}}isRetryableError(e){let t=e.message.toLowerCase();return!!(e.name==="AbortError"||t.includes("network")||t.includes("econnreset")||t.includes("econnrefused")||t.includes("etimedout")||t.includes("returned 5"))}delay(e){return new Promise(t=>setTimeout(t,e))}};xa.ServiceExecutor=fg});var W3=v(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.GraphExecutor=Ca.GraphExecutorError=void 0;var G3=Xe(),Ll=class extends Error{static{o(this,"GraphExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="GraphExecutorError"}};Ca.GraphExecutorError=Ll;var hg=class{static{o(this,"GraphExecutor")}constructor(e){this.tripleStore=e}async*execute(e,t,r){let i=e.name;if(i.type==="iri")yield*this.executeWithGraph(e.pattern,i,t);else if(i.type==="variable")yield*this.executeWithGraphVariable(e,i,t,r);else throw new Ll(`Invalid graph name type: ${i.type}`)}async*executeWithGraph(e,t,r){let i=new G3.IRI(t.value);this.tripleStore.hasGraph&&!await this.tripleStore.hasGraph(i)||(yield*r(e,i))}async*executeWithGraphVariable(e,t,r,i){if(i){let a=i.get(t.value);if(a&&a instanceof G3.IRI){yield*this.executeWithGraph(e.pattern,{type:"iri",value:a.value},r);return}}if(!this.tripleStore.getNamedGraphs)return;let s=await this.tripleStore.getNamedGraphs();for(let a of s)for await(let c of r(e.pattern,a)){let u=c.clone();u.set(t.value,a),yield u}}};Ca.GraphExecutor=hg});var z3=v(Da=>{"use strict";Object.defineProperty(Da,"__esModule",{value:!0});Da.SPARQLGenerator=Da.SPARQLGeneratorError=void 0;var Oa=class extends Error{static{o(this,"SPARQLGeneratorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="SPARQLGeneratorError"}};Da.SPARQLGeneratorError=Oa;var dg=class{static{o(this,"SPARQLGenerator")}collectVariables(e){let t=new Set;return this.collectVariablesFromOperation(e,t),t}generateSelect(e){let t=this.collectVariables(e),r=t.size>0?Array.from(t).map(s=>`?${s}`).join(" "):"*",i=this.generateWhereClause(e);return`SELECT ${r} WHERE {
${i}
}`}generateWhereClause(e,t=2){let r=" ".repeat(t);switch(e.type){case"bgp":return this.generateBGP(e,t);case"filter":return`${this.generateWhereClause(e.input,t)}
${r}FILTER(${this.generateExpression(e.expression)})`;case"join":return`${this.generateWhereClause(e.left,t)}
${this.generateWhereClause(e.right,t)}`;case"leftjoin":{let i=this.generateWhereClause(e.left,t),s=this.generateWhereClause(e.right,t+2);return`${i}
${r}OPTIONAL {
${s}
${r}}`}case"union":{let i=this.generateWhereClause(e.left,t+2),s=this.generateWhereClause(e.right,t+2);return`${r}{
${i}
${r}}
${r}UNION
${r}{
${s}
${r}}`}case"values":return this.generateValues(e,t);case"extend":{let i=this.generateWhereClause(e.input,t),s=this.generateExpression(e.expression);return`${i}
${r}BIND(${s} AS ?${e.variable})`}case"project":case"distinct":case"reduced":return this.generateWhereClause(e.input,t);case"orderby":case"slice":case"group":return this.generateWhereClause(e.input,t);case"subquery":{let s=this.generateSelect(e.query).split(`
`).map(a=>r+a).join(`
`);return`${r}{
${s}
${r}}`}default:throw new Oa(`Unsupported operation type for SPARQL generation: ${e.type}`)}}generateBGP(e,t){let r=" ".repeat(t);return e.triples.map(i=>`${r}${this.generateTriple(i)} .`).join(`
`)}generateTriple(e){let t=this.generateElement(e.subject),r=this.generatePredicate(e.predicate),i=this.generateElement(e.object);return`${t} ${r} ${i}`}generatePredicate(e){return"pathType"in e?this.generatePropertyPath(e):this.generateElement(e)}generatePropertyPath(e){let t=e.items.map(r=>"pathType"in r?`(${this.generatePropertyPath(r)})`:`<${r.value}>`);switch(e.pathType){case"/":return t.join("/");case"|":return t.join("|");case"^":return`^${t[0]}`;case"+":return`${t[0]}+`;case"*":return`${t[0]}*`;case"?":return`${t[0]}?`}}generateElement(e){switch(e.type){case"variable":return`?${e.value}`;case"iri":return`<${e.value}>`;case"literal":{let r=`"${e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")}"`;return e.language?r+=`@${e.language}`:e.datatype&&(r+=`^^<${e.datatype}>`),r}case"blank":return`_:${e.value}`;default:throw new Oa(`Unknown element type: ${e.type}`)}}generateValues(e,t){let r=" ".repeat(t);if(e.variables.length===0||e.bindings.length===0)return"";if(e.variables.length===1){let a=e.variables[0],c=e.bindings.map(u=>{let l=u[a];return l?this.generateValuesTerm(l):"UNDEF"}).join(" ");return`${r}VALUES ?${a} { ${c} }`}let i=e.variables.map(a=>`?${a}`).join(" "),s=e.bindings.map(a=>`(${e.variables.map(u=>{let l=a[u];return l?this.generateValuesTerm(l):"UNDEF"}).join(" ")})`);return`${r}VALUES (${i}) {
${s.map(a=>`${r}  ${a}`).join(`
`)}
${r}}`}generateValuesTerm(e){if(e.type==="iri")return`<${e.value}>`;let r=`"${e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`;return e.language?r+=`@${e.language}`:e.datatype&&(r+=`^^<${e.datatype}>`),r}generateExpression(e){switch(e.type){case"variable":return`?${e.name}`;case"literal":return typeof e.value=="string"?`"${e.value.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:typeof e.value=="boolean"?e.value?"true":"false":String(e.value);case"comparison":return`(${this.generateExpression(e.left)} ${e.operator} ${this.generateExpression(e.right)})`;case"logical":return e.operator==="!"?`!(${this.generateExpression(e.operands[0])})`:`(${e.operands.map(t=>this.generateExpression(t)).join(` ${e.operator} `)})`;case"arithmetic":return`(${this.generateExpression(e.left)} ${e.operator} ${this.generateExpression(e.right)})`;case"function":return`${e.function.toUpperCase()}(${e.args.map(t=>this.generateExpression(t)).join(", ")})`;case"functionCall":return`${(typeof e.function=="string"?e.function:e.function.value).toUpperCase()}(${e.args.map(r=>this.generateExpression(r)).join(", ")})`;case"exists":return`${e.negated?"NOT EXISTS":"EXISTS"} { ${this.generateWhereClause(e.pattern,0)} }`;case"in":{let t=this.generateExpression(e.expression),r=e.list.map(i=>this.generateExpression(i)).join(", ");return e.negated?`${t} NOT IN (${r})`:`${t} IN (${r})`}default:throw new Oa(`Unknown expression type: ${e.type}`)}}collectVariablesFromOperation(e,t){switch(e.type){case"bgp":for(let r of e.triples)this.collectVariablesFromTriple(r,t);break;case"filter":this.collectVariablesFromOperation(e.input,t),this.collectVariablesFromExpression(e.expression,t);break;case"join":case"leftjoin":case"union":case"minus":this.collectVariablesFromOperation(e.left,t),this.collectVariablesFromOperation(e.right,t);break;case"values":for(let r of e.variables)t.add(r);break;case"project":for(let r of e.variables)t.add(r);this.collectVariablesFromOperation(e.input,t);break;case"extend":t.add(e.variable),this.collectVariablesFromOperation(e.input,t);break;case"orderby":case"slice":case"distinct":case"reduced":this.collectVariablesFromOperation(e.input,t);break;case"group":for(let r of e.variables)t.add(r);for(let r of e.aggregates)t.add(r.variable);this.collectVariablesFromOperation(e.input,t);break;case"subquery":this.collectVariablesFromOperation(e.query,t);break}}collectVariablesFromTriple(e,t){e.subject.type==="variable"&&t.add(e.subject.value),"type"in e.predicate&&e.predicate.type==="variable"&&t.add(e.predicate.value),e.object.type==="variable"&&t.add(e.object.value)}collectVariablesFromExpression(e,t){switch(e.type){case"variable":t.add(e.name);break;case"comparison":case"arithmetic":this.collectVariablesFromExpression(e.left,t),this.collectVariablesFromExpression(e.right,t);break;case"logical":for(let r of e.operands)this.collectVariablesFromExpression(r,t);break;case"function":case"functionCall":for(let r of e.args)this.collectVariablesFromExpression(r,t);break;case"exists":this.collectVariablesFromOperation(e.pattern,t);break;case"in":this.collectVariablesFromExpression(e.expression,t);for(let r of e.list)this.collectVariablesFromExpression(r,t);break}}};Da.SPARQLGenerator=dg});var H3=v($r=>{"use strict";var WD=$r&&$r.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),zD=$r&&$r.__setModuleDefault||(Object.create?(function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}):function(n,e){n.default=e}),HD=$r&&$r.__importStar||(function(){var n=o(function(e){return n=Object.getOwnPropertyNames||function(t){var r=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[r.length]=i);return r},n(e)},"ownKeys");return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=n(e),i=0;i<r.length;i++)r[i]!=="default"&&WD(t,e,r[i]);return zD(t,e),t}})();Object.defineProperty($r,"__esModule",{value:!0});$r.QueryExecutor=$r.QueryExecutorError=void 0;var KD=zm(),QD=Cl(),YD=Xm(),XD=Zm(),JD=L3(),ZD=M3(),eI=B3(),tI=ng(),rI=q3(),nI=W3(),iI=z3(),sI=Xe(),Ia=class extends Error{static{o(this,"QueryExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="QueryExecutorError"}};$r.QueryExecutorError=Ia;var pg=class{static{o(this,"QueryExecutor")}constructor(e,t={}){this.tripleStore=e,this.bgpExecutor=new KD.BGPExecutor(e),this.filterExecutor=new QD.FilterExecutor,this.optionalExecutor=new YD.OptionalExecutor,this.unionExecutor=new XD.UnionExecutor,this.minusExecutor=new JD.MinusExecutor,this.valuesExecutor=new ZD.ValuesExecutor,this.aggregateExecutor=new eI.AggregateExecutor,this.constructExecutor=new tI.ConstructExecutor,this.serviceExecutor=new rI.ServiceExecutor(t.serviceConfig),this.graphExecutor=new nI.GraphExecutor(e),this.sparqlGenerator=new iI.SPARQLGenerator,this.filterExecutor.setExistsEvaluator(async(r,i)=>this.evaluateExistsPattern(r,i)),this.filterExecutor.setTripleStore(e)}async evaluateExistsPattern(e,t){for await(let r of this.execute(e))if(t.merge(r)!==null)return!0;return!1}async executeAll(e){let t=[];for await(let r of this.execute(e))t.push(r);return t}async*execute(e){switch(e.type){case"bgp":yield*this.executeBGP(e);break;case"filter":yield*this.executeFilter(e);break;case"join":yield*this.executeJoin(e);break;case"leftjoin":yield*this.executeLeftJoin(e);break;case"union":yield*this.executeUnion(e);break;case"minus":yield*this.executeMinus(e);break;case"values":yield*this.executeValues(e);break;case"project":yield*this.executeProject(e);break;case"orderby":yield*this.executeOrderBy(e);break;case"slice":yield*this.executeSlice(e);break;case"distinct":yield*this.executeDistinct(e);break;case"reduced":yield*this.executeReduced(e);break;case"group":yield*this.executeGroup(e);break;case"extend":yield*this.executeExtend(e);break;case"subquery":yield*this.executeSubquery(e);break;case"lateraljoin":yield*this.executeLateralJoin(e);break;case"service":yield*this.executeService(e);break;case"graph":yield*this.executeGraph(e);break;default:throw new Ia(`Unknown operation type: ${e.type}`)}}async*executeBGP(e){yield*this.bgpExecutor.execute(e)}async*executeFilter(e){let t=this.execute(e.input);yield*this.filterExecutor.execute(e,t)}async*executeJoin(e){let t=[];for await(let r of this.execute(e.left))t.push(r);for(let r of t)for await(let i of this.execute(e.right)){let s=r.merge(i);s!==null&&(yield s)}}async*executeLeftJoin(e){let t=[];for await(let a of this.execute(e.left))t.push(a);let r=[];for await(let a of this.execute(e.right))r.push(a);async function*i(){for(let a of t)yield a}o(i,"leftGen");async function*s(){for(let a of r)yield a}o(s,"rightGen"),yield*this.optionalExecutor.execute(i(),s())}async*executeUnion(e){let t=[];for await(let a of this.execute(e.left))t.push(a);let r=[];for await(let a of this.execute(e.right))r.push(a);async function*i(){for(let a of t)yield a}o(i,"leftGen");async function*s(){for(let a of r)yield a}o(s,"rightGen"),yield*this.unionExecutor.execute(i(),s())}async*executeMinus(e){let t=[];for await(let a of this.execute(e.left))t.push(a);let r=[];for await(let a of this.execute(e.right))r.push(a);async function*i(){for(let a of t)yield a}o(i,"leftGen");async function*s(){for(let a of r)yield a}o(s,"rightGen"),yield*this.minusExecutor.execute(i(),s())}async*executeValues(e){yield*this.valuesExecutor.execute(e)}async*executeProject(e){for await(let t of this.execute(e.input))yield t}async*executeOrderBy(e){let t=[];for await(let r of this.execute(e.input))t.push(r);t.sort((r,i)=>{for(let s of e.comparators){let a=this.getExpressionValue(s.expression,r),c=this.getExpressionValue(s.expression,i),u=0;if(a===void 0&&c===void 0?u=0:a===void 0?u=1:c===void 0?u=-1:typeof a=="number"&&typeof c=="number"?u=a-c:u=String(a).localeCompare(String(c)),s.descending&&(u=-u),u!==0)return u}return 0});for(let r of t)yield r}async*executeSlice(e){let t=0,r=e.offset??0,i=e.limit;for await(let s of this.execute(e.input)){if(t>=r){if(i!==void 0&&t-r>=i)break;yield s}t++}}async*executeDistinct(e){let t=new Set;for await(let r of this.execute(e.input)){let i=this.getSolutionKey(r);t.has(i)||(t.add(i),yield r)}}async*executeReduced(e){let t=new Set;for await(let r of this.execute(e.input)){let i=this.getSolutionKey(r);t.has(i)||(t.add(i),yield r)}}async*executeGroup(e){let t=[];for await(let i of this.execute(e.input))t.push(i);let r=this.aggregateExecutor.execute(e,t);for(let i of r)yield i}async*executeExtend(e){for await(let t of this.execute(e.input)){let r=t.clone(),i=this.evaluateExtendExpression(e.expression,t);i!==void 0&&r.set(e.variable,i),yield r}}async*executeSubquery(e){yield*this.execute(e.query)}async*executeLateralJoin(e){let t=[];for await(let r of this.execute(e.left))t.push(r);for(let r of t){let i=this.substituteVariables(e.right,r);for await(let s of this.execute(i)){let a=r.merge(s);a!==null&&(yield a)}}}substituteVariables(e,t){let r=JSON.parse(JSON.stringify(e));return this.substituteInOperation(r,t)}substituteInOperation(e,t){return!e||typeof e!="object"?e:e.type==="bgp"&&e.triples?(e.triples=e.triples.map(r=>this.substituteInTriple(r,t)),e):(e.input&&(e.input=this.substituteInOperation(e.input,t)),e.left&&(e.left=this.substituteInOperation(e.left,t)),e.right&&(e.right=this.substituteInOperation(e.right,t)),e.pattern&&(e.pattern=this.substituteInOperation(e.pattern,t)),e.query&&(e.query=this.substituteInOperation(e.query,t)),e.where&&(e.where=this.substituteInOperation(e.where,t)),e)}substituteInTriple(e,t){return{subject:this.substituteInTripleElement(e.subject,t),predicate:e.predicate,object:this.substituteInTripleElement(e.object,t)}}substituteInTripleElement(e,t){if(e&&e.type==="variable"){let r=t.get(e.value);if(r){if(r instanceof sI.IRI||r.termType==="NamedNode")return{type:"iri",value:r.value};if(r.termType==="Literal"||typeof r.value=="string"){let i=r;return{type:"literal",value:i.value,datatype:i.datatype?.value||i._datatype?.value,language:i.language||i._language}}}}return e}async*executeService(e){yield*this.serviceExecutor.execute(e,t=>this.sparqlGenerator.generateSelect(t))}async*executeGraph(e){let t=async function*(r,i){let s=this.currentGraphContext;this.currentGraphContext=i;try{r.type==="bgp"&&i&&this.tripleStore.matchInGraph?yield*this.executeBGPInGraph(r,i):yield*this.execute(r)}finally{this.currentGraphContext=s}}.bind(this);yield*this.graphExecutor.execute(e,t)}async*executeBGPInGraph(e,t){if(e.triples.length===0){let{SolutionMapping:r}=await Promise.resolve().then(()=>HD(ci()));yield new r;return}yield*this.bgpExecutor.executeInGraph(e,t)}evaluateExtendExpression(e,t){if(e.type!=="aggregate")try{return this.filterExecutor.evaluateExpression(e,t)}catch{return}}getExpressionValue(e,t){if(e.type==="variable"){let r=t.get(e.name);return r?r.value??r.id??String(r):void 0}return e.value}getSolutionKey(e){let t=e.toJSON();return Object.keys(t).sort().map(i=>`${i}=${t[i]}`).join("|")}isConstructQuery(e){return e.type==="construct"}async executeConstruct(e){if(e.type!=="construct")throw new Ia("executeConstruct requires a CONSTRUCT operation");let t=await this.executeAll(e.where);return this.constructExecutor.execute(e.template,t)}isAskQuery(e){return e.type==="ask"}async executeAsk(e){if(e.type!=="ask")throw new Ia("executeAsk requires an ASK operation");for await(let t of this.execute(e.where))return!0;return!1}};$r.QueryExecutor=pg});var Q3=v(Fa=>{"use strict";Object.defineProperty(Fa,"__esModule",{value:!0});Fa.UpdateExecutor=Fa.UpdateExecutorError=void 0;var aI=wi(),Pa=Xe(),mg=dt(),K3=Wt(),Qt=class extends Error{static{o(this,"UpdateExecutorError")}constructor(e,t){super(e,t?{cause:t}:void 0),this.name="UpdateExecutorError"}};Fa.UpdateExecutorError=Qt;var gg=class{static{o(this,"UpdateExecutor")}constructor(e){this.tripleStore=e}async execute(e){if(e.type!=="update")throw new Qt("Expected UPDATE request");let t=[];for(let r of e.updates){let i=await this.executeOperation(r);t.push(i)}return t}async executeOperation(e){if("updateType"in e)switch(e.updateType){case"insert":return this.executeInsertData(e);case"delete":return this.executeDeleteData(e);case"insertdelete":throw new Qt("INSERT/DELETE with WHERE clause not yet implemented");case"deletewhere":throw new Qt("DELETE WHERE not yet implemented");default:throw new Qt(`Unknown update type: ${e.updateType}`)}if("type"in e)switch(e.type){case"clear":case"drop":case"load":case"create":case"copy":case"move":case"add":throw new Qt(`${e.type.toUpperCase()} operation not yet implemented`);default:throw new Qt(`Unknown operation type: ${e.type}`)}throw new Qt("Unknown update operation structure")}async executeInsertData(e){if(e.updateType!=="insert")throw new Qt("Expected INSERT DATA operation");let t=e,r=0;for(let i of t.insert)if(i.type==="bgp"){let s=this.resolveGraphName(t.graph);r+=await this.insertTriples(i.triples,s)}else if(i.type==="graph"){let s=i,a=this.parseGraphName(s.name);r+=await this.insertTriples(s.triples,a)}return{type:"insert",inserted:r,success:!0}}async executeDeleteData(e){if(e.updateType!=="delete")throw new Qt("Expected DELETE DATA operation");let t=e,r=0;for(let i of t.delete)if(i.type==="bgp"){let s=this.resolveGraphName(t.graph);r+=await this.deleteTriples(i.triples,s)}else if(i.type==="graph"){let s=i,a=this.parseGraphName(s.name);r+=await this.deleteTriples(s.triples,a)}return{type:"delete",deleted:r,success:!0}}async insertTriples(e,t){let r=0;for(let i of e){let s=this.convertTriple(i);t&&this.tripleStore.addToGraph?await this.tripleStore.addToGraph(s,t):await this.tripleStore.add(s),r++}return r}async deleteTriples(e,t){let r=0;for(let i of e){let s=this.convertTriple(i),a;t&&this.tripleStore.removeFromGraph?a=await this.tripleStore.removeFromGraph(s,t):a=await this.tripleStore.remove(s),a&&r++}return r}convertTriple(e){return new aI.Triple(this.convertSubject(e.subject),this.convertPredicate(e.predicate),this.convertObject(e.object))}convertSubject(e){if(e.termType==="NamedNode")return new Pa.IRI(e.value);if(e.termType==="BlankNode")return new K3.BlankNode(e.value);throw new Qt(`Invalid subject term type: ${e.termType}. Variables are not allowed in INSERT DATA.`)}convertPredicate(e){if("termType"in e&&e.termType==="NamedNode")return new Pa.IRI(e.value);throw new Qt("Invalid predicate term type. Only IRIs are allowed in INSERT DATA.")}convertObject(e){if(e.termType==="NamedNode")return new Pa.IRI(e.value);if(e.termType==="BlankNode")return new K3.BlankNode(e.value);if(e.termType==="Literal"){let t=e;return t.language?new mg.Literal(t.value,void 0,t.language):t.datatype?new mg.Literal(t.value,new Pa.IRI(t.datatype.value)):new mg.Literal(t.value)}throw new Qt(`Invalid object term type: ${e.termType}. Variables are not allowed in INSERT DATA.`)}resolveGraphName(e){if(e&&!e.default&&e.name)return new Pa.IRI(e.name.value)}parseGraphName(e){if(e.termType==="Variable")throw new Qt("Variables are not allowed as graph names in INSERT DATA / DELETE DATA.");return new Pa.IRI(e.value)}};Fa.UpdateExecutor=gg});var X3=v(jl=>{"use strict";Object.defineProperty(jl,"__esModule",{value:!0});jl.AggregateFunctions=void 0;var yg=dt(),Y3=Xe(),vg=class{static{o(this,"AggregateFunctions")}static count(e,t){if(!t)return e.length;let r=0;for(let i of e)i.has(t)&&r++;return r}static countDistinct(e,t){let r=new Set;for(let i of e){let s=i.get(t);s&&r.add(s.toString())}return r.size}static sum(e,t){let r=0;for(let i of e){let s=i.get(t);if(s instanceof yg.Literal){let a=this.toNumber(s);isNaN(a)||(r+=a)}}return r}static avg(e,t){let r=this.sum(e,t),i=this.count(e,t);return i>0?r/i:0}static min(e,t){let r=null;for(let i of e){let s=i.get(t);if(!s)continue;let a=this.toComparable(s);(r===null||a<r)&&(r=a)}return r}static max(e,t){let r=null;for(let i of e){let s=i.get(t);if(!s)continue;let a=this.toComparable(s);(r===null||a>r)&&(r=a)}return r}static groupConcat(e,t,r=" "){let i=[];for(let s of e){let a=s.get(t);a&&(a instanceof yg.Literal||a instanceof Y3.IRI?i.push(a.value):i.push(a.toString()))}return i.join(r)}static sample(e,t){for(let r of e){let i=r.get(t);if(i)return this.toComparable(i)}return null}static sampleDistinct(e,t){return this.sample(e,t)}static toNumber(e){let t=e.datatype?.value;return t?.includes("#integer")||t?.includes("#decimal")||t?.includes("#double"),parseFloat(e.value)}static toComparable(e){if(e instanceof yg.Literal){let t=this.toNumber(e);return isNaN(t)?e.value:t}return e instanceof Y3.IRI?e.value:String(e)}};jl.AggregateFunctions=vg});var J3=v(Ml=>{"use strict";Object.defineProperty(Ml,"__esModule",{value:!0});Ml.QueryPlanCache=void 0;var oI=om(),wg=class{static{o(this,"QueryPlanCache")}constructor(e=100){this.hits=0,this.misses=0,this.cache=new oI.LRUCache(e)}get(e){let t=this.normalizeQuery(e),r=this.cache.get(t);return r!==void 0?this.hits++:this.misses++,r}set(e,t){let r=this.normalizeQuery(e);this.cache.set(r,t)}has(e){let t=this.normalizeQuery(e);return this.cache.get(t)!==void 0}clear(){this.cache.clear()}getStats(){let e=this.hits+this.misses;return{hits:this.hits,misses:this.misses,hitRate:e>0?this.hits/e:0,size:this.cache.size()}}resetStats(){this.hits=0,this.misses=0}normalizeQuery(e){return e.replace(/\s+/g," ").trim()}};Ml.QueryPlanCache=wg});var Z3=v(Ul=>{"use strict";Object.defineProperty(Ul,"__esModule",{value:!0});Ul.ResultSerializer=void 0;var Vl=dt(),$l=Xe(),Bl=Wt(),_g=class{static{o(this,"ResultSerializer")}serialize(e,t,r={}){switch(t){case"json":return this.serializeJSON(e,r);case"xml":return this.serializeXML(e,r);case"csv":return this.serializeCSV(e,r);case"turtle":return this.serializeTurtle(e,r);default:throw new Error(`Unsupported result format: ${t}`)}}serializeJSON(e,t={}){let r=this.toJSONResultSet(e,t),i=t.pretty?t.indent??2:void 0;return JSON.stringify(r,null,i)}toJSONResultSet(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=e.map(a=>{let c={};for(let u of i){let l=a.get(u);l!==void 0&&(c[u]=this.termToJSONBinding(l))}return c});return{head:{vars:i},results:{bindings:s}}}termToJSONBinding(e){return e instanceof $l.IRI?{type:"uri",value:e.value}:e instanceof Bl.BlankNode?{type:"bnode",value:e.id}:e instanceof Vl.Literal?this.literalToJSONBinding(e):{type:"literal",value:String(e)}}literalToJSONBinding(e){let t={type:"literal",value:e.value};return e.datatype?t.datatype=e.datatype.value:e.language&&(t["xml:lang"]=e.language,e.hasDirection()&&e.direction&&(t.direction=e.direction)),t}serializeXML(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=['<?xml version="1.0"?>','<sparql xmlns="http://www.w3.org/2005/sparql-results#">',"  <head>"];for(let a of i)s.push(`    <variable name="${this.escapeXML(a)}"/>`);s.push("  </head>"),s.push("  <results>");for(let a of e){s.push("    <result>");for(let c of i){let u=a.get(c);u!==void 0&&(s.push(`      <binding name="${this.escapeXML(c)}">`),s.push("        "+this.termToXML(u)),s.push("      </binding>"))}s.push("    </result>")}return s.push("  </results>"),s.push("</sparql>"),s.join(`
`)}termToXML(e){return e instanceof $l.IRI?`<uri>${this.escapeXML(e.value)}</uri>`:e instanceof Bl.BlankNode?`<bnode>${this.escapeXML(e.id)}</bnode>`:e instanceof Vl.Literal?this.literalToXML(e):`<literal>${this.escapeXML(String(e))}</literal>`}literalToXML(e){let t=this.escapeXML(e.value);if(e.datatype)return`<literal datatype="${this.escapeXML(e.datatype.value)}">${t}</literal>`;if(e.language){let r=`xml:lang="${this.escapeXML(e.language)}"`;return e.hasDirection()&&e.direction&&(r+=` direction="${e.direction}"`),`<literal ${r}>${t}</literal>`}return`<literal>${t}</literal>`}serializeCSV(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=[];s.push(i.map(a=>this.escapeCSV(a)).join(","));for(let a of e){let c=i.map(u=>{let l=a.get(u);return l===void 0?"":this.escapeCSV(this.termToCSV(l))});s.push(c.join(","))}return s.join(`
`)}termToCSV(e){return e instanceof $l.IRI?e.value:e instanceof Bl.BlankNode?`_:${e.id}`:e instanceof Vl.Literal?this.literalToCSV(e):String(e)}literalToCSV(e){if(e.datatype)return`${e.value}^^<${e.datatype.value}>`;if(e.language){let t=e.language;return e.hasDirection()&&e.direction&&(t+=`--${e.direction}`),`${e.value}@${t}`}return e.value}serializeTurtle(e,t={}){let r=new Set;for(let a of e)for(let c of a.variables())r.add(c);let i=t.variables??Array.from(r).sort(),s=[];s.push(`# SPARQL Results - ${e.length} solution(s)`),s.push(`# Variables: ${i.join(", ")}`),s.push("");for(let a=0;a<e.length;a++){let c=e[a];s.push(`# Solution ${a+1}`);for(let u of i){let l=c.get(u);l!==void 0&&s.push(`?${u} = ${this.termToTurtle(l)}`)}s.push("")}return s.join(`
`).trimEnd()}termToTurtle(e){return e instanceof $l.IRI?`<${e.value}>`:e instanceof Bl.BlankNode?`_:${e.id}`:e instanceof Vl.Literal?e.toString():`"${String(e)}"`}escapeXML(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}escapeCSV(e){return e.includes(",")||e.includes('"')||e.includes(`
`)?`"${e.replace(/"/g,'""')}"`:e}};Ul.ResultSerializer=_g});var ev=v(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.FileAlreadyExistsError=Ra.FileNotFoundError=void 0;var bg=class extends Error{static{o(this,"FileNotFoundError")}constructor(e){super(`File not found: ${e}`),this.name="FileNotFoundError"}};Ra.FileNotFoundError=bg;var Sg=class extends Error{static{o(this,"FileAlreadyExistsError")}constructor(e){super(`File already exists: ${e}`),this.name="FileAlreadyExistsError"}};Ra.FileAlreadyExistsError=Sg});var tv=v(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0});Fi.container=void 0;Fi.registerCoreServices=RI;Fi.createChildContainer=NI;Fi.getContainer=kI;Fi.resetContainer=LI;ph();var Uo=Je();Object.defineProperty(Fi,"container",{enumerable:!0,get:o(function(){return Uo.container},"get")});var st=at(),cI=np(),uI=ku(),lI=kp(),fI=Lu(),hI=Cp(),dI=sp(),pI=fp(),mI=up(),gI=Bu(),yI=Uu(),vI=bp(),wI=Ep(),_I=Dp(),bI=wp(),SI=jp(),EI=Bp(),TI=Vp(),AI=mp(),xI=yp(),CI=Rp(),OI=Pp(),DI=dm(),II=dp(),PI=qp(),FI=Wp();function RI(n){let e=n||Uo.container;e.registerSingleton(st.DI_TOKENS.TaskFrontmatterGenerator,uI.TaskFrontmatterGenerator),e.registerSingleton(st.DI_TOKENS.DynamicFrontmatterGenerator,lI.DynamicFrontmatterGenerator),e.registerSingleton(st.DI_TOKENS.AlgorithmExtractor,fI.AlgorithmExtractor),e.registerSingleton(st.DI_TOKENS.EffortStatusWorkflow,gI.EffortStatusWorkflow),e.registerSingleton(st.DI_TOKENS.StatusTimestampService,yI.StatusTimestampService),e.registerSingleton(st.DI_TOKENS.TaskStatusService,mI.TaskStatusService),e.registerSingleton(st.DI_TOKENS.TaskCreationService,cI.TaskCreationService),e.registerSingleton(st.DI_TOKENS.ProjectCreationService,dI.ProjectCreationService),e.registerSingleton(st.DI_TOKENS.AreaCreationService,pI.AreaCreationService),e.registerSingleton(st.DI_TOKENS.ClassCreationService,AI.ClassCreationService),e.registerSingleton(st.DI_TOKENS.ConceptCreationService,xI.ConceptCreationService),e.registerSingleton(st.DI_TOKENS.FleetingNoteCreationService,CI.FleetingNoteCreationService),e.registerSingleton(st.DI_TOKENS.SupervisionCreationService,OI.SupervisionCreationService),e.registerSingleton(st.DI_TOKENS.GenericAssetCreationService,FI.GenericAssetCreationService),e.registerSingleton(st.DI_TOKENS.PropertyCleanupService,hI.PropertyCleanupService),e.registerSingleton(st.DI_TOKENS.FolderRepairService,vI.FolderRepairService),e.registerSingleton(st.DI_TOKENS.LabelToAliasService,wI.LabelToAliasService),e.registerSingleton(st.DI_TOKENS.RenameToUidService,_I.RenameToUidService),e.registerSingleton(st.DI_TOKENS.PlanningService,SI.PlanningService),e.registerSingleton(st.DI_TOKENS.EffortVotingService,bI.EffortVotingService),e.registerSingleton(st.DI_TOKENS.SessionEventService,EI.SessionEventService),e.registerSingleton(st.DI_TOKENS.AssetConversionService,TI.AssetConversionService),e.registerSingleton(st.DI_TOKENS.NoteToRDFConverter,DI.NoteToRDFConverter),e.registerSingleton(st.DI_TOKENS.AreaHierarchyBuilder,II.AreaHierarchyBuilder),e.registerSingleton(st.DI_TOKENS.URIConstructionService,PI.URIConstructionService)}o(RI,"registerCoreServices");function NI(){return Uo.container.createChildContainer()}o(NI,"createChildContainer");function kI(){return Uo.container}o(kI,"getContainer");function LI(){Uo.container.reset()}o(LI,"resetContainer")});var kn=v(ql=>{"use strict";Object.defineProperty(ql,"__esModule",{value:!0});ql.ErrorCode=void 0;var rv;(function(n){n[n.INVALID_INPUT=1e3]="INVALID_INPUT",n[n.INVALID_FORMAT=1001]="INVALID_FORMAT",n[n.MISSING_REQUIRED_FIELD=1002]="MISSING_REQUIRED_FIELD",n[n.INVALID_SCHEMA=1003]="INVALID_SCHEMA",n[n.NETWORK_ERROR=2e3]="NETWORK_ERROR",n[n.REQUEST_TIMEOUT=2001]="REQUEST_TIMEOUT",n[n.CONNECTION_FAILED=2002]="CONNECTION_FAILED",n[n.FILE_READ_ERROR=2003]="FILE_READ_ERROR",n[n.FILE_WRITE_ERROR=2004]="FILE_WRITE_ERROR",n[n.INVALID_STATE=3e3]="INVALID_STATE",n[n.INVALID_TRANSITION=3001]="INVALID_TRANSITION",n[n.OPERATION_FAILED=3002]="OPERATION_FAILED",n[n.CONCURRENT_MODIFICATION=3003]="CONCURRENT_MODIFICATION",n[n.PERMISSION_DENIED=4e3]="PERMISSION_DENIED",n[n.UNAUTHORIZED=4001]="UNAUTHORIZED",n[n.FORBIDDEN=4003]="FORBIDDEN",n[n.NOT_FOUND=5e3]="NOT_FOUND",n[n.RESOURCE_EXHAUSTED=5001]="RESOURCE_EXHAUSTED",n[n.ALREADY_EXISTS=5002]="ALREADY_EXISTS",n[n.UNKNOWN_ERROR=9e3]="UNKNOWN_ERROR",n[n.INTERNAL_ERROR=9001]="INTERNAL_ERROR"})(rv||(ql.ErrorCode=rv={}))});var Ln=v(Gl=>{"use strict";Object.defineProperty(Gl,"__esModule",{value:!0});Gl.ApplicationError=void 0;var Eg=class extends Error{static{o(this,"ApplicationError")}constructor(e,t){super(e),this.name=this.constructor.name,this.context=t,this.timestamp=new Date,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}format(){let e=`\u274C ${this.name}: ${this.message}`;if(this.guidance&&(e+=`

\u{1F4A1} ${this.guidance}`),this.context&&Object.keys(this.context).length>0){e+=`

\u{1F4CB} Context:`;for(let[t,r]of Object.entries(this.context))e+=`
  ${t}: ${JSON.stringify(r)}`}return e}toJSON(){return{name:this.name,message:this.message,code:this.code,retriable:this.retriable,timestamp:this.timestamp.toISOString(),context:this.context,stack:this.stack}}};Gl.ApplicationError=Eg});var nv=v(Wl=>{"use strict";Object.defineProperty(Wl,"__esModule",{value:!0});Wl.ValidationError=void 0;var jI=Ln(),MI=kn(),Tg=class extends jI.ApplicationError{static{o(this,"ValidationError")}constructor(e,t){super(e,t),this.code=MI.ErrorCode.INVALID_INPUT,this.retriable=!1,this.guidance=`Check the input data for correctness.
Common issues:
  \u2022 Missing required fields
  \u2022 Invalid data format or type
  \u2022 Values outside allowed range
  \u2022 Schema validation failed`}};Wl.ValidationError=Tg});var iv=v(zl=>{"use strict";Object.defineProperty(zl,"__esModule",{value:!0});zl.NetworkError=void 0;var VI=Ln(),$I=kn(),Ag=class extends VI.ApplicationError{static{o(this,"NetworkError")}constructor(e,t){super(e,t),this.code=$I.ErrorCode.NETWORK_ERROR,this.retriable=!0,this.guidance=`This is typically a transient network issue.
To resolve:
  \u2022 Check your internet connection
  \u2022 Retry the operation
  \u2022 Verify external services are available
  \u2022 Check firewall/proxy settings`}};zl.NetworkError=Ag});var sv=v(Hl=>{"use strict";Object.defineProperty(Hl,"__esModule",{value:!0});Hl.StateTransitionError=void 0;var BI=Ln(),UI=kn(),xg=class extends BI.ApplicationError{static{o(this,"StateTransitionError")}constructor(e,t){super(e,t),this.code=UI.ErrorCode.INVALID_TRANSITION,this.retriable=!1,this.guidance=`The requested state transition is not allowed.
To fix:
  \u2022 Check the current state of the resource
  \u2022 Verify the transition is valid for this workflow
  \u2022 Review state machine documentation
  \u2022 Ensure no concurrent modifications occurred`}};Hl.StateTransitionError=xg});var av=v(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});Kl.PermissionError=void 0;var qI=Ln(),GI=kn(),Cg=class extends qI.ApplicationError{static{o(this,"PermissionError")}constructor(e,t){super(e,t),this.code=GI.ErrorCode.PERMISSION_DENIED,this.retriable=!1,this.guidance=`You don't have permission to perform this operation.
To resolve:
  \u2022 Check file/directory permissions
  \u2022 Verify you're authenticated
  \u2022 Ensure you have sufficient privileges
  \u2022 Contact administrator if access is needed`}};Kl.PermissionError=Cg});var ov=v(Ql=>{"use strict";Object.defineProperty(Ql,"__esModule",{value:!0});Ql.NotFoundError=void 0;var WI=Ln(),zI=kn(),Og=class extends WI.ApplicationError{static{o(this,"NotFoundError")}constructor(e,t){super(e,t),this.code=zI.ErrorCode.NOT_FOUND,this.retriable=!1,this.guidance=`The requested resource could not be found.
To resolve:
  \u2022 Verify the resource path/ID is correct
  \u2022 Check the resource exists
  \u2022 Ensure proper file extension (.md for notes)
  \u2022 Verify resource hasn't been deleted`}};Ql.NotFoundError=Og});var cv=v(Yl=>{"use strict";Object.defineProperty(Yl,"__esModule",{value:!0});Yl.ResourceExhaustedError=void 0;var HI=Ln(),KI=kn(),Dg=class extends HI.ApplicationError{static{o(this,"ResourceExhaustedError")}constructor(e,t){super(e,t),this.code=KI.ErrorCode.RESOURCE_EXHAUSTED,this.retriable=!0,this.guidance=`A resource limit has been exceeded.
To resolve:
  \u2022 Free up system resources (memory, disk space)
  \u2022 Reduce the size of your request
  \u2022 Wait and retry (for rate limits)
  \u2022 Close unused files/connections
  \u2022 Paginate large queries`}};Yl.ResourceExhaustedError=Dg});var uv=v(Xl=>{"use strict";Object.defineProperty(Xl,"__esModule",{value:!0});Xl.ServiceError=void 0;var QI=Ln(),YI=kn(),Ig=class extends QI.ApplicationError{static{o(this,"ServiceError")}constructor(e,t){super(e,t),this.code=YI.ErrorCode.INTERNAL_ERROR,this.retriable=!1,this.guidance=`This is an internal service error.
To resolve:
  \u2022 Check service initialization parameters
  \u2022 Verify all required dependencies are available
  \u2022 Review service logs for detailed error information
  \u2022 Contact support if the issue persists`}};Xl.ServiceError=Ig});var lv=v(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.ServiceError=wt.ResourceExhaustedError=wt.NotFoundError=wt.PermissionError=wt.StateTransitionError=wt.NetworkError=wt.ValidationError=wt.ApplicationError=wt.ErrorCode=void 0;var XI=kn();Object.defineProperty(wt,"ErrorCode",{enumerable:!0,get:o(function(){return XI.ErrorCode},"get")});var JI=Ln();Object.defineProperty(wt,"ApplicationError",{enumerable:!0,get:o(function(){return JI.ApplicationError},"get")});var ZI=nv();Object.defineProperty(wt,"ValidationError",{enumerable:!0,get:o(function(){return ZI.ValidationError},"get")});var eP=iv();Object.defineProperty(wt,"NetworkError",{enumerable:!0,get:o(function(){return eP.NetworkError},"get")});var tP=sv();Object.defineProperty(wt,"StateTransitionError",{enumerable:!0,get:o(function(){return tP.StateTransitionError},"get")});var rP=av();Object.defineProperty(wt,"PermissionError",{enumerable:!0,get:o(function(){return rP.PermissionError},"get")});var nP=ov();Object.defineProperty(wt,"NotFoundError",{enumerable:!0,get:o(function(){return nP.NotFoundError},"get")});var iP=cv();Object.defineProperty(wt,"ResourceExhaustedError",{enumerable:!0,get:o(function(){return iP.ResourceExhaustedError},"get")});var sP=uv();Object.defineProperty(wt,"ServiceError",{enumerable:!0,get:o(function(){return sP.ServiceError},"get")})});var fv=v(Jl=>{"use strict";Object.defineProperty(Jl,"__esModule",{value:!0});Jl.ApplicationErrorHandler=void 0;var Pg=Ln(),aP=kn(),Fg=class{static{o(this,"ApplicationErrorHandler")}constructor(e={},t,r){this.logger=t,this.notifier=r,this.telemetryHooks=new Set,this.retryConfig={maxRetries:e.maxRetries??3,initialDelayMs:e.initialDelayMs??1e3,backoffMultiplier:e.backoffMultiplier??2,maxDelayMs:e.maxDelayMs??1e4}}handle(e,t){let r=this.ensureApplicationError(e,t);return this.notifier&&this.notifier.error(r.message),this.callTelemetryHooks("onError",r,t),this.formatError(r)}async executeWithRetry(e,t){let r,i=0;for(;i<=this.retryConfig.maxRetries;)try{return await e()}catch(s){if(r=this.ensureApplicationError(s,t),!r.retriable||i>=this.retryConfig.maxRetries)throw this.callTelemetryHooks("onError",r,t),i>=this.retryConfig.maxRetries&&r.retriable&&this.callTelemetryHooks("onRetryExhausted",r,i+1),r;let a=this.calculateDelay(i);this.callTelemetryHooks("onRetry",r,i+1,a),this.logger?.debug(`Retrying after ${a}ms (attempt ${i+1}/${this.retryConfig.maxRetries})`),await this.sleep(a),i++}throw r}registerTelemetryHook(e){this.telemetryHooks.add(e)}unregisterTelemetryHook(e){this.telemetryHooks.delete(e)}ensureApplicationError(e,t){if(e instanceof Pg.ApplicationError){if(t){let i=e,s={...e.context,...t};return new class extends Pg.ApplicationError{constructor(){super(...arguments),this.code=i.code,this.retriable=i.retriable,this.guidance=i.guidance}}(e.message,s)}return e}return new class extends Pg.ApplicationError{static{o(this,"UnknownError")}constructor(s,a){super(s,{originalError:a.name,...t}),this.code=aP.ErrorCode.UNKNOWN_ERROR,this.retriable=!1,this.guidance="An unexpected error occurred"}}(e.message,e)}formatError(e){let t=[];return t.push(`\u274C ${e.name}: ${e.message}`),e.guidance&&t.push(`\u{1F4A1} ${e.guidance}`),e.context&&Object.keys(e.context).length>0&&t.push(`Context: ${JSON.stringify(e.context,null,2)}`),t.join(`
`)}calculateDelay(e){let t=this.retryConfig.initialDelayMs*Math.pow(this.retryConfig.backoffMultiplier,e);return Math.min(t,this.retryConfig.maxDelayMs)}sleep(e){return new Promise(t=>setTimeout(t,e))}callTelemetryHooks(e,...t){for(let r of this.telemetryHooks)try{let i=r[e];i&&i.apply(r,t)}catch(i){console.error("Error in telemetry hook:",i)}}};Jl.ApplicationErrorHandler=Fg});var hv=v(Zl=>{"use strict";Object.defineProperty(Zl,"__esModule",{value:!0});Zl.ApplicationErrorHandler=void 0;var oP=fv();Object.defineProperty(Zl,"ApplicationErrorHandler",{enumerable:!0,get:o(function(){return oP.ApplicationErrorHandler},"get")})});var Ri=v(S=>{"use strict";var cP=S&&S.__createBinding||(Object.create?(function(n,e,t,r){r===void 0&&(r=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:o(function(){return e[t]},"get")}),Object.defineProperty(n,r,i)}):(function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]})),jn=S&&S.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&cP(e,n,t)};Object.defineProperty(S,"__esModule",{value:!0});S.FilterExecutor=S.BGPExecutor=S.AlgebraSerializer=S.AlgebraOptimizer=S.AlgebraTranslator=S.DescribeOptionsTransformerError=S.DescribeOptionsTransformer=S.SPARQLParseError=S.SPARQLParser=S.NoteToRDFConverter=S.RDFVocabularyMapper=S.InMemoryTripleStore=S.RDFSerializer=S.FilenameValidator=S.EffortSortingHelpers=S.MetadataExtractor=S.MetadataHelpers=S.WikiLinkHelpers=S.DateFormatter=S.FrontmatterService=S.GenericAssetCreationService=S.URIConstructionService=S.SessionEventService=S.AssetConversionService=S.PlanningService=S.AlgorithmExtractor=S.DynamicFrontmatterGenerator=S.TaskFrontmatterGenerator=S.FleetingNoteCreationService=S.SupervisionCreationService=S.StatusTimestampService=S.RenameToUidService=S.PropertyCleanupService=S.LoggingService=S.LabelToAliasService=S.FolderRepairService=S.EffortVotingService=S.EffortStatusWorkflow=S.ConceptCreationService=S.ClassCreationService=S.AreaHierarchyBuilder=S.AreaCreationService=S.TaskStatusService=S.ProjectCreationService=S.TaskCreationService=S.extractPropertyLabel=S.uriToPropertyName=S.propertyNameToUri=S.rangeToFieldType=S.PropertyFieldType=void 0;S.container=S.resetContainer=S.getContainer=S.createChildContainer=S.registerCoreServices=S.DI_TOKENS=S.FileAlreadyExistsError=S.FileNotFoundError=S.FilterContainsOptimizer=S.CaseWhenTransformerError=S.CaseWhenTransformer=S.ResultSerializer=S.QueryPlanCache=S.createDoubleLiteral=S.createDecimalLiteral=S.getNumericValue=S.createPercentileAggregate=S.modeAggregate=S.stddevAggregate=S.varianceAggregate=S.medianAggregate=S.EXO_AGGREGATE_NS=S.BUILT_IN_AGGREGATES=S.CustomAggregateError=S.CustomAggregateRegistry=S.AggregateFunctions=S.BuiltInFunctions=S.SolutionMapping=S.UpdateExecutorError=S.UpdateExecutor=S.QueryExecutor=S.DescribeExecutor=S.ConstructExecutor=S.UnionExecutor=S.OptionalExecutor=void 0;jn(Fh(),S);jn(Rh(),S);jn(G1(),S);jn(z1(),S);jn(K1(),S);jn(Y1(),S);jn(Z1(),S);jn(py(),S);var dv=zh();Object.defineProperty(S,"PropertyFieldType",{enumerable:!0,get:o(function(){return dv.PropertyFieldType},"get")});Object.defineProperty(S,"rangeToFieldType",{enumerable:!0,get:o(function(){return dv.rangeToFieldType},"get")});var Rg=yy();Object.defineProperty(S,"propertyNameToUri",{enumerable:!0,get:o(function(){return Rg.propertyNameToUri},"get")});Object.defineProperty(S,"uriToPropertyName",{enumerable:!0,get:o(function(){return Rg.uriToPropertyName},"get")});Object.defineProperty(S,"extractPropertyLabel",{enumerable:!0,get:o(function(){return Rg.extractPropertyLabel},"get")});var uP=np();Object.defineProperty(S,"TaskCreationService",{enumerable:!0,get:o(function(){return uP.TaskCreationService},"get")});var lP=sp();Object.defineProperty(S,"ProjectCreationService",{enumerable:!0,get:o(function(){return lP.ProjectCreationService},"get")});var fP=up();Object.defineProperty(S,"TaskStatusService",{enumerable:!0,get:o(function(){return fP.TaskStatusService},"get")});var hP=fp();Object.defineProperty(S,"AreaCreationService",{enumerable:!0,get:o(function(){return hP.AreaCreationService},"get")});var dP=dp();Object.defineProperty(S,"AreaHierarchyBuilder",{enumerable:!0,get:o(function(){return dP.AreaHierarchyBuilder},"get")});var pP=mp();Object.defineProperty(S,"ClassCreationService",{enumerable:!0,get:o(function(){return pP.ClassCreationService},"get")});var mP=yp();Object.defineProperty(S,"ConceptCreationService",{enumerable:!0,get:o(function(){return mP.ConceptCreationService},"get")});var gP=Bu();Object.defineProperty(S,"EffortStatusWorkflow",{enumerable:!0,get:o(function(){return gP.EffortStatusWorkflow},"get")});var yP=wp();Object.defineProperty(S,"EffortVotingService",{enumerable:!0,get:o(function(){return yP.EffortVotingService},"get")});var vP=bp();Object.defineProperty(S,"FolderRepairService",{enumerable:!0,get:o(function(){return vP.FolderRepairService},"get")});var wP=Ep();Object.defineProperty(S,"LabelToAliasService",{enumerable:!0,get:o(function(){return wP.LabelToAliasService},"get")});var _P=Tp();Object.defineProperty(S,"LoggingService",{enumerable:!0,get:o(function(){return _P.LoggingService},"get")});var bP=Cp();Object.defineProperty(S,"PropertyCleanupService",{enumerable:!0,get:o(function(){return bP.PropertyCleanupService},"get")});var SP=Dp();Object.defineProperty(S,"RenameToUidService",{enumerable:!0,get:o(function(){return SP.RenameToUidService},"get")});var EP=Uu();Object.defineProperty(S,"StatusTimestampService",{enumerable:!0,get:o(function(){return EP.StatusTimestampService},"get")});var TP=Pp();Object.defineProperty(S,"SupervisionCreationService",{enumerable:!0,get:o(function(){return TP.SupervisionCreationService},"get")});var AP=Rp();Object.defineProperty(S,"FleetingNoteCreationService",{enumerable:!0,get:o(function(){return AP.FleetingNoteCreationService},"get")});var xP=ku();Object.defineProperty(S,"TaskFrontmatterGenerator",{enumerable:!0,get:o(function(){return xP.TaskFrontmatterGenerator},"get")});var CP=kp();Object.defineProperty(S,"DynamicFrontmatterGenerator",{enumerable:!0,get:o(function(){return CP.DynamicFrontmatterGenerator},"get")});var OP=Lu();Object.defineProperty(S,"AlgorithmExtractor",{enumerable:!0,get:o(function(){return OP.AlgorithmExtractor},"get")});var DP=jp();Object.defineProperty(S,"PlanningService",{enumerable:!0,get:o(function(){return DP.PlanningService},"get")});var IP=Vp();Object.defineProperty(S,"AssetConversionService",{enumerable:!0,get:o(function(){return IP.AssetConversionService},"get")});var PP=Bp();Object.defineProperty(S,"SessionEventService",{enumerable:!0,get:o(function(){return PP.SessionEventService},"get")});var FP=qp();Object.defineProperty(S,"URIConstructionService",{enumerable:!0,get:o(function(){return FP.URIConstructionService},"get")});var RP=Wp();Object.defineProperty(S,"GenericAssetCreationService",{enumerable:!0,get:o(function(){return RP.GenericAssetCreationService},"get")});var NP=ea();Object.defineProperty(S,"FrontmatterService",{enumerable:!0,get:o(function(){return NP.FrontmatterService},"get")});var kP=cr();Object.defineProperty(S,"DateFormatter",{enumerable:!0,get:o(function(){return kP.DateFormatter},"get")});var LP=ss();Object.defineProperty(S,"WikiLinkHelpers",{enumerable:!0,get:o(function(){return LP.WikiLinkHelpers},"get")});var jP=Mr();Object.defineProperty(S,"MetadataHelpers",{enumerable:!0,get:o(function(){return jP.MetadataHelpers},"get")});var MP=Po();Object.defineProperty(S,"MetadataExtractor",{enumerable:!0,get:o(function(){return MP.MetadataExtractor},"get")});var VP=z2();Object.defineProperty(S,"EffortSortingHelpers",{enumerable:!0,get:o(function(){return VP.EffortSortingHelpers},"get")});var $P=H2();Object.defineProperty(S,"FilenameValidator",{enumerable:!0,get:o(function(){return $P.FilenameValidator},"get")});var BP=e3();Object.defineProperty(S,"RDFSerializer",{enumerable:!0,get:o(function(){return BP.RDFSerializer},"get")});var UP=r3();Object.defineProperty(S,"InMemoryTripleStore",{enumerable:!0,get:o(function(){return UP.InMemoryTripleStore},"get")});var qP=fm();Object.defineProperty(S,"RDFVocabularyMapper",{enumerable:!0,get:o(function(){return qP.RDFVocabularyMapper},"get")});var GP=dm();Object.defineProperty(S,"NoteToRDFConverter",{enumerable:!0,get:o(function(){return GP.NoteToRDFConverter},"get")});var pv=T3();Object.defineProperty(S,"SPARQLParser",{enumerable:!0,get:o(function(){return pv.SPARQLParser},"get")});Object.defineProperty(S,"SPARQLParseError",{enumerable:!0,get:o(function(){return pv.SPARQLParseError},"get")});var mv=Dm();Object.defineProperty(S,"DescribeOptionsTransformer",{enumerable:!0,get:o(function(){return mv.DescribeOptionsTransformer},"get")});Object.defineProperty(S,"DescribeOptionsTransformerError",{enumerable:!0,get:o(function(){return mv.DescribeOptionsTransformerError},"get")});var WP=x3();Object.defineProperty(S,"AlgebraTranslator",{enumerable:!0,get:o(function(){return WP.AlgebraTranslator},"get")});var zP=C3();Object.defineProperty(S,"AlgebraOptimizer",{enumerable:!0,get:o(function(){return zP.AlgebraOptimizer},"get")});var HP=O3();Object.defineProperty(S,"AlgebraSerializer",{enumerable:!0,get:o(function(){return HP.AlgebraSerializer},"get")});var KP=zm();Object.defineProperty(S,"BGPExecutor",{enumerable:!0,get:o(function(){return KP.BGPExecutor},"get")});var QP=Cl();Object.defineProperty(S,"FilterExecutor",{enumerable:!0,get:o(function(){return QP.FilterExecutor},"get")});var YP=Xm();Object.defineProperty(S,"OptionalExecutor",{enumerable:!0,get:o(function(){return YP.OptionalExecutor},"get")});var XP=Zm();Object.defineProperty(S,"UnionExecutor",{enumerable:!0,get:o(function(){return XP.UnionExecutor},"get")});var JP=ng();Object.defineProperty(S,"ConstructExecutor",{enumerable:!0,get:o(function(){return JP.ConstructExecutor},"get")});var ZP=k3();Object.defineProperty(S,"DescribeExecutor",{enumerable:!0,get:o(function(){return ZP.DescribeExecutor},"get")});var eF=H3();Object.defineProperty(S,"QueryExecutor",{enumerable:!0,get:o(function(){return eF.QueryExecutor},"get")});var gv=Q3();Object.defineProperty(S,"UpdateExecutor",{enumerable:!0,get:o(function(){return gv.UpdateExecutor},"get")});Object.defineProperty(S,"UpdateExecutorError",{enumerable:!0,get:o(function(){return gv.UpdateExecutorError},"get")});var tF=ci();Object.defineProperty(S,"SolutionMapping",{enumerable:!0,get:o(function(){return tF.SolutionMapping},"get")});var rF=Km();Object.defineProperty(S,"BuiltInFunctions",{enumerable:!0,get:o(function(){return rF.BuiltInFunctions},"get")});var nF=X3();Object.defineProperty(S,"AggregateFunctions",{enumerable:!0,get:o(function(){return nF.AggregateFunctions},"get")});var yv=og();Object.defineProperty(S,"CustomAggregateRegistry",{enumerable:!0,get:o(function(){return yv.CustomAggregateRegistry},"get")});Object.defineProperty(S,"CustomAggregateError",{enumerable:!0,get:o(function(){return yv.CustomAggregateError},"get")});var Mn=cg();Object.defineProperty(S,"BUILT_IN_AGGREGATES",{enumerable:!0,get:o(function(){return Mn.BUILT_IN_AGGREGATES},"get")});Object.defineProperty(S,"EXO_AGGREGATE_NS",{enumerable:!0,get:o(function(){return Mn.EXO_AGGREGATE_NS},"get")});Object.defineProperty(S,"medianAggregate",{enumerable:!0,get:o(function(){return Mn.medianAggregate},"get")});Object.defineProperty(S,"varianceAggregate",{enumerable:!0,get:o(function(){return Mn.varianceAggregate},"get")});Object.defineProperty(S,"stddevAggregate",{enumerable:!0,get:o(function(){return Mn.stddevAggregate},"get")});Object.defineProperty(S,"modeAggregate",{enumerable:!0,get:o(function(){return Mn.modeAggregate},"get")});Object.defineProperty(S,"createPercentileAggregate",{enumerable:!0,get:o(function(){return Mn.createPercentileAggregate},"get")});Object.defineProperty(S,"getNumericValue",{enumerable:!0,get:o(function(){return Mn.getNumericValue},"get")});Object.defineProperty(S,"createDecimalLiteral",{enumerable:!0,get:o(function(){return Mn.createDecimalLiteral},"get")});Object.defineProperty(S,"createDoubleLiteral",{enumerable:!0,get:o(function(){return Mn.createDoubleLiteral},"get")});var iF=J3();Object.defineProperty(S,"QueryPlanCache",{enumerable:!0,get:o(function(){return iF.QueryPlanCache},"get")});var sF=Z3();Object.defineProperty(S,"ResultSerializer",{enumerable:!0,get:o(function(){return sF.ResultSerializer},"get")});var vv=xm();Object.defineProperty(S,"CaseWhenTransformer",{enumerable:!0,get:o(function(){return vv.CaseWhenTransformer},"get")});Object.defineProperty(S,"CaseWhenTransformerError",{enumerable:!0,get:o(function(){return vv.CaseWhenTransformerError},"get")});var aF=Vm();Object.defineProperty(S,"FilterContainsOptimizer",{enumerable:!0,get:o(function(){return aF.FilterContainsOptimizer},"get")});var wv=ev();Object.defineProperty(S,"FileNotFoundError",{enumerable:!0,get:o(function(){return wv.FileNotFoundError},"get")});Object.defineProperty(S,"FileAlreadyExistsError",{enumerable:!0,get:o(function(){return wv.FileAlreadyExistsError},"get")});var oF=at();Object.defineProperty(S,"DI_TOKENS",{enumerable:!0,get:o(function(){return oF.DI_TOKENS},"get")});var qo=tv();Object.defineProperty(S,"registerCoreServices",{enumerable:!0,get:o(function(){return qo.registerCoreServices},"get")});Object.defineProperty(S,"createChildContainer",{enumerable:!0,get:o(function(){return qo.createChildContainer},"get")});Object.defineProperty(S,"getContainer",{enumerable:!0,get:o(function(){return qo.getContainer},"get")});Object.defineProperty(S,"resetContainer",{enumerable:!0,get:o(function(){return qo.resetContainer},"get")});Object.defineProperty(S,"container",{enumerable:!0,get:o(function(){return qo.container},"get")});jn(lv(),S);jn(hv(),S)});var Ct=v(Ng=>{"use strict";Ng.fromCallback=function(n){return Object.defineProperty(function(...e){if(typeof e[e.length-1]=="function")n.apply(this,e);else return new Promise((t,r)=>{e.push((i,s)=>i!=null?r(i):t(s)),n.apply(this,e)})},"name",{value:n.name})};Ng.fromPromise=function(n){return Object.defineProperty(function(...e){let t=e[e.length-1];if(typeof t!="function")return n.apply(this,e);e.pop(),n.apply(this,e).then(r=>t(null,r),t)},"name",{value:n.name})}});var bv=v((M$,_v)=>{var Ni=require("constants"),cF=process.cwd,ef=null,uF=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return ef||(ef=cF.call(process)),ef};try{process.cwd()}catch{}typeof process.chdir=="function"&&(kg=process.chdir,process.chdir=function(n){ef=null,kg.call(process,n)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,kg));var kg;_v.exports=lF;function lF(n){Ni.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(n),n.lutimes||t(n),n.chown=s(n.chown),n.fchown=s(n.fchown),n.lchown=s(n.lchown),n.chmod=r(n.chmod),n.fchmod=r(n.fchmod),n.lchmod=r(n.lchmod),n.chownSync=a(n.chownSync),n.fchownSync=a(n.fchownSync),n.lchownSync=a(n.lchownSync),n.chmodSync=i(n.chmodSync),n.fchmodSync=i(n.fchmodSync),n.lchmodSync=i(n.lchmodSync),n.stat=c(n.stat),n.fstat=c(n.fstat),n.lstat=c(n.lstat),n.statSync=u(n.statSync),n.fstatSync=u(n.fstatSync),n.lstatSync=u(n.lstatSync),n.chmod&&!n.lchmod&&(n.lchmod=function(f,h,d){d&&process.nextTick(d)},n.lchmodSync=function(){}),n.chown&&!n.lchown&&(n.lchown=function(f,h,d,m){m&&process.nextTick(m)},n.lchownSync=function(){}),uF==="win32"&&(n.rename=typeof n.rename!="function"?n.rename:(function(f){function h(d,m,_){var b=Date.now(),C=0;f(d,m,o(function O(I){if(I&&(I.code==="EACCES"||I.code==="EPERM"||I.code==="EBUSY")&&Date.now()-b<6e4){setTimeout(function(){n.stat(m,function(L,G){L&&L.code==="ENOENT"?f(d,m,O):_(I)})},C),C<100&&(C+=10);return}_&&_(I)},"CB"))}return o(h,"rename"),Object.setPrototypeOf&&Object.setPrototypeOf(h,f),h})(n.rename)),n.read=typeof n.read!="function"?n.read:(function(f){function h(d,m,_,b,C,O){var I;if(O&&typeof O=="function"){var L=0;I=o(function(G,W,Fe){if(G&&G.code==="EAGAIN"&&L<10)return L++,f.call(n,d,m,_,b,C,I);O.apply(this,arguments)},"callback")}return f.call(n,d,m,_,b,C,I)}return o(h,"read"),Object.setPrototypeOf&&Object.setPrototypeOf(h,f),h})(n.read),n.readSync=typeof n.readSync!="function"?n.readSync:(function(f){return function(h,d,m,_,b){for(var C=0;;)try{return f.call(n,h,d,m,_,b)}catch(O){if(O.code==="EAGAIN"&&C<10){C++;continue}throw O}}})(n.readSync);function e(f){f.lchmod=function(h,d,m){f.open(h,Ni.O_WRONLY|Ni.O_SYMLINK,d,function(_,b){if(_){m&&m(_);return}f.fchmod(b,d,function(C){f.close(b,function(O){m&&m(C||O)})})})},f.lchmodSync=function(h,d){var m=f.openSync(h,Ni.O_WRONLY|Ni.O_SYMLINK,d),_=!0,b;try{b=f.fchmodSync(m,d),_=!1}finally{if(_)try{f.closeSync(m)}catch{}else f.closeSync(m)}return b}}o(e,"patchLchmod");function t(f){Ni.hasOwnProperty("O_SYMLINK")&&f.futimes?(f.lutimes=function(h,d,m,_){f.open(h,Ni.O_SYMLINK,function(b,C){if(b){_&&_(b);return}f.futimes(C,d,m,function(O){f.close(C,function(I){_&&_(O||I)})})})},f.lutimesSync=function(h,d,m){var _=f.openSync(h,Ni.O_SYMLINK),b,C=!0;try{b=f.futimesSync(_,d,m),C=!1}finally{if(C)try{f.closeSync(_)}catch{}else f.closeSync(_)}return b}):f.futimes&&(f.lutimes=function(h,d,m,_){_&&process.nextTick(_)},f.lutimesSync=function(){})}o(t,"patchLutimes");function r(f){return f&&function(h,d,m){return f.call(n,h,d,function(_){l(_)&&(_=null),m&&m.apply(this,arguments)})}}o(r,"chmodFix");function i(f){return f&&function(h,d){try{return f.call(n,h,d)}catch(m){if(!l(m))throw m}}}o(i,"chmodFixSync");function s(f){return f&&function(h,d,m,_){return f.call(n,h,d,m,function(b){l(b)&&(b=null),_&&_.apply(this,arguments)})}}o(s,"chownFix");function a(f){return f&&function(h,d,m){try{return f.call(n,h,d,m)}catch(_){if(!l(_))throw _}}}o(a,"chownFixSync");function c(f){return f&&function(h,d,m){typeof d=="function"&&(m=d,d=null);function _(b,C){C&&(C.uid<0&&(C.uid+=4294967296),C.gid<0&&(C.gid+=4294967296)),m&&m.apply(this,arguments)}return o(_,"callback"),d?f.call(n,h,d,_):f.call(n,h,_)}}o(c,"statFix");function u(f){return f&&function(h,d){var m=d?f.call(n,h,d):f.call(n,h);return m&&(m.uid<0&&(m.uid+=4294967296),m.gid<0&&(m.gid+=4294967296)),m}}o(u,"statFixSync");function l(f){if(!f||f.code==="ENOSYS")return!0;var h=!process.getuid||process.getuid()!==0;return!!(h&&(f.code==="EINVAL"||f.code==="EPERM"))}o(l,"chownErOk")}o(lF,"patch")});var Tv=v(($$,Ev)=>{var Sv=require("stream").Stream;Ev.exports=fF;function fF(n){return{ReadStream:e,WriteStream:t};function e(r,i){if(!(this instanceof e))return new e(r,i);Sv.call(this);var s=this;this.path=r,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var a=Object.keys(i),c=0,u=a.length;c<u;c++){var l=a[c];this[l]=i[l]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){s._read()});return}n.open(this.path,this.flags,this.mode,function(f,h){if(f){s.emit("error",f),s.readable=!1;return}s.fd=h,s.emit("open",h),s._read()})}function t(r,i){if(!(this instanceof t))return new t(r,i);Sv.call(this),this.path=r,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var s=Object.keys(i),a=0,c=s.length;a<c;a++){var u=s[a];this[u]=i[u]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=n.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}o(fF,"legacy")});var xv=v((U$,Av)=>{"use strict";Av.exports=dF;var hF=Object.getPrototypeOf||function(n){return n.__proto__};function dF(n){if(n===null||typeof n!="object")return n;if(n instanceof Object)var e={__proto__:hF(n)};else var e=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}o(dF,"clone")});var ka=v((G$,Mg)=>{var ut=require("fs"),pF=bv(),mF=Tv(),gF=xv(),tf=require("util"),Vt,nf;typeof Symbol=="function"&&typeof Symbol.for=="function"?(Vt=Symbol.for("graceful-fs.queue"),nf=Symbol.for("graceful-fs.previous")):(Vt="___graceful-fs.queue",nf="___graceful-fs.previous");function yF(){}o(yF,"noop");function Dv(n,e){Object.defineProperty(n,Vt,{get:o(function(){return e},"get")})}o(Dv,"publishQueue");var Is=yF;tf.debuglog?Is=tf.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Is=o(function(){var n=tf.format.apply(tf,arguments);n="GFS4: "+n.split(/\n/).join(`
GFS4: `),console.error(n)},"debug"));ut[Vt]||(Cv=global[Vt]||[],Dv(ut,Cv),ut.close=(function(n){function e(t,r){return n.call(ut,t,function(i){i||Ov(),typeof r=="function"&&r.apply(this,arguments)})}return o(e,"close"),Object.defineProperty(e,nf,{value:n}),e})(ut.close),ut.closeSync=(function(n){function e(t){n.apply(ut,arguments),Ov()}return o(e,"closeSync"),Object.defineProperty(e,nf,{value:n}),e})(ut.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Is(ut[Vt]),require("assert").equal(ut[Vt].length,0)}));var Cv;global[Vt]||Dv(global,ut[Vt]);Mg.exports=Lg(gF(ut));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!ut.__patched&&(Mg.exports=Lg(ut),ut.__patched=!0);function Lg(n){pF(n),n.gracefulify=Lg,n.createReadStream=W,n.createWriteStream=Fe;var e=n.readFile;n.readFile=t;function t(B,ue,be){return typeof ue=="function"&&(be=ue,ue=null),He(B,ue,be);function He(qe,et,Le,je){return e(qe,et,function(Re){Re&&(Re.code==="EMFILE"||Re.code==="ENFILE")?Na([He,[qe,et,Le],Re,je||Date.now(),Date.now()]):typeof Le=="function"&&Le.apply(this,arguments)})}o(He,"go$readFile")}o(t,"readFile");var r=n.writeFile;n.writeFile=i;function i(B,ue,be,He){return typeof be=="function"&&(He=be,be=null),qe(B,ue,be,He);function qe(et,Le,je,Re,H){return r(et,Le,je,function(k){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Na([qe,[et,Le,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(qe,"go$writeFile")}o(i,"writeFile");var s=n.appendFile;s&&(n.appendFile=a);function a(B,ue,be,He){return typeof be=="function"&&(He=be,be=null),qe(B,ue,be,He);function qe(et,Le,je,Re,H){return s(et,Le,je,function(k){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Na([qe,[et,Le,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(qe,"go$appendFile")}o(a,"appendFile");var c=n.copyFile;c&&(n.copyFile=u);function u(B,ue,be,He){return typeof be=="function"&&(He=be,be=0),qe(B,ue,be,He);function qe(et,Le,je,Re,H){return c(et,Le,je,function(k){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Na([qe,[et,Le,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(qe,"go$copyFile")}o(u,"copyFile");var l=n.readdir;n.readdir=h;var f=/^v[0-5]\./;function h(B,ue,be){typeof ue=="function"&&(be=ue,ue=null);var He=f.test(process.version)?o(function(Le,je,Re,H){return l(Le,qe(Le,je,Re,H))},"go$readdir"):o(function(Le,je,Re,H){return l(Le,je,qe(Le,je,Re,H))},"go$readdir");return He(B,ue,be);function qe(et,Le,je,Re){return function(H,k){H&&(H.code==="EMFILE"||H.code==="ENFILE")?Na([He,[et,Le,je],H,Re||Date.now(),Date.now()]):(k&&k.sort&&k.sort(),typeof je=="function"&&je.call(this,H,k))}}}if(o(h,"readdir"),process.version.substr(0,4)==="v0.8"){var d=mF(n);O=d.ReadStream,L=d.WriteStream}var m=n.ReadStream;m&&(O.prototype=Object.create(m.prototype),O.prototype.open=I);var _=n.WriteStream;_&&(L.prototype=Object.create(_.prototype),L.prototype.open=G),Object.defineProperty(n,"ReadStream",{get:o(function(){return O},"get"),set:o(function(B){O=B},"set"),enumerable:!0,configurable:!0}),Object.defineProperty(n,"WriteStream",{get:o(function(){return L},"get"),set:o(function(B){L=B},"set"),enumerable:!0,configurable:!0});var b=O;Object.defineProperty(n,"FileReadStream",{get:o(function(){return b},"get"),set:o(function(B){b=B},"set"),enumerable:!0,configurable:!0});var C=L;Object.defineProperty(n,"FileWriteStream",{get:o(function(){return C},"get"),set:o(function(B){C=B},"set"),enumerable:!0,configurable:!0});function O(B,ue){return this instanceof O?(m.apply(this,arguments),this):O.apply(Object.create(O.prototype),arguments)}o(O,"ReadStream");function I(){var B=this;ot(B.path,B.flags,B.mode,function(ue,be){ue?(B.autoClose&&B.destroy(),B.emit("error",ue)):(B.fd=be,B.emit("open",be),B.read())})}o(I,"ReadStream$open");function L(B,ue){return this instanceof L?(_.apply(this,arguments),this):L.apply(Object.create(L.prototype),arguments)}o(L,"WriteStream");function G(){var B=this;ot(B.path,B.flags,B.mode,function(ue,be){ue?(B.destroy(),B.emit("error",ue)):(B.fd=be,B.emit("open",be))})}o(G,"WriteStream$open");function W(B,ue){return new n.ReadStream(B,ue)}o(W,"createReadStream");function Fe(B,ue){return new n.WriteStream(B,ue)}o(Fe,"createWriteStream");var Ze=n.open;n.open=ot;function ot(B,ue,be,He){return typeof be=="function"&&(He=be,be=null),qe(B,ue,be,He);function qe(et,Le,je,Re,H){return Ze(et,Le,je,function(k,Me){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Na([qe,[et,Le,je,Re],k,H||Date.now(),Date.now()]):typeof Re=="function"&&Re.apply(this,arguments)})}o(qe,"go$open")}return o(ot,"open"),n}o(Lg,"patch");function Na(n){Is("ENQUEUE",n[0].name,n[1]),ut[Vt].push(n),jg()}o(Na,"enqueue");var rf;function Ov(){for(var n=Date.now(),e=0;e<ut[Vt].length;++e)ut[Vt][e].length>2&&(ut[Vt][e][3]=n,ut[Vt][e][4]=n);jg()}o(Ov,"resetQueue");function jg(){if(clearTimeout(rf),rf=void 0,ut[Vt].length!==0){var n=ut[Vt].shift(),e=n[0],t=n[1],r=n[2],i=n[3],s=n[4];if(i===void 0)Is("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Is("TIMEOUT",e.name,t);var a=t.pop();typeof a=="function"&&a.call(null,r)}else{var c=Date.now()-s,u=Math.max(s-i,1),l=Math.min(u*1.2,100);c>=l?(Is("RETRY",e.name,t),e.apply(null,t.concat([i]))):ut[Vt].push(n)}rf===void 0&&(rf=setTimeout(jg,0))}}o(jg,"retry")});var fr=v(ui=>{"use strict";var Iv=Ct().fromCallback,lr=ka(),vF=["access","appendFile","chmod","chown","close","copyFile","cp","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","glob","lchmod","lchown","lutimes","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","statfs","symlink","truncate","unlink","utimes","writeFile"].filter(n=>typeof lr[n]=="function");Object.assign(ui,lr);vF.forEach(n=>{ui[n]=Iv(lr[n])});ui.exists=function(n,e){return typeof e=="function"?lr.exists(n,e):new Promise(t=>lr.exists(n,t))};ui.read=function(n,e,t,r,i,s){return typeof s=="function"?lr.read(n,e,t,r,i,s):new Promise((a,c)=>{lr.read(n,e,t,r,i,(u,l,f)=>{if(u)return c(u);a({bytesRead:l,buffer:f})})})};ui.write=function(n,e,...t){return typeof t[t.length-1]=="function"?lr.write(n,e,...t):new Promise((r,i)=>{lr.write(n,e,...t,(s,a,c)=>{if(s)return i(s);r({bytesWritten:a,buffer:c})})})};ui.readv=function(n,e,...t){return typeof t[t.length-1]=="function"?lr.readv(n,e,...t):new Promise((r,i)=>{lr.readv(n,e,...t,(s,a,c)=>{if(s)return i(s);r({bytesRead:a,buffers:c})})})};ui.writev=function(n,e,...t){return typeof t[t.length-1]=="function"?lr.writev(n,e,...t):new Promise((r,i)=>{lr.writev(n,e,...t,(s,a,c)=>{if(s)return i(s);r({bytesWritten:a,buffers:c})})})};typeof lr.realpath.native=="function"?ui.realpath.native=Iv(lr.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")});var Fv=v((H$,Pv)=>{"use strict";var wF=require("path");Pv.exports.checkPath=o(function(e){if(process.platform==="win32"&&/[<>:"|?*]/.test(e.replace(wF.parse(e).root,""))){let r=new Error(`Path contains invalid characters: ${e}`);throw r.code="EINVAL",r}},"checkPath")});var Lv=v((Q$,Vg)=>{"use strict";var Rv=fr(),{checkPath:Nv}=Fv(),kv=o(n=>{let e={mode:511};return typeof n=="number"?n:{...e,...n}.mode},"getMode");Vg.exports.makeDir=async(n,e)=>(Nv(n),Rv.mkdir(n,{mode:kv(e),recursive:!0}));Vg.exports.makeDirSync=(n,e)=>(Nv(n),Rv.mkdirSync(n,{mode:kv(e),recursive:!0}))});var mn=v((X$,jv)=>{"use strict";var _F=Ct().fromPromise,{makeDir:bF,makeDirSync:$g}=Lv(),Bg=_F(bF);jv.exports={mkdirs:Bg,mkdirsSync:$g,mkdirp:Bg,mkdirpSync:$g,ensureDir:Bg,ensureDirSync:$g}});var ki=v((J$,Vv)=>{"use strict";var SF=Ct().fromPromise,Mv=fr();function EF(n){return Mv.access(n).then(()=>!0).catch(()=>!1)}o(EF,"pathExists");Vv.exports={pathExists:SF(EF),pathExistsSync:Mv.existsSync}});var Ug=v((eB,$v)=>{"use strict";var La=fr(),TF=Ct().fromPromise;async function AF(n,e,t){let r=await La.open(n,"r+"),i=null;try{await La.futimes(r,e,t)}finally{try{await La.close(r)}catch(s){i=s}}if(i)throw i}o(AF,"utimesMillis");function xF(n,e,t){let r=La.openSync(n,"r+");return La.futimesSync(r,e,t),La.closeSync(r)}o(xF,"utimesMillisSync");$v.exports={utimesMillis:TF(AF),utimesMillisSync:xF}});var Ps=v((rB,Gv)=>{"use strict";var ja=fr(),Ot=require("path"),Bv=Ct().fromPromise;function CF(n,e,t){let r=t.dereference?i=>ja.stat(i,{bigint:!0}):i=>ja.lstat(i,{bigint:!0});return Promise.all([r(n),r(e).catch(i=>{if(i.code==="ENOENT")return null;throw i})]).then(([i,s])=>({srcStat:i,destStat:s}))}o(CF,"getStats");function OF(n,e,t){let r,i=t.dereference?a=>ja.statSync(a,{bigint:!0}):a=>ja.lstatSync(a,{bigint:!0}),s=i(n);try{r=i(e)}catch(a){if(a.code==="ENOENT")return{srcStat:s,destStat:null};throw a}return{srcStat:s,destStat:r}}o(OF,"getStatsSync");async function DF(n,e,t,r){let{srcStat:i,destStat:s}=await CF(n,e,r);if(s){if(Go(i,s)){let a=Ot.basename(n),c=Ot.basename(e);if(t==="move"&&a!==c&&a.toLowerCase()===c.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${n}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${n}'.`)}if(i.isDirectory()&&qg(n,e))throw new Error(sf(n,e,t));return{srcStat:i,destStat:s}}o(DF,"checkPaths");function IF(n,e,t,r){let{srcStat:i,destStat:s}=OF(n,e,r);if(s){if(Go(i,s)){let a=Ot.basename(n),c=Ot.basename(e);if(t==="move"&&a!==c&&a.toLowerCase()===c.toLowerCase())return{srcStat:i,destStat:s,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!s.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${n}'.`);if(!i.isDirectory()&&s.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${n}'.`)}if(i.isDirectory()&&qg(n,e))throw new Error(sf(n,e,t));return{srcStat:i,destStat:s}}o(IF,"checkPathsSync");async function Uv(n,e,t,r){let i=Ot.resolve(Ot.dirname(n)),s=Ot.resolve(Ot.dirname(t));if(s===i||s===Ot.parse(s).root)return;let a;try{a=await ja.stat(s,{bigint:!0})}catch(c){if(c.code==="ENOENT")return;throw c}if(Go(e,a))throw new Error(sf(n,t,r));return Uv(n,e,s,r)}o(Uv,"checkParentPaths");function qv(n,e,t,r){let i=Ot.resolve(Ot.dirname(n)),s=Ot.resolve(Ot.dirname(t));if(s===i||s===Ot.parse(s).root)return;let a;try{a=ja.statSync(s,{bigint:!0})}catch(c){if(c.code==="ENOENT")return;throw c}if(Go(e,a))throw new Error(sf(n,t,r));return qv(n,e,s,r)}o(qv,"checkParentPathsSync");function Go(n,e){return e.ino!==void 0&&e.dev!==void 0&&e.ino===n.ino&&e.dev===n.dev}o(Go,"areIdentical");function qg(n,e){let t=Ot.resolve(n).split(Ot.sep).filter(i=>i),r=Ot.resolve(e).split(Ot.sep).filter(i=>i);return t.every((i,s)=>r[s]===i)}o(qg,"isSrcSubdir");function sf(n,e,t){return`Cannot ${t} '${n}' to a subdirectory of itself, '${e}'.`}o(sf,"errMsg");Gv.exports={checkPaths:Bv(DF),checkPathsSync:IF,checkParentPaths:Bv(Uv),checkParentPathsSync:qv,isSrcSubdir:qg,areIdentical:Go}});var zv=v((iB,Wv)=>{"use strict";async function PF(n,e){let t=[];for await(let r of n)t.push(e(r).then(()=>null,i=>i??new Error("unknown error")));await Promise.all(t.map(r=>r.then(i=>{if(i!==null)throw i})))}o(PF,"asyncIteratorConcurrentProcess");Wv.exports={asyncIteratorConcurrentProcess:PF}});var Xv=v((aB,Yv)=>{"use strict";var Yt=fr(),Wo=require("path"),{mkdirs:FF}=mn(),{pathExists:RF}=ki(),{utimesMillis:NF}=Ug(),zo=Ps(),{asyncIteratorConcurrentProcess:kF}=zv();async function LF(n,e,t={}){typeof t=="function"&&(t={filter:t}),t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0001");let{srcStat:r,destStat:i}=await zo.checkPaths(n,e,"copy",t);if(await zo.checkParentPaths(n,r,e,"copy"),!await Kv(n,e,t))return;let a=Wo.dirname(e);await RF(a)||await FF(a),await Qv(i,n,e,t)}o(LF,"copy");async function Kv(n,e,t){return t.filter?t.filter(n,e):!0}o(Kv,"runFilter");async function Qv(n,e,t,r){let s=await(r.dereference?Yt.stat:Yt.lstat)(e);if(s.isDirectory())return $F(s,n,e,t,r);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return jF(s,n,e,t,r);if(s.isSymbolicLink())return BF(n,e,t,r);throw s.isSocket()?new Error(`Cannot copy a socket file: ${e}`):s.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}o(Qv,"getStatsAndPerformCopy");async function jF(n,e,t,r,i){if(!e)return Hv(n,t,r,i);if(i.overwrite)return await Yt.unlink(r),Hv(n,t,r,i);if(i.errorOnExist)throw new Error(`'${r}' already exists`)}o(jF,"onFile");async function Hv(n,e,t,r){if(await Yt.copyFile(e,t),r.preserveTimestamps){MF(n.mode)&&await VF(t,n.mode);let i=await Yt.stat(e);await NF(t,i.atime,i.mtime)}return Yt.chmod(t,n.mode)}o(Hv,"copyFile");function MF(n){return(n&128)===0}o(MF,"fileIsNotWritable");function VF(n,e){return Yt.chmod(n,e|128)}o(VF,"makeFileWritable");async function $F(n,e,t,r,i){e||await Yt.mkdir(r),await kF(await Yt.opendir(t),async s=>{let a=Wo.join(t,s.name),c=Wo.join(r,s.name);if(await Kv(a,c,i)){let{destStat:l}=await zo.checkPaths(a,c,"copy",i);await Qv(l,a,c,i)}}),e||await Yt.chmod(r,n.mode)}o($F,"onDir");async function BF(n,e,t,r){let i=await Yt.readlink(e);if(r.dereference&&(i=Wo.resolve(process.cwd(),i)),!n)return Yt.symlink(i,t);let s=null;try{s=await Yt.readlink(t)}catch(a){if(a.code==="EINVAL"||a.code==="UNKNOWN")return Yt.symlink(i,t);throw a}if(r.dereference&&(s=Wo.resolve(process.cwd(),s)),zo.isSrcSubdir(i,s))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${s}'.`);if(zo.isSrcSubdir(s,i))throw new Error(`Cannot overwrite '${s}' with '${i}'.`);return await Yt.unlink(t),Yt.symlink(i,t)}o(BF,"onLink");Yv.exports=LF});var rw=v((cB,tw)=>{"use strict";var hr=ka(),Ho=require("path"),UF=mn().mkdirsSync,qF=Ug().utimesMillisSync,Ko=Ps();function GF(n,e,t){typeof t=="function"&&(t={filter:t}),t=t||{},t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.preserveTimestamps&&process.arch==="ia32"&&process.emitWarning(`Using the preserveTimestamps option in 32-bit node is not recommended;

	see https://github.com/jprichardson/node-fs-extra/issues/269`,"Warning","fs-extra-WARN0002");let{srcStat:r,destStat:i}=Ko.checkPathsSync(n,e,"copy",t);if(Ko.checkParentPathsSync(n,r,e,"copy"),t.filter&&!t.filter(n,e))return;let s=Ho.dirname(e);return hr.existsSync(s)||UF(s),Jv(i,n,e,t)}o(GF,"copySync");function Jv(n,e,t,r){let s=(r.dereference?hr.statSync:hr.lstatSync)(e);if(s.isDirectory())return XF(s,n,e,t,r);if(s.isFile()||s.isCharacterDevice()||s.isBlockDevice())return WF(s,n,e,t,r);if(s.isSymbolicLink())return e5(n,e,t,r);throw s.isSocket()?new Error(`Cannot copy a socket file: ${e}`):s.isFIFO()?new Error(`Cannot copy a FIFO pipe: ${e}`):new Error(`Unknown file: ${e}`)}o(Jv,"getStats");function WF(n,e,t,r,i){return e?zF(n,t,r,i):Zv(n,t,r,i)}o(WF,"onFile");function zF(n,e,t,r){if(r.overwrite)return hr.unlinkSync(t),Zv(n,e,t,r);if(r.errorOnExist)throw new Error(`'${t}' already exists`)}o(zF,"mayCopyFile");function Zv(n,e,t,r){return hr.copyFileSync(e,t),r.preserveTimestamps&&HF(n.mode,e,t),Gg(t,n.mode)}o(Zv,"copyFile");function HF(n,e,t){return KF(n)&&QF(t,n),YF(e,t)}o(HF,"handleTimestamps");function KF(n){return(n&128)===0}o(KF,"fileIsNotWritable");function QF(n,e){return Gg(n,e|128)}o(QF,"makeFileWritable");function Gg(n,e){return hr.chmodSync(n,e)}o(Gg,"setDestMode");function YF(n,e){let t=hr.statSync(n);return qF(e,t.atime,t.mtime)}o(YF,"setDestTimestamps");function XF(n,e,t,r,i){return e?ew(t,r,i):JF(n.mode,t,r,i)}o(XF,"onDir");function JF(n,e,t,r){return hr.mkdirSync(t),ew(e,t,r),Gg(t,n)}o(JF,"mkDirAndCopy");function ew(n,e,t){let r=hr.opendirSync(n);try{let i;for(;(i=r.readSync())!==null;)ZF(i.name,n,e,t)}finally{r.closeSync()}}o(ew,"copyDir");function ZF(n,e,t,r){let i=Ho.join(e,n),s=Ho.join(t,n);if(r.filter&&!r.filter(i,s))return;let{destStat:a}=Ko.checkPathsSync(i,s,"copy",r);return Jv(a,i,s,r)}o(ZF,"copyDirItem");function e5(n,e,t,r){let i=hr.readlinkSync(e);if(r.dereference&&(i=Ho.resolve(process.cwd(),i)),n){let s;try{s=hr.readlinkSync(t)}catch(a){if(a.code==="EINVAL"||a.code==="UNKNOWN")return hr.symlinkSync(i,t);throw a}if(r.dereference&&(s=Ho.resolve(process.cwd(),s)),Ko.isSrcSubdir(i,s))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${s}'.`);if(Ko.isSrcSubdir(s,i))throw new Error(`Cannot overwrite '${s}' with '${i}'.`);return t5(i,t)}else return hr.symlinkSync(i,t)}o(e5,"onLink");function t5(n,e){return hr.unlinkSync(e),hr.symlinkSync(n,e)}o(t5,"copyLink");tw.exports=GF});var af=v((lB,nw)=>{"use strict";var r5=Ct().fromPromise;nw.exports={copy:r5(Xv()),copySync:rw()}});var Qo=v((fB,sw)=>{"use strict";var iw=ka(),n5=Ct().fromCallback;function i5(n,e){iw.rm(n,{recursive:!0,force:!0},e)}o(i5,"remove");function s5(n){iw.rmSync(n,{recursive:!0,force:!0})}o(s5,"removeSync");sw.exports={remove:n5(i5),removeSync:s5}});var dw=v((dB,hw)=>{"use strict";var a5=Ct().fromPromise,cw=fr(),uw=require("path"),lw=mn(),fw=Qo(),aw=a5(o(async function(e){let t;try{t=await cw.readdir(e)}catch{return lw.mkdirs(e)}return Promise.all(t.map(r=>fw.remove(uw.join(e,r))))},"emptyDir"));function ow(n){let e;try{e=cw.readdirSync(n)}catch{return lw.mkdirsSync(n)}e.forEach(t=>{t=uw.join(n,t),fw.removeSync(t)})}o(ow,"emptyDirSync");hw.exports={emptyDirSync:ow,emptydirSync:ow,emptyDir:aw,emptydir:aw}});var yw=v((mB,gw)=>{"use strict";var o5=Ct().fromPromise,pw=require("path"),li=fr(),mw=mn();async function c5(n){let e;try{e=await li.stat(n)}catch{}if(e&&e.isFile())return;let t=pw.dirname(n),r=null;try{r=await li.stat(t)}catch(i){if(i.code==="ENOENT"){await mw.mkdirs(t),await li.writeFile(n,"");return}else throw i}r.isDirectory()?await li.writeFile(n,""):await li.readdir(t)}o(c5,"createFile");function u5(n){let e;try{e=li.statSync(n)}catch{}if(e&&e.isFile())return;let t=pw.dirname(n);try{li.statSync(t).isDirectory()||li.readdirSync(t)}catch(r){if(r&&r.code==="ENOENT")mw.mkdirsSync(t);else throw r}li.writeFileSync(n,"")}o(u5,"createFileSync");gw.exports={createFile:o5(c5),createFileSync:u5}});var Sw=v((yB,bw)=>{"use strict";var l5=Ct().fromPromise,vw=require("path"),Li=fr(),ww=mn(),{pathExists:f5}=ki(),{areIdentical:_w}=Ps();async function h5(n,e){let t;try{t=await Li.lstat(e)}catch{}let r;try{r=await Li.lstat(n)}catch(a){throw a.message=a.message.replace("lstat","ensureLink"),a}if(t&&_w(r,t))return;let i=vw.dirname(e);await f5(i)||await ww.mkdirs(i),await Li.link(n,e)}o(h5,"createLink");function d5(n,e){let t;try{t=Li.lstatSync(e)}catch{}try{let s=Li.lstatSync(n);if(t&&_w(s,t))return}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let r=vw.dirname(e);return Li.existsSync(r)||ww.mkdirsSync(r),Li.linkSync(n,e)}o(d5,"createLinkSync");bw.exports={createLink:l5(h5),createLinkSync:d5}});var Tw=v((wB,Ew)=>{"use strict";var ji=require("path"),Yo=fr(),{pathExists:p5}=ki(),m5=Ct().fromPromise;async function g5(n,e){if(ji.isAbsolute(n)){try{await Yo.lstat(n)}catch(s){throw s.message=s.message.replace("lstat","ensureSymlink"),s}return{toCwd:n,toDst:n}}let t=ji.dirname(e),r=ji.join(t,n);if(await p5(r))return{toCwd:r,toDst:n};try{await Yo.lstat(n)}catch(s){throw s.message=s.message.replace("lstat","ensureSymlink"),s}return{toCwd:n,toDst:ji.relative(t,n)}}o(g5,"symlinkPaths");function y5(n,e){if(ji.isAbsolute(n)){if(!Yo.existsSync(n))throw new Error("absolute srcpath does not exist");return{toCwd:n,toDst:n}}let t=ji.dirname(e),r=ji.join(t,n);if(Yo.existsSync(r))return{toCwd:r,toDst:n};if(!Yo.existsSync(n))throw new Error("relative srcpath does not exist");return{toCwd:n,toDst:ji.relative(t,n)}}o(y5,"symlinkPathsSync");Ew.exports={symlinkPaths:m5(g5),symlinkPathsSync:y5}});var Cw=v((bB,xw)=>{"use strict";var Aw=fr(),v5=Ct().fromPromise;async function w5(n,e){if(e)return e;let t;try{t=await Aw.lstat(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}o(w5,"symlinkType");function _5(n,e){if(e)return e;let t;try{t=Aw.lstatSync(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}o(_5,"symlinkTypeSync");xw.exports={symlinkType:v5(w5),symlinkTypeSync:_5}});var Pw=v((EB,Iw)=>{"use strict";var b5=Ct().fromPromise,Ow=require("path"),Vn=fr(),{mkdirs:S5,mkdirsSync:E5}=mn(),{symlinkPaths:T5,symlinkPathsSync:A5}=Tw(),{symlinkType:x5,symlinkTypeSync:C5}=Cw(),{pathExists:O5}=ki(),{areIdentical:Dw}=Ps();async function D5(n,e,t){let r;try{r=await Vn.lstat(e)}catch{}if(r&&r.isSymbolicLink()){let[c,u]=await Promise.all([Vn.stat(n),Vn.stat(e)]);if(Dw(c,u))return}let i=await T5(n,e);n=i.toDst;let s=await x5(i.toCwd,t),a=Ow.dirname(e);return await O5(a)||await S5(a),Vn.symlink(n,e,s)}o(D5,"createSymlink");function I5(n,e,t){let r;try{r=Vn.lstatSync(e)}catch{}if(r&&r.isSymbolicLink()){let c=Vn.statSync(n),u=Vn.statSync(e);if(Dw(c,u))return}let i=A5(n,e);n=i.toDst,t=C5(i.toCwd,t);let s=Ow.dirname(e);return Vn.existsSync(s)||E5(s),Vn.symlinkSync(n,e,t)}o(I5,"createSymlinkSync");Iw.exports={createSymlink:b5(D5),createSymlinkSync:I5}});var Vw=v((AB,Mw)=>{"use strict";var{createFile:Fw,createFileSync:Rw}=yw(),{createLink:Nw,createLinkSync:kw}=Sw(),{createSymlink:Lw,createSymlinkSync:jw}=Pw();Mw.exports={createFile:Fw,createFileSync:Rw,ensureFile:Fw,ensureFileSync:Rw,createLink:Nw,createLinkSync:kw,ensureLink:Nw,ensureLinkSync:kw,createSymlink:Lw,createSymlinkSync:jw,ensureSymlink:Lw,ensureSymlinkSync:jw}});var of=v((xB,$w)=>{function P5(n,{EOL:e=`
`,finalEOL:t=!0,replacer:r=null,spaces:i}={}){let s=t?e:"";return JSON.stringify(n,r,i).replace(/\n/g,e)+s}o(P5,"stringify");function F5(n){return Buffer.isBuffer(n)&&(n=n.toString("utf8")),n.replace(/^\uFEFF/,"")}o(F5,"stripBom");$w.exports={stringify:P5,stripBom:F5}});var Gw=v((OB,qw)=>{var Ma;try{Ma=ka()}catch{Ma=require("fs")}var cf=Ct(),{stringify:Bw,stripBom:Uw}=of();async function R5(n,e={}){typeof e=="string"&&(e={encoding:e});let t=e.fs||Ma,r="throws"in e?e.throws:!0,i=await cf.fromCallback(t.readFile)(n,e);i=Uw(i);let s;try{s=JSON.parse(i,e?e.reviver:null)}catch(a){if(r)throw a.message=`${n}: ${a.message}`,a;return null}return s}o(R5,"_readFile");var N5=cf.fromPromise(R5);function k5(n,e={}){typeof e=="string"&&(e={encoding:e});let t=e.fs||Ma,r="throws"in e?e.throws:!0;try{let i=t.readFileSync(n,e);return i=Uw(i),JSON.parse(i,e.reviver)}catch(i){if(r)throw i.message=`${n}: ${i.message}`,i;return null}}o(k5,"readFileSync");async function L5(n,e,t={}){let r=t.fs||Ma,i=Bw(e,t);await cf.fromCallback(r.writeFile)(n,i,t)}o(L5,"_writeFile");var j5=cf.fromPromise(L5);function M5(n,e,t={}){let r=t.fs||Ma,i=Bw(e,t);return r.writeFileSync(n,i,t)}o(M5,"writeFileSync");qw.exports={readFile:N5,readFileSync:k5,writeFile:j5,writeFileSync:M5}});var zw=v((IB,Ww)=>{"use strict";var uf=Gw();Ww.exports={readJson:uf.readFile,readJsonSync:uf.readFileSync,writeJson:uf.writeFile,writeJsonSync:uf.writeFileSync}});var lf=v((PB,Qw)=>{"use strict";var V5=Ct().fromPromise,Wg=fr(),Hw=require("path"),Kw=mn(),$5=ki().pathExists;async function B5(n,e,t="utf-8"){let r=Hw.dirname(n);return await $5(r)||await Kw.mkdirs(r),Wg.writeFile(n,e,t)}o(B5,"outputFile");function U5(n,...e){let t=Hw.dirname(n);Wg.existsSync(t)||Kw.mkdirsSync(t),Wg.writeFileSync(n,...e)}o(U5,"outputFileSync");Qw.exports={outputFile:V5(B5),outputFileSync:U5}});var Xw=v((RB,Yw)=>{"use strict";var{stringify:q5}=of(),{outputFile:G5}=lf();async function W5(n,e,t={}){let r=q5(e,t);await G5(n,r,t)}o(W5,"outputJson");Yw.exports=W5});var Zw=v((kB,Jw)=>{"use strict";var{stringify:z5}=of(),{outputFileSync:H5}=lf();function K5(n,e,t){let r=z5(e,t);H5(n,r,t)}o(K5,"outputJsonSync");Jw.exports=K5});var t_=v((jB,e_)=>{"use strict";var Q5=Ct().fromPromise,dr=zw();dr.outputJson=Q5(Xw());dr.outputJsonSync=Zw();dr.outputJSON=dr.outputJson;dr.outputJSONSync=dr.outputJsonSync;dr.writeJSON=dr.writeJson;dr.writeJSONSync=dr.writeJsonSync;dr.readJSON=dr.readJson;dr.readJSONSync=dr.readJsonSync;e_.exports=dr});var a_=v((MB,s_)=>{"use strict";var Y5=fr(),r_=require("path"),{copy:X5}=af(),{remove:i_}=Qo(),{mkdirp:J5}=mn(),{pathExists:Z5}=ki(),n_=Ps();async function eR(n,e,t={}){let r=t.overwrite||t.clobber||!1,{srcStat:i,isChangingCase:s=!1}=await n_.checkPaths(n,e,"move",t);await n_.checkParentPaths(n,i,e,"move");let a=r_.dirname(e);return r_.parse(a).root!==a&&await J5(a),tR(n,e,r,s)}o(eR,"move");async function tR(n,e,t,r){if(!r){if(t)await i_(e);else if(await Z5(e))throw new Error("dest already exists.")}try{await Y5.rename(n,e)}catch(i){if(i.code!=="EXDEV")throw i;await rR(n,e,t)}}o(tR,"doRename");async function rR(n,e,t){return await X5(n,e,{overwrite:t,errorOnExist:!0,preserveTimestamps:!0}),i_(n)}o(rR,"moveAcrossDevice");s_.exports=eR});var f_=v(($B,l_)=>{"use strict";var c_=ka(),Hg=require("path"),nR=af().copySync,u_=Qo().removeSync,iR=mn().mkdirpSync,o_=Ps();function sR(n,e,t){t=t||{};let r=t.overwrite||t.clobber||!1,{srcStat:i,isChangingCase:s=!1}=o_.checkPathsSync(n,e,"move",t);return o_.checkParentPathsSync(n,i,e,"move"),aR(e)||iR(Hg.dirname(e)),oR(n,e,r,s)}o(sR,"moveSync");function aR(n){let e=Hg.dirname(n);return Hg.parse(e).root===e}o(aR,"isParentRoot");function oR(n,e,t,r){if(r)return zg(n,e,t);if(t)return u_(e),zg(n,e,t);if(c_.existsSync(e))throw new Error("dest already exists.");return zg(n,e,t)}o(oR,"doRename");function zg(n,e,t){try{c_.renameSync(n,e)}catch(r){if(r.code!=="EXDEV")throw r;return cR(n,e,t)}}o(zg,"rename");function cR(n,e,t){return nR(n,e,{overwrite:t,errorOnExist:!0,preserveTimestamps:!0}),u_(n)}o(cR,"moveAcrossDevice");l_.exports=sR});var d_=v((UB,h_)=>{"use strict";var uR=Ct().fromPromise;h_.exports={move:uR(a_()),moveSync:f_()}});var Va=v((qB,p_)=>{"use strict";p_.exports={...fr(),...af(),...dw(),...Vw(),...t_(),...mn(),...d_(),...lf(),...ki(),...Qo()}});var Tb=v((bq,Eb)=>{"use strict";Eb.exports=bb;function bb(n,e,t){n instanceof RegExp&&(n=_b(n,t)),e instanceof RegExp&&(e=_b(e,t));var r=Sb(n,e,t);return r&&{start:r[0],end:r[1],pre:t.slice(0,r[0]),body:t.slice(r[0]+n.length,r[1]),post:t.slice(r[1]+e.length)}}o(bb,"balanced");function _b(n,e){var t=e.match(n);return t?t[0]:null}o(_b,"maybeMatch");bb.range=Sb;function Sb(n,e,t){var r,i,s,a,c,u=t.indexOf(n),l=t.indexOf(e,u+1),f=u;if(u>=0&&l>0){if(n===e)return[u,l];for(r=[],s=t.length;f>=0&&!c;)f==u?(r.push(f),u=t.indexOf(n,f+1)):r.length==1?c=[r.pop(),l]:(i=r.pop(),i<s&&(s=i,a=l),l=t.indexOf(e,f+1)),f=u<l&&u>=0?u:l;r.length&&(c=[s,a])}return c}o(Sb,"range")});var Fb=v((Eq,Pb)=>{var Ab=Tb();Pb.exports=N6;var xb="\0SLASH"+Math.random()+"\0",Cb="\0OPEN"+Math.random()+"\0",l0="\0CLOSE"+Math.random()+"\0",Ob="\0COMMA"+Math.random()+"\0",Db="\0PERIOD"+Math.random()+"\0";function u0(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}o(u0,"numeric");function F6(n){return n.split("\\\\").join(xb).split("\\{").join(Cb).split("\\}").join(l0).split("\\,").join(Ob).split("\\.").join(Db)}o(F6,"escapeBraces");function R6(n){return n.split(xb).join("\\").split(Cb).join("{").split(l0).join("}").split(Ob).join(",").split(Db).join(".")}o(R6,"unescapeBraces");function Ib(n){if(!n)return[""];var e=[],t=Ab("{","}",n);if(!t)return n.split(",");var r=t.pre,i=t.body,s=t.post,a=r.split(",");a[a.length-1]+="{"+i+"}";var c=Ib(s);return s.length&&(a[a.length-1]+=c.shift(),a.push.apply(a,c)),e.push.apply(e,a),e}o(Ib,"parseCommaParts");function N6(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),ac(F6(n),!0).map(R6)):[]}o(N6,"expandTop");function k6(n){return"{"+n+"}"}o(k6,"embrace");function L6(n){return/^-?0\d/.test(n)}o(L6,"isPadded");function j6(n,e){return n<=e}o(j6,"lte");function M6(n,e){return n>=e}o(M6,"gte");function ac(n,e){var t=[],r=Ab("{","}",n);if(!r)return[n];var i=r.pre,s=r.post.length?ac(r.post,!1):[""];if(/\$$/.test(r.pre))for(var a=0;a<s.length;a++){var c=i+"{"+r.body+"}"+s[a];t.push(c)}else{var u=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),l=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),f=u||l,h=r.body.indexOf(",")>=0;if(!f&&!h)return r.post.match(/,(?!,).*\}/)?(n=r.pre+"{"+r.body+l0+r.post,ac(n)):[n];var d;if(f)d=r.body.split(/\.\./);else if(d=Ib(r.body),d.length===1&&(d=ac(d[0],!1).map(k6),d.length===1))return s.map(function(ue){return r.pre+d[0]+ue});var m;if(f){var _=u0(d[0]),b=u0(d[1]),C=Math.max(d[0].length,d[1].length),O=d.length==3?Math.abs(u0(d[2])):1,I=j6,L=b<_;L&&(O*=-1,I=M6);var G=d.some(L6);m=[];for(var W=_;I(W,b);W+=O){var Fe;if(l)Fe=String.fromCharCode(W),Fe==="\\"&&(Fe="");else if(Fe=String(W),G){var Ze=C-Fe.length;if(Ze>0){var ot=new Array(Ze+1).join("0");W<0?Fe="-"+ot+Fe.slice(1):Fe=ot+Fe}}m.push(Fe)}}else{m=[];for(var B=0;B<d.length;B++)m.push.apply(m,ac(d[B],!1))}for(var B=0;B<m.length;B++)for(var a=0;a<s.length;a++){var c=i+m[B]+s[a];(!e||f||c)&&t.push(c)}}return t}o(ac,"expand")});var $z=Ye(ph());var $1=Ye(V1(),1),{program:SN,createCommand:EN,createArgument:TN,createOption:AN,CommanderError:xN,InvalidArgumentError:CN,InvalidOptionArgumentError:ON,Command:_r,Argument:DN,Option:IN,Help:PN}=$1.default;var sc=require("fs"),c0=require("path"),gr=Ye(Ri());var Tt=Ye(Va()),Jt=Ye(require("path"));function I_(n){return typeof n>"u"||n===null}o(I_,"isNothing");function lR(n){return typeof n=="object"&&n!==null}o(lR,"isObject");function fR(n){return Array.isArray(n)?n:I_(n)?[]:[n]}o(fR,"toArray");function hR(n,e){var t,r,i,s;if(e)for(s=Object.keys(e),t=0,r=s.length;t<r;t+=1)i=s[t],n[i]=e[i];return n}o(hR,"extend");function dR(n,e){var t="",r;for(r=0;r<e;r+=1)t+=n;return t}o(dR,"repeat");function pR(n){return n===0&&Number.NEGATIVE_INFINITY===1/n}o(pR,"isNegativeZero");var mR=I_,gR=lR,yR=fR,vR=dR,wR=pR,_R=hR,Et={isNothing:mR,isObject:gR,toArray:yR,repeat:vR,isNegativeZero:wR,extend:_R};function P_(n,e){var t="",r=n.reason||"(unknown reason)";return n.mark?(n.mark.name&&(t+='in "'+n.mark.name+'" '),t+="("+(n.mark.line+1)+":"+(n.mark.column+1)+")",!e&&n.mark.snippet&&(t+=`

`+n.mark.snippet),r+" "+t):r}o(P_,"formatError");function Jo(n,e){Error.call(this),this.name="YAMLException",this.reason=n,this.mark=e,this.message=P_(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}o(Jo,"YAMLException$1");Jo.prototype=Object.create(Error.prototype);Jo.prototype.constructor=Jo;Jo.prototype.toString=o(function(e){return this.name+": "+P_(this,e)},"toString");var pr=Jo;function Kg(n,e,t,r,i){var s="",a="",c=Math.floor(i/2)-1;return r-e>c&&(s=" ... ",e=r-c+s.length),t-r>c&&(a=" ...",t=r+c-a.length),{str:s+n.slice(e,t).replace(/\t/g,"\u2192")+a,pos:r-e+s.length}}o(Kg,"getLine");function Qg(n,e){return Et.repeat(" ",e-n.length)+n}o(Qg,"padStart");function bR(n,e){if(e=Object.create(e||null),!n.buffer)return null;e.maxLength||(e.maxLength=79),typeof e.indent!="number"&&(e.indent=1),typeof e.linesBefore!="number"&&(e.linesBefore=3),typeof e.linesAfter!="number"&&(e.linesAfter=2);for(var t=/\r?\n|\r|\0/g,r=[0],i=[],s,a=-1;s=t.exec(n.buffer);)i.push(s.index),r.push(s.index+s[0].length),n.position<=s.index&&a<0&&(a=r.length-2);a<0&&(a=r.length-1);var c="",u,l,f=Math.min(n.line+e.linesAfter,i.length).toString().length,h=e.maxLength-(e.indent+f+3);for(u=1;u<=e.linesBefore&&!(a-u<0);u++)l=Kg(n.buffer,r[a-u],i[a-u],n.position-(r[a]-r[a-u]),h),c=Et.repeat(" ",e.indent)+Qg((n.line-u+1).toString(),f)+" | "+l.str+`
`+c;for(l=Kg(n.buffer,r[a],i[a],n.position,h),c+=Et.repeat(" ",e.indent)+Qg((n.line+1).toString(),f)+" | "+l.str+`
`,c+=Et.repeat("-",e.indent+f+3+l.pos)+`^
`,u=1;u<=e.linesAfter&&!(a+u>=i.length);u++)l=Kg(n.buffer,r[a+u],i[a+u],n.position-(r[a]-r[a+u]),h),c+=Et.repeat(" ",e.indent)+Qg((n.line+u+1).toString(),f)+" | "+l.str+`
`;return c.replace(/\n$/,"")}o(bR,"makeSnippet");var SR=bR,ER=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],TR=["scalar","sequence","mapping"];function AR(n){var e={};return n!==null&&Object.keys(n).forEach(function(t){n[t].forEach(function(r){e[String(r)]=t})}),e}o(AR,"compileStyleAliases");function xR(n,e){if(e=e||{},Object.keys(e).forEach(function(t){if(ER.indexOf(t)===-1)throw new pr('Unknown option "'+t+'" is met in definition of "'+n+'" YAML type.')}),this.options=e,this.tag=n,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=AR(e.styleAliases||null),TR.indexOf(this.kind)===-1)throw new pr('Unknown kind "'+this.kind+'" is specified for "'+n+'" YAML type.')}o(xR,"Type$1");var $t=xR;function m_(n,e){var t=[];return n[e].forEach(function(r){var i=t.length;t.forEach(function(s,a){s.tag===r.tag&&s.kind===r.kind&&s.multi===r.multi&&(i=a)}),t[i]=r}),t}o(m_,"compileList");function CR(){var n={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},e,t;function r(i){i.multi?(n.multi[i.kind].push(i),n.multi.fallback.push(i)):n[i.kind][i.tag]=n.fallback[i.tag]=i}for(o(r,"collectType"),e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(r);return n}o(CR,"compileMap");function Xg(n){return this.extend(n)}o(Xg,"Schema$1");Xg.prototype.extend=o(function(e){var t=[],r=[];if(e instanceof $t)r.push(e);else if(Array.isArray(e))r=r.concat(e);else if(e&&(Array.isArray(e.implicit)||Array.isArray(e.explicit)))e.implicit&&(t=t.concat(e.implicit)),e.explicit&&(r=r.concat(e.explicit));else throw new pr("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.forEach(function(s){if(!(s instanceof $t))throw new pr("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new pr("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new pr("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(s){if(!(s instanceof $t))throw new pr("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var i=Object.create(Xg.prototype);return i.implicit=(this.implicit||[]).concat(t),i.explicit=(this.explicit||[]).concat(r),i.compiledImplicit=m_(i,"implicit"),i.compiledExplicit=m_(i,"explicit"),i.compiledTypeMap=CR(i.compiledImplicit,i.compiledExplicit),i},"extend");var F_=Xg,R_=new $t("tag:yaml.org,2002:str",{kind:"scalar",construct:o(function(n){return n!==null?n:""},"construct")}),N_=new $t("tag:yaml.org,2002:seq",{kind:"sequence",construct:o(function(n){return n!==null?n:[]},"construct")}),k_=new $t("tag:yaml.org,2002:map",{kind:"mapping",construct:o(function(n){return n!==null?n:{}},"construct")}),L_=new F_({explicit:[R_,N_,k_]});function OR(n){if(n===null)return!0;var e=n.length;return e===1&&n==="~"||e===4&&(n==="null"||n==="Null"||n==="NULL")}o(OR,"resolveYamlNull");function DR(){return null}o(DR,"constructYamlNull");function IR(n){return n===null}o(IR,"isNull");var j_=new $t("tag:yaml.org,2002:null",{kind:"scalar",resolve:OR,construct:DR,predicate:IR,represent:{canonical:o(function(){return"~"},"canonical"),lowercase:o(function(){return"null"},"lowercase"),uppercase:o(function(){return"NULL"},"uppercase"),camelcase:o(function(){return"Null"},"camelcase"),empty:o(function(){return""},"empty")},defaultStyle:"lowercase"});function PR(n){if(n===null)return!1;var e=n.length;return e===4&&(n==="true"||n==="True"||n==="TRUE")||e===5&&(n==="false"||n==="False"||n==="FALSE")}o(PR,"resolveYamlBoolean");function FR(n){return n==="true"||n==="True"||n==="TRUE"}o(FR,"constructYamlBoolean");function RR(n){return Object.prototype.toString.call(n)==="[object Boolean]"}o(RR,"isBoolean");var M_=new $t("tag:yaml.org,2002:bool",{kind:"scalar",resolve:PR,construct:FR,predicate:RR,represent:{lowercase:o(function(n){return n?"true":"false"},"lowercase"),uppercase:o(function(n){return n?"TRUE":"FALSE"},"uppercase"),camelcase:o(function(n){return n?"True":"False"},"camelcase")},defaultStyle:"lowercase"});function NR(n){return 48<=n&&n<=57||65<=n&&n<=70||97<=n&&n<=102}o(NR,"isHexCode");function kR(n){return 48<=n&&n<=55}o(kR,"isOctCode");function LR(n){return 48<=n&&n<=57}o(LR,"isDecCode");function jR(n){if(n===null)return!1;var e=n.length,t=0,r=!1,i;if(!e)return!1;if(i=n[t],(i==="-"||i==="+")&&(i=n[++t]),i==="0"){if(t+1===e)return!0;if(i=n[++t],i==="b"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(i!=="0"&&i!=="1")return!1;r=!0}return r&&i!=="_"}if(i==="x"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!NR(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}if(i==="o"){for(t++;t<e;t++)if(i=n[t],i!=="_"){if(!kR(n.charCodeAt(t)))return!1;r=!0}return r&&i!=="_"}}if(i==="_")return!1;for(;t<e;t++)if(i=n[t],i!=="_"){if(!LR(n.charCodeAt(t)))return!1;r=!0}return!(!r||i==="_")}o(jR,"resolveYamlInteger");function MR(n){var e=n,t=1,r;if(e.indexOf("_")!==-1&&(e=e.replace(/_/g,"")),r=e[0],(r==="-"||r==="+")&&(r==="-"&&(t=-1),e=e.slice(1),r=e[0]),e==="0")return 0;if(r==="0"){if(e[1]==="b")return t*parseInt(e.slice(2),2);if(e[1]==="x")return t*parseInt(e.slice(2),16);if(e[1]==="o")return t*parseInt(e.slice(2),8)}return t*parseInt(e,10)}o(MR,"constructYamlInteger");function VR(n){return Object.prototype.toString.call(n)==="[object Number]"&&n%1===0&&!Et.isNegativeZero(n)}o(VR,"isInteger");var V_=new $t("tag:yaml.org,2002:int",{kind:"scalar",resolve:jR,construct:MR,predicate:VR,represent:{binary:o(function(n){return n>=0?"0b"+n.toString(2):"-0b"+n.toString(2).slice(1)},"binary"),octal:o(function(n){return n>=0?"0o"+n.toString(8):"-0o"+n.toString(8).slice(1)},"octal"),decimal:o(function(n){return n.toString(10)},"decimal"),hexadecimal:o(function(n){return n>=0?"0x"+n.toString(16).toUpperCase():"-0x"+n.toString(16).toUpperCase().slice(1)},"hexadecimal")},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),$R=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function BR(n){return!(n===null||!$R.test(n)||n[n.length-1]==="_")}o(BR,"resolveYamlFloat");function UR(n){var e,t;return e=n.replace(/_/g,"").toLowerCase(),t=e[0]==="-"?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),e===".inf"?t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:e===".nan"?NaN:t*parseFloat(e,10)}o(UR,"constructYamlFloat");var qR=/^[-+]?[0-9]+e/;function GR(n,e){var t;if(isNaN(n))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===n)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===n)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(Et.isNegativeZero(n))return"-0.0";return t=n.toString(10),qR.test(t)?t.replace("e",".e"):t}o(GR,"representYamlFloat");function WR(n){return Object.prototype.toString.call(n)==="[object Number]"&&(n%1!==0||Et.isNegativeZero(n))}o(WR,"isFloat");var $_=new $t("tag:yaml.org,2002:float",{kind:"scalar",resolve:BR,construct:UR,predicate:WR,represent:GR,defaultStyle:"lowercase"}),B_=L_.extend({implicit:[j_,M_,V_,$_]}),U_=B_,q_=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),G_=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function zR(n){return n===null?!1:q_.exec(n)!==null||G_.exec(n)!==null}o(zR,"resolveYamlTimestamp");function HR(n){var e,t,r,i,s,a,c,u=0,l=null,f,h,d;if(e=q_.exec(n),e===null&&(e=G_.exec(n)),e===null)throw new Error("Date resolve error");if(t=+e[1],r=+e[2]-1,i=+e[3],!e[4])return new Date(Date.UTC(t,r,i));if(s=+e[4],a=+e[5],c=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(f=+e[10],h=+(e[11]||0),l=(f*60+h)*6e4,e[9]==="-"&&(l=-l)),d=new Date(Date.UTC(t,r,i,s,a,c,u)),l&&d.setTime(d.getTime()-l),d}o(HR,"constructYamlTimestamp");function KR(n){return n.toISOString()}o(KR,"representYamlTimestamp");var W_=new $t("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:zR,construct:HR,instanceOf:Date,represent:KR});function QR(n){return n==="<<"||n===null}o(QR,"resolveYamlMerge");var z_=new $t("tag:yaml.org,2002:merge",{kind:"scalar",resolve:QR}),r0=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function YR(n){if(n===null)return!1;var e,t,r=0,i=n.length,s=r0;for(t=0;t<i;t++)if(e=s.indexOf(n.charAt(t)),!(e>64)){if(e<0)return!1;r+=6}return r%8===0}o(YR,"resolveYamlBinary");function XR(n){var e,t,r=n.replace(/[\r\n=]/g,""),i=r.length,s=r0,a=0,c=[];for(e=0;e<i;e++)e%4===0&&e&&(c.push(a>>16&255),c.push(a>>8&255),c.push(a&255)),a=a<<6|s.indexOf(r.charAt(e));return t=i%4*6,t===0?(c.push(a>>16&255),c.push(a>>8&255),c.push(a&255)):t===18?(c.push(a>>10&255),c.push(a>>2&255)):t===12&&c.push(a>>4&255),new Uint8Array(c)}o(XR,"constructYamlBinary");function JR(n){var e="",t=0,r,i,s=n.length,a=r0;for(r=0;r<s;r++)r%3===0&&r&&(e+=a[t>>18&63],e+=a[t>>12&63],e+=a[t>>6&63],e+=a[t&63]),t=(t<<8)+n[r];return i=s%3,i===0?(e+=a[t>>18&63],e+=a[t>>12&63],e+=a[t>>6&63],e+=a[t&63]):i===2?(e+=a[t>>10&63],e+=a[t>>4&63],e+=a[t<<2&63],e+=a[64]):i===1&&(e+=a[t>>2&63],e+=a[t<<4&63],e+=a[64],e+=a[64]),e}o(JR,"representYamlBinary");function ZR(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}o(ZR,"isBinary");var H_=new $t("tag:yaml.org,2002:binary",{kind:"scalar",resolve:YR,construct:XR,predicate:ZR,represent:JR}),e9=Object.prototype.hasOwnProperty,t9=Object.prototype.toString;function r9(n){if(n===null)return!0;var e=[],t,r,i,s,a,c=n;for(t=0,r=c.length;t<r;t+=1){if(i=c[t],a=!1,t9.call(i)!=="[object Object]")return!1;for(s in i)if(e9.call(i,s))if(!a)a=!0;else return!1;if(!a)return!1;if(e.indexOf(s)===-1)e.push(s);else return!1}return!0}o(r9,"resolveYamlOmap");function n9(n){return n!==null?n:[]}o(n9,"constructYamlOmap");var K_=new $t("tag:yaml.org,2002:omap",{kind:"sequence",resolve:r9,construct:n9}),i9=Object.prototype.toString;function s9(n){if(n===null)return!0;var e,t,r,i,s,a=n;for(s=new Array(a.length),e=0,t=a.length;e<t;e+=1){if(r=a[e],i9.call(r)!=="[object Object]"||(i=Object.keys(r),i.length!==1))return!1;s[e]=[i[0],r[i[0]]]}return!0}o(s9,"resolveYamlPairs");function a9(n){if(n===null)return[];var e,t,r,i,s,a=n;for(s=new Array(a.length),e=0,t=a.length;e<t;e+=1)r=a[e],i=Object.keys(r),s[e]=[i[0],r[i[0]]];return s}o(a9,"constructYamlPairs");var Q_=new $t("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:s9,construct:a9}),o9=Object.prototype.hasOwnProperty;function c9(n){if(n===null)return!0;var e,t=n;for(e in t)if(o9.call(t,e)&&t[e]!==null)return!1;return!0}o(c9,"resolveYamlSet");function u9(n){return n!==null?n:{}}o(u9,"constructYamlSet");var Y_=new $t("tag:yaml.org,2002:set",{kind:"mapping",resolve:c9,construct:u9}),n0=U_.extend({implicit:[W_,z_],explicit:[H_,K_,Q_,Y_]}),Vi=Object.prototype.hasOwnProperty,ff=1,X_=2,J_=3,hf=4,Yg=1,l9=2,g_=3,f9=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,h9=/[\x85\u2028\u2029]/,d9=/[,\[\]\{\}]/,Z_=/^(?:!|!!|![a-z\-]+!)$/i,eb=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function y_(n){return Object.prototype.toString.call(n)}o(y_,"_class");function $n(n){return n===10||n===13}o($n,"is_EOL");function Rs(n){return n===9||n===32}o(Rs,"is_WHITE_SPACE");function Ar(n){return n===9||n===32||n===10||n===13}o(Ar,"is_WS_OR_EOL");function Ba(n){return n===44||n===91||n===93||n===123||n===125}o(Ba,"is_FLOW_INDICATOR");function p9(n){var e;return 48<=n&&n<=57?n-48:(e=n|32,97<=e&&e<=102?e-97+10:-1)}o(p9,"fromHexCode");function m9(n){return n===120?2:n===117?4:n===85?8:0}o(m9,"escapedHexLen");function g9(n){return 48<=n&&n<=57?n-48:-1}o(g9,"fromDecimalCode");function v_(n){return n===48?"\0":n===97?"\x07":n===98?"\b":n===116||n===9?"	":n===110?`
`:n===118?"\v":n===102?"\f":n===114?"\r":n===101?"\x1B":n===32?" ":n===34?'"':n===47?"/":n===92?"\\":n===78?"\x85":n===95?"\xA0":n===76?"\u2028":n===80?"\u2029":""}o(v_,"simpleEscapeSequence");function y9(n){return n<=65535?String.fromCharCode(n):String.fromCharCode((n-65536>>10)+55296,(n-65536&1023)+56320)}o(y9,"charFromCodepoint");function tb(n,e,t){e==="__proto__"?Object.defineProperty(n,e,{configurable:!0,enumerable:!0,writable:!0,value:t}):n[e]=t}o(tb,"setProperty");var rb=new Array(256),nb=new Array(256);for(Fs=0;Fs<256;Fs++)rb[Fs]=v_(Fs)?1:0,nb[Fs]=v_(Fs);var Fs;function v9(n,e){this.input=n,this.filename=e.filename||null,this.schema=e.schema||n0,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=n.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}o(v9,"State$1");function ib(n,e){var t={name:n.filename,buffer:n.input.slice(0,-1),position:n.position,line:n.line,column:n.position-n.lineStart};return t.snippet=SR(t),new pr(e,t)}o(ib,"generateError");function Y(n,e){throw ib(n,e)}o(Y,"throwError");function df(n,e){n.onWarning&&n.onWarning.call(null,ib(n,e))}o(df,"throwWarning");var w_={YAML:o(function(e,t,r){var i,s,a;e.version!==null&&Y(e,"duplication of %YAML directive"),r.length!==1&&Y(e,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),i===null&&Y(e,"ill-formed argument of the YAML directive"),s=parseInt(i[1],10),a=parseInt(i[2],10),s!==1&&Y(e,"unacceptable YAML version of the document"),e.version=r[0],e.checkLineBreaks=a<2,a!==1&&a!==2&&df(e,"unsupported YAML version of the document")},"handleYamlDirective"),TAG:o(function(e,t,r){var i,s;r.length!==2&&Y(e,"TAG directive accepts exactly two arguments"),i=r[0],s=r[1],Z_.test(i)||Y(e,"ill-formed tag handle (first argument) of the TAG directive"),Vi.call(e.tagMap,i)&&Y(e,'there is a previously declared suffix for "'+i+'" tag handle'),eb.test(s)||Y(e,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch{Y(e,"tag prefix is malformed: "+s)}e.tagMap[i]=s},"handleTagDirective")};function Mi(n,e,t,r){var i,s,a,c;if(e<t){if(c=n.input.slice(e,t),r)for(i=0,s=c.length;i<s;i+=1)a=c.charCodeAt(i),a===9||32<=a&&a<=1114111||Y(n,"expected valid JSON character");else f9.test(c)&&Y(n,"the stream contains non-printable characters");n.result+=c}}o(Mi,"captureSegment");function __(n,e,t,r){var i,s,a,c;for(Et.isObject(t)||Y(n,"cannot merge mappings; the provided source object is unacceptable"),i=Object.keys(t),a=0,c=i.length;a<c;a+=1)s=i[a],Vi.call(e,s)||(tb(e,s,t[s]),r[s]=!0)}o(__,"mergeMappings");function Ua(n,e,t,r,i,s,a,c,u){var l,f;if(Array.isArray(i))for(i=Array.prototype.slice.call(i),l=0,f=i.length;l<f;l+=1)Array.isArray(i[l])&&Y(n,"nested arrays are not supported inside keys"),typeof i=="object"&&y_(i[l])==="[object Object]"&&(i[l]="[object Object]");if(typeof i=="object"&&y_(i)==="[object Object]"&&(i="[object Object]"),i=String(i),e===null&&(e={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(s))for(l=0,f=s.length;l<f;l+=1)__(n,e,s[l],t);else __(n,e,s,t);else!n.json&&!Vi.call(t,i)&&Vi.call(e,i)&&(n.line=a||n.line,n.lineStart=c||n.lineStart,n.position=u||n.position,Y(n,"duplicated mapping key")),tb(e,i,s),delete t[i];return e}o(Ua,"storeMappingPair");function i0(n){var e;e=n.input.charCodeAt(n.position),e===10?n.position++:e===13?(n.position++,n.input.charCodeAt(n.position)===10&&n.position++):Y(n,"a line break is expected"),n.line+=1,n.lineStart=n.position,n.firstTabInLine=-1}o(i0,"readLineBreak");function _t(n,e,t){for(var r=0,i=n.input.charCodeAt(n.position);i!==0;){for(;Rs(i);)i===9&&n.firstTabInLine===-1&&(n.firstTabInLine=n.position),i=n.input.charCodeAt(++n.position);if(e&&i===35)do i=n.input.charCodeAt(++n.position);while(i!==10&&i!==13&&i!==0);if($n(i))for(i0(n),i=n.input.charCodeAt(n.position),r++,n.lineIndent=0;i===32;)n.lineIndent++,i=n.input.charCodeAt(++n.position);else break}return t!==-1&&r!==0&&n.lineIndent<t&&df(n,"deficient indentation"),r}o(_t,"skipSeparationSpace");function gf(n){var e=n.position,t;return t=n.input.charCodeAt(e),!!((t===45||t===46)&&t===n.input.charCodeAt(e+1)&&t===n.input.charCodeAt(e+2)&&(e+=3,t=n.input.charCodeAt(e),t===0||Ar(t)))}o(gf,"testDocumentSeparator");function s0(n,e){e===1?n.result+=" ":e>1&&(n.result+=Et.repeat(`
`,e-1))}o(s0,"writeFoldedLines");function w9(n,e,t){var r,i,s,a,c,u,l,f,h=n.kind,d=n.result,m;if(m=n.input.charCodeAt(n.position),Ar(m)||Ba(m)||m===35||m===38||m===42||m===33||m===124||m===62||m===39||m===34||m===37||m===64||m===96||(m===63||m===45)&&(i=n.input.charCodeAt(n.position+1),Ar(i)||t&&Ba(i)))return!1;for(n.kind="scalar",n.result="",s=a=n.position,c=!1;m!==0;){if(m===58){if(i=n.input.charCodeAt(n.position+1),Ar(i)||t&&Ba(i))break}else if(m===35){if(r=n.input.charCodeAt(n.position-1),Ar(r))break}else{if(n.position===n.lineStart&&gf(n)||t&&Ba(m))break;if($n(m))if(u=n.line,l=n.lineStart,f=n.lineIndent,_t(n,!1,-1),n.lineIndent>=e){c=!0,m=n.input.charCodeAt(n.position);continue}else{n.position=a,n.line=u,n.lineStart=l,n.lineIndent=f;break}}c&&(Mi(n,s,a,!1),s0(n,n.line-u),s=a=n.position,c=!1),Rs(m)||(a=n.position+1),m=n.input.charCodeAt(++n.position)}return Mi(n,s,a,!1),n.result?!0:(n.kind=h,n.result=d,!1)}o(w9,"readPlainScalar");function _9(n,e){var t,r,i;if(t=n.input.charCodeAt(n.position),t!==39)return!1;for(n.kind="scalar",n.result="",n.position++,r=i=n.position;(t=n.input.charCodeAt(n.position))!==0;)if(t===39)if(Mi(n,r,n.position,!0),t=n.input.charCodeAt(++n.position),t===39)r=n.position,n.position++,i=n.position;else return!0;else $n(t)?(Mi(n,r,i,!0),s0(n,_t(n,!1,e)),r=i=n.position):n.position===n.lineStart&&gf(n)?Y(n,"unexpected end of the document within a single quoted scalar"):(n.position++,i=n.position);Y(n,"unexpected end of the stream within a single quoted scalar")}o(_9,"readSingleQuotedScalar");function b9(n,e){var t,r,i,s,a,c;if(c=n.input.charCodeAt(n.position),c!==34)return!1;for(n.kind="scalar",n.result="",n.position++,t=r=n.position;(c=n.input.charCodeAt(n.position))!==0;){if(c===34)return Mi(n,t,n.position,!0),n.position++,!0;if(c===92){if(Mi(n,t,n.position,!0),c=n.input.charCodeAt(++n.position),$n(c))_t(n,!1,e);else if(c<256&&rb[c])n.result+=nb[c],n.position++;else if((a=m9(c))>0){for(i=a,s=0;i>0;i--)c=n.input.charCodeAt(++n.position),(a=p9(c))>=0?s=(s<<4)+a:Y(n,"expected hexadecimal character");n.result+=y9(s),n.position++}else Y(n,"unknown escape sequence");t=r=n.position}else $n(c)?(Mi(n,t,r,!0),s0(n,_t(n,!1,e)),t=r=n.position):n.position===n.lineStart&&gf(n)?Y(n,"unexpected end of the document within a double quoted scalar"):(n.position++,r=n.position)}Y(n,"unexpected end of the stream within a double quoted scalar")}o(b9,"readDoubleQuotedScalar");function S9(n,e){var t=!0,r,i,s,a=n.tag,c,u=n.anchor,l,f,h,d,m,_=Object.create(null),b,C,O,I;if(I=n.input.charCodeAt(n.position),I===91)f=93,m=!1,c=[];else if(I===123)f=125,m=!0,c={};else return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=c),I=n.input.charCodeAt(++n.position);I!==0;){if(_t(n,!0,e),I=n.input.charCodeAt(n.position),I===f)return n.position++,n.tag=a,n.anchor=u,n.kind=m?"mapping":"sequence",n.result=c,!0;t?I===44&&Y(n,"expected the node content, but found ','"):Y(n,"missed comma between flow collection entries"),C=b=O=null,h=d=!1,I===63&&(l=n.input.charCodeAt(n.position+1),Ar(l)&&(h=d=!0,n.position++,_t(n,!0,e))),r=n.line,i=n.lineStart,s=n.position,qa(n,e,ff,!1,!0),C=n.tag,b=n.result,_t(n,!0,e),I=n.input.charCodeAt(n.position),(d||n.line===r)&&I===58&&(h=!0,I=n.input.charCodeAt(++n.position),_t(n,!0,e),qa(n,e,ff,!1,!0),O=n.result),m?Ua(n,c,_,C,b,O,r,i,s):h?c.push(Ua(n,null,_,C,b,O,r,i,s)):c.push(b),_t(n,!0,e),I=n.input.charCodeAt(n.position),I===44?(t=!0,I=n.input.charCodeAt(++n.position)):t=!1}Y(n,"unexpected end of the stream within a flow collection")}o(S9,"readFlowCollection");function E9(n,e){var t,r,i=Yg,s=!1,a=!1,c=e,u=0,l=!1,f,h;if(h=n.input.charCodeAt(n.position),h===124)r=!1;else if(h===62)r=!0;else return!1;for(n.kind="scalar",n.result="";h!==0;)if(h=n.input.charCodeAt(++n.position),h===43||h===45)Yg===i?i=h===43?g_:l9:Y(n,"repeat of a chomping mode identifier");else if((f=g9(h))>=0)f===0?Y(n,"bad explicit indentation width of a block scalar; it cannot be less than one"):a?Y(n,"repeat of an indentation width identifier"):(c=e+f-1,a=!0);else break;if(Rs(h)){do h=n.input.charCodeAt(++n.position);while(Rs(h));if(h===35)do h=n.input.charCodeAt(++n.position);while(!$n(h)&&h!==0)}for(;h!==0;){for(i0(n),n.lineIndent=0,h=n.input.charCodeAt(n.position);(!a||n.lineIndent<c)&&h===32;)n.lineIndent++,h=n.input.charCodeAt(++n.position);if(!a&&n.lineIndent>c&&(c=n.lineIndent),$n(h)){u++;continue}if(n.lineIndent<c){i===g_?n.result+=Et.repeat(`
`,s?1+u:u):i===Yg&&s&&(n.result+=`
`);break}for(r?Rs(h)?(l=!0,n.result+=Et.repeat(`
`,s?1+u:u)):l?(l=!1,n.result+=Et.repeat(`
`,u+1)):u===0?s&&(n.result+=" "):n.result+=Et.repeat(`
`,u):n.result+=Et.repeat(`
`,s?1+u:u),s=!0,a=!0,u=0,t=n.position;!$n(h)&&h!==0;)h=n.input.charCodeAt(++n.position);Mi(n,t,n.position,!1)}return!0}o(E9,"readBlockScalar");function b_(n,e){var t,r=n.tag,i=n.anchor,s=[],a,c=!1,u;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=s),u=n.input.charCodeAt(n.position);u!==0&&(n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,Y(n,"tab characters must not be used in indentation")),!(u!==45||(a=n.input.charCodeAt(n.position+1),!Ar(a))));){if(c=!0,n.position++,_t(n,!0,-1)&&n.lineIndent<=e){s.push(null),u=n.input.charCodeAt(n.position);continue}if(t=n.line,qa(n,e,J_,!1,!0),s.push(n.result),_t(n,!0,-1),u=n.input.charCodeAt(n.position),(n.line===t||n.lineIndent>e)&&u!==0)Y(n,"bad indentation of a sequence entry");else if(n.lineIndent<e)break}return c?(n.tag=r,n.anchor=i,n.kind="sequence",n.result=s,!0):!1}o(b_,"readBlockSequence");function T9(n,e,t){var r,i,s,a,c,u,l=n.tag,f=n.anchor,h={},d=Object.create(null),m=null,_=null,b=null,C=!1,O=!1,I;if(n.firstTabInLine!==-1)return!1;for(n.anchor!==null&&(n.anchorMap[n.anchor]=h),I=n.input.charCodeAt(n.position);I!==0;){if(!C&&n.firstTabInLine!==-1&&(n.position=n.firstTabInLine,Y(n,"tab characters must not be used in indentation")),r=n.input.charCodeAt(n.position+1),s=n.line,(I===63||I===58)&&Ar(r))I===63?(C&&(Ua(n,h,d,m,_,null,a,c,u),m=_=b=null),O=!0,C=!0,i=!0):C?(C=!1,i=!0):Y(n,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),n.position+=1,I=r;else{if(a=n.line,c=n.lineStart,u=n.position,!qa(n,t,X_,!1,!0))break;if(n.line===s){for(I=n.input.charCodeAt(n.position);Rs(I);)I=n.input.charCodeAt(++n.position);if(I===58)I=n.input.charCodeAt(++n.position),Ar(I)||Y(n,"a whitespace character is expected after the key-value separator within a block mapping"),C&&(Ua(n,h,d,m,_,null,a,c,u),m=_=b=null),O=!0,C=!1,i=!1,m=n.tag,_=n.result;else if(O)Y(n,"can not read an implicit mapping pair; a colon is missed");else return n.tag=l,n.anchor=f,!0}else if(O)Y(n,"can not read a block mapping entry; a multiline key may not be an implicit key");else return n.tag=l,n.anchor=f,!0}if((n.line===s||n.lineIndent>e)&&(C&&(a=n.line,c=n.lineStart,u=n.position),qa(n,e,hf,!0,i)&&(C?_=n.result:b=n.result),C||(Ua(n,h,d,m,_,b,a,c,u),m=_=b=null),_t(n,!0,-1),I=n.input.charCodeAt(n.position)),(n.line===s||n.lineIndent>e)&&I!==0)Y(n,"bad indentation of a mapping entry");else if(n.lineIndent<e)break}return C&&Ua(n,h,d,m,_,null,a,c,u),O&&(n.tag=l,n.anchor=f,n.kind="mapping",n.result=h),O}o(T9,"readBlockMapping");function A9(n){var e,t=!1,r=!1,i,s,a;if(a=n.input.charCodeAt(n.position),a!==33)return!1;if(n.tag!==null&&Y(n,"duplication of a tag property"),a=n.input.charCodeAt(++n.position),a===60?(t=!0,a=n.input.charCodeAt(++n.position)):a===33?(r=!0,i="!!",a=n.input.charCodeAt(++n.position)):i="!",e=n.position,t){do a=n.input.charCodeAt(++n.position);while(a!==0&&a!==62);n.position<n.length?(s=n.input.slice(e,n.position),a=n.input.charCodeAt(++n.position)):Y(n,"unexpected end of the stream within a verbatim tag")}else{for(;a!==0&&!Ar(a);)a===33&&(r?Y(n,"tag suffix cannot contain exclamation marks"):(i=n.input.slice(e-1,n.position+1),Z_.test(i)||Y(n,"named tag handle cannot contain such characters"),r=!0,e=n.position+1)),a=n.input.charCodeAt(++n.position);s=n.input.slice(e,n.position),d9.test(s)&&Y(n,"tag suffix cannot contain flow indicator characters")}s&&!eb.test(s)&&Y(n,"tag name cannot contain such characters: "+s);try{s=decodeURIComponent(s)}catch{Y(n,"tag name is malformed: "+s)}return t?n.tag=s:Vi.call(n.tagMap,i)?n.tag=n.tagMap[i]+s:i==="!"?n.tag="!"+s:i==="!!"?n.tag="tag:yaml.org,2002:"+s:Y(n,'undeclared tag handle "'+i+'"'),!0}o(A9,"readTagProperty");function x9(n){var e,t;if(t=n.input.charCodeAt(n.position),t!==38)return!1;for(n.anchor!==null&&Y(n,"duplication of an anchor property"),t=n.input.charCodeAt(++n.position),e=n.position;t!==0&&!Ar(t)&&!Ba(t);)t=n.input.charCodeAt(++n.position);return n.position===e&&Y(n,"name of an anchor node must contain at least one character"),n.anchor=n.input.slice(e,n.position),!0}o(x9,"readAnchorProperty");function C9(n){var e,t,r;if(r=n.input.charCodeAt(n.position),r!==42)return!1;for(r=n.input.charCodeAt(++n.position),e=n.position;r!==0&&!Ar(r)&&!Ba(r);)r=n.input.charCodeAt(++n.position);return n.position===e&&Y(n,"name of an alias node must contain at least one character"),t=n.input.slice(e,n.position),Vi.call(n.anchorMap,t)||Y(n,'unidentified alias "'+t+'"'),n.result=n.anchorMap[t],_t(n,!0,-1),!0}o(C9,"readAlias");function qa(n,e,t,r,i){var s,a,c,u=1,l=!1,f=!1,h,d,m,_,b,C;if(n.listener!==null&&n.listener("open",n),n.tag=null,n.anchor=null,n.kind=null,n.result=null,s=a=c=hf===t||J_===t,r&&_t(n,!0,-1)&&(l=!0,n.lineIndent>e?u=1:n.lineIndent===e?u=0:n.lineIndent<e&&(u=-1)),u===1)for(;A9(n)||x9(n);)_t(n,!0,-1)?(l=!0,c=s,n.lineIndent>e?u=1:n.lineIndent===e?u=0:n.lineIndent<e&&(u=-1)):c=!1;if(c&&(c=l||i),(u===1||hf===t)&&(ff===t||X_===t?b=e:b=e+1,C=n.position-n.lineStart,u===1?c&&(b_(n,C)||T9(n,C,b))||S9(n,b)?f=!0:(a&&E9(n,b)||_9(n,b)||b9(n,b)?f=!0:C9(n)?(f=!0,(n.tag!==null||n.anchor!==null)&&Y(n,"alias node should not have any properties")):w9(n,b,ff===t)&&(f=!0,n.tag===null&&(n.tag="?")),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):u===0&&(f=c&&b_(n,C))),n.tag===null)n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);else if(n.tag==="?"){for(n.result!==null&&n.kind!=="scalar"&&Y(n,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+n.kind+'"'),h=0,d=n.implicitTypes.length;h<d;h+=1)if(_=n.implicitTypes[h],_.resolve(n.result)){n.result=_.construct(n.result),n.tag=_.tag,n.anchor!==null&&(n.anchorMap[n.anchor]=n.result);break}}else if(n.tag!=="!"){if(Vi.call(n.typeMap[n.kind||"fallback"],n.tag))_=n.typeMap[n.kind||"fallback"][n.tag];else for(_=null,m=n.typeMap.multi[n.kind||"fallback"],h=0,d=m.length;h<d;h+=1)if(n.tag.slice(0,m[h].tag.length)===m[h].tag){_=m[h];break}_||Y(n,"unknown tag !<"+n.tag+">"),n.result!==null&&_.kind!==n.kind&&Y(n,"unacceptable node kind for !<"+n.tag+'> tag; it should be "'+_.kind+'", not "'+n.kind+'"'),_.resolve(n.result,n.tag)?(n.result=_.construct(n.result,n.tag),n.anchor!==null&&(n.anchorMap[n.anchor]=n.result)):Y(n,"cannot resolve a node with !<"+n.tag+"> explicit tag")}return n.listener!==null&&n.listener("close",n),n.tag!==null||n.anchor!==null||f}o(qa,"composeNode");function O9(n){var e=n.position,t,r,i,s=!1,a;for(n.version=null,n.checkLineBreaks=n.legacy,n.tagMap=Object.create(null),n.anchorMap=Object.create(null);(a=n.input.charCodeAt(n.position))!==0&&(_t(n,!0,-1),a=n.input.charCodeAt(n.position),!(n.lineIndent>0||a!==37));){for(s=!0,a=n.input.charCodeAt(++n.position),t=n.position;a!==0&&!Ar(a);)a=n.input.charCodeAt(++n.position);for(r=n.input.slice(t,n.position),i=[],r.length<1&&Y(n,"directive name must not be less than one character in length");a!==0;){for(;Rs(a);)a=n.input.charCodeAt(++n.position);if(a===35){do a=n.input.charCodeAt(++n.position);while(a!==0&&!$n(a));break}if($n(a))break;for(t=n.position;a!==0&&!Ar(a);)a=n.input.charCodeAt(++n.position);i.push(n.input.slice(t,n.position))}a!==0&&i0(n),Vi.call(w_,r)?w_[r](n,r,i):df(n,'unknown document directive "'+r+'"')}if(_t(n,!0,-1),n.lineIndent===0&&n.input.charCodeAt(n.position)===45&&n.input.charCodeAt(n.position+1)===45&&n.input.charCodeAt(n.position+2)===45?(n.position+=3,_t(n,!0,-1)):s&&Y(n,"directives end mark is expected"),qa(n,n.lineIndent-1,hf,!1,!0),_t(n,!0,-1),n.checkLineBreaks&&h9.test(n.input.slice(e,n.position))&&df(n,"non-ASCII line breaks are interpreted as content"),n.documents.push(n.result),n.position===n.lineStart&&gf(n)){n.input.charCodeAt(n.position)===46&&(n.position+=3,_t(n,!0,-1));return}if(n.position<n.length-1)Y(n,"end of the stream or a document separator is expected");else return}o(O9,"readDocument");function sb(n,e){n=String(n),e=e||{},n.length!==0&&(n.charCodeAt(n.length-1)!==10&&n.charCodeAt(n.length-1)!==13&&(n+=`
`),n.charCodeAt(0)===65279&&(n=n.slice(1)));var t=new v9(n,e),r=n.indexOf("\0");for(r!==-1&&(t.position=r,Y(t,"null byte is not allowed in input")),t.input+="\0";t.input.charCodeAt(t.position)===32;)t.lineIndent+=1,t.position+=1;for(;t.position<t.length-1;)O9(t);return t.documents}o(sb,"loadDocuments");function D9(n,e,t){e!==null&&typeof e=="object"&&typeof t>"u"&&(t=e,e=null);var r=sb(n,t);if(typeof e!="function")return r;for(var i=0,s=r.length;i<s;i+=1)e(r[i])}o(D9,"loadAll$1");function I9(n,e){var t=sb(n,e);if(t.length!==0){if(t.length===1)return t[0];throw new pr("expected a single document in the stream, but found more")}}o(I9,"load$1");var P9=D9,F9=I9,ab={loadAll:P9,load:F9},ob=Object.prototype.toString,cb=Object.prototype.hasOwnProperty,a0=65279,R9=9,Zo=10,N9=13,k9=32,L9=33,j9=34,Jg=35,M9=37,V9=38,$9=39,B9=42,ub=44,U9=45,pf=58,q9=61,G9=62,W9=63,z9=64,lb=91,fb=93,H9=96,hb=123,K9=124,db=125,Xt={};Xt[0]="\\0";Xt[7]="\\a";Xt[8]="\\b";Xt[9]="\\t";Xt[10]="\\n";Xt[11]="\\v";Xt[12]="\\f";Xt[13]="\\r";Xt[27]="\\e";Xt[34]='\\"';Xt[92]="\\\\";Xt[133]="\\N";Xt[160]="\\_";Xt[8232]="\\L";Xt[8233]="\\P";var Q9=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],Y9=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function X9(n,e){var t,r,i,s,a,c,u;if(e===null)return{};for(t={},r=Object.keys(e),i=0,s=r.length;i<s;i+=1)a=r[i],c=String(e[a]),a.slice(0,2)==="!!"&&(a="tag:yaml.org,2002:"+a.slice(2)),u=n.compiledTypeMap.fallback[a],u&&cb.call(u.styleAliases,c)&&(c=u.styleAliases[c]),t[a]=c;return t}o(X9,"compileStyleMap");function J9(n){var e,t,r;if(e=n.toString(16).toUpperCase(),n<=255)t="x",r=2;else if(n<=65535)t="u",r=4;else if(n<=4294967295)t="U",r=8;else throw new pr("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+t+Et.repeat("0",r-e.length)+e}o(J9,"encodeHex");var Z9=1,ec=2;function e6(n){this.schema=n.schema||n0,this.indent=Math.max(1,n.indent||2),this.noArrayIndent=n.noArrayIndent||!1,this.skipInvalid=n.skipInvalid||!1,this.flowLevel=Et.isNothing(n.flowLevel)?-1:n.flowLevel,this.styleMap=X9(this.schema,n.styles||null),this.sortKeys=n.sortKeys||!1,this.lineWidth=n.lineWidth||80,this.noRefs=n.noRefs||!1,this.noCompatMode=n.noCompatMode||!1,this.condenseFlow=n.condenseFlow||!1,this.quotingType=n.quotingType==='"'?ec:Z9,this.forceQuotes=n.forceQuotes||!1,this.replacer=typeof n.replacer=="function"?n.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}o(e6,"State");function S_(n,e){for(var t=Et.repeat(" ",e),r=0,i=-1,s="",a,c=n.length;r<c;)i=n.indexOf(`
`,r),i===-1?(a=n.slice(r),r=c):(a=n.slice(r,i+1),r=i+1),a.length&&a!==`
`&&(s+=t),s+=a;return s}o(S_,"indentString");function Zg(n,e){return`
`+Et.repeat(" ",n.indent*e)}o(Zg,"generateNextLine");function t6(n,e){var t,r,i;for(t=0,r=n.implicitTypes.length;t<r;t+=1)if(i=n.implicitTypes[t],i.resolve(e))return!0;return!1}o(t6,"testImplicitResolving");function mf(n){return n===k9||n===R9}o(mf,"isWhitespace");function tc(n){return 32<=n&&n<=126||161<=n&&n<=55295&&n!==8232&&n!==8233||57344<=n&&n<=65533&&n!==a0||65536<=n&&n<=1114111}o(tc,"isPrintable");function E_(n){return tc(n)&&n!==a0&&n!==N9&&n!==Zo}o(E_,"isNsCharOrWhitespace");function T_(n,e,t){var r=E_(n),i=r&&!mf(n);return(t?r:r&&n!==ub&&n!==lb&&n!==fb&&n!==hb&&n!==db)&&n!==Jg&&!(e===pf&&!i)||E_(e)&&!mf(e)&&n===Jg||e===pf&&i}o(T_,"isPlainSafe");function r6(n){return tc(n)&&n!==a0&&!mf(n)&&n!==U9&&n!==W9&&n!==pf&&n!==ub&&n!==lb&&n!==fb&&n!==hb&&n!==db&&n!==Jg&&n!==V9&&n!==B9&&n!==L9&&n!==K9&&n!==q9&&n!==G9&&n!==$9&&n!==j9&&n!==M9&&n!==z9&&n!==H9}o(r6,"isPlainSafeFirst");function n6(n){return!mf(n)&&n!==pf}o(n6,"isPlainSafeLast");function Xo(n,e){var t=n.charCodeAt(e),r;return t>=55296&&t<=56319&&e+1<n.length&&(r=n.charCodeAt(e+1),r>=56320&&r<=57343)?(t-55296)*1024+r-56320+65536:t}o(Xo,"codePointAt");function pb(n){var e=/^\n* /;return e.test(n)}o(pb,"needIndentIndicator");var mb=1,e0=2,gb=3,yb=4,$a=5;function i6(n,e,t,r,i,s,a,c){var u,l=0,f=null,h=!1,d=!1,m=r!==-1,_=-1,b=r6(Xo(n,0))&&n6(Xo(n,n.length-1));if(e||a)for(u=0;u<n.length;l>=65536?u+=2:u++){if(l=Xo(n,u),!tc(l))return $a;b=b&&T_(l,f,c),f=l}else{for(u=0;u<n.length;l>=65536?u+=2:u++){if(l=Xo(n,u),l===Zo)h=!0,m&&(d=d||u-_-1>r&&n[_+1]!==" ",_=u);else if(!tc(l))return $a;b=b&&T_(l,f,c),f=l}d=d||m&&u-_-1>r&&n[_+1]!==" "}return!h&&!d?b&&!a&&!i(n)?mb:s===ec?$a:e0:t>9&&pb(n)?$a:a?s===ec?$a:e0:d?yb:gb}o(i6,"chooseScalarStyle");function s6(n,e,t,r,i){n.dump=(function(){if(e.length===0)return n.quotingType===ec?'""':"''";if(!n.noCompatMode&&(Q9.indexOf(e)!==-1||Y9.test(e)))return n.quotingType===ec?'"'+e+'"':"'"+e+"'";var s=n.indent*Math.max(1,t),a=n.lineWidth===-1?-1:Math.max(Math.min(n.lineWidth,40),n.lineWidth-s),c=r||n.flowLevel>-1&&t>=n.flowLevel;function u(l){return t6(n,l)}switch(o(u,"testAmbiguity"),i6(e,c,n.indent,a,u,n.quotingType,n.forceQuotes&&!r,i)){case mb:return e;case e0:return"'"+e.replace(/'/g,"''")+"'";case gb:return"|"+A_(e,n.indent)+x_(S_(e,s));case yb:return">"+A_(e,n.indent)+x_(S_(a6(e,a),s));case $a:return'"'+o6(e)+'"';default:throw new pr("impossible error: invalid scalar style")}})()}o(s6,"writeScalar");function A_(n,e){var t=pb(n)?String(e):"",r=n[n.length-1]===`
`,i=r&&(n[n.length-2]===`
`||n===`
`),s=i?"+":r?"":"-";return t+s+`
`}o(A_,"blockHeader");function x_(n){return n[n.length-1]===`
`?n.slice(0,-1):n}o(x_,"dropEndingNewline");function a6(n,e){for(var t=/(\n+)([^\n]*)/g,r=(function(){var l=n.indexOf(`
`);return l=l!==-1?l:n.length,t.lastIndex=l,C_(n.slice(0,l),e)})(),i=n[0]===`
`||n[0]===" ",s,a;a=t.exec(n);){var c=a[1],u=a[2];s=u[0]===" ",r+=c+(!i&&!s&&u!==""?`
`:"")+C_(u,e),i=s}return r}o(a6,"foldString");function C_(n,e){if(n===""||n[0]===" ")return n;for(var t=/ [^ ]/g,r,i=0,s,a=0,c=0,u="";r=t.exec(n);)c=r.index,c-i>e&&(s=a>i?a:c,u+=`
`+n.slice(i,s),i=s+1),a=c;return u+=`
`,n.length-i>e&&a>i?u+=n.slice(i,a)+`
`+n.slice(a+1):u+=n.slice(i),u.slice(1)}o(C_,"foldLine");function o6(n){for(var e="",t=0,r,i=0;i<n.length;t>=65536?i+=2:i++)t=Xo(n,i),r=Xt[t],!r&&tc(t)?(e+=n[i],t>=65536&&(e+=n[i+1])):e+=r||J9(t);return e}o(o6,"escapeString");function c6(n,e,t){var r="",i=n.tag,s,a,c;for(s=0,a=t.length;s<a;s+=1)c=t[s],n.replacer&&(c=n.replacer.call(t,String(s),c)),(fi(n,e,c,!1,!1)||typeof c>"u"&&fi(n,e,null,!1,!1))&&(r!==""&&(r+=","+(n.condenseFlow?"":" ")),r+=n.dump);n.tag=i,n.dump="["+r+"]"}o(c6,"writeFlowSequence");function O_(n,e,t,r){var i="",s=n.tag,a,c,u;for(a=0,c=t.length;a<c;a+=1)u=t[a],n.replacer&&(u=n.replacer.call(t,String(a),u)),(fi(n,e+1,u,!0,!0,!1,!0)||typeof u>"u"&&fi(n,e+1,null,!0,!0,!1,!0))&&((!r||i!=="")&&(i+=Zg(n,e)),n.dump&&Zo===n.dump.charCodeAt(0)?i+="-":i+="- ",i+=n.dump);n.tag=s,n.dump=i||"[]"}o(O_,"writeBlockSequence");function u6(n,e,t){var r="",i=n.tag,s=Object.keys(t),a,c,u,l,f;for(a=0,c=s.length;a<c;a+=1)f="",r!==""&&(f+=", "),n.condenseFlow&&(f+='"'),u=s[a],l=t[u],n.replacer&&(l=n.replacer.call(t,u,l)),fi(n,e,u,!1,!1)&&(n.dump.length>1024&&(f+="? "),f+=n.dump+(n.condenseFlow?'"':"")+":"+(n.condenseFlow?"":" "),fi(n,e,l,!1,!1)&&(f+=n.dump,r+=f));n.tag=i,n.dump="{"+r+"}"}o(u6,"writeFlowMapping");function l6(n,e,t,r){var i="",s=n.tag,a=Object.keys(t),c,u,l,f,h,d;if(n.sortKeys===!0)a.sort();else if(typeof n.sortKeys=="function")a.sort(n.sortKeys);else if(n.sortKeys)throw new pr("sortKeys must be a boolean or a function");for(c=0,u=a.length;c<u;c+=1)d="",(!r||i!=="")&&(d+=Zg(n,e)),l=a[c],f=t[l],n.replacer&&(f=n.replacer.call(t,l,f)),fi(n,e+1,l,!0,!0,!0)&&(h=n.tag!==null&&n.tag!=="?"||n.dump&&n.dump.length>1024,h&&(n.dump&&Zo===n.dump.charCodeAt(0)?d+="?":d+="? "),d+=n.dump,h&&(d+=Zg(n,e)),fi(n,e+1,f,!0,h)&&(n.dump&&Zo===n.dump.charCodeAt(0)?d+=":":d+=": ",d+=n.dump,i+=d));n.tag=s,n.dump=i||"{}"}o(l6,"writeBlockMapping");function D_(n,e,t){var r,i,s,a,c,u;for(i=t?n.explicitTypes:n.implicitTypes,s=0,a=i.length;s<a;s+=1)if(c=i[s],(c.instanceOf||c.predicate)&&(!c.instanceOf||typeof e=="object"&&e instanceof c.instanceOf)&&(!c.predicate||c.predicate(e))){if(t?c.multi&&c.representName?n.tag=c.representName(e):n.tag=c.tag:n.tag="?",c.represent){if(u=n.styleMap[c.tag]||c.defaultStyle,ob.call(c.represent)==="[object Function]")r=c.represent(e,u);else if(cb.call(c.represent,u))r=c.represent[u](e,u);else throw new pr("!<"+c.tag+'> tag resolver accepts not "'+u+'" style');n.dump=r}return!0}return!1}o(D_,"detectType");function fi(n,e,t,r,i,s,a){n.tag=null,n.dump=t,D_(n,t,!1)||D_(n,t,!0);var c=ob.call(n.dump),u=r,l;r&&(r=n.flowLevel<0||n.flowLevel>e);var f=c==="[object Object]"||c==="[object Array]",h,d;if(f&&(h=n.duplicates.indexOf(t),d=h!==-1),(n.tag!==null&&n.tag!=="?"||d||n.indent!==2&&e>0)&&(i=!1),d&&n.usedDuplicates[h])n.dump="*ref_"+h;else{if(f&&d&&!n.usedDuplicates[h]&&(n.usedDuplicates[h]=!0),c==="[object Object]")r&&Object.keys(n.dump).length!==0?(l6(n,e,n.dump,i),d&&(n.dump="&ref_"+h+n.dump)):(u6(n,e,n.dump),d&&(n.dump="&ref_"+h+" "+n.dump));else if(c==="[object Array]")r&&n.dump.length!==0?(n.noArrayIndent&&!a&&e>0?O_(n,e-1,n.dump,i):O_(n,e,n.dump,i),d&&(n.dump="&ref_"+h+n.dump)):(c6(n,e,n.dump),d&&(n.dump="&ref_"+h+" "+n.dump));else if(c==="[object String]")n.tag!=="?"&&s6(n,n.dump,e,s,u);else{if(c==="[object Undefined]")return!1;if(n.skipInvalid)return!1;throw new pr("unacceptable kind of an object to dump "+c)}n.tag!==null&&n.tag!=="?"&&(l=encodeURI(n.tag[0]==="!"?n.tag.slice(1):n.tag).replace(/!/g,"%21"),n.tag[0]==="!"?l="!"+l:l.slice(0,18)==="tag:yaml.org,2002:"?l="!!"+l.slice(18):l="!<"+l+">",n.dump=l+" "+n.dump)}return!0}o(fi,"writeNode");function f6(n,e){var t=[],r=[],i,s;for(t0(n,t,r),i=0,s=r.length;i<s;i+=1)e.duplicates.push(t[r[i]]);e.usedDuplicates=new Array(s)}o(f6,"getDuplicateReferences");function t0(n,e,t){var r,i,s;if(n!==null&&typeof n=="object")if(i=e.indexOf(n),i!==-1)t.indexOf(i)===-1&&t.push(i);else if(e.push(n),Array.isArray(n))for(i=0,s=n.length;i<s;i+=1)t0(n[i],e,t);else for(r=Object.keys(n),i=0,s=r.length;i<s;i+=1)t0(n[r[i]],e,t)}o(t0,"inspectNode");function h6(n,e){e=e||{};var t=new e6(e);t.noRefs||f6(n,t);var r=n;return t.replacer&&(r=t.replacer.call({"":r},"",r)),fi(t,0,r,!0,!0)?t.dump+`
`:""}o(h6,"dump$1");var d6=h6,p6={dump:d6};function o0(n,e){return function(){throw new Error("Function yaml."+n+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}o(o0,"renamed");var m6=$t,g6=F_,y6=L_,v6=B_,w6=U_,_6=n0,b6=ab.load,S6=ab.loadAll,E6=p6.dump,T6=pr,A6={binary:H_,float:$_,map:k_,null:j_,pairs:Q_,set:Y_,timestamp:W_,bool:M_,int:V_,merge:z_,omap:K_,seq:N_,str:R_},x6=o0("safeLoad","load"),C6=o0("safeLoadAll","loadAll"),O6=o0("safeDump","dump"),rc={Type:m6,Schema:g6,FAILSAFE_SCHEMA:y6,JSON_SCHEMA:v6,CORE_SCHEMA:w6,DEFAULT_SCHEMA:_6,load:b6,loadAll:S6,dump:E6,YAMLException:T6,types:A6,safeLoad:x6,safeLoadAll:C6,safeDump:O6};var yf=class{constructor(e){this.rootPath=e}static{o(this,"FileSystemVaultAdapter")}async read(e){let t=this.resolvePath(e.path);if(!await Tt.default.pathExists(t))throw new Error(`File not found: ${e.path}`);return Tt.default.readFile(t,"utf-8")}async create(e,t){let r=this.resolvePath(e);if(await Tt.default.pathExists(r))throw new Error(`File already exists: ${e}`);return await Tt.default.ensureDir(Jt.default.dirname(r)),await Tt.default.writeFile(r,t,"utf-8"),this.createFileObject(e)}async modify(e,t){let r=this.resolvePath(e.path);if(!await Tt.default.pathExists(r))throw new Error(`File not found: ${e.path}`);await Tt.default.writeFile(r,t,"utf-8")}async delete(e){let t=this.resolvePath(e.path);if(!await Tt.default.pathExists(t))throw new Error(`File not found: ${e.path}`);await Tt.default.remove(t)}async exists(e){let t=this.resolvePath(e);return Tt.default.pathExists(t)}getAbstractFileByPath(e){let t=this.resolvePath(e);try{let r=Tt.default.statSync(t);if(r.isFile())return this.createFileObject(e);if(r.isDirectory())return this.createFolderObject(e)}catch{return null}return null}getAllFiles(){let e=[];return this.walkDirectory(this.rootPath,t=>{if(t.endsWith(".md")){let r=Jt.default.relative(this.rootPath,t);e.push(this.createFileObject(r))}}),e}getFrontmatter(e){try{let t=Tt.default.readFileSync(this.resolvePath(e.path),"utf-8");return this.extractFrontmatter(t)}catch{return null}}async updateFrontmatter(e,t){let r=await this.read(e),i=this.extractFrontmatter(r)||{},s=t(i),a=this.replaceFrontmatter(r,s);await this.modify(e,a)}async rename(e,t){let r=this.resolvePath(e.path),i=this.resolvePath(t);if(!await Tt.default.pathExists(r))throw new Error(`File not found: ${e.path}`);await Tt.default.ensureDir(Jt.default.dirname(i)),await Tt.default.move(r,i)}async createFolder(e){let t=this.resolvePath(e);await Tt.default.ensureDir(t)}getFirstLinkpathDest(e,t){let r=Jt.default.dirname(this.resolvePath(t)),i;if(Jt.default.isAbsolute(e)?i=this.resolvePath(e):i=Jt.default.resolve(r,e),e.endsWith(".md")||(i+=".md"),Tt.default.existsSync(i)){let s=Jt.default.relative(this.rootPath,i);return this.createFileObject(s)}return null}async process(e,t){let r=await this.read(e),i=t(r);return await this.modify(e,i),i}getDefaultNewFileParent(){return{path:"",name:""}}async updateLinks(e,t,r){return Promise.resolve()}resolvePath(e){return Jt.default.isAbsolute(e)?e:Jt.default.join(this.rootPath,e)}createFileObject(e){let t=Jt.default.basename(e),r=Jt.default.basename(e,Jt.default.extname(e)),i=Jt.default.dirname(e);return{path:e,basename:t,name:r,parent:i!=="."?this.createFolderObject(i):null}}createFolderObject(e){return{path:e,name:Jt.default.basename(e)}}extractFrontmatter(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r)return null;try{let i=rc.load(r[1]);return typeof i=="object"&&i!==null?i:null}catch{return null}}replaceFrontmatter(e,t){let r=rc.dump(t,{lineWidth:-1,noRefs:!0,quotingType:'"'}),i=/^---\n([\s\S]*?)\n---/;return e.match(i)?e.replace(i,`---
${r.trim()}
---`):`---
${r.trim()}
---
${e}`}walkDirectory(e,t){let r=Tt.default.readdirSync(e,{withFileTypes:!0});for(let i of r){let s=Jt.default.join(e,i.name);i.isDirectory()?this.walkDirectory(s,t):i.isFile()&&t(s)}}};var vf=class{static{o(this,"TableFormatter")}format(e){if(e.length===0)return"No results";let t=this.getAllVariables(e),r=e.map(i=>this.solutionToRow(i,t));return this.renderTable(t,r)}getAllVariables(e){let t=new Set;for(let r of e)for(let i of r.variables())t.add(i);return Array.from(t).sort()}solutionToRow(e,t){return t.map(r=>{let i=e.get(r);return i?this.formatValue(i.toString()):""})}formatValue(e){return e.length>50?e.substring(0,47)+"...":e}renderTable(e,t){let r=e.map((s,a)=>{let c=s.length+1,u=Math.max(...t.map(l=>l[a]?.length||0));return Math.max(c,u,10)}),i=[];i.push(this.renderSeparator(r,"top")),i.push(this.renderRow(e.map(s=>`?${s}`),r)),i.push(this.renderSeparator(r,"mid"));for(let s of t)i.push(this.renderRow(s,r));return i.push(this.renderSeparator(r,"bottom")),i.join(`
`)}renderRow(e,t){return`\u2502 ${e.map((i,s)=>i.padEnd(t[s])).join(" \u2502 ")} \u2502`}renderSeparator(e,t){let r=t==="top"?"\u250C":t==="mid"?"\u251C":"\u2514",i=t==="top"?"\u2510":t==="mid"?"\u2524":"\u2518",a=t==="mid"?"\u2500\u253C\u2500":"\u2500"+(t==="mid"?"\u253C":"\u2500")+"\u2500",c=e.map(u=>"\u2500".repeat(u+2));return`${r}${c.join(a)}${i}`}};var wf=class{static{o(this,"JsonFormatter")}format(e){let t=e.map(r=>r.toJSON());return JSON.stringify(t,null,2)}};var nc=class{static{o(this,"TriplesFormatter")}formatNTriples(e){return e.map(t=>t.toString()).join(`
`)}formatTable(e){if(e.length===0)return"No triples generated.";let t=[];t.push("Subject | Predicate | Object"),t.push("------- | --------- | ------");for(let r of e){let i=this.formatNode(r.subject),s=this.formatNode(r.predicate),a=this.formatNode(r.object);t.push(`${i} | ${s} | ${a}`)}return t.join(`
`)}formatJson(e){let t=e.map(r=>({subject:this.nodeToJson(r.subject),predicate:this.nodeToJson(r.predicate),object:this.nodeToJson(r.object)}));return JSON.stringify(t,null,2)}formatNode(e){return e.value!==void 0?String(e.value):String(e)}nodeToJson(e){return"datatype"in e||"language"in e?{type:"literal",value:String(e.value),...e.datatype&&{datatype:e.datatype.value||String(e.datatype)},...e.language&&{language:e.language}}:"id"in e&&String(e.id).startsWith("_:")?{type:"bnode",value:String(e.id)}:{type:"uri",value:String(e.value)}}};function vb(n){return n.startsWith("VALIDATION_")?"validation":n.startsWith("PERMISSION_")?"permission":n.startsWith("STATE_")?"state":"internal"}o(vb,"getErrorCategory");var lt=class{static{o(this,"ResponseBuilder")}static success(e,t){return{success:!0,data:e,...t&&{meta:t}}}static error(e,t,r,i){return{success:!1,error:{code:e,category:vb(e),message:t,exitCode:r,...i?.recovery&&{recovery:i.recovery},...i?.context&&{context:i.context},...i?.stack&&{stack:i.stack}}}}};var mr=class extends Error{static{o(this,"CLIError")}constructor(e,t,r){super(e),this.name=this.constructor.name,this.context=t,this.recoveryHint=r,Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}format(){let e=`\u274C ${this.name}: ${this.message}`;if(this.guidance&&(e+=`

\u{1F4A1} ${this.guidance}`),this.context&&Object.keys(this.context).length>0){e+=`

\u{1F4CB} Context:`;for(let[t,r]of Object.entries(this.context))e+=`
  ${t}: ${JSON.stringify(r)}`}return e}toStructuredResponse(e=!1){return lt.error(this.errorCode,this.message,this.exitCode,{recovery:this.recoveryHint||{message:this.guidance},context:this.context,stack:e?this.stack:void 0})}formatJson(e=!1){return JSON.stringify(this.toStructuredResponse(e),null,2)}};var ye=class n{static{o(this,"ErrorHandler")}static{this.outputFormat="text"}static setFormat(e){n.outputFormat=e}static getFormat(){return n.outputFormat}static isDebugMode(){return!!process.env.DEBUG}static handle(e){if(e instanceof mr){if(n.outputFormat==="json"){let i=e.toStructuredResponse(n.isDebugMode());console.log(JSON.stringify(i,null,2))}else console.error(e.format()),n.isDebugMode()&&(console.error(`
\u{1F4CD} Stack trace:`),console.error(e.stack));process.exit(e.exitCode)}let{exitCode:t,errorCode:r}=n.classifyError(e);if(n.outputFormat==="json"){let i=n.buildErrorResponse(r,e.message,t,n.isDebugMode()?e.stack:void 0);console.log(JSON.stringify(i,null,2))}else console.error(`\u274C Error: ${e.message}`),n.isDebugMode()&&console.error(e.stack);process.exit(t)}static handleWithMessage(e,t=1,r="INTERNAL_UNKNOWN"){if(n.outputFormat==="json"){let i=n.buildErrorResponse(r,e,t);console.log(JSON.stringify(i,null,2))}else console.error(`\u274C Error: ${e}`);process.exit(t)}static classifyError(e){let t=e.message.toLowerCase();return t.includes("transition")?{exitCode:6,errorCode:"STATE_INVALID_TRANSITION"}:t.includes("transaction")?{exitCode:7,errorCode:"INTERNAL_TRANSACTION_FAILED"}:t.includes("concurrent")||t.includes("modified")?{exitCode:8,errorCode:"STATE_CONCURRENT_MODIFICATION"}:e.message.includes("not found")||e.message.includes("ENOENT")?{exitCode:3,errorCode:"VALIDATION_FILE_NOT_FOUND"}:e.message.includes("EACCES")||e.message.includes("permission denied")?{exitCode:4,errorCode:"PERMISSION_DENIED"}:e.message.includes("Invalid")||e.message.includes("outside vault")||e.message.includes("Not a")?{exitCode:2,errorCode:"VALIDATION_INVALID_ARGUMENTS"}:{exitCode:1,errorCode:"INTERNAL_UNKNOWN"}}static buildErrorResponse(e,t,r,i){return lt.error(e,t,r,{recovery:n.getRecoveryHint(e),stack:i})}static getRecoveryHint(e){switch(e){case"VALIDATION_FILE_NOT_FOUND":return{message:"Verify the file path is correct and the file exists",suggestion:"Check file path spelling and ensure the file is in the vault"};case"VALIDATION_VAULT_NOT_FOUND":return{message:"Verify the vault path is correct",suggestion:"Check --vault option or current directory"};case"VALIDATION_INVALID_ARGUMENTS":return{message:"Check command syntax and argument format",suggestion:"Use --help for usage information"};case"STATE_INVALID_TRANSITION":return{message:"The requested state transition is not allowed",suggestion:"Check the current asset state and valid transitions"};case"STATE_CONCURRENT_MODIFICATION":return{message:"File was modified by another process",suggestion:"Wait and retry the command"};case"PERMISSION_DENIED":return{message:"Check file permissions",suggestion:"Ensure you have write access to the vault"};case"INTERNAL_TRANSACTION_FAILED":return{message:"Transaction could not complete",suggestion:"Check for locked files and retry"};default:return{message:"An unexpected error occurred",suggestion:"Check the error details and retry"}}}};var ic=class extends mr{constructor(t,r){super(`File not found: ${t}`,{filepath:t,...r},{message:"Verify the file path is correct and the file exists",suggestion:`ls -la "${t}" or find . -name "$(basename ${t})"`});this.exitCode=3;this.errorCode="VALIDATION_FILE_NOT_FOUND";this.guidance=`Verify the file path is correct and the file exists.
Check:
  \u2022 File path spelling
  \u2022 File is in the vault directory
  \u2022 File has .md extension`}static{o(this,"FileNotFoundError")}};var rt=class extends mr{constructor(t,r,i){let s=`Check command syntax and argument format.
Use: exocortex command --help for usage information.`;super(t,i,{message:r||"Check command syntax and argument format",suggestion:"exocortex command --help"});this.exitCode=2;this.errorCode="VALIDATION_INVALID_ARGUMENTS";this.guidance=r||s}static{o(this,"InvalidArgumentsError")}};var hi=class extends mr{constructor(t,r){super(`Vault not found: ${t}`,{vaultPath:t,...r},{message:"Verify the vault path is correct and the directory exists",suggestion:`ls -la "${t}" or check --vault option`});this.exitCode=3;this.errorCode="VALIDATION_VAULT_NOT_FOUND";this.guidance=`The specified vault directory does not exist.
Check:
  \u2022 Path spelling and case sensitivity
  \u2022 Directory exists and is accessible
  \u2022 You have read permissions for the directory`}static{o(this,"VaultNotFoundError")}};function wb(){return new _r("query").description("Execute SPARQL query against Obsidian vault").argument("<query>","SPARQL query string or path to .sparql file").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--format <type>","Output format: table|json|csv|ntriples","table").option("--output <type>","Response format: text|json (for MCP tools)","text").option("--explain","Show optimized query plan").option("--stats","Show execution statistics").option("--no-optimize","Disable query optimization").action(async(n,e)=>{let t=e.output||"text";ye.setFormat(t);try{let r=Date.now(),i=D6(n),s=(0,c0.resolve)(e.vault);if(!(0,sc.existsSync)(s))throw new hi(s);t==="text"&&console.log(`\u{1F4E6} Loading vault: ${s}...`);let a=Date.now(),c=new yf(s),l=await new gr.NoteToRDFConverter(c).convertVault(),f=new gr.InMemoryTripleStore;await f.addAll(l);let h=Date.now()-a;t==="text"&&(console.log(`\u2705 Loaded ${l.length} triples in ${h}ms
`),console.log("\u{1F50D} Parsing SPARQL query..."));let m=new gr.SPARQLParser().parse(i);t==="text"&&console.log("\u{1F504} Translating to algebra...");let b=new gr.AlgebraTranslator().translate(m);if(!e.noOptimize&&b.type!=="construct")b=new gr.AlgebraOptimizer().optimize(b);else if(!e.noOptimize&&b.type==="construct"){let I=new gr.AlgebraOptimizer,L=b;b={...L,where:I.optimize(L.where)}}if(e.explain&&t==="text"){console.log("\u{1F4CA} Query Plan:");let I=new gr.AlgebraSerializer;if(b.type==="construct"){let L=b;console.log("CONSTRUCT Template:"),console.log("  (template patterns)"),console.log("WHERE:"),console.log(I.toString(L.where))}else console.log(I.toString(b));console.log()}t==="text"&&console.log("\u{1F3AF} Executing query...");let C=Date.now(),O=new gr.QueryExecutor(f);if(O.isConstructQuery(b)){let I=await O.executeConstruct(b),L=Date.now()-C,G=Date.now()-r;if(t==="json"){let W=new nc,Fe={query:i,count:I.length,triples:JSON.parse(W.formatJson(I))},Ze=lt.success(Fe,{durationMs:G,itemCount:I.length,loadDurationMs:h,execDurationMs:L,triplesScanned:l.length});console.log(JSON.stringify(Ze,null,2))}else console.log(`\u2705 Generated ${I.length} triple(s) in ${L}ms
`),I.length>0?P6(I,e.format):console.log("No triples generated."),e.stats&&(console.log(`
\u{1F4CA} Execution Statistics:`),console.log(`  Vault loading: ${h}ms`),console.log(`  Query execution: ${L}ms`),console.log(`  Total time: ${G}ms`),console.log(`  Triples scanned: ${l.length}`),console.log(`  Triples generated: ${I.length}`))}else{let I=await O.executeAll(b),L=Date.now()-C,G=Date.now()-r;if(t==="json"){let W=I.map(ot=>ot.toJSON()),Fe={query:i,count:I.length,bindings:W},Ze=lt.success(Fe,{durationMs:G,itemCount:I.length,loadDurationMs:h,execDurationMs:L,triplesScanned:l.length});console.log(JSON.stringify(Ze,null,2))}else console.log(`\u2705 Found ${I.length} result(s) in ${L}ms
`),I.length>0?I6(I,e.format):console.log("No results found."),e.stats&&(console.log(`
\u{1F4CA} Execution Statistics:`),console.log(`  Vault loading: ${h}ms`),console.log(`  Query execution: ${L}ms`),console.log(`  Total time: ${G}ms`),console.log(`  Triples scanned: ${l.length}`),console.log(`  Results returned: ${I.length}`))}}catch(r){ye.handle(r)}})}o(wb,"sparqlQueryCommand");function D6(n){if(n.includes("SELECT")||n.includes("CONSTRUCT"))return n;let e=(0,c0.resolve)(n);return(0,sc.existsSync)(e)?(0,sc.readFileSync)(e,"utf-8"):n}o(D6,"loadQuery");function I6(n,e){switch(e){case"json":let t=new wf;console.log(t.format(n));break;case"table":default:let r=new vf;console.log(r.format(n));break}}o(I6,"formatSelectResults");function P6(n,e){let t=new nc;switch(e){case"json":console.log(t.formatJson(n));break;case"ntriples":console.log(t.formatNTriples(n));break;case"table":default:console.log(t.formatTable(n));break}}o(P6,"formatConstructResults");var AS=require("path");var At=Ye(Va()),Gi=Ye(require("path"));var $b=Ye(Fb(),1);var oc=o(n=>{if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>65536)throw new TypeError("pattern is too long")},"assertValidPattern");var V6={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},cc=o(n=>n.replace(/[[\]\\-]/g,"\\$&"),"braceEscape"),$6=o(n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"regexpEscape"),Rb=o(n=>n.join(""),"rangesToString"),Nb=o((n,e)=>{let t=e;if(n.charAt(t)!=="[")throw new Error("not in a brace expression");let r=[],i=[],s=t+1,a=!1,c=!1,u=!1,l=!1,f=t,h="";e:for(;s<n.length;){let b=n.charAt(s);if((b==="!"||b==="^")&&s===t+1){l=!0,s++;continue}if(b==="]"&&a&&!u){f=s+1;break}if(a=!0,b==="\\"&&!u){u=!0,s++;continue}if(b==="["&&!u){for(let[C,[O,I,L]]of Object.entries(V6))if(n.startsWith(C,s)){if(h)return["$.",!1,n.length-t,!0];s+=C.length,L?i.push(O):r.push(O),c=c||I;continue e}}if(u=!1,h){b>h?r.push(cc(h)+"-"+cc(b)):b===h&&r.push(cc(b)),h="",s++;continue}if(n.startsWith("-]",s+1)){r.push(cc(b+"-")),s+=2;continue}if(n.startsWith("-",s+1)){h=b,s+=2;continue}r.push(cc(b)),s++}if(f<s)return["",!1,0,!1];if(!r.length&&!i.length)return["$.",!1,n.length-t,!0];if(i.length===0&&r.length===1&&/^\\?.$/.test(r[0])&&!l){let b=r[0].length===2?r[0].slice(-1):r[0];return[$6(b),!1,f-t,!1]}let d="["+(l?"^":"")+Rb(r)+"]",m="["+(l?"":"^")+Rb(i)+"]";return[r.length&&i.length?"("+d+"|"+m+")":r.length?d:m,c,f-t,!0]},"parseClass");var gn=o((n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/\[([^\/\\])\]/g,"$1"):n.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1"),"unescape");var B6=new Set(["!","?","+","*","@"]),kb=o(n=>B6.has(n),"isExtglobType"),U6="(?!(?:^|/)\\.\\.?(?:$|/))",_f="(?!\\.)",q6=new Set(["[","."]),G6=new Set(["..","."]),W6=new Set("().*{}+?[]^$\\!"),z6=o(n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"regExpEscape"),f0="[^/]",Lb=f0+"*?",jb=f0+"+?",Ga=class n{static{o(this,"AST")}type;#e;#t;#s=!1;#n=[];#a;#_;#u;#f=!1;#o;#c;#i=!1;constructor(e,t,r={}){this.type=e,e&&(this.#t=!0),this.#a=t,this.#e=this.#a?this.#a.#e:this,this.#o=this.#e===this?r:this.#e.#o,this.#u=this.#e===this?[]:this.#e.#u,e==="!"&&!this.#e.#f&&this.#u.push(this),this.#_=this.#a?this.#a.#n.length:0}get hasMagic(){if(this.#t!==void 0)return this.#t;for(let e of this.#n)if(typeof e!="string"&&(e.type||e.hasMagic))return this.#t=!0;return this.#t}toString(){return this.#c!==void 0?this.#c:this.type?this.#c=this.type+"("+this.#n.map(e=>String(e)).join("|")+")":this.#c=this.#n.map(e=>String(e)).join("")}#g(){if(this!==this.#e)throw new Error("should only call on root");if(this.#f)return this;this.toString(),this.#f=!0;let e;for(;e=this.#u.pop();){if(e.type!=="!")continue;let t=e,r=t.#a;for(;r;){for(let i=t.#_+1;!r.type&&i<r.#n.length;i++)for(let s of e.#n){if(typeof s=="string")throw new Error("string part in extglob AST??");s.copyIn(r.#n[i])}t=r,r=t.#a}}return this}push(...e){for(let t of e)if(t!==""){if(typeof t!="string"&&!(t instanceof n&&t.#a===this))throw new Error("invalid part: "+t);this.#n.push(t)}}toJSON(){let e=this.type===null?this.#n.slice().map(t=>typeof t=="string"?t:t.toJSON()):[this.type,...this.#n.map(t=>t.toJSON())];return this.isStart()&&!this.type&&e.unshift([]),this.isEnd()&&(this===this.#e||this.#e.#f&&this.#a?.type==="!")&&e.push({}),e}isStart(){if(this.#e===this)return!0;if(!this.#a?.isStart())return!1;if(this.#_===0)return!0;let e=this.#a;for(let t=0;t<this.#_;t++){let r=e.#n[t];if(!(r instanceof n&&r.type==="!"))return!1}return!0}isEnd(){if(this.#e===this||this.#a?.type==="!")return!0;if(!this.#a?.isEnd())return!1;if(!this.type)return this.#a?.isEnd();let e=this.#a?this.#a.#n.length:0;return this.#_===e-1}copyIn(e){typeof e=="string"?this.push(e):this.push(e.clone(this))}clone(e){let t=new n(this.type,e);for(let r of this.#n)t.copyIn(r);return t}static#y(e,t,r,i){let s=!1,a=!1,c=-1,u=!1;if(t.type===null){let m=r,_="";for(;m<e.length;){let b=e.charAt(m++);if(s||b==="\\"){s=!s,_+=b;continue}if(a){m===c+1?(b==="^"||b==="!")&&(u=!0):b==="]"&&!(m===c+2&&u)&&(a=!1),_+=b;continue}else if(b==="["){a=!0,c=m,u=!1,_+=b;continue}if(!i.noext&&kb(b)&&e.charAt(m)==="("){t.push(_),_="";let C=new n(b,t);m=n.#y(e,C,m,i),t.push(C);continue}_+=b}return t.push(_),m}let l=r+1,f=new n(null,t),h=[],d="";for(;l<e.length;){let m=e.charAt(l++);if(s||m==="\\"){s=!s,d+=m;continue}if(a){l===c+1?(m==="^"||m==="!")&&(u=!0):m==="]"&&!(l===c+2&&u)&&(a=!1),d+=m;continue}else if(m==="["){a=!0,c=l,u=!1,d+=m;continue}if(kb(m)&&e.charAt(l)==="("){f.push(d),d="";let _=new n(m,f);f.push(_),l=n.#y(e,_,l,i);continue}if(m==="|"){f.push(d),d="",h.push(f),f=new n(null,t);continue}if(m===")")return d===""&&t.#n.length===0&&(t.#i=!0),f.push(d),d="",t.push(...h,f),l;d+=m}return t.type=null,t.#t=void 0,t.#n=[e.substring(r-1)],l}static fromGlob(e,t={}){let r=new n(null,void 0,t);return n.#y(e,r,0,t),r}toMMPattern(){if(this!==this.#e)return this.#e.toMMPattern();let e=this.toString(),[t,r,i,s]=this.toRegExpSource();if(!(i||this.#t||this.#o.nocase&&!this.#o.nocaseMagicOnly&&e.toUpperCase()!==e.toLowerCase()))return r;let c=(this.#o.nocase?"i":"")+(s?"u":"");return Object.assign(new RegExp(`^${t}$`,c),{_src:t,_glob:e})}get options(){return this.#o}toRegExpSource(e){let t=e??!!this.#o.dot;if(this.#e===this&&this.#g(),!this.type){let u=this.isStart()&&this.isEnd(),l=this.#n.map(m=>{let[_,b,C,O]=typeof m=="string"?n.#h(m,this.#t,u):m.toRegExpSource(e);return this.#t=this.#t||C,this.#s=this.#s||O,_}).join(""),f="";if(this.isStart()&&typeof this.#n[0]=="string"&&!(this.#n.length===1&&G6.has(this.#n[0]))){let _=q6,b=t&&_.has(l.charAt(0))||l.startsWith("\\.")&&_.has(l.charAt(2))||l.startsWith("\\.\\.")&&_.has(l.charAt(4)),C=!t&&!e&&_.has(l.charAt(0));f=b?U6:C?_f:""}let h="";return this.isEnd()&&this.#e.#f&&this.#a?.type==="!"&&(h="(?:$|\\/)"),[f+l+h,gn(l),this.#t=!!this.#t,this.#s]}let r=this.type==="*"||this.type==="+",i=this.type==="!"?"(?:(?!(?:":"(?:",s=this.#d(t);if(this.isStart()&&this.isEnd()&&!s&&this.type!=="!"){let u=this.toString();return this.#n=[u],this.type=null,this.#t=void 0,[u,gn(this.toString()),!1,!1]}let a=!r||e||t||!_f?"":this.#d(!0);a===s&&(a=""),a&&(s=`(?:${s})(?:${a})*?`);let c="";if(this.type==="!"&&this.#i)c=(this.isStart()&&!t?_f:"")+jb;else{let u=this.type==="!"?"))"+(this.isStart()&&!t&&!e?_f:"")+Lb+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&a?")":this.type==="*"&&a?")?":`)${this.type}`;c=i+s+u}return[c,gn(s),this.#t=!!this.#t,this.#s]}#d(e){return this.#n.map(t=>{if(typeof t=="string")throw new Error("string type in extglob ast??");let[r,i,s,a]=t.toRegExpSource(e);return this.#s=this.#s||a,r}).filter(t=>!(this.isStart()&&this.isEnd())||!!t).join("|")}static#h(e,t,r=!1){let i=!1,s="",a=!1;for(let c=0;c<e.length;c++){let u=e.charAt(c);if(i){i=!1,s+=(W6.has(u)?"\\":"")+u;continue}if(u==="\\"){c===e.length-1?s+="\\\\":i=!0;continue}if(u==="["){let[l,f,h,d]=Nb(e,c);if(h){s+=l,a=a||f,c+=h-1,t=t||d;continue}}if(u==="*"){r&&e==="*"?s+=jb:s+=Lb,t=!0;continue}if(u==="?"){s+=f0,t=!0;continue}s+=z6(u)}return[s,gn(e),!!t,a]}};var Wa=o((n,{windowsPathsNoEscape:e=!1}={})=>e?n.replace(/[?*()[\]]/g,"[$&]"):n.replace(/[?*()[\]\\]/g,"\\$&"),"escape");var Ut=o((n,e,t={})=>(oc(e),!t.nocomment&&e.charAt(0)==="#"?!1:new Rr(e,t).match(n)),"minimatch"),H6=/^\*+([^+@!?\*\[\(]*)$/,K6=o(n=>e=>!e.startsWith(".")&&e.endsWith(n),"starDotExtTest"),Q6=o(n=>e=>e.endsWith(n),"starDotExtTestDot"),Y6=o(n=>(n=n.toLowerCase(),e=>!e.startsWith(".")&&e.toLowerCase().endsWith(n)),"starDotExtTestNocase"),X6=o(n=>(n=n.toLowerCase(),e=>e.toLowerCase().endsWith(n)),"starDotExtTestNocaseDot"),J6=/^\*+\.\*+$/,Z6=o(n=>!n.startsWith(".")&&n.includes("."),"starDotStarTest"),e7=o(n=>n!=="."&&n!==".."&&n.includes("."),"starDotStarTestDot"),t7=/^\.\*+$/,r7=o(n=>n!=="."&&n!==".."&&n.startsWith("."),"dotStarTest"),n7=/^\*+$/,i7=o(n=>n.length!==0&&!n.startsWith("."),"starTest"),s7=o(n=>n.length!==0&&n!=="."&&n!=="..","starTestDot"),a7=/^\?+([^+@!?\*\[\(]*)?$/,o7=o(([n,e=""])=>{let t=Bb([n]);return e?(e=e.toLowerCase(),r=>t(r)&&r.toLowerCase().endsWith(e)):t},"qmarksTestNocase"),c7=o(([n,e=""])=>{let t=Ub([n]);return e?(e=e.toLowerCase(),r=>t(r)&&r.toLowerCase().endsWith(e)):t},"qmarksTestNocaseDot"),u7=o(([n,e=""])=>{let t=Ub([n]);return e?r=>t(r)&&r.endsWith(e):t},"qmarksTestDot"),l7=o(([n,e=""])=>{let t=Bb([n]);return e?r=>t(r)&&r.endsWith(e):t},"qmarksTest"),Bb=o(([n])=>{let e=n.length;return t=>t.length===e&&!t.startsWith(".")},"qmarksTestNoExt"),Ub=o(([n])=>{let e=n.length;return t=>t.length===e&&t!=="."&&t!==".."},"qmarksTestNoExtDot"),qb=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",Mb={win32:{sep:"\\"},posix:{sep:"/"}},f7=qb==="win32"?Mb.win32.sep:Mb.posix.sep;Ut.sep=f7;var Bt=Symbol("globstar **");Ut.GLOBSTAR=Bt;var h7="[^/]",d7=h7+"*?",p7="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",m7="(?:(?!(?:\\/|^)\\.).)*?",g7=o((n,e={})=>t=>Ut(t,n,e),"filter");Ut.filter=g7;var Br=o((n,e={})=>Object.assign({},n,e),"ext"),y7=o(n=>{if(!n||typeof n!="object"||!Object.keys(n).length)return Ut;let e=Ut;return Object.assign(o((r,i,s={})=>e(r,i,Br(n,s)),"m"),{Minimatch:class extends e.Minimatch{static{o(this,"Minimatch")}constructor(i,s={}){super(i,Br(n,s))}static defaults(i){return e.defaults(Br(n,i)).Minimatch}},AST:class extends e.AST{static{o(this,"AST")}constructor(i,s,a={}){super(i,s,Br(n,a))}static fromGlob(i,s={}){return e.AST.fromGlob(i,Br(n,s))}},unescape:o((r,i={})=>e.unescape(r,Br(n,i)),"unescape"),escape:o((r,i={})=>e.escape(r,Br(n,i)),"escape"),filter:o((r,i={})=>e.filter(r,Br(n,i)),"filter"),defaults:o(r=>e.defaults(Br(n,r)),"defaults"),makeRe:o((r,i={})=>e.makeRe(r,Br(n,i)),"makeRe"),braceExpand:o((r,i={})=>e.braceExpand(r,Br(n,i)),"braceExpand"),match:o((r,i,s={})=>e.match(r,i,Br(n,s)),"match"),sep:e.sep,GLOBSTAR:Bt})},"defaults");Ut.defaults=y7;var Gb=o((n,e={})=>(oc(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:(0,$b.default)(n)),"braceExpand");Ut.braceExpand=Gb;var v7=o((n,e={})=>new Rr(n,e).makeRe(),"makeRe");Ut.makeRe=v7;var w7=o((n,e,t={})=>{let r=new Rr(e,t);return n=n.filter(i=>r.match(i)),r.options.nonull&&!n.length&&n.push(e),n},"match");Ut.match=w7;var Vb=/[?*]|[+@!]\(.*?\)|\[|\]/,_7=o(n=>n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"regExpEscape"),Rr=class{static{o(this,"Minimatch")}options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(e,t={}){oc(e),t=t||{},this.options=t,this.pattern=e,this.platform=t.platform||qb,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!t.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!t.nonegate,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=t.windowsNoMagicRoot!==void 0?t.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let e of this.set)for(let t of e)if(typeof t!="string")return!0;return!1}debug(...e){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],t.debug&&(this.debug=(...s)=>console.error(...s)),this.debug(this.pattern,this.globSet);let r=this.globSet.map(s=>this.slashSplit(s));this.globParts=this.preprocess(r),this.debug(this.pattern,this.globParts);let i=this.globParts.map((s,a,c)=>{if(this.isWindows&&this.windowsNoMagicRoot){let u=s[0]===""&&s[1]===""&&(s[2]==="?"||!Vb.test(s[2]))&&!Vb.test(s[3]),l=/^[a-z]:/i.test(s[0]);if(u)return[...s.slice(0,4),...s.slice(4).map(f=>this.parse(f))];if(l)return[s[0],...s.slice(1).map(f=>this.parse(f))]}return s.map(u=>this.parse(u))});if(this.debug(this.pattern,i),this.set=i.filter(s=>s.indexOf(!1)===-1),this.isWindows)for(let s=0;s<this.set.length;s++){let a=this.set[s];a[0]===""&&a[1]===""&&this.globParts[s][2]==="?"&&typeof a[3]=="string"&&/^[a-z]:$/i.test(a[3])&&(a[2]="?")}this.debug(this.pattern,this.set)}preprocess(e){if(this.options.noglobstar)for(let r=0;r<e.length;r++)for(let i=0;i<e[r].length;i++)e[r][i]==="**"&&(e[r][i]="*");let{optimizationLevel:t=1}=this.options;return t>=2?(e=this.firstPhasePreProcess(e),e=this.secondPhasePreProcess(e)):t>=1?e=this.levelOneOptimize(e):e=this.adjascentGlobstarOptimize(e),e}adjascentGlobstarOptimize(e){return e.map(t=>{let r=-1;for(;(r=t.indexOf("**",r+1))!==-1;){let i=r;for(;t[i+1]==="**";)i++;i!==r&&t.splice(r,i-r)}return t})}levelOneOptimize(e){return e.map(t=>(t=t.reduce((r,i)=>{let s=r[r.length-1];return i==="**"&&s==="**"?r:i===".."&&s&&s!==".."&&s!=="."&&s!=="**"?(r.pop(),r):(r.push(i),r)},[]),t.length===0?[""]:t))}levelTwoFileOptimize(e){Array.isArray(e)||(e=this.slashSplit(e));let t=!1;do{if(t=!1,!this.preserveMultipleSlashes){for(let i=1;i<e.length-1;i++){let s=e[i];i===1&&s===""&&e[0]===""||(s==="."||s==="")&&(t=!0,e.splice(i,1),i--)}e[0]==="."&&e.length===2&&(e[1]==="."||e[1]==="")&&(t=!0,e.pop())}let r=0;for(;(r=e.indexOf("..",r+1))!==-1;){let i=e[r-1];i&&i!=="."&&i!==".."&&i!=="**"&&(t=!0,e.splice(r-1,2),r-=2)}}while(t);return e.length===0?[""]:e}firstPhasePreProcess(e){let t=!1;do{t=!1;for(let r of e){let i=-1;for(;(i=r.indexOf("**",i+1))!==-1;){let a=i;for(;r[a+1]==="**";)a++;a>i&&r.splice(i+1,a-i);let c=r[i+1],u=r[i+2],l=r[i+3];if(c!==".."||!u||u==="."||u===".."||!l||l==="."||l==="..")continue;t=!0,r.splice(i,1);let f=r.slice(0);f[i]="**",e.push(f),i--}if(!this.preserveMultipleSlashes){for(let a=1;a<r.length-1;a++){let c=r[a];a===1&&c===""&&r[0]===""||(c==="."||c==="")&&(t=!0,r.splice(a,1),a--)}r[0]==="."&&r.length===2&&(r[1]==="."||r[1]==="")&&(t=!0,r.pop())}let s=0;for(;(s=r.indexOf("..",s+1))!==-1;){let a=r[s-1];if(a&&a!=="."&&a!==".."&&a!=="**"){t=!0;let u=s===1&&r[s+1]==="**"?["."]:[];r.splice(s-1,2,...u),r.length===0&&r.push(""),s-=2}}}}while(t);return e}secondPhasePreProcess(e){for(let t=0;t<e.length-1;t++)for(let r=t+1;r<e.length;r++){let i=this.partsMatch(e[t],e[r],!this.preserveMultipleSlashes);if(i){e[t]=[],e[r]=i;break}}return e.filter(t=>t.length)}partsMatch(e,t,r=!1){let i=0,s=0,a=[],c="";for(;i<e.length&&s<t.length;)if(e[i]===t[s])a.push(c==="b"?t[s]:e[i]),i++,s++;else if(r&&e[i]==="**"&&t[s]===e[i+1])a.push(e[i]),i++;else if(r&&t[s]==="**"&&e[i]===t[s+1])a.push(t[s]),s++;else if(e[i]==="*"&&t[s]&&(this.options.dot||!t[s].startsWith("."))&&t[s]!=="**"){if(c==="b")return!1;c="a",a.push(e[i]),i++,s++}else if(t[s]==="*"&&e[i]&&(this.options.dot||!e[i].startsWith("."))&&e[i]!=="**"){if(c==="a")return!1;c="b",a.push(t[s]),i++,s++}else return!1;return e.length===t.length&&a}parseNegate(){if(this.nonegate)return;let e=this.pattern,t=!1,r=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,r++;r&&(this.pattern=e.slice(r)),this.negate=t}matchOne(e,t,r=!1){let i=this.options;if(this.isWindows){let b=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),C=!b&&e[0]===""&&e[1]===""&&e[2]==="?"&&/^[a-z]:$/i.test(e[3]),O=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),I=!O&&t[0]===""&&t[1]===""&&t[2]==="?"&&typeof t[3]=="string"&&/^[a-z]:$/i.test(t[3]),L=C?3:b?0:void 0,G=I?3:O?0:void 0;if(typeof L=="number"&&typeof G=="number"){let[W,Fe]=[e[L],t[G]];W.toLowerCase()===Fe.toLowerCase()&&(t[G]=W,G>L?t=t.slice(G):L>G&&(e=e.slice(L)))}}let{optimizationLevel:s=1}=this.options;s>=2&&(e=this.levelTwoFileOptimize(e)),this.debug("matchOne",this,{file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var a=0,c=0,u=e.length,l=t.length;a<u&&c<l;a++,c++){this.debug("matchOne loop");var f=t[c],h=e[a];if(this.debug(t,f,h),f===!1)return!1;if(f===Bt){this.debug("GLOBSTAR",[t,f,h]);var d=a,m=c+1;if(m===l){for(this.debug("** at the end");a<u;a++)if(e[a]==="."||e[a]===".."||!i.dot&&e[a].charAt(0)===".")return!1;return!0}for(;d<u;){var _=e[d];if(this.debug(`
globstar while`,e,d,t,m,_),this.matchOne(e.slice(d),t.slice(m),r))return this.debug("globstar found match!",d,u,_),!0;if(_==="."||_===".."||!i.dot&&_.charAt(0)==="."){this.debug("dot detected!",e,d,t,m);break}this.debug("globstar swallow a segment, and continue"),d++}return!!(r&&(this.debug(`
>>> no match, partial?`,e,d,t,m),d===u))}let b;if(typeof f=="string"?(b=h===f,this.debug("string match",f,h,b)):(b=f.test(h),this.debug("pattern match",f,h,b)),!b)return!1}if(a===u&&c===l)return!0;if(a===u)return r;if(c===l)return a===u-1&&e[a]==="";throw new Error("wtf?")}braceExpand(){return Gb(this.pattern,this.options)}parse(e){oc(e);let t=this.options;if(e==="**")return Bt;if(e==="")return"";let r,i=null;(r=e.match(n7))?i=t.dot?s7:i7:(r=e.match(H6))?i=(t.nocase?t.dot?X6:Y6:t.dot?Q6:K6)(r[1]):(r=e.match(a7))?i=(t.nocase?t.dot?c7:o7:t.dot?u7:l7)(r):(r=e.match(J6))?i=t.dot?e7:Z6:(r=e.match(t7))&&(i=r7);let s=Ga.fromGlob(e,this.options).toMMPattern();return i&&typeof s=="object"&&Reflect.defineProperty(s,"test",{value:i}),s}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,r=t.noglobstar?d7:t.dot?p7:m7,i=new Set(t.nocase?["i"]:[]),s=e.map(u=>{let l=u.map(f=>{if(f instanceof RegExp)for(let h of f.flags.split(""))i.add(h);return typeof f=="string"?_7(f):f===Bt?Bt:f._src});return l.forEach((f,h)=>{let d=l[h+1],m=l[h-1];f!==Bt||m===Bt||(m===void 0?d!==void 0&&d!==Bt?l[h+1]="(?:\\/|"+r+"\\/)?"+d:l[h]=r:d===void 0?l[h-1]=m+"(?:\\/|"+r+")?":d!==Bt&&(l[h-1]=m+"(?:\\/|\\/"+r+"\\/)"+d,l[h+1]=Bt))}),l.filter(f=>f!==Bt).join("/")}).join("|"),[a,c]=e.length>1?["(?:",")"]:["",""];s="^"+a+s+c+"$",this.negate&&(s="^(?!"+s+").+$");try{this.regexp=new RegExp(s,[...i].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(e){return this.preserveMultipleSlashes?e.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(e)?["",...e.split(/\/+/)]:e.split(/\/+/)}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let r=this.options;this.isWindows&&(e=e.split("\\").join("/"));let i=this.slashSplit(e);this.debug(this.pattern,"split",i);let s=this.set;this.debug(this.pattern,"set",s);let a=i[i.length-1];if(!a)for(let c=i.length-2;!a&&c>=0;c--)a=i[c];for(let c=0;c<s.length;c++){let u=s[c],l=i;if(r.matchBase&&u.length===1&&(l=[a]),this.matchOne(l,u,t))return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}static defaults(e){return Ut.defaults(e).Minimatch}};Ut.AST=Ga;Ut.Minimatch=Rr;Ut.escape=Wa;Ut.unescape=gn;var pS=require("node:url");var za=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,zb=new Set,h0=typeof process=="object"&&process?process:{},Hb=o((n,e,t,r)=>{typeof h0.emitWarning=="function"?h0.emitWarning(n,e,t,r):console.error(`[${t}] ${e}: ${n}`)},"emitWarning"),bf=globalThis.AbortController,Wb=globalThis.AbortSignal;if(typeof bf>"u"){Wb=class{static{o(this,"AbortSignal")}onabort;_onabort=[];reason;aborted=!1;addEventListener(r,i){this._onabort.push(i)}},bf=class{static{o(this,"AbortController")}constructor(){e()}signal=new Wb;abort(r){if(!this.signal.aborted){this.signal.reason=r,this.signal.aborted=!0;for(let i of this.signal._onabort)i(r);this.signal.onabort?.(r)}}};let n=h0.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1",e=o(()=>{n&&(n=!1,Hb("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))},"warnACPolyfill")}var b7=o(n=>!zb.has(n),"shouldWarn");var $i=o(n=>n&&n===Math.floor(n)&&n>0&&isFinite(n),"isPosInt"),Kb=o(n=>$i(n)?n<=Math.pow(2,8)?Uint8Array:n<=Math.pow(2,16)?Uint16Array:n<=Math.pow(2,32)?Uint32Array:n<=Number.MAX_SAFE_INTEGER?Ha:null:null,"getUintArray"),Ha=class extends Array{static{o(this,"ZeroArray")}constructor(e){super(e),this.fill(0)}},d0=class n{static{o(this,"Stack")}heap;length;static#e=!1;static create(e){let t=Kb(e);if(!t)return[];n.#e=!0;let r=new n(e,t);return n.#e=!1,r}constructor(e,t){if(!n.#e)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}},uc=class n{static{o(this,"LRUCache")}#e;#t;#s;#n;#a;#_;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#u;#f;#o;#c;#i;#g;#y;#d;#h;#E;#m;#T;#A;#w;#b;#S;#p;static unsafeExposeInternals(e){return{starts:e.#A,ttls:e.#w,sizes:e.#T,keyMap:e.#o,keyList:e.#c,valList:e.#i,next:e.#g,prev:e.#y,get head(){return e.#d},get tail(){return e.#h},free:e.#E,isBackgroundFetch:o(t=>e.#l(t),"isBackgroundFetch"),backgroundFetch:o((t,r,i,s)=>e.#M(t,r,i,s),"backgroundFetch"),moveToTail:o(t=>e.#$(t),"moveToTail"),indexes:o(t=>e.#C(t),"indexes"),rindexes:o(t=>e.#O(t),"rindexes"),isStale:o(t=>e.#v(t),"isStale")}}get max(){return this.#e}get maxSize(){return this.#t}get calculatedSize(){return this.#f}get size(){return this.#u}get fetchMethod(){return this.#a}get memoMethod(){return this.#_}get dispose(){return this.#s}get disposeAfter(){return this.#n}constructor(e){let{max:t=0,ttl:r,ttlResolution:i=1,ttlAutopurge:s,updateAgeOnGet:a,updateAgeOnHas:c,allowStale:u,dispose:l,disposeAfter:f,noDisposeOnSet:h,noUpdateTTL:d,maxSize:m=0,maxEntrySize:_=0,sizeCalculation:b,fetchMethod:C,memoMethod:O,noDeleteOnFetchRejection:I,noDeleteOnStaleGet:L,allowStaleOnFetchRejection:G,allowStaleOnFetchAbort:W,ignoreFetchAbort:Fe}=e;if(t!==0&&!$i(t))throw new TypeError("max option must be a nonnegative integer");let Ze=t?Kb(t):Array;if(!Ze)throw new Error("invalid max value: "+t);if(this.#e=t,this.#t=m,this.maxEntrySize=_||this.#t,this.sizeCalculation=b,this.sizeCalculation){if(!this.#t&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(O!==void 0&&typeof O!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#_=O,C!==void 0&&typeof C!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#a=C,this.#S=!!C,this.#o=new Map,this.#c=new Array(t).fill(void 0),this.#i=new Array(t).fill(void 0),this.#g=new Ze(t),this.#y=new Ze(t),this.#d=0,this.#h=0,this.#E=d0.create(t),this.#u=0,this.#f=0,typeof l=="function"&&(this.#s=l),typeof f=="function"?(this.#n=f,this.#m=[]):(this.#n=void 0,this.#m=void 0),this.#b=!!this.#s,this.#p=!!this.#n,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!d,this.noDeleteOnFetchRejection=!!I,this.allowStaleOnFetchRejection=!!G,this.allowStaleOnFetchAbort=!!W,this.ignoreFetchAbort=!!Fe,this.maxEntrySize!==0){if(this.#t!==0&&!$i(this.#t))throw new TypeError("maxSize must be a positive integer if specified");if(!$i(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#I()}if(this.allowStale=!!u,this.noDeleteOnStaleGet=!!L,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!c,this.ttlResolution=$i(i)||i===0?i:1,this.ttlAutopurge=!!s,this.ttl=r||0,this.ttl){if(!$i(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#D()}if(this.#e===0&&this.ttl===0&&this.#t===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#e&&!this.#t){let ot="LRU_CACHE_UNBOUNDED";b7(ot)&&(zb.add(ot),Hb("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",ot,n))}}getRemainingTTL(e){return this.#o.has(e)?1/0:0}#D(){let e=new Ha(this.#e),t=new Ha(this.#e);this.#w=e,this.#A=t,this.#F=(s,a,c=za.now())=>{if(t[s]=a!==0?c:0,e[s]=a,a!==0&&this.ttlAutopurge){let u=setTimeout(()=>{this.#v(s)&&this.#P(this.#c[s],"expire")},a+1);u.unref&&u.unref()}},this.#x=s=>{t[s]=e[s]!==0?za.now():0},this.#r=(s,a)=>{if(e[a]){let c=e[a],u=t[a];if(!c||!u)return;s.ttl=c,s.start=u,s.now=r||i();let l=s.now-u;s.remainingTTL=c-l}};let r=0,i=o(()=>{let s=za.now();if(this.ttlResolution>0){r=s;let a=setTimeout(()=>r=0,this.ttlResolution);a.unref&&a.unref()}return s},"getNow");this.getRemainingTTL=s=>{let a=this.#o.get(s);if(a===void 0)return 0;let c=e[a],u=t[a];if(!c||!u)return 1/0;let l=(r||i())-u;return c-l},this.#v=s=>{let a=t[s],c=e[s];return!!c&&!!a&&(r||i())-a>c}}#x=o(()=>{},"#updateItemAge");#r=o(()=>{},"#statusTTL");#F=o(()=>{},"#setItemTTL");#v=o(()=>!1,"#isStale");#I(){let e=new Ha(this.#e);this.#f=0,this.#T=e,this.#R=t=>{this.#f-=e[t],e[t]=0},this.#k=(t,r,i,s)=>{if(this.#l(r))return 0;if(!$i(i))if(s){if(typeof s!="function")throw new TypeError("sizeCalculation must be a function");if(i=s(r,t),!$i(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i},this.#N=(t,r,i)=>{if(e[t]=r,this.#t){let s=this.#t-e[t];for(;this.#f>s;)this.#j(!0)}this.#f+=e[t],i&&(i.entrySize=r,i.totalCalculatedSize=this.#f)}}#R=o(e=>{},"#removeItemSize");#N=o((e,t,r)=>{},"#addItemSize");#k=o((e,t,r,i)=>{if(r||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0},"#requireSize");*#C({allowStale:e=this.allowStale}={}){if(this.#u)for(let t=this.#h;!(!this.#L(t)||((e||!this.#v(t))&&(yield t),t===this.#d));)t=this.#y[t]}*#O({allowStale:e=this.allowStale}={}){if(this.#u)for(let t=this.#d;!(!this.#L(t)||((e||!this.#v(t))&&(yield t),t===this.#h));)t=this.#g[t]}#L(e){return e!==void 0&&this.#o.get(this.#c[e])===e}*entries(){for(let e of this.#C())this.#i[e]!==void 0&&this.#c[e]!==void 0&&!this.#l(this.#i[e])&&(yield[this.#c[e],this.#i[e]])}*rentries(){for(let e of this.#O())this.#i[e]!==void 0&&this.#c[e]!==void 0&&!this.#l(this.#i[e])&&(yield[this.#c[e],this.#i[e]])}*keys(){for(let e of this.#C()){let t=this.#c[e];t!==void 0&&!this.#l(this.#i[e])&&(yield t)}}*rkeys(){for(let e of this.#O()){let t=this.#c[e];t!==void 0&&!this.#l(this.#i[e])&&(yield t)}}*values(){for(let e of this.#C())this.#i[e]!==void 0&&!this.#l(this.#i[e])&&(yield this.#i[e])}*rvalues(){for(let e of this.#O())this.#i[e]!==void 0&&!this.#l(this.#i[e])&&(yield this.#i[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(let r of this.#C()){let i=this.#i[r],s=this.#l(i)?i.__staleWhileFetching:i;if(s!==void 0&&e(s,this.#c[r],this))return this.get(this.#c[r],t)}}forEach(e,t=this){for(let r of this.#C()){let i=this.#i[r],s=this.#l(i)?i.__staleWhileFetching:i;s!==void 0&&e.call(t,s,this.#c[r],this)}}rforEach(e,t=this){for(let r of this.#O()){let i=this.#i[r],s=this.#l(i)?i.__staleWhileFetching:i;s!==void 0&&e.call(t,s,this.#c[r],this)}}purgeStale(){let e=!1;for(let t of this.#O({allowStale:!0}))this.#v(t)&&(this.#P(this.#c[t],"expire"),e=!0);return e}info(e){let t=this.#o.get(e);if(t===void 0)return;let r=this.#i[t],i=this.#l(r)?r.__staleWhileFetching:r;if(i===void 0)return;let s={value:i};if(this.#w&&this.#A){let a=this.#w[t],c=this.#A[t];if(a&&c){let u=a-(za.now()-c);s.ttl=u,s.start=Date.now()}}return this.#T&&(s.size=this.#T[t]),s}dump(){let e=[];for(let t of this.#C({allowStale:!0})){let r=this.#c[t],i=this.#i[t],s=this.#l(i)?i.__staleWhileFetching:i;if(s===void 0||r===void 0)continue;let a={value:s};if(this.#w&&this.#A){a.ttl=this.#w[t];let c=za.now()-this.#A[t];a.start=Math.floor(Date.now()-c)}this.#T&&(a.size=this.#T[t]),e.unshift([r,a])}return e}load(e){this.clear();for(let[t,r]of e){if(r.start){let i=Date.now()-r.start;r.start=za.now()-i}this.set(t,r.value,r)}}set(e,t,r={}){if(t===void 0)return this.delete(e),this;let{ttl:i=this.ttl,start:s,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:u}=r,{noUpdateTTL:l=this.noUpdateTTL}=r,f=this.#k(e,t,r.size||0,c);if(this.maxEntrySize&&f>this.maxEntrySize)return u&&(u.set="miss",u.maxEntrySizeExceeded=!0),this.#P(e,"set"),this;let h=this.#u===0?void 0:this.#o.get(e);if(h===void 0)h=this.#u===0?this.#h:this.#E.length!==0?this.#E.pop():this.#u===this.#e?this.#j(!1):this.#u,this.#c[h]=e,this.#i[h]=t,this.#o.set(e,h),this.#g[this.#h]=h,this.#y[h]=this.#h,this.#h=h,this.#u++,this.#N(h,f,u),u&&(u.set="add"),l=!1;else{this.#$(h);let d=this.#i[h];if(t!==d){if(this.#S&&this.#l(d)){d.__abortController.abort(new Error("replaced"));let{__staleWhileFetching:m}=d;m!==void 0&&!a&&(this.#b&&this.#s?.(m,e,"set"),this.#p&&this.#m?.push([m,e,"set"]))}else a||(this.#b&&this.#s?.(d,e,"set"),this.#p&&this.#m?.push([d,e,"set"]));if(this.#R(h),this.#N(h,f,u),this.#i[h]=t,u){u.set="replace";let m=d&&this.#l(d)?d.__staleWhileFetching:d;m!==void 0&&(u.oldValue=m)}}else u&&(u.set="update")}if(i!==0&&!this.#w&&this.#D(),this.#w&&(l||this.#F(h,i,s),u&&this.#r(u,h)),!a&&this.#p&&this.#m){let d=this.#m,m;for(;m=d?.shift();)this.#n?.(...m)}return this}pop(){try{for(;this.#u;){let e=this.#i[this.#d];if(this.#j(!0),this.#l(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#p&&this.#m){let e=this.#m,t;for(;t=e?.shift();)this.#n?.(...t)}}}#j(e){let t=this.#d,r=this.#c[t],i=this.#i[t];return this.#S&&this.#l(i)?i.__abortController.abort(new Error("evicted")):(this.#b||this.#p)&&(this.#b&&this.#s?.(i,r,"evict"),this.#p&&this.#m?.push([i,r,"evict"])),this.#R(t),e&&(this.#c[t]=void 0,this.#i[t]=void 0,this.#E.push(t)),this.#u===1?(this.#d=this.#h=0,this.#E.length=0):this.#d=this.#g[t],this.#o.delete(r),this.#u--,t}has(e,t={}){let{updateAgeOnHas:r=this.updateAgeOnHas,status:i}=t,s=this.#o.get(e);if(s!==void 0){let a=this.#i[s];if(this.#l(a)&&a.__staleWhileFetching===void 0)return!1;if(this.#v(s))i&&(i.has="stale",this.#r(i,s));else return r&&this.#x(s),i&&(i.has="hit",this.#r(i,s)),!0}else i&&(i.has="miss");return!1}peek(e,t={}){let{allowStale:r=this.allowStale}=t,i=this.#o.get(e);if(i===void 0||!r&&this.#v(i))return;let s=this.#i[i];return this.#l(s)?s.__staleWhileFetching:s}#M(e,t,r,i){let s=t===void 0?void 0:this.#i[t];if(this.#l(s))return s;let a=new bf,{signal:c}=r;c?.addEventListener("abort",()=>a.abort(c.reason),{signal:a.signal});let u={signal:a.signal,options:r,context:i},l=o((b,C=!1)=>{let{aborted:O}=a.signal,I=r.ignoreFetchAbort&&b!==void 0;if(r.status&&(O&&!C?(r.status.fetchAborted=!0,r.status.fetchError=a.signal.reason,I&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),O&&!I&&!C)return h(a.signal.reason);let L=m;return this.#i[t]===m&&(b===void 0?L.__staleWhileFetching?this.#i[t]=L.__staleWhileFetching:this.#P(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,b,u.options))),b},"cb"),f=o(b=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=b),h(b)),"eb"),h=o(b=>{let{aborted:C}=a.signal,O=C&&r.allowStaleOnFetchAbort,I=O||r.allowStaleOnFetchRejection,L=I||r.noDeleteOnFetchRejection,G=m;if(this.#i[t]===m&&(!L||G.__staleWhileFetching===void 0?this.#P(e,"fetch"):O||(this.#i[t]=G.__staleWhileFetching)),I)return r.status&&G.__staleWhileFetching!==void 0&&(r.status.returnedStale=!0),G.__staleWhileFetching;if(G.__returned===G)throw b},"fetchFail"),d=o((b,C)=>{let O=this.#a?.(e,s,u);O&&O instanceof Promise&&O.then(I=>b(I===void 0?void 0:I),C),a.signal.addEventListener("abort",()=>{(!r.ignoreFetchAbort||r.allowStaleOnFetchAbort)&&(b(void 0),r.allowStaleOnFetchAbort&&(b=o(I=>l(I,!0),"res")))})},"pcall");r.status&&(r.status.fetchDispatched=!0);let m=new Promise(d).then(l,f),_=Object.assign(m,{__abortController:a,__staleWhileFetching:s,__returned:void 0});return t===void 0?(this.set(e,_,{...u.options,status:void 0}),t=this.#o.get(e)):this.#i[t]=_,_}#l(e){if(!this.#S)return!1;let t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof bf}async fetch(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:u=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:f=this.noUpdateTTL,noDeleteOnFetchRejection:h=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:d=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:_=this.allowStaleOnFetchAbort,context:b,forceRefresh:C=!1,status:O,signal:I}=t;if(!this.#S)return O&&(O.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:i,noDeleteOnStaleGet:s,status:O});let L={allowStale:r,updateAgeOnGet:i,noDeleteOnStaleGet:s,ttl:a,noDisposeOnSet:c,size:u,sizeCalculation:l,noUpdateTTL:f,noDeleteOnFetchRejection:h,allowStaleOnFetchRejection:d,allowStaleOnFetchAbort:_,ignoreFetchAbort:m,status:O,signal:I},G=this.#o.get(e);if(G===void 0){O&&(O.fetch="miss");let W=this.#M(e,G,L,b);return W.__returned=W}else{let W=this.#i[G];if(this.#l(W)){let ue=r&&W.__staleWhileFetching!==void 0;return O&&(O.fetch="inflight",ue&&(O.returnedStale=!0)),ue?W.__staleWhileFetching:W.__returned=W}let Fe=this.#v(G);if(!C&&!Fe)return O&&(O.fetch="hit"),this.#$(G),i&&this.#x(G),O&&this.#r(O,G),W;let Ze=this.#M(e,G,L,b),B=Ze.__staleWhileFetching!==void 0&&r;return O&&(O.fetch=Fe?"stale":"refresh",B&&Fe&&(O.returnedStale=!0)),B?Ze.__staleWhileFetching:Ze.__returned=Ze}}async forceFetch(e,t={}){let r=await this.fetch(e,t);if(r===void 0)throw new Error("fetch() returned undefined");return r}memo(e,t={}){let r=this.#_;if(!r)throw new Error("no memoMethod provided to constructor");let{context:i,forceRefresh:s,...a}=t,c=this.get(e,a);if(!s&&c!==void 0)return c;let u=r(e,c,{options:a,context:i});return this.set(e,u,a),u}get(e,t={}){let{allowStale:r=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:s=this.noDeleteOnStaleGet,status:a}=t,c=this.#o.get(e);if(c!==void 0){let u=this.#i[c],l=this.#l(u);return a&&this.#r(a,c),this.#v(c)?(a&&(a.get="stale"),l?(a&&r&&u.__staleWhileFetching!==void 0&&(a.returnedStale=!0),r?u.__staleWhileFetching:void 0):(s||this.#P(e,"expire"),a&&r&&(a.returnedStale=!0),r?u:void 0)):(a&&(a.get="hit"),l?u.__staleWhileFetching:(this.#$(c),i&&this.#x(c),u))}else a&&(a.get="miss")}#V(e,t){this.#y[t]=e,this.#g[e]=t}#$(e){e!==this.#h&&(e===this.#d?this.#d=this.#g[e]:this.#V(this.#y[e],this.#g[e]),this.#V(this.#h,e),this.#h=e)}delete(e){return this.#P(e,"delete")}#P(e,t){let r=!1;if(this.#u!==0){let i=this.#o.get(e);if(i!==void 0)if(r=!0,this.#u===1)this.#B(t);else{this.#R(i);let s=this.#i[i];if(this.#l(s)?s.__abortController.abort(new Error("deleted")):(this.#b||this.#p)&&(this.#b&&this.#s?.(s,e,t),this.#p&&this.#m?.push([s,e,t])),this.#o.delete(e),this.#c[i]=void 0,this.#i[i]=void 0,i===this.#h)this.#h=this.#y[i];else if(i===this.#d)this.#d=this.#g[i];else{let a=this.#y[i];this.#g[a]=this.#g[i];let c=this.#g[i];this.#y[c]=this.#y[i]}this.#u--,this.#E.push(i)}}if(this.#p&&this.#m?.length){let i=this.#m,s;for(;s=i?.shift();)this.#n?.(...s)}return r}clear(){return this.#B("delete")}#B(e){for(let t of this.#O({allowStale:!0})){let r=this.#i[t];if(this.#l(r))r.__abortController.abort(new Error("deleted"));else{let i=this.#c[t];this.#b&&this.#s?.(r,i,e),this.#p&&this.#m?.push([r,i,e])}}if(this.#o.clear(),this.#i.fill(void 0),this.#c.fill(void 0),this.#w&&this.#A&&(this.#w.fill(0),this.#A.fill(0)),this.#T&&this.#T.fill(0),this.#d=0,this.#h=0,this.#E.length=0,this.#f=0,this.#u=0,this.#p&&this.#m){let t=this.#m,r;for(;r=t?.shift();)this.#n?.(...r)}}};var Ya=require("node:path"),iS=require("node:url"),Gn=require("fs"),P7=Ye(require("node:fs"),1),qi=require("node:fs/promises");var Of=require("node:events"),_0=Ye(require("node:stream"),1),Zb=require("node:string_decoder");var Qb=typeof process=="object"&&process?process:{stdout:null,stderr:null},S7=o(n=>!!n&&typeof n=="object"&&(n instanceof Ui||n instanceof _0.default||E7(n)||T7(n)),"isStream"),E7=o(n=>!!n&&typeof n=="object"&&n instanceof Of.EventEmitter&&typeof n.pipe=="function"&&n.pipe!==_0.default.Writable.prototype.pipe,"isReadable"),T7=o(n=>!!n&&typeof n=="object"&&n instanceof Of.EventEmitter&&typeof n.write=="function"&&typeof n.end=="function","isWritable"),di=Symbol("EOF"),pi=Symbol("maybeEmitEnd"),Bi=Symbol("emittedEnd"),Sf=Symbol("emittingEnd"),lc=Symbol("emittedError"),Ef=Symbol("closed"),Yb=Symbol("read"),Tf=Symbol("flush"),Xb=Symbol("flushChunk"),yn=Symbol("encoding"),Ka=Symbol("decoder"),Dt=Symbol("flowing"),fc=Symbol("paused"),Qa=Symbol("resume"),It=Symbol("buffer"),yr=Symbol("pipes"),Pt=Symbol("bufferLength"),p0=Symbol("bufferPush"),Af=Symbol("bufferShift"),er=Symbol("objectMode"),mt=Symbol("destroyed"),m0=Symbol("error"),g0=Symbol("emitData"),Jb=Symbol("emitEnd"),y0=Symbol("emitEnd2"),Un=Symbol("async"),v0=Symbol("abort"),xf=Symbol("aborted"),hc=Symbol("signal"),Ns=Symbol("dataListeners"),Nr=Symbol("discarded"),dc=o(n=>Promise.resolve().then(n),"defer"),A7=o(n=>n(),"nodefer"),x7=o(n=>n==="end"||n==="finish"||n==="prefinish","isEndish"),C7=o(n=>n instanceof ArrayBuffer||!!n&&typeof n=="object"&&n.constructor&&n.constructor.name==="ArrayBuffer"&&n.byteLength>=0,"isArrayBufferLike"),O7=o(n=>!Buffer.isBuffer(n)&&ArrayBuffer.isView(n),"isArrayBufferView"),Cf=class{static{o(this,"Pipe")}src;dest;opts;ondrain;constructor(e,t,r){this.src=e,this.dest=t,this.opts=r,this.ondrain=()=>e[Qa](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},w0=class extends Cf{static{o(this,"PipeProxyErrors")}unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,r){super(e,t,r),this.proxyErrors=i=>t.emit("error",i),e.on("error",this.proxyErrors)}},D7=o(n=>!!n.objectMode,"isObjectModeOptions"),I7=o(n=>!n.objectMode&&!!n.encoding&&n.encoding!=="buffer","isEncodingOptions"),Ui=class extends Of.EventEmitter{static{o(this,"Minipass")}[Dt]=!1;[fc]=!1;[yr]=[];[It]=[];[er];[yn];[Un];[Ka];[di]=!1;[Bi]=!1;[Sf]=!1;[Ef]=!1;[lc]=null;[Pt]=0;[mt]=!1;[hc];[xf]=!1;[Ns]=0;[Nr]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");D7(t)?(this[er]=!0,this[yn]=null):I7(t)?(this[yn]=t.encoding,this[er]=!1):(this[er]=!1,this[yn]=null),this[Un]=!!t.async,this[Ka]=this[yn]?new Zb.StringDecoder(this[yn]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:o(()=>this[It],"get")}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:o(()=>this[yr],"get")});let{signal:r}=t;r&&(this[hc]=r,r.aborted?this[v0]():r.addEventListener("abort",()=>this[v0]()))}get bufferLength(){return this[Pt]}get encoding(){return this[yn]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[er]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[Un]}set async(e){this[Un]=this[Un]||!!e}[v0](){this[xf]=!0,this.emit("abort",this[hc]?.reason),this.destroy(this[hc]?.reason)}get aborted(){return this[xf]}set aborted(e){}write(e,t,r){if(this[xf])return!1;if(this[di])throw new Error("write after end");if(this[mt])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(r=t,t="utf8"),t||(t="utf8");let i=this[Un]?dc:A7;if(!this[er]&&!Buffer.isBuffer(e)){if(O7(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(C7(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[er]?(this[Dt]&&this[Pt]!==0&&this[Tf](!0),this[Dt]?this.emit("data",e):this[p0](e),this[Pt]!==0&&this.emit("readable"),r&&i(r),this[Dt]):e.length?(typeof e=="string"&&!(t===this[yn]&&!this[Ka]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[yn]&&(e=this[Ka].write(e)),this[Dt]&&this[Pt]!==0&&this[Tf](!0),this[Dt]?this.emit("data",e):this[p0](e),this[Pt]!==0&&this.emit("readable"),r&&i(r),this[Dt]):(this[Pt]!==0&&this.emit("readable"),r&&i(r),this[Dt])}read(e){if(this[mt])return null;if(this[Nr]=!1,this[Pt]===0||e===0||e&&e>this[Pt])return this[pi](),null;this[er]&&(e=null),this[It].length>1&&!this[er]&&(this[It]=[this[yn]?this[It].join(""):Buffer.concat(this[It],this[Pt])]);let t=this[Yb](e||null,this[It][0]);return this[pi](),t}[Yb](e,t){if(this[er])this[Af]();else{let r=t;e===r.length||e===null?this[Af]():typeof r=="string"?(this[It][0]=r.slice(e),t=r.slice(0,e),this[Pt]-=e):(this[It][0]=r.subarray(e),t=r.subarray(0,e),this[Pt]-=e)}return this.emit("data",t),!this[It].length&&!this[di]&&this.emit("drain"),t}end(e,t,r){return typeof e=="function"&&(r=e,e=void 0),typeof t=="function"&&(r=t,t="utf8"),e!==void 0&&this.write(e,t),r&&this.once("end",r),this[di]=!0,this.writable=!1,(this[Dt]||!this[fc])&&this[pi](),this}[Qa](){this[mt]||(!this[Ns]&&!this[yr].length&&(this[Nr]=!0),this[fc]=!1,this[Dt]=!0,this.emit("resume"),this[It].length?this[Tf]():this[di]?this[pi]():this.emit("drain"))}resume(){return this[Qa]()}pause(){this[Dt]=!1,this[fc]=!0,this[Nr]=!1}get destroyed(){return this[mt]}get flowing(){return this[Dt]}get paused(){return this[fc]}[p0](e){this[er]?this[Pt]+=1:this[Pt]+=e.length,this[It].push(e)}[Af](){return this[er]?this[Pt]-=1:this[Pt]-=this[It][0].length,this[It].shift()}[Tf](e=!1){do;while(this[Xb](this[Af]())&&this[It].length);!e&&!this[It].length&&!this[di]&&this.emit("drain")}[Xb](e){return this.emit("data",e),this[Dt]}pipe(e,t){if(this[mt])return e;this[Nr]=!1;let r=this[Bi];return t=t||{},e===Qb.stdout||e===Qb.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,r?t.end&&e.end():(this[yr].push(t.proxyErrors?new w0(this,e,t):new Cf(this,e,t)),this[Un]?dc(()=>this[Qa]()):this[Qa]()),e}unpipe(e){let t=this[yr].find(r=>r.dest===e);t&&(this[yr].length===1?(this[Dt]&&this[Ns]===0&&(this[Dt]=!1),this[yr]=[]):this[yr].splice(this[yr].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let r=super.on(e,t);if(e==="data")this[Nr]=!1,this[Ns]++,!this[yr].length&&!this[Dt]&&this[Qa]();else if(e==="readable"&&this[Pt]!==0)super.emit("readable");else if(x7(e)&&this[Bi])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[lc]){let i=t;this[Un]?dc(()=>i.call(this,this[lc])):i.call(this,this[lc])}return r}removeListener(e,t){return this.off(e,t)}off(e,t){let r=super.off(e,t);return e==="data"&&(this[Ns]=this.listeners("data").length,this[Ns]===0&&!this[Nr]&&!this[yr].length&&(this[Dt]=!1)),r}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[Ns]=0,!this[Nr]&&!this[yr].length&&(this[Dt]=!1)),t}get emittedEnd(){return this[Bi]}[pi](){!this[Sf]&&!this[Bi]&&!this[mt]&&this[It].length===0&&this[di]&&(this[Sf]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Ef]&&this.emit("close"),this[Sf]=!1)}emit(e,...t){let r=t[0];if(e!=="error"&&e!=="close"&&e!==mt&&this[mt])return!1;if(e==="data")return!this[er]&&!r?!1:this[Un]?(dc(()=>this[g0](r)),!0):this[g0](r);if(e==="end")return this[Jb]();if(e==="close"){if(this[Ef]=!0,!this[Bi]&&!this[mt])return!1;let s=super.emit("close");return this.removeAllListeners("close"),s}else if(e==="error"){this[lc]=r,super.emit(m0,r);let s=!this[hc]||this.listeners("error").length?super.emit("error",r):!1;return this[pi](),s}else if(e==="resume"){let s=super.emit("resume");return this[pi](),s}else if(e==="finish"||e==="prefinish"){let s=super.emit(e);return this.removeAllListeners(e),s}let i=super.emit(e,...t);return this[pi](),i}[g0](e){for(let r of this[yr])r.dest.write(e)===!1&&this.pause();let t=this[Nr]?!1:super.emit("data",e);return this[pi](),t}[Jb](){return this[Bi]?!1:(this[Bi]=!0,this.readable=!1,this[Un]?(dc(()=>this[y0]()),!0):this[y0]())}[y0](){if(this[Ka]){let t=this[Ka].end();if(t){for(let r of this[yr])r.dest.write(t);this[Nr]||super.emit("data",t)}}for(let t of this[yr])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[er]||(e.dataLength=0);let t=this.promise();return this.on("data",r=>{e.push(r),this[er]||(e.dataLength+=r.length)}),await t,e}async concat(){if(this[er])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[yn]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(mt,()=>t(new Error("stream destroyed"))),this.on("error",r=>t(r)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[Nr]=!1;let e=!1,t=o(async()=>(this.pause(),e=!0,{value:void 0,done:!0}),"stop");return{next:o(()=>{if(e)return t();let i=this.read();if(i!==null)return Promise.resolve({done:!1,value:i});if(this[di])return t();let s,a,c=o(h=>{this.off("data",u),this.off("end",l),this.off(mt,f),t(),a(h)},"onerr"),u=o(h=>{this.off("error",c),this.off("end",l),this.off(mt,f),this.pause(),s({value:h,done:!!this[di]})},"ondata"),l=o(()=>{this.off("error",c),this.off("data",u),this.off(mt,f),t(),s({done:!0,value:void 0})},"onend"),f=o(()=>c(new Error("stream destroyed")),"ondestroy");return new Promise((h,d)=>{a=d,s=h,this.once(mt,f),this.once("error",c),this.once("end",l),this.once("data",u)})},"next"),throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[Nr]=!1;let e=!1,t=o(()=>(this.pause(),this.off(m0,t),this.off(mt,t),this.off("end",t),e=!0,{done:!0,value:void 0}),"stop"),r=o(()=>{if(e)return t();let i=this.read();return i===null?t():{done:!1,value:i}},"next");return this.once("end",t),this.once(m0,t),this.once(mt,t),{next:r,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[mt])return e?this.emit("error",e):this.emit(mt),this;this[mt]=!0,this[Nr]=!0,this[It].length=0,this[Pt]=0;let t=this;return typeof t.close=="function"&&!this[Ef]&&t.close(),e?this.emit("error",e):this.emit(mt),this}static get isStream(){return S7}};var F7=Gn.realpathSync.native,mc={lstatSync:Gn.lstatSync,readdir:Gn.readdir,readdirSync:Gn.readdirSync,readlinkSync:Gn.readlinkSync,realpathSync:F7,promises:{lstat:qi.lstat,readdir:qi.readdir,readlink:qi.readlink,realpath:qi.realpath}},sS=o(n=>!n||n===mc||n===P7?mc:{...mc,...n,promises:{...mc.promises,...n.promises||{}}},"fsFromOption"),aS=/^\\\\\?\\([a-z]:)\\?$/i,R7=o(n=>n.replace(/\//g,"\\").replace(aS,"$1\\"),"uncToDrive"),N7=/[\\\/]/,qr=0,oS=1,cS=2,qn=4,uS=6,lS=8,ks=10,fS=12,Ur=15,pc=~Ur,b0=16,eS=32,gc=64,vn=128,Df=256,Pf=512,tS=gc|vn|Pf,k7=1023,S0=o(n=>n.isFile()?lS:n.isDirectory()?qn:n.isSymbolicLink()?ks:n.isCharacterDevice()?cS:n.isBlockDevice()?uS:n.isSocket()?fS:n.isFIFO()?oS:qr,"entToType"),rS=new Map,yc=o(n=>{let e=rS.get(n);if(e)return e;let t=n.normalize("NFKD");return rS.set(n,t),t},"normalize"),nS=new Map,If=o(n=>{let e=nS.get(n);if(e)return e;let t=yc(n.toLowerCase());return nS.set(n,t),t},"normalizeNocase"),Ff=class extends uc{static{o(this,"ResolveCache")}constructor(){super({max:256})}},E0=class extends uc{static{o(this,"ChildrenCache")}constructor(e=16*1024){super({maxSize:e,sizeCalculation:o(t=>t.length+1,"sizeCalculation")})}},hS=Symbol("PathScurry setAsCwd"),tr=class{static{o(this,"PathBase")}name;root;roots;parent;nocase;isCWD=!1;#e;#t;get dev(){return this.#t}#s;get mode(){return this.#s}#n;get nlink(){return this.#n}#a;get uid(){return this.#a}#_;get gid(){return this.#_}#u;get rdev(){return this.#u}#f;get blksize(){return this.#f}#o;get ino(){return this.#o}#c;get size(){return this.#c}#i;get blocks(){return this.#i}#g;get atimeMs(){return this.#g}#y;get mtimeMs(){return this.#y}#d;get ctimeMs(){return this.#d}#h;get birthtimeMs(){return this.#h}#E;get atime(){return this.#E}#m;get mtime(){return this.#m}#T;get ctime(){return this.#T}#A;get birthtime(){return this.#A}#w;#b;#S;#p;#D;#x;#r;#F;#v;#I;get parentPath(){return(this.parent||this).fullpath()}get path(){return this.parentPath}constructor(e,t=qr,r,i,s,a,c){this.name=e,this.#w=s?If(e):yc(e),this.#r=t&k7,this.nocase=s,this.roots=i,this.root=r||this,this.#F=a,this.#S=c.fullpath,this.#D=c.relative,this.#x=c.relativePosix,this.parent=c.parent,this.parent?this.#e=this.parent.#e:this.#e=sS(c.fs)}depth(){return this.#b!==void 0?this.#b:this.parent?this.#b=this.parent.depth()+1:this.#b=0}childrenCache(){return this.#F}resolve(e){if(!e)return this;let t=this.getRootString(e),i=e.substring(t.length).split(this.splitSep);return t?this.getRoot(t).#R(i):this.#R(i)}#R(e){let t=this;for(let r of e)t=t.child(r);return t}children(){let e=this.#F.get(this);if(e)return e;let t=Object.assign([],{provisional:0});return this.#F.set(this,t),this.#r&=~b0,t}child(e,t){if(e===""||e===".")return this;if(e==="..")return this.parent||this;let r=this.children(),i=this.nocase?If(e):yc(e);for(let u of r)if(u.#w===i)return u;let s=this.parent?this.sep:"",a=this.#S?this.#S+s+e:void 0,c=this.newChild(e,qr,{...t,parent:this,fullpath:a});return this.canReaddir()||(c.#r|=vn),r.push(c),c}relative(){if(this.isCWD)return"";if(this.#D!==void 0)return this.#D;let e=this.name,t=this.parent;if(!t)return this.#D=this.name;let r=t.relative();return r+(!r||!t.parent?"":this.sep)+e}relativePosix(){if(this.sep==="/")return this.relative();if(this.isCWD)return"";if(this.#x!==void 0)return this.#x;let e=this.name,t=this.parent;if(!t)return this.#x=this.fullpathPosix();let r=t.relativePosix();return r+(!r||!t.parent?"":"/")+e}fullpath(){if(this.#S!==void 0)return this.#S;let e=this.name,t=this.parent;if(!t)return this.#S=this.name;let i=t.fullpath()+(t.parent?this.sep:"")+e;return this.#S=i}fullpathPosix(){if(this.#p!==void 0)return this.#p;if(this.sep==="/")return this.#p=this.fullpath();if(!this.parent){let i=this.fullpath().replace(/\\/g,"/");return/^[a-z]:\//i.test(i)?this.#p=`//?/${i}`:this.#p=i}let e=this.parent,t=e.fullpathPosix(),r=t+(!t||!e.parent?"":"/")+this.name;return this.#p=r}isUnknown(){return(this.#r&Ur)===qr}isType(e){return this[`is${e}`]()}getType(){return this.isUnknown()?"Unknown":this.isDirectory()?"Directory":this.isFile()?"File":this.isSymbolicLink()?"SymbolicLink":this.isFIFO()?"FIFO":this.isCharacterDevice()?"CharacterDevice":this.isBlockDevice()?"BlockDevice":this.isSocket()?"Socket":"Unknown"}isFile(){return(this.#r&Ur)===lS}isDirectory(){return(this.#r&Ur)===qn}isCharacterDevice(){return(this.#r&Ur)===cS}isBlockDevice(){return(this.#r&Ur)===uS}isFIFO(){return(this.#r&Ur)===oS}isSocket(){return(this.#r&Ur)===fS}isSymbolicLink(){return(this.#r&ks)===ks}lstatCached(){return this.#r&eS?this:void 0}readlinkCached(){return this.#v}realpathCached(){return this.#I}readdirCached(){let e=this.children();return e.slice(0,e.provisional)}canReadlink(){if(this.#v)return!0;if(!this.parent)return!1;let e=this.#r&Ur;return!(e!==qr&&e!==ks||this.#r&Df||this.#r&vn)}calledReaddir(){return!!(this.#r&b0)}isENOENT(){return!!(this.#r&vn)}isNamed(e){return this.nocase?this.#w===If(e):this.#w===yc(e)}async readlink(){let e=this.#v;if(e)return e;if(this.canReadlink()&&this.parent)try{let t=await this.#e.promises.readlink(this.fullpath()),r=(await this.parent.realpath())?.resolve(t);if(r)return this.#v=r}catch(t){this.#l(t.code);return}}readlinkSync(){let e=this.#v;if(e)return e;if(this.canReadlink()&&this.parent)try{let t=this.#e.readlinkSync(this.fullpath()),r=this.parent.realpathSync()?.resolve(t);if(r)return this.#v=r}catch(t){this.#l(t.code);return}}#N(e){this.#r|=b0;for(let t=e.provisional;t<e.length;t++){let r=e[t];r&&r.#k()}}#k(){this.#r&vn||(this.#r=(this.#r|vn)&pc,this.#C())}#C(){let e=this.children();e.provisional=0;for(let t of e)t.#k()}#O(){this.#r|=Pf,this.#L()}#L(){if(this.#r&gc)return;let e=this.#r;(e&Ur)===qn&&(e&=pc),this.#r=e|gc,this.#C()}#j(e=""){e==="ENOTDIR"||e==="EPERM"?this.#L():e==="ENOENT"?this.#k():this.children().provisional=0}#M(e=""){e==="ENOTDIR"?this.parent.#L():e==="ENOENT"&&this.#k()}#l(e=""){let t=this.#r;t|=Df,e==="ENOENT"&&(t|=vn),(e==="EINVAL"||e==="UNKNOWN")&&(t&=pc),this.#r=t,e==="ENOTDIR"&&this.parent&&this.parent.#L()}#V(e,t){return this.#P(e,t)||this.#$(e,t)}#$(e,t){let r=S0(e),i=this.newChild(e.name,r,{parent:this}),s=i.#r&Ur;return s!==qn&&s!==ks&&s!==qr&&(i.#r|=gc),t.unshift(i),t.provisional++,i}#P(e,t){for(let r=t.provisional;r<t.length;r++){let i=t[r];if((this.nocase?If(e.name):yc(e.name))===i.#w)return this.#B(e,i,r,t)}}#B(e,t,r,i){let s=t.name;return t.#r=t.#r&pc|S0(e),s!==e.name&&(t.name=e.name),r!==i.provisional&&(r===i.length-1?i.pop():i.splice(r,1),i.unshift(t)),i.provisional++,t}async lstat(){if((this.#r&vn)===0)try{return this.#W(await this.#e.promises.lstat(this.fullpath())),this}catch(e){this.#M(e.code)}}lstatSync(){if((this.#r&vn)===0)try{return this.#W(this.#e.lstatSync(this.fullpath())),this}catch(e){this.#M(e.code)}}#W(e){let{atime:t,atimeMs:r,birthtime:i,birthtimeMs:s,blksize:a,blocks:c,ctime:u,ctimeMs:l,dev:f,gid:h,ino:d,mode:m,mtime:_,mtimeMs:b,nlink:C,rdev:O,size:I,uid:L}=e;this.#E=t,this.#g=r,this.#A=i,this.#h=s,this.#f=a,this.#i=c,this.#T=u,this.#d=l,this.#t=f,this.#_=h,this.#o=d,this.#s=m,this.#m=_,this.#y=b,this.#n=C,this.#u=O,this.#c=I,this.#a=L;let G=S0(e);this.#r=this.#r&pc|G|eS,G!==qr&&G!==qn&&G!==ks&&(this.#r|=gc)}#q=[];#G=!1;#z(e){this.#G=!1;let t=this.#q.slice();this.#q.length=0,t.forEach(r=>r(null,e))}readdirCB(e,t=!1){if(!this.canReaddir()){t?e(null,[]):queueMicrotask(()=>e(null,[]));return}let r=this.children();if(this.calledReaddir()){let s=r.slice(0,r.provisional);t?e(null,s):queueMicrotask(()=>e(null,s));return}if(this.#q.push(e),this.#G)return;this.#G=!0;let i=this.fullpath();this.#e.readdir(i,{withFileTypes:!0},(s,a)=>{if(s)this.#j(s.code),r.provisional=0;else{for(let c of a)this.#V(c,r);this.#N(r)}this.#z(r.slice(0,r.provisional))})}#U;async readdir(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();if(this.#U)await this.#U;else{let r=o(()=>{},"resolve");this.#U=new Promise(i=>r=i);try{for(let i of await this.#e.promises.readdir(t,{withFileTypes:!0}))this.#V(i,e);this.#N(e)}catch(i){this.#j(i.code),e.provisional=0}this.#U=void 0,r()}return e.slice(0,e.provisional)}readdirSync(){if(!this.canReaddir())return[];let e=this.children();if(this.calledReaddir())return e.slice(0,e.provisional);let t=this.fullpath();try{for(let r of this.#e.readdirSync(t,{withFileTypes:!0}))this.#V(r,e);this.#N(e)}catch(r){this.#j(r.code),e.provisional=0}return e.slice(0,e.provisional)}canReaddir(){if(this.#r&tS)return!1;let e=Ur&this.#r;return e===qr||e===qn||e===ks}shouldWalk(e,t){return(this.#r&qn)===qn&&!(this.#r&tS)&&!e.has(this)&&(!t||t(this))}async realpath(){if(this.#I)return this.#I;if(!((Pf|Df|vn)&this.#r))try{let e=await this.#e.promises.realpath(this.fullpath());return this.#I=this.resolve(e)}catch{this.#O()}}realpathSync(){if(this.#I)return this.#I;if(!((Pf|Df|vn)&this.#r))try{let e=this.#e.realpathSync(this.fullpath());return this.#I=this.resolve(e)}catch{this.#O()}}[hS](e){if(e===this)return;e.isCWD=!1,this.isCWD=!0;let t=new Set([]),r=[],i=this;for(;i&&i.parent;)t.add(i),i.#D=r.join(this.sep),i.#x=r.join("/"),i=i.parent,r.push("..");for(i=e;i&&i.parent&&!t.has(i);)i.#D=void 0,i.#x=void 0,i=i.parent}},Rf=class n extends tr{static{o(this,"PathWin32")}sep="\\";splitSep=N7;constructor(e,t=qr,r,i,s,a,c){super(e,t,r,i,s,a,c)}newChild(e,t=qr,r={}){return new n(e,t,this.root,this.roots,this.nocase,this.childrenCache(),r)}getRootString(e){return Ya.win32.parse(e).root}getRoot(e){if(e=R7(e.toUpperCase()),e===this.root.name)return this.root;for(let[t,r]of Object.entries(this.roots))if(this.sameRoot(e,t))return this.roots[e]=r;return this.roots[e]=new Xa(e,this).root}sameRoot(e,t=this.root.name){return e=e.toUpperCase().replace(/\//g,"\\").replace(aS,"$1\\"),e===t}},Nf=class n extends tr{static{o(this,"PathPosix")}splitSep="/";sep="/";constructor(e,t=qr,r,i,s,a,c){super(e,t,r,i,s,a,c)}getRootString(e){return e.startsWith("/")?"/":""}getRoot(e){return this.root}newChild(e,t=qr,r={}){return new n(e,t,this.root,this.roots,this.nocase,this.childrenCache(),r)}},kf=class{static{o(this,"PathScurryBase")}root;rootPath;roots;cwd;#e;#t;#s;nocase;#n;constructor(e=process.cwd(),t,r,{nocase:i,childrenCacheSize:s=16*1024,fs:a=mc}={}){this.#n=sS(a),(e instanceof URL||e.startsWith("file://"))&&(e=(0,iS.fileURLToPath)(e));let c=t.resolve(e);this.roots=Object.create(null),this.rootPath=this.parseRootPath(c),this.#e=new Ff,this.#t=new Ff,this.#s=new E0(s);let u=c.substring(this.rootPath.length).split(r);if(u.length===1&&!u[0]&&u.pop(),i===void 0)throw new TypeError("must provide nocase setting to PathScurryBase ctor");this.nocase=i,this.root=this.newRoot(this.#n),this.roots[this.rootPath]=this.root;let l=this.root,f=u.length-1,h=t.sep,d=this.rootPath,m=!1;for(let _ of u){let b=f--;l=l.child(_,{relative:new Array(b).fill("..").join(h),relativePosix:new Array(b).fill("..").join("/"),fullpath:d+=(m?"":h)+_}),m=!0}this.cwd=l}depth(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.depth()}childrenCache(){return this.#s}resolve(...e){let t="";for(let s=e.length-1;s>=0;s--){let a=e[s];if(!(!a||a===".")&&(t=t?`${a}/${t}`:a,this.isAbsolute(a)))break}let r=this.#e.get(t);if(r!==void 0)return r;let i=this.cwd.resolve(t).fullpath();return this.#e.set(t,i),i}resolvePosix(...e){let t="";for(let s=e.length-1;s>=0;s--){let a=e[s];if(!(!a||a===".")&&(t=t?`${a}/${t}`:a,this.isAbsolute(a)))break}let r=this.#t.get(t);if(r!==void 0)return r;let i=this.cwd.resolve(t).fullpathPosix();return this.#t.set(t,i),i}relative(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.relative()}relativePosix(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.relativePosix()}basename(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.name}dirname(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),(e.parent||e).fullpath()}async readdir(e=this.cwd,t={withFileTypes:!0}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd);let{withFileTypes:r}=t;if(e.canReaddir()){let i=await e.readdir();return r?i:i.map(s=>s.name)}else return[]}readdirSync(e=this.cwd,t={withFileTypes:!0}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd);let{withFileTypes:r=!0}=t;return e.canReaddir()?r?e.readdirSync():e.readdirSync().map(i=>i.name):[]}async lstat(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.lstat()}lstatSync(e=this.cwd){return typeof e=="string"&&(e=this.cwd.resolve(e)),e.lstatSync()}async readlink(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e.withFileTypes,e=this.cwd);let r=await e.readlink();return t?r:r?.fullpath()}readlinkSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e.withFileTypes,e=this.cwd);let r=e.readlinkSync();return t?r:r?.fullpath()}async realpath(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e.withFileTypes,e=this.cwd);let r=await e.realpath();return t?r:r?.fullpath()}realpathSync(e=this.cwd,{withFileTypes:t}={withFileTypes:!1}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e.withFileTypes,e=this.cwd);let r=e.realpathSync();return t?r:r?.fullpath()}async walk(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=[];(!s||s(e))&&c.push(r?e:e.fullpath());let u=new Set,l=o((h,d)=>{u.add(h),h.readdirCB((m,_)=>{if(m)return d(m);let b=_.length;if(!b)return d();let C=o(()=>{--b===0&&d()},"next");for(let O of _)(!s||s(O))&&c.push(r?O:O.fullpath()),i&&O.isSymbolicLink()?O.realpath().then(I=>I?.isUnknown()?I.lstat():I).then(I=>I?.shouldWalk(u,a)?l(I,C):C()):O.shouldWalk(u,a)?l(O,C):C()},!0)},"walk"),f=e;return new Promise((h,d)=>{l(f,m=>{if(m)return d(m);h(c)})})}walkSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=[];(!s||s(e))&&c.push(r?e:e.fullpath());let u=new Set([e]);for(let l of u){let f=l.readdirSync();for(let h of f){(!s||s(h))&&c.push(r?h:h.fullpath());let d=h;if(h.isSymbolicLink()){if(!(i&&(d=h.realpathSync())))continue;d.isUnknown()&&d.lstatSync()}d.shouldWalk(u,a)&&u.add(d)}}return c}[Symbol.asyncIterator](){return this.iterate()}iterate(e=this.cwd,t={}){return typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd),this.stream(e,t)[Symbol.asyncIterator]()}[Symbol.iterator](){return this.iterateSync()}*iterateSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t;(!s||s(e))&&(yield r?e:e.fullpath());let c=new Set([e]);for(let u of c){let l=u.readdirSync();for(let f of l){(!s||s(f))&&(yield r?f:f.fullpath());let h=f;if(f.isSymbolicLink()){if(!(i&&(h=f.realpathSync())))continue;h.isUnknown()&&h.lstatSync()}h.shouldWalk(c,a)&&c.add(h)}}}stream(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=new Ui({objectMode:!0});(!s||s(e))&&c.write(r?e:e.fullpath());let u=new Set,l=[e],f=0,h=o(()=>{let d=!1;for(;!d;){let m=l.shift();if(!m){f===0&&c.end();return}f++,u.add(m);let _=o((C,O,I=!1)=>{if(C)return c.emit("error",C);if(i&&!I){let L=[];for(let G of O)G.isSymbolicLink()&&L.push(G.realpath().then(W=>W?.isUnknown()?W.lstat():W));if(L.length){Promise.all(L).then(()=>_(null,O,!0));return}}for(let L of O)L&&(!s||s(L))&&(c.write(r?L:L.fullpath())||(d=!0));f--;for(let L of O){let G=L.realpathCached()||L;G.shouldWalk(u,a)&&l.push(G)}d&&!c.flowing?c.once("drain",h):b||h()},"onReaddir"),b=!0;m.readdirCB(_,!0),b=!1}},"process");return h(),c}streamSync(e=this.cwd,t={}){typeof e=="string"?e=this.cwd.resolve(e):e instanceof tr||(t=e,e=this.cwd);let{withFileTypes:r=!0,follow:i=!1,filter:s,walkFilter:a}=t,c=new Ui({objectMode:!0}),u=new Set;(!s||s(e))&&c.write(r?e:e.fullpath());let l=[e],f=0,h=o(()=>{let d=!1;for(;!d;){let m=l.shift();if(!m){f===0&&c.end();return}f++,u.add(m);let _=m.readdirSync();for(let b of _)(!s||s(b))&&(c.write(r?b:b.fullpath())||(d=!0));f--;for(let b of _){let C=b;if(b.isSymbolicLink()){if(!(i&&(C=b.realpathSync())))continue;C.isUnknown()&&C.lstatSync()}C.shouldWalk(u,a)&&l.push(C)}}d&&!c.flowing&&c.once("drain",h)},"process");return h(),c}chdir(e=this.cwd){let t=this.cwd;this.cwd=typeof e=="string"?this.cwd.resolve(e):e,this.cwd[hS](t)}},Xa=class extends kf{static{o(this,"PathScurryWin32")}sep="\\";constructor(e=process.cwd(),t={}){let{nocase:r=!0}=t;super(e,Ya.win32,"\\",{...t,nocase:r}),this.nocase=r;for(let i=this.cwd;i;i=i.parent)i.nocase=this.nocase}parseRootPath(e){return Ya.win32.parse(e).root.toUpperCase()}newRoot(e){return new Rf(this.rootPath,qn,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith("/")||e.startsWith("\\")||/^[a-z]:(\/|\\)/i.test(e)}},Ja=class extends kf{static{o(this,"PathScurryPosix")}sep="/";constructor(e=process.cwd(),t={}){let{nocase:r=!1}=t;super(e,Ya.posix,"/",{...t,nocase:r}),this.nocase=r}parseRootPath(e){return"/"}newRoot(e){return new Nf(this.rootPath,qn,void 0,this.roots,this.nocase,this.childrenCache(),{fs:e})}isAbsolute(e){return e.startsWith("/")}},vc=class extends Ja{static{o(this,"PathScurryDarwin")}constructor(e=process.cwd(),t={}){let{nocase:r=!0}=t;super(e,{...t,nocase:r})}},rG=process.platform==="win32"?Rf:Nf,dS=process.platform==="win32"?Xa:process.platform==="darwin"?vc:Ja;var L7=o(n=>n.length>=1,"isPatternList"),j7=o(n=>n.length>=1,"isGlobList"),Za=class n{static{o(this,"Pattern")}#e;#t;#s;length;#n;#a;#_;#u;#f;#o;#c=!0;constructor(e,t,r,i){if(!L7(e))throw new TypeError("empty pattern list");if(!j7(t))throw new TypeError("empty glob list");if(t.length!==e.length)throw new TypeError("mismatched pattern list and glob list lengths");if(this.length=e.length,r<0||r>=this.length)throw new TypeError("index out of range");if(this.#e=e,this.#t=t,this.#s=r,this.#n=i,this.#s===0){if(this.isUNC()){let[s,a,c,u,...l]=this.#e,[f,h,d,m,..._]=this.#t;l[0]===""&&(l.shift(),_.shift());let b=[s,a,c,u,""].join("/"),C=[f,h,d,m,""].join("/");this.#e=[b,...l],this.#t=[C,..._],this.length=this.#e.length}else if(this.isDrive()||this.isAbsolute()){let[s,...a]=this.#e,[c,...u]=this.#t;a[0]===""&&(a.shift(),u.shift());let l=s+"/",f=c+"/";this.#e=[l,...a],this.#t=[f,...u],this.length=this.#e.length}}}pattern(){return this.#e[this.#s]}isString(){return typeof this.#e[this.#s]=="string"}isGlobstar(){return this.#e[this.#s]===Bt}isRegExp(){return this.#e[this.#s]instanceof RegExp}globString(){return this.#_=this.#_||(this.#s===0?this.isAbsolute()?this.#t[0]+this.#t.slice(1).join("/"):this.#t.join("/"):this.#t.slice(this.#s).join("/"))}hasMore(){return this.length>this.#s+1}rest(){return this.#a!==void 0?this.#a:this.hasMore()?(this.#a=new n(this.#e,this.#t,this.#s+1,this.#n),this.#a.#o=this.#o,this.#a.#f=this.#f,this.#a.#u=this.#u,this.#a):this.#a=null}isUNC(){let e=this.#e;return this.#f!==void 0?this.#f:this.#f=this.#n==="win32"&&this.#s===0&&e[0]===""&&e[1]===""&&typeof e[2]=="string"&&!!e[2]&&typeof e[3]=="string"&&!!e[3]}isDrive(){let e=this.#e;return this.#u!==void 0?this.#u:this.#u=this.#n==="win32"&&this.#s===0&&this.length>1&&typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0])}isAbsolute(){let e=this.#e;return this.#o!==void 0?this.#o:this.#o=e[0]===""&&e.length>1||this.isDrive()||this.isUNC()}root(){let e=this.#e[0];return typeof e=="string"&&this.isAbsolute()&&this.#s===0?e:""}checkFollowGlobstar(){return!(this.#s===0||!this.isGlobstar()||!this.#c)}markFollowGlobstar(){return this.#s===0||!this.isGlobstar()||!this.#c?!1:(this.#c=!1,!0)}};var M7=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",eo=class{static{o(this,"Ignore")}relative;relativeChildren;absolute;absoluteChildren;platform;mmopts;constructor(e,{nobrace:t,nocase:r,noext:i,noglobstar:s,platform:a=M7}){this.relative=[],this.absolute=[],this.relativeChildren=[],this.absoluteChildren=[],this.platform=a,this.mmopts={dot:!0,nobrace:t,nocase:r,noext:i,noglobstar:s,optimizationLevel:2,platform:a,nocomment:!0,nonegate:!0};for(let c of e)this.add(c)}add(e){let t=new Rr(e,this.mmopts);for(let r=0;r<t.set.length;r++){let i=t.set[r],s=t.globParts[r];if(!i||!s)throw new Error("invalid pattern object");for(;i[0]==="."&&s[0]===".";)i.shift(),s.shift();let a=new Za(i,s,0,this.platform),c=new Rr(a.globString(),this.mmopts),u=s[s.length-1]==="**",l=a.isAbsolute();l?this.absolute.push(c):this.relative.push(c),u&&(l?this.absoluteChildren.push(c):this.relativeChildren.push(c))}}ignored(e){let t=e.fullpath(),r=`${t}/`,i=e.relative()||".",s=`${i}/`;for(let a of this.relative)if(a.match(i)||a.match(s))return!0;for(let a of this.absolute)if(a.match(t)||a.match(r))return!0;return!1}childrenIgnored(e){let t=e.fullpath()+"/",r=(e.relative()||".")+"/";for(let i of this.relativeChildren)if(i.match(r))return!0;for(let i of this.absoluteChildren)if(i.match(t))return!0;return!1}};var T0=class n{static{o(this,"HasWalkedCache")}store;constructor(e=new Map){this.store=e}copy(){return new n(new Map(this.store))}hasWalked(e,t){return this.store.get(e.fullpath())?.has(t.globString())}storeWalked(e,t){let r=e.fullpath(),i=this.store.get(r);i?i.add(t.globString()):this.store.set(r,new Set([t.globString()]))}},A0=class{static{o(this,"MatchRecord")}store=new Map;add(e,t,r){let i=(t?2:0)|(r?1:0),s=this.store.get(e);this.store.set(e,s===void 0?i:i&s)}entries(){return[...this.store.entries()].map(([e,t])=>[e,!!(t&2),!!(t&1)])}},x0=class{static{o(this,"SubWalks")}store=new Map;add(e,t){if(!e.canReaddir())return;let r=this.store.get(e);r?r.find(i=>i.globString()===t.globString())||r.push(t):this.store.set(e,[t])}get(e){let t=this.store.get(e);if(!t)throw new Error("attempting to walk unknown path");return t}entries(){return this.keys().map(e=>[e,this.store.get(e)])}keys(){return[...this.store.keys()].filter(e=>e.canReaddir())}},wc=class n{static{o(this,"Processor")}hasWalkedCache;matches=new A0;subwalks=new x0;patterns;follow;dot;opts;constructor(e,t){this.opts=e,this.follow=!!e.follow,this.dot=!!e.dot,this.hasWalkedCache=t?t.copy():new T0}processPatterns(e,t){this.patterns=t;let r=t.map(i=>[e,i]);for(let[i,s]of r){this.hasWalkedCache.storeWalked(i,s);let a=s.root(),c=s.isAbsolute()&&this.opts.absolute!==!1;if(a){i=i.resolve(a==="/"&&this.opts.root!==void 0?this.opts.root:a);let h=s.rest();if(h)s=h;else{this.matches.add(i,!0,!1);continue}}if(i.isENOENT())continue;let u,l,f=!1;for(;typeof(u=s.pattern())=="string"&&(l=s.rest());)i=i.resolve(u),s=l,f=!0;if(u=s.pattern(),l=s.rest(),f){if(this.hasWalkedCache.hasWalked(i,s))continue;this.hasWalkedCache.storeWalked(i,s)}if(typeof u=="string"){let h=u===".."||u===""||u===".";this.matches.add(i.resolve(u),c,h);continue}else if(u===Bt){(!i.isSymbolicLink()||this.follow||s.checkFollowGlobstar())&&this.subwalks.add(i,s);let h=l?.pattern(),d=l?.rest();if(!l||(h===""||h===".")&&!d)this.matches.add(i,c,h===""||h===".");else if(h===".."){let m=i.parent||i;d?this.hasWalkedCache.hasWalked(m,d)||this.subwalks.add(m,d):this.matches.add(m,c,!0)}}else u instanceof RegExp&&this.subwalks.add(i,s)}return this}subwalkTargets(){return this.subwalks.keys()}child(){return new n(this.opts,this.hasWalkedCache)}filterEntries(e,t){let r=this.subwalks.get(e),i=this.child();for(let s of t)for(let a of r){let c=a.isAbsolute(),u=a.pattern(),l=a.rest();u===Bt?i.testGlobstar(s,a,l,c):u instanceof RegExp?i.testRegExp(s,u,l,c):i.testString(s,u,l,c)}return i}testGlobstar(e,t,r,i){if((this.dot||!e.name.startsWith("."))&&(t.hasMore()||this.matches.add(e,i,!1),e.canReaddir()&&(this.follow||!e.isSymbolicLink()?this.subwalks.add(e,t):e.isSymbolicLink()&&(r&&t.checkFollowGlobstar()?this.subwalks.add(e,r):t.markFollowGlobstar()&&this.subwalks.add(e,t)))),r){let s=r.pattern();if(typeof s=="string"&&s!==".."&&s!==""&&s!==".")this.testString(e,s,r.rest(),i);else if(s===".."){let a=e.parent||e;this.subwalks.add(a,r)}else s instanceof RegExp&&this.testRegExp(e,s,r.rest(),i)}}testRegExp(e,t,r,i){t.test(e.name)&&(r?this.subwalks.add(e,r):this.matches.add(e,i,!1))}testString(e,t,r,i){e.isNamed(t)&&(r?this.subwalks.add(e,r):this.matches.add(e,i,!1))}};var V7=o((n,e)=>typeof n=="string"?new eo([n],e):Array.isArray(n)?new eo(n,e):n,"makeIgnore"),Lf=class{static{o(this,"GlobUtil")}path;patterns;opts;seen=new Set;paused=!1;aborted=!1;#e=[];#t;#s;signal;maxDepth;includeChildMatches;constructor(e,t,r){if(this.patterns=e,this.path=t,this.opts=r,this.#s=!r.posix&&r.platform==="win32"?"\\":"/",this.includeChildMatches=r.includeChildMatches!==!1,(r.ignore||!this.includeChildMatches)&&(this.#t=V7(r.ignore??[],r),!this.includeChildMatches&&typeof this.#t.add!="function")){let i="cannot ignore child matches, ignore lacks add() method.";throw new Error(i)}this.maxDepth=r.maxDepth||1/0,r.signal&&(this.signal=r.signal,this.signal.addEventListener("abort",()=>{this.#e.length=0}))}#n(e){return this.seen.has(e)||!!this.#t?.ignored?.(e)}#a(e){return!!this.#t?.childrenIgnored?.(e)}pause(){this.paused=!0}resume(){if(this.signal?.aborted)return;this.paused=!1;let e;for(;!this.paused&&(e=this.#e.shift());)e()}onResume(e){this.signal?.aborted||(this.paused?this.#e.push(e):e())}async matchCheck(e,t){if(t&&this.opts.nodir)return;let r;if(this.opts.realpath){if(r=e.realpathCached()||await e.realpath(),!r)return;e=r}let s=e.isUnknown()||this.opts.stat?await e.lstat():e;if(this.opts.follow&&this.opts.nodir&&s?.isSymbolicLink()){let a=await s.realpath();a&&(a.isUnknown()||this.opts.stat)&&await a.lstat()}return this.matchCheckTest(s,t)}matchCheckTest(e,t){return e&&(this.maxDepth===1/0||e.depth()<=this.maxDepth)&&(!t||e.canReaddir())&&(!this.opts.nodir||!e.isDirectory())&&(!this.opts.nodir||!this.opts.follow||!e.isSymbolicLink()||!e.realpathCached()?.isDirectory())&&!this.#n(e)?e:void 0}matchCheckSync(e,t){if(t&&this.opts.nodir)return;let r;if(this.opts.realpath){if(r=e.realpathCached()||e.realpathSync(),!r)return;e=r}let s=e.isUnknown()||this.opts.stat?e.lstatSync():e;if(this.opts.follow&&this.opts.nodir&&s?.isSymbolicLink()){let a=s.realpathSync();a&&(a?.isUnknown()||this.opts.stat)&&a.lstatSync()}return this.matchCheckTest(s,t)}matchFinish(e,t){if(this.#n(e))return;if(!this.includeChildMatches&&this.#t?.add){let s=`${e.relativePosix()}/**`;this.#t.add(s)}let r=this.opts.absolute===void 0?t:this.opts.absolute;this.seen.add(e);let i=this.opts.mark&&e.isDirectory()?this.#s:"";if(this.opts.withFileTypes)this.matchEmit(e);else if(r){let s=this.opts.posix?e.fullpathPosix():e.fullpath();this.matchEmit(s+i)}else{let s=this.opts.posix?e.relativePosix():e.relative(),a=this.opts.dotRelative&&!s.startsWith(".."+this.#s)?"."+this.#s:"";this.matchEmit(s?a+s+i:"."+i)}}async match(e,t,r){let i=await this.matchCheck(e,r);i&&this.matchFinish(i,t)}matchSync(e,t,r){let i=this.matchCheckSync(e,r);i&&this.matchFinish(i,t)}walkCB(e,t,r){this.signal?.aborted&&r(),this.walkCB2(e,t,new wc(this.opts),r)}walkCB2(e,t,r,i){if(this.#a(e))return i();if(this.signal?.aborted&&i(),this.paused){this.onResume(()=>this.walkCB2(e,t,r,i));return}r.processPatterns(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||(s++,this.match(c,u,l).then(()=>a()));for(let c of r.subwalkTargets()){if(this.maxDepth!==1/0&&c.depth()>=this.maxDepth)continue;s++;let u=c.readdirCached();c.calledReaddir()?this.walkCB3(c,u,r,a):c.readdirCB((l,f)=>this.walkCB3(c,f,r,a),!0)}a()}walkCB3(e,t,r,i){r=r.filterEntries(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||(s++,this.match(c,u,l).then(()=>a()));for(let[c,u]of r.subwalks.entries())s++,this.walkCB2(c,u,r.child(),a);a()}walkCBSync(e,t,r){this.signal?.aborted&&r(),this.walkCB2Sync(e,t,new wc(this.opts),r)}walkCB2Sync(e,t,r,i){if(this.#a(e))return i();if(this.signal?.aborted&&i(),this.paused){this.onResume(()=>this.walkCB2Sync(e,t,r,i));return}r.processPatterns(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||this.matchSync(c,u,l);for(let c of r.subwalkTargets()){if(this.maxDepth!==1/0&&c.depth()>=this.maxDepth)continue;s++;let u=c.readdirSync();this.walkCB3Sync(c,u,r,a)}a()}walkCB3Sync(e,t,r,i){r=r.filterEntries(e,t);let s=1,a=o(()=>{--s===0&&i()},"next");for(let[c,u,l]of r.matches.entries())this.#n(c)||this.matchSync(c,u,l);for(let[c,u]of r.subwalks.entries())s++,this.walkCB2Sync(c,u,r.child(),a);a()}},_c=class extends Lf{static{o(this,"GlobWalker")}matches=new Set;constructor(e,t,r){super(e,t,r)}matchEmit(e){this.matches.add(e)}async walk(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&await this.path.lstat(),await new Promise((e,t)=>{this.walkCB(this.path,this.patterns,()=>{this.signal?.aborted?t(this.signal.reason):e(this.matches)})}),this.matches}walkSync(){if(this.signal?.aborted)throw this.signal.reason;return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>{if(this.signal?.aborted)throw this.signal.reason}),this.matches}},bc=class extends Lf{static{o(this,"GlobStream")}results;constructor(e,t,r){super(e,t,r),this.results=new Ui({signal:this.signal,objectMode:!0}),this.results.on("drain",()=>this.resume()),this.results.on("resume",()=>this.resume())}matchEmit(e){this.results.write(e),this.results.flowing||this.pause()}stream(){let e=this.path;return e.isUnknown()?e.lstat().then(()=>{this.walkCB(e,this.patterns,()=>this.results.end())}):this.walkCB(e,this.patterns,()=>this.results.end()),this.results}streamSync(){return this.path.isUnknown()&&this.path.lstatSync(),this.walkCBSync(this.path,this.patterns,()=>this.results.end()),this.results}};var $7=typeof process=="object"&&process&&typeof process.platform=="string"?process.platform:"linux",wn=class{static{o(this,"Glob")}absolute;cwd;root;dot;dotRelative;follow;ignore;magicalBraces;mark;matchBase;maxDepth;nobrace;nocase;nodir;noext;noglobstar;pattern;platform;realpath;scurry;stat;signal;windowsPathsNoEscape;withFileTypes;includeChildMatches;opts;patterns;constructor(e,t){if(!t)throw new TypeError("glob options required");if(this.withFileTypes=!!t.withFileTypes,this.signal=t.signal,this.follow=!!t.follow,this.dot=!!t.dot,this.dotRelative=!!t.dotRelative,this.nodir=!!t.nodir,this.mark=!!t.mark,t.cwd?(t.cwd instanceof URL||t.cwd.startsWith("file://"))&&(t.cwd=(0,pS.fileURLToPath)(t.cwd)):this.cwd="",this.cwd=t.cwd||"",this.root=t.root,this.magicalBraces=!!t.magicalBraces,this.nobrace=!!t.nobrace,this.noext=!!t.noext,this.realpath=!!t.realpath,this.absolute=t.absolute,this.includeChildMatches=t.includeChildMatches!==!1,this.noglobstar=!!t.noglobstar,this.matchBase=!!t.matchBase,this.maxDepth=typeof t.maxDepth=="number"?t.maxDepth:1/0,this.stat=!!t.stat,this.ignore=t.ignore,this.withFileTypes&&this.absolute!==void 0)throw new Error("cannot set absolute and withFileTypes:true");if(typeof e=="string"&&(e=[e]),this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(e=e.map(u=>u.replace(/\\/g,"/"))),this.matchBase){if(t.noglobstar)throw new TypeError("base matching requires globstar");e=e.map(u=>u.includes("/")?u:`./**/${u}`)}if(this.pattern=e,this.platform=t.platform||$7,this.opts={...t,platform:this.platform},t.scurry){if(this.scurry=t.scurry,t.nocase!==void 0&&t.nocase!==t.scurry.nocase)throw new Error("nocase option contradicts provided scurry option")}else{let u=t.platform==="win32"?Xa:t.platform==="darwin"?vc:t.platform?Ja:dS;this.scurry=new u(this.cwd,{nocase:t.nocase,fs:t.fs})}this.nocase=this.scurry.nocase;let r=this.platform==="darwin"||this.platform==="win32",i={...t,dot:this.dot,matchBase:this.matchBase,nobrace:this.nobrace,nocase:this.nocase,nocaseMagicOnly:r,nocomment:!0,noext:this.noext,nonegate:!0,optimizationLevel:2,platform:this.platform,windowsPathsNoEscape:this.windowsPathsNoEscape,debug:!!this.opts.debug},s=this.pattern.map(u=>new Rr(u,i)),[a,c]=s.reduce((u,l)=>(u[0].push(...l.set),u[1].push(...l.globParts),u),[[],[]]);this.patterns=a.map((u,l)=>{let f=c[l];if(!f)throw new Error("invalid pattern object");return new Za(u,f,0,this.platform)})}async walk(){return[...await new _c(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walk()]}walkSync(){return[...new _c(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).walkSync()]}stream(){return new bc(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).stream()}streamSync(){return new bc(this.patterns,this.scurry.cwd,{...this.opts,maxDepth:this.maxDepth!==1/0?this.maxDepth+this.scurry.cwd.depth():1/0,platform:this.platform,nocase:this.nocase,includeChildMatches:this.includeChildMatches}).streamSync()}iterateSync(){return this.streamSync()[Symbol.iterator]()}[Symbol.iterator](){return this.iterateSync()}iterate(){return this.stream()[Symbol.asyncIterator]()}[Symbol.asyncIterator](){return this.iterate()}};var C0=o((n,e={})=>{Array.isArray(n)||(n=[n]);for(let t of n)if(new Rr(t,e).hasMagic())return!0;return!1},"hasMagic");function Mf(n,e={}){return new wn(n,e).streamSync()}o(Mf,"globStreamSync");function gS(n,e={}){return new wn(n,e).stream()}o(gS,"globStream");function yS(n,e={}){return new wn(n,e).walkSync()}o(yS,"globSync");async function mS(n,e={}){return new wn(n,e).walk()}o(mS,"glob_");function Vf(n,e={}){return new wn(n,e).iterateSync()}o(Vf,"globIterateSync");function vS(n,e={}){return new wn(n,e).iterate()}o(vS,"globIterate");var B7=Mf,U7=Object.assign(gS,{sync:Mf}),q7=Vf,G7=Object.assign(vS,{sync:Vf}),W7=Object.assign(yS,{stream:Mf,iterate:Vf}),jf=Object.assign(mS,{glob:mS,globSync:yS,sync:W7,globStream:gS,stream:U7,globStreamSync:Mf,streamSync:B7,globIterate:vS,iterate:G7,globIterateSync:Vf,iterateSync:q7,Glob:wn,hasMagic:C0,escape:Wa,unescape:gn});jf.glob=jf;var Ls=Ye(Ri());var Wi=class{constructor(e){this.rootPath=e}static{o(this,"NodeFsAdapter")}async readFile(e){let t=this.resolvePath(e);if(!await At.default.pathExists(t))throw new Ls.FileNotFoundError(e);return At.default.readFile(t,"utf-8")}async fileExists(e){let t=this.resolvePath(e);return At.default.pathExists(t)}async getFileMetadata(e){let t=await this.readFile(e);return this.extractFrontmatter(t)}async createFile(e,t){let r=this.resolvePath(e);if(await At.default.pathExists(r))throw new Ls.FileAlreadyExistsError(e);return await At.default.ensureDir(Gi.default.dirname(r)),await At.default.writeFile(r,t,"utf-8"),e}async updateFile(e,t){let r=this.resolvePath(e);if(!await At.default.pathExists(r))throw new Ls.FileNotFoundError(e);await At.default.writeFile(r,t,"utf-8")}async writeFile(e,t){let r=this.resolvePath(e);await At.default.ensureDir(Gi.default.dirname(r)),await At.default.writeFile(r,t,"utf-8")}async deleteFile(e){let t=this.resolvePath(e);if(!await At.default.pathExists(t))throw new Ls.FileNotFoundError(e);await At.default.remove(t)}async renameFile(e,t){let r=this.resolvePath(e),i=this.resolvePath(t);if(!await At.default.pathExists(r))throw new Ls.FileNotFoundError(e);await At.default.ensureDir(Gi.default.dirname(i)),await At.default.move(r,i)}async createDirectory(e){let t=this.resolvePath(e);await At.default.ensureDir(t)}async directoryExists(e){let t=this.resolvePath(e);return await At.default.pathExists(t)?(await At.default.stat(t)).isDirectory():!1}async getMarkdownFiles(e){let t=e?this.resolvePath(e):this.rootPath,r=Gi.default.join(t,"**/*.md");return(await jf(r,{nodir:!0})).map(a=>Gi.default.relative(this.rootPath,a))}async findFilesByMetadata(e){let t=await this.getMarkdownFiles(),r=[];for(let i of t)try{let s=await this.getFileMetadata(i);this.matchesQuery(s,e)&&r.push(i)}catch{continue}return r}async findFileByUID(e){let t=await this.findFilesByMetadata({exo__Asset_uid:e});return t.length>0?t[0]:null}resolvePath(e){return Gi.default.isAbsolute(e)?e:Gi.default.join(this.rootPath,e)}extractFrontmatter(e){let t=/^---\n([\s\S]*?)\n---/,r=e.match(t);if(!r)return{};try{let i=rc.load(r[1]);return typeof i=="object"&&i!==null?i:{}}catch{return{}}}matchesQuery(e,t){for(let[r,i]of Object.entries(t)){let s=e[r];if(Array.isArray(s)){if(!s.some(a=>this.normalizeValue(a)===this.normalizeValue(i)))return!1}else if(this.normalizeValue(s)!==this.normalizeValue(i))return!1}return!0}normalizeValue(e){return e==null?"":String(e).replace(/["'[\]]/g,"").trim()}};var Sc=Ye(require("path")),O0=Ye(Va());var to=class{constructor(e){this.vaultRoot=e}static{o(this,"PathResolver")}resolve(e){if(!Sc.default.isAbsolute(e))return Sc.default.resolve(this.vaultRoot,e);let t=Sc.default.resolve(e),r=Sc.default.resolve(this.vaultRoot);if(!t.startsWith(r))throw new rt(`File path ${e} is outside vault root ${this.vaultRoot}`,"Provide a file path within the vault directory.",{filepath:e,vaultRoot:this.vaultRoot});return t}validate(e){if(!O0.default.existsSync(e))throw new ic(e);if(!O0.default.statSync(e).isFile())throw new rt(`Not a file: ${e}`,"Provide a path to a file, not a directory.",{filepath:e});if(!e.endsWith(".md"))throw new rt(`Not a Markdown file: ${e}`,"Provide a path to a .md file.",{filepath:e})}getVaultRoot(){return this.vaultRoot}};var TS=Ye(Ri());var wS=Ye(Ri());var _n=class{static{o(this,"BaseCommandExecutor")}constructor(e){this.pathResolver=e.pathResolver,this.fsAdapter=e.fsAdapter,this.frontmatterService=e.frontmatterService,this.dryRun=e.dryRun}resolveAndValidate(e){let t=this.pathResolver.resolve(e);this.pathResolver.validate(t);let r=t.replace(this.pathResolver.getVaultRoot()+"/","");return{resolvedPath:t,relativePath:r}}getCurrentTimestamp(){return wS.DateFormatter.toLocalTimestamp(new Date)}isAssetArchived(e){if(e?.exo__Asset_isArchived===!0)return!0;let t=e?.archived;if(t==null)return!1;if(typeof t=="boolean")return t;if(typeof t=="number")return t!==0;if(typeof t=="string"){let r=t.toLowerCase().trim();return r==="true"||r==="yes"||r==="1"}return!1}extractAliasesFromFrontmatter(e){let t=e.match(/aliases:\s*\n((?:  - .*\n?)*)/);return t?t[1].split(`
`).filter(i=>i.trim()).map(i=>i.replace(/^\s*-\s*/,"").trim()):[]}};var Ec=class extends _n{static{o(this,"StatusCommandExecutor")}constructor(e){super(e)}async executeStart(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDoing]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_startTimestamp",i),await this.fsAdapter.updateFile(t,s),console.log(`\u2705 Started: ${e}`),console.log("   Status: Doing"),console.log(`   Start time: ${i}`),process.exit(0)}catch(t){ye.handle(t)}}async executeComplete(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDone]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_endTimestamp",i),s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(t,s),console.log(`\u2705 Completed: ${e}`),console.log("   Status: Done"),console.log(`   Completion time: ${i}`),process.exit(0)}catch(t){ye.handle(t)}}async executeTrash(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusTrashed]]"');s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(t,s),console.log(`\u2705 Trashed: ${e}`),console.log("   Status: Trashed"),console.log(`   Resolution time: ${i}`),process.exit(0)}catch(t){ye.handle(t)}}async executeArchive(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.readFile(t),i=this.frontmatterService.updateProperty(r,"archived","true");i=this.frontmatterService.removeProperty(i,"aliases"),await this.fsAdapter.updateFile(t,i),console.log(`\u2705 Archived: ${e}`),console.log("   Archived: true"),console.log("   Aliases removed"),process.exit(0)}catch(t){ye.handle(t)}}async executeMoveToBacklog(e){try{await this.updateStatus(e,"ems__EffortStatusBacklog","Backlog"),process.exit(0)}catch(t){ye.handle(t)}}async executeMoveToAnalysis(e){try{await this.updateStatus(e,"ems__EffortStatusAnalysis","Analysis"),process.exit(0)}catch(t){ye.handle(t)}}async executeMoveToToDo(e){try{await this.updateStatus(e,"ems__EffortStatusToDo","ToDo"),process.exit(0)}catch(t){ye.handle(t)}}async updateStatus(e,t,r){let{relativePath:i}=this.resolveAndValidate(e),s=await this.fsAdapter.readFile(i),a=this.frontmatterService.updateProperty(s,"ems__Effort_status",`"[[${t}]]"`);await this.fsAdapter.updateFile(i,a),console.log(`\u2705 Moved to ${r}: ${e}`),console.log(`   Status: ${r}`)}};var qt=[];for(let n=0;n<256;++n)qt.push((n+256).toString(16).slice(1));function _S(n,e=0){return(qt[n[e+0]]+qt[n[e+1]]+qt[n[e+2]]+qt[n[e+3]]+"-"+qt[n[e+4]]+qt[n[e+5]]+"-"+qt[n[e+6]]+qt[n[e+7]]+"-"+qt[n[e+8]]+qt[n[e+9]]+"-"+qt[n[e+10]]+qt[n[e+11]]+qt[n[e+12]]+qt[n[e+13]]+qt[n[e+14]]+qt[n[e+15]]).toLowerCase()}o(_S,"unsafeStringify");var bS=require("node:crypto");var Bf=new Uint8Array(256),$f=Bf.length;function D0(){return $f>Bf.length-16&&((0,bS.randomFillSync)(Bf),$f=0),Bf.slice($f,$f+=16)}o(D0,"rng");var SS=require("node:crypto"),I0={randomUUID:SS.randomUUID};function H7(n,e,t){n=n||{};let r=n.random??n.rng?.()??D0();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(t=t||0,t<0||t+16>e.length)throw new RangeError(`UUID byte range ${t}:${t+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[t+i]=r[i];return e}return _S(r)}o(H7,"_v4");function K7(n,e,t){return I0.randomUUID&&!e&&!n?I0.randomUUID():H7(n,e,t)}o(K7,"v4");var P0=K7;var ro=Ye(Ri());var Tc=class extends _n{static{o(this,"AssetCreationExecutor")}constructor(e){super(e)}async executeCreateTask(e,t,r={}){try{await this.createAsset(e,t,"ems__Task",r),process.exit(0)}catch(i){ye.handle(i)}}async executeCreateMeeting(e,t,r={}){try{await this.createAsset(e,t,"ems__Meeting",r),process.exit(0)}catch(i){ye.handle(i)}}async executeCreateProject(e,t,r={}){try{await this.createAsset(e,t,"ems__Project",r),process.exit(0)}catch(i){ye.handle(i)}}async executeCreateArea(e,t,r={}){try{await this.createAsset(e,t,"ems__Area",r),process.exit(0)}catch(i){ye.handle(i)}}async createAsset(e,t,r,i={}){if(!t||t.trim().length===0)throw new Error("Label cannot be empty");let s=t.trim(),{relativePath:a}=this.resolveAndValidate(e);if(await this.fsAdapter.fileExists(a))throw new ro.FileAlreadyExistsError(e);let u=P0(),l=this.buildAssetFrontmatter(r,u,s,i),f=ro.MetadataHelpers.buildFileContent(l);await this.fsAdapter.createFile(a,f),console.log(`\u2705 Created ${this.getAssetTypeName(r)}: ${e}`),console.log(`   UID: ${u}`),console.log(`   Label: ${s}`),console.log(`   Class: ${r}`)}buildAssetFrontmatter(e,t,r,i={}){let s=ro.DateFormatter.toLocalTimestamp(new Date),a={exo__Asset_isDefinedBy:'"[[Ontology/EMS]]"',exo__Asset_uid:t,exo__Asset_label:r,exo__Asset_createdAt:s,exo__Instance_class:[`"[[${e}]]"`],aliases:[r]};return(e==="ems__Task"||e==="ems__Project"||e==="ems__Meeting")&&(a.ems__Effort_status='"[[ems__EffortStatusDraft]]"'),i.prototype&&(a.ems__Effort_prototype=`"[[${i.prototype}]]"`),i.area&&(a.ems__Effort_area=`"[[${i.area}]]"`),i.parent&&(a.ems__Effort_parent=`"[[${i.parent}]]"`),a}getAssetTypeName(e){return{ems__Task:"task",ems__Meeting:"meeting",ems__Project:"project",ems__Area:"area"}[e]||"asset"}};var F0=Ye(require("path"));var ES=Ye(Ri());var Ac=class extends _n{static{o(this,"PropertyCommandExecutor")}constructor(e){super(e)}async executeRenameToUid(e){try{let{relativePath:t}=this.resolveAndValidate(e),r=await this.fsAdapter.getFileMetadata(t);if(!r.exo__Asset_uid)throw new Error("Asset missing exo__Asset_uid property");let i=F0.default.basename(t,".md"),s=r.exo__Asset_uid;if(i===s&&(console.log(`\u2705 Already renamed: ${e}`),console.log(`   Current filename matches UID: ${s}.md`),process.exit(0)),!r.exo__Asset_label||r.exo__Asset_label.trim()===""){let u=await this.fsAdapter.readFile(t),l=this.frontmatterService.updateProperty(u,"exo__Asset_label",i),f=this.isAssetArchived(r),h=l;f||(h=this.frontmatterService.updateProperty(l,"aliases",`
  - ${i}`)),await this.fsAdapter.updateFile(t,h),console.log(`   Updated label: "${i}"`)}let a=F0.default.dirname(t),c=a!=="."?`${a}/${s}.md`:`${s}.md`;await this.fsAdapter.renameFile(t,c),console.log("\u2705 Renamed to UID format"),console.log(`   Old: ${t}`),console.log(`   New: ${c}`),process.exit(0)}catch(t){ye.handle(t)}}async executeUpdateLabel(e,t){try{if(!t||t.trim().length===0)throw new Error("Label cannot be empty");let r=t.trim(),{relativePath:i}=this.resolveAndValidate(e),s=await this.fsAdapter.readFile(i),a=this.frontmatterService.updateProperty(s,"exo__Asset_label",r),c=this.frontmatterService.parse(a),u=this.extractAliasesFromFrontmatter(c.content);if(u.includes(r)||(u.length===0?a=this.frontmatterService.updateProperty(a,"aliases",`
  - ${r}`):a=this.frontmatterService.updateProperty(a,"aliases",`${u.map(l=>`
  - ${l}`).join("")}
  - ${r}`)),this.dryRun){if(console.log("\u{1F50D} DRY RUN: Preview of changes (not applied)"),console.log(`   File: ${e}`),console.log("   Changes:"),console.log(`     \u2022 exo__Asset_label: "${r}"`),u.includes(r))console.log("     \u2022 aliases: unchanged (label already present)");else{let l=u.length===0?[r]:[...u,r];console.log(`     \u2022 aliases: [${l.map(f=>`"${f}"`).join(", ")}]`)}console.log(`
\u{1F4A1} Run without --dry-run to apply changes`),process.exit(0)}await this.fsAdapter.updateFile(i,a),console.log("\u2705 Updated label"),console.log(`   File: ${e}`),console.log(`   New label: "${r}"`),console.log("   Aliases synchronized"),process.exit(0)}catch(r){ye.handle(r)}}async executeSchedule(e,t){try{await this.updatePlannedTimestamp(e,t,"ems__Effort_plannedStartTimestamp"),process.exit(0)}catch(r){ye.handle(r)}}async executeSetDeadline(e,t){try{await this.updatePlannedTimestamp(e,t,"ems__Effort_plannedEndTimestamp"),process.exit(0)}catch(r){ye.handle(r)}}async updatePlannedTimestamp(e,t,r){let{relativePath:i}=this.resolveAndValidate(e);if(!await this.fsAdapter.fileExists(i))throw new Error(`File not found: ${e}`);if(!/^\d{4}-\d{2}-\d{2}$/.test(t))throw new Error(`Invalid date format: ${t}. Expected YYYY-MM-DD (e.g., 2025-11-25)`);let a=ES.DateFormatter.toTimestampAtStartOfDay(t),c=await this.fsAdapter.readFile(i),u=this.frontmatterService.updateProperty(c,r,a);await this.fsAdapter.writeFile(i,u),console.log(`\u2705 ${r==="ems__Effort_plannedStartTimestamp"?"Scheduled":"Set deadline for"}: ${e}`),console.log(`   Date: ${t}`),console.log(`   Timestamp: ${a}`)}};var zi=Ye(require("path"));var xc=class extends _n{static{o(this,"FolderRepairExecutor")}constructor(e){super(e)}async executeRepairFolder(e){try{let{relativePath:t}=this.resolveAndValidate(e),i=(await this.fsAdapter.getFileMetadata(t))?.exo__Asset_isDefinedBy;if(!i)throw new Error("Cannot determine expected folder: missing exo__Asset_isDefinedBy");let s=this.extractReference(i);if(!s)throw new Error("Cannot determine expected folder: invalid exo__Asset_isDefinedBy format");let a=await this.findReferencedFile(s,t);if(!a)throw new Error(`Cannot determine expected folder: referenced asset not found: ${s}`);let c=zi.default.dirname(a),u=c==="."?"":c,l=zi.default.dirname(t),f=l==="."?"":l;if(this.normalizePath(f)===this.normalizePath(u))return console.log("\u2705 Already in correct folder"),console.log(`   File: ${e}`),console.log(`   Folder: ${u||"(root)"}`),process.exit(0),{moved:!1,oldPath:t,newPath:t,expectedFolder:u};if(this.dryRun){let _=zi.default.basename(t),b=u?`${u}/${_}`:_;return console.log("\u{1F50D} DRY RUN: Preview of changes (not applied)"),console.log(`   File: ${e}`),console.log(`   Current folder: ${f||"(root)"}`),console.log(`   Expected folder: ${u||"(root)"}`),console.log(`   Would move to: ${b}`),console.log(`
\u{1F4A1} Run without --dry-run to apply changes`),process.exit(0),{moved:!1,oldPath:t,newPath:b,expectedFolder:u}}let h=zi.default.basename(t),d=u?`${u}/${h}`:h;if(await this.fsAdapter.fileExists(d))throw new Error(`Cannot move file: ${d} already exists`);return u&&(await this.fsAdapter.directoryExists(u)||await this.fsAdapter.createDirectory(u)),await this.fsAdapter.renameFile(t,d),console.log("\u2705 Moved to correct folder"),console.log(`   Old path: ${t}`),console.log(`   New path: ${d}`),console.log(`   Expected folder: ${u||"(root)"}`),process.exit(0),{moved:!0,oldPath:t,newPath:d,expectedFolder:u}}catch(t){ye.handle(t)}}extractReference(e){if(typeof e!="string")return null;let t=e.trim().replace(/^["']|["']$/g,"");return t=t.replace(/^\[\[|\]\]$/g,""),t||null}async findReferencedFile(e,t){let r=e.endsWith(".md")?e:`${e}.md`;if(e.includes("/")&&await this.fsAdapter.fileExists(r))return r;let i=zi.default.dirname(t),s=i?`${i}/${r}`:r;if(await this.fsAdapter.fileExists(s))return s;let c=await this.fsAdapter.findFileByUID(e);return c||(await this.fsAdapter.getMarkdownFiles()).find(f=>{let h=zi.default.basename(f,".md"),d=zi.default.basename(r,".md");return h===d})||null}normalizePath(e){return e.replace(/\\/g,"/").replace(/^\.\//,"").replace(/\/$/,"")}};var Uf=class{static{o(this,"CommandExecutor")}constructor(e,t=!1){this.context={pathResolver:new to(e),fsAdapter:new Wi(e),frontmatterService:new TS.FrontmatterService,dryRun:t},this.statusExecutor=new Ec(this.context),this.creationExecutor=new Tc(this.context),this.propertyExecutor=new Ac(this.context),this.folderRepairExecutor=new xc(this.context)}async execute(e,t,r){try{let i=this.context.pathResolver.resolve(t);this.context.pathResolver.validate(i),await this.context.fsAdapter.readFile(i.replace(this.context.pathResolver.getVaultRoot()+"/","")),console.log("\u2705 Command infrastructure verified"),console.log(`   Command: ${e}`),console.log(`   File: ${i}`),console.log(`   Vault: ${this.context.pathResolver.getVaultRoot()}`),Object.keys(r).length>0&&console.log(`   Options: ${JSON.stringify(r,null,2)}`),console.log(`
\u{1F4DD} Note: Actual command execution will be implemented in follow-up issues.`),console.log("    This PR establishes the infrastructure foundation."),process.exit(0)}catch(i){ye.handle(i)}}getVaultRoot(){return this.context.pathResolver.getVaultRoot()}async executeStart(e){return this.statusExecutor.executeStart(e)}async executeComplete(e){return this.statusExecutor.executeComplete(e)}async executeTrash(e){return this.statusExecutor.executeTrash(e)}async executeArchive(e){return this.statusExecutor.executeArchive(e)}async executeMoveToBacklog(e){return this.statusExecutor.executeMoveToBacklog(e)}async executeMoveToAnalysis(e){return this.statusExecutor.executeMoveToAnalysis(e)}async executeMoveToToDo(e){return this.statusExecutor.executeMoveToToDo(e)}async executeCreateTask(e,t,r={}){return this.creationExecutor.executeCreateTask(e,t,r)}async executeCreateMeeting(e,t,r={}){return this.creationExecutor.executeCreateMeeting(e,t,r)}async executeCreateProject(e,t,r={}){return this.creationExecutor.executeCreateProject(e,t,r)}async executeCreateArea(e,t,r={}){return this.creationExecutor.executeCreateArea(e,t,r)}async executeRenameToUid(e){return this.propertyExecutor.executeRenameToUid(e)}async executeUpdateLabel(e,t){return this.propertyExecutor.executeUpdateLabel(e,t)}async executeSchedule(e,t){return this.propertyExecutor.executeSchedule(e,t)}async executeSetDeadline(e,t){return this.propertyExecutor.executeSetDeadline(e,t)}async executeRepairFolder(e){return this.folderRepairExecutor.executeRepairFolder(e)}};function Gt(n,e,t,r,i){if(n==="json"){let s={command:e,filepath:t,action:r,...i&&{changes:i}},a=lt.success(s);console.log(JSON.stringify(a,null,2))}else console.log(`\u2705 ${r}`)}o(Gt,"outputResult");function js(n,e,t,r){let i=new rt(`--${e} option is required for ${t} command`,r,{command:t,missingOption:e});ye.handle(i)}o(js,"handleMissingOption");function xS(){return new _r("command").description("Execute plugin command on single asset").argument("<command-name>","Command to execute (rename-to-uid, start, complete, schedule, set-deadline, etc.)").argument("<filepath>","Path to asset file (relative to vault root or absolute)").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--label <value>","Asset label (required for update-label and creation commands)").option("--prototype <uid>","Prototype UID for inheritance (creation commands)").option("--area <uid>","Area UID for effort linkage (creation commands)").option("--parent <uid>","Parent UID for effort linkage (creation commands)").option("--date <value>","Date in YYYY-MM-DD format (required for schedule and set-deadline commands)").option("--dry-run","Preview changes without modifying files").option("--format <type>","Output format: text|json (default: text)","text").action(async(n,e,t)=>{let r=t.format||"text";ye.setFormat(r);try{let i=(0,AS.resolve)(t.vault),s=new Uf(i,t.dryRun);switch(n){case"rename-to-uid":await s.executeRenameToUid(e),Gt(r,n,e,"Renamed file to UID-based name");break;case"update-label":t.label||js(r,"label","update-label",'exocortex command update-label <filepath> --label "<value>"'),await s.executeUpdateLabel(e,t.label),Gt(r,n,e,`Updated label to "${t.label}"`,{label:t.label});break;case"start":await s.executeStart(e),Gt(r,n,e,"Started task");break;case"complete":await s.executeComplete(e),Gt(r,n,e,"Completed task");break;case"trash":await s.executeTrash(e),Gt(r,n,e,"Moved task to trash");break;case"archive":await s.executeArchive(e),Gt(r,n,e,"Archived task");break;case"move-to-backlog":await s.executeMoveToBacklog(e),Gt(r,n,e,"Moved task to backlog");break;case"move-to-analysis":await s.executeMoveToAnalysis(e),Gt(r,n,e,"Moved task to analysis");break;case"move-to-todo":await s.executeMoveToToDo(e),Gt(r,n,e,"Moved task to todo");break;case"create-task":t.label||js(r,"label","create-task",'exocortex command create-task <filepath> --label "<value>"'),await s.executeCreateTask(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Gt(r,n,e,`Created task "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"create-meeting":t.label||js(r,"label","create-meeting",'exocortex command create-meeting <filepath> --label "<value>"'),await s.executeCreateMeeting(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Gt(r,n,e,`Created meeting "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"create-project":t.label||js(r,"label","create-project",'exocortex command create-project <filepath> --label "<value>"'),await s.executeCreateProject(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Gt(r,n,e,`Created project "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"create-area":t.label||js(r,"label","create-area",'exocortex command create-area <filepath> --label "<value>"'),await s.executeCreateArea(e,t.label,{prototype:t.prototype,area:t.area,parent:t.parent}),Gt(r,n,e,`Created area "${t.label}"`,{label:t.label,prototype:t.prototype,area:t.area,parent:t.parent});break;case"schedule":t.date||js(r,"date","schedule",'exocortex command schedule <filepath> --date "YYYY-MM-DD"'),await s.executeSchedule(e,t.date),Gt(r,n,e,`Scheduled task for ${t.date}`,{date:t.date});break;case"set-deadline":t.date||js(r,"date","set-deadline",'exocortex command set-deadline <filepath> --date "YYYY-MM-DD"'),await s.executeSetDeadline(e,t.date),Gt(r,n,e,`Set deadline to ${t.date}`,{date:t.date});break;case"repair-folder":{let a=await s.executeRepairFolder(e);Gt(r,n,e,a.moved?`Moved to correct folder: ${a.newPath}`:"Already in correct folder",{moved:a.moved,oldPath:a.oldPath,newPath:a.newPath,expectedFolder:a.expectedFolder});break}default:await s.execute(n,e,t),Gt(r,n,e,`Executed ${n}`);break}}catch(i){ye.handle(i)}})}o(xS,"commandCommand");var OS=require("path");var mi=Ye(require("fs")),R0=Ye(require("path")),CS=require("events");var Q7={watch:mi.default.watch.bind(mi.default),existsSync:mi.default.existsSync.bind(mi.default),statSync:mi.default.statSync.bind(mi.default),readFileSync:mi.default.readFileSync.bind(mi.default)},qf=class extends CS.EventEmitter{constructor(t,r={}){super();this.watcher=null;this.debounceTimers=new Map;this.isRunning=!1;this.vaultPath=R0.default.resolve(t),this.fsAdapter=r.fsAdapter??Q7,this.options={pattern:r.pattern??"**/*.md",assetType:r.assetType??"",debounceMs:r.debounceMs??100,recursive:r.recursive??!0}}static{o(this,"FileSystemWatcher")}start(){this.isRunning||(this.watcher=this.fsAdapter.watch(this.vaultPath,{recursive:this.options.recursive},(t,r)=>{r&&this.handleFileEvent(t,r.toString())}),this.watcher.on("error",t=>{this.emit("error",t)}),this.isRunning=!0,this.emit("started"))}stop(){if(this.isRunning){for(let t of this.debounceTimers.values())clearTimeout(t);this.debounceTimers.clear(),this.watcher&&(this.watcher.close(),this.watcher=null),this.isRunning=!1,this.emit("stopped")}}isWatching(){return this.isRunning}handleFileEvent(t,r){let i=R0.default.join(this.vaultPath,r),s=r;if(!this.matchesPattern(s))return;let a=this.debounceTimers.get(i);a&&clearTimeout(a);let c=setTimeout(()=>{this.debounceTimers.delete(i),this.processFileEvent(i,s)},this.options.debounceMs);this.debounceTimers.set(i,c)}processFileEvent(t,r){let i=this.fsAdapter.existsSync(t),s;if(!i)s="delete";else{let u=this.fsAdapter.statSync(t);s=Date.now()-u.birthtimeMs<1e3?"create":"modify"}let a;if(i&&t.endsWith(".md")&&(a=this.extractAssetType(t)),this.options.assetType&&a!==this.options.assetType)return;let c={type:s,path:t,relativePath:r,timestamp:new Date().toISOString(),assetType:a};this.emit("change",c)}matchesPattern(t){return this.options.pattern?Ut(t,this.options.pattern):!0}extractAssetType(t){try{let i=this.fsAdapter.readFileSync(t,"utf-8").match(/^---\n([\s\S]*?)\n---/);if(!i)return;let a=i[1].match(/exo__Instance_class:\s*(?:\[?"?\[\[([^\]]+)\]\]"?\]?|"?\[\[([^\]]+)\]\]"?)/);return a?a[1]||a[2]:void 0}catch{return}}};var N0=Ye(require("fs"));function DS(){return new _r("watch").description("Watch vault for file changes and emit NDJSON events").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--pattern <glob>","Glob pattern to filter files (e.g., '*.md', 'tasks/**')").option("--asset-type <type>","Filter by asset type (e.g., 'ems__Task', 'ems__Project')").option("--debounce <ms>","Debounce interval in milliseconds","100").action(async n=>{ye.setFormat("json");try{let e=(0,OS.resolve)(n.vault);if(!N0.default.existsSync(e))throw new hi(e);if(!N0.default.statSync(e).isDirectory())throw new rt(`Vault path is not a directory: ${e}`,"Provide a path to a directory, not a file",{vaultPath:e});let t=parseInt(n.debounce?.toString()??"100",10);if(isNaN(t)||t<0)throw new rt("--debounce must be a non-negative integer","Use a positive integer value for debounce",{debounce:n.debounce});let r=new qf(e,{pattern:n.pattern,assetType:n.assetType,debounceMs:t});r.on("change",s=>{console.log(JSON.stringify(s))}),r.on("error",s=>{let a=lt.error("INTERNAL_OPERATION_FAILED",s.message,5,{recovery:{message:"Check file permissions and vault access",suggestion:"Ensure the vault directory is accessible"}});console.log(JSON.stringify(a))});let i=o(()=>{r.stop(),process.exit(0)},"shutdown");process.on("SIGINT",i),process.on("SIGTERM",i),console.error(`Watching vault: ${e}`),n.pattern&&console.error(`  Pattern filter: ${n.pattern}`),n.assetType&&console.error(`  Asset type filter: ${n.assetType}`),console.error(`  Debounce: ${t}ms`),console.error("Press Ctrl+C to stop"),r.start()}catch(e){ye.handle(e)}})}o(DS,"watchCommand");var L0=require("path"),j0=Ye(Va());var Ms=Ye(require("path"));var no=Ye(Ri());var bn=Ye(Va()),k0=Ye(require("crypto"));var Gf=class{constructor(){this.backups=new Map;this.fileHashes=new Map}static{o(this,"TransactionManager")}async begin(e){if(!bn.default.existsSync(e))throw new Error(`Cannot backup non-existent file: ${e}`);let t=await bn.default.readFile(e,"utf-8"),r=k0.default.createHash("sha256").update(t).digest("hex");this.fileHashes.set(e,r);let i=`${e}.backup.${Date.now()}`;await bn.default.writeFile(i,t,"utf-8"),this.backups.set(e,i)}async verify(e){let t=this.fileHashes.get(e);if(!t)return!0;if(!bn.default.existsSync(e))return!1;let r=await bn.default.readFile(e,"utf-8");return k0.default.createHash("sha256").update(r).digest("hex")===t}async commit(){for(let e of this.backups.values())bn.default.existsSync(e)&&await bn.default.remove(e);this.backups.clear(),this.fileHashes.clear()}async rollback(){for(let[e,t]of this.backups.entries())bn.default.existsSync(t)&&(await bn.default.copy(t,e,{overwrite:!0}),await bn.default.remove(t));this.backups.clear(),this.fileHashes.clear()}getTrackedFiles(){return Array.from(this.backups.keys())}};var Vs=class{static{o(this,"BatchExecutor")}constructor(e,t=!1){this.pathResolver=new to(e),this.fsAdapter=new Wi(e),this.frontmatterService=new no.FrontmatterService,this.transactionManager=new Gf,this.dryRun=t}async executeBatch(e,t=!1){let r=Date.now(),i=[],s=0,a=0;if(e.length===0)return{success:!0,total:0,succeeded:0,failed:0,results:[],durationMs:Date.now()-r,atomic:t};if(t&&!this.dryRun)try{await this.backupAllFiles(e)}catch(u){return{success:!1,total:e.length,succeeded:0,failed:e.length,results:e.map(l=>({success:!1,command:l.command,filepath:l.filepath,error:`Backup failed: ${u.message}`})),durationMs:Date.now()-r,atomic:t}}for(let u of e){let l=await this.executeSingleOperation(u);if(i.push(l),l.success)s++;else if(a++,t&&!this.dryRun){await this.transactionManager.rollback();let f=i.length;for(let h=f;h<e.length;h++)i.push({success:!1,command:e[h].command,filepath:e[h].filepath,error:"Not executed due to atomic rollback"}),a++;return{success:!1,total:e.length,succeeded:0,failed:e.length,results:i,durationMs:Date.now()-r,atomic:t,rolledBack:!0}}}return t&&!this.dryRun&&await this.transactionManager.commit(),{success:a===0,total:e.length,succeeded:s,failed:a,results:i,durationMs:Date.now()-r,atomic:t,...t&&{rolledBack:!1}}}static parseInput(e){try{let t=JSON.parse(e);if(!Array.isArray(t))throw new rt("Batch input must be a JSON array of operations",`exo batch --input '[{"command":"start","filepath":"task.md"}]'`);for(let r of t){if(!r.command||typeof r.command!="string")throw new rt('Each operation must have a "command" string property','{"command":"start","filepath":"task.md"}');if(!r.filepath||typeof r.filepath!="string")throw new rt('Each operation must have a "filepath" string property','{"command":"start","filepath":"task.md"}')}return t}catch(t){throw t instanceof rt?t:new rt(`Failed to parse batch input: ${t.message}`,`exo batch --input '[{"command":"start","filepath":"task.md"}]'`)}}async backupAllFiles(e){let t=new Set;for(let r of e){let i=this.pathResolver.resolve(r.filepath);t.add(i)}for(let r of t)await this.transactionManager.begin(r)}async executeSingleOperation(e){try{let t=this.pathResolver.resolve(e.filepath);this.pathResolver.validate(t);let r=t.replace(this.pathResolver.getVaultRoot()+"/","");if(await this.fsAdapter.readFile(r),this.dryRun)return{success:!0,command:e.command,filepath:e.filepath,action:`Would execute ${e.command} (dry-run)`};switch(e.command){case"start":return await this.executeStart(r,e);case"complete":return await this.executeComplete(r,e);case"trash":return await this.executeTrash(r,e);case"archive":return await this.executeArchive(r,e);case"move-to-backlog":return await this.executeStatusUpdate(r,e,"ems__EffortStatusBacklog","Moved to backlog");case"move-to-analysis":return await this.executeStatusUpdate(r,e,"ems__EffortStatusAnalysis","Moved to analysis");case"move-to-todo":return await this.executeStatusUpdate(r,e,"ems__EffortStatusToDo","Moved to todo");case"update-label":return await this.executeUpdateLabel(r,e);case"schedule":return await this.executeSchedule(r,e);case"set-deadline":return await this.executeSetDeadline(r,e);case"repair-folder":return await this.executeRepairFolder(r,e);default:return{success:!1,command:e.command,filepath:e.filepath,error:`Unknown command: ${e.command}`}}}catch(t){return{success:!1,command:e.command,filepath:e.filepath,error:t.message}}}getCurrentTimestamp(){return no.DateFormatter.toLocalTimestamp(new Date)}async executeStart(e,t){let r=await this.fsAdapter.readFile(e),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDoing]]"');return s=this.frontmatterService.updateProperty(s,"ems__Effort_startTimestamp",i),await this.fsAdapter.updateFile(e,s),{success:!0,command:t.command,filepath:t.filepath,action:"Started task",changes:{status:"Doing",startTimestamp:i}}}async executeComplete(e,t){let r=await this.fsAdapter.readFile(e),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusDone]]"');return s=this.frontmatterService.updateProperty(s,"ems__Effort_endTimestamp",i),s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(e,s),{success:!0,command:t.command,filepath:t.filepath,action:"Completed task",changes:{status:"Done",endTimestamp:i,resolutionTimestamp:i}}}async executeTrash(e,t){let r=await this.fsAdapter.readFile(e),i=this.getCurrentTimestamp(),s=this.frontmatterService.updateProperty(r,"ems__Effort_status",'"[[ems__EffortStatusTrashed]]"');return s=this.frontmatterService.updateProperty(s,"ems__Effort_resolutionTimestamp",i),await this.fsAdapter.updateFile(e,s),{success:!0,command:t.command,filepath:t.filepath,action:"Trashed task",changes:{status:"Trashed",resolutionTimestamp:i}}}async executeArchive(e,t){let r=await this.fsAdapter.readFile(e),i=this.frontmatterService.updateProperty(r,"archived","true");return i=this.frontmatterService.removeProperty(i,"aliases"),await this.fsAdapter.updateFile(e,i),{success:!0,command:t.command,filepath:t.filepath,action:"Archived task",changes:{archived:!0,aliasesRemoved:!0}}}async executeStatusUpdate(e,t,r,i){let s=await this.fsAdapter.readFile(e),a=this.frontmatterService.updateProperty(s,"ems__Effort_status",`"[[${r}]]"`);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:i,changes:{status:r.replace("ems__EffortStatus","")}}}async executeUpdateLabel(e,t){let r=t.options?.label;if(!r||r.trim()==="")return{success:!1,command:t.command,filepath:t.filepath,error:'Missing required option: "label"'};let i=r.trim(),s=await this.fsAdapter.readFile(e),a=this.frontmatterService.updateProperty(s,"exo__Asset_label",`"${i}"`);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:`Updated label to "${i}"`,changes:{label:i}}}async executeSchedule(e,t){let r=t.options?.date;if(!r)return{success:!1,command:t.command,filepath:t.filepath,error:'Missing required option: "date"'};if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return{success:!1,command:t.command,filepath:t.filepath,error:`Invalid date format: ${r}. Expected YYYY-MM-DD`};let i=await this.fsAdapter.readFile(e),s=no.DateFormatter.toTimestampAtStartOfDay(r),a=this.frontmatterService.updateProperty(i,"ems__Effort_scheduledTimestamp",s);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:`Scheduled for ${r}`,changes:{scheduledTimestamp:s}}}async executeSetDeadline(e,t){let r=t.options?.date;if(!r)return{success:!1,command:t.command,filepath:t.filepath,error:'Missing required option: "date"'};if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return{success:!1,command:t.command,filepath:t.filepath,error:`Invalid date format: ${r}. Expected YYYY-MM-DD`};let i=await this.fsAdapter.readFile(e),s=no.DateFormatter.toTimestampAtStartOfDay(r),a=this.frontmatterService.updateProperty(i,"ems__Effort_deadlineTimestamp",s);return await this.fsAdapter.updateFile(e,a),{success:!0,command:t.command,filepath:t.filepath,action:`Set deadline to ${r}`,changes:{deadlineTimestamp:s}}}async executeRepairFolder(e,t){let i=(await this.fsAdapter.getFileMetadata(e))?.exo__Asset_isDefinedBy;if(!i)return{success:!1,command:t.command,filepath:t.filepath,error:"Cannot determine expected folder: missing exo__Asset_isDefinedBy"};let s=this.extractReference(i);if(!s)return{success:!1,command:t.command,filepath:t.filepath,error:"Cannot determine expected folder: invalid exo__Asset_isDefinedBy format"};let a=await this.findReferencedFile(s,e);if(!a)return{success:!1,command:t.command,filepath:t.filepath,error:`Cannot determine expected folder: referenced asset not found: ${s}`};let c=Ms.default.dirname(a),u=c==="."?"":c,l=Ms.default.dirname(e),f=l==="."?"":l;if(this.normalizePath(f)===this.normalizePath(u))return{success:!0,command:t.command,filepath:t.filepath,action:"Already in correct folder",changes:{moved:!1,folder:u||"(root)"}};let h=Ms.default.basename(e),d=u?`${u}/${h}`:h;return await this.fsAdapter.fileExists(d)?{success:!1,command:t.command,filepath:t.filepath,error:`Cannot move file: ${d} already exists`}:(await this.fsAdapter.renameFile(e,d),{success:!0,command:t.command,filepath:t.filepath,action:`Moved to ${u||"(root)"}`,changes:{moved:!0,oldPath:e,newPath:d,expectedFolder:u||"(root)"}})}extractReference(e){if(typeof e!="string")return null;let t=e.trim().replace(/^["']|["']$/g,"");return t=t.replace(/^\[\[|\]\]$/g,""),t||null}async findReferencedFile(e,t){let r=e.endsWith(".md")?e:`${e}.md`;if(e.includes("/")&&await this.fsAdapter.fileExists(r))return r;let i=Ms.default.dirname(t),s=i!=="."?`${i}/${r}`:r;if(await this.fsAdapter.fileExists(s))return s;let c=await this.fsAdapter.findFileByUID(e);return c||(await this.fsAdapter.getMarkdownFiles()).find(f=>{let h=Ms.default.basename(f,".md"),d=Ms.default.basename(r,".md");return h===d})||null}normalizePath(e){return e.replace(/\\/g,"/").replace(/^\.\//,"").replace(/\/$/,"")}};function Y7(n,e){if(n==="json"){let t=lt.success(e,{durationMs:e.durationMs,itemCount:e.total});console.log(JSON.stringify(t,null,2))}else{if(console.log(`
\u{1F4E6} Batch Execution ${e.success?"Complete":"Failed"}`),console.log(`   Total: ${e.total} operations`),console.log(`   \u2705 Succeeded: ${e.succeeded}`),console.log(`   \u274C Failed: ${e.failed}`),console.log(`   \u23F1\uFE0F  Duration: ${e.durationMs}ms`),e.atomic&&console.log(`   \u{1F512} Atomic mode: ${e.rolledBack?"Rolled back":"Committed"}`),e.failed>0){console.log(`
\u{1F4CB} Failed Operations:`);for(let t of e.results.filter(r=>!r.success))console.log(`   \u274C ${t.command} ${t.filepath}: ${t.error}`)}if(e.succeeded>0&&n==="text"){console.log(`
\u{1F4CB} Successful Operations:`);for(let t of e.results.filter(r=>r.success))console.log(`   \u2705 ${t.command} ${t.filepath}: ${t.action}`)}}}o(Y7,"outputResult");function IS(){return new _r("batch").description("Execute multiple operations in a single CLI invocation").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--input <json>","JSON array of operations to execute").option("--file <path>","Path to JSON file containing operations").option("--atomic","All-or-nothing execution (rollback on any failure)").option("--dry-run","Preview changes without modifying files").option("--format <type>","Output format: text|json (default: text)","text").action(async n=>{let e=n.format||"text";ye.setFormat(e);try{let t=(0,L0.resolve)(n.vault),r;if(n.input)r=n.input;else if(n.file){let c=(0,L0.resolve)(n.file);if(!j0.default.existsSync(c))throw new rt(`Batch file not found: ${c}`,"exocortex batch --file operations.json");r=await j0.default.readFile(c,"utf-8")}else throw new rt("Either --input or --file option is required",`exocortex batch --input '[{"command":"start","filepath":"task.md"}]' or exocortex batch --file operations.json`);let i=Vs.parseInput(r);if(i.length===0)throw new rt("Batch input contains no operations",`exocortex batch --input '[{"command":"start","filepath":"task.md"}]'`);let a=await new Vs(t,n.dryRun).executeBatch(i,n.atomic);Y7(e,a),process.exit(a.success?0:5)}catch(t){ye.handle(t)}})}o(IS,"batchCommand");var PS=require("path");function X7(n,e){if(n==="json"){let t=lt.success(e,{durationMs:e.durationMs,itemCount:e.total});console.log(JSON.stringify(t,null,2))}else{if(console.log(`
\u{1F4E6} Batch Repair ${e.success?"Complete":"Completed with Errors"}`),console.log(`   Total files: ${e.total}`),console.log(`   \u{1F4C1} Moved: ${e.movedCount}`),console.log(`   \u2705 Already correct: ${e.alreadyCorrectCount}`),console.log(`   \u274C Errors: ${e.errorCount}`),console.log(`   \u23F1\uFE0F  Duration: ${e.durationMs}ms`),e.errorCount>0){console.log(`
\u{1F4CB} Failed Files:`);for(let t of e.results.filter(r=>!r.success))console.log(`   \u274C ${t.filepath}: ${t.error}`)}if(e.movedCount>0&&n==="text"){console.log(`
\u{1F4CB} Moved Files:`);for(let t of e.results.filter(r=>r.success&&r.changes?.moved))console.log(`   \u{1F4C1} ${t.filepath} \u2192 ${t.changes?.newPath}`)}}}o(X7,"outputResult");function FS(){return new _r("batch-repair").description("Batch repair folder locations for all markdown files in a directory").argument("<directory>","Directory to process (relative to vault root)").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--dry-run","Preview changes without modifying files").option("--format <type>","Output format: text|json (default: text)","text").option("--progress","Show progress during processing (default: true)",!0).option("--no-progress","Disable progress output").action(async(n,e)=>{let t=e.format||"text";ye.setFormat(t);try{let r=(0,PS.resolve)(e.vault),i=new Wi(r),s=n;if(!await i.directoryExists(s))throw new rt(`Directory not found: ${s}`,"exocortex batch-repair <existing-directory>");let c=await i.getMarkdownFiles(s);if(c.length===0){if(t==="json"){let O=lt.success({success:!0,total:0,movedCount:0,alreadyCorrectCount:0,errorCount:0,results:[],durationMs:0,atomic:!1});console.log(JSON.stringify(O,null,2))}else console.log(`
\u{1F4C2} No markdown files found in ${s}`);process.exit(0)}let u=c.map(O=>({command:"repair-folder",filepath:O})),l=e.progress!==!1&&t==="text",f=0;l&&console.log(`
\u{1F50D} Processing ${c.length} files in ${s}...`);let d=await new Vs(r,e.dryRun).executeBatch(u,!1),m=0,_=0,b=0;for(let O of d.results)if(O.success?O.changes?.moved?m++:_++:b++,l&&!e.dryRun){f++;let I=Math.round(f/c.length*100);process.stdout.write(`\r   Processing ${f}/${c.length} (${I}%)...`)}l&&process.stdout.write("\r"+" ".repeat(60)+"\r");let C={...d,movedCount:m,alreadyCorrectCount:_,errorCount:b};X7(t,C),process.exit(C.success?0:5)}catch(r){ye.handle(r)}})}o(FS,"batchRepairCommand");var Wf=require("fs"),Sn=require("path");function RS(){return new _r("resolve").description("Resolve UUID to file path").argument("<uuid>","Full or partial UUID to resolve").option("--vault <path>","Path to Obsidian vault",process.cwd()).option("--format <type>","Output format: uri|path|json (default: uri)","uri").option("--output <type>","Response format: text|json (for MCP tools)","text").option("--partial","Match partial UUIDs (returns all matches)").action(async(n,e)=>{let t=e.output||"text";ye.setFormat(t);try{let r=Date.now();if(!J7(n))throw new rt(`Invalid UUID format: ${n}`,"exocortex resolve <uuid> [--format uri|path|json] [--partial]",{uuid:n});let i=(0,Sn.resolve)(e.vault);if(!(0,Wf.existsSync)(i))throw new hi(i);let s=Z7(i,n,e.partial??!1),a=Date.now()-r;if(s.length===0){if(t==="json"){let c=lt.error("VALIDATION_FILE_NOT_FOUND",`UUID not found: ${n}`,3,{context:{uuid:n}});console.log(JSON.stringify(c,null,2))}else console.error(`UUID not found: ${n}`);process.exit(1)}e.partial||s.length>1?tN(s,i,e.format,t,n,a):eN(s[0],i,e.format,t,n,a)}catch(r){ye.handle(r)}})}o(RS,"resolveCommand");function J7(n){if(n.length<4)return!1;let e=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,t=/^[0-9a-f-]+$/i;return e.test(n)||t.test(n)}o(J7,"isValidUuidFormat");function Z7(n,e,t){let r=[],i=e.toLowerCase();function s(a){let c=(0,Wf.readdirSync)(a,{withFileTypes:!0});for(let u of c){let l=(0,Sn.join)(a,u.name);if(u.isDirectory())!u.name.startsWith(".")&&u.name!=="node_modules"&&s(l);else if(u.isFile()&&u.name.endsWith(".md")){let f=u.name.toLowerCase();t?f.includes(i)&&r.push(l):(f.startsWith(i+".md")||f.startsWith(i+" ")||f.startsWith(i+"-"))&&r.push(l)}}}return o(s,"walk"),s(n),r}o(Z7,"findFilesWithUuid");function NS(n){return`obsidian://vault/${encodeURI(n)}`}o(NS,"pathToObsidianUri");function kS(n){let e=n.match(/^([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/i);return e?e[1]:(0,Sn.basename)(n,".md")}o(kS,"extractUuidFromFilename");function eN(n,e,t,r,i,s){let a=(0,Sn.relative)(e,n),c=NS(a),u=kS((0,Sn.basename)(n));if(r==="json"){let l={uuid:u,path:a,absolutePath:n,uri:c},f=lt.success(l,{durationMs:s,searchUuid:i});console.log(JSON.stringify(f,null,2))}else switch(t){case"path":console.log(n);break;case"json":console.log(JSON.stringify({uuid:u,path:a,absolutePath:n,uri:c},null,2));break;case"uri":default:console.log(c);break}}o(eN,"outputSingleResult");function tN(n,e,t,r,i,s){let a=n.map(c=>{let u=(0,Sn.relative)(e,c),l=NS(u);return{uuid:kS((0,Sn.basename)(c)),path:u,absolutePath:c,uri:l}});if(r==="json"){let c=lt.success({matches:a,count:a.length},{durationMs:s,searchUuid:i,itemCount:a.length});console.log(JSON.stringify(c,null,2))}else switch(t){case"path":for(let c of a)console.log(c.absolutePath);break;case"json":console.log(JSON.stringify(a,null,2));break;case"uri":default:for(let c of a)console.log(c.uri);break}}o(tN,"outputMultipleResults");var Hi=new _r;Hi.name("exocortex").description("CLI tool for Exocortex knowledge management system").version("0.1.0");Hi.command("sparql").description("SPARQL query execution").addCommand(wb());Hi.addCommand(xS());Hi.addCommand(DS());Hi.addCommand(IS());Hi.addCommand(FS());Hi.addCommand(RS());Hi.parse();
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

tslib/tslib.es6.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
